---
uid: aspnet/overview/developing-apps-with-windows-azure/maintainable-azure-websites-managing-change-and-scale
title: 'Laboratório prático: sites do Azure que podem ser mantidos: Gerenciando alterações e escala | Microsoft Docs'
author: rick-anderson
description: Neste laboratório, saiba como Microsoft Azure facilita a criação e a implantação de sites para produção.
ms.author: riande
ms.date: 07/16/2014
ms.assetid: ecfd0eb4-c4ad-44e6-9db9-a2a66611ff6a
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/maintainable-azure-websites-managing-change-and-scale
msc.type: authoredcontent
ms.openlocfilehash: c88bae40a8aa092037c0b359ee391acaf161cf10
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78624267"
---
# <a name="hands-on-lab-maintainable-azure-websites-managing-change-and-scale"></a><span data-ttu-id="2e54b-103">Laboratório prático: sites do Azure que podem ser mantidos: Gerenciando alterações e escala</span><span class="sxs-lookup"><span data-stu-id="2e54b-103">Hands on Lab: Maintainable Azure Websites: Managing Change and Scale</span></span>

<span data-ttu-id="2e54b-104">por [equipe de acampamentos da Web](https://twitter.com/webcamps)</span><span class="sxs-lookup"><span data-stu-id="2e54b-104">by [Web Camps Team](https://twitter.com/webcamps)</span></span>

[<span data-ttu-id="2e54b-105">Baixe o kit de treinamento do Web acampamentos</span><span class="sxs-lookup"><span data-stu-id="2e54b-105">Download Web Camps Training Kit</span></span>](https://aka.ms/webcamps-training-kit)

> <span data-ttu-id="2e54b-106">Microsoft Azure facilita a criação e a implantação de sites para produção.</span><span class="sxs-lookup"><span data-stu-id="2e54b-106">Microsoft Azure makes it easy to build and deploy websites to production.</span></span> <span data-ttu-id="2e54b-107">Mas você não está pronto quando seu aplicativo está ativo, está apenas começando!</span><span class="sxs-lookup"><span data-stu-id="2e54b-107">But you're not done when your application is live, you're just getting started!</span></span> <span data-ttu-id="2e54b-108">Você precisará lidar com requisitos de alteração, atualizações de banco de dados, escala e muito mais.</span><span class="sxs-lookup"><span data-stu-id="2e54b-108">You'll need to handle changing requirements, database updates, scale, and more.</span></span> <span data-ttu-id="2e54b-109">Felizmente, Azure App serviço lhe foi abordado, com muitos recursos para ajudá-lo a manter seus sites funcionando sem problemas.</span><span class="sxs-lookup"><span data-stu-id="2e54b-109">Fortunately, Azure App Service has you covered, with plenty of features to help you keep your sites running smoothly.</span></span>
>
> <span data-ttu-id="2e54b-110">O Azure oferece opções seguras e flexíveis de desenvolvimento, implantação e dimensionamento para qualquer aplicativo Web de tamanho.</span><span class="sxs-lookup"><span data-stu-id="2e54b-110">Azure offers secure and flexible development, deployment and scaling options for any size web application.</span></span> <span data-ttu-id="2e54b-111">Utilize suas ferramentas existentes para criar e implantar aplicativos sem a dificuldade de gerenciar a infraestrutura.</span><span class="sxs-lookup"><span data-stu-id="2e54b-111">Leverage your existing tools to create and deploy applications without the hassle of managing infrastructure.</span></span>
>
> <span data-ttu-id="2e54b-112">Provisione um aplicativo Web de produção em minutos, implantando facilmente o conteúdo criado usando sua ferramenta de desenvolvimento favorita.</span><span class="sxs-lookup"><span data-stu-id="2e54b-112">Provision a production web application yourself in minutes by easily deploying content created using your favorite development tool.</span></span> <span data-ttu-id="2e54b-113">Você pode implantar um site existente diretamente do controle do código-fonte com suporte para **git**, **GitHub**, **bitbucket**, **TFS**e até mesmo **Dropbox**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-113">You can deploy an existing site directly from source control with support for **Git**, **GitHub**, **Bitbucket**, **TFS**, and even **DropBox**.</span></span> <span data-ttu-id="2e54b-114">Implante diretamente do seu IDE favorito ou de scripts usando o **PowerShell** nas ferramentas do Windows ou da **CLI** em execução em qualquer sistema operacional.</span><span class="sxs-lookup"><span data-stu-id="2e54b-114">Deploy directly from your favorite IDE or from scripts using **PowerShell** in Windows or **CLI** tools running on any OS.</span></span> <span data-ttu-id="2e54b-115">Depois de implantado, mantenha seus sites constantemente atualizados com suporte para implantação contínua.</span><span class="sxs-lookup"><span data-stu-id="2e54b-115">Once deployed, keep your sites constantly up-to-date with support for continuous deployment.</span></span>
>
> <span data-ttu-id="2e54b-116">O Azure fornece soluções escalonáveis, de armazenamento durável na nuvem, backup e recuperação para quaisquer dados, grandes ou pequenos.</span><span class="sxs-lookup"><span data-stu-id="2e54b-116">Azure provides scalable, durable cloud storage, backup, and recovery solutions for any data, big or small.</span></span> <span data-ttu-id="2e54b-117">Ao implantar aplicativos em um ambiente de produção, os serviços de armazenamento, como tabelas, BLOBs e bancos de dados SQL, ajudam a dimensionar seu aplicativo na nuvem.</span><span class="sxs-lookup"><span data-stu-id="2e54b-117">When deploying applications to a production environment, storage services such as Tables, Blobs and SQL Databases, help you scale your application in the cloud.</span></span>
>
> <span data-ttu-id="2e54b-118">Com os bancos de dados SQL, é importante manter seu banco de dados produtivo atualizado ao implantar novas versões do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2e54b-118">With SQL Databases, it is important to keep your productive database up-to-date when deploying new versions of your application.</span></span> <span data-ttu-id="2e54b-119">Graças ao **migrações do Entity Framework Code First**, o desenvolvimento e a implantação do modelo de dados foram simplificados para atualizar seus ambientes em minutos.</span><span class="sxs-lookup"><span data-stu-id="2e54b-119">Thanks to **Entity Framework Code First Migrations**, the development and deployment of your data model has been simplified to update your environments in minutes.</span></span> <span data-ttu-id="2e54b-120">Este laboratório prático mostrará os diferentes tópicos que você pode encontrar ao implantar seu aplicativo Web em ambientes de produção no Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="2e54b-120">This hands-on lab will show you the different topics you could encounter when deploying your web app to production environments in Microsoft Azure.</span></span>
>
> <span data-ttu-id="2e54b-121">Todos os códigos de exemplo e trechos de código estão incluídos no kit de treinamento do acampamentos da Web, disponível em [https://aka.ms/webcamps-training-kit](https://aka.ms/webcamps-training-kit).</span><span class="sxs-lookup"><span data-stu-id="2e54b-121">All sample code and snippets are included in the Web Camps Training Kit, available at [https://aka.ms/webcamps-training-kit](https://aka.ms/webcamps-training-kit).</span></span>
>
> <span data-ttu-id="2e54b-122">Para obter uma cobertura mais detalhada deste tópico, consulte o [criando aplicativos de nuvem do mundo real com o livro eletrônico do Azure](building-real-world-cloud-apps-with-windows-azure/introduction.md).</span><span class="sxs-lookup"><span data-stu-id="2e54b-122">For more in-depth coverage of this topic, see the [Building Real-World Cloud Apps with Azure e-book](building-real-world-cloud-apps-with-windows-azure/introduction.md).</span></span>

<a id="Overview"></a>
## <a name="overview"></a><span data-ttu-id="2e54b-123">Visão geral</span><span class="sxs-lookup"><span data-stu-id="2e54b-123">Overview</span></span>

<a id="Objectives"></a>
### <a name="objectives"></a><span data-ttu-id="2e54b-124">Objetivos</span><span class="sxs-lookup"><span data-stu-id="2e54b-124">Objectives</span></span>

<span data-ttu-id="2e54b-125">Neste laboratório prático, você aprenderá a:</span><span class="sxs-lookup"><span data-stu-id="2e54b-125">In this hands-on lab, you will learn how to:</span></span>

- <span data-ttu-id="2e54b-126">Habilitar migrações de Entity Framework com um modelo existente</span><span class="sxs-lookup"><span data-stu-id="2e54b-126">Enable Entity Framework Migrations with an existing model</span></span>
- <span data-ttu-id="2e54b-127">Atualizar o modelo de objeto e o banco de dados de acordo usando migrações Entity Framework</span><span class="sxs-lookup"><span data-stu-id="2e54b-127">Update the object model and database accordingly using Entity Framework Migrations</span></span>
- <span data-ttu-id="2e54b-128">Implantar no serviço Azure App usando o Git</span><span class="sxs-lookup"><span data-stu-id="2e54b-128">Deploy to Azure App Service using Git</span></span>
- <span data-ttu-id="2e54b-129">Reverter para uma implantação anterior usando o portal de gerenciamento do Azure</span><span class="sxs-lookup"><span data-stu-id="2e54b-129">Rollback to a previous deployment using the Azure Management portal</span></span>
- <span data-ttu-id="2e54b-130">Usar o armazenamento do Azure para dimensionar um aplicativo Web</span><span class="sxs-lookup"><span data-stu-id="2e54b-130">Use Azure Storage to scale a web app</span></span>
- <span data-ttu-id="2e54b-131">Configurar o dimensionamento automático para um aplicativo Web usando o Portal de Gerenciamento do Azure</span><span class="sxs-lookup"><span data-stu-id="2e54b-131">Configure auto-scaling for a web app using the Azure Management Portal</span></span>
- <span data-ttu-id="2e54b-132">Criar e configurar um projeto de teste de carga no Visual Studio</span><span class="sxs-lookup"><span data-stu-id="2e54b-132">Create and configure a load test project in Visual Studio</span></span>

<a id="Prerequisites"></a>
### <a name="prerequisites"></a><span data-ttu-id="2e54b-133">Prerequisites</span><span class="sxs-lookup"><span data-stu-id="2e54b-133">Prerequisites</span></span>

<span data-ttu-id="2e54b-134">O seguinte é necessário para concluir este laboratório prático:</span><span class="sxs-lookup"><span data-stu-id="2e54b-134">The following is required to complete this hands-on lab:</span></span>

- <span data-ttu-id="2e54b-135">[Visual Studio Express 2013 para Web](https://www.microsoft.com/visualstudio/) ou superior</span><span class="sxs-lookup"><span data-stu-id="2e54b-135">[Visual Studio Express 2013 for Web](https://www.microsoft.com/visualstudio/) or greater</span></span>
- [<span data-ttu-id="2e54b-136">SDK do Azure para .NET 2,2</span><span class="sxs-lookup"><span data-stu-id="2e54b-136">Azure SDK for .NET 2.2</span></span>](https://www.microsoft.com/windowsazure/sdk/)
- [<span data-ttu-id="2e54b-137">Sistema de controle de versão do GIT</span><span class="sxs-lookup"><span data-stu-id="2e54b-137">GIT Version Control System</span></span>](http://git-scm.com/download)
- <span data-ttu-id="2e54b-138">Uma assinatura Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="2e54b-138">A Microsoft Azure subscription</span></span>

    - <span data-ttu-id="2e54b-139">Inscreva-se para uma [avaliação gratuita](https://aka.ms/watk-freetrial)</span><span class="sxs-lookup"><span data-stu-id="2e54b-139">Sign up for a [Free Trial](https://aka.ms/watk-freetrial)</span></span>
    - <span data-ttu-id="2e54b-140">Se você for um Visual Studio Professional, Test Professional, Premium ou Ultimate com o MSDN ou Plataformas MSDN assinante, ative seu [benefício do MSDN](https://aka.ms/watk-msdn) agora para começar a desenvolver e testar no Azure</span><span class="sxs-lookup"><span data-stu-id="2e54b-140">If you are a Visual Studio Professional, Test Professional, Premium or Ultimate with MSDN or MSDN Platforms subscriber, activate your [MSDN benefit](https://aka.ms/watk-msdn) now to start developing and testing on Azure</span></span>
    - <span data-ttu-id="2e54b-141">Os membros do [BizSpark](https://aka.ms/watk-bizspark) recebem automaticamente o benefício do Azure por meio de suas assinaturas Visual Studio Ultimate com msdn</span><span class="sxs-lookup"><span data-stu-id="2e54b-141">[BizSpark](https://aka.ms/watk-bizspark) members automatically receive the Azure benefit through their Visual Studio Ultimate with MSDN subscriptions</span></span>
    - <span data-ttu-id="2e54b-142">Os membros do programa [Microsoft Partner Network](https://aka.ms/watk-mpn) Cloud Essentials recebem créditos mensais do Azure sem encargos</span><span class="sxs-lookup"><span data-stu-id="2e54b-142">Members of the [Microsoft Partner Network](https://aka.ms/watk-mpn) Cloud Essentials program receive monthly Azure credits at no charge</span></span>

<a id="Setup"></a>
### <a name="setup"></a><span data-ttu-id="2e54b-143">Instalação</span><span class="sxs-lookup"><span data-stu-id="2e54b-143">Setup</span></span>

<span data-ttu-id="2e54b-144">Para executar os exercícios neste laboratório prático, você precisará configurar seu ambiente primeiro...</span><span class="sxs-lookup"><span data-stu-id="2e54b-144">In order to run the exercises in this hands-on lab, you will need to set up your environment first.</span></span>

1. <span data-ttu-id="2e54b-145">Abra o Windows Explorer e navegue até a pasta de **origem** do laboratório.</span><span class="sxs-lookup"><span data-stu-id="2e54b-145">Open Windows Explorer and browse to the lab's **Source** folder.</span></span>
2. <span data-ttu-id="2e54b-146">Clique com o botão direito do mouse em **Setup. cmd** e selecione **Executar como administrador** para iniciar o processo de instalação que irá configurar seu ambiente e instalar os trechos de código do Visual Studio para este laboratório.</span><span class="sxs-lookup"><span data-stu-id="2e54b-146">Right-click on **Setup.cmd** and select **Run as administrator** to launch the setup process that will configure your environment and install the Visual Studio code snippets for this lab.</span></span>
3. <span data-ttu-id="2e54b-147">Se a caixa de diálogo controle de conta de usuário for mostrada, confirme a ação para continuar.</span><span class="sxs-lookup"><span data-stu-id="2e54b-147">If the User Account Control dialog is shown, confirm the action to proceed.</span></span>

> [!NOTE]
> <span data-ttu-id="2e54b-148">Verifique se você verificou todas as dependências deste laboratório antes de executar a instalação.</span><span class="sxs-lookup"><span data-stu-id="2e54b-148">Make sure you have checked all the dependencies for this lab before running the setup.</span></span>

<a id="CodeSnippets"></a>
### <a name="using-the-code-snippets"></a><span data-ttu-id="2e54b-149">Usando os trechos de código</span><span class="sxs-lookup"><span data-stu-id="2e54b-149">Using the Code Snippets</span></span>

<span data-ttu-id="2e54b-150">Em todo o documento do laboratório, você será instruído a inserir blocos de código.</span><span class="sxs-lookup"><span data-stu-id="2e54b-150">Throughout the lab document, you will be instructed to insert code blocks.</span></span> <span data-ttu-id="2e54b-151">Para sua conveniência, a maior parte desse código é fornecida como trechos de Visual Studio Code, que podem ser acessados em Visual Studio 2013 para evitar a necessidade de adicioná-lo manualmente.</span><span class="sxs-lookup"><span data-stu-id="2e54b-151">For your convenience, most of this code is provided as Visual Studio Code Snippets, which you can access from within Visual Studio 2013 to avoid having to add it manually.</span></span>

> [!NOTE]
> <span data-ttu-id="2e54b-152">Cada exercício é acompanhado por uma solução inicial localizada na pasta **begin** do exercício que permite que você siga cada exercício independentemente dos outros.</span><span class="sxs-lookup"><span data-stu-id="2e54b-152">Each exercise is accompanied by a starting solution located in the **Begin** folder of the exercise that allows you to follow each exercise independently of the others.</span></span> <span data-ttu-id="2e54b-153">Lembre-se de que os trechos de código que são adicionados durante um exercício estão ausentes dessas soluções iniciais e podem não funcionar até que você conclua o exercício.</span><span class="sxs-lookup"><span data-stu-id="2e54b-153">Please be aware that the code snippets that are added during an exercise are missing from these starting solutions and may not work until you have completed the exercise.</span></span> <span data-ttu-id="2e54b-154">Dentro do código-fonte de um exercício, você também encontrará uma pasta **final** contendo uma solução do Visual Studio com o código que resulta da conclusão das etapas no exercício correspondente.</span><span class="sxs-lookup"><span data-stu-id="2e54b-154">Inside the source code for an exercise, you will also find an **End** folder containing a Visual Studio solution with the code that results from completing the steps in the corresponding exercise.</span></span> <span data-ttu-id="2e54b-155">Você pode usar essas soluções como diretrizes se precisar de ajuda adicional ao trabalhar com este laboratório prático.</span><span class="sxs-lookup"><span data-stu-id="2e54b-155">You can use these solutions as guidance if you need additional help as you work through this hands-on lab.</span></span>

---

<a id="Exercises"></a>
## <a name="exercises"></a><span data-ttu-id="2e54b-156">Exercícios</span><span class="sxs-lookup"><span data-stu-id="2e54b-156">Exercises</span></span>

<span data-ttu-id="2e54b-157">Este laboratório prático inclui os seguintes exercícios:</span><span class="sxs-lookup"><span data-stu-id="2e54b-157">This hands-on lab includes the following exercises:</span></span>

1. [<span data-ttu-id="2e54b-158">Usando migrações de Entity Framework</span><span class="sxs-lookup"><span data-stu-id="2e54b-158">Using Entity Framework Migrations</span></span>](#Exercise1)
2. [<span data-ttu-id="2e54b-159">Implantando um aplicativo Web para preparo</span><span class="sxs-lookup"><span data-stu-id="2e54b-159">Deploying a Web App to Staging</span></span>](#Exercise2)
3. [<span data-ttu-id="2e54b-160">Executando a reversão de implantação na produção</span><span class="sxs-lookup"><span data-stu-id="2e54b-160">Performing Deployment Rollback in Production</span></span>](#Exercise3)
4. [<span data-ttu-id="2e54b-161">Dimensionamento usando o armazenamento do Azure</span><span class="sxs-lookup"><span data-stu-id="2e54b-161">Scaling Using Azure Storage</span></span>](#Exercise4)
5. <span data-ttu-id="2e54b-162">[Usando o dimensionamento automático para aplicativos Web](#Exercise5) (opcional para Visual Studio 2013 Ultimate Edition)</span><span class="sxs-lookup"><span data-stu-id="2e54b-162">[Using Autoscale for Web Apps](#Exercise5) (Optional for Visual Studio 2013 Ultimate edition)</span></span>

<span data-ttu-id="2e54b-163">Tempo estimado para concluir este laboratório: **75 minutos**</span><span class="sxs-lookup"><span data-stu-id="2e54b-163">Estimated time to complete this lab: **75 minutes**</span></span>

> [!NOTE]
> <span data-ttu-id="2e54b-164">Ao iniciar o Visual Studio pela primeira vez, você deve selecionar uma das coleções de configurações predefinidas.</span><span class="sxs-lookup"><span data-stu-id="2e54b-164">When you first start Visual Studio, you must select one of the predefined settings collections.</span></span> <span data-ttu-id="2e54b-165">Cada coleção predefinida é projetada para corresponder a um estilo de desenvolvimento específico e determina layouts de janela, comportamento do editor, trechos de código IntelliSense e opções da caixa de diálogo.</span><span class="sxs-lookup"><span data-stu-id="2e54b-165">Each predefined collection is designed to match a particular development style and determines window layouts, editor behavior, IntelliSense code snippets, and dialog box options.</span></span> <span data-ttu-id="2e54b-166">Os procedimentos neste laboratório descrevem as ações necessárias para realizar uma determinada tarefa no Visual Studio ao usar a coleção de **configurações de desenvolvimento geral** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-166">The procedures in this lab describe the actions necessary to accomplish a given task in Visual Studio when using the **General Development Settings** collection.</span></span> <span data-ttu-id="2e54b-167">Se você escolher uma coleção de configurações diferentes para seu ambiente de desenvolvimento, poderá haver diferenças nas etapas que você deve levar em conta.</span><span class="sxs-lookup"><span data-stu-id="2e54b-167">If you choose a different settings collection for your development environment, there may be differences in the steps that you should take into account.</span></span>

<a id="Exercise1"></a>
### <a name="exercise-1-using-entity-framework-migrations"></a><span data-ttu-id="2e54b-168">Exercício 1: usando migrações de Entity Framework</span><span class="sxs-lookup"><span data-stu-id="2e54b-168">Exercise 1: Using Entity Framework Migrations</span></span>

<span data-ttu-id="2e54b-169">Quando você estiver desenvolvendo um aplicativo, seu modelo de dados poderá mudar ao longo do tempo.</span><span class="sxs-lookup"><span data-stu-id="2e54b-169">When you are developing an application, your data model might change over time.</span></span> <span data-ttu-id="2e54b-170">Essas alterações podem afetar o modelo existente no banco de dados (se você estiver criando uma nova versão) e for importante manter seu banco de dados atualizado para evitar erros.</span><span class="sxs-lookup"><span data-stu-id="2e54b-170">These changes could affect the existing model in your database (if you are creating a new version) and it is important to keep your database up-to-date to prevent errors.</span></span>

<span data-ttu-id="2e54b-171">Para simplificar o acompanhamento dessas alterações em seu modelo, **migrações do Entity Framework Code First** detectar automaticamente as alterações que comparam seu modelo com o esquema de banco de dados e gera um código específico para atualizar seu banco de dados, criando novas *versões* do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="2e54b-171">To simplify the tracking of these changes in your model, **Entity Framework Code First Migrations** automatically detect changes comparing your model with the database schema and generates specific code to update your database, creating new *versions* of your database.</span></span>

<span data-ttu-id="2e54b-172">Este exercício mostra como habilitar as **migrações** para seu aplicativo e como você pode facilmente detectar e gerar alterações para atualizar seus bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="2e54b-172">This exercise shows you how to enable **Migrations** for your application and how you can easily detect and generate changes to update your databases.</span></span>

<a id="Ex1Task1"></a>
#### <a name="task-1--enabling-migrations"></a><span data-ttu-id="2e54b-173">Tarefa 1 – habilitando as migrações</span><span class="sxs-lookup"><span data-stu-id="2e54b-173">Task 1 – Enabling Migrations</span></span>

<span data-ttu-id="2e54b-174">Nesta tarefa, você seguirá as etapas de habilitar **migrações do Entity Framework Code First** para o banco de dados de **teste especialista** , alterar o modelo e entender como essas alterações serão refletidas no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="2e54b-174">In this task, you will go through the steps of enabling **Entity Framework Code First Migrations** to the **Geek Quiz** database, changing the model and understanding how those changes are reflected in the database.</span></span>

1. <span data-ttu-id="2e54b-175">Abra o Visual Studio e abra o arquivo de solução **GeekQuiz. sln** de **Source\Ex1-UsingEntityFrameworkMigrations\Begin**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-175">Open Visual Studio and open the **GeekQuiz.sln** solution file from **Source\Ex1-UsingEntityFrameworkMigrations\Begin**.</span></span>
2. <span data-ttu-id="2e54b-176">Compile a solução para baixar e instalar as dependências do pacote **NuGet** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-176">Build the solution in order to download and install the **NuGet** package dependencies.</span></span> <span data-ttu-id="2e54b-177">Para fazer isso, clique com o botão direito do mouse na solução e clique em **Compilar solução** ou pressione **Ctrl + Shift + B**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-177">To do this, right-click the solution and click **Build Solution** or press **Ctrl + Shift + B**.</span></span>
3. <span data-ttu-id="2e54b-178">No menu **ferramentas** no Visual Studio, selecione **Gerenciador de pacotes NuGet**e clique em **console do Gerenciador de pacotes**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-178">From the **Tools** menu in Visual Studio, select **NuGet Package Manager**, and then click **Package Manager Console**.</span></span>
4. <span data-ttu-id="2e54b-179">No **console do Gerenciador de pacotes**, digite o comando a seguir e pressione **Enter**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-179">In the **Package Manager Console**, enter the following command and then press **Enter**.</span></span> <span data-ttu-id="2e54b-180">Uma migração inicial com base no modelo existente será criada.</span><span class="sxs-lookup"><span data-stu-id="2e54b-180">An initial migration based on the existing model will be created.</span></span>

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample1.ps1)]

    <span data-ttu-id="2e54b-181">![Habilitando migrações](maintainable-azure-websites-managing-change-and-scale/_static/image1.png "Habilitando as migrações")</span><span class="sxs-lookup"><span data-stu-id="2e54b-181">![Enabling Migrations](maintainable-azure-websites-managing-change-and-scale/_static/image1.png "Enabling Migrations")</span></span>

    <span data-ttu-id="2e54b-182">*Habilitando migrações*</span><span class="sxs-lookup"><span data-stu-id="2e54b-182">*Enabling Migrations*</span></span>

    > [!NOTE]
    > <span data-ttu-id="2e54b-183">Esse comando adiciona uma pasta **Migrations** ao projeto de teste de especialista que contém um arquivo chamado **Configuration.cs**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-183">This command adds a **Migrations** folder to Geek Quiz project that contains a file called **Configuration.cs**.</span></span> <span data-ttu-id="2e54b-184">A classe de **configuração** permite que você configure como as migrações se comparam ao seu contexto.</span><span class="sxs-lookup"><span data-stu-id="2e54b-184">The **Configuration** class allows you to configure how Migrations behaves for your context.</span></span>
5. <span data-ttu-id="2e54b-185">Com as migrações habilitadas, você precisará atualizar a classe de **configuração** para popular o banco de dados com a data inicial exigida pelo **teste de especialista** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-185">With Migrations enabled, you need to update the **Configuration** class to populate the database with the initial data that **Geek Quiz** requires.</span></span> <span data-ttu-id="2e54b-186">Em **migrações**, substitua o arquivo **Configuration.cs** com aquele localizado na pasta **Source\Assets** deste laboratório.</span><span class="sxs-lookup"><span data-stu-id="2e54b-186">Under **Migrations**, replace the **Configuration.cs** file with the one located in the **Source\Assets** folder of this lab.</span></span>

    > [!NOTE]
    > <span data-ttu-id="2e54b-187">Como as **migrações** chamarão o método **semente** com cada atualização de banco de dados, você precisará ter certeza de que os registros não serão duplicados no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="2e54b-187">Since **Migrations** will call the **Seed** method with every database update, you need to be sure that records are not duplicated in the database.</span></span> <span data-ttu-id="2e54b-188">O método **AddOrUpdate** ajudará a evitar dados duplicados.</span><span class="sxs-lookup"><span data-stu-id="2e54b-188">The **AddOrUpdate** method will help to prevent duplicate data.</span></span>
6. <span data-ttu-id="2e54b-189">Para adicionar uma migração inicial, insira o comando a seguir e pressione **Enter**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-189">To add an initial migration, enter the following command and then press **Enter**.</span></span>

    > [!NOTE]
    > <span data-ttu-id="2e54b-190">Verifique se não há nenhum banco de dados chamado &quot;GeekQuizProd&quot; na instância de LocalDB.</span><span class="sxs-lookup"><span data-stu-id="2e54b-190">Make sure that there is no database named &quot;GeekQuizProd&quot; in your LocalDB instance.</span></span>

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample2.ps1)]

    <span data-ttu-id="2e54b-191">![Adicionando a migração de esquema base](maintainable-azure-websites-managing-change-and-scale/_static/image2.png "Adicionando a migração de esquema base")</span><span class="sxs-lookup"><span data-stu-id="2e54b-191">![Adding base schema migration](maintainable-azure-websites-managing-change-and-scale/_static/image2.png "Adding base schema migration")</span></span>

    <span data-ttu-id="2e54b-192">*Adicionando a migração de esquema base*</span><span class="sxs-lookup"><span data-stu-id="2e54b-192">*Adding base schema migration*</span></span>

    > [!NOTE]
    > <span data-ttu-id="2e54b-193">A **migração adicionará** Scaffold a próxima migração com base nas alterações feitas em seu modelo desde a criação da última migração.</span><span class="sxs-lookup"><span data-stu-id="2e54b-193">**Add-Migration** will scaffold the next migration based on changes you have made to your model since the last migration was created.</span></span> <span data-ttu-id="2e54b-194">Nesse caso, como é a primeira migração do projeto, ele adicionará os scripts para criar todas as tabelas definidas na classe **TriviaContext** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-194">In this case, as it is the first migration of the project, it will add the scripts to create all the tables defined in the **TriviaContext** class.</span></span>
7. <span data-ttu-id="2e54b-195">Execute a migração para atualizar o banco de dados executando o comando a seguir.</span><span class="sxs-lookup"><span data-stu-id="2e54b-195">Execute the migration to update the database by running the following command.</span></span> <span data-ttu-id="2e54b-196">Para este comando, você especificará o sinalizador **detalhado** para exibir as instruções SQL que estão sendo aplicadas ao banco de dados de destino.</span><span class="sxs-lookup"><span data-stu-id="2e54b-196">For this command you will specify the **Verbose** flag to view the SQL statements being applied to the target database.</span></span>

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample3.ps1)]

    <span data-ttu-id="2e54b-197">![Criando banco de dados inicial](maintainable-azure-websites-managing-change-and-scale/_static/image3.png "Criando banco de dados inicial")</span><span class="sxs-lookup"><span data-stu-id="2e54b-197">![Creating initial database](maintainable-azure-websites-managing-change-and-scale/_static/image3.png "Creating initial database")</span></span>

    <span data-ttu-id="2e54b-198">*Criando banco de dados inicial*</span><span class="sxs-lookup"><span data-stu-id="2e54b-198">*Creating initial database*</span></span>

    > [!NOTE]
    > <span data-ttu-id="2e54b-199">**Update-Database** aplicará todas as migrações pendentes ao banco de dados.</span><span class="sxs-lookup"><span data-stu-id="2e54b-199">**Update-Database** will apply any pending migrations to the database.</span></span> <span data-ttu-id="2e54b-200">Nesse caso, ele criará o banco de dados usando a cadeia de conexão definida em seu arquivo Web. config.</span><span class="sxs-lookup"><span data-stu-id="2e54b-200">In this case, it will create the database using the connection string defined in your web.config file.</span></span>
8. <span data-ttu-id="2e54b-201">Vá para o menu **Exibir** e abra **pesquisador de objetos do SQL Server**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-201">Go to **View** menu and open **SQL Server Object Explorer**.</span></span>

    <span data-ttu-id="2e54b-202">![Abrir no Pesquisador de Objetos do SQL Server](maintainable-azure-websites-managing-change-and-scale/_static/image4.png "Abrir no Pesquisador de Objetos do SQL Server")</span><span class="sxs-lookup"><span data-stu-id="2e54b-202">![Open in SQL Server Object Explorer](maintainable-azure-websites-managing-change-and-scale/_static/image4.png "Open in SQL Server Object Explorer")</span></span>

    <span data-ttu-id="2e54b-203">*Abrir no Pesquisador de Objetos do SQL Server*</span><span class="sxs-lookup"><span data-stu-id="2e54b-203">*Open in SQL Server Object Explorer*</span></span>
9. <span data-ttu-id="2e54b-204">Na janela **pesquisador de objetos do SQL Server** , conecte-se à instância do LocalDB clicando com o botão direito do mouse no nó **SQL Server** e selecionando a opção **Adicionar SQL Server...** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-204">In the **SQL Server Object Explorer** window, connect to your LocalDB instance by right-clicking the **SQL Server** node and selecting **Add SQL Server...** option.</span></span>

    <span data-ttu-id="2e54b-205">![Adicionando uma instância de SQL Server](maintainable-azure-websites-managing-change-and-scale/_static/image5.png "Adicionando uma instância de SQL Server")</span><span class="sxs-lookup"><span data-stu-id="2e54b-205">![Adding a SQL Server Instance](maintainable-azure-websites-managing-change-and-scale/_static/image5.png "Adding a SQL Server Instance")</span></span>

    <span data-ttu-id="2e54b-206">*Adicionando uma instância de SQL Server ao Pesquisador de Objetos do SQL Server*</span><span class="sxs-lookup"><span data-stu-id="2e54b-206">*Adding a SQL Server instance to SQL Server Object Explorer*</span></span>
10. <span data-ttu-id="2e54b-207">Defina o **nome do servidor** como *(LocalDB) \v11.0* e deixe a **autenticação do Windows** como seu modo de autenticação.</span><span class="sxs-lookup"><span data-stu-id="2e54b-207">Set the **server name** to *(localdb)\v11.0* and leave **Windows Authentication** as your authentication mode.</span></span> <span data-ttu-id="2e54b-208">Clique em **Conectar** para continuar.</span><span class="sxs-lookup"><span data-stu-id="2e54b-208">Click **Connect** to continue.</span></span>

    <span data-ttu-id="2e54b-209">![Conectando ao LocalDB](maintainable-azure-websites-managing-change-and-scale/_static/image6.png "Conectando ao LocalDB")</span><span class="sxs-lookup"><span data-stu-id="2e54b-209">![Connecting to LocalDB](maintainable-azure-websites-managing-change-and-scale/_static/image6.png "Connecting to LocalDB")</span></span>

    <span data-ttu-id="2e54b-210">*Conectando ao LocalDB*</span><span class="sxs-lookup"><span data-stu-id="2e54b-210">*Connecting to LocalDB*</span></span>
11. <span data-ttu-id="2e54b-211">Abra o banco de dados **GeekQuizProd** e expanda o nó **tabelas** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-211">Open the **GeekQuizProd** database and expand the **Tables** node.</span></span> <span data-ttu-id="2e54b-212">Como você pode ver, o comando **Update-Database** gerou todas as tabelas definidas na classe **TriviaContext** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-212">As you can see, the **Update-Database** command generated all the tables defined in the **TriviaContext** class.</span></span> <span data-ttu-id="2e54b-213">Localize o **dbo. Tabela TriviaQuestions** e abra o nó colunas.</span><span class="sxs-lookup"><span data-stu-id="2e54b-213">Locate the **dbo.TriviaQuestions** table and open the columns node.</span></span> <span data-ttu-id="2e54b-214">Na próxima tarefa, você adicionará uma nova coluna a essa tabela e atualizará o banco de dados usando as **migrações**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-214">In the next task, you will add a new column to this table and update the database using **Migrations**.</span></span>

    <span data-ttu-id="2e54b-215">![Colunas de perguntas de Trívia](maintainable-azure-websites-managing-change-and-scale/_static/image7.png "Colunas de perguntas de Trívia")</span><span class="sxs-lookup"><span data-stu-id="2e54b-215">![Trivia Questions Columns](maintainable-azure-websites-managing-change-and-scale/_static/image7.png "Trivia Questions Columns")</span></span>

    <span data-ttu-id="2e54b-216">*Colunas de perguntas de Trívia*</span><span class="sxs-lookup"><span data-stu-id="2e54b-216">*Trivia Questions Columns*</span></span>

<a id="Ex1Task2"></a>
#### <a name="task-2--updating-database-schema-using-migrations"></a><span data-ttu-id="2e54b-217">Tarefa 2 – Atualizando o esquema de banco de dados usando migrações</span><span class="sxs-lookup"><span data-stu-id="2e54b-217">Task 2 – Updating Database Schema Using Migrations</span></span>

<span data-ttu-id="2e54b-218">Nesta tarefa, você usará **migrações do Entity Framework Code First** para detectar uma alteração em seu modelo e gerar o código necessário para atualizar o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="2e54b-218">In this task, you will use **Entity Framework Code First Migrations** to detect a change in your model and generate the necessary code to update the database.</span></span> <span data-ttu-id="2e54b-219">Você atualizará a entidade **TriviaQuestions** adicionando uma nova propriedade a ela.</span><span class="sxs-lookup"><span data-stu-id="2e54b-219">You will update the **TriviaQuestions** entity by adding a new property to it.</span></span> <span data-ttu-id="2e54b-220">Em seguida, você executará comandos para criar uma nova migração para incluir a nova coluna na tabela.</span><span class="sxs-lookup"><span data-stu-id="2e54b-220">Then you will run commands to create a new Migration to include the new column in the table.</span></span>

1. <span data-ttu-id="2e54b-221">Em **Gerenciador de soluções**, clique duas vezes no arquivo **TriviaQuestion.cs** localizado dentro da pasta **modelos** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-221">In **Solution Explorer**, double-click the **TriviaQuestion.cs** file located inside the **Models** folder.</span></span>
2. <span data-ttu-id="2e54b-222">Adicione uma nova propriedade chamada **Hint**, conforme mostrado no trecho de código a seguir.</span><span class="sxs-lookup"><span data-stu-id="2e54b-222">Add a new property named **Hint**, as shown in the following code snippet.</span></span>

    [!code-csharp[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample4.cs)]
3. <span data-ttu-id="2e54b-223">No **console do Gerenciador de pacotes**, digite o comando a seguir e pressione **Enter**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-223">In the **Package Manager Console**, enter the following command and then press **Enter**.</span></span> <span data-ttu-id="2e54b-224">Uma nova migração será criada refletindo a alteração em nosso modelo.</span><span class="sxs-lookup"><span data-stu-id="2e54b-224">A new migration will be created reflecting the change in our model.</span></span>

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample5.ps1)]

    <span data-ttu-id="2e54b-225">![Adicionar e migrar](maintainable-azure-websites-managing-change-and-scale/_static/image8.png "Adicionar e migrar")</span><span class="sxs-lookup"><span data-stu-id="2e54b-225">![Add-Migration](maintainable-azure-websites-managing-change-and-scale/_static/image8.png "Add-Migration")</span></span>

    <span data-ttu-id="2e54b-226">*Adicionar e migrar*</span><span class="sxs-lookup"><span data-stu-id="2e54b-226">*Add-Migration*</span></span>

    > [!NOTE]
    > <span data-ttu-id="2e54b-227">Um arquivo de migração é composto por dois métodos, **para cima** e **para baixo**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-227">A Migration file is composed of two methods, **Up** and **Down**.</span></span>
    >
    > - <span data-ttu-id="2e54b-228">O método **up** será usado para especificar as alterações que a versão atual do aplicativo precisa aplicar ao banco de dados.</span><span class="sxs-lookup"><span data-stu-id="2e54b-228">The **Up** method will be used to specify what changes the current version of our application need to apply to the database.</span></span>
    > - <span data-ttu-id="2e54b-229">O **inoperante** é usado para reverter as alterações que adicionamos ao método **up** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-229">The **Down** is used to reverse the changes we have added to the **Up** method.</span></span>
    >
    > <span data-ttu-id="2e54b-230">Quando a migração de banco de dados atualizar o banco de dados, ele executará todas as migrações na ordem de carimbo de data/hora e somente aquelas que não foram usadas desde a última atualização (a tabela \_MigrationHistory controla quais migrações foram aplicadas).</span><span class="sxs-lookup"><span data-stu-id="2e54b-230">When the Database Migration updates the database, it will run all migrations in the timestamp order, and only those that have not been used since the last update (The \_MigrationHistory table keeps track of which migrations have been applied).</span></span> <span data-ttu-id="2e54b-231">O método **up** de todas as migrações será chamado e fará as alterações que especificamos para o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="2e54b-231">The **Up** method of all migrations will be called and will make the changes we have specified to the database.</span></span> <span data-ttu-id="2e54b-232">Se decidirmos voltar a uma migração anterior, o método **inoperante** será chamado para refazer as alterações em uma ordem inversa.</span><span class="sxs-lookup"><span data-stu-id="2e54b-232">If we decide to go back to a previous migration, the **Down** method will be called to redo the changes in a reverse order.</span></span>
4. <span data-ttu-id="2e54b-233">No **console do Gerenciador de pacotes**, digite o comando a seguir e pressione **Enter**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-233">In the **Package Manager Console**, enter the following command and then press **Enter**.</span></span>

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample6.ps1)]
5. <span data-ttu-id="2e54b-234">A saída do comando **Update-Database** gerou uma instrução **ALTER TABLE** SQL para adicionar uma nova coluna à tabela **TriviaQuestions** , conforme mostrado na imagem abaixo.</span><span class="sxs-lookup"><span data-stu-id="2e54b-234">The output of the **Update-Database** command generated an **Alter Table** SQL statement to add a new column to the **TriviaQuestions** table, as shown in the image below.</span></span>

    <span data-ttu-id="2e54b-235">![Instrução SQL de adição de coluna gerada](maintainable-azure-websites-managing-change-and-scale/_static/image9.png "Instrução SQL de adição de coluna gerada")</span><span class="sxs-lookup"><span data-stu-id="2e54b-235">![Add column SQL statement generated](maintainable-azure-websites-managing-change-and-scale/_static/image9.png "Add column SQL statement generated")</span></span>

    <span data-ttu-id="2e54b-236">*Instrução SQL de adição de coluna gerada*</span><span class="sxs-lookup"><span data-stu-id="2e54b-236">*Add column SQL statement generated*</span></span>
6. <span data-ttu-id="2e54b-237">Em **pesquisador de objetos do SQL Server**, atualize o **dbo. TriviaQuestions** tabela e verifique se a nova coluna de **dica** é exibida.</span><span class="sxs-lookup"><span data-stu-id="2e54b-237">In **SQL Server Object Explorer**, refresh the **dbo.TriviaQuestions** table and check that the new **Hint** column is displayed.</span></span>

    <span data-ttu-id="2e54b-238">![Mostrando a nova coluna de dica](maintainable-azure-websites-managing-change-and-scale/_static/image10.png "Mostrando a nova coluna de dica")</span><span class="sxs-lookup"><span data-stu-id="2e54b-238">![Showing the new Hint Column](maintainable-azure-websites-managing-change-and-scale/_static/image10.png "Showing the new Hint Column")</span></span>

    <span data-ttu-id="2e54b-239">*Mostrando a nova coluna de dica*</span><span class="sxs-lookup"><span data-stu-id="2e54b-239">*Showing the new Hint Column*</span></span>
7. <span data-ttu-id="2e54b-240">De volta ao editor de **TriviaQuestion.cs** , adicione uma restrição **StringLength** à propriedade *Hint* , conforme mostrado no trecho de código a seguir.</span><span class="sxs-lookup"><span data-stu-id="2e54b-240">Back in the **TriviaQuestion.cs** editor, add a **StringLength** constraint to the *Hint* property, as shown in the following code snippet.</span></span>

    [!code-csharp[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample7.cs)]
8. <span data-ttu-id="2e54b-241">No **console do Gerenciador de pacotes**, digite o comando a seguir e pressione **Enter**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-241">In the **Package Manager Console**, enter the following command and then press **Enter**.</span></span>

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample8.ps1)]
9. <span data-ttu-id="2e54b-242">No **console do Gerenciador de pacotes**, digite o comando a seguir e pressione **Enter**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-242">In the **Package Manager Console**, enter the following command and then press **Enter**.</span></span>

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample9.ps1)]
10. <span data-ttu-id="2e54b-243">A saída do comando **Update-Database** gerou uma instrução **ALTER TABLE** SQL para atualizar o tipo de coluna de *dica* da tabela **TriviaQuestions** , conforme mostrado na imagem abaixo.</span><span class="sxs-lookup"><span data-stu-id="2e54b-243">The output of the **Update-Database** command generated an **Alter Table** SQL statement to update the *hint* column type of the **TriviaQuestions** table, as shown in the image below.</span></span>

    <span data-ttu-id="2e54b-244">![Instrução ALTER COLUMN SQL gerada](maintainable-azure-websites-managing-change-and-scale/_static/image11.png "Instrução ALTER COLUMN SQL gerada")</span><span class="sxs-lookup"><span data-stu-id="2e54b-244">![Alter column SQL statement generated](maintainable-azure-websites-managing-change-and-scale/_static/image11.png "Alter column SQL statement generated")</span></span>

    <span data-ttu-id="2e54b-245">*Instrução ALTER COLUMN SQL gerada*</span><span class="sxs-lookup"><span data-stu-id="2e54b-245">*Alter column SQL statement generated*</span></span>
11. <span data-ttu-id="2e54b-246">Em **pesquisador de objetos do SQL Server**, atualize o **dbo. TriviaQuestions** tabela e verifique se o tipo de coluna de **dica** é **nvarchar (150)** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-246">In **SQL Server Object Explorer**, refresh the **dbo.TriviaQuestions** table and check that the **Hint** column type is **nvarchar(150)**.</span></span>

    <span data-ttu-id="2e54b-247">![Mostrando a nova restrição](maintainable-azure-websites-managing-change-and-scale/_static/image12.png "Mostrando a nova restrição")</span><span class="sxs-lookup"><span data-stu-id="2e54b-247">![Showing the new constraint](maintainable-azure-websites-managing-change-and-scale/_static/image12.png "Showing the new constraint")</span></span>

    <span data-ttu-id="2e54b-248">*Mostrando a nova restrição*</span><span class="sxs-lookup"><span data-stu-id="2e54b-248">*Showing the new constraint*</span></span>

<a id="Exercise2"></a>
### <a name="exercise-2-deploying-a-web-app-to-staging"></a><span data-ttu-id="2e54b-249">Exercício 2: Implantando um aplicativo Web para preparo</span><span class="sxs-lookup"><span data-stu-id="2e54b-249">Exercise 2: Deploying a Web App to Staging</span></span>

<span data-ttu-id="2e54b-250">Os **aplicativos Web no serviço de Azure app** permitem que você execute a publicação em etapas.</span><span class="sxs-lookup"><span data-stu-id="2e54b-250">**Web Apps in Azure App Service** enables you to perform staged publishing.</span></span> <span data-ttu-id="2e54b-251">A publicação em etapas cria um slot de site de preparo para cada local de produção padrão e permite que você troque esses slots sem tempo de inatividade.</span><span class="sxs-lookup"><span data-stu-id="2e54b-251">Staged publishing creates a staging site slot for each default production site and enables you to swap these slots with no down time.</span></span> <span data-ttu-id="2e54b-252">Isso é realmente útil para validar as alterações antes de liberá-las para o público, integrar incrementalmente o conteúdo do site e reverter se as alterações não estiverem funcionando conforme o esperado.</span><span class="sxs-lookup"><span data-stu-id="2e54b-252">This is really useful to validate changes before releasing to the public, incrementally integrate site content, and roll back if changes are not working as expected.</span></span>

<span data-ttu-id="2e54b-253">Neste exercício, você implantará o aplicativo de **teste de especialista** no ambiente de preparo do seu aplicativo Web usando o controle do código-fonte git.</span><span class="sxs-lookup"><span data-stu-id="2e54b-253">In this exercise, you will deploy the **Geek Quiz** application to the staging environment of your web app using Git source control.</span></span> <span data-ttu-id="2e54b-254">Para fazer isso, você criará o aplicativo Web e provisioná os componentes necessários no portal de gerenciamento, configurará um repositório **git** e enviará por push o código-fonte do aplicativo do computador local para o slot de preparo.</span><span class="sxs-lookup"><span data-stu-id="2e54b-254">To do this, you will create the web app and provision the required components at the management portal, configure a **Git** repository and push the application source code from your local computer to the staging slot.</span></span> <span data-ttu-id="2e54b-255">Você também atualizará seu banco de dados de produção com o **migrações do Code First** criado no exercício anterior.</span><span class="sxs-lookup"><span data-stu-id="2e54b-255">You will also update your production database with the **Code First Migrations** you created in the previous exercise.</span></span> <span data-ttu-id="2e54b-256">Em seguida, você executará o aplicativo nesse ambiente de teste para verificar sua operação.</span><span class="sxs-lookup"><span data-stu-id="2e54b-256">You will then execute the application in this test environment to verify its operation.</span></span> <span data-ttu-id="2e54b-257">Quando estiver satisfeito de estar trabalhando de acordo com suas expectativas, você promoverá o aplicativo para produção.</span><span class="sxs-lookup"><span data-stu-id="2e54b-257">Once you are satisfied that it is working according to your expectations, you will promote the application to production.</span></span>

> [!NOTE]
> <span data-ttu-id="2e54b-258">Para habilitar a publicação em etapas, o aplicativo Web deve estar no **modo padrão**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-258">To enable staged publishing, the web app must be in **Standard mode**.</span></span> <span data-ttu-id="2e54b-259">Observe que os encargos adicionais serão incorridos se você alterar seu aplicativo Web para o modo padrão.</span><span class="sxs-lookup"><span data-stu-id="2e54b-259">Note that additional charges will be incurred if you change your web app to Standard mode.</span></span> <span data-ttu-id="2e54b-260">Para obter mais informações sobre preços, consulte [preços do serviço de aplicativo](https://azure.microsoft.com/pricing/details/app-service/).</span><span class="sxs-lookup"><span data-stu-id="2e54b-260">For more information about pricing, see [App Service Pricing](https://azure.microsoft.com/pricing/details/app-service/).</span></span>

<a id="Ex2Task1"></a>
#### <a name="task-1--creating-a-web-app-in-azure-app-service"></a><span data-ttu-id="2e54b-261">Tarefa 1 – Criando um aplicativo Web no serviço Azure App</span><span class="sxs-lookup"><span data-stu-id="2e54b-261">Task 1 – Creating a Web App in Azure App Service</span></span>

<span data-ttu-id="2e54b-262">Nesta tarefa, você criará um aplicativo Web no **serviço Azure app** no portal de gerenciamento.</span><span class="sxs-lookup"><span data-stu-id="2e54b-262">In this task, you will create a web app in **Azure App Service** from the management portal.</span></span> <span data-ttu-id="2e54b-263">Você também configurará um banco de dados **SQL** para persistir o aplicativo e configurar um repositório git local para o controle do código-fonte.</span><span class="sxs-lookup"><span data-stu-id="2e54b-263">You will also configure a **SQL Database** to persist the application data, and configure a local Git repository for source control.</span></span>

1. <span data-ttu-id="2e54b-264">Acesse o [portal de gerenciamento do Azure](https://manage.windowsazure.com) e entre usando o conta Microsoft associado à sua assinatura.</span><span class="sxs-lookup"><span data-stu-id="2e54b-264">Go to the [Azure management portal](https://manage.windowsazure.com) and sign in using the Microsoft account associated with your subscription.</span></span>

    ![Entre no portal de gerenciamento do Azure](maintainable-azure-websites-managing-change-and-scale/_static/image13.png)

    <span data-ttu-id="2e54b-266">*Entre no portal de gerenciamento do Azure*</span><span class="sxs-lookup"><span data-stu-id="2e54b-266">*Sign in to the Azure management portal*</span></span>
2. <span data-ttu-id="2e54b-267">Clique em **novo** na barra de comandos na parte inferior da página.</span><span class="sxs-lookup"><span data-stu-id="2e54b-267">Click **New** in the command bar at the bottom of the page.</span></span>

    <span data-ttu-id="2e54b-268">![Criando um novo aplicativo Web](maintainable-azure-websites-managing-change-and-scale/_static/image14.png "Criando um novo aplicativo Web")</span><span class="sxs-lookup"><span data-stu-id="2e54b-268">![Creating a new web app](maintainable-azure-websites-managing-change-and-scale/_static/image14.png "Creating a new web app")</span></span>

    <span data-ttu-id="2e54b-269">*Criando um novo aplicativo Web*</span><span class="sxs-lookup"><span data-stu-id="2e54b-269">*Creating a new web app*</span></span>
3. <span data-ttu-id="2e54b-270">Clique em **computação**, **site** e **criação personalizada**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-270">Click **Compute**, **Website** and then **Custom Create**.</span></span>

    <span data-ttu-id="2e54b-271">![Criando um novo aplicativo Web usando a criação personalizada](maintainable-azure-websites-managing-change-and-scale/_static/image15.png "Criando um novo aplicativo Web usando a criação personalizada")</span><span class="sxs-lookup"><span data-stu-id="2e54b-271">![Creating a new web app using Custom Create](maintainable-azure-websites-managing-change-and-scale/_static/image15.png "Creating a new web app using Custom Create")</span></span>

    <span data-ttu-id="2e54b-272">*Criando um novo aplicativo Web usando a criação personalizada*</span><span class="sxs-lookup"><span data-stu-id="2e54b-272">*Creating a new web app using Custom Create*</span></span>
4. <span data-ttu-id="2e54b-273">Na caixa de diálogo **novo site-criação personalizada** , forneça uma **URL** disponível (por exemplo *, especialista em teste*), selecione um local na lista suspensa **região** e selecione **criar um novo banco de dados SQL** na lista suspensa **banco de dados** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-273">In the **New Website - Custom Create** dialog box, provide an available **URL** (e.g. *geek-quiz*), select a location in the **Region** drop-down list, and select **Create a new SQL database** in the **Database** drop-down list.</span></span> <span data-ttu-id="2e54b-274">Por fim, marque a caixa **de seleção publicar do controle do código-fonte** e clique em **Avançar**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-274">Finally, select the **Publish from source control** check box and click **Next**.</span></span>

    ![Personalizando o novo aplicativo Web](maintainable-azure-websites-managing-change-and-scale/_static/image16.png)

    <span data-ttu-id="2e54b-276">*Personalizando o novo aplicativo Web*</span><span class="sxs-lookup"><span data-stu-id="2e54b-276">*Customizing the new web app*</span></span>
5. <span data-ttu-id="2e54b-277">Especifique as seguintes informações para as configurações de banco de dados:</span><span class="sxs-lookup"><span data-stu-id="2e54b-277">Specify the following information for the database settings:</span></span>

   - <span data-ttu-id="2e54b-278">Na caixa de texto **nome** , insira um nome de banco de dados (por exemplo, *geekquiz\_DB*)</span><span class="sxs-lookup"><span data-stu-id="2e54b-278">In the **Name** text box, enter a database name (e.g. *geekquiz\_db*)</span></span>
   - <span data-ttu-id="2e54b-279">Na lista **suspensa** servidor, selecione **novo servidor de banco de dados SQL**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-279">In the Server **drop-down** list, select **New SQL database server**.</span></span> <span data-ttu-id="2e54b-280">Como alternativa, você pode selecionar um servidor existente.</span><span class="sxs-lookup"><span data-stu-id="2e54b-280">Alternatively, you can select an existing server.</span></span>
   - <span data-ttu-id="2e54b-281">Nas caixas **nome de usuário** e **senha** do banco de dados, insira o nome de usuário e a senha do administrador para o servidor do banco de dados SQL.</span><span class="sxs-lookup"><span data-stu-id="2e54b-281">In the **Database username** and **Database password** boxes, enter the administrator username and password for the SQL database server.</span></span> <span data-ttu-id="2e54b-282">Se você selecionar um servidor que já criou, a senha será solicitada.</span><span class="sxs-lookup"><span data-stu-id="2e54b-282">If you select a server you have already created, you will be prompted for the password.</span></span>

     ![Especificando as configurações do banco de dados](maintainable-azure-websites-managing-change-and-scale/_static/image17.png)

     <span data-ttu-id="2e54b-284">*Especificando as configurações do banco de dados*</span><span class="sxs-lookup"><span data-stu-id="2e54b-284">*Specifying the database settings*</span></span>
6. <span data-ttu-id="2e54b-285">Clique em **Avançar** para continuar.</span><span class="sxs-lookup"><span data-stu-id="2e54b-285">Click **Next** to continue.</span></span>
7. <span data-ttu-id="2e54b-286">Selecione **repositório git local** para o controle do código-fonte a ser usado e clique em **Avançar**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-286">Select **Local Git repository** for the source control to use and click **Next**.</span></span>

    > [!NOTE]
    > <span data-ttu-id="2e54b-287">Você pode ser solicitado a fornecer as credenciais de implantação (um nome de usuário e uma senha).</span><span class="sxs-lookup"><span data-stu-id="2e54b-287">You may be prompted for the deployment credentials (a username and password).</span></span>

    ![Criando o repositório git](maintainable-azure-websites-managing-change-and-scale/_static/image18.png)

    <span data-ttu-id="2e54b-289">*Criando o repositório git*</span><span class="sxs-lookup"><span data-stu-id="2e54b-289">*Creating the Git repository*</span></span>
8. <span data-ttu-id="2e54b-290">Aguarde até que o novo aplicativo Web seja criado.</span><span class="sxs-lookup"><span data-stu-id="2e54b-290">Wait until the new web app is created.</span></span>

    > [!NOTE]
    > <span data-ttu-id="2e54b-291">Por padrão, o Azure fornece domínios em *azurewebsites.net* , mas também oferece a possibilidade de definir domínios personalizados usando o portal de gerenciamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="2e54b-291">By default, Azure provides domains at *azurewebsites.net* but also gives you the possibility to set custom domains using the Azure management portal.</span></span> <span data-ttu-id="2e54b-292">No entanto, você só poderá gerenciar domínios personalizados se estiver usando determinados modos de serviço de Azure App.</span><span class="sxs-lookup"><span data-stu-id="2e54b-292">However, you can only manage custom domains if you are using certain Azure App Service modes.</span></span>
    >
    > <span data-ttu-id="2e54b-293">O serviço de Azure App está disponível nas edições gratuita, compartilhada, básica, Standard e Premium.</span><span class="sxs-lookup"><span data-stu-id="2e54b-293">Azure App Service is available in Free, Shared, Basic, Standard, and Premium editions.</span></span> <span data-ttu-id="2e54b-294">No modo gratuito e compartilhado, todos os aplicativos Web são executados em um ambiente multilocatário e têm cotas de uso de CPU, memória e rede.</span><span class="sxs-lookup"><span data-stu-id="2e54b-294">In Free and Shared mode, all web apps run in a multi-tenant environment and have quotas for CPU, Memory, and Network usage.</span></span> <span data-ttu-id="2e54b-295">O número máximo de aplicativos gratuitos pode variar com seu plano.</span><span class="sxs-lookup"><span data-stu-id="2e54b-295">The maximum number of free apps may vary with your plan.</span></span> <span data-ttu-id="2e54b-296">No modo padrão, você escolhe quais aplicativos são executados em máquinas virtuais dedicadas que correspondem aos recursos de computação padrão do Azure.</span><span class="sxs-lookup"><span data-stu-id="2e54b-296">In Standard mode, you choose which apps run on dedicated virtual machines that correspond to the standard Azure compute resources.</span></span> <span data-ttu-id="2e54b-297">Você pode encontrar a configuração do modo de aplicativo Web no menu **dimensionar** do seu aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="2e54b-297">You can find the web app mode configuration in the **Scale** menu of your web app.</span></span>
    >
    > <span data-ttu-id="2e54b-298">![Modos de serviço Azure App](maintainable-azure-websites-managing-change-and-scale/_static/image19.png "Modos de serviço Azure App")</span><span class="sxs-lookup"><span data-stu-id="2e54b-298">![Azure App Service Modes](maintainable-azure-websites-managing-change-and-scale/_static/image19.png "Azure App Service Modes")</span></span>
    >
    > <span data-ttu-id="2e54b-299">Se você estiver usando o modo **compartilhado** ou **padrão** , poderá gerenciar domínios personalizados para seu aplicativo Web acessando o menu **Configurar** do seu aplicativo e clicando em **gerenciar domínios** em *nomes de domínio*.</span><span class="sxs-lookup"><span data-stu-id="2e54b-299">If you are using **Shared** or **Standard** mode, you will be able to manage custom domains for your web app by going to your app's **Configure** menu and clicking **Manage Domains** under *domain names*.</span></span>
    >
    > <span data-ttu-id="2e54b-300">![Gerenciar domínios](maintainable-azure-websites-managing-change-and-scale/_static/image20.png "Gerenciar domínios")</span><span class="sxs-lookup"><span data-stu-id="2e54b-300">![Manage Domains](maintainable-azure-websites-managing-change-and-scale/_static/image20.png "Manage Domains")</span></span>
    >
    > <span data-ttu-id="2e54b-301">![Gerenciar domínios personalizados](maintainable-azure-websites-managing-change-and-scale/_static/image21.png "Gerenciar domínios personalizados")</span><span class="sxs-lookup"><span data-stu-id="2e54b-301">![Manage Custom Domains](maintainable-azure-websites-managing-change-and-scale/_static/image21.png "Manage Custom Domains")</span></span>
9. <span data-ttu-id="2e54b-302">Depois que o aplicativo Web for criado, clique no link sob a coluna **URL** para verificar se o novo aplicativo Web está em execução.</span><span class="sxs-lookup"><span data-stu-id="2e54b-302">Once the web app is created, click the link under the **URL** column to check that the new web app is running.</span></span>

    ![Navegando para o novo aplicativo Web](maintainable-azure-websites-managing-change-and-scale/_static/image22.png)

    <span data-ttu-id="2e54b-304">*Navegando para o novo aplicativo Web*</span><span class="sxs-lookup"><span data-stu-id="2e54b-304">*Browsing to the new web app*</span></span>

    ![aplicativo Web em execução](maintainable-azure-websites-managing-change-and-scale/_static/image23.png)

    <span data-ttu-id="2e54b-306">*aplicativo Web em execução*</span><span class="sxs-lookup"><span data-stu-id="2e54b-306">*web app running*</span></span>

<a id="Ex2Task2"></a>
#### <a name="task-2--creating-the-production-sql-database"></a><span data-ttu-id="2e54b-307">Tarefa 2 – Criando o banco de dados SQL de produção</span><span class="sxs-lookup"><span data-stu-id="2e54b-307">Task 2 – Creating the Production SQL Database</span></span>

<span data-ttu-id="2e54b-308">Nesta tarefa, você usará o **migrações do Entity Framework Code First** para criar o banco de dados destinado à instância do **banco de dados SQL do Azure** criada na tarefa anterior.</span><span class="sxs-lookup"><span data-stu-id="2e54b-308">In this task, you will use the **Entity Framework Code First Migrations** to create the database targeting the **Azure SQL Database** instance you created in the previous task.</span></span>

1. <span data-ttu-id="2e54b-309">No Portal de Gerenciamento, navegue até o aplicativo Web que você criou na tarefa anterior e vá para seu **painel**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-309">In the Management Portal, navigate to the web app you created in the previous task and go to its **Dashboard**.</span></span>
2. <span data-ttu-id="2e54b-310">Na página **painel** , clique no link **exibir cadeias de conexão** na seção **visão rápida** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-310">In the **Dashboard** page, click **View connection strings** link under the **quick glance** section.</span></span>

    <span data-ttu-id="2e54b-311">![Exibir cadeias de conexão](maintainable-azure-websites-managing-change-and-scale/_static/image24.png "Exibir cadeias de conexão")</span><span class="sxs-lookup"><span data-stu-id="2e54b-311">![View connection strings](maintainable-azure-websites-managing-change-and-scale/_static/image24.png "View connection strings")</span></span>

    <span data-ttu-id="2e54b-312">*Exibir cadeias de conexão*</span><span class="sxs-lookup"><span data-stu-id="2e54b-312">*View connection strings*</span></span>
3. <span data-ttu-id="2e54b-313">Copie o valor da **cadeia de conexão** e feche a caixa de diálogo.</span><span class="sxs-lookup"><span data-stu-id="2e54b-313">Copy the **connection string** value and close the dialog box.</span></span>

    <span data-ttu-id="2e54b-314">![Cadeia de conexão no Azure Portal de Gerenciamento](maintainable-azure-websites-managing-change-and-scale/_static/image25.png "Cadeia de conexão no Azure Portal de Gerenciamento")</span><span class="sxs-lookup"><span data-stu-id="2e54b-314">![Connection String in Azure Management Portal](maintainable-azure-websites-managing-change-and-scale/_static/image25.png "Connection String in Azure Management Portal")</span></span>

    <span data-ttu-id="2e54b-315">*Cadeia de conexão no Azure Portal de Gerenciamento*</span><span class="sxs-lookup"><span data-stu-id="2e54b-315">*Connection String in Azure Management Portal*</span></span>
4. <span data-ttu-id="2e54b-316">Clique em **bancos de dados SQL** para ver a lista de bancos de dados SQL no Azure</span><span class="sxs-lookup"><span data-stu-id="2e54b-316">Click **SQL Databases** to see the list of SQL databases in Azure</span></span>

    <span data-ttu-id="2e54b-317">![Menu do banco de dados SQL](maintainable-azure-websites-managing-change-and-scale/_static/image26.png "Menu do banco de dados SQL")</span><span class="sxs-lookup"><span data-stu-id="2e54b-317">![SQL Database menu](maintainable-azure-websites-managing-change-and-scale/_static/image26.png "SQL Database menu")</span></span>

    <span data-ttu-id="2e54b-318">*Menu do banco de dados SQL*</span><span class="sxs-lookup"><span data-stu-id="2e54b-318">*SQL Database menu*</span></span>
5. <span data-ttu-id="2e54b-319">Localize o banco de dados que você criou na tarefa anterior e clique no servidor.</span><span class="sxs-lookup"><span data-stu-id="2e54b-319">Locate the database you created in the previous task and click on the Server.</span></span>

    <span data-ttu-id="2e54b-320">![Servidor do banco de dados SQL](maintainable-azure-websites-managing-change-and-scale/_static/image27.png "Servidor de banco de dados SQL")</span><span class="sxs-lookup"><span data-stu-id="2e54b-320">![SQL Database server](maintainable-azure-websites-managing-change-and-scale/_static/image27.png "SQL Database server")</span></span>

    <span data-ttu-id="2e54b-321">*Servidor do banco de dados SQL*</span><span class="sxs-lookup"><span data-stu-id="2e54b-321">*SQL Database server*</span></span>
6. <span data-ttu-id="2e54b-322">Na página **início rápido** do servidor, clique em **Configurar**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-322">In the **Quick Start** page of the server, click on **Configure**.</span></span>

    <span data-ttu-id="2e54b-323">![Configurar menu](maintainable-azure-websites-managing-change-and-scale/_static/image28.png "Configurar menu")</span><span class="sxs-lookup"><span data-stu-id="2e54b-323">![Configure menu](maintainable-azure-websites-managing-change-and-scale/_static/image28.png "Configure menu")</span></span>

    <span data-ttu-id="2e54b-324">*Configurar menu*</span><span class="sxs-lookup"><span data-stu-id="2e54b-324">*Configure menu*</span></span>
7. <span data-ttu-id="2e54b-325">Na seção **endereços IP permitidos** , clique em **Adicionar ao link endereços IP permitidos** para permitir que seu IP se conecte ao servidor do banco de dados SQL.</span><span class="sxs-lookup"><span data-stu-id="2e54b-325">In the **Allowed IP addresses** section, click on **Add to the allowed IP addresses** link to enable your IP to connect to the SQL Database server.</span></span>

    <span data-ttu-id="2e54b-326">![Endereços IP permitidos](maintainable-azure-websites-managing-change-and-scale/_static/image29.png "Endereços IP permitidos")</span><span class="sxs-lookup"><span data-stu-id="2e54b-326">![Allowed IP addresses](maintainable-azure-websites-managing-change-and-scale/_static/image29.png "Allowed IP addresses")</span></span>

    <span data-ttu-id="2e54b-327">*Endereços IP permitidos*</span><span class="sxs-lookup"><span data-stu-id="2e54b-327">*Allowed IP addresses*</span></span>
8. <span data-ttu-id="2e54b-328">Clique em **Salvar** na parte inferior da página para concluir a etapa.</span><span class="sxs-lookup"><span data-stu-id="2e54b-328">Click **Save** at the bottom of the page to complete the step.</span></span>
9. <span data-ttu-id="2e54b-329">Volte para o Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="2e54b-329">Switch back to Visual Studio.</span></span>
10. <span data-ttu-id="2e54b-330">No **console do Gerenciador de pacotes**, execute o seguinte comando substituindo o espaço reservado *[Your-Connection-String]* pela cadeia de conexão que você copiou do Azure</span><span class="sxs-lookup"><span data-stu-id="2e54b-330">In the **Package Manager Console**, execute the following command replacing *[YOUR-CONNECTION-STRING]* placeholder with the connection string you copied from Azure</span></span>

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample10.ps1)]

    <span data-ttu-id="2e54b-331">![Atualizar banco de dados destinado ao banco de dados SQL do Windows Azure](maintainable-azure-websites-managing-change-and-scale/_static/image30.png "Atualizar banco de dados destinado ao banco de dados SQL do Windows Azure")</span><span class="sxs-lookup"><span data-stu-id="2e54b-331">![Update database targeting Windows Azure SQL Database](maintainable-azure-websites-managing-change-and-scale/_static/image30.png "Update database targeting Windows Azure SQL Database")</span></span>

    <span data-ttu-id="2e54b-332">*Atualizar banco de dados de destino do banco de dados SQL*</span><span class="sxs-lookup"><span data-stu-id="2e54b-332">*Update database targeting Azure SQL Database*</span></span>

<a id="Ex2Task3"></a>
#### <a name="task-3--deploying-geek-quiz-to-staging-using-git"></a><span data-ttu-id="2e54b-333">Tarefa 3 – implantando o teste de especialista em preparo usando o Git</span><span class="sxs-lookup"><span data-stu-id="2e54b-333">Task 3 – Deploying Geek Quiz to Staging Using Git</span></span>

<span data-ttu-id="2e54b-334">Nesta tarefa, você habilitará a publicação em etapas em seu aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="2e54b-334">In this task, you will enable staged publishing in your web app.</span></span> <span data-ttu-id="2e54b-335">Em seguida, você usará o Git para publicar o aplicativo Geek Quiz diretamente do seu computador local ao ambiente de preparo do aplicativo web.</span><span class="sxs-lookup"><span data-stu-id="2e54b-335">Then, you will use Git to publish the Geek Quiz application directly from your local computer to the staging environment of your web app.</span></span>

1. <span data-ttu-id="2e54b-336">Volte para o portal e clique no nome do aplicativo Web na coluna **nome** para exibir as páginas de gerenciamento.</span><span class="sxs-lookup"><span data-stu-id="2e54b-336">Go back to the portal and click the name of the web app under the **Name** column to display the management pages.</span></span>

    ![Abrindo as páginas de gerenciamento do aplicativo Web](maintainable-azure-websites-managing-change-and-scale/_static/image31.png)

    <span data-ttu-id="2e54b-338">*Abrindo as páginas de gerenciamento do aplicativo Web*</span><span class="sxs-lookup"><span data-stu-id="2e54b-338">*Opening the web app management pages*</span></span>
2. <span data-ttu-id="2e54b-339">Navegue até a página **escala** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-339">Navigate to the **Scale** page.</span></span> <span data-ttu-id="2e54b-340">Na seção **geral** , selecione **padrão** para a configuração e clique em **salvar** na barra de comandos.</span><span class="sxs-lookup"><span data-stu-id="2e54b-340">Under the **general** section, select **Standard** for the configuration and click **Save** in the command bar.</span></span>

    > [!NOTE]
    > <span data-ttu-id="2e54b-341">Para executar todos os aplicativos Web na região atual e na assinatura no modo **padrão** , deixe a caixa de seleção **selecionar tudo** marcada na configuração **escolher sites** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-341">To run all web apps in the current region and subscription in **Standard** mode, leave the **Select All** check box selected in the **Choose Sites** configuration.</span></span> <span data-ttu-id="2e54b-342">Caso contrário, desmarque a caixa de seleção **selecionar tudo** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-342">Otherwise, clear the **Select All** check box.</span></span>

    <span data-ttu-id="2e54b-343">![Atualizando o aplicativo Web para o modo padrão](maintainable-azure-websites-managing-change-and-scale/_static/image32.png "Atualizando o aplicativo Web para o modo padrão")</span><span class="sxs-lookup"><span data-stu-id="2e54b-343">![Upgrading the web app to Standard mode](maintainable-azure-websites-managing-change-and-scale/_static/image32.png "Upgrading the web app to Standard mode")</span></span>

    <span data-ttu-id="2e54b-344">*Atualizando o aplicativo Web para o modo padrão*</span><span class="sxs-lookup"><span data-stu-id="2e54b-344">*Upgrading the Web App to Standard mode*</span></span>
3. <span data-ttu-id="2e54b-345">Clique em **Sim** para confirmar as alterações.</span><span class="sxs-lookup"><span data-stu-id="2e54b-345">Click **Yes** to confirm the changes.</span></span>

    <span data-ttu-id="2e54b-346">![Confirmando a alteração no modo padrão](maintainable-azure-websites-managing-change-and-scale/_static/image33.png "Continuando com a alteração do modo de aplicativo Web")</span><span class="sxs-lookup"><span data-stu-id="2e54b-346">![Confirming the change to Standard mode](maintainable-azure-websites-managing-change-and-scale/_static/image33.png "Continuing with the changing of the web app mode")</span></span>

    <span data-ttu-id="2e54b-347">*Confirmando a alteração no modo padrão*</span><span class="sxs-lookup"><span data-stu-id="2e54b-347">*Confirming the change to Standard mode*</span></span>
4. <span data-ttu-id="2e54b-348">Vá para a página **painel** e clique em **habilitar publicação em etapas** na seção **visão rápida** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-348">Go to the **Dashboard** page and click **Enable staged publishing** under the **quick glance** section.</span></span>

    <span data-ttu-id="2e54b-349">![Habilitando a publicação em etapas](maintainable-azure-websites-managing-change-and-scale/_static/image34.png "Habilitando a publicação em etapas")</span><span class="sxs-lookup"><span data-stu-id="2e54b-349">![Enabling staged publishing](maintainable-azure-websites-managing-change-and-scale/_static/image34.png "Enabling staged publishing")</span></span>

    <span data-ttu-id="2e54b-350">*Habilitando a publicação em etapas*</span><span class="sxs-lookup"><span data-stu-id="2e54b-350">*Enabling staged publishing*</span></span>
5. <span data-ttu-id="2e54b-351">Clique em **Sim** para habilitar a publicação em etapas.</span><span class="sxs-lookup"><span data-stu-id="2e54b-351">Click **Yes** to enable staged publishing.</span></span>

    <span data-ttu-id="2e54b-352">![Confirmando a publicação em etapas](maintainable-azure-websites-managing-change-and-scale/_static/image35.png "Clicando em Sim para habilitar a publicação em etapas")</span><span class="sxs-lookup"><span data-stu-id="2e54b-352">![Confirming staged publishing](maintainable-azure-websites-managing-change-and-scale/_static/image35.png "Clicking Yes to enable staged publishing")</span></span>

    <span data-ttu-id="2e54b-353">*Confirmando a publicação em etapas*</span><span class="sxs-lookup"><span data-stu-id="2e54b-353">*Confirming staged publishing*</span></span>
6. <span data-ttu-id="2e54b-354">Na lista de aplicativos Web, expanda a marca à esquerda do nome do aplicativo Web para exibir o slot do site de preparo.</span><span class="sxs-lookup"><span data-stu-id="2e54b-354">In the list of web apps, expand the mark to the left of your web app name to display the staging site slot.</span></span> <span data-ttu-id="2e54b-355">Ele tem o nome do seu aplicativo Web seguido por ***(preparo)***.</span><span class="sxs-lookup"><span data-stu-id="2e54b-355">It has the name of your web app followed by ***(staging)***.</span></span> <span data-ttu-id="2e54b-356">Clique no site de preparo para ir para a página de gerenciamento.</span><span class="sxs-lookup"><span data-stu-id="2e54b-356">Click the staging site to go to the management page.</span></span>

    <span data-ttu-id="2e54b-357">![Navegando para o aplicativo Web de preparo](maintainable-azure-websites-managing-change-and-scale/_static/image36.png "Navegando para o aplicativo Web de preparo")</span><span class="sxs-lookup"><span data-stu-id="2e54b-357">![Navigating to the staging web app](maintainable-azure-websites-managing-change-and-scale/_static/image36.png "Navigating to the staging web app")</span></span>

    <span data-ttu-id="2e54b-358">*Navegando para o aplicativo de preparo*</span><span class="sxs-lookup"><span data-stu-id="2e54b-358">*Navigating to the staging app*</span></span>
7. <span data-ttu-id="2e54b-359">Observe que a página de gerenciamento do é semelhante a qualquer outra página de gerenciamento do aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="2e54b-359">Notice that he management page looks like any other web app's management page.</span></span> <span data-ttu-id="2e54b-360">Navegue até a página **implantações** e copie o valor da **URL do git** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-360">Navigate to the **Deployments** page and copy the **Git URL** value.</span></span> <span data-ttu-id="2e54b-361">Você o usará posteriormente neste exercício.</span><span class="sxs-lookup"><span data-stu-id="2e54b-361">You will use it later in this exercise.</span></span>

    ![Copiando o valor da URL do git](maintainable-azure-websites-managing-change-and-scale/_static/image37.png)

    <span data-ttu-id="2e54b-363">*Copiando o valor da URL do git*</span><span class="sxs-lookup"><span data-stu-id="2e54b-363">*Copying the Git URL value*</span></span>
8. <span data-ttu-id="2e54b-364">Abra um novo console do **git bash** e execute os comandos a seguir.</span><span class="sxs-lookup"><span data-stu-id="2e54b-364">Open a new **Git Bash** console and execute the following commands.</span></span> <span data-ttu-id="2e54b-365">Atualize o espaço reservado *[Your-Application-Path]* com o caminho para a solução **GeekQuiz** , localizada na pasta **Source\Ex1-DeployingWebSiteToStaging\Begin** deste laboratório.</span><span class="sxs-lookup"><span data-stu-id="2e54b-365">Update the *[YOUR-APPLICATION-PATH]* placeholder with the path to the **GeekQuiz** solution, located in the **Source\Ex1-DeployingWebSiteToStaging\Begin** folder of this lab.</span></span>

    [!code-console[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample11.cmd)]

    ![Inicialização do git e primeira confirmação](maintainable-azure-websites-managing-change-and-scale/_static/image38.png)

    <span data-ttu-id="2e54b-367">*Inicialização do git e primeira confirmação*</span><span class="sxs-lookup"><span data-stu-id="2e54b-367">*Git initialization and first commit*</span></span>
9. <span data-ttu-id="2e54b-368">Execute o comando a seguir para enviar por push seu aplicativo Web para o repositório **git** remoto.</span><span class="sxs-lookup"><span data-stu-id="2e54b-368">Run the following command to push your web app to the remote **Git** repository.</span></span> <span data-ttu-id="2e54b-369">Substitua o espaço reservado pela URL obtida do portal de gerenciamento.</span><span class="sxs-lookup"><span data-stu-id="2e54b-369">Replace the placeholder with the URL you obtained from the management portal.</span></span> <span data-ttu-id="2e54b-370">Você será solicitado a fornecer sua senha de implantação.</span><span class="sxs-lookup"><span data-stu-id="2e54b-370">You will be prompted for your deployment password.</span></span>

    [!code-console[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample12.cmd)]

    ![Enviando por push para o Windows Azure](maintainable-azure-websites-managing-change-and-scale/_static/image39.png)

    <span data-ttu-id="2e54b-372">*Enviando por push para o Azure*</span><span class="sxs-lookup"><span data-stu-id="2e54b-372">*Pushing to Azure*</span></span>

    > [!NOTE]
    > <span data-ttu-id="2e54b-373">Ao implantar conteúdo no host de FTP ou repositório GIT de um aplicativo Web, você deve autenticar usando as **credenciais de implantação** que você criou nas páginas de gerenciamento de **início rápido** ou de **painel** do aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="2e54b-373">When you deploy content to the FTP host or GIT repository of a web app, you must authenticate using the **deployment credentials** that you created from the web app's **Quick Start** or **Dashboard** management pages.</span></span> <span data-ttu-id="2e54b-374">Se você não souber suas credenciais de implantação, poderá redefini-las facilmente usando o portal de gerenciamento.</span><span class="sxs-lookup"><span data-stu-id="2e54b-374">If you do not know your deployment credentials you can easily reset them using the management portal.</span></span> <span data-ttu-id="2e54b-375">Abra a página **painel** do aplicativo Web e clique no link **redefinir suas credenciais de implantação** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-375">Open the web app **Dashboard** page and click the **Reset your deployment credentials** link.</span></span> <span data-ttu-id="2e54b-376">Forneça uma nova senha e clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-376">Provide a new password and click **OK**.</span></span> <span data-ttu-id="2e54b-377">As credenciais de implantação são válidas para uso com todos os aplicativos Web associados à sua assinatura.</span><span class="sxs-lookup"><span data-stu-id="2e54b-377">Deployment credentials are valid for use with all web apps associated with your subscription.</span></span>
10. <span data-ttu-id="2e54b-378">Para verificar se o aplicativo Web foi enviado por push com êxito para o Azure, volte para o portal de gerenciamento e clique em **sites**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-378">In order to verify the web app was successfully pushed to Azure, go back to the management portal and click **Websites**.</span></span>
11. <span data-ttu-id="2e54b-379">Localize seu aplicativo Web e expanda a entrada para exibir o slot do site de preparo.</span><span class="sxs-lookup"><span data-stu-id="2e54b-379">Locate your web app and expand the entry to display the staging site slot.</span></span> <span data-ttu-id="2e54b-380">Clique em seu **nome** para ir para a página de gerenciamento.</span><span class="sxs-lookup"><span data-stu-id="2e54b-380">Click its **Name** to go to the management page.</span></span>
12. <span data-ttu-id="2e54b-381">Clique em **implantações** para ver o **histórico de implantação**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-381">Click **Deployments** to see the **deployment history**.</span></span> <span data-ttu-id="2e54b-382">Verifique se há uma **implantação ativa** com sua *&quot;de confirmação inicial&quot;* .</span><span class="sxs-lookup"><span data-stu-id="2e54b-382">Verify that there is an **Active Deployment** with your *&quot;Initial Commit&quot;*.</span></span>

    ![Implantação ativa](maintainable-azure-websites-managing-change-and-scale/_static/image40.png)

    <span data-ttu-id="2e54b-384">*Implantação ativa*</span><span class="sxs-lookup"><span data-stu-id="2e54b-384">*Active deployment*</span></span>
13. <span data-ttu-id="2e54b-385">Por fim, clique em **procurar** na barra de comandos para ir para o aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="2e54b-385">Finally, click **Browse** in the command bar to go to the web app.</span></span>

    ![Procurar aplicativo Web](maintainable-azure-websites-managing-change-and-scale/_static/image41.png)

    <span data-ttu-id="2e54b-387">*Procurar aplicativo Web*</span><span class="sxs-lookup"><span data-stu-id="2e54b-387">*Browse web app*</span></span>
14. <span data-ttu-id="2e54b-388">Se o aplicativo for implantado com êxito, você verá a página de logon do teste de especialista.</span><span class="sxs-lookup"><span data-stu-id="2e54b-388">If the application is successfully deployed, you will see the Geek Quiz login page.</span></span>

    > [!NOTE]
    > <span data-ttu-id="2e54b-389">A URL de endereço do aplicativo implantado contém o nome do seu aplicativo Web seguido por *-preparo*.</span><span class="sxs-lookup"><span data-stu-id="2e54b-389">The address URL of the deployed application contains the name of your web app followed by *-staging*.</span></span>

    ![Aplicativo em execução no ambiente de preparo](maintainable-azure-websites-managing-change-and-scale/_static/image42.png)

    <span data-ttu-id="2e54b-391">*Aplicativo em execução no ambiente de preparo*</span><span class="sxs-lookup"><span data-stu-id="2e54b-391">*Application running in the staging environment*</span></span>
15. <span data-ttu-id="2e54b-392">Se você quiser explorar o aplicativo, clique em **registrar** para registrar um novo usuário.</span><span class="sxs-lookup"><span data-stu-id="2e54b-392">If you wish to explore the application, click **Register** to register a new user.</span></span> <span data-ttu-id="2e54b-393">Preencha os detalhes da conta inserindo um nome de usuário, endereço de email e senha.</span><span class="sxs-lookup"><span data-stu-id="2e54b-393">Complete the account details by entering a user name, email address and password.</span></span> <span data-ttu-id="2e54b-394">Em seguida, o aplicativo mostra a primeira pergunta do teste.</span><span class="sxs-lookup"><span data-stu-id="2e54b-394">Next, the application shows the first question of the quiz.</span></span> <span data-ttu-id="2e54b-395">Responda a algumas perguntas para verificar se ele está funcionando conforme o esperado.</span><span class="sxs-lookup"><span data-stu-id="2e54b-395">Answer a few questions to make sure it is working as expected.</span></span>

    ![Aplicativo pronto para ser usado](maintainable-azure-websites-managing-change-and-scale/_static/image43.png)

    <span data-ttu-id="2e54b-397">*Aplicativo pronto para ser usado*</span><span class="sxs-lookup"><span data-stu-id="2e54b-397">*Application ready to be used*</span></span>

<a id="Ex2Task4"></a>
#### <a name="task-4--promoting-the-web-app-to-production"></a><span data-ttu-id="2e54b-398">Tarefa 4 – promovendo o aplicativo Web para produção</span><span class="sxs-lookup"><span data-stu-id="2e54b-398">Task 4 – Promoting the Web App to Production</span></span>

<span data-ttu-id="2e54b-399">Agora que você verificou que o aplicativo Web está funcionando corretamente no ambiente de preparo, você está pronto para promovê-lo para produção.</span><span class="sxs-lookup"><span data-stu-id="2e54b-399">Now that you have verified that the web app is working correctly in the staging environment, you are ready to promote it to production.</span></span> <span data-ttu-id="2e54b-400">Nesta tarefa, você alternará o slot do site de preparo com o slot do local de produção.</span><span class="sxs-lookup"><span data-stu-id="2e54b-400">In this task, you will swap the staging site slot with the production site slot.</span></span>

1. <span data-ttu-id="2e54b-401">Volte para o portal de gerenciamento e selecione o slot do site de preparo.</span><span class="sxs-lookup"><span data-stu-id="2e54b-401">Go back to the management portal and select the staging site slot.</span></span> <span data-ttu-id="2e54b-402">Clique em **alternar** na barra de comandos.</span><span class="sxs-lookup"><span data-stu-id="2e54b-402">Click **Swap** in the command bar.</span></span>

    ![Alternar para produção](maintainable-azure-websites-managing-change-and-scale/_static/image44.png)

    <span data-ttu-id="2e54b-404">*Alternar para produção*</span><span class="sxs-lookup"><span data-stu-id="2e54b-404">*Swap to production*</span></span>
2. <span data-ttu-id="2e54b-405">Clique em **Sim** na caixa de diálogo de confirmação para prosseguir com a operação de permuta.</span><span class="sxs-lookup"><span data-stu-id="2e54b-405">Click **Yes** in the confirmation dialog box to proceed with the swap operation.</span></span> <span data-ttu-id="2e54b-406">O Azure alternará imediatamente o conteúdo do site de produção com o conteúdo do site de preparo.</span><span class="sxs-lookup"><span data-stu-id="2e54b-406">Azure will immediately swap the content of the production site with the content of the staging site.</span></span>

    > [!NOTE]
    > <span data-ttu-id="2e54b-407">Algumas configurações da versão em etapas serão automaticamente copiadas para a versão de produção (por exemplo, substituições de cadeia de conexão, mapeamentos de manipulador, etc.), mas outras configurações não serão alteradas (por exemplo, pontos de extremidade DNS, associações SSL, etc.).</span><span class="sxs-lookup"><span data-stu-id="2e54b-407">Some settings from the staged version will automatically be copied to the production version (e.g. connection string overrides, handler mappings, etc.) but other settings will not change (e.g. DNS endpoints, SSL bindings, etc.).</span></span>

    ![Confirmando a operação de permuta](maintainable-azure-websites-managing-change-and-scale/_static/image45.png)

    <span data-ttu-id="2e54b-409">*Confirmando a operação de permuta*</span><span class="sxs-lookup"><span data-stu-id="2e54b-409">*Confirming swap operation*</span></span>
3. <span data-ttu-id="2e54b-410">Quando a permuta for concluída, selecione o slot de produção e clique em **procurar** na barra de comandos para abrir o site de produção.</span><span class="sxs-lookup"><span data-stu-id="2e54b-410">Once the swap is complete, select the production slot and click **Browse** in the command bar to open the production site.</span></span> <span data-ttu-id="2e54b-411">Observe a URL na barra de endereços.</span><span class="sxs-lookup"><span data-stu-id="2e54b-411">Notice the URL in the address bar.</span></span>

    > [!NOTE]
    > <span data-ttu-id="2e54b-412">Talvez seja necessário atualizar o navegador para limpar o cache.</span><span class="sxs-lookup"><span data-stu-id="2e54b-412">You might need to refresh your browser to clear cache.</span></span> <span data-ttu-id="2e54b-413">No Internet Explorer, você pode fazer isso pressionando **Ctrl + R**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-413">In Internet Explorer, you can do this by pressing **CTRL+R**.</span></span>

    ![Aplicativo Web em execução no ambiente de produção](maintainable-azure-websites-managing-change-and-scale/_static/image46.png)
4. <span data-ttu-id="2e54b-415">No console do **GitBash** , atualize a URL remota para o repositório git local para o slot de produção de destino.</span><span class="sxs-lookup"><span data-stu-id="2e54b-415">In the **GitBash** console, update the remote URL for the local Git repository to target the production slot.</span></span> <span data-ttu-id="2e54b-416">Para fazer isso, execute o comando a seguir substituindo os espaços reservados pelo seu nome de usuário de implantação e o nome do seu aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="2e54b-416">To do this, run the following command replacing the placeholders with your deployment username and the name of your web app.</span></span>

    > [!NOTE]
    > <span data-ttu-id="2e54b-417">Nos exercícios a seguir, você enviará por push as alterações para o local de produção em vez de preparo apenas para a simplicidade do laboratório.</span><span class="sxs-lookup"><span data-stu-id="2e54b-417">In the following exercises, you will push changes to the production site instead of staging just for the simplicity of the lab.</span></span> <span data-ttu-id="2e54b-418">Em um cenário do mundo real, é recomendável verificar as alterações no ambiente de preparo antes de promover para produção.</span><span class="sxs-lookup"><span data-stu-id="2e54b-418">In a real-world scenario, it is recommended to verify the changes in the staging environment before promoting to production.</span></span>

    [!code-console[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample13.cmd)]

<a id="Exercise3"></a>
### <a name="exercise-3-performing-deployment-rollback-in-production"></a><span data-ttu-id="2e54b-419">Exercício 3: executando a reversão de implantação na produção</span><span class="sxs-lookup"><span data-stu-id="2e54b-419">Exercise 3: Performing Deployment Rollback in Production</span></span>

<span data-ttu-id="2e54b-420">Há cenários em que você não tem um slot de preparo para executar troca automática entre preparo e produção, por exemplo, se você estiver trabalhando com o modo **livre** ou **compartilhado** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-420">There are scenarios where you do not have a staging slot to perform hot swap between staging and production, for example, if you are working with **Free** or **Shared** mode.</span></span> <span data-ttu-id="2e54b-421">Nesses cenários, você deve testar seu aplicativo em um ambiente de teste, seja localmente ou em um site remoto, antes de implantar na produção.</span><span class="sxs-lookup"><span data-stu-id="2e54b-421">In those scenarios, you should test your application in a testing environment –either locally or in a remote site– before deploying to production.</span></span> <span data-ttu-id="2e54b-422">No entanto, é possível que um problema não detectado durante a fase de teste possa surgir no local de produção.</span><span class="sxs-lookup"><span data-stu-id="2e54b-422">However, it is possible that an issue not detected during the testing phase may arise in the production site.</span></span> <span data-ttu-id="2e54b-423">Nesse caso, é importante ter um mecanismo para mudar facilmente para uma versão anterior e mais estável do aplicativo o mais rápido possível.</span><span class="sxs-lookup"><span data-stu-id="2e54b-423">In this case, it is important to have a mechanism to easily switch to a previous and more stable version of the application as quickly as possible.</span></span>

<span data-ttu-id="2e54b-424">No **serviço Azure app**, a implantação contínua do controle do código-fonte possibilita graças à ação de **reimplantação** disponível no portal de gerenciamento.</span><span class="sxs-lookup"><span data-stu-id="2e54b-424">In **Azure App Service**, continuous deployment from source control makes this possible thanks to the **redeploy** action available in the management portal.</span></span> <span data-ttu-id="2e54b-425">O Azure controla as implantações associadas às confirmações enviadas por push ao repositório e fornece uma opção para reimplantar seu aplicativo usando qualquer uma das implantações anteriores, a qualquer momento.</span><span class="sxs-lookup"><span data-stu-id="2e54b-425">Azure keeps track of the deployments associated with the commits pushed to the repository and provides an option to redeploy your application using any of your previous deployments, at any time.</span></span>

<span data-ttu-id="2e54b-426">Neste exercício, você executará uma alteração no código do aplicativo de **teste de especialista** que injeta intencionalmente um *bug*.</span><span class="sxs-lookup"><span data-stu-id="2e54b-426">In this exercise you will perform a change to the code in the **Geek Quiz** application that intentionally injects a *bug*.</span></span> <span data-ttu-id="2e54b-427">Você implantará o aplicativo em produção para ver o erro e, em seguida, aproveitará o recurso reimplantar para voltar ao estado anterior.</span><span class="sxs-lookup"><span data-stu-id="2e54b-427">You will deploy the application to production to see the error, and then you will take advantage of the redeploy feature to go back to the previous state.</span></span>

<a id="Ex3Task1"></a>
#### <a name="task-1--updating-the-geek-quiz-application"></a><span data-ttu-id="2e54b-428">Tarefa 1 – Atualizando o aplicativo de teste de especialista</span><span class="sxs-lookup"><span data-stu-id="2e54b-428">Task 1 – Updating the Geek Quiz Application</span></span>

<span data-ttu-id="2e54b-429">Nesta tarefa, você recriará uma pequena parte do código da classe **TriviaController** para extrair parte da lógica que recupera a opção de teste selecionada do banco de dados para um novo método.</span><span class="sxs-lookup"><span data-stu-id="2e54b-429">In this task, you will refactor a small piece of code of the **TriviaController** class to extract part of the logic that retrieves the selected quiz option from the database into a new method.</span></span>

1. <span data-ttu-id="2e54b-430">Alterne para a instância do Visual Studio com a solução **GeekQuiz** do exercício anterior.</span><span class="sxs-lookup"><span data-stu-id="2e54b-430">Switch to the Visual Studio instance with the **GeekQuiz** solution from the previous exercise.</span></span>
2. <span data-ttu-id="2e54b-431">No **Gerenciador de soluções**, abra o arquivo **TriviaController.cs** dentro da pasta **controladores** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-431">In **Solution Explorer**, open the **TriviaController.cs** file inside the **Controllers** folder.</span></span>
3. <span data-ttu-id="2e54b-432">Localize o método **StoreAsync** e selecione o código realçado na figura a seguir.</span><span class="sxs-lookup"><span data-stu-id="2e54b-432">Locate the **StoreAsync** method and select the code highlighted in the following figure.</span></span>

    ![Selecionando o código](maintainable-azure-websites-managing-change-and-scale/_static/image47.png)

    <span data-ttu-id="2e54b-434">*Selecionando o código*</span><span class="sxs-lookup"><span data-stu-id="2e54b-434">*Selecting the code*</span></span>
4. <span data-ttu-id="2e54b-435">Clique com o botão direito do mouse no código selecionado, expanda o menu **Refactor** e selecione **extrair método...** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-435">Right-click the selected code, expand the **Refactor** menu and select **Extract Method...**.</span></span>

    ![Extraindo o código como um novo método](maintainable-azure-websites-managing-change-and-scale/_static/image48.png)

    <span data-ttu-id="2e54b-437">*Selecionando método de extração*</span><span class="sxs-lookup"><span data-stu-id="2e54b-437">*Selecting Extract Method*</span></span>
5. <span data-ttu-id="2e54b-438">Na caixa de diálogo **extrair método** , nomeie o novo método *MatchesOption* e clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-438">In the **Extract Method** dialog box, name the new method *MatchesOption* and click **OK**.</span></span>

    ![Especificando o nome do método](maintainable-azure-websites-managing-change-and-scale/_static/image49.png)

    <span data-ttu-id="2e54b-440">*Especificando o nome para o método extraído*</span><span class="sxs-lookup"><span data-stu-id="2e54b-440">*Specifying the name for the extracted method*</span></span>
6. <span data-ttu-id="2e54b-441">O código selecionado é então extraído para o método **MatchesOption** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-441">The selected code is then extracted into the **MatchesOption** method.</span></span> <span data-ttu-id="2e54b-442">O código resultante é mostrado no trecho a seguir.</span><span class="sxs-lookup"><span data-stu-id="2e54b-442">The resulting code is shown in the following snippet.</span></span>

    [!code-csharp[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample14.cs)]
7. <span data-ttu-id="2e54b-443">Pressione **Ctrl + S** para salvar as alterações.</span><span class="sxs-lookup"><span data-stu-id="2e54b-443">Press **CTRL + S** to save the changes.</span></span>

<a id="Ex3Task2"></a>
#### <a name="task-2--redeploying-the-geek-quiz-application"></a><span data-ttu-id="2e54b-444">Tarefa 2 – Reimplantando o aplicativo de teste de especialista</span><span class="sxs-lookup"><span data-stu-id="2e54b-444">Task 2 – Redeploying the Geek Quiz Application</span></span>

<span data-ttu-id="2e54b-445">Agora você enviará por push as alterações feitas na tarefa anterior para o repositório, o que disparará uma nova implantação para o ambiente de produção.</span><span class="sxs-lookup"><span data-stu-id="2e54b-445">You will now push the changes you made in the previous task to the repository, which will trigger a new deployment to the production environment.</span></span> <span data-ttu-id="2e54b-446">Em seguida, você solucionará um problema usando as **ferramentas de desenvolvimento F12** fornecidas pelo Internet Explorer e, em seguida, executará uma reversão para a implantação anterior no portal de gerenciamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="2e54b-446">Then, you will troubleshot an issue using the **F12 development tools** provided by Internet Explorer, and then perform a rollback to the previous deployment from the Azure management portal.</span></span>

1. <span data-ttu-id="2e54b-447">Abra um novo console do **git bash** para implantar o aplicativo atualizado no serviço Azure app.</span><span class="sxs-lookup"><span data-stu-id="2e54b-447">Open a new **Git Bash** console to deploy the updated application to Azure App Service.</span></span>
2. <span data-ttu-id="2e54b-448">Execute os comandos a seguir para enviar as alterações por push para o Azure.</span><span class="sxs-lookup"><span data-stu-id="2e54b-448">Execute the following commands to push the changes to Azure.</span></span> <span data-ttu-id="2e54b-449">Atualize o espaço reservado *[Your-Application-Path]* com o caminho para a solução **GeekQuiz** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-449">Update the *[YOUR-APPLICATION-PATH]* placeholder with the path to the **GeekQuiz** solution.</span></span> <span data-ttu-id="2e54b-450">Você será solicitado a fornecer sua senha de implantação.</span><span class="sxs-lookup"><span data-stu-id="2e54b-450">You will be prompted for your deployment password.</span></span>

    [!code-console[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample15.cmd)]

    ![Enviando por push o código refatorado para o Azure](maintainable-azure-websites-managing-change-and-scale/_static/image50.png)

    <span data-ttu-id="2e54b-452">*Enviando por push o código refatorado para o Azure*</span><span class="sxs-lookup"><span data-stu-id="2e54b-452">*Pushing refactored code to Azure*</span></span>
3. <span data-ttu-id="2e54b-453">Abra o Internet Explorer e navegue até seu aplicativo Web (por exemplo, `http://<your-web-site>.azurewebsites.net`).</span><span class="sxs-lookup"><span data-stu-id="2e54b-453">Open Internet Explorer and navigate to your web app (e.g. `http://<your-web-site>.azurewebsites.net`).</span></span> <span data-ttu-id="2e54b-454">Faça logon usando as credenciais criadas anteriormente.</span><span class="sxs-lookup"><span data-stu-id="2e54b-454">Log in using the previously created credentials.</span></span>
4. <span data-ttu-id="2e54b-455">Pressione **F12** para iniciar as ferramentas de desenvolvimento, selecione a guia **rede** e clique no botão **reproduzir** para iniciar a gravação.</span><span class="sxs-lookup"><span data-stu-id="2e54b-455">Press **F12** to launch the development tools, select the **Network** tab and click the **Play** button to start recording.</span></span>

    <span data-ttu-id="2e54b-456">![Iniciando a gravação da rede](maintainable-azure-websites-managing-change-and-scale/_static/image51.png "Iniciando a gravação da rede")</span><span class="sxs-lookup"><span data-stu-id="2e54b-456">![Starting network recording](maintainable-azure-websites-managing-change-and-scale/_static/image51.png "Starting network recording")</span></span>

    <span data-ttu-id="2e54b-457">*Iniciando a gravação da rede*</span><span class="sxs-lookup"><span data-stu-id="2e54b-457">*Starting network recording*</span></span>
5. <span data-ttu-id="2e54b-458">Selecione qualquer opção do teste.</span><span class="sxs-lookup"><span data-stu-id="2e54b-458">Select any option of the quiz.</span></span> <span data-ttu-id="2e54b-459">Você verá que nada acontece.</span><span class="sxs-lookup"><span data-stu-id="2e54b-459">You will see that nothing happens.</span></span>
6. <span data-ttu-id="2e54b-460">Na janela **F12** , a entrada correspondente à solicitação HTTP post mostra um resultado http **500** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-460">In the **F12** window, the entry corresponding to the POST HTTP request shows an HTTP **500** result.</span></span>

    ![Erro HTTP 500](maintainable-azure-websites-managing-change-and-scale/_static/image52.png)

    <span data-ttu-id="2e54b-462">*Erro HTTP 500*</span><span class="sxs-lookup"><span data-stu-id="2e54b-462">*HTTP 500 error*</span></span>
7. <span data-ttu-id="2e54b-463">Selecione a guia **console** . Um erro é registrado com os detalhes da causa.</span><span class="sxs-lookup"><span data-stu-id="2e54b-463">Select the **Console** tab. An error is logged with the details of the cause.</span></span>

    ![Erro registrado](maintainable-azure-websites-managing-change-and-scale/_static/image53.png)

    <span data-ttu-id="2e54b-465">*Erro registrado*</span><span class="sxs-lookup"><span data-stu-id="2e54b-465">*Logged error*</span></span>
8. <span data-ttu-id="2e54b-466">Localize a parte detalhes do erro.</span><span class="sxs-lookup"><span data-stu-id="2e54b-466">Locate the details part of the error.</span></span> <span data-ttu-id="2e54b-467">Claramente, esse erro é causado pela refatoração do código que você confirmou nas etapas anteriores.</span><span class="sxs-lookup"><span data-stu-id="2e54b-467">Clearly, this error is caused by the code refactoring you committed in the previous steps.</span></span>

    <span data-ttu-id="2e54b-468">`Details: LINQ to Entities does not recognize the method 'Boolean MatchesOption ...`.</span><span class="sxs-lookup"><span data-stu-id="2e54b-468">`Details: LINQ to Entities does not recognize the method 'Boolean MatchesOption ...`.</span></span>
9. <span data-ttu-id="2e54b-469">Não feche o navegador.</span><span class="sxs-lookup"><span data-stu-id="2e54b-469">Do not close the browser.</span></span>
10. <span data-ttu-id="2e54b-470">Em uma nova instância do navegador, navegue até o [portal de gerenciamento do Azure](https://manage.windowsazure.com) e entre usando o conta Microsoft associado à sua assinatura.</span><span class="sxs-lookup"><span data-stu-id="2e54b-470">In a new browser instance, navigate to the [Azure management portal](https://manage.windowsazure.com) and sign in using the Microsoft account associated with your subscription.</span></span>
11. <span data-ttu-id="2e54b-471">Selecione **sites** e clique no aplicativo Web criado no exercício 2.</span><span class="sxs-lookup"><span data-stu-id="2e54b-471">Select **Websites** and click the web app you created in Exercise 2.</span></span>
12. <span data-ttu-id="2e54b-472">Navegue até a página **implantações** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-472">Navigate to the **Deployments** page.</span></span> <span data-ttu-id="2e54b-473">Observe que todas as confirmações executadas estão listadas no histórico de implantação.</span><span class="sxs-lookup"><span data-stu-id="2e54b-473">Notice that all the commits performed are listed in the deployment history.</span></span>

    ![Lista de implantações existentes](maintainable-azure-websites-managing-change-and-scale/_static/image54.png)

    <span data-ttu-id="2e54b-475">*Lista de implantações existentes*</span><span class="sxs-lookup"><span data-stu-id="2e54b-475">*List of existing deployments*</span></span>
13. <span data-ttu-id="2e54b-476">Selecione a confirmação anterior e clique em **reimplantar** na barra de comandos.</span><span class="sxs-lookup"><span data-stu-id="2e54b-476">Select the previous commit and click **Redeploy** on the command bar.</span></span>

    ![Reimplantando a confirmação anterior](maintainable-azure-websites-managing-change-and-scale/_static/image55.png)

    <span data-ttu-id="2e54b-478">*Reimplantando a confirmação anterior*</span><span class="sxs-lookup"><span data-stu-id="2e54b-478">*Redeploying the previous commit*</span></span>
14. <span data-ttu-id="2e54b-479">Quando solicitado a confirmar, clique em **Sim**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-479">When prompted to confirm, click **Yes**.</span></span>

    ![Confirmando a reimplantação](maintainable-azure-websites-managing-change-and-scale/_static/image56.png)
15. <span data-ttu-id="2e54b-481">Quando a implantação for concluída, volte para a instância do navegador com seu aplicativo Web e pressione **Ctrl + F5**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-481">When the deployment completes, switch back to the browser instance with your web app and press **CTRL + F5**.</span></span>
16. <span data-ttu-id="2e54b-482">Clique em qualquer uma das opções.</span><span class="sxs-lookup"><span data-stu-id="2e54b-482">Click any of the options.</span></span> <span data-ttu-id="2e54b-483">A animação invertida agora ocorrerá e o resultado (*correto/incorreto*) será exibido.</span><span class="sxs-lookup"><span data-stu-id="2e54b-483">The flip animation will now take place and the result (*correct/incorrect*) will be displayed.</span></span>
17. <span data-ttu-id="2e54b-484">Adicional Alterne para o console do **git bash** e execute os comandos a seguir para reverter para a confirmação anterior.</span><span class="sxs-lookup"><span data-stu-id="2e54b-484">(Optional) Switch to the **Git Bash** console and execute the following commands to revert to the previous commit.</span></span>

    > [!NOTE]
    > <span data-ttu-id="2e54b-485">Esses comandos criam uma nova confirmação que desfaz todas as alterações no repositório git que foram feitas na confirmação inadequada.</span><span class="sxs-lookup"><span data-stu-id="2e54b-485">These commands create a new commit that undoes all changes in the Git repository that were made in the bad commit.</span></span> <span data-ttu-id="2e54b-486">O Azure reimplantará o aplicativo usando a nova confirmação.</span><span class="sxs-lookup"><span data-stu-id="2e54b-486">Azure will then redeploy the application using the new commit.</span></span>

    [!code-console[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample16.cmd)]

<a id="Exercise4"></a>
### <a name="exercise-4-scaling-using-azure-storage"></a><span data-ttu-id="2e54b-487">Exercício 4: dimensionamento usando o armazenamento do Azure</span><span class="sxs-lookup"><span data-stu-id="2e54b-487">Exercise 4: Scaling Using Azure Storage</span></span>

<span data-ttu-id="2e54b-488">Os **BLOBs** são a maneira mais simples de armazenar grandes quantidades de texto não estruturado ou dados binários, como vídeo, áudio e imagens.</span><span class="sxs-lookup"><span data-stu-id="2e54b-488">**Blobs** are the simplest way to store large amounts of unstructured text or binary data such as video, audio and images.</span></span> <span data-ttu-id="2e54b-489">Mover o conteúdo estático do seu aplicativo para o armazenamento ajuda a dimensionar seu aplicativo ao servir imagens ou documentos diretamente para o navegador.</span><span class="sxs-lookup"><span data-stu-id="2e54b-489">Moving the static content of your application to Storage, helps to scale your application by serving images or documents directly to the browser.</span></span>

<span data-ttu-id="2e54b-490">Neste exercício, você moverá o conteúdo estático do seu aplicativo para um contêiner de BLOB.</span><span class="sxs-lookup"><span data-stu-id="2e54b-490">In this exercise, you will move the static content of your application to a Blob container.</span></span> <span data-ttu-id="2e54b-491">Em seguida, você configurará seu aplicativo para adicionar uma **regra de reescrita de URL ASP.net** no **Web. config** para redirecionar o conteúdo para o contêiner de BLOB.</span><span class="sxs-lookup"><span data-stu-id="2e54b-491">Then you will configure your application to add an **ASP.NET URL rewrite rule** in the **Web.config** to redirect your content to the Blob container.</span></span>

<a id="Ex4Task1"></a>
#### <a name="task-1--creating-an-azure-storage-account"></a><span data-ttu-id="2e54b-492">Tarefa 1 – criando uma conta de armazenamento do Azure</span><span class="sxs-lookup"><span data-stu-id="2e54b-492">Task 1 – Creating an Azure Storage Account</span></span>

<span data-ttu-id="2e54b-493">Nesta tarefa, você aprenderá a criar uma nova conta de armazenamento usando o portal de gerenciamento.</span><span class="sxs-lookup"><span data-stu-id="2e54b-493">In this task you will learn how to create a new storage account using the management portal.</span></span>

1. <span data-ttu-id="2e54b-494">Navegue até o [portal de gerenciamento do Azure](https://manage.windowsazure.com) e entre usando o conta Microsoft associado à sua assinatura.</span><span class="sxs-lookup"><span data-stu-id="2e54b-494">Navigate to the [Azure management portal](https://manage.windowsazure.com) and sign in using the Microsoft account associated with your subscription.</span></span>
2. <span data-ttu-id="2e54b-495">Selecione **novo | Serviços de dados | Armazenamento | Criação rápida** para começar a criar uma nova conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="2e54b-495">Select **New | Data Services | Storage | Quick Create** to start creating a new storage account.</span></span> <span data-ttu-id="2e54b-496">Insira um nome exclusivo para a conta e selecione uma **região** na lista.</span><span class="sxs-lookup"><span data-stu-id="2e54b-496">Enter a unique name for the account and select a **Region** from the list.</span></span> <span data-ttu-id="2e54b-497">Clique em **criar conta de armazenamento** para continuar.</span><span class="sxs-lookup"><span data-stu-id="2e54b-497">Click **Create Storage Account** to continue.</span></span>

    <span data-ttu-id="2e54b-498">![Criando uma nova conta de armazenamento](maintainable-azure-websites-managing-change-and-scale/_static/image57.png "Criando uma nova conta de armazenamento")</span><span class="sxs-lookup"><span data-stu-id="2e54b-498">![Creating a new Storage Account](maintainable-azure-websites-managing-change-and-scale/_static/image57.png "Creating a new Storage Account")</span></span>

    <span data-ttu-id="2e54b-499">*Criando uma nova conta de armazenamento*</span><span class="sxs-lookup"><span data-stu-id="2e54b-499">*Creating a new storage account*</span></span>
3. <span data-ttu-id="2e54b-500">Na seção **armazenamento** , aguarde até que o status da nova conta de armazenamento seja alterado para *online* a fim de continuar com a etapa a seguir.</span><span class="sxs-lookup"><span data-stu-id="2e54b-500">In the **Storage** section, wait until the status of the new storage account changes to *Online* in order to continue with the following step.</span></span>

    <span data-ttu-id="2e54b-501">![Conta de armazenamento criada](maintainable-azure-websites-managing-change-and-scale/_static/image58.png "Conta de armazenamento criada")</span><span class="sxs-lookup"><span data-stu-id="2e54b-501">![Storage Account created](maintainable-azure-websites-managing-change-and-scale/_static/image58.png "Storage Account created")</span></span>

    <span data-ttu-id="2e54b-502">*Conta de armazenamento criada*</span><span class="sxs-lookup"><span data-stu-id="2e54b-502">*Storage Account created*</span></span>
4. <span data-ttu-id="2e54b-503">Clique no nome da conta de armazenamento e, em seguida, clique no link **painel** na parte superior da página.</span><span class="sxs-lookup"><span data-stu-id="2e54b-503">Click on the storage account name and then click the **Dashboard** link at the top of the page.</span></span> <span data-ttu-id="2e54b-504">A página **painel** fornece informações sobre o status da conta e os pontos de extremidade de serviço que podem ser usados em seus aplicativos.</span><span class="sxs-lookup"><span data-stu-id="2e54b-504">The **Dashboard** page provides you with information about the status of the account and the service endpoints that can be used within your applications.</span></span>

    <span data-ttu-id="2e54b-505">![Exibindo o painel da conta de armazenamento](maintainable-azure-websites-managing-change-and-scale/_static/image59.png "Exibindo o painel da conta de armazenamento")</span><span class="sxs-lookup"><span data-stu-id="2e54b-505">![Displaying the Storage Account Dashboard](maintainable-azure-websites-managing-change-and-scale/_static/image59.png "Displaying the Storage Account Dashboard")</span></span>

    <span data-ttu-id="2e54b-506">*Exibindo o painel da conta de armazenamento*</span><span class="sxs-lookup"><span data-stu-id="2e54b-506">*Displaying the Storage Account Dashboard*</span></span>
5. <span data-ttu-id="2e54b-507">Clique no botão **gerenciar chaves de acesso** na barra de navegação.</span><span class="sxs-lookup"><span data-stu-id="2e54b-507">Click the **Manage Access Keys** button in the navigation bar.</span></span>

    <span data-ttu-id="2e54b-508">![Botão gerenciar chaves de acesso](maintainable-azure-websites-managing-change-and-scale/_static/image60.png "Botão gerenciar chaves de acesso")</span><span class="sxs-lookup"><span data-stu-id="2e54b-508">![Manage Access Keys button](maintainable-azure-websites-managing-change-and-scale/_static/image60.png "Manage Access Keys button")</span></span>

    <span data-ttu-id="2e54b-509">*Botão gerenciar chaves de acesso*</span><span class="sxs-lookup"><span data-stu-id="2e54b-509">*Manage Access Keys button*</span></span>
6. <span data-ttu-id="2e54b-510">Na caixa de diálogo **gerenciar chaves de acesso** , copie o **nome da conta de armazenamento** e a chave de **acesso primária** , pois você precisará deles no exercício a seguir.</span><span class="sxs-lookup"><span data-stu-id="2e54b-510">In the **Manage Access Keys** dialog box, copy the **Storage Account Name** and **Primary Access Key** as you will need them in the following exercise.</span></span> <span data-ttu-id="2e54b-511">Em seguida, feche a caixa de diálogo.</span><span class="sxs-lookup"><span data-stu-id="2e54b-511">Then, close the dialog box.</span></span>

    <span data-ttu-id="2e54b-512">![Caixa de diálogo Gerenciar chave de acesso](maintainable-azure-websites-managing-change-and-scale/_static/image61.png "Caixa de diálogo Gerenciar chave de acesso")</span><span class="sxs-lookup"><span data-stu-id="2e54b-512">![Manage Access Key dialog box](maintainable-azure-websites-managing-change-and-scale/_static/image61.png "Manage Access Key dialog box")</span></span>

    <span data-ttu-id="2e54b-513">*Caixa de diálogo Gerenciar chave de acesso*</span><span class="sxs-lookup"><span data-stu-id="2e54b-513">*Manage Access Key dialog box*</span></span>

<a id="Ex4Task2"></a>
#### <a name="task-2--uploading-an-asset-to-azure-blob-storage"></a><span data-ttu-id="2e54b-514">Tarefa 2 – carregando um ativo no armazenamento de BLOBs do Azure</span><span class="sxs-lookup"><span data-stu-id="2e54b-514">Task 2 – Uploading an Asset to Azure Blob Storage</span></span>

<span data-ttu-id="2e54b-515">Nesta tarefa, você usará a janela de Gerenciador de Servidores do Visual Studio para se conectar à sua conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="2e54b-515">In this task, you will use the Server Explorer window from Visual Studio to connect to your storage account.</span></span> <span data-ttu-id="2e54b-516">Você, em seguida, crie um contêiner de blob e carregar um arquivo com o logotipo do Geek Quiz para o contêiner.</span><span class="sxs-lookup"><span data-stu-id="2e54b-516">You will then create a blob container and upload a file with the Geek Quiz logo to the container.</span></span>

1. <span data-ttu-id="2e54b-517">Alterne para a instância do Visual Studio com a solução **GeekQuiz** do exercício anterior.</span><span class="sxs-lookup"><span data-stu-id="2e54b-517">Switch to the Visual Studio instance with the **GeekQuiz** solution from the previous exercise.</span></span>
2. <span data-ttu-id="2e54b-518">Na barra de menus, selecione **Exibir** e, em seguida, clique em **Gerenciador de servidores**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-518">From the menu bar, select **View** and then click **Server Explorer**.</span></span>
3. <span data-ttu-id="2e54b-519">Em **Gerenciador de servidores**, clique com o botão direito do mouse no nó **Azure** e selecione **conectar-se ao Azure...** . Entre usando o conta Microsoft associado à sua assinatura.</span><span class="sxs-lookup"><span data-stu-id="2e54b-519">In **Server Explorer**, right-click the **Azure** node and select **Connect to Azure...**. Sign in using the Microsoft account associated with your subscription.</span></span>

    ![Conectar ao Windows Azure...](maintainable-azure-websites-managing-change-and-scale/_static/image62.png)

    <span data-ttu-id="2e54b-521">*Conecte-se ao Azure*</span><span class="sxs-lookup"><span data-stu-id="2e54b-521">*Connect to Azure*</span></span>
4. <span data-ttu-id="2e54b-522">Expanda o nó **Azure** , clique com o botão direito do mouse em **armazenamento** e selecione **anexar armazenamento externo...** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-522">Expand the **Azure** node, right-click **Storage** and select **Attach External Storage...**.</span></span>
5. <span data-ttu-id="2e54b-523">Na caixa de diálogo **Adicionar nova conta de armazenamento** , insira **o nome da conta** e a chave da **conta** que você obteve na tarefa anterior e clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-523">In the **Add New Storage Account** dialog box, enter the **Account name** and **Account key** you obtained in the previous task and click **OK**.</span></span>

    ![Caixa de diálogo Adicionar nova conta de armazenamento](maintainable-azure-websites-managing-change-and-scale/_static/image63.png)

    <span data-ttu-id="2e54b-525">*Caixa de diálogo Adicionar nova conta de armazenamento*</span><span class="sxs-lookup"><span data-stu-id="2e54b-525">*Add New Storage Account dialog box*</span></span>
6. <span data-ttu-id="2e54b-526">Sua conta de armazenamento deve aparecer sob o nó de **armazenamento** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-526">Your storage account should appear under the **Storage** node.</span></span> <span data-ttu-id="2e54b-527">Expanda sua conta de armazenamento, clique com o botão direito do mouse em **BLOBs** e selecione **criar contêiner de BLOB...** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-527">Expand your storage account, right-click **Blobs** and select **Create Blob Container...**.</span></span>

    <span data-ttu-id="2e54b-528">![Criar contêiner de BLOB](maintainable-azure-websites-managing-change-and-scale/_static/image64.png "Criar Contêiner de Blob")</span><span class="sxs-lookup"><span data-stu-id="2e54b-528">![Create Blob Container](maintainable-azure-websites-managing-change-and-scale/_static/image64.png "Create Blob Container")</span></span>

    <span data-ttu-id="2e54b-529">*Criar contêiner de BLOB*</span><span class="sxs-lookup"><span data-stu-id="2e54b-529">*Create Blob Container*</span></span>
7. <span data-ttu-id="2e54b-530">Na caixa de diálogo **criar contêiner de blob** , insira um nome para o contêiner de BLOB e clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-530">In the **Create Blob Container** dialog box, enter a name for the blob container and click **OK**.</span></span>

    <span data-ttu-id="2e54b-531">![Caixa de diálogo Criar contêiner de BLOBs](maintainable-azure-websites-managing-change-and-scale/_static/image65.png "Caixa de diálogo Criar contêiner de BLOBs")</span><span class="sxs-lookup"><span data-stu-id="2e54b-531">![Create Blob Container dialog box](maintainable-azure-websites-managing-change-and-scale/_static/image65.png "Create Blob Container dialog box")</span></span>

    <span data-ttu-id="2e54b-532">*Caixa de diálogo Criar contêiner de BLOBs*</span><span class="sxs-lookup"><span data-stu-id="2e54b-532">*Create Blob Container dialog box*</span></span>
8. <span data-ttu-id="2e54b-533">O novo contêiner de BLOB deve ser adicionado ao nó **BLOBs** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-533">The new blob container should be added to the **Blobs** node.</span></span> <span data-ttu-id="2e54b-534">Altere as permissões de acesso no contêiner para tornar o contêiner público.</span><span class="sxs-lookup"><span data-stu-id="2e54b-534">Change the access permissions in the container to make the container public.</span></span> <span data-ttu-id="2e54b-535">Para fazer isso, clique com o botão direito do mouse no contêiner **imagens** e selecione **Propriedades**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-535">To do this, right-click the **images** container and select **Properties**.</span></span>

    <span data-ttu-id="2e54b-536">![Propriedades do contêiner de imagens](maintainable-azure-websites-managing-change-and-scale/_static/image66.png "Propriedades do contêiner de imagens")</span><span class="sxs-lookup"><span data-stu-id="2e54b-536">![images container properties](maintainable-azure-websites-managing-change-and-scale/_static/image66.png "images container properties")</span></span>

    <span data-ttu-id="2e54b-537">*Propriedades do contêiner de imagens*</span><span class="sxs-lookup"><span data-stu-id="2e54b-537">*Images container properties*</span></span>
9. <span data-ttu-id="2e54b-538">Na janela **Propriedades** , defina o **acesso de leitura público** para o **contêiner**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-538">In the **Properties** window, set the **Public Read Access** to **Container**.</span></span>

    <span data-ttu-id="2e54b-539">![Alterando a propriedade de acesso de leitura público](maintainable-azure-websites-managing-change-and-scale/_static/image67.png "Alterando a propriedade de acesso de leitura público")</span><span class="sxs-lookup"><span data-stu-id="2e54b-539">![Changing public read access property](maintainable-azure-websites-managing-change-and-scale/_static/image67.png "Changing public read access property")</span></span>

    <span data-ttu-id="2e54b-540">*Alterando a propriedade de acesso de leitura público*</span><span class="sxs-lookup"><span data-stu-id="2e54b-540">*Changing public read access property*</span></span>
10. <span data-ttu-id="2e54b-541">Quando for solicitado se você tiver certeza de que deseja alterar a propriedade de acesso público, clique em **Sim**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-541">When prompted if you are sure you want to change the public access property, click **Yes**.</span></span>

    <span data-ttu-id="2e54b-542">![Aviso de Microsoft Visual Studio](maintainable-azure-websites-managing-change-and-scale/_static/image68.png "Aviso de Microsoft Visual Studio")</span><span class="sxs-lookup"><span data-stu-id="2e54b-542">![Microsoft Visual Studio warning](maintainable-azure-websites-managing-change-and-scale/_static/image68.png "Microsoft Visual Studio warning")</span></span>

    <span data-ttu-id="2e54b-543">*Aviso de Microsoft Visual Studio*</span><span class="sxs-lookup"><span data-stu-id="2e54b-543">*Microsoft Visual Studio warning*</span></span>
11. <span data-ttu-id="2e54b-544">Em **Gerenciador de servidores**, clique com o botão direito do mouse no contêiner de blobs de **imagens** e selecione **Exibir contêiner de BLOBs**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-544">In **Server Explorer**, right-click in the **images** blob container and select **View Blob Container**.</span></span>

    <span data-ttu-id="2e54b-545">![Exibir contêiner de BLOB](maintainable-azure-websites-managing-change-and-scale/_static/image69.png "Exibir contêiner de BLOB")</span><span class="sxs-lookup"><span data-stu-id="2e54b-545">![View Blob Container](maintainable-azure-websites-managing-change-and-scale/_static/image69.png "View Blob Container")</span></span>

    <span data-ttu-id="2e54b-546">*Exibir contêiner de BLOB*</span><span class="sxs-lookup"><span data-stu-id="2e54b-546">*View Blob Container*</span></span>
12. <span data-ttu-id="2e54b-547">O contêiner imagens deve ser aberto em uma nova janela e uma legenda sem entradas deve ser mostrada.</span><span class="sxs-lookup"><span data-stu-id="2e54b-547">The images container should open in a new window and a legend with no entries should be shown.</span></span> <span data-ttu-id="2e54b-548">Clique no ícone **carregar** para carregar um arquivo no contêiner de BLOB.</span><span class="sxs-lookup"><span data-stu-id="2e54b-548">Click the **upload** icon to upload a file to the blob container.</span></span>

    <span data-ttu-id="2e54b-549">![Contêiner de imagens sem entradas](maintainable-azure-websites-managing-change-and-scale/_static/image70.png "Contêiner de imagens sem entradas")</span><span class="sxs-lookup"><span data-stu-id="2e54b-549">![Images container with no entries](maintainable-azure-websites-managing-change-and-scale/_static/image70.png "Images container with no entries")</span></span>

    <span data-ttu-id="2e54b-550">*Contêiner de imagens sem entradas*</span><span class="sxs-lookup"><span data-stu-id="2e54b-550">*Images container with no entries*</span></span>
13. <span data-ttu-id="2e54b-551">Na caixa de diálogo **carregar blob** , navegue até a pasta **ativos** do laboratório.</span><span class="sxs-lookup"><span data-stu-id="2e54b-551">In the **Upload Blob** dialog box, navigate to the **Assets** folder of the lab.</span></span> <span data-ttu-id="2e54b-552">Selecione o arquivo **logo-Big. png** e clique em **abrir**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-552">Select the **logo-big.png** file and click **Open**.</span></span>
14. <span data-ttu-id="2e54b-553">Aguarde até que o arquivo seja carregado.</span><span class="sxs-lookup"><span data-stu-id="2e54b-553">Wait until the file is uploaded.</span></span> <span data-ttu-id="2e54b-554">Quando o carregamento for concluído, o arquivo deverá ser listado no contêiner imagens.</span><span class="sxs-lookup"><span data-stu-id="2e54b-554">When the upload completes, the file should be listed in the images container.</span></span> <span data-ttu-id="2e54b-555">Clique com o botão direito do mouse na entrada do arquivo e selecione **Copiar URL**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-555">Right-click the file entry and select **Copy URL**.</span></span>

    <span data-ttu-id="2e54b-556">![Copiar URL do blob](maintainable-azure-websites-managing-change-and-scale/_static/image71.png "Copiar URL do arquivo de BLOB")</span><span class="sxs-lookup"><span data-stu-id="2e54b-556">![Copy blob URL](maintainable-azure-websites-managing-change-and-scale/_static/image71.png "Copy blob file URL")</span></span>

    <span data-ttu-id="2e54b-557">*Copiar URL do blob*</span><span class="sxs-lookup"><span data-stu-id="2e54b-557">*Copy blob URL*</span></span>
15. <span data-ttu-id="2e54b-558">Abra o Internet Explorer e cole a URL.</span><span class="sxs-lookup"><span data-stu-id="2e54b-558">Open Internet Explorer and paste the URL.</span></span> <span data-ttu-id="2e54b-559">A imagem a seguir deve ser mostrada no navegador.</span><span class="sxs-lookup"><span data-stu-id="2e54b-559">The following image should be shown in the browser.</span></span>

    <span data-ttu-id="2e54b-560">![imagem logo-Big. png do armazenamento de BLOBs do Windows](maintainable-azure-websites-managing-change-and-scale/_static/image72.png "imagem logo-Big. png do armazenamento")</span><span class="sxs-lookup"><span data-stu-id="2e54b-560">![logo-big.png image from Windows Blob Storage](maintainable-azure-websites-managing-change-and-scale/_static/image72.png "logo-big.png image from storage")</span></span>

    <span data-ttu-id="2e54b-561">*imagem logo-Big. png do armazenamento de BLOBs do Azure*</span><span class="sxs-lookup"><span data-stu-id="2e54b-561">*logo-big.png image from Azure Blob Storage*</span></span>

<a id="Ex4Task3"></a>
#### <a name="task-3--updating-the-solution-to-consume-static-content-from-azure-blob-storage"></a><span data-ttu-id="2e54b-562">Tarefa 3 – atualizando a solução para consumir conteúdo estático do armazenamento de BLOBs do Azure</span><span class="sxs-lookup"><span data-stu-id="2e54b-562">Task 3 – Updating the Solution to Consume Static Content from Azure Blob Storage</span></span>

<span data-ttu-id="2e54b-563">Nesta tarefa, você configurará a solução **GeekQuiz** para consumir a imagem carregada no armazenamento de BLOBs do Azure (em vez da imagem localizada no aplicativo Web) adicionando uma regra de reescrita de URL ASP.net no arquivo **Web. config** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-563">In this task, you will configure the **GeekQuiz** solution to consume the image uploaded to Azure Blob Storage (instead of the image located in the web app) by adding an ASP.NET URL rewrite rule in the **web.config** file.</span></span>

1. <span data-ttu-id="2e54b-564">No Visual Studio, abra o arquivo **Web. config** dentro do projeto **GeekQuiz** e localize o elemento **&lt;System. WebServer&gt;** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-564">In Visual Studio, open the **Web.config** file inside the **GeekQuiz** project and locate the **&lt;system.webServer&gt;** element.</span></span>
2. <span data-ttu-id="2e54b-565">Adicione o código a seguir para adicionar uma regra de reescrita de URL, atualizando o espaço reservado com o nome da conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="2e54b-565">Add the following code to add an URL rewrite rule, updating the placeholder with your storage account name.</span></span>

    <span data-ttu-id="2e54b-566">(Trecho de código- *WebSitesInProduction-Ex4-UrlRewriteRule*)</span><span class="sxs-lookup"><span data-stu-id="2e54b-566">(Code Snippet - *WebSitesInProduction - Ex4 - UrlRewriteRule*)</span></span>

    [!code-xml[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample17.xml)]

    > [!NOTE]
    > <span data-ttu-id="2e54b-567">A regravação de URL é o processo de interceptar uma solicitação da Web de entrada e de redirecionar a solicitação para um recurso diferente.</span><span class="sxs-lookup"><span data-stu-id="2e54b-567">URL rewriting is the process of intercepting an incoming Web request and redirecting the request to a different resource.</span></span> <span data-ttu-id="2e54b-568">As regras de regravação de URL dizem ao mecanismo de regravação quando uma solicitação precisa ser redirecionada e onde eles devem ser redirecionados.</span><span class="sxs-lookup"><span data-stu-id="2e54b-568">The URL rewriting rules tells the rewriting engine when a request needs to be redirected, and where should they be redirected.</span></span> <span data-ttu-id="2e54b-569">Uma regra de regravação é composta de duas cadeias de caracteres: o padrão a procurar na URL solicitada (geralmente, usando expressões regulares) e a cadeia de caracteres com a qual substituir o padrão, se encontrado.</span><span class="sxs-lookup"><span data-stu-id="2e54b-569">A rewriting rule is composed of two strings: the pattern to look for in the requested URL (usually, using regular expressions), and the string to replace the pattern with, if found.</span></span> <span data-ttu-id="2e54b-570">Para obter mais informações, consulte [regravação de URL em ASP.net](https://msdn.microsoft.com/library/ms972974.aspx).</span><span class="sxs-lookup"><span data-stu-id="2e54b-570">For more information, see [URL Rewriting in ASP.NET](https://msdn.microsoft.com/library/ms972974.aspx).</span></span>
3. <span data-ttu-id="2e54b-571">Pressione **Ctrl + S** para salvar as alterações.</span><span class="sxs-lookup"><span data-stu-id="2e54b-571">Press **CTRL + S** to save the changes.</span></span>
4. <span data-ttu-id="2e54b-572">Abra um novo console do **git bash** para implantar o aplicativo atualizado no serviço Azure app.</span><span class="sxs-lookup"><span data-stu-id="2e54b-572">Open a new **Git Bash** console to deploy the updated application to Azure App Service.</span></span>
5. <span data-ttu-id="2e54b-573">Execute os comandos a seguir para enviar as alterações por push para o Azure.</span><span class="sxs-lookup"><span data-stu-id="2e54b-573">Execute the following commands to push the changes to Azure.</span></span> <span data-ttu-id="2e54b-574">Atualize o espaço reservado *[Your-Application-Path]* com o caminho para a solução **GeekQuiz** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-574">Update the *[YOUR-APPLICATION-PATH]* placeholder with the path to the **GeekQuiz** solution.</span></span> <span data-ttu-id="2e54b-575">Você será solicitado a fornecer sua senha de implantação.</span><span class="sxs-lookup"><span data-stu-id="2e54b-575">You will be prompted for your deployment password.</span></span>

    [!code-console[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample18.cmd)]

    ![Implantando atualização no Azure](maintainable-azure-websites-managing-change-and-scale/_static/image73.png)

    <span data-ttu-id="2e54b-577">*Implantando atualização no Azure*</span><span class="sxs-lookup"><span data-stu-id="2e54b-577">*Deploying update to Azure*</span></span>

<a id="Ex4Task4"></a>
#### <a name="task-4--verification"></a><span data-ttu-id="2e54b-578">Tarefa 4 – verificação</span><span class="sxs-lookup"><span data-stu-id="2e54b-578">Task 4 – Verification</span></span>

<span data-ttu-id="2e54b-579">Nesta tarefa, você usará o **Internet Explorer** para navegar pelo aplicativo de **teste de especialista** e verificar se a regra de reescrita de URL para imagens funciona e se você é redirecionado para a imagem hospedada no armazenamento de **BLOBs do Azure**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-579">In this task you will use **Internet Explorer** to browse the **Geek Quiz** application and check that the URL rewrite rule for images works and you are redirected to the image hosted on **Azure Blob Storage**.</span></span>

1. <span data-ttu-id="2e54b-580">Abra o Internet Explorer e navegue até seu aplicativo Web (por exemplo, `http://<your-web-site>.azurewebsites.net`).</span><span class="sxs-lookup"><span data-stu-id="2e54b-580">Open Internet Explorer and navigate to your web app (e.g. `http://<your-web-site>.azurewebsites.net`).</span></span> <span data-ttu-id="2e54b-581">Faça logon usando as credenciais criadas anteriormente.</span><span class="sxs-lookup"><span data-stu-id="2e54b-581">Log in using the previously created credentials.</span></span>

    <span data-ttu-id="2e54b-582">![Mostrando o aplicativo Web de teste de especialista com a imagem](maintainable-azure-websites-managing-change-and-scale/_static/image74.png "Mostrando o aplicativo Web de teste de especialista com a imagem")</span><span class="sxs-lookup"><span data-stu-id="2e54b-582">![Showing the Geek Quiz web app with the image](maintainable-azure-websites-managing-change-and-scale/_static/image74.png "Showing the Geek Quiz web app with the image")</span></span>

    <span data-ttu-id="2e54b-583">*Mostrando o aplicativo Web de teste de especialista com a imagem*</span><span class="sxs-lookup"><span data-stu-id="2e54b-583">*Showing the Geek Quiz web app with the image*</span></span>
2. <span data-ttu-id="2e54b-584">Pressione **F12** para iniciar as ferramentas de desenvolvimento, selecione a guia **rede** e inicie a gravação.</span><span class="sxs-lookup"><span data-stu-id="2e54b-584">Press **F12** to launch the development tools, select the **Network** tab and start recording.</span></span>

    <span data-ttu-id="2e54b-585">![Iniciando a gravação da rede](maintainable-azure-websites-managing-change-and-scale/_static/image75.png "Iniciando a gravação da rede")</span><span class="sxs-lookup"><span data-stu-id="2e54b-585">![Starting network recording](maintainable-azure-websites-managing-change-and-scale/_static/image75.png "Starting network recording")</span></span>

    <span data-ttu-id="2e54b-586">*Iniciando a gravação da rede*</span><span class="sxs-lookup"><span data-stu-id="2e54b-586">*Starting network recording*</span></span>
3. <span data-ttu-id="2e54b-587">Pressione **Ctrl + F5** para atualizar a página da Web.</span><span class="sxs-lookup"><span data-stu-id="2e54b-587">Press **CTRL + F5** to refresh the web page.</span></span>
4. <span data-ttu-id="2e54b-588">Depois que a página terminar o carregamento, você deverá ver uma solicitação HTTP para a URL **/img/logo-Big.png** com um resultado http **301** (Redirect) e outra solicitação de `http://[YOUR-STORAGE-ACCOUNT].blob.core.windows.net/images/logo-big.png` URL com um resultado http **200** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-588">Once the page has finished loading, you should see an HTTP request for the **/img/logo-big.png** URL with an HTTP **301** result (redirect) and another request for `http://[YOUR-STORAGE-ACCOUNT].blob.core.windows.net/images/logo-big.png` URL with a HTTP **200** result.</span></span>

    <span data-ttu-id="2e54b-589">![Verificando o redirecionamento de URL](maintainable-azure-websites-managing-change-and-scale/_static/image76.png "Mostrando o redirecionamento em ferramentas de desenvolvimento")</span><span class="sxs-lookup"><span data-stu-id="2e54b-589">![Verifying the URL redirect](maintainable-azure-websites-managing-change-and-scale/_static/image76.png "Showing the redirect in Dev Tools")</span></span>

    <span data-ttu-id="2e54b-590">*Verificando o redirecionamento de URL*</span><span class="sxs-lookup"><span data-stu-id="2e54b-590">*Verifying the URL redirect*</span></span>

<a id="Exercise5"></a>
### <a name="exercise-5-using-autoscale-for-web-apps"></a><span data-ttu-id="2e54b-591">Exercício 5: usando o dimensionamento automático para aplicativos Web</span><span class="sxs-lookup"><span data-stu-id="2e54b-591">Exercise 5: Using Autoscale for Web Apps</span></span>

> [!NOTE]
> <span data-ttu-id="2e54b-592">Este exercício é opcional, pois requer suporte para o teste da Web &amp; testes de desempenho, que só está disponível para o **Visual Studio 2013 Ultimate Edition**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-592">This exercise is optional, since it requires support for Web Load &amp; Performance Testing which is only available for **Visual Studio 2013 Ultimate Edition**.</span></span> <span data-ttu-id="2e54b-593">Para obter mais informações sobre recursos específicos do Visual Studio 2013, compare as versões [aqui](https://www.microsoft.com/visualstudio/eng/products/compare).</span><span class="sxs-lookup"><span data-stu-id="2e54b-593">For more information on specific Visual Studio 2013 features, compare versions [here](https://www.microsoft.com/visualstudio/eng/products/compare).</span></span>

<span data-ttu-id="2e54b-594">Os **aplicativos Web do serviço Azure app** fornecem o recurso de dimensionamento automático para aplicativos Web em execução no **modo padrão**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-594">**Azure App Service Web Apps** provides the Autoscale feature for web apps running in **Standard Mode**.</span></span> <span data-ttu-id="2e54b-595">O dimensionamento automático permite que o Azure dimensione automaticamente a contagem de instâncias do seu aplicativo Web, dependendo da carga.</span><span class="sxs-lookup"><span data-stu-id="2e54b-595">Autoscale lets Azure automatically scale the instance count of your web app depending on the load.</span></span> <span data-ttu-id="2e54b-596">Quando o dimensionamento automático é habilitado, o Azure verifica a CPU do seu aplicativo Web uma vez a cada cinco minutos e adiciona instâncias conforme necessário nesse ponto no tempo.</span><span class="sxs-lookup"><span data-stu-id="2e54b-596">When Autoscale is enabled, Azure checks the CPU of your web app once every five minutes and adds instances as needed at that point in time.</span></span> <span data-ttu-id="2e54b-597">Se o uso da CPU for baixo, o Azure removerá instâncias uma vez a cada duas horas para garantir que o desempenho do seu aplicativo Web não seja degradado.</span><span class="sxs-lookup"><span data-stu-id="2e54b-597">If the CPU usage is low, Azure will remove instances once every two hours to ensure that the performance of your web app is not degraded.</span></span>

<span data-ttu-id="2e54b-598">Neste exercício, você seguirá as etapas necessárias para configurar o recurso de **dimensionamento automático** para o aplicativo Web de **teste de especialista** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-598">In this exercise you will go through the steps required to configure the **Autoscale** feature for the **Geek Quiz** web app.</span></span> <span data-ttu-id="2e54b-599">Você verificará esse recurso executando um teste de carga do Visual Studio para gerar carga de CPU suficiente no aplicativo para disparar uma atualização de instância.</span><span class="sxs-lookup"><span data-stu-id="2e54b-599">You will verify this feature by running a Visual Studio load test to generate enough CPU load on the application to trigger an instance upgrade.</span></span>

<a id="Ex5Task1"></a>
#### <a name="task-1--configuring-autoscale-based-on-the-cpu-metric"></a><span data-ttu-id="2e54b-600">Tarefa 1 – Configurando o dimensionamento automático com base na métrica da CPU</span><span class="sxs-lookup"><span data-stu-id="2e54b-600">Task 1 – Configuring Autoscale Based on the CPU Metric</span></span>

<span data-ttu-id="2e54b-601">Nesta tarefa, você usará o portal de gerenciamento do Azure para habilitar o recurso de dimensionamento automático para o aplicativo Web criado no exercício 2.</span><span class="sxs-lookup"><span data-stu-id="2e54b-601">In this task you will use the Azure management portal to enable the Autoscale feature for the web app you created in Exercise 2.</span></span>

1. <span data-ttu-id="2e54b-602">No [portal de gerenciamento do Azure](https://manage.windowsazure.com/), selecione **sites** e clique no aplicativo Web criado no exercício 2.</span><span class="sxs-lookup"><span data-stu-id="2e54b-602">In the [Azure management portal](https://manage.windowsazure.com/), select **Websites** and click the web app you created in Exercise 2.</span></span>
2. <span data-ttu-id="2e54b-603">Navegue até a página **escala** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-603">Navigate to the **Scale** page.</span></span> <span data-ttu-id="2e54b-604">Na seção **capacidade** , selecione **CPU** para a configuração da **métrica de escala por** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-604">Under the **capacity** section, select **CPU** for the **Scale by Metric** configuration.</span></span>

    > [!NOTE]
    > <span data-ttu-id="2e54b-605">Ao Dimensionar por CPU, o Azure ajusta dinamicamente o número de instâncias que o aplicativo usa se o uso da CPU for alterado.</span><span class="sxs-lookup"><span data-stu-id="2e54b-605">When scaling by CPU, Azure dynamically adjusts the number of instances that the app uses if the CPU usage changes.</span></span>

    <span data-ttu-id="2e54b-606">![Selecionando para dimensionar por CPU](maintainable-azure-websites-managing-change-and-scale/_static/image77.png "Selecionando a métrica de CPU para dimensionamento automático")</span><span class="sxs-lookup"><span data-stu-id="2e54b-606">![Selecting to scale by CPU](maintainable-azure-websites-managing-change-and-scale/_static/image77.png "Selecting the CPU metric for auto scaling")</span></span>

    <span data-ttu-id="2e54b-607">*Selecionando para dimensionar por CPU*</span><span class="sxs-lookup"><span data-stu-id="2e54b-607">*Selecting to scale by CPU*</span></span>
3. <span data-ttu-id="2e54b-608">Altere a configuração de **CPU de destino** para **20**-**40** %.</span><span class="sxs-lookup"><span data-stu-id="2e54b-608">Change the **Target CPU** configuration to **20**-**40** percent.</span></span>

    > [!NOTE]
    > <span data-ttu-id="2e54b-609">Esse intervalo representa o uso médio de CPU para seu aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="2e54b-609">This range represents the average CPU usage for your web app.</span></span> <span data-ttu-id="2e54b-610">O Azure adicionará ou removerá instâncias para manter seu aplicativo Web nesse intervalo.</span><span class="sxs-lookup"><span data-stu-id="2e54b-610">Azure will add or remove instances to keep your web app in this range.</span></span> <span data-ttu-id="2e54b-611">O número mínimo e máximo de instâncias usadas para dimensionamento é especificado na configuração de **contagem de instâncias** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-611">The minimum and maximum number of instances used for scaling is specified in the **Instance Count** configuration.</span></span> <span data-ttu-id="2e54b-612">O Azure nunca vai além desse limite.</span><span class="sxs-lookup"><span data-stu-id="2e54b-612">Azure will never go above or beyond that limit.</span></span>
    >
    > <span data-ttu-id="2e54b-613">Os valores de **CPU de destino** padrão são modificados apenas para os fins deste laboratório.</span><span class="sxs-lookup"><span data-stu-id="2e54b-613">The default **Target CPU** values are modified just for the purposes of this lab.</span></span> <span data-ttu-id="2e54b-614">Ao configurar o intervalo de CPU com valores pequenos, você está aumentando as chances de disparar o dimensionamento automático quando uma carga moderada é colocada no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2e54b-614">By configuring the CPU range with small values, you are increasing the chances to trigger Autoscale when a moderate load is placed on the application.</span></span>

    <span data-ttu-id="2e54b-615">![Alterando a CPU de destino para estar entre 20 e 40%](maintainable-azure-websites-managing-change-and-scale/_static/image78.png "Alterando a CPU de destino para estar entre 20 e 40%")</span><span class="sxs-lookup"><span data-stu-id="2e54b-615">![Changing the target CPU to be between 20 and 40 percent](maintainable-azure-websites-managing-change-and-scale/_static/image78.png "Changing the target CPU to be between 20 and 40 percent")</span></span>

    <span data-ttu-id="2e54b-616">*Alterando a CPU de destino para estar entre 20 e 40%*</span><span class="sxs-lookup"><span data-stu-id="2e54b-616">*Changing the Target CPU to be between 20 and 40 percent*</span></span>
4. <span data-ttu-id="2e54b-617">Clique em **salvar** na barra de comandos para salvar as alterações.</span><span class="sxs-lookup"><span data-stu-id="2e54b-617">Click **Save** in the command bar to save the changes.</span></span>

<a id="Ex5Task2"></a>
#### <a name="task-2--load-testing-with-visual-studio"></a><span data-ttu-id="2e54b-618">Tarefa 2 – teste de carga com o Visual Studio</span><span class="sxs-lookup"><span data-stu-id="2e54b-618">Task 2 – Load Testing with Visual Studio</span></span>

<span data-ttu-id="2e54b-619">Agora que o **dimensionamento automático** foi configurado, você criará um **projeto de teste de carga e desempenho na Web** no Visual Studio para gerar alguma carga de CPU em seu aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="2e54b-619">Now that **Autoscale** has been configured, you will create a **Web Performance and Load Test Project** in Visual Studio to generate some CPU load on your web app.</span></span>

1. <span data-ttu-id="2e54b-620">Abra **Visual Studio Ultimate 2013** e selecione **arquivo | Novo | Projeto...** para iniciar uma nova solução.</span><span class="sxs-lookup"><span data-stu-id="2e54b-620">Open **Visual Studio Ultimate 2013** and select **File | New | Project...** to start a new solution.</span></span>

    <span data-ttu-id="2e54b-621">![Criando um novo projeto](maintainable-azure-websites-managing-change-and-scale/_static/image79.png "Criar um novo projeto")</span><span class="sxs-lookup"><span data-stu-id="2e54b-621">![Creating a new project](maintainable-azure-websites-managing-change-and-scale/_static/image79.png "Creating a new project")</span></span>

    <span data-ttu-id="2e54b-622">*Criando um novo projeto*</span><span class="sxs-lookup"><span data-stu-id="2e54b-622">*Creating a new project*</span></span>
2. <span data-ttu-id="2e54b-623">Na caixa de diálogo **novo projeto** , selecione **desempenho da Web e projeto de teste de carga** no **Visual C# | Guia teste** . Verifique se **.NET Framework 4,5** está selecionado, nomeie o projeto *WebAndLoadTestProject*, escolha um **local** e clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-623">In the **New Project** dialog box, select **Web Performance and Load Test Project** under the **Visual C# | Test** tab. Make sure **.NET Framework 4.5** is selected, name the project *WebAndLoadTestProject*, choose a **Location** and click **OK**.</span></span>

    <span data-ttu-id="2e54b-624">![Criando um novo projeto de teste de carga e Web](maintainable-azure-websites-managing-change-and-scale/_static/image80.png "Criando um novo projeto de teste de carga e Web")</span><span class="sxs-lookup"><span data-stu-id="2e54b-624">![Creating a new Web and Load Test project](maintainable-azure-websites-managing-change-and-scale/_static/image80.png "Creating a new Web and Load Test project")</span></span>

    <span data-ttu-id="2e54b-625">*Criando um novo projeto de teste de carga e Web*</span><span class="sxs-lookup"><span data-stu-id="2e54b-625">*Creating a new Web and Load Test project*</span></span>
3. <span data-ttu-id="2e54b-626">No **WebTest1. WebTest** , clique com o botão direito do mouse no nó **WebTest1** e clique em **Adicionar solicitação**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-626">In the **WebTest1.webtest** Right-click the **WebTest1** node and click **Add Request**.</span></span>

    <span data-ttu-id="2e54b-627">![Adicionando uma solicitação ao WebTest1](maintainable-azure-websites-managing-change-and-scale/_static/image81.png "Adicionando uma solicitação ao WebTest1")</span><span class="sxs-lookup"><span data-stu-id="2e54b-627">![Adding a request to WebTest1](maintainable-azure-websites-managing-change-and-scale/_static/image81.png "Adding a request to WebTest1")</span></span>

    <span data-ttu-id="2e54b-628">*Adicionando uma solicitação ao WebTest1*</span><span class="sxs-lookup"><span data-stu-id="2e54b-628">*Adding a request to WebTest1*</span></span>
4. <span data-ttu-id="2e54b-629">Na janela **Propriedades** do novo nó solicitação, atualize a propriedade **URL** para apontar para a URL do seu aplicativo Web (por exemplo, *[http://geek-quiz.azurewebsites.net/](http://geek-quiz.azurewebsites.net/)* ).</span><span class="sxs-lookup"><span data-stu-id="2e54b-629">In the **Properties** window of the new request node, update the **Url** property to point to the URL of your web app (e.g. *[http://geek-quiz.azurewebsites.net/](http://geek-quiz.azurewebsites.net/)*).</span></span>

    <span data-ttu-id="2e54b-630">![Alterando a propriedade de URL](maintainable-azure-websites-managing-change-and-scale/_static/image82.png "Alterando a propriedade de URL")</span><span class="sxs-lookup"><span data-stu-id="2e54b-630">![Changing the Url property](maintainable-azure-websites-managing-change-and-scale/_static/image82.png "Changing the Url property")</span></span>

    <span data-ttu-id="2e54b-631">*Alterando a propriedade de URL*</span><span class="sxs-lookup"><span data-stu-id="2e54b-631">*Changing the Url property*</span></span>
5. <span data-ttu-id="2e54b-632">Na janela **WebTest1. WebTest** , clique com o botão direito do mouse em **WebTest1** e clique em **Adicionar loop...** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-632">In the **WebTest1.webtest** window, right-click **WebTest1** and click **Add Loop...**.</span></span>

    <span data-ttu-id="2e54b-633">![Adicionando um loop a WebTest1](maintainable-azure-websites-managing-change-and-scale/_static/image83.png "Adicionando um loop a WebTest1")</span><span class="sxs-lookup"><span data-stu-id="2e54b-633">![Adding a loop to WebTest1](maintainable-azure-websites-managing-change-and-scale/_static/image83.png "Adding a loop to WebTest1")</span></span>

    <span data-ttu-id="2e54b-634">*Adicionando um loop a WebTest1*</span><span class="sxs-lookup"><span data-stu-id="2e54b-634">*Adding a loop to WebTest1*</span></span>
6. <span data-ttu-id="2e54b-635">Na caixa de diálogo **Adicionar regra condicional e itens ao loop** , selecione a regra **de loop for** e modifique as propriedades a seguir.</span><span class="sxs-lookup"><span data-stu-id="2e54b-635">In the **Add Conditional Rule and Items to Loop** dialog box, select the **For Loop** rule and modify the following properties.</span></span>

   1. <span data-ttu-id="2e54b-636">**Valor de encerramento:** 1000</span><span class="sxs-lookup"><span data-stu-id="2e54b-636">**Terminating value:** 1000</span></span>
   2. <span data-ttu-id="2e54b-637">**Nome do parâmetro de contexto:** Repeti</span><span class="sxs-lookup"><span data-stu-id="2e54b-637">**Context Parameter Name:** Iterator</span></span>
   3. <span data-ttu-id="2e54b-638">**Valor de incremento:** 1</span><span class="sxs-lookup"><span data-stu-id="2e54b-638">**Increment Value:** 1</span></span>

      <span data-ttu-id="2e54b-639">![Selecionando a regra de loop for e atualizando as propriedades](maintainable-azure-websites-managing-change-and-scale/_static/image84.png "Selecionando a regra de loop for e atualizando as propriedades")</span><span class="sxs-lookup"><span data-stu-id="2e54b-639">![Selecting the For Loop rule and updating the properties](maintainable-azure-websites-managing-change-and-scale/_static/image84.png "Selecting the For Loop rule and updating the properties")</span></span>

      <span data-ttu-id="2e54b-640">*Selecionando a regra de loop for e atualizando as propriedades*</span><span class="sxs-lookup"><span data-stu-id="2e54b-640">*Selecting the For Loop rule and updating the properties*</span></span>
7. <span data-ttu-id="2e54b-641">Na seção **itens em loop** , selecione a solicitação que você criou anteriormente para ser o primeiro e o último item para o loop.</span><span class="sxs-lookup"><span data-stu-id="2e54b-641">Under the **Items in loop** section, select the request you created previously to be the first and last item for the loop.</span></span> <span data-ttu-id="2e54b-642">Clique em **OK** para continuar.</span><span class="sxs-lookup"><span data-stu-id="2e54b-642">Click **OK** to continue.</span></span>

    <span data-ttu-id="2e54b-643">![Selecionando o primeiro e o último itens para o loop](maintainable-azure-websites-managing-change-and-scale/_static/image85.png "Selecionando o primeiro e o último itens para o loop")</span><span class="sxs-lookup"><span data-stu-id="2e54b-643">![Selecting the first and last items for the loop](maintainable-azure-websites-managing-change-and-scale/_static/image85.png "Selecting the first and last items for the loop")</span></span>

    <span data-ttu-id="2e54b-644">*Selecionando o primeiro e o último itens para o loop*</span><span class="sxs-lookup"><span data-stu-id="2e54b-644">*Selecting the first and last items for the loop*</span></span>
8. <span data-ttu-id="2e54b-645">Em **Gerenciador de soluções**, clique com o botão direito do mouse no projeto **WebAndLoadTestProject** , expanda o menu **Adicionar** e selecione **carregar teste..** ..</span><span class="sxs-lookup"><span data-stu-id="2e54b-645">In **Solution Explorer**, right-click the **WebAndLoadTestProject** project, expand the **Add** menu and select **Load Test...**.</span></span>

    <span data-ttu-id="2e54b-646">![Adicionando um teste de carga ao projeto WebAndLoadTestProject](maintainable-azure-websites-managing-change-and-scale/_static/image86.png "Adicionando um teste de carga ao projeto WebAndLoadTestProject")</span><span class="sxs-lookup"><span data-stu-id="2e54b-646">![Adding a Load Test to the WebAndLoadTestProject project](maintainable-azure-websites-managing-change-and-scale/_static/image86.png "Adding a Load Test to the WebAndLoadTestProject project")</span></span>

    <span data-ttu-id="2e54b-647">*Adicionando um teste de carga ao projeto WebAndLoadTestProject*</span><span class="sxs-lookup"><span data-stu-id="2e54b-647">*Adding a Load Test to the WebAndLoadTestProject project*</span></span>
9. <span data-ttu-id="2e54b-648">Na caixa de diálogo **novo assistente de teste de carga** , clique em **Avançar**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-648">In the **New Load Test Wizard** dialog box, click **Next**.</span></span>

    <span data-ttu-id="2e54b-649">![Novo Assistente de Teste de Carga](maintainable-azure-websites-managing-change-and-scale/_static/image87.png "Novo Assistente de Teste de Carga")</span><span class="sxs-lookup"><span data-stu-id="2e54b-649">![New Load Test Wizard](maintainable-azure-websites-managing-change-and-scale/_static/image87.png "New Load Test Wizard")</span></span>

    <span data-ttu-id="2e54b-650">*Novo Assistente de Teste de Carga*</span><span class="sxs-lookup"><span data-stu-id="2e54b-650">*New Load Test Wizard*</span></span>
10. <span data-ttu-id="2e54b-651">Na página **cenário** , selecione **não usar tempos de refelxão** e clique em **Avançar**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-651">In the **Scenario** page, select **Do not use think times** and click **Next**.</span></span>

    <span data-ttu-id="2e54b-652">![Selecionando não usar tempos de refelxão](maintainable-azure-websites-managing-change-and-scale/_static/image88.png "Selecionando não usar tempos de refelxão")</span><span class="sxs-lookup"><span data-stu-id="2e54b-652">![Selecting not to use think times](maintainable-azure-websites-managing-change-and-scale/_static/image88.png "Selecting not to use think times")</span></span>

    <span data-ttu-id="2e54b-653">*Selecionando não usar tempos de refelxão*</span><span class="sxs-lookup"><span data-stu-id="2e54b-653">*Selecting not to use think times*</span></span>
11. <span data-ttu-id="2e54b-654">Na página **padrão de carga** , verifique se a opção de **carregar constante** está selecionada.</span><span class="sxs-lookup"><span data-stu-id="2e54b-654">In the **Load Pattern** page, make sure that the **Constant Load** option is selected.</span></span> <span data-ttu-id="2e54b-655">Altere a configuração de **contagem de usuários** para **250** usuários e clique em **Avançar**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-655">Change the **User Count** setting to **250** users and click **Next**.</span></span>

    <span data-ttu-id="2e54b-656">![Alterando a contagem de usuários para 250](maintainable-azure-websites-managing-change-and-scale/_static/image89.png "Alterando a contagem de usuários para 250")</span><span class="sxs-lookup"><span data-stu-id="2e54b-656">![Changing the user count to 250](maintainable-azure-websites-managing-change-and-scale/_static/image89.png "Changing the user count to 250")</span></span>

    <span data-ttu-id="2e54b-657">*Alterando a contagem de usuários para 250*</span><span class="sxs-lookup"><span data-stu-id="2e54b-657">*Changing the user count to 250*</span></span>
12. <span data-ttu-id="2e54b-658">Na página **modelo de combinação de teste** , selecione **com base na ordem de teste sequencial** e clique em **Avançar**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-658">In the **Test Mix Model** page, select **Based on sequential test order** and click **Next**.</span></span>

    <span data-ttu-id="2e54b-659">![Selecionando o modelo de combinação de teste](maintainable-azure-websites-managing-change-and-scale/_static/image90.png "Selecionando o modelo de combinação de teste")</span><span class="sxs-lookup"><span data-stu-id="2e54b-659">![Selecting the test mix model](maintainable-azure-websites-managing-change-and-scale/_static/image90.png "Selecting the test mix model")</span></span>

    <span data-ttu-id="2e54b-660">*Selecionando o modelo de combinação de teste*</span><span class="sxs-lookup"><span data-stu-id="2e54b-660">*Selecting the test mix model*</span></span>
13. <span data-ttu-id="2e54b-661">Na página **modelo de combinação de teste** , clique em **Adicionar...** para adicionar um teste à combinação.</span><span class="sxs-lookup"><span data-stu-id="2e54b-661">In the **Test Mix Model** page, click **Add...** to add a test to the mix.</span></span>

    <span data-ttu-id="2e54b-662">![Adicionando um teste à combinação de testes](maintainable-azure-websites-managing-change-and-scale/_static/image91.png "Adicionando um teste à combinação de testes")</span><span class="sxs-lookup"><span data-stu-id="2e54b-662">![Adding a test to the test mix](maintainable-azure-websites-managing-change-and-scale/_static/image91.png "Adding a test to the test mix")</span></span>

    <span data-ttu-id="2e54b-663">*Adicionando um teste à combinação de testes*</span><span class="sxs-lookup"><span data-stu-id="2e54b-663">*Adding a test to the test mix*</span></span>
14. <span data-ttu-id="2e54b-664">Na caixa de diálogo **Adicionar testes** , clique duas vezes em **WebTest1** para adicionar o teste à lista de **testes selecionados** .</span><span class="sxs-lookup"><span data-stu-id="2e54b-664">In the **Add Tests** dialog box, double-click **WebTest1** to add the test to the **Selected tests** list.</span></span> <span data-ttu-id="2e54b-665">Clique em **OK** para continuar.</span><span class="sxs-lookup"><span data-stu-id="2e54b-665">Click **OK** to continue.</span></span>

    <span data-ttu-id="2e54b-666">![Adicionando o teste WebTest1](maintainable-azure-websites-managing-change-and-scale/_static/image92.png "Adicionando o teste WebTest1")</span><span class="sxs-lookup"><span data-stu-id="2e54b-666">![Adding the WebTest1 test](maintainable-azure-websites-managing-change-and-scale/_static/image92.png "Adding the WebTest1 test")</span></span>

    <span data-ttu-id="2e54b-667">*Adicionando o teste WebTest1*</span><span class="sxs-lookup"><span data-stu-id="2e54b-667">*Adding the WebTest1 test*</span></span>
15. <span data-ttu-id="2e54b-668">De volta à página de **combinação de testes** , clique em **Avançar**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-668">Back in the **Test Mix** page, click **Next**.</span></span>

    <span data-ttu-id="2e54b-669">![Concluindo a página de combinação de testes](maintainable-azure-websites-managing-change-and-scale/_static/image93.png "Concluindo a página de combinação de testes")</span><span class="sxs-lookup"><span data-stu-id="2e54b-669">![Completing the Test Mix page](maintainable-azure-websites-managing-change-and-scale/_static/image93.png "Completing the Test Mix page")</span></span>

    <span data-ttu-id="2e54b-670">*Concluindo a página de combinação de testes*</span><span class="sxs-lookup"><span data-stu-id="2e54b-670">*Completing the Test Mix page*</span></span>
16. <span data-ttu-id="2e54b-671">Na página **combinação de rede** , clique em **Avançar**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-671">In the **Network Mix** page, click **Next**.</span></span>

    <span data-ttu-id="2e54b-672">![Clicando em avançar na página combinação de rede](maintainable-azure-websites-managing-change-and-scale/_static/image94.png "Clicando em avançar na página combinação de rede")</span><span class="sxs-lookup"><span data-stu-id="2e54b-672">![Clicking next in the Network Mix page](maintainable-azure-websites-managing-change-and-scale/_static/image94.png "Clicking next in the Network Mix page")</span></span>

    <span data-ttu-id="2e54b-673">*Clicando em avançar na página combinação de rede*</span><span class="sxs-lookup"><span data-stu-id="2e54b-673">*Clicking next in the Network Mix page*</span></span>
17. <span data-ttu-id="2e54b-674">Na página de **combinação de navegador** , selecione **Internet Explorer 10,0** como o tipo de navegador e clique em **Avançar**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-674">In the **Browser Mix** page, select **Internet Explorer 10.0** as the browser type and click **Next**.</span></span>

    <span data-ttu-id="2e54b-675">![Selecionando o tipo de navegador](maintainable-azure-websites-managing-change-and-scale/_static/image95.png "Selecionando o tipo de navegador")</span><span class="sxs-lookup"><span data-stu-id="2e54b-675">![Selecting the browser type](maintainable-azure-websites-managing-change-and-scale/_static/image95.png "Selecting the browser type")</span></span>

    <span data-ttu-id="2e54b-676">*Selecionando o tipo de navegador*</span><span class="sxs-lookup"><span data-stu-id="2e54b-676">*Selecting the browser type*</span></span>
18. <span data-ttu-id="2e54b-677">Na página **conjuntos de contadores** , clique em **Avançar**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-677">In the **Counter Sets** page, click **Next**.</span></span>

    <span data-ttu-id="2e54b-678">![Clicando em avançar na página conjuntos de contadores](maintainable-azure-websites-managing-change-and-scale/_static/image96.png "Clicando em avançar na página conjuntos de contadores")</span><span class="sxs-lookup"><span data-stu-id="2e54b-678">![Clicking Next in the Counter Sets page](maintainable-azure-websites-managing-change-and-scale/_static/image96.png "Clicking Next in the Counter Sets page")</span></span>

    <span data-ttu-id="2e54b-679">*Clicando em avançar na página conjuntos de contadores*</span><span class="sxs-lookup"><span data-stu-id="2e54b-679">*Clicking Next in the Counter Sets page*</span></span>
19. <span data-ttu-id="2e54b-680">Na página **configurações de execução** , defina a **duração do teste de carga** para **5 minutos** e clique em **concluir**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-680">In the **Run Settings** page, set the **Load test duration** to **5 minutes** and click **Finish**.</span></span>

    <span data-ttu-id="2e54b-681">![Definindo a duração do teste de carga para 5 minutos](maintainable-azure-websites-managing-change-and-scale/_static/image97.png "Definindo a duração do teste de carga para 5 minutos")</span><span class="sxs-lookup"><span data-stu-id="2e54b-681">![Setting the load test duration to 5 minutes](maintainable-azure-websites-managing-change-and-scale/_static/image97.png "Setting the load test duration to 5 minutes")</span></span>

    <span data-ttu-id="2e54b-682">*Definindo a duração do teste de carga para 5 minutos*</span><span class="sxs-lookup"><span data-stu-id="2e54b-682">*Setting the load test duration to 5 minutes*</span></span>
20. <span data-ttu-id="2e54b-683">Em **Gerenciador de soluções**, clique duas vezes no arquivo **local. Settings** para explorar as configurações do teste.</span><span class="sxs-lookup"><span data-stu-id="2e54b-683">In **Solution Explorer**, double-click the **Local.settings** file to explore the test settings.</span></span> <span data-ttu-id="2e54b-684">Por padrão, o Visual Studio usa o computador local para executar os testes.</span><span class="sxs-lookup"><span data-stu-id="2e54b-684">By default, Visual Studio uses your local computer to run the tests.</span></span>

    > [!NOTE]
    > <span data-ttu-id="2e54b-685">Como alternativa, você pode configurar seu projeto de teste para executar os testes de carga na nuvem usando **Azure Test Plans**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-685">Alternatively, you can configure your test project to run the load tests in the cloud using **Azure Test Plans**.</span></span> <span data-ttu-id="2e54b-686">O Azure Test Plans fornece um serviço de teste de carga baseado em nuvem que simula uma carga mais realista, evitando restrições de ambiente local, como capacidade de CPU, memória disponível e largura de banda de rede.</span><span class="sxs-lookup"><span data-stu-id="2e54b-686">Azure Test Plans provides a cloud-based load testing service that simulates a more realistic load, avoiding local environment constraints like CPU capacity, available memory, and network bandwidth.</span></span> <span data-ttu-id="2e54b-687">Para obter mais informações sobre como usar Azure Test Plans para executar testes de carga, consulte [cenários de teste de carga](/azure/devops/test/load-test/overview?view=vsts).</span><span class="sxs-lookup"><span data-stu-id="2e54b-687">For more information about using Azure Test Plans to run load tests, see [Load testing scenarios](/azure/devops/test/load-test/overview?view=vsts).</span></span>

    ![Configurações de teste](maintainable-azure-websites-managing-change-and-scale/_static/image98.png)

<a id="Ex5Task3"></a>
#### <a name="task-3--autoscale-verification"></a><span data-ttu-id="2e54b-689">Tarefa 3 – verificação de dimensionamento automático</span><span class="sxs-lookup"><span data-stu-id="2e54b-689">Task 3 – Autoscale Verification</span></span>

<span data-ttu-id="2e54b-690">Agora, você executará o teste de carga criado na tarefa anterior e verá como seu aplicativo Web se comporta sob carga.</span><span class="sxs-lookup"><span data-stu-id="2e54b-690">You will now execute the load test you created in the previous task and see how your web app behaves under load.</span></span>

1. <span data-ttu-id="2e54b-691">Em **Gerenciador de soluções**, clique duas vezes em **loadtest1. LoadTest** para abrir o teste de carga.</span><span class="sxs-lookup"><span data-stu-id="2e54b-691">In **Solution Explorer**, double-click **LoadTest1.loadtest** to open the load test.</span></span>

    <span data-ttu-id="2e54b-692">![Abrindo LoadTest1. LoadTest](maintainable-azure-websites-managing-change-and-scale/_static/image99.png "Abrindo LoadTest1. LoadTest")</span><span class="sxs-lookup"><span data-stu-id="2e54b-692">![Opening LoadTest1.loadtest](maintainable-azure-websites-managing-change-and-scale/_static/image99.png "Opening LoadTest1.loadtest")</span></span>

    <span data-ttu-id="2e54b-693">*Abrindo LoadTest1. LoadTest*</span><span class="sxs-lookup"><span data-stu-id="2e54b-693">*Opening LoadTest1.loadtest*</span></span>
2. <span data-ttu-id="2e54b-694">Na janela **loadtest1. LoadTest** , clique no primeiro botão na caixa de ferramentas para executar o teste de carga.</span><span class="sxs-lookup"><span data-stu-id="2e54b-694">In the **LoadTest1.loadtest** window, click the first button in the toolbox to run the load test.</span></span>

    <span data-ttu-id="2e54b-695">![Executando o teste de carga](maintainable-azure-websites-managing-change-and-scale/_static/image100.png "Executando o teste de carga")</span><span class="sxs-lookup"><span data-stu-id="2e54b-695">![Running the load test](maintainable-azure-websites-managing-change-and-scale/_static/image100.png "Running the load test")</span></span>

    <span data-ttu-id="2e54b-696">*Executando o teste de carga*</span><span class="sxs-lookup"><span data-stu-id="2e54b-696">*Running the load test*</span></span>
3. <span data-ttu-id="2e54b-697">Aguarde até que o teste de carga seja concluído.</span><span class="sxs-lookup"><span data-stu-id="2e54b-697">Wait until the load test completes.</span></span>

    > [!NOTE]
    > <span data-ttu-id="2e54b-698">O teste de carga simula vários usuários que enviam solicitações ao aplicativo Web simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="2e54b-698">The load test simulates multiple users that send requests to the web app simultaneously.</span></span> <span data-ttu-id="2e54b-699">Quando o teste estiver em execução, você poderá monitorar os contadores disponíveis para detectar erros, avisos ou outras informações relacionadas à execução do teste de carga.</span><span class="sxs-lookup"><span data-stu-id="2e54b-699">When the test is running, you can monitor the available counters to detect any errors, warnings or other information related to your load test run.</span></span>

    <span data-ttu-id="2e54b-700">![Execução de teste de carga](maintainable-azure-websites-managing-change-and-scale/_static/image101.png "Aguardando até que o teste de carga seja concluído")</span><span class="sxs-lookup"><span data-stu-id="2e54b-700">![Load test running](maintainable-azure-websites-managing-change-and-scale/_static/image101.png "Waiting until the load test completes")</span></span>

    <span data-ttu-id="2e54b-701">*Execução de teste de carga*</span><span class="sxs-lookup"><span data-stu-id="2e54b-701">*Load test running*</span></span>
4. <span data-ttu-id="2e54b-702">Quando o teste for concluído, volte para o portal de gerenciamento e navegue até a página **escala** do seu aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="2e54b-702">Once the test completes, go back to the management portal and navigate to the **Scale** page of your web app.</span></span> <span data-ttu-id="2e54b-703">Na seção **capacidade** , você deve ver no grafo que uma nova instância foi implantada automaticamente.</span><span class="sxs-lookup"><span data-stu-id="2e54b-703">Under the **capacity** section, you should see in the graph that a new instance was automatically deployed.</span></span>

    ![Nova instância implantada automaticamente](maintainable-azure-websites-managing-change-and-scale/_static/image102.png)

    <span data-ttu-id="2e54b-705">*Nova instância implantada automaticamente*</span><span class="sxs-lookup"><span data-stu-id="2e54b-705">*New instance automatically deployed*</span></span>

    > [!NOTE]
    > <span data-ttu-id="2e54b-706">Pode levar vários minutos para que as alterações apareçam no grafo (pressione **Ctrl + F5** periodicamente para atualizar a página).</span><span class="sxs-lookup"><span data-stu-id="2e54b-706">It may take several minutes for the changes to appear in the graph (press **CTRL + F5** periodically to refresh the page).</span></span> <span data-ttu-id="2e54b-707">Se você não vir nenhuma alteração, poderá tentar o seguinte:</span><span class="sxs-lookup"><span data-stu-id="2e54b-707">If you do not see any changes, you can try the following:</span></span>
    >
    > - <span data-ttu-id="2e54b-708">Aumentar a duração do teste de carga (por exemplo, para **10 minutos**)</span><span class="sxs-lookup"><span data-stu-id="2e54b-708">Increase the duration of the load test (e.g. to **10 minutes**)</span></span>
    > - <span data-ttu-id="2e54b-709">Reduzir os valores máximo e mínimo do intervalo de **CPU de destino** na configuração de dimensionamento automático do seu aplicativo Web</span><span class="sxs-lookup"><span data-stu-id="2e54b-709">Reduce the maximum and minimum values of the **Target CPU** range in the Autoscale configuration of your web app</span></span>
    > - <span data-ttu-id="2e54b-710">Execute o teste de carga na nuvem com **Azure Test Plans**.</span><span class="sxs-lookup"><span data-stu-id="2e54b-710">Run the load test in the cloud with **Azure Test Plans**.</span></span> <span data-ttu-id="2e54b-711">Mais informações podem ser obtidas [aqui](/azure/devops/test/load-test/index?view=vsts)</span><span class="sxs-lookup"><span data-stu-id="2e54b-711">More information [here](/azure/devops/test/load-test/index?view=vsts)</span></span>

---

<a id="Summary"></a>
## <a name="summary"></a><span data-ttu-id="2e54b-712">Resumo</span><span class="sxs-lookup"><span data-stu-id="2e54b-712">Summary</span></span>

<span data-ttu-id="2e54b-713">Neste laboratório prático, você aprendeu a configurar e implantar seu aplicativo em aplicativos Web de produção no Azure.</span><span class="sxs-lookup"><span data-stu-id="2e54b-713">In this hands-on lab, you learned how to set up and deploy your application to production web apps in Azure.</span></span> <span data-ttu-id="2e54b-714">Você começou detectando e atualizando seus bancos de dados usando o **migrações do Entity Framework Code First**e, em seguida, continuou implantando novas versões do seu site usando o **git** e executando reversões para a versão estável mais recente do seu site.</span><span class="sxs-lookup"><span data-stu-id="2e54b-714">You started by detecting and updating your databases using **Entity Framework Code First Migrations**, then continued by deploying new versions of your site using **Git** and performing rollbacks to the latest stable version of your site.</span></span> <span data-ttu-id="2e54b-715">Além disso, você aprendeu a dimensionar seu aplicativo usando o armazenamento para mover seu conteúdo estático para um contêiner de BLOBs.</span><span class="sxs-lookup"><span data-stu-id="2e54b-715">Additionally, you learned how to scale your app using Storage to move your static content to a Blob container.</span></span>
