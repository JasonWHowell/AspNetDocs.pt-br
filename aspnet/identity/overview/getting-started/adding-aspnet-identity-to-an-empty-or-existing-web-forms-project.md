---
uid: identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project
title: Adicionando ASP.NET Identity a um projeto Web Forms vazio ou existente-ASP.NET 4. x
author: raquelsa
description: Este tutorial mostra como adicionar ASP.NET Identity (o sistema de associação para ASP.NET) a um aplicativo ASP.NET. Quando você cria um novo Web Forms ou MVC...
ms.author: riande
ms.date: 01/22/2019
ms.assetid: 1cbc0ed2-5bd6-4b62-8d34-4c193dcd8b25
ms.custom: seoapril2019
msc.legacyurl: /identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project
msc.type: authoredcontent
ms.openlocfilehash: 8e82951d57f0b8052ee3f6530a7470be7d030206
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78584122"
---
# <a name="adding-aspnet-identity-to-an-empty-or-existing-web-forms-project"></a><span data-ttu-id="872c9-104">Adição de Identidade do ASP.NET a um projeto vazio ou existente do Web Forms</span><span class="sxs-lookup"><span data-stu-id="872c9-104">Adding ASP.NET Identity to an Empty or Existing Web Forms Project</span></span>

> <span data-ttu-id="872c9-105">Este tutorial mostra como adicionar [ASP.net Identity](introduction-to-aspnet-identity.md) (o novo sistema de associação para ASP.net) a um aplicativo ASP.net.</span><span class="sxs-lookup"><span data-stu-id="872c9-105">This tutorial shows you how to add [ASP.NET Identity](introduction-to-aspnet-identity.md) (the new membership system for ASP.NET) to an ASP.NET application.</span></span>
> 
> <span data-ttu-id="872c9-106">Quando você cria um novo projeto Web Forms ou MVC no Visual Studio 2017 RTM com contas individuais, o Visual Studio instalará todos os pacotes necessários e adicionará todas as classes necessárias para você.</span><span class="sxs-lookup"><span data-stu-id="872c9-106">When you create a new Web Forms or MVC project in Visual Studio 2017 RTM with Individual Accounts, Visual Studio will install all the required packages and add all necessary classes for you.</span></span> <span data-ttu-id="872c9-107">Este tutorial ilustra as etapas para adicionar ASP.NET Identity suporte ao seu projeto Web Forms existente ou a um novo projeto vazio.</span><span class="sxs-lookup"><span data-stu-id="872c9-107">This tutorial will illustrate the steps to add ASP.NET Identity support to your existing Web Forms project or a new empty project.</span></span> <span data-ttu-id="872c9-108">Vou descrever todos os pacotes NuGet que você precisa instalar e as classes que precisa adicionar.</span><span class="sxs-lookup"><span data-stu-id="872c9-108">I will outline all the NuGet packages you need to install, and classes you need to add.</span></span> <span data-ttu-id="872c9-109">Abordarei Web Forms de exemplo para registrar novos usuários e fazer logon enquanto realçar todas as APIs de ponto de entrada principal para gerenciamento e autenticação de usuários.</span><span class="sxs-lookup"><span data-stu-id="872c9-109">I will go over sample Web Forms for registering new users and logging in while highlighting all main entry point APIs for user management and authentication.</span></span> <span data-ttu-id="872c9-110">Este exemplo usará o ASP.NET Identity implementação padrão para o armazenamento de dados SQL, que é criado em Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="872c9-110">This sample will use the ASP.NET Identity default implementation for SQL data storage which is built on Entity Framework.</span></span> <span data-ttu-id="872c9-111">Este tutorial, usaremos o LocalDB para o banco de dados SQL.</span><span class="sxs-lookup"><span data-stu-id="872c9-111">This tutorial, we will use LocalDB for the SQL database.</span></span>
> 

## <a name="get-started-with-aspnet-identity"></a><span data-ttu-id="872c9-112">Introdução ao ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="872c9-112">Get started with ASP.NET Identity</span></span>

1. <span data-ttu-id="872c9-113">Comece Instalando e executando o [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="872c9-113">Start by installing and running [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/).</span></span>
2. <span data-ttu-id="872c9-114">Selecione **novo projeto** na página inicial, ou você pode usar o menu e selecionar **arquivo**e, em seguida, **novo projeto**.</span><span class="sxs-lookup"><span data-stu-id="872c9-114">Select **New Project** from the Start page, or you can use the menu and select **File**, and then **New Project**.</span></span>
3. <span data-ttu-id="872c9-115">No painel esquerdo, expanda **Visual C#** , selecione **Web**e, em seguida, **aplicativo Web ASP.net (.NET Framework)** .</span><span class="sxs-lookup"><span data-stu-id="872c9-115">In the left pane, expand **Visual C#**, then select **Web**, then **ASP.NET Web Application (.Net Framework)**.</span></span> <span data-ttu-id="872c9-116">Nomeie seu projeto como "WebFormsIdentity" e selecione **OK**.</span><span class="sxs-lookup"><span data-stu-id="872c9-116">Name your project "WebFormsIdentity" and select **OK**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image17.png)
4. <span data-ttu-id="872c9-117">Na caixa de diálogo **novo projeto ASP.net** , selecione o modelo **vazio** .</span><span class="sxs-lookup"><span data-stu-id="872c9-117">In the **New ASP.NET Project** dialog, select the **Empty** template.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image2.png)  
  
   <span data-ttu-id="872c9-118">Observe que o botão **alterar autenticação** está desabilitado e nenhum suporte de autenticação é fornecido neste modelo.</span><span class="sxs-lookup"><span data-stu-id="872c9-118">Notice the **Change Authentication** button is disabled and no authentication support is provided in this template.</span></span> <span data-ttu-id="872c9-119">Os modelos Web Forms, MVC e API Web permitem que você selecione a abordagem de autenticação.</span><span class="sxs-lookup"><span data-stu-id="872c9-119">The Web Forms, MVC and Web API templates allow you to select the authentication approach.</span></span>

## <a name="add-identity-packages-to-your-app"></a><span data-ttu-id="872c9-120">Adicionar pacotes de identidade ao seu aplicativo</span><span class="sxs-lookup"><span data-stu-id="872c9-120">Add Identity packages to your app</span></span>

<span data-ttu-id="872c9-121">Em Gerenciador de Soluções, clique com o botão direito do mouse em seu projeto e selecione **gerenciar pacotes NuGet**.</span><span class="sxs-lookup"><span data-stu-id="872c9-121">In Solution Explorer, right-click your project and select **Manage NuGet Packages**.</span></span> <span data-ttu-id="872c9-122">Procure e instale o pacote **Microsoft. AspNet. Identity. EntityFramework** .</span><span class="sxs-lookup"><span data-stu-id="872c9-122">Search for and install the **Microsoft.AspNet.Identity.EntityFramework** package.</span></span> 
  
![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image15.png)
  
<span data-ttu-id="872c9-123">Observe que esse pacote instalará os pacotes de dependência: **EntityFramework** e **Microsoft ASP.net Identity Core**.</span><span class="sxs-lookup"><span data-stu-id="872c9-123">Note that this package will install the dependency packages: **EntityFramework** and **Microsoft ASP.NET Identity Core**.</span></span>

## <a name="add-a-web-form-to-register-users"></a><span data-ttu-id="872c9-124">Adicionar um formulário da Web para registrar usuários</span><span class="sxs-lookup"><span data-stu-id="872c9-124">Add a web form to register users</span></span>

1. <span data-ttu-id="872c9-125">Em **Gerenciador de soluções**, clique com o botão direito do mouse no projeto e selecione **Adicionar**e, em seguida, **formulário da Web**.</span><span class="sxs-lookup"><span data-stu-id="872c9-125">In **Solution Explorer**, right-click your project and select **Add**, and then **Web Form**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image4.png)
2. <span data-ttu-id="872c9-126">Na caixa de diálogo **especificar nome para o item** , nomeie o novo **registro**de formulário da Web e, em seguida, selecione **OK**</span><span class="sxs-lookup"><span data-stu-id="872c9-126">In the **Specify Name for Item** dialog box, name the new web form **Register**, and then select **OK**</span></span>
3. <span data-ttu-id="872c9-127">Substitua a marcação no arquivo *Register. aspx* gerado pelo código a seguir.</span><span class="sxs-lookup"><span data-stu-id="872c9-127">Replace the markup in the generated *Register.aspx* file with the code below.</span></span> <span data-ttu-id="872c9-128">As alterações de código são realçadas.</span><span class="sxs-lookup"><span data-stu-id="872c9-128">The code changes are highlighted.</span></span> 

    [!code-html[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample1.aspx?highlight=9,12-40)]

    > [!NOTE]
    > <span data-ttu-id="872c9-129">Essa é apenas uma versão simplificada do arquivo *Register. aspx* que é criado quando você cria um novo projeto ASP.NET Web Forms.</span><span class="sxs-lookup"><span data-stu-id="872c9-129">This is just a simplified version of the *Register.aspx* file that is created when you create a new ASP.NET Web Forms project.</span></span> <span data-ttu-id="872c9-130">A marcação acima adiciona campos de formulário e um botão para registrar um novo usuário.</span><span class="sxs-lookup"><span data-stu-id="872c9-130">The markup above adds form fields and a button to register a new user.</span></span>
4. <span data-ttu-id="872c9-131">Abra o arquivo *Register.aspx.cs* e substitua o conteúdo do arquivo pelo código a seguir:</span><span class="sxs-lookup"><span data-stu-id="872c9-131">Open the *Register.aspx.cs* file and replace the contents of the file with the following code:</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample2.cs)]

    > [!NOTE] 
    > 
    > 1. <span data-ttu-id="872c9-132">O código acima é uma versão simplificada do arquivo *Register.aspx.cs* que é criada quando você cria um novo projeto de Web Forms do ASP.net.</span><span class="sxs-lookup"><span data-stu-id="872c9-132">The code above is a simplified version of the *Register.aspx.cs* file that is created when you create a new ASP.NET Web Forms project.</span></span>
    > 2. <span data-ttu-id="872c9-133">A classe *IdentityUser* é a implementação padrão do EntityFramework da interface *IUser* .</span><span class="sxs-lookup"><span data-stu-id="872c9-133">The *IdentityUser* class is the default EntityFramework implementation of the *IUser* interface.</span></span> <span data-ttu-id="872c9-134">A interface *IUser* é a interface mínima para um usuário no ASP.net Identity Core.</span><span class="sxs-lookup"><span data-stu-id="872c9-134">*IUser* interface is the minimal interface for a user on ASP.NET Identity Core.</span></span>
    > 3. <span data-ttu-id="872c9-135">A classe *USERSTORE* é a implementação padrão do EntityFramework de um armazenamento de usuário.</span><span class="sxs-lookup"><span data-stu-id="872c9-135">The *UserStore* class is the default EntityFramework implementation of a user store.</span></span> <span data-ttu-id="872c9-136">Essa classe implementa as interfaces mínimas do ASP.NET Identity Core: *IUserStore*, *IUserLoginStore*, *IUserClaimStore* e *IUserRoleStore*.</span><span class="sxs-lookup"><span data-stu-id="872c9-136">This class implements the ASP.NET Identity Core's minimal interfaces: *IUserStore*, *IUserLoginStore*, *IUserClaimStore* and *IUserRoleStore*.</span></span>
    > 4. <span data-ttu-id="872c9-137">A classe *usermanager* expõe as APIs relacionadas ao usuário, que salvarão automaticamente as alterações no *USERSTORE*.</span><span class="sxs-lookup"><span data-stu-id="872c9-137">The *UserManager* class exposes user related APIs which will automatically save changes to the *UserStore*.</span></span>
    > 5. <span data-ttu-id="872c9-138">A classe *IdentityResult* representa o resultado de uma operação de identidade.</span><span class="sxs-lookup"><span data-stu-id="872c9-138">The *IdentityResult* class represents the result of an identity operation.</span></span>
5. <span data-ttu-id="872c9-139">Em **Gerenciador de soluções**, clique com o botão direito do mouse em seu projeto e selecione **Adicionar**, **Adicionar pasta ASP.net** e, em seguida, **aplicativos\_dados**.</span><span class="sxs-lookup"><span data-stu-id="872c9-139">In **Solution Explorer**, right-click your project and select **Add**, **Add ASP.NET Folder** and then **App\_Data**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image5.png)
6. <span data-ttu-id="872c9-140">Abra o arquivo *Web. config* e adicione uma entrada de cadeia de conexão para o banco de dados que usaremos para armazenar informações do usuário.</span><span class="sxs-lookup"><span data-stu-id="872c9-140">Open the *Web.config* file and add a connection string entry for the database we will use to store user information.</span></span> <span data-ttu-id="872c9-141">O banco de dados será criado em tempo de execução pelo EntityFramework para as entidades de identidade.</span><span class="sxs-lookup"><span data-stu-id="872c9-141">The database will be created at runtime by EntityFramework for the Identity entities.</span></span> <span data-ttu-id="872c9-142">A cadeia de conexão é semelhante a uma criada para você quando você cria um novo projeto de Web Forms.</span><span class="sxs-lookup"><span data-stu-id="872c9-142">The connection string is similar to one created for you when you create a new Web Forms project.</span></span> <span data-ttu-id="872c9-143">O código realçado mostra a marcação que você deve adicionar:</span><span class="sxs-lookup"><span data-stu-id="872c9-143">The highlighted code shows the markup you should add:</span></span>

    [!code-xml[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample3.xml?highlight=11-14)]
    
    > [!NOTE] 
    > <span data-ttu-id="872c9-144">Para o Visual Studio 2015 ou superior, substitua `(localdb)\v11.0` por `(localdb)\MSSQLLocalDB` na cadeia de conexão.</span><span class="sxs-lookup"><span data-stu-id="872c9-144">For Visual Studio 2015 or higher, replace `(localdb)\v11.0` with `(localdb)\MSSQLLocalDB` in your connection string.</span></span>
    
7. <span data-ttu-id="872c9-145">Clique com o botão direito do mouse em File *Register. aspx* em seu projeto e selecione **definir como página inicial**.</span><span class="sxs-lookup"><span data-stu-id="872c9-145">Right click file *Register.aspx* in your project and select **Set as Start Page**.</span></span> <span data-ttu-id="872c9-146">Pressione CTRL + F5 para compilar e executar o aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="872c9-146">Press Ctrl + F5 to build and run the web application.</span></span> <span data-ttu-id="872c9-147">Insira um novo nome de usuário e senha e, em seguida, selecione **registrar**.</span><span class="sxs-lookup"><span data-stu-id="872c9-147">Enter a new user name and password and then select **Register**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image6.png)  

    > [!NOTE]
    > <span data-ttu-id="872c9-148">ASP.NET Identity tem suporte para validação e, neste exemplo, você pode verificar o comportamento padrão nos validadores de usuário e senha que vêm do pacote de identidade principal.</span><span class="sxs-lookup"><span data-stu-id="872c9-148">ASP.NET Identity has support for validation and in this sample you can verify the default behavior on User and Password validators that come from the Identity Core package.</span></span> <span data-ttu-id="872c9-149">O validador padrão para o usuário (`UserValidator`) tem uma propriedade `AllowOnlyAlphanumericUserNames` que tem o valor padrão definido como `true`.</span><span class="sxs-lookup"><span data-stu-id="872c9-149">The default validator for User (`UserValidator`) has a property `AllowOnlyAlphanumericUserNames` that has default value set to `true`.</span></span> <span data-ttu-id="872c9-150">O validador padrão para a senha (`MinimumLengthValidator`) garante que a senha tenha pelo menos 6 caracteres.</span><span class="sxs-lookup"><span data-stu-id="872c9-150">The default validator for Password (`MinimumLengthValidator`) ensures that password has at least 6 characters.</span></span> <span data-ttu-id="872c9-151">Esses validadores são propriedades em `UserManager` que podem ser substituídas se você quiser ter validação personalizada,</span><span class="sxs-lookup"><span data-stu-id="872c9-151">These validators are properties on `UserManager` that can be overridden if you want to have custom validation,</span></span>

## <a name="verify-the-localdb-identity-database-and-tables-generated-by-entity-framework"></a><span data-ttu-id="872c9-152">Verificar o banco de dados de identidade LocalDb e as tabelas geradas por Entity Framework</span><span class="sxs-lookup"><span data-stu-id="872c9-152">Verify the LocalDb Identity database and tables generated by Entity Framework</span></span>

1. <span data-ttu-id="872c9-153">No menu **Exibir** , selecione **Gerenciador de servidores**.</span><span class="sxs-lookup"><span data-stu-id="872c9-153">In the **View** menu, select **Server Explorer**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image7.png)
2. <span data-ttu-id="872c9-154">Expanda **DefaultConnection (WebFormsIdentity)** , expanda **tabelas**, clique com o botão direito do mouse em **AspNetUsers** e selecione **Mostrar dados da tabela**.</span><span class="sxs-lookup"><span data-stu-id="872c9-154">Expand **DefaultConnection (WebFormsIdentity)**, expand **Tables**, right-click **AspNetUsers** and then select **Show Table Data**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image8.png)  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image9.png)

## <a name="configure-the-application-for-owin-authentication"></a><span data-ttu-id="872c9-155">Configurar o aplicativo para autenticação OWIN</span><span class="sxs-lookup"><span data-stu-id="872c9-155">Configure the application for OWIN authentication</span></span>

<span data-ttu-id="872c9-156">Neste ponto, adicionamos apenas suporte para a criação de usuários.</span><span class="sxs-lookup"><span data-stu-id="872c9-156">At this point we have only added support for creating users.</span></span> <span data-ttu-id="872c9-157">Agora, vamos demonstrar como podemos adicionar autenticação para fazer logon em um usuário.</span><span class="sxs-lookup"><span data-stu-id="872c9-157">Now, we are going to demonstrate how we can add authentication to login a user.</span></span> <span data-ttu-id="872c9-158">ASP.NET Identity usa o middleware de autenticação OWIN da Microsoft para autenticação de formulários.</span><span class="sxs-lookup"><span data-stu-id="872c9-158">ASP.NET Identity uses Microsoft OWIN Authentication middleware for forms authentication.</span></span> <span data-ttu-id="872c9-159">A autenticação de cookie OWIN é um mecanismo de autenticação baseado em declarações e um cookie que pode ser usado por qualquer estrutura hospedada no [OWIN](https://msdn.microsoft.com/magazine/dn451439.aspx) ou no IIS.</span><span class="sxs-lookup"><span data-stu-id="872c9-159">The OWIN Cookie Authentication is a cookie and claims based authentication mechanism that can be used by any framework hosted on [OWIN](https://msdn.microsoft.com/magazine/dn451439.aspx) or IIS.</span></span> <span data-ttu-id="872c9-160">Com esse modelo, os mesmos pacotes de autenticação podem ser usados em várias estruturas, incluindo ASP.NET MVC e Web Forms.</span><span class="sxs-lookup"><span data-stu-id="872c9-160">With this model, the same authentication packages can be used across multiple frameworks including ASP.NET MVC and Web Forms.</span></span> <span data-ttu-id="872c9-161">Para obter mais informações sobre o projeto Katana e como executar o middleware em um host independente, consulte [introdução com o projeto Katana](https://msdn.microsoft.com/magazine/dn451439.aspx).</span><span class="sxs-lookup"><span data-stu-id="872c9-161">For more information on project Katana and how to run middleware in a host agnostic see [Getting Started with the Katana Project](https://msdn.microsoft.com/magazine/dn451439.aspx).</span></span>

## <a name="install-authentication-packages-to-your-application"></a><span data-ttu-id="872c9-162">Instalar pacotes de autenticação em seu aplicativo</span><span class="sxs-lookup"><span data-stu-id="872c9-162">Install authentication packages to your application</span></span>

1. <span data-ttu-id="872c9-163">Em Gerenciador de Soluções, clique com o botão direito do mouse em seu projeto e selecione **gerenciar pacotes NuGet**.</span><span class="sxs-lookup"><span data-stu-id="872c9-163">In Solution Explorer, right-click your project and select **Manage NuGet Packages**.</span></span> <span data-ttu-id="872c9-164">Procure e instale o pacote ***Microsoft. AspNet. Identity. Owin*** .</span><span class="sxs-lookup"><span data-stu-id="872c9-164">Search for and install the ***Microsoft.AspNet.Identity.Owin*** package.</span></span> 
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image16.png)

2. <span data-ttu-id="872c9-165">Procure e instale o pacote ***Microsoft. Owin. host. SystemWeb*** .</span><span class="sxs-lookup"><span data-stu-id="872c9-165">Search for and install the ***Microsoft.Owin.Host.SystemWeb*** package.</span></span>

    > [!NOTE]
    > <span data-ttu-id="872c9-166">O pacote **Microsoft. AspNet. Identity. Owin** contém um conjunto de classes de extensão Owin para gerenciar e configurar o middleware de autenticação Owin a ser consumido por pacotes de núcleo ASP.net Identity.</span><span class="sxs-lookup"><span data-stu-id="872c9-166">The **Microsoft.Aspnet.Identity.Owin** package contains a set of OWIN extension classes to manage and configure OWIN authentication middleware to be consumed by ASP.NET Identity Core packages.</span></span>
    > <span data-ttu-id="872c9-167">O pacote **Microsoft. Owin. host. SystemWeb** contém um servidor Owin que permite que aplicativos baseados em Owin sejam executados no IIS usando o pipeline de solicitação ASP.net.</span><span class="sxs-lookup"><span data-stu-id="872c9-167">The **Microsoft.Owin.Host.SystemWeb** package contains an OWIN server that enables OWIN-based applications to run on IIS using the ASP.NET request pipeline.</span></span> <span data-ttu-id="872c9-168">Para obter mais informações, consulte [middleware OWIN no pipeline integrado do IIS](../../../aspnet/overview/owin-and-katana/owin-middleware-in-the-iis-integrated-pipeline.md).</span><span class="sxs-lookup"><span data-stu-id="872c9-168">For more information see [OWIN Middleware in the IIS integrated pipeline](../../../aspnet/overview/owin-and-katana/owin-middleware-in-the-iis-integrated-pipeline.md).</span></span>

## <a name="add-owin-startup-and-authentication-configuration-classes"></a><span data-ttu-id="872c9-169">Adicionar classes de configuração de inicialização e autenticação do OWIN</span><span class="sxs-lookup"><span data-stu-id="872c9-169">Add OWIN startup and authentication configuration classes</span></span>

1. <span data-ttu-id="872c9-170">Em **Gerenciador de soluções**, clique com o botão direito do mouse em seu projeto, selecione **Adicionar**e **Adicionar novo item**.</span><span class="sxs-lookup"><span data-stu-id="872c9-170">In **Solution Explorer**, right-click your project, select **Add**, and then **Add New Item**.</span></span> <span data-ttu-id="872c9-171">No diálogo Pesquisar caixa de texto, digite "*Owin*".</span><span class="sxs-lookup"><span data-stu-id="872c9-171">In the search text box dialog, type "*owin*".</span></span> <span data-ttu-id="872c9-172">Nomeie a classe "*Startup*" e selecione **Adicionar**.</span><span class="sxs-lookup"><span data-stu-id="872c9-172">Name the class "*Startup*" and select **Add**.</span></span> 
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image11.png)
2. <span data-ttu-id="872c9-173">No arquivo Startup.cs, adicione o código realçado mostrado abaixo para configurar a autenticação de cookie do OWIN.</span><span class="sxs-lookup"><span data-stu-id="872c9-173">In the Startup.cs file, add the highlighted code shown below to configure OWIN cookie authentication.</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample4.cs?highlight=1,3,15-19)]

    > [!NOTE]
    > <span data-ttu-id="872c9-174">Essa classe contém o atributo `OwinStartup` para especificar a classe de inicialização OWIN.</span><span class="sxs-lookup"><span data-stu-id="872c9-174">This class contains the `OwinStartup` attribute for specifying the OWIN startup class.</span></span> <span data-ttu-id="872c9-175">Cada aplicativo OWIN tem uma classe de inicialização na qual você especifica componentes para o pipeline de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="872c9-175">Every OWIN application has a startup class where you specify components for the application pipeline.</span></span> <span data-ttu-id="872c9-176">Consulte [detecção de classe de inicialização OWIN](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) para obter mais informações sobre este modelo.</span><span class="sxs-lookup"><span data-stu-id="872c9-176">See [OWIN Startup Class Detection](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) for more info on this model.</span></span>

## <a name="add-web-forms-for-registering-and-signing-in-users"></a><span data-ttu-id="872c9-177">Adicionar formulários da Web para registro e entrada de usuários</span><span class="sxs-lookup"><span data-stu-id="872c9-177">Add web forms for registering and signing in users</span></span>

1. <span data-ttu-id="872c9-178">Abra o arquivo *Register.aspx.cs* e adicione o código a seguir que assina o usuário quando o registro é executado com sucesso.</span><span class="sxs-lookup"><span data-stu-id="872c9-178">Open the *Register.aspx.cs* file and add the following code which signs in the user when registration succeeds.</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample5.cs)]

    > [!NOTE] 
    > 
    > - <span data-ttu-id="872c9-179">Como a autenticação de cookie ASP.NET Identity e OWIN é um sistema baseado em declarações, a estrutura requer que o desenvolvedor do aplicativo gere um [ClaimsIdentity](https://msdn.microsoft.com/library/microsoft.identitymodel.claims.claimsidentity.aspx) para o usuário.</span><span class="sxs-lookup"><span data-stu-id="872c9-179">Since ASP.NET Identity and OWIN Cookie Authentication are claims based system, the framework requires the app developer to generate a [ClaimsIdentity](https://msdn.microsoft.com/library/microsoft.identitymodel.claims.claimsidentity.aspx) for the user.</span></span> <span data-ttu-id="872c9-180">ClaimsIdentity tem informações sobre todas as declarações para o usuário, como a quais funções o usuário pertence.</span><span class="sxs-lookup"><span data-stu-id="872c9-180">ClaimsIdentity has information about all the claims for the user such as what Roles the user belongs to.</span></span> <span data-ttu-id="872c9-181">Você também pode adicionar mais declarações para o usuário neste estágio.</span><span class="sxs-lookup"><span data-stu-id="872c9-181">You can also add more claims for the user at this stage.</span></span>
    > - <span data-ttu-id="872c9-182">Você pode entrar no usuário usando o CustomTargetNameDictionary de OWIN e chamando `SignIn` e passando o ClaimsIdentity conforme mostrado acima.</span><span class="sxs-lookup"><span data-stu-id="872c9-182">You can sign in the user by using the AuthenticationManager from OWIN and calling `SignIn` and passing in the ClaimsIdentity as shown above.</span></span> <span data-ttu-id="872c9-183">Esse código conectará o usuário e gerará um cookie também.</span><span class="sxs-lookup"><span data-stu-id="872c9-183">This code will sign in the user and generate a cookie as well.</span></span> <span data-ttu-id="872c9-184">Essa chamada é análoga a [FormAuthentication. SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) usado pelo módulo [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) .</span><span class="sxs-lookup"><span data-stu-id="872c9-184">This call is analogous to [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
2. <span data-ttu-id="872c9-185">Em **Gerenciador de soluções**, clique com o botão direito do mouse no projeto, selecione **Adicionar**e, em seguida, **formulário da Web**.</span><span class="sxs-lookup"><span data-stu-id="872c9-185">In **Solution Explorer**, right-click your project, select **Add**, and then **Web Form**.</span></span> <span data-ttu-id="872c9-186">Nomeie o **logon**do Web Form.</span><span class="sxs-lookup"><span data-stu-id="872c9-186">Name the web form **Login**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image12.png)
3. <span data-ttu-id="872c9-187">Substitua o conteúdo do arquivo *login. aspx* pelo código a seguir:</span><span class="sxs-lookup"><span data-stu-id="872c9-187">Replace the contents of the *Login.aspx* file with the following code:</span></span>

    [!code-aspx[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample6.aspx)]
4. <span data-ttu-id="872c9-188">Substitua o conteúdo do arquivo *login.aspx.cs* pelo seguinte:</span><span class="sxs-lookup"><span data-stu-id="872c9-188">Replace the contents of the *Login.aspx.cs* file with the following:</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample7.cs)]

    > [!NOTE] 
    > 
    > - <span data-ttu-id="872c9-189">O `Page_Load` agora verifica o status do usuário atual e executa uma ação com base em seu status de `Context.User.Identity.IsAuthenticated`.</span><span class="sxs-lookup"><span data-stu-id="872c9-189">The `Page_Load` now checks for the status of current user and takes action based on its `Context.User.Identity.IsAuthenticated` status.</span></span>
    >   <span data-ttu-id="872c9-190">**Exibir nome de usuário conectado** : o Microsoft ASP.NET estrutura de identidade adicionou métodos de extensão em [System. Security. principal. IIdentity](https://msdn.microsoft.com/library/system.security.principal.iidentity.aspx) que permite que você obtenha o `UserName` e `UserId` para o usuário conectado.</span><span class="sxs-lookup"><span data-stu-id="872c9-190">**Display Logged in User Name** : The Microsoft ASP.NET Identity Framework has added extension methods on [System.Security.Principal.IIdentity](https://msdn.microsoft.com/library/system.security.principal.iidentity.aspx) that allows you to get the `UserName` and `UserId`  for the logged in User.</span></span> <span data-ttu-id="872c9-191">Esses métodos de extensão são definidos no assembly `Microsoft.AspNet.Identity.Core`.</span><span class="sxs-lookup"><span data-stu-id="872c9-191">These extension methods are defined in the `Microsoft.AspNet.Identity.Core` assembly.</span></span> <span data-ttu-id="872c9-192">Esses métodos de extensão são a substituição para [HttpContext.User.Identity.Name](https://msdn.microsoft.com/library/system.web.httpcontext.user.aspx) .</span><span class="sxs-lookup"><span data-stu-id="872c9-192">These extension methods are the replacement for [HttpContext.User.Identity.Name](https://msdn.microsoft.com/library/system.web.httpcontext.user.aspx) .</span></span>
    > - <span data-ttu-id="872c9-193">Método de entrada: `This` método substitui o método `CreateUser_Click` anterior neste exemplo e agora entra no usuário depois de criar o usuário com êxito.</span><span class="sxs-lookup"><span data-stu-id="872c9-193">SignIn method: `This` method replaces the previous `CreateUser_Click` method in this sample and now signs in the user after successfully creating the user.</span></span>   
    >   <span data-ttu-id="872c9-194">O Microsoft OWIN Framework adicionou métodos de extensão em `System.Web.HttpContext` que permite obter uma referência a um `IOwinContext`.</span><span class="sxs-lookup"><span data-stu-id="872c9-194">The Microsoft OWIN Framework has added extension methods on `System.Web.HttpContext` that allows you to get a reference to an `IOwinContext`.</span></span> <span data-ttu-id="872c9-195">Esses métodos de extensão são definidos no assembly `Microsoft.Owin.Host.SystemWeb`.</span><span class="sxs-lookup"><span data-stu-id="872c9-195">These extension methods are defined in `Microsoft.Owin.Host.SystemWeb` assembly.</span></span> <span data-ttu-id="872c9-196">A classe `OwinContext` expõe uma propriedade `IAuthenticationManager` que representa a funcionalidade de middleware de autenticação disponível na solicitação atual.</span><span class="sxs-lookup"><span data-stu-id="872c9-196">The `OwinContext` class exposes an `IAuthenticationManager` property that represents the Authentication middleware functionality available on the current request.</span></span> <span data-ttu-id="872c9-197">Você pode entrar no usuário usando o `AuthenticationManager` de OWIN e chamando `SignIn` e passando o `ClaimsIdentity` conforme mostrado acima.</span><span class="sxs-lookup"><span data-stu-id="872c9-197">You can sign in the user by using the `AuthenticationManager` from OWIN and calling `SignIn` and passing in the `ClaimsIdentity` as shown above.</span></span> <span data-ttu-id="872c9-198">Como a autenticação de cookie ASP.NET Identity e OWIN é um sistema baseado em declarações, a estrutura requer que o aplicativo gere um `ClaimsIdentity` para o usuário.</span><span class="sxs-lookup"><span data-stu-id="872c9-198">Because ASP.NET Identity and OWIN Cookie Authentication are claims-based system, the framework requires the app to generate a `ClaimsIdentity` for the user.</span></span> <span data-ttu-id="872c9-199">O `ClaimsIdentity` tem informações sobre todas as declarações para o usuário, como as funções às quais o usuário pertence.</span><span class="sxs-lookup"><span data-stu-id="872c9-199">The `ClaimsIdentity` has information about all the claims for the user, such as what roles the user belongs to.</span></span> <span data-ttu-id="872c9-200">Você também pode adicionar mais declarações para o usuário neste estágio. esse código entrará no usuário e gerará um cookie também.</span><span class="sxs-lookup"><span data-stu-id="872c9-200">You can also add more claims for the user at this stage This code will sign in the user and generate a cookie as well.</span></span> <span data-ttu-id="872c9-201">Essa chamada é análoga a [FormAuthentication. SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) usado pelo módulo [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) .</span><span class="sxs-lookup"><span data-stu-id="872c9-201">This call is analogous to [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
    > - <span data-ttu-id="872c9-202">método de `SignOut`: Obtém uma referência ao `AuthenticationManager` de OWIN e chama `SignOut`.</span><span class="sxs-lookup"><span data-stu-id="872c9-202">`SignOut` method: Gets a reference to the `AuthenticationManager` from OWIN and calls `SignOut`.</span></span> <span data-ttu-id="872c9-203">Isso é análogo ao método [FormsAuthentication. SignOut](https://msdn.microsoft.com/library/system.web.security.formsauthentication.signout.aspx) usado pelo módulo [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) .</span><span class="sxs-lookup"><span data-stu-id="872c9-203">This is analogous to [FormsAuthentication.SignOut](https://msdn.microsoft.com/library/system.web.security.formsauthentication.signout.aspx) method used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
5. <span data-ttu-id="872c9-204">Pressione **Ctrl + F5** para compilar e executar o aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="872c9-204">Press **Ctrl + F5** to build and run the web application.</span></span> <span data-ttu-id="872c9-205">Insira um novo nome de usuário e senha e, em seguida, selecione **registrar**.</span><span class="sxs-lookup"><span data-stu-id="872c9-205">Enter a new user name and password and then select **Register**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image13.png)  
   <span data-ttu-id="872c9-206">Observação: neste ponto, o novo usuário é criado e conectado.</span><span class="sxs-lookup"><span data-stu-id="872c9-206">Note: At this point, the new user is created and logged in.</span></span>
6. <span data-ttu-id="872c9-207">Selecione o botão **fazer logoff** .</span><span class="sxs-lookup"><span data-stu-id="872c9-207">Select the **Log out** button.</span></span> <span data-ttu-id="872c9-208">Você será redirecionado para o formulário de logon.</span><span class="sxs-lookup"><span data-stu-id="872c9-208">You are redirected to the Log in form.</span></span>
7. <span data-ttu-id="872c9-209">Insira um nome de usuário ou senha inválido e selecione o botão **fazer logon** .</span><span class="sxs-lookup"><span data-stu-id="872c9-209">Enter an invalid user name or password and select the **Log in** button.</span></span> 
   <span data-ttu-id="872c9-210">O método `UserManager.Find` retornará NULL e a mensagem de erro: " *nome de usuário ou senha inválido* " será exibido.</span><span class="sxs-lookup"><span data-stu-id="872c9-210">The `UserManager.Find`  method will return null and the error message: " *Invalid user name or password* " will be displayed.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image14.png)
