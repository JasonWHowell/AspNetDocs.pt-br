---
uid: identity/overview/getting-started/aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider
title: 'ASP.NET Identity: usando o armazenamento do MySQL com um provedor deC#MySQL do EntityFramework ()-ASP.NET 4. x'
author: maumar
description: Este tutorial mostra como substituir o mecanismo de armazenamento de dados padrão para ASP.NET Identity com o EntityFramework (provedor do cliente SQL) com um MySQL provid...
ms.author: riande
ms.date: 12/10/2013
ms.assetid: 15253312-a92c-43ba-908e-b5dacd3d08b8
ms.custom: seoapril2019
msc.legacyurl: /identity/overview/getting-started/aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider
msc.type: authoredcontent
ms.openlocfilehash: e89ed139657c5ce9ddcc56879946c62038919483
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78584003"
---
# <a name="aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider-c"></a><span data-ttu-id="43afd-103">ASP.NET Identity: usando o armazenamento do MySQL com um provedor deC#MySQL do EntityFramework ()</span><span class="sxs-lookup"><span data-stu-id="43afd-103">ASP.NET Identity: Using MySQL Storage with an EntityFramework MySQL Provider (C#)</span></span>

<span data-ttu-id="43afd-104">por [Maurycy Markowski](https://github.com/maumar), [Raquel Soares de Almeida](https://github.com/raquelsa), [Robert McMurray](https://github.com/rmcmurray)</span><span class="sxs-lookup"><span data-stu-id="43afd-104">by [Maurycy Markowski](https://github.com/maumar), [Raquel Soares De Almeida](https://github.com/raquelsa), [Robert McMurray](https://github.com/rmcmurray)</span></span>

> <span data-ttu-id="43afd-105">Este tutorial mostra como substituir o mecanismo de armazenamento de dados padrão para [**ASP.net Identity**](introduction-to-aspnet-identity.md) com o EntityFramework (provedor do cliente SQL) com um provedor MySQL.</span><span class="sxs-lookup"><span data-stu-id="43afd-105">This tutorial shows you how to replace the default data storage mechanism for [**ASP.NET Identity**](introduction-to-aspnet-identity.md) with EntityFramework (SQL client provider) with a MySQL provider.</span></span>

<span data-ttu-id="43afd-106">Os tópicos a seguir serão abordados neste tutorial:</span><span class="sxs-lookup"><span data-stu-id="43afd-106">The following topics will be covered in this tutorial:</span></span>

- <span data-ttu-id="43afd-107">Criando um banco de dados MySQL no Azure</span><span class="sxs-lookup"><span data-stu-id="43afd-107">Creating a MySQL database on Azure</span></span>
- <span data-ttu-id="43afd-108">Criando um aplicativo MVC usando Visual Studio 2013 modelo MVC</span><span class="sxs-lookup"><span data-stu-id="43afd-108">Creating an MVC application using Visual Studio 2013 MVC template</span></span>
- <span data-ttu-id="43afd-109">Configurando o EntityFramework para trabalhar com um provedor de banco de dados MySQL</span><span class="sxs-lookup"><span data-stu-id="43afd-109">Configuring EntityFramework to work with a MySQL database provider</span></span>
- <span data-ttu-id="43afd-110">Executando o aplicativo para verificar os resultados</span><span class="sxs-lookup"><span data-stu-id="43afd-110">Running the application to verify the results</span></span>

<span data-ttu-id="43afd-111">No final deste tutorial, você terá um aplicativo MVC com a ASP.NET Identity Store que está usando um banco de dados MySQL hospedado no Azure.</span><span class="sxs-lookup"><span data-stu-id="43afd-111">At the end of this tutorial, you will have an MVC application with the ASP.NET Identity store that is using a MySQL database that is hosted in Azure.</span></span>

## <a name="creating-a-mysql-database-instance-on-azure"></a><span data-ttu-id="43afd-112">Criando uma instância de banco de dados MySQL no Azure</span><span class="sxs-lookup"><span data-stu-id="43afd-112">Creating a MySQL database instance on Azure</span></span>

1. <span data-ttu-id="43afd-113">Faça logon no [Portal do Azure](https://go.microsoft.com/fwlink/?linkid=529715&amp;clcid=0x409).</span><span class="sxs-lookup"><span data-stu-id="43afd-113">Log in to the [Azure Portal](https://go.microsoft.com/fwlink/?linkid=529715&amp;clcid=0x409).</span></span>
2. <span data-ttu-id="43afd-114">Clique em **novo** na parte inferior da página e, em seguida, selecione **armazenar**:</span><span class="sxs-lookup"><span data-stu-id="43afd-114">Click **NEW** at the bottom of the page, and then select **STORE**:</span></span>

    [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image2.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image1.png)
3. <span data-ttu-id="43afd-115">No assistente **escolher e complemento** , selecione banco de **dados MySQL ClearDB**e clique na seta **Avançar** na parte inferior do quadro:</span><span class="sxs-lookup"><span data-stu-id="43afd-115">In the **Choose and Add-on** wizard, select **ClearDB MySQL Database**, and then click the **Next** arrow at the bottom of the frame:</span></span>

   <span data-ttu-id="43afd-116">[Clique na imagem a seguir para expandi-la.</span><span class="sxs-lookup"><span data-stu-id="43afd-116">[Click the following image to expand it.</span></span> <span data-ttu-id="43afd-117">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image4.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="43afd-117">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image4.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image3.png)</span></span>
4. <span data-ttu-id="43afd-118">Mantenha o plano **gratuito** padrão, altere o **nome** para **IdentityMySQLDatabase**, selecione a região mais próxima de você e clique na seta **Avançar** na parte inferior do quadro:</span><span class="sxs-lookup"><span data-stu-id="43afd-118">Keep the default **Free** plan, change the **NAME** to **IdentityMySQLDatabase**, select the region that is nearest to you, and then click the **Next** arrow at the bottom of the frame:</span></span>

   <span data-ttu-id="43afd-119">[Clique na imagem a seguir para expandi-la.</span><span class="sxs-lookup"><span data-stu-id="43afd-119">[Click the following image to expand it.</span></span> <span data-ttu-id="43afd-120">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image6.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="43afd-120">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image6.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image5.png)</span></span>
5. <span data-ttu-id="43afd-121">Clique na marca de seleção de **compra** para concluir a criação do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="43afd-121">Click the **PURCHASE** checkmark to complete the database creation.</span></span>

   <span data-ttu-id="43afd-122">[Clique na imagem a seguir para expandi-la.</span><span class="sxs-lookup"><span data-stu-id="43afd-122">[Click the following image to expand it.</span></span> <span data-ttu-id="43afd-123">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image8.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="43afd-123">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image8.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image7.png)</span></span>
6. <span data-ttu-id="43afd-124">Depois que o banco de dados tiver sido criado, você pode gerenciá-lo na guia **COMPLEMENTOS** no portal de gerenciamento.</span><span class="sxs-lookup"><span data-stu-id="43afd-124">After your database has been created, you can manage it from the **ADD-ONS** tab in the management portal.</span></span> <span data-ttu-id="43afd-125">Para recuperar as informações de conexão do banco de dados, clique em **informações de conexão** na parte inferior da página:</span><span class="sxs-lookup"><span data-stu-id="43afd-125">To retrieve the connection information for your database, click **CONNECTION INFO** at the bottom of the page:</span></span>

   <span data-ttu-id="43afd-126">[Clique na imagem a seguir para expandi-la.</span><span class="sxs-lookup"><span data-stu-id="43afd-126">[Click the following image to expand it.</span></span> <span data-ttu-id="43afd-127">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image10.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="43afd-127">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image10.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image9.png)</span></span>
7. <span data-ttu-id="43afd-128">Copie a cadeia de conexão clicando no botão Copiar pelo campo **CONNECTIONSTRING** e salve-a; Você usará essas informações posteriormente neste tutorial para seu aplicativo MVC:</span><span class="sxs-lookup"><span data-stu-id="43afd-128">Copy the connection string by clicking on the copy button by the **CONNECTIONSTRING** field and save it; you will use this information later in this tutorial for your MVC application:</span></span>

   <span data-ttu-id="43afd-129">[Clique na imagem a seguir para expandi-la.</span><span class="sxs-lookup"><span data-stu-id="43afd-129">[Click the following image to expand it.</span></span> <span data-ttu-id="43afd-130">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image12.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="43afd-130">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image12.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image11.png)</span></span>

## <a name="creating-an-mvc-application-project"></a><span data-ttu-id="43afd-131">Criando um projeto de aplicativo MVC</span><span class="sxs-lookup"><span data-stu-id="43afd-131">Creating an MVC application project</span></span>

<span data-ttu-id="43afd-132">Para concluir as etapas nesta seção do tutorial, primeiro será necessário instalar [Visual Studio Express 2013 para Web](https://go.microsoft.com/fwlink/?LinkId=299058) ou [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span><span class="sxs-lookup"><span data-stu-id="43afd-132">To complete the steps in this section of the tutorial, you will first need to install [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) or [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span></span> <span data-ttu-id="43afd-133">Depois que o Visual Studio tiver sido instalado, use as seguintes etapas para criar um novo projeto de aplicativo MVC:</span><span class="sxs-lookup"><span data-stu-id="43afd-133">Once Visual Studio has been installed, use the following steps to create a new MVC application project:</span></span>

1. <span data-ttu-id="43afd-134">Abra o Visual Studio 2103.</span><span class="sxs-lookup"><span data-stu-id="43afd-134">Open Visual Studio 2103.</span></span>
2. <span data-ttu-id="43afd-135">Clique em **novo projeto** na página **inicial** , ou você pode clicar no menu **arquivo** e em **novo projeto**:</span><span class="sxs-lookup"><span data-stu-id="43afd-135">Click **New Project** from the **Start** page, or you can click the **File** menu and then **New Project**:</span></span>

   <span data-ttu-id="43afd-136">[Clique na imagem a seguir para expandi-la.</span><span class="sxs-lookup"><span data-stu-id="43afd-136">[Click the following image to expand it.</span></span> <span data-ttu-id="43afd-137">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image2.jpg)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image1.jpg)</span><span class="sxs-lookup"><span data-stu-id="43afd-137">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image2.jpg)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image1.jpg)</span></span>
3. <span data-ttu-id="43afd-138">Quando a caixa de diálogo **novo projeto** for exibida, expanda **Visual C#**  na lista de modelos, clique em **Web**e selecione **aplicativo Web ASP.net**.</span><span class="sxs-lookup"><span data-stu-id="43afd-138">When the **New Project** dialog box is displayed, expand **Visual C#** in the list of templates, then click **Web**, and select **ASP.NET Web Application**.</span></span> <span data-ttu-id="43afd-139">Nomeie seu projeto **IdentityMySQLDemo** e clique em **OK**:</span><span class="sxs-lookup"><span data-stu-id="43afd-139">Name your project **IdentityMySQLDemo** and then click **OK**:</span></span>

   <span data-ttu-id="43afd-140">[Clique na imagem a seguir para expandi-la.</span><span class="sxs-lookup"><span data-stu-id="43afd-140">[Click the following image to expand it.</span></span> <span data-ttu-id="43afd-141">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image14.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="43afd-141">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image14.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image13.png)</span></span>
4. <span data-ttu-id="43afd-142">Na caixa de diálogo **novo projeto ASP.net** , selecione o **MVC** templatewith as opções padrão; Isso irá configurar **contas de usuário individuais** como o método de autenticação.</span><span class="sxs-lookup"><span data-stu-id="43afd-142">In the **New ASP.NET Project** dialog, select the **MVC** templatewith the default options; this will configure **Individual User Accounts** as the authentication method.</span></span> <span data-ttu-id="43afd-143">Clique em **OK**:</span><span class="sxs-lookup"><span data-stu-id="43afd-143">Click **OK**:</span></span>

   <span data-ttu-id="43afd-144">[Clique na imagem a seguir para expandi-la.</span><span class="sxs-lookup"><span data-stu-id="43afd-144">[Click the following image to expand it.</span></span> <span data-ttu-id="43afd-145">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image16.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="43afd-145">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image16.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image15.png)</span></span>

## <a name="configure-entityframework-to-work-with-a-mysql-database"></a><span data-ttu-id="43afd-146">Configurar o EntityFramework para funcionar com um banco de dados MySQL</span><span class="sxs-lookup"><span data-stu-id="43afd-146">Configure EntityFramework to work with a MySQL database</span></span>

### <a name="update-the-entity-framework-assembly-for-your-project"></a><span data-ttu-id="43afd-147">Atualizar o assembly Entity Framework para seu projeto</span><span class="sxs-lookup"><span data-stu-id="43afd-147">Update the Entity Framework assembly for your project</span></span>

<span data-ttu-id="43afd-148">O aplicativo MVC criado a partir do modelo de Visual Studio 2013 contém uma referência ao pacote do [EntityFramework 6.0.0](http://www.nuget.org/packages/EntityFramework) , mas houve atualizações para esse assembly desde sua versão, que contêm melhorias significativas de desempenho.</span><span class="sxs-lookup"><span data-stu-id="43afd-148">The MVC application that was created from the Visual Studio 2013 template contains a reference to the [EntityFramework 6.0.0](http://www.nuget.org/packages/EntityFramework) package, but there have been updates to that assembly since its release which contain significant performance improvements.</span></span> <span data-ttu-id="43afd-149">Para usar essas atualizações mais recentes em seu aplicativo, use as etapas a seguir.</span><span class="sxs-lookup"><span data-stu-id="43afd-149">In order to use these latest updates in your application, use the following steps.</span></span>

1. <span data-ttu-id="43afd-150">Abra seu projeto MVC no Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="43afd-150">Open your MVC project in Visual Studio.</span></span>
2. <span data-ttu-id="43afd-151">Clique em **ferramentas**, em **Gerenciador de pacotes NuGet**e em **console do Gerenciador de pacotes**:</span><span class="sxs-lookup"><span data-stu-id="43afd-151">Click **Tools**, then click **NuGet Package Manager**, and then click **Package Manager Console**:</span></span>

   <span data-ttu-id="43afd-152">[Clique na imagem a seguir para expandi-la.</span><span class="sxs-lookup"><span data-stu-id="43afd-152">[Click the following image to expand it.</span></span> <span data-ttu-id="43afd-153">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image18.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="43afd-153">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image18.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image17.png)</span></span>
3. <span data-ttu-id="43afd-154">O **console do Gerenciador de pacotes** aparecerá na seção inferior do Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="43afd-154">The **Package Manager Console** will appear in the bottom section of Visual Studio.</span></span> <span data-ttu-id="43afd-155">Digite &quot;**Update-Package EntityFramework**&quot; e pressione ENTER:</span><span class="sxs-lookup"><span data-stu-id="43afd-155">Type &quot;**Update-Package EntityFramework**&quot; and press Enter:</span></span>

   <span data-ttu-id="43afd-156">[Clique na imagem a seguir para expandi-la.</span><span class="sxs-lookup"><span data-stu-id="43afd-156">[Click the following image to expand it.</span></span> <span data-ttu-id="43afd-157">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image20.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="43afd-157">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image20.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image19.png)</span></span>

### <a name="install-the-mysql-provider-for-entityframework"></a><span data-ttu-id="43afd-158">Instalar o provedor MySQL para o EntityFramework</span><span class="sxs-lookup"><span data-stu-id="43afd-158">Install the MySQL provider for EntityFramework</span></span>

<span data-ttu-id="43afd-159">Para que o EntityFramework se conecte ao banco de dados MySQL, você precisa instalar um provedor MySQL.</span><span class="sxs-lookup"><span data-stu-id="43afd-159">In order for EntityFramework to connect to MySQL database, you need to install a MySQL provider.</span></span> <span data-ttu-id="43afd-160">Para fazer isso, abra o **console do Gerenciador de pacotes** e digite &quot;**install-Package MySQL. Data. Entity-pre**&quot;e pressione Enter.</span><span class="sxs-lookup"><span data-stu-id="43afd-160">To do so, open the **Package Manager Console** and type &quot;**Install-Package MySql.Data.Entity -Pre**&quot;, and then press Enter.</span></span>

> [!NOTE]
> <span data-ttu-id="43afd-161">Esta é uma versão de pré-lançamento do assembly e, como tal, pode conter bugs.</span><span class="sxs-lookup"><span data-stu-id="43afd-161">This is a pre-release version of the assembly, and as such it may contain bugs.</span></span> <span data-ttu-id="43afd-162">Você não deve usar uma versão de pré-lançamento do provedor em produção.</span><span class="sxs-lookup"><span data-stu-id="43afd-162">You should not use a pre-release version of the provider in production.</span></span>

<span data-ttu-id="43afd-163">[Clique na imagem a seguir para expandi-la.]</span><span class="sxs-lookup"><span data-stu-id="43afd-163">[Click the following image to expand it.]</span></span>

[![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image22.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image21.png)

### <a name="making-project-configuration-changes-to-the-webconfig-file-for-your-application"></a><span data-ttu-id="43afd-164">Fazendo alterações de configuração do projeto no arquivo Web. config para seu aplicativo</span><span class="sxs-lookup"><span data-stu-id="43afd-164">Making project configuration changes to the Web.config file for your application</span></span>

<span data-ttu-id="43afd-165">Nesta seção, você configurará o Entity Framework para usar o provedor MySQL que acabou de instalar, registrar a fábrica do provedor MySQL e adicionar a cadeia de conexão do Azure.</span><span class="sxs-lookup"><span data-stu-id="43afd-165">In this section you will configure the Entity Framework to use the MySQL provider that you just installed, register the MySQL provider factory, and add your connection string from Azure.</span></span>

> [!NOTE]
> <span data-ttu-id="43afd-166">Os exemplos a seguir contêm uma versão de assembly específica para MySql. Data. dll.</span><span class="sxs-lookup"><span data-stu-id="43afd-166">The following examples contain a specific assembly version for MySql.Data.dll.</span></span> <span data-ttu-id="43afd-167">Se a versão do assembly for alterada, será necessário modificar as definições de configuração apropriadas com a versão correta.</span><span class="sxs-lookup"><span data-stu-id="43afd-167">If the assembly version changes, you will need to modify the appropriate configuration settings with the correct version.</span></span>

1. <span data-ttu-id="43afd-168">Abra o arquivo Web. config para seu projeto no Visual Studio 2013.</span><span class="sxs-lookup"><span data-stu-id="43afd-168">Open the Web.config file for your project in Visual Studio 2013.</span></span>
2. <span data-ttu-id="43afd-169">Localize as seguintes definições de configuração, que definem o provedor de banco de dados padrão e a fábrica para o Entity Framework:</span><span class="sxs-lookup"><span data-stu-id="43afd-169">Locate the following configuration settings, which define the default database provider and factory for the Entity Framework:</span></span>

    [!code-xml[Main](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/samples/sample1.xml)]
3. <span data-ttu-id="43afd-170">Substitua esses parâmetros de configuração pelo seguinte, que irá configurar o Entity Framework para usar o provedor MySQL:</span><span class="sxs-lookup"><span data-stu-id="43afd-170">Replace those configuration settings with the following, which will configure the Entity Framework to use the MySQL provider:</span></span>

    [!code-xml[Main](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/samples/sample2.xml)]
4. <span data-ttu-id="43afd-171">Localize a seção &lt;connectionStrings&gt; e substitua-a pelo código a seguir, que definirá a cadeia de conexão para o banco de dados MySQL que está hospedado no Azure (Observe que o valor providerName também foi alterado do original):</span><span class="sxs-lookup"><span data-stu-id="43afd-171">Locate the &lt;connectionStrings&gt; section and replace it with the following code, which will define the connection string for your MySQL database that is hosted on Azure (note that providerName value has also been changed from the original):</span></span>

    [!code-xml[Main](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/samples/sample3.xml?highlight=3-4)]

### <a name="adding-custom-migrationhistory-context"></a><span data-ttu-id="43afd-172">Adicionando contexto de MigrationHistory personalizado</span><span class="sxs-lookup"><span data-stu-id="43afd-172">Adding custom MigrationHistory context</span></span>

<span data-ttu-id="43afd-173">Entity Framework Code First usa uma tabela **MigrationHistory** para controlar as alterações de modelo e garantir a consistência entre o esquema de banco de dados e o esquema conceitual.</span><span class="sxs-lookup"><span data-stu-id="43afd-173">Entity Framework Code First uses a **MigrationHistory** table to keep track of model changes and to ensure the consistency between the database schema and conceptual schema.</span></span> <span data-ttu-id="43afd-174">No entanto, essa tabela não funciona para o MySQL por padrão porque a chave primária é muito grande.</span><span class="sxs-lookup"><span data-stu-id="43afd-174">However, this table does not work for MySQL by default because the primary key is too large.</span></span> <span data-ttu-id="43afd-175">Para corrigir essa situação, será necessário reduzir o tamanho da chave para essa tabela.</span><span class="sxs-lookup"><span data-stu-id="43afd-175">To remedy this situation, you will need to shrink the key size for that table.</span></span> <span data-ttu-id="43afd-176">Para fazer isso, execute as seguintes etapas:</span><span class="sxs-lookup"><span data-stu-id="43afd-176">To do so, use the following steps:</span></span>

1. <span data-ttu-id="43afd-177">As informações de esquema para esta tabela são capturadas em um **HistoryContext**, que pode ser modificado como qualquer outro **DbContext**.</span><span class="sxs-lookup"><span data-stu-id="43afd-177">The schema information for this table is captured in a **HistoryContext**, which can be modified as any other **DbContext**.</span></span> <span data-ttu-id="43afd-178">Para fazer isso, adicione um novo arquivo de classe chamado **MySqlHistoryContext.cs** ao projeto e substitua seu conteúdo pelo código a seguir:</span><span class="sxs-lookup"><span data-stu-id="43afd-178">To do so, add a new class file named **MySqlHistoryContext.cs** to the project, and replace its contents with the following code:</span></span>

    [!code-csharp[Main](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/samples/sample4.cs)]
2. <span data-ttu-id="43afd-179">Em seguida, você precisará configurar Entity Framework para usar o **HistoryContext**modificado, em vez do padrão um.</span><span class="sxs-lookup"><span data-stu-id="43afd-179">Next you will need to configure Entity Framework to use the modified **HistoryContext**, rather than default one.</span></span> <span data-ttu-id="43afd-180">Isso pode ser feito aproveitando os recursos de configuração baseada em código.</span><span class="sxs-lookup"><span data-stu-id="43afd-180">This can be done by leveraging code-based configuration features.</span></span> <span data-ttu-id="43afd-181">Para fazer isso, adicione um novo arquivo de classe chamado **MySqlConfiguration.cs** ao seu projeto e substitua seu conteúdo por:</span><span class="sxs-lookup"><span data-stu-id="43afd-181">To do so, add new class file named **MySqlConfiguration.cs** to your project and replace its contents with:</span></span>

    [!code-csharp[Main](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/samples/sample5.cs)]

### <a name="creating-a-custom-entityframework-initializer-for-applicationdbcontext"></a><span data-ttu-id="43afd-182">Criando um inicializador do EntityFramework personalizado para ApplicationDbContext</span><span class="sxs-lookup"><span data-stu-id="43afd-182">Creating a custom EntityFramework initializer for ApplicationDbContext</span></span>

<span data-ttu-id="43afd-183">O provedor MySQL que é apresentado neste tutorial atualmente não oferece suporte a Entity Framework migrações, portanto, você precisará usar inicializadores de modelo para se conectar ao banco de dados.</span><span class="sxs-lookup"><span data-stu-id="43afd-183">The MySQL provider that is featured in this tutorial does not currently support Entity Framework migrations, so you will need to use model initializers in order to connect to the database.</span></span> <span data-ttu-id="43afd-184">Como este tutorial está usando uma instância do MySQL no Azure, será necessário criar um inicializador de Entity Framework personalizado.</span><span class="sxs-lookup"><span data-stu-id="43afd-184">Because this tutorial is using a MySQL instance on Azure, you will need to create a custom Entity Framework initializer.</span></span>

> [!NOTE]
> <span data-ttu-id="43afd-185">Essa etapa não será necessária se você estiver se conectando a uma instância do SQL Server no Azure ou se estiver usando um banco de dados hospedado no local.</span><span class="sxs-lookup"><span data-stu-id="43afd-185">This step is not required if you are connecting to a SQL Server instance on Azure or if you are using a database that is hosted on premises.</span></span>

<span data-ttu-id="43afd-186">Para criar um inicializador de Entity Framework personalizado para MySQL, use as seguintes etapas:</span><span class="sxs-lookup"><span data-stu-id="43afd-186">To create a custom Entity Framework initializer for MySQL, use the following steps:</span></span>

1. <span data-ttu-id="43afd-187">Adicione um novo arquivo de classe chamado **MySqlInitializer.cs** ao projeto e substitua o conteúdo pelo código a seguir:</span><span class="sxs-lookup"><span data-stu-id="43afd-187">Add a new class file named **MySqlInitializer.cs** to the project, and replace it's contents with the following code:</span></span>

    [!code-csharp[Main](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/samples/sample6.cs?highlight=23)]
2. <span data-ttu-id="43afd-188">Abra o arquivo **IdentityModels.cs** do seu projeto, localizado no diretório **modelos** , e substitua o conteúdo pelo seguinte:</span><span class="sxs-lookup"><span data-stu-id="43afd-188">Open the **IdentityModels.cs** file for your project, which is located in the **Models** directory, and replace it's contents with the following:</span></span>

    [!code-csharp[Main](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/samples/sample7.cs)]

## <a name="running-the-application-and-verifying-the-database"></a><span data-ttu-id="43afd-189">Executando o aplicativo e verificando o banco de dados</span><span class="sxs-lookup"><span data-stu-id="43afd-189">Running the application and verifying the database</span></span>

<span data-ttu-id="43afd-190">Depois de concluir as etapas nas seções anteriores, você deve testar seu banco de dados.</span><span class="sxs-lookup"><span data-stu-id="43afd-190">Once you have completed the steps in the preceding sections, you should test your database.</span></span> <span data-ttu-id="43afd-191">Para fazer isso, execute as seguintes etapas:</span><span class="sxs-lookup"><span data-stu-id="43afd-191">To do so, use the following steps:</span></span>

1. <span data-ttu-id="43afd-192">Pressione **Ctrl + F5** para compilar e executar o aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="43afd-192">Press **Ctrl + F5** to build and run the web application.</span></span>
2. <span data-ttu-id="43afd-193">Clique na guia **registrar** na parte superior da página:</span><span class="sxs-lookup"><span data-stu-id="43afd-193">Click the **Register** tab on the top of the page:</span></span>

   <span data-ttu-id="43afd-194">[Clique na imagem a seguir para expandi-la.</span><span class="sxs-lookup"><span data-stu-id="43afd-194">[Click the following image to expand it.</span></span> <span data-ttu-id="43afd-195">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image4.jpg)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image3.jpg)</span><span class="sxs-lookup"><span data-stu-id="43afd-195">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image4.jpg)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image3.jpg)</span></span>
3. <span data-ttu-id="43afd-196">Insira um novo nome de usuário e senha e, em seguida, clique em **registrar**:</span><span class="sxs-lookup"><span data-stu-id="43afd-196">Enter a new user name and password, and then click **Register**:</span></span>

   <span data-ttu-id="43afd-197">[Clique na imagem a seguir para expandi-la.</span><span class="sxs-lookup"><span data-stu-id="43afd-197">[Click the following image to expand it.</span></span> <span data-ttu-id="43afd-198">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image24.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="43afd-198">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image24.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image23.png)</span></span>
4. <span data-ttu-id="43afd-199">Neste ponto, as tabelas de ASP.NET Identity são criadas no banco de dados MySQL e o usuário é registrado e conectado ao aplicativo:</span><span class="sxs-lookup"><span data-stu-id="43afd-199">At this point the ASP.NET Identity tables are created on the MySQL Database, and the user is registered and logged into the application:</span></span>

   <span data-ttu-id="43afd-200">[Clique na imagem a seguir para expandi-la.</span><span class="sxs-lookup"><span data-stu-id="43afd-200">[Click the following image to expand it.</span></span> <span data-ttu-id="43afd-201">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image6.jpg)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image5.jpg)</span><span class="sxs-lookup"><span data-stu-id="43afd-201">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image6.jpg)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image5.jpg)</span></span>

### <a name="installing-mysql-workbench-tool-to-verify-the-data"></a><span data-ttu-id="43afd-202">Instalando a ferramenta MySQL Workbench para verificar os dados</span><span class="sxs-lookup"><span data-stu-id="43afd-202">Installing MySQL Workbench tool to verify the data</span></span>

1. <span data-ttu-id="43afd-203">Instalar a ferramenta **MySQL Workbench** na [página de downloads do MySQL](http://dev.mysql.com/downloads/windows/installer/)</span><span class="sxs-lookup"><span data-stu-id="43afd-203">Install the **MySQL Workbench** tool from the [MySQL downloads page](http://dev.mysql.com/downloads/windows/installer/)</span></span>
2. <span data-ttu-id="43afd-204">Na guia Assistente de instalação: **seleção de recursos** , selecione **MySQL Workbench** na seção **aplicativos** .</span><span class="sxs-lookup"><span data-stu-id="43afd-204">In the installation wizard: **Feature Selection** tab, select **MySQL Workbench** under **applications** section.</span></span>
3. <span data-ttu-id="43afd-205">Inicie o aplicativo e adicione uma nova conexão usando os dados da cadeia de conexão do banco de dados MySQL do Azure que você criou no implorando deste tutorial.</span><span class="sxs-lookup"><span data-stu-id="43afd-205">Launch the app and add a new connection using the connection string data from the Azure MySQL database you created at the begging of this tutorial.</span></span>
4. <span data-ttu-id="43afd-206">Depois de estabelecer a conexão, inspecione as tabelas de **ASP.net Identity** criadas no **IdentityMySQLDatabase.**</span><span class="sxs-lookup"><span data-stu-id="43afd-206">After establishing the connection, inspect the **ASP.NET Identity** tables created on the **IdentityMySQLDatabase.**</span></span>
5. <span data-ttu-id="43afd-207">Você verá que todas as tabelas ASP.NET Identity necessárias são criadas conforme mostrado na imagem abaixo:</span><span class="sxs-lookup"><span data-stu-id="43afd-207">You will see that all ASP.NET Identity required tables are created as shown in the image below:</span></span>

   <span data-ttu-id="43afd-208">[Clique na imagem a seguir para expandi-la.</span><span class="sxs-lookup"><span data-stu-id="43afd-208">[Click the following image to expand it.</span></span> <span data-ttu-id="43afd-209">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image8.jpg)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image7.jpg)</span><span class="sxs-lookup"><span data-stu-id="43afd-209">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image8.jpg)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image7.jpg)</span></span>
6. <span data-ttu-id="43afd-210">Inspecione a tabela **aspnetusers** por instância para verificar as entradas ao registrar novos usuários.</span><span class="sxs-lookup"><span data-stu-id="43afd-210">Inspect the **aspnetusers** table for instance to check for the entries as you register new users.</span></span>

   <span data-ttu-id="43afd-211">[Clique na imagem a seguir para expandi-la.</span><span class="sxs-lookup"><span data-stu-id="43afd-211">[Click the following image to expand it.</span></span> <span data-ttu-id="43afd-212">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image26.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="43afd-212">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image26.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image25.png)</span></span>
