---
uid: identity/overview/getting-started/developing-aspnet-apps-with-windows-azure-active-directory
title: Desenvolvendo aplicativos ASP.NET com o Azure Active Directory-ASP.NET 4. x
author: Rick-Anderson
description: Microsoft ASP.NET Tools for Azure Active Directory simplifica a habilitação da autenticação para aplicativos Web hospedados no Azure. Você pode usar o Azure autenti...
ms.author: riande
ms.date: 08/14/2014
ms.assetid: 457d7eaf-ee76-4ceb-9082-c7c1721435ad
ms.custom: seoapril2019
msc.legacyurl: /identity/overview/getting-started/developing-aspnet-apps-with-windows-azure-active-directory
msc.type: authoredcontent
ms.openlocfilehash: 28425ea8d1312dfc6e14df9677396f2cbcf6f16d
ms.sourcegitcommit: 7709c0a091b8d55b7b33bad8849f7b66b23c3d72
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 02/19/2020
ms.locfileid: "77456719"
---
# <a name="developing-aspnet-apps-with-azure-active-directory"></a><span data-ttu-id="c93bb-104">Desenvolver aplicativos do ASP.NET com o Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="c93bb-104">Developing ASP.NET Apps with Azure Active Directory</span></span>

<span data-ttu-id="c93bb-105">por [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="c93bb-105">by [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

<span data-ttu-id="c93bb-106">As ferramentas de Microsoft ASP.NET para Azure Active Directory simplificam a habilitação da autenticação para aplicativos Web hospedados no [Azure](https://www.windowsazure.com/home/features/web-sites/).</span><span class="sxs-lookup"><span data-stu-id="c93bb-106">Microsoft ASP.NET tools for Azure Active Directory simplifies enabling authentication for web apps hosted on [Azure](https://www.windowsazure.com/home/features/web-sites/).</span></span> <span data-ttu-id="c93bb-107">Você pode usar a autenticação do Azure para autenticar usuários do Office 365 de sua organização, contas corporativas sincronizadas do seu Active Directory local ou usuários criados em seu próprio domínio de Azure Active Directory personalizado.</span><span class="sxs-lookup"><span data-stu-id="c93bb-107">You can use Azure Authentication to authenticate Office 365 users from your organization, corporate accounts synced from your on-premise Active Directory or users created in your own custom Azure Active Directory domain.</span></span> <span data-ttu-id="c93bb-108">Habilitar a autenticação do Windows Azure configura seu aplicativo para autenticar usuários usando um único locatário [Azure Active Directory](https://docs.microsoft.com/azure/active-directory/) .</span><span class="sxs-lookup"><span data-stu-id="c93bb-108">Enabling Windows Azure Authentication configures your application to authenticate users using a single [Azure Active Directory](https://docs.microsoft.com/azure/active-directory/) tenant.</span></span>

<span data-ttu-id="c93bb-109">Este tutorial mostrará como criar um aplicativo ASP.NET configurado para logon com o [Azure Active Directory](https://msdn.microsoft.com/library/azure/mt168838.aspx) (AD do Azure).</span><span class="sxs-lookup"><span data-stu-id="c93bb-109">This tutorial will show you how to create an ASP.NET application that is configured for sign-on with [Azure Active Directory](https://msdn.microsoft.com/library/azure/mt168838.aspx) (Azure AD).</span></span> <span data-ttu-id="c93bb-110">Você também aprenderá a chamar o API do Graph para obter informações sobre o usuário conectado no momento e como implantar o aplicativo no Azure.</span><span class="sxs-lookup"><span data-stu-id="c93bb-110">You will also learn how to call the Graph API to get information about the currently signed-in user and how to deploy the application to Azure.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="c93bb-111">{1&gt;{2&gt;Pré-requisitos&lt;2}&lt;1}</span><span class="sxs-lookup"><span data-stu-id="c93bb-111">Prerequisites</span></span>

1. <span data-ttu-id="c93bb-112">[Visual Studio Express 2013 para Web](https://my.visualstudio.com/Downloads?q=visual%20studio%202013#d-2013-express) ou [Visual Studio 2013](https://my.visualstudio.com/Downloads?q=visual%20studio%202013).</span><span class="sxs-lookup"><span data-stu-id="c93bb-112">[Visual Studio Express 2013 for Web](https://my.visualstudio.com/Downloads?q=visual%20studio%202013#d-2013-express) or [Visual Studio 2013](https://my.visualstudio.com/Downloads?q=visual%20studio%202013).</span></span>
2. <span data-ttu-id="c93bb-113">[Visual Studio 2013 Update 4](https://www.microsoft.com/download/details.aspx?id=44921) -a atualização 3 ou superior é necessária.</span><span class="sxs-lookup"><span data-stu-id="c93bb-113">[Visual Studio 2013 Update 4](https://www.microsoft.com/download/details.aspx?id=44921) - Update 3 or higher is required.</span></span>
3. <span data-ttu-id="c93bb-114">Uma conta do Azure.</span><span class="sxs-lookup"><span data-stu-id="c93bb-114">An Azure account.</span></span> <span data-ttu-id="c93bb-115">[Clique aqui](https://azure.microsoft.com/pricing/free-trial/) para obter uma avaliação gratuita se você ainda não tiver uma conta.</span><span class="sxs-lookup"><span data-stu-id="c93bb-115">[Click here](https://azure.microsoft.com/pricing/free-trial/) for a free trial if you do not already have an account.</span></span>

## <a name="add-a-global-administrator-to-your-active-directory"></a><span data-ttu-id="c93bb-116">Adicionar um administrador global à sua Active Directory</span><span class="sxs-lookup"><span data-stu-id="c93bb-116">Add a Global Administrator to your Active Directory</span></span>

1. <span data-ttu-id="c93bb-117">Entre no [Portal de Gerenciamento do Azure](https://manage.windowsazure.com/).</span><span class="sxs-lookup"><span data-stu-id="c93bb-117">Sign in to the [Azure Management Portal](https://manage.windowsazure.com/).</span></span>
2. <span data-ttu-id="c93bb-118">Todas as contas do Azure contêm um **diretório padrão** --clique nele e, em seguida, clique na guia **usuários** na parte superior da página (consulte a imagem abaixo).</span><span class="sxs-lookup"><span data-stu-id="c93bb-118">All Azure accounts contain a **Default Directory** -- click on it, then click the **Users** tab at the top of the page (see image below).</span></span>
3. <span data-ttu-id="c93bb-119">Clique em Adicionar Usuário.</span><span class="sxs-lookup"><span data-stu-id="c93bb-119">Click Add User.</span></span>
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image1.png)
4. <span data-ttu-id="c93bb-120">Crie um novo usuário com a função de **administrador global** .</span><span class="sxs-lookup"><span data-stu-id="c93bb-120">Create a new user with the **Global Administrator** role.</span></span> <span data-ttu-id="c93bb-121">Clique em **usuários** no menu superior e, em seguida, clique no botão **Adicionar usuário** na barra de comandos.</span><span class="sxs-lookup"><span data-stu-id="c93bb-121">Click **Users** from the top menu, and then click the **Add User** button on the command bar.</span></span>
5. <span data-ttu-id="c93bb-122">Na caixa de diálogo **Adicionar usuário** , insira um nome para o novo usuário e clique na seta para a direita.</span><span class="sxs-lookup"><span data-stu-id="c93bb-122">In the **Add User** dialog, enter a name for the new user and then click the right arrow.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image2.png)
6. <span data-ttu-id="c93bb-123">Insira o nome de usuário e defina a função como **administrador global**.</span><span class="sxs-lookup"><span data-stu-id="c93bb-123">Enter the user name and set the role to **Global Administrator**.</span></span> <span data-ttu-id="c93bb-124">Os administradores globais exigem um endereço de email alternativo para fins de recuperação de senha.</span><span class="sxs-lookup"><span data-stu-id="c93bb-124">Global administrators require an alternate email address for password recovery purposes.</span></span> <span data-ttu-id="c93bb-125">Depois de terminar, clique na seta para a direita.</span><span class="sxs-lookup"><span data-stu-id="c93bb-125">After you're finished, click the right arrow.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image3.png)
7. <span data-ttu-id="c93bb-126">Na próxima página da caixa de diálogo, clique em **criar**.</span><span class="sxs-lookup"><span data-stu-id="c93bb-126">On the next page of the dialog, click **Create**.</span></span> <span data-ttu-id="c93bb-127">Uma senha temporária será criada para o novo usuário e exibida na caixa de diálogo.</span><span class="sxs-lookup"><span data-stu-id="c93bb-127">A temporary password will be created for the new user and displayed in the dialog.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image4.png)

   <span data-ttu-id="c93bb-128">Salve a senha, será necessário alterar a senha após o primeiro logon.</span><span class="sxs-lookup"><span data-stu-id="c93bb-128">Save the password, you will be required to change the password after the first log in.</span></span> <span data-ttu-id="c93bb-129">A imagem a seguir mostra a nova conta de administrador.</span><span class="sxs-lookup"><span data-stu-id="c93bb-129">The following image shows the new admin account.</span></span> <span data-ttu-id="c93bb-130">Você deve usar o Azure Active Directory para fazer logon em seu aplicativo, não a conta Microsoft também mostrada nesta página.</span><span class="sxs-lookup"><span data-stu-id="c93bb-130">You must use the Azure Active Directory to log into your app, not the Microsoft account also shown on this page.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image5.png)

## <a name="create-an-aspnet-application"></a><span data-ttu-id="c93bb-131">Criar um aplicativo ASP.NET</span><span class="sxs-lookup"><span data-stu-id="c93bb-131">Create an ASP.NET Application</span></span>

<span data-ttu-id="c93bb-132">As etapas a seguir usam [Visual Studio Express 2013 para Web](https://www.microsoft.com/download/details.aspx?id=40747)e requer [Visual Studio 2013 atualização 3](https://www.microsoft.com/download/details.aspx?id=43721).</span><span class="sxs-lookup"><span data-stu-id="c93bb-132">The following steps use [Visual Studio Express 2013 for Web](https://www.microsoft.com/download/details.aspx?id=40747), and requires [Visual Studio 2013 Update 3](https://www.microsoft.com/download/details.aspx?id=43721).</span></span>

1. <span data-ttu-id="c93bb-133">No Visual Studio, clique em **arquivo** e em **novo projeto**.</span><span class="sxs-lookup"><span data-stu-id="c93bb-133">In Visual Studio, click **File** and then **New Project**.</span></span> <span data-ttu-id="c93bb-134">Na caixa de diálogo **novo projeto** , selecione o C# projeto Web Visual no menu à esquerda e clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="c93bb-134">On the **New Project** dialog, select the Visual C# Web project from the left menu and click **OK**.</span></span> <span data-ttu-id="c93bb-135">Talvez você também queira desmarcar a **Application insights adicionar ao projeto** se não quiser a funcionalidade do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c93bb-135">You may also want to uncheck the **Add Application Insights to Project** if you don't want the functionality for your application.</span></span>
2. <span data-ttu-id="c93bb-136">Na caixa de diálogo **novo projeto ASP.net** , selecione **MVC**e clique em **alterar autenticação**.</span><span class="sxs-lookup"><span data-stu-id="c93bb-136">In the **New ASP.NET Project** dialog, select **MVC**, and then click **Change Authentication**.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image6.png)
3. <span data-ttu-id="c93bb-137">Na caixa de diálogo **alterar autenticação** , selecione **contas organizacionais**.</span><span class="sxs-lookup"><span data-stu-id="c93bb-137">On the **Change Authentication** dialog, select **Organizational Accounts**.</span></span> <span data-ttu-id="c93bb-138">Essas opções podem ser usadas para registrar automaticamente seu aplicativo no Azure AD, bem como configurar automaticamente seu aplicativo para integração com o Azure AD.</span><span class="sxs-lookup"><span data-stu-id="c93bb-138">These options can be used to automatically register your application with Azure AD as well as automatically configure your application to integrate with Azure AD.</span></span> <span data-ttu-id="c93bb-139">Você não precisa usar a caixa de diálogo **alterar autenticação** para registrar e configurar seu aplicativo, mas isso torna muito mais fácil.</span><span class="sxs-lookup"><span data-stu-id="c93bb-139">You don't have to use the **Change Authentication** dialog to register and configure your application, but it makes it much easier.</span></span> <span data-ttu-id="c93bb-140">Se você estiver usando o Visual Studio 2012, por exemplo, você ainda poderá registrar manualmente o aplicativo no Portal de Gerenciamento do Azure e atualizar sua configuração para integração com o Azure AD.</span><span class="sxs-lookup"><span data-stu-id="c93bb-140">If you are using Visual Studio 2012 for example, you can still manually register the application in the Azure Management Portal and update its configuration to integrate with Azure AD.</span></span>
   <span data-ttu-id="c93bb-141">Nos menus suspensos, selecione **organização única de nuvem** e **logon único, ler dados do diretório**.</span><span class="sxs-lookup"><span data-stu-id="c93bb-141">In the drop-down menus, select **Cloud - Single Organization** and **Single Sign On, Read directory data**.</span></span> <span data-ttu-id="c93bb-142">Insira o domínio para seu diretório do Azure AD, por exemplo (nas imagens abaixo) *aricka0yahoo.onmicrosoft.com*e clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="c93bb-142">Enter the domain for your Azure AD directory, for example (in the images below) *aricka0yahoo.onmicrosoft.com*, and then click **OK**.</span></span> <span data-ttu-id="c93bb-143">Você pode obter o nome de domínio na guia domínios para o diretório padrão no portal do Azure (consulte a próxima imagem para baixo).</span><span class="sxs-lookup"><span data-stu-id="c93bb-143">You can get the domain name from the Domains tab for the Default Directory on the azure portal (see the next image down).</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image7.png)

   <span data-ttu-id="c93bb-144">A imagem a seguir mostra o nome de domínio do portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="c93bb-144">The following image shows the domain name from the Azure portal.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image8.png)

    > [!NOTE]
    > <span data-ttu-id="c93bb-145">Opcionalmente, você pode configurar o URI de ID do aplicativo que será registrado no Azure AD clicando em **mais opções**.</span><span class="sxs-lookup"><span data-stu-id="c93bb-145">You can optionally configure the Application ID URI that will be registered in Azure AD by clicking **More Options**.</span></span> <span data-ttu-id="c93bb-146">O URI da ID do aplicativo é o identificador exclusivo de um aplicativo, que é registrado no Azure AD e usado pelo aplicativo para se identificar ao se comunicar com o Azure AD.</span><span class="sxs-lookup"><span data-stu-id="c93bb-146">The App ID URI is the unique identifier for an application, which is registered in Azure AD and used by the application to identify itself when communicating with Azure AD.</span></span> <span data-ttu-id="c93bb-147">Para obter mais informações sobre o URI da ID do aplicativo e outras propriedades de aplicativos registrados, consulte [Este tópico](https://msdn.microsoft.com/library/azure/dn499820.aspx#BKMK_Registering).</span><span class="sxs-lookup"><span data-stu-id="c93bb-147">For more information about the App ID URI and other properties of registered applications, see [this topic](https://msdn.microsoft.com/library/azure/dn499820.aspx#BKMK_Registering).</span></span> <span data-ttu-id="c93bb-148">Ao clicar na caixa de seleção abaixo do campo URI da ID do aplicativo, você também pode optar por substituir um registro existente no Azure AD que usa o mesmo URI da ID do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c93bb-148">By clicking the checkbox below the App ID URI field, you can also choose to overwrite an existing registration in Azure AD that uses the same App ID URI.</span></span>
4. <span data-ttu-id="c93bb-149">Depois de clicar em **OK**, uma caixa de diálogo de entrada será exibida e você precisará entrar usando uma conta de administrador global (não a conta Microsoft associada à sua assinatura).</span><span class="sxs-lookup"><span data-stu-id="c93bb-149">After clicking **OK**, a sign-in dialog will appear, and you'll need to sign in using a Global Administrator account (not the Microsoft account associated with your subscription).</span></span> <span data-ttu-id="c93bb-150">Se você criou uma nova conta de administrador anteriormente, será necessário alterar a senha e entrar novamente usando a nova senha.</span><span class="sxs-lookup"><span data-stu-id="c93bb-150">If you created a new Administrator account earlier, you'll be required to change the password and then sign in again using the new password.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image9.png)
5. <span data-ttu-id="c93bb-151">Depois de autenticado com êxito, a caixa de diálogo **novo projeto ASP.net** mostrará sua opção de autenticação (**organizacional** ) e o diretório em que o novo aplicativo será registrado (*aricka0yahoo.onmicrosoft.com* na imagem abaixo).</span><span class="sxs-lookup"><span data-stu-id="c93bb-151">After you've successfully authenticated, the **New ASP.NET Project** dialog will show your authentication choice (**Organizational** ) and the directory where the new application will be registered (*aricka0yahoo.onmicrosoft.com* in the image below).</span></span> <span data-ttu-id="c93bb-152">Abaixo dessas informações, marque a caixa de seleção chamado **host na nuvem**.</span><span class="sxs-lookup"><span data-stu-id="c93bb-152">Below this information, select the checkbox labeled **Host in the cloud**.</span></span> <span data-ttu-id="c93bb-153">Se essa caixa de seleção estiver selecionada, o projeto será provisionado como um aplicativo Web do Azure e será habilitado para publicação fácil posteriormente.</span><span class="sxs-lookup"><span data-stu-id="c93bb-153">If this checkbox is selected, the project will be provisioned as an Azure web app and will be enabled for easy publishing later.</span></span> <span data-ttu-id="c93bb-154">Clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="c93bb-154">Click **OK**.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image10.png)
6. <span data-ttu-id="c93bb-155">A caixa de diálogo **configurar site do Azure** será exibida, usando um nome de site e uma região gerados automaticamente.</span><span class="sxs-lookup"><span data-stu-id="c93bb-155">The **Configure Azure Website** dialog will appear, using an auto-generated site name and region.</span></span> <span data-ttu-id="c93bb-156">Observe também a conta à qual você está conectado no momento na caixa de diálogo.</span><span class="sxs-lookup"><span data-stu-id="c93bb-156">Also note the account you're currently signed into in the dialog.</span></span> <span data-ttu-id="c93bb-157">Você deseja certificar-se de que essa conta é aquela à qual sua assinatura do Azure está anexada, normalmente um conta Microsoft.</span><span class="sxs-lookup"><span data-stu-id="c93bb-157">You want to make sure that this account is the one that your Azure subscription is attached to, typically a Microsoft account.</span></span>

    > [!NOTE]
    > <span data-ttu-id="c93bb-158">Este projeto requer um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="c93bb-158">This project requires a database.</span></span> <span data-ttu-id="c93bb-159">Você precisa selecionar um dos bancos de dados existentes ou criar um novo.</span><span class="sxs-lookup"><span data-stu-id="c93bb-159">You need to select one of your existing databases, or create a new one.</span></span> <span data-ttu-id="c93bb-160">Um banco de dados é necessário porque o projeto já usa um arquivo de banco de dado local para armazenar uma pequena quantidade de data de configuração de autenticação.</span><span class="sxs-lookup"><span data-stu-id="c93bb-160">A database is required because the project already uses a local database file to store a small amount of authentication configuration data.</span></span> <span data-ttu-id="c93bb-161">Quando você implanta o aplicativo em um site do Azure, esse banco de dados não é empacotado com a implantação, portanto, você precisa escolher um que seja acessível na nuvem.</span><span class="sxs-lookup"><span data-stu-id="c93bb-161">When you deploy the application to an Azure Website, this database isn't packaged with the deployment, so you need to choose one that's accessible in the cloud.</span></span> <span data-ttu-id="c93bb-162">Clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="c93bb-162">Click **OK**.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image11.png)
7. <span data-ttu-id="c93bb-163">O projeto será criado e suas opções de autenticação e opções de aplicativo Web serão configuradas automaticamente com o projeto.</span><span class="sxs-lookup"><span data-stu-id="c93bb-163">The project will be created, and your authentication options and web app options will be automatically configured with the project.</span></span> <span data-ttu-id="c93bb-164">Depois que esse processo for concluído, execute o projeto localmente pressionando **^ F5**.</span><span class="sxs-lookup"><span data-stu-id="c93bb-164">Once this process has completed, run the project locally by pressing **^F5**.</span></span> <span data-ttu-id="c93bb-165">Você será solicitado a entrar usando sua conta institucional.</span><span class="sxs-lookup"><span data-stu-id="c93bb-165">You will be required to sign in using your organizational account.</span></span> <span data-ttu-id="c93bb-166">Forneça o nome de usuário e a senha para a conta que você criou anteriormente e clique em **entrar**.</span><span class="sxs-lookup"><span data-stu-id="c93bb-166">Provide the username and password for the account you created earlier and click **Sign in**.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image12.png)
8. <span data-ttu-id="c93bb-167">Após a entrada bem-sucedida, o site ASP.NET mostrará que você autenticou exibindo o nome de usuário no canto superior direito da página.</span><span class="sxs-lookup"><span data-stu-id="c93bb-167">After successful sign in, the ASP.NET site will show that you've authenticated by displaying the username in the top right corner of the page.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image13.png)

   <span data-ttu-id="c93bb-168">Se você receber o erro: o valor não pode ser nulo ou vazio.</span><span class="sxs-lookup"><span data-stu-id="c93bb-168">If you get the error: Value cannot be null or empty.</span></span> <span data-ttu-id="c93bb-169">Nome do parâmetro: linkText ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image14.png)</span><span class="sxs-lookup"><span data-stu-id="c93bb-169">Parameter name: linkText ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image14.png)</span></span>

   <span data-ttu-id="c93bb-170">consulte a seção de [depuração](#dbg) no final do tutorial.</span><span class="sxs-lookup"><span data-stu-id="c93bb-170">see the [debug](#dbg) section at the end of the tutorial.</span></span>

## <a name="basics-of-the-graph-api"></a><span data-ttu-id="c93bb-171">Noções básicas do API do Graph</span><span class="sxs-lookup"><span data-stu-id="c93bb-171">Basics of the Graph API</span></span>

<span data-ttu-id="c93bb-172">[O API do Graph](https://msdn.microsoft.com/library/azure/hh974476.aspx) é a interface programática usada para executar CRUD e outras operações em objetos em seu diretório do AD do Azure.</span><span class="sxs-lookup"><span data-stu-id="c93bb-172">[The Graph API](https://msdn.microsoft.com/library/azure/hh974476.aspx) is the programmatic interface used to perform CRUD and other operations on objects in your Azure AD directory.</span></span> <span data-ttu-id="c93bb-173">Se você selecionar uma opção de conta organizacional para autenticação ao criar um novo projeto no Visual Studio 2013, seu aplicativo já estará configurado para chamar o API do Graph.</span><span class="sxs-lookup"><span data-stu-id="c93bb-173">If you select an Organizational Account option for authentication when creating a new project in Visual Studio 2013, your application will already be configured to call the Graph API.</span></span> <span data-ttu-id="c93bb-174">Esta seção mostra brevemente como o API do Graph funciona.</span><span class="sxs-lookup"><span data-stu-id="c93bb-174">This section briefly shows you how the Graph API works.</span></span>

1. <span data-ttu-id="c93bb-175">Em seu aplicativo em execução, clique no nome do usuário conectado no canto superior direito da página.</span><span class="sxs-lookup"><span data-stu-id="c93bb-175">In your running application, click on the name of the signed-in user at the top right of the page.</span></span> <span data-ttu-id="c93bb-176">Isso o levará para a página de perfil do usuário, que é uma ação no controlador doméstico.</span><span class="sxs-lookup"><span data-stu-id="c93bb-176">This will take you to the User Profile page, which is an action on the Home Controller.</span></span> <span data-ttu-id="c93bb-177">Você observará que a tabela contém informações de usuário sobre a conta de administrador que você criou anteriormente.</span><span class="sxs-lookup"><span data-stu-id="c93bb-177">You'll notice that the table contains user information about the administrator account you created earlier.</span></span> <span data-ttu-id="c93bb-178">Essas informações são armazenadas em seu diretório, e o API do Graph é chamado para recuperar essas informações quando a página é carregada.</span><span class="sxs-lookup"><span data-stu-id="c93bb-178">This information is stored in your directory, and the Graph API is called to retrieve this information when the page loads.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image15.png)
2. <span data-ttu-id="c93bb-179">Volte para o Visual Studio e expanda a pasta **controladores** e, em seguida, abra o arquivo **HomeController.cs** .</span><span class="sxs-lookup"><span data-stu-id="c93bb-179">Go back to Visual Studio and expand the **Controllers** folder and then open the **HomeController.cs** file.</span></span> <span data-ttu-id="c93bb-180">Você verá uma ação **USERPROFILE ()** que contém o código para recuperar um token e, em seguida, chamar o API do Graph.</span><span class="sxs-lookup"><span data-stu-id="c93bb-180">You'll see a **UserProfile()** action that contains code to retrieve a token and then call the Graph API.</span></span> <span data-ttu-id="c93bb-181">Este código está duplicado abaixo:</span><span class="sxs-lookup"><span data-stu-id="c93bb-181">This code is duplicated below:</span></span>

    [!code-csharp[Main](developing-aspnet-apps-with-windows-azure-active-directory/samples/sample1.cs?highlight=22)]

    <span data-ttu-id="c93bb-182">Para chamar o API do Graph, primeiro você precisa recuperar um token.</span><span class="sxs-lookup"><span data-stu-id="c93bb-182">To call the Graph API, you first need to retrieve a token.</span></span> <span data-ttu-id="c93bb-183">Quando o token é recuperado, seu valor de cadeia de caracteres deve ser anexado no cabeçalho de autorização para todas as solicitações subsequentes ao API do Graph.</span><span class="sxs-lookup"><span data-stu-id="c93bb-183">When the token is retrieved, its string value must be appended in the Authorization header for all subsequent requests to the Graph API.</span></span> <span data-ttu-id="c93bb-184">A maior parte do código acima trata dos detalhes da autenticação no Azure AD para obter um token, usando o token para fazer uma chamada para o API do Graph e, em seguida, transformar a resposta para que ela possa ser apresentada na exibição.</span><span class="sxs-lookup"><span data-stu-id="c93bb-184">Most of the code above handles the details of authenticating to Azure AD to get a token, using the token to make a call to the Graph API, and then transforming the response so that it can be presented in the View.</span></span>

    <span data-ttu-id="c93bb-185">A parte mais relevante para discussão é a seguinte linha realçada: `UserProfile profile = JsonConvert.DeserializeObject<UserProfile>(responseString);`.</span><span class="sxs-lookup"><span data-stu-id="c93bb-185">The most relevant portion for discussion is the following highlighted line: `UserProfile profile = JsonConvert.DeserializeObject<UserProfile>(responseString);`.</span></span> <span data-ttu-id="c93bb-186">Essa linha representa o nome do usuário, que foi desserializado da resposta JSON e é apresentado na exibição.</span><span class="sxs-lookup"><span data-stu-id="c93bb-186">This line represents the name of the user, which has been deserialized from the JSON response and is presented in the View.</span></span>

    <span data-ttu-id="c93bb-187">Você pode chamar o API do Graph usando HttpClient e manipular os dados brutos por conta própria, mas uma maneira mais fácil é usar a [biblioteca de cliente do Graph que está disponível via NuGet](http://www.nuget.org/packages/Microsoft.Azure.ActiveDirectory.GraphClient/).</span><span class="sxs-lookup"><span data-stu-id="c93bb-187">You can call the Graph API using HttpClient and handle the raw data yourself, but an easier way is to use the [Graph Client Library which is available via NuGet](http://www.nuget.org/packages/Microsoft.Azure.ActiveDirectory.GraphClient/).</span></span> <span data-ttu-id="c93bb-188">A biblioteca de cliente manipula as solicitações HTTP brutas e a transformação dos dados retornados para você e torna muito mais fácil trabalhar com o API do Graph em um ambiente .NET.</span><span class="sxs-lookup"><span data-stu-id="c93bb-188">The Client Library handles the raw HTTP requests and the transformation of the returned data for you, and makes it much easier to work with the Graph API in a .NET environment.</span></span> <span data-ttu-id="c93bb-189">Consulte os exemplos de código de API do Graph relacionados no [github.](https://github.com/AzureADSamples)</span><span class="sxs-lookup"><span data-stu-id="c93bb-189">See the related Graph API code samples on [GitHub.](https://github.com/AzureADSamples)</span></span>

## <a name="deploy-the-application-to-azure"></a><span data-ttu-id="c93bb-190">Implantar o Aplicativo no Azure</span><span class="sxs-lookup"><span data-stu-id="c93bb-190">Deploy the Application to Azure</span></span>

<span data-ttu-id="c93bb-191">As etapas a seguir mostrarão como implantar o aplicativo no Azure.</span><span class="sxs-lookup"><span data-stu-id="c93bb-191">The following steps will show you how to deploy the application to Azure.</span></span> <span data-ttu-id="c93bb-192">Nas etapas anteriores, você conectou seu novo projeto com um aplicativo Web no Azure, portanto, ele está pronto para ser publicado em apenas algumas etapas.</span><span class="sxs-lookup"><span data-stu-id="c93bb-192">In the earlier steps, you connected your new project with a web app on Azure, so it's ready to be published in just a few steps.</span></span>

1. <span data-ttu-id="c93bb-193">No Visual Studio, clique com o botão direito do mouse no projeto e selecione **publicar**.</span><span class="sxs-lookup"><span data-stu-id="c93bb-193">In Visual Studio, right-click on the project and select **Publish**.</span></span> <span data-ttu-id="c93bb-194">A caixa de diálogo **publicar Web** será exibida com cada configuração já configurada.</span><span class="sxs-lookup"><span data-stu-id="c93bb-194">The **Publish Web** dialog will appear with each setting already configured.</span></span> <span data-ttu-id="c93bb-195">Clique no botão **Avançar** para ir para a página **configurações** .</span><span class="sxs-lookup"><span data-stu-id="c93bb-195">Click on the **Next** button to go to the **Settings** page.</span></span> <span data-ttu-id="c93bb-196">Você pode ser solicitado a autenticar; Certifique-se de autenticar usando sua conta de assinatura do Azure (normalmente uma conta Microsoft) e não a conta institucional que você criou anteriormente.</span><span class="sxs-lookup"><span data-stu-id="c93bb-196">You may be prompted to authenticate; make sure you authenticate using your Azure subscription account (typically a Microsoft account) and not the organizational account you created earlier.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image16.png)
2. <span data-ttu-id="c93bb-197">Marque a opção **habilitar autenticação organizacional** .</span><span class="sxs-lookup"><span data-stu-id="c93bb-197">Check the **Enable Organizational Authentication** option.</span></span> <span data-ttu-id="c93bb-198">No campo **domínio** , insira o domínio para seu diretório.</span><span class="sxs-lookup"><span data-stu-id="c93bb-198">In the **Domain** field, enter the domain for your directory.</span></span> <span data-ttu-id="c93bb-199">Na lista suspensa **nível de acesso** , selecione **logon único, ler dados do diretório**.</span><span class="sxs-lookup"><span data-stu-id="c93bb-199">From the **Access Level** drop-down, select **Single Sign On, Read directory data**.</span></span> <span data-ttu-id="c93bb-200">Você observará que o banco de dados anterior que você usou já está populado **na seção banco de dados.**</span><span class="sxs-lookup"><span data-stu-id="c93bb-200">You'll notice that the previous database you used is already populated in the **Databases** section.</span></span> <span data-ttu-id="c93bb-201">Clique em **Publicar**.</span><span class="sxs-lookup"><span data-stu-id="c93bb-201">Click **Publish**.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image17.png)
3. <span data-ttu-id="c93bb-202">O Visual Studio começará a implantar seu site e uma nova janela do navegador será exibida.</span><span class="sxs-lookup"><span data-stu-id="c93bb-202">Visual Studio will begin deploying your website, and then a new browser window will appear.</span></span> <span data-ttu-id="c93bb-203">Você pode ser solicitado a autenticar em seu diretório novamente.</span><span class="sxs-lookup"><span data-stu-id="c93bb-203">You may be prompted to authenticate to your directory once again.</span></span> <span data-ttu-id="c93bb-204">Depois de autenticado, você será redirecionado para seu site publicado recentemente no Azure.</span><span class="sxs-lookup"><span data-stu-id="c93bb-204">Once you've authenticated, you'll be redirected to your newly published website on Azure.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image18.png)

<a id="dbg"></a>
## <a name="debugging-the-app"></a><span data-ttu-id="c93bb-205">Depurando o aplicativo</span><span class="sxs-lookup"><span data-stu-id="c93bb-205">Debugging the app</span></span>

<span data-ttu-id="c93bb-206">Se você receber o seguinte erro: o valor não pode ser nulo ou vazio.</span><span class="sxs-lookup"><span data-stu-id="c93bb-206">If you get the following error: Value cannot be null or empty.</span></span> <span data-ttu-id="c93bb-207">Nome do parâmetro: linkText</span><span class="sxs-lookup"><span data-stu-id="c93bb-207">Parameter name: linkText</span></span>

![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image19.png)

<span data-ttu-id="c93bb-208">Substitua o código no arquivo *Views\Shared\\_LoginPartial. cshtml* pelo seguinte:</span><span class="sxs-lookup"><span data-stu-id="c93bb-208">Replace the code in the *Views\Shared\\_LoginPartial.cshtml* file with the following:</span></span>

[!code-cshtml[Main](developing-aspnet-apps-with-windows-azure-active-directory/samples/sample2.cshtml?highlight=1-8,15-16)]

<span data-ttu-id="c93bb-209">Depois de executar o aplicativo, se o usuário conectado Mostrar "usuário nulo", saia e entre novamente com a conta de Active Directory que você criou anteriormente.</span><span class="sxs-lookup"><span data-stu-id="c93bb-209">After running the app, if the logged in user shows "Null User", sign out, and sign back in with the Active Directory account you created earlier.</span></span>

<span data-ttu-id="c93bb-210">Um tutorial excelente a ser seguido é o aprofundamento de Rick Rainey [: sites do Azure e autenticação organizacional usando o Azure ad](http://rickrainey.com/2014/08/19/deep-dive-azure-websites-and-organizational-authentication-using-azure-ad/).</span><span class="sxs-lookup"><span data-stu-id="c93bb-210">An excellent tutorial to follow is Rick Rainey's [Deep Dive: Azure Websites and Organizational Authentication using Azure AD](http://rickrainey.com/2014/08/19/deep-dive-azure-websites-and-organizational-authentication-using-azure-ad/).</span></span>

## <a name="more-information"></a><span data-ttu-id="c93bb-211">Mais informações</span><span class="sxs-lookup"><span data-stu-id="c93bb-211">More Information</span></span>

- [<span data-ttu-id="c93bb-212">Análise aprofundada: sites do Azure e autenticação organizacional usando o Azure AD</span><span class="sxs-lookup"><span data-stu-id="c93bb-212">Deep Dive: Azure Websites and Organizational Authentication using Azure AD</span></span>](http://rickrainey.com/2014/08/19/deep-dive-azure-websites-and-organizational-authentication-using-azure-ad/)
- [<span data-ttu-id="c93bb-213">Visão geral do Azure AD API do Graph</span><span class="sxs-lookup"><span data-stu-id="c93bb-213">Azure AD Graph API Overview</span></span>](https://msdn.microsoft.com/library/azure/hh974476.aspx)
- [<span data-ttu-id="c93bb-214">Cenários de autenticação no Azure AD</span><span class="sxs-lookup"><span data-stu-id="c93bb-214">Authentication Scenarios in Azure AD</span></span>](https://msdn.microsoft.com/library/azure/dn499820.aspx)
- [<span data-ttu-id="c93bb-215">Exemplos de código do Azure AD no GitHub</span><span class="sxs-lookup"><span data-stu-id="c93bb-215">Azure AD Code Samples on GitHub</span></span>](https://github.com/AzureADSamples)
