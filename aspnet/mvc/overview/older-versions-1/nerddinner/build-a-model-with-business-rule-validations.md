---
uid: mvc/overview/older-versions-1/nerddinner/build-a-model-with-business-rule-validations
title: Construa um modelo com validações de regras de negócios | Microsoft Docs
author: rick-anderson
description: O passo 3 mostra como criar um modelo que podemos usar tanto para consultar quanto atualizar o banco de dados para o nosso aplicativo NerdDinner.
ms.author: riande
ms.date: 07/27/2010
ms.assetid: 0bc191b2-4311-479a-a83a-7f1b1c32e6fe
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/build-a-model-with-business-rule-validations
msc.type: authoredcontent
ms.openlocfilehash: 1a316e9051cf56cd4f1546336b334ace991c05b3
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/17/2020
ms.locfileid: "81541631"
---
# <a name="build-a-model-with-business-rule-validations"></a><span data-ttu-id="cfb84-103">Compilar um modelo com validações de regra de negócios</span><span class="sxs-lookup"><span data-stu-id="cfb84-103">Build a Model with Business Rule Validations</span></span>

<span data-ttu-id="cfb84-104">pela [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="cfb84-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="cfb84-105">Baixar PDF</span><span class="sxs-lookup"><span data-stu-id="cfb84-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="cfb84-106">Este é o passo 3 de um tutorial gratuito do [aplicativo "NerdDinner"](introducing-the-nerddinner-tutorial.md) que mostra como construir um pequeno, mas completo, aplicativo web usando ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="cfb84-106">This is step 3 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="cfb84-107">O passo 3 mostra como criar um modelo que podemos usar tanto para consultar quanto atualizar o banco de dados para o nosso aplicativo NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="cfb84-107">Step 3 shows how to create a model that we can use to both query and update the database for our NerdDinner application.</span></span>
> 
> <span data-ttu-id="cfb84-108">Se você estiver usando ASP.NET MVC 3, recomendamos que você siga os tutoriais da [MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) ou [MVC Music Store.](../../older-versions/mvc-music-store/mvc-music-store-part-1.md)</span><span class="sxs-lookup"><span data-stu-id="cfb84-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>

## <a name="nerddinner-step-3-building-the-model"></a><span data-ttu-id="cfb84-109">NerdDinner Passo 3: Construindo o Modelo</span><span class="sxs-lookup"><span data-stu-id="cfb84-109">NerdDinner Step 3: Building the Model</span></span>

<span data-ttu-id="cfb84-110">Em uma estrutura modelo-view-controller, o termo "modelo" refere-se aos objetos que representam os dados do aplicativo, bem como à lógica de domínio correspondente que integra as regras de validação e de negócios com ele.</span><span class="sxs-lookup"><span data-stu-id="cfb84-110">In a model-view-controller framework the term "model" refers to the objects that represent the data of the application, as well as the corresponding domain logic that integrates validation and business rules with it.</span></span> <span data-ttu-id="cfb84-111">O modelo é, em muitos aspectos, o "coração" de um aplicativo baseado em MVC, e como veremos mais tarde, impulsiona fundamentalmente o comportamento dele.</span><span class="sxs-lookup"><span data-stu-id="cfb84-111">The model is in many ways the "heart" of an MVC-based application, and as we'll see later fundamentally drives the behavior of it.</span></span>

<span data-ttu-id="cfb84-112">A estrutura ASP.NET MVC suporta o uso de qualquer tecnologia de acesso a dados, e os desenvolvedores podem escolher entre uma variedade de opções de dados .NET ricas para implementar seus modelos, incluindo: LINQ para Entidades, LINQ para SQL, NHibernate, LLBLGen Pro, SubSonic, WilsonORM ou apenas ADO.NET datareaders ou datasets.</span><span class="sxs-lookup"><span data-stu-id="cfb84-112">The ASP.NET MVC framework supports using any data access technology, and developers can choose from a variety of rich .NET data options to implement their models including: LINQ to Entities, LINQ to SQL, NHibernate, LLBLGen Pro, SubSonic, WilsonORM, or just raw ADO.NET DataReaders or DataSets.</span></span>

<span data-ttu-id="cfb84-113">Para o nosso aplicativo NerdDinner, vamos usar linq para SQL para criar um modelo simples que corresponde bastante de perto ao nosso design de banco de dados, e adiciona algumas lógicas de validação personalizadas e regras de negócios.</span><span class="sxs-lookup"><span data-stu-id="cfb84-113">For our NerdDinner application we are going to use LINQ to SQL to create a simple model that corresponds fairly closely to our database design, and adds some custom validation logic and business rules.</span></span> <span data-ttu-id="cfb84-114">Em seguida, implementaremos uma classe de repositório que ajuda a abstrair a implementação de persistência de dados do resto do aplicativo e nos permite testá-lo facilmente.</span><span class="sxs-lookup"><span data-stu-id="cfb84-114">We will then implement a repository class that helps abstract away the data persistence implementation from the rest of the application, and enables us to easily unit test it.</span></span>

### <a name="linq-to-sql"></a><span data-ttu-id="cfb84-115">LINQ to SQL</span><span class="sxs-lookup"><span data-stu-id="cfb84-115">LINQ to SQL</span></span>

<span data-ttu-id="cfb84-116">LINQ para SQL é um ORM (mapeador relacional de objetos) que é fornecido como parte do .NET 3.5.</span><span class="sxs-lookup"><span data-stu-id="cfb84-116">LINQ to SQL is an ORM (object relational mapper) that ships as part of .NET 3.5.</span></span>

<span data-ttu-id="cfb84-117">LINQ para SQL fornece uma maneira fácil de mapear tabelas de banco de dados para classes .NET que podemos codificar contra.</span><span class="sxs-lookup"><span data-stu-id="cfb84-117">LINQ to SQL provides an easy way to map database tables to .NET classes we can code against.</span></span> <span data-ttu-id="cfb84-118">Para o nosso aplicativo NerdDinner, vamos usá-lo para mapear as tabelas Dinners e RSVP dentro do nosso banco de dados para as aulas de Jantar e RSVP.</span><span class="sxs-lookup"><span data-stu-id="cfb84-118">For our NerdDinner application we'll use it to map the Dinners and RSVP tables within our database to Dinner and RSVP classes.</span></span> <span data-ttu-id="cfb84-119">As colunas das mesas Dinners e RSVP corresponderão às propriedades nas aulas de Jantar e RSVP.</span><span class="sxs-lookup"><span data-stu-id="cfb84-119">The columns of the Dinners and RSVP tables will correspond to properties on the Dinner and RSVP classes.</span></span> <span data-ttu-id="cfb84-120">Cada objeto Dinner e RSVP representará uma linha separada dentro das tabelas Dinners ou RSVP no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="cfb84-120">Each Dinner and RSVP object will represent a separate row within the Dinners or RSVP tables in the database.</span></span>

<span data-ttu-id="cfb84-121">Linq para SQL nos permite evitar ter que construir manualmente instruções SQL para recuperar e atualizar objetos Dinner e RSVP com dados de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="cfb84-121">LINQ to SQL allows us to avoid having to manually construct SQL statements to retrieve and update Dinner and RSVP objects with database data.</span></span> <span data-ttu-id="cfb84-122">Em vez disso, definiremos as classes Dinner e RSVP, como eles mapeiam para/a partir do banco de dados e as relações entre eles.</span><span class="sxs-lookup"><span data-stu-id="cfb84-122">Instead, we'll define the Dinner and RSVP classes, how they map to/from the database, and the relationships between them.</span></span> <span data-ttu-id="cfb84-123">Linq para SQL, então, se envida de gerar a lógica de execução SQL apropriada para usar em tempo de execução quando interagirmos e usá-los.</span><span class="sxs-lookup"><span data-stu-id="cfb84-123">LINQ to SQL will then takes care of generating the appropriate SQL execution logic to use at runtime when we interact and use them.</span></span>

<span data-ttu-id="cfb84-124">Podemos usar o suporte à linguagem LINQ dentro de VB e C# para escrever consultas expressivas que recuperam objetos Dinner e RSVP do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="cfb84-124">We can use the LINQ language support within VB and C# to write expressive queries that retrieve Dinner and RSVP objects from the database.</span></span> <span data-ttu-id="cfb84-125">Isso minimiza a quantidade de código de dados que precisamos escrever e nos permite construir aplicativos realmente limpos.</span><span class="sxs-lookup"><span data-stu-id="cfb84-125">This minimizes the amount of data code we need to write, and allows us to build really clean applications.</span></span>

### <a name="adding-linq-to-sql-classes-to-our-project"></a><span data-ttu-id="cfb84-126">Adicionando LINQ às Classes SQL ao nosso projeto</span><span class="sxs-lookup"><span data-stu-id="cfb84-126">Adding LINQ to SQL Classes to our project</span></span>

<span data-ttu-id="cfb84-127">Começaremos clicando com o botão direito do mouse na pasta "Modelos" dentro do nosso projeto e selecionaremos o comando **'Adicionar-&gt;Novo item'** menu:</span><span class="sxs-lookup"><span data-stu-id="cfb84-127">We'll begin by right-clicking on the "Models" folder within our project, and select the **Add-&gt;New Item** menu command:</span></span>

![](build-a-model-with-business-rule-validations/_static/image1.png)

<span data-ttu-id="cfb84-128">Isso trará a caixa de diálogo "Adicionar novo item".</span><span class="sxs-lookup"><span data-stu-id="cfb84-128">This will bring up the "Add New Item" dialog.</span></span> <span data-ttu-id="cfb84-129">Filtraremos pela categoria "Dados" e selecionaremos o modelo "LINQ para SQL Classes" dentro dele:</span><span class="sxs-lookup"><span data-stu-id="cfb84-129">We'll filter by the "Data" category and select the "LINQ to SQL Classes" template within it:</span></span>

![](build-a-model-with-business-rule-validations/_static/image2.png)

<span data-ttu-id="cfb84-130">Vamos nomear o item "NerdDinner" e clicar no botão "Adicionar".</span><span class="sxs-lookup"><span data-stu-id="cfb84-130">We'll name the item "NerdDinner" and click the "Add" button.</span></span> <span data-ttu-id="cfb84-131">O Visual Studio adicionará um arquivo NerdDinner.dbml em nosso diretório \Models e, em seguida, abrirá o LINQ para o designer relacional de objetoS SQL:</span><span class="sxs-lookup"><span data-stu-id="cfb84-131">Visual Studio will add a NerdDinner.dbml file under our \Models directory, and then open the LINQ to SQL object relational designer:</span></span>

![](build-a-model-with-business-rule-validations/_static/image3.png)

### <a name="creating-data-model-classes-with-linq-to-sql"></a><span data-ttu-id="cfb84-132">Criando classes de modelo de dados com LINQ para SQL</span><span class="sxs-lookup"><span data-stu-id="cfb84-132">Creating Data Model Classes with LINQ to SQL</span></span>

<span data-ttu-id="cfb84-133">Linq para SQL nos permite criar rapidamente classes de modelos de dados a partir de esquemas de banco de dados existentes.</span><span class="sxs-lookup"><span data-stu-id="cfb84-133">LINQ to SQL enables us to quickly create data model classes from existing database schema.</span></span> <span data-ttu-id="cfb84-134">Para fazer isso, abriremos o banco de dados NerdDinner no Server Explorer e selecionaremos as Tabelas que queremos modelar nele:</span><span class="sxs-lookup"><span data-stu-id="cfb84-134">To-do this we'll open the NerdDinner database in the Server Explorer, and select the Tables we want to model in it:</span></span>

![](build-a-model-with-business-rule-validations/_static/image4.png)

<span data-ttu-id="cfb84-135">Podemos então arrastar as tabelas para a superfície do designer LINQ para sql.</span><span class="sxs-lookup"><span data-stu-id="cfb84-135">We can then drag the tables onto the LINQ to SQL designer surface.</span></span> <span data-ttu-id="cfb84-136">Quando fizermos isso LINQ para SQL criará automaticamente classes Dinner e RSVP usando o esquema das tabelas (com propriedades de classe que mapeiam as colunas de tabela do banco de dados):</span><span class="sxs-lookup"><span data-stu-id="cfb84-136">When we do this LINQ to SQL will automatically create Dinner and RSVP classes using the schema of the tables (with class properties that map to the database table columns):</span></span>

![](build-a-model-with-business-rule-validations/_static/image5.png)

<span data-ttu-id="cfb84-137">Por padrão, o designer LINQ para SQL "pluraliza" automaticamente nomes de tabela e coluna quando cria classes com base em um esquema de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="cfb84-137">By default the LINQ to SQL designer automatically "pluralizes" table and column names when it creates classes based on a database schema.</span></span> <span data-ttu-id="cfb84-138">Por exemplo: a tabela "Jantares" em nosso exemplo acima resultou em uma aula de "Jantar".</span><span class="sxs-lookup"><span data-stu-id="cfb84-138">For example: the "Dinners" table in our example above resulted in a "Dinner" class.</span></span> <span data-ttu-id="cfb84-139">Essa nomenclatura de classe ajuda a tornar nossos modelos consistentes com convenções de nomeação .NET, e eu geralmente acho que ter o designer corrigir isso conveniente (especialmente quando adicionar muitas tabelas).</span><span class="sxs-lookup"><span data-stu-id="cfb84-139">This class naming helps make our models consistent with .NET naming conventions, and I usually find that having the designer fix this up convenient (especially when adding lots of tables).</span></span> <span data-ttu-id="cfb84-140">Se você não gosta do nome de uma classe ou propriedade que o designer gera, no entanto, você sempre pode substituí-lo e alterá-lo para qualquer nome que você quiser.</span><span class="sxs-lookup"><span data-stu-id="cfb84-140">If you don't like the name of a class or property that the designer generates, though, you can always override it and change it to any name you want.</span></span> <span data-ttu-id="cfb84-141">Você pode fazer isso editando o nome da entidade/propriedade em linha dentro do designer ou modificando-o através da grade de propriedade.</span><span class="sxs-lookup"><span data-stu-id="cfb84-141">You can do this either by editing the entity/property name in-line within the designer or by modifying it via the property grid.</span></span>

<span data-ttu-id="cfb84-142">Por padrão, o designer LINQ para SQL também inspeciona as relações de chave primária/estrangeiras das tabelas e, com base nelas, cria automaticamente "associações de relacionamento" padrão entre as diferentes classes de modelo que cria.</span><span class="sxs-lookup"><span data-stu-id="cfb84-142">By default the LINQ to SQL designer also inspects the primary key/foreign key relationships of the tables, and based on them automatically creates default "relationship associations" between the different model classes it creates.</span></span> <span data-ttu-id="cfb84-143">Por exemplo, quando arrastamos as mesas Dinners e RSVP para o linq para o designer SQL, uma associação de relacionamento de um a muitos entre os dois foi inferida com base no fato de que a tabela RSVP tinha uma chave estrangeira para a tabela Dinners (isso é indicado pela seta no designer):</span><span class="sxs-lookup"><span data-stu-id="cfb84-143">For example, when we dragged the Dinners and RSVP tables onto the LINQ to SQL designer a one-to-many relationship association between the two was inferred based on the fact that the RSVP table had a foreign-key to the Dinners table (this is indicated by the arrow in the designer):</span></span>

![](build-a-model-with-business-rule-validations/_static/image6.png)

<span data-ttu-id="cfb84-144">A associação acima fará com que linq para SQL adicione uma propriedade "Jantar" fortemente digitada à classe RSVP que os desenvolvedores podem usar para acessar o Jantar associado a um determinado RSVP.</span><span class="sxs-lookup"><span data-stu-id="cfb84-144">The above association will cause LINQ to SQL to add a strongly typed "Dinner" property to the RSVP class that developers can use to access the Dinner associated with a given RSVP.</span></span> <span data-ttu-id="cfb84-145">Também fará com que a classe Dinner tenha uma propriedade de coleção "RSVPs" que permite aos desenvolvedores recuperar e atualizar objetos RSVP associados a um jantar específico.</span><span class="sxs-lookup"><span data-stu-id="cfb84-145">It will also cause the Dinner class to have a "RSVPs" collection property that enables developers to retrieve and update RSVP objects associated with a particular Dinner.</span></span>

<span data-ttu-id="cfb84-146">Abaixo você pode ver um exemplo de intelisense dentro do Visual Studio quando criamos um novo objeto RSVP e adicionamos-no à coleção RSVPs do jantar.</span><span class="sxs-lookup"><span data-stu-id="cfb84-146">Below you can see an example of intellisense within Visual Studio when we create a new RSVP object and add it to a Dinner's RSVPs collection.</span></span> <span data-ttu-id="cfb84-147">Observe como o LINQ para o SQL adicionou automaticamente uma coleção de "RSVPs" no objeto Jantar:</span><span class="sxs-lookup"><span data-stu-id="cfb84-147">Notice how LINQ to SQL automatically added a "RSVPs" collection on the Dinner object:</span></span>

![](build-a-model-with-business-rule-validations/_static/image7.png)

<span data-ttu-id="cfb84-148">Adicionando o objeto RSVP à coleção de RSVPs do jantar, estamos dizendo à LINQ ao SQL para associar uma relação de chave estrangeira entre o Jantar e a linha RSVP em nosso banco de dados:</span><span class="sxs-lookup"><span data-stu-id="cfb84-148">By adding the RSVP object to the Dinner's RSVPs collection we are telling LINQ to SQL to associate a foreign-key relationship between the Dinner and the RSVP row in our database:</span></span>

![](build-a-model-with-business-rule-validations/_static/image8.png)

<span data-ttu-id="cfb84-149">Se você não gosta de como o designer modelou ou nomeou uma associação de mesa, você pode substituí-lo.</span><span class="sxs-lookup"><span data-stu-id="cfb84-149">If you don't like how the designer has modeled or named a table association, you can override it.</span></span> <span data-ttu-id="cfb84-150">Basta clicar na seta de associação dentro do designer e acessar suas propriedades através da grade de propriedade para renomeá-la, excluí-la ou modificá-la.</span><span class="sxs-lookup"><span data-stu-id="cfb84-150">Just click on the association arrow within the designer and access its properties via the property grid to rename, delete or modify it.</span></span> <span data-ttu-id="cfb84-151">Para o nosso aplicativo NerdDinner, porém, as regras de associação padrão funcionam bem para as classes de modelo de dados que estamos construindo e podemos apenas usar o comportamento padrão.</span><span class="sxs-lookup"><span data-stu-id="cfb84-151">For our NerdDinner application, though, the default association rules work well for the data model classes we are building and we can just use the default behavior.</span></span>

### <a name="nerddinnerdatacontext-class"></a><span data-ttu-id="cfb84-152">NerdDinnerDataContext Class</span><span class="sxs-lookup"><span data-stu-id="cfb84-152">NerdDinnerDataContext Class</span></span>

<span data-ttu-id="cfb84-153">O Visual Studio criará automaticamente classes .NET que representam os modelos e relacionamentos de banco de dados definidos usando o designer LINQ para SQL.</span><span class="sxs-lookup"><span data-stu-id="cfb84-153">Visual Studio will automatically create .NET classes that represent the models and database relationships defined using the LINQ to SQL designer.</span></span> <span data-ttu-id="cfb84-154">Uma classe LINQ para SQL DataContext também é gerada para cada arquivo de designer LINQ para SQL adicionado à solução.</span><span class="sxs-lookup"><span data-stu-id="cfb84-154">A LINQ to SQL DataContext class is also generated for each LINQ to SQL designer file added to the solution.</span></span> <span data-ttu-id="cfb84-155">Como nomeamos nosso item de classe LINQ para SQL "NerdDinner", a classe DataContext criada será chamada de "NerdDinnerDataContext".</span><span class="sxs-lookup"><span data-stu-id="cfb84-155">Because we named our LINQ to SQL class item "NerdDinner", the DataContext class created will be called "NerdDinnerDataContext".</span></span> <span data-ttu-id="cfb84-156">Esta aula nerdDinnerDataContext é a principal maneira de interagir com o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="cfb84-156">This NerdDinnerDataContext class is the primary way we will interact with the database.</span></span>

<span data-ttu-id="cfb84-157">Nossa classe NerdDinnerDataContext expõe duas propriedades - "Dinners" e "RSVPs" - que representam as duas tabelas que modelamos dentro do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="cfb84-157">Our NerdDinnerDataContext class exposes two properties - "Dinners" and "RSVPs" - that represent the two tables we modeled within the database.</span></span> <span data-ttu-id="cfb84-158">Podemos usar C# para escrever consultas LINQ contra essas propriedades para consultar e recuperar objetos Dinner e RSVP do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="cfb84-158">We can use C# to write LINQ queries against those properties to query and retrieve Dinner and RSVP objects from the database.</span></span>

<span data-ttu-id="cfb84-159">O código a seguir demonstra como instanciar um objeto NerdDinnerDataContext e realizar uma consulta LINQ contra ele para obter uma seqüência de Jantares que ocorrem no futuro.</span><span class="sxs-lookup"><span data-stu-id="cfb84-159">The following code demonstrates how to instantiate a NerdDinnerDataContext object and perform a LINQ query against it to obtain a sequence of Dinners that occur in the future.</span></span> <span data-ttu-id="cfb84-160">O Visual Studio fornece intellisense completo ao escrever a consulta LINQ, e os objetos devolvidos a partir dele são fortemente digitados e também suportam o intellisense:</span><span class="sxs-lookup"><span data-stu-id="cfb84-160">Visual Studio provides full intellisense when writing the LINQ query, and the objects returned from it are strongly-typed and also support intellisense:</span></span>

![](build-a-model-with-business-rule-validations/_static/image9.png)

<span data-ttu-id="cfb84-161">Além de nos permitir consultar objetos de Jantar e RSVP, um NerdDinnerDataContext também rastreia automaticamente quaisquer alterações que fazemos posteriormente para os objetos Dinner e RSVP que recuperamos através dele.</span><span class="sxs-lookup"><span data-stu-id="cfb84-161">In addition to allowing us to query for Dinner and RSVP objects, a NerdDinnerDataContext also automatically tracks any changes we subsequently make to the Dinner and RSVP objects we retrieve through it.</span></span> <span data-ttu-id="cfb84-162">Podemos usar essa funcionalidade para salvar facilmente as alterações de volta ao banco de dados - sem ter que escrever qualquer código explícito de atualização SQL.</span><span class="sxs-lookup"><span data-stu-id="cfb84-162">We can use this functionality to easily save the changes back to the database - without having to write any explicit SQL update code.</span></span>

<span data-ttu-id="cfb84-163">Por exemplo, o código abaixo demonstra como usar uma consulta LINQ para recuperar um único objeto do Dinner do banco de dados, atualizar duas propriedades do Jantar e, em seguida, salvar as alterações de volta ao banco de dados:</span><span class="sxs-lookup"><span data-stu-id="cfb84-163">For example, the code below demonstrates how to use a LINQ query to retrieve a single Dinner object from the database, update two of the Dinner properties, and then save the changes back to the database:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample1.cs)]

<span data-ttu-id="cfb84-164">O objeto NerdDinnerDataContext no código acima rastreou automaticamente as alterações de propriedade feitas no objeto Dinner que recuperamos dele.</span><span class="sxs-lookup"><span data-stu-id="cfb84-164">The NerdDinnerDataContext object in the code above automatically tracked the property changes made to the Dinner object we retrieved from it.</span></span> <span data-ttu-id="cfb84-165">Quando chamamos o método "SubmitChanges()", ele executará uma declaração apropriada de "ATUALIZAÇÃO" SQL para o banco de dados para persistir os valores atualizados de volta.</span><span class="sxs-lookup"><span data-stu-id="cfb84-165">When we called the "SubmitChanges()" method, it will execute an appropriate SQL "UPDATE" statement to the database to persist the updated values back.</span></span>

### <a name="creating-a-dinnerrepository-class"></a><span data-ttu-id="cfb84-166">Criando uma Aula de Repositório de Jantar</span><span class="sxs-lookup"><span data-stu-id="cfb84-166">Creating a DinnerRepository Class</span></span>

<span data-ttu-id="cfb84-167">Para aplicações pequenas, às vezes é bom que os controladores trabalhem diretamente contra uma classe LINQ para SQL DataContext e incorporem consultas LINQ dentro dos Controladores.</span><span class="sxs-lookup"><span data-stu-id="cfb84-167">For small applications it is sometimes fine to have Controllers work directly against a LINQ to SQL DataContext class, and embed LINQ queries within the Controllers.</span></span> <span data-ttu-id="cfb84-168">À medida que as aplicações ficam maiores, porém, essa abordagem se torna complicada para manter e testar.</span><span class="sxs-lookup"><span data-stu-id="cfb84-168">As applications get larger, though, this approach becomes cumbersome to maintain and test.</span></span> <span data-ttu-id="cfb84-169">Também pode nos levar a duplicar as mesmas consultas LINQ em vários lugares.</span><span class="sxs-lookup"><span data-stu-id="cfb84-169">It can also lead to us duplicating the same LINQ queries in multiple places.</span></span>

<span data-ttu-id="cfb84-170">Uma abordagem que pode tornar os aplicativos mais fáceis de manter e testar é usar um padrão de "repositório".</span><span class="sxs-lookup"><span data-stu-id="cfb84-170">One approach that can make applications easier to maintain and test is to use a "repository" pattern.</span></span> <span data-ttu-id="cfb84-171">Uma classe de repositório ajuda a encapsular a lógica de consulta e persistência de dados e abstrai os detalhes de implementação da persistência de dados do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="cfb84-171">A repository class helps encapsulate data querying and persistence logic, and abstracts away the implementation details of the data persistence from the application.</span></span> <span data-ttu-id="cfb84-172">Além de tornar o código de aplicativo mais limpo, o uso de um padrão de repositório pode facilitar a alteração das implementações de armazenamento de dados no futuro, e pode ajudar a facilitar o teste de unidade de um aplicativo sem precisar de um banco de dados real.</span><span class="sxs-lookup"><span data-stu-id="cfb84-172">In addition to making application code cleaner, using a repository pattern can make it easier to change data storage implementations in the future, and it can help facilitate unit testing an application without requiring a real database.</span></span>

<span data-ttu-id="cfb84-173">Para o nosso aplicativo NerdDinner, definiremos uma aula de DinnerRepository com a assinatura abaixo:</span><span class="sxs-lookup"><span data-stu-id="cfb84-173">For our NerdDinner application we'll define a DinnerRepository class with the below signature:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample2.cs)]

<span data-ttu-id="cfb84-174">*Nota: Mais tarde, neste capítulo, extraíremos uma interface IDinnerRepository desta classe e habilitaremos a injeção de dependência com ela em nossos Controladores. Para começar, porém, vamos começar simples e apenas trabalhar diretamente com a classe DinnerRepository.*</span><span class="sxs-lookup"><span data-stu-id="cfb84-174">*Note: Later in this chapter we'll extract an IDinnerRepository interface from this class and enable dependency injection with it on our Controllers. To begin with, though, we are going to start simple and just work directly with the DinnerRepository class.*</span></span>

<span data-ttu-id="cfb84-175">Para implementar esta classe, clicaremos com o botão direito do mouse em nossa pasta "Modelos" e escolheremos o comando **'Adicionar-&gt;Novo item** menu'.</span><span class="sxs-lookup"><span data-stu-id="cfb84-175">To implement this class we'll right-click on our "Models" folder and choose the **Add-&gt;New Item** menu command.</span></span> <span data-ttu-id="cfb84-176">Na caixa de diálogo "Adicionar novo item", selecionaremos o modelo "Classe" e nomearemos o arquivo "DinnerRepository.cs":</span><span class="sxs-lookup"><span data-stu-id="cfb84-176">Within the "Add New Item" dialog we'll select the "Class" template and name the file "DinnerRepository.cs":</span></span>

![](build-a-model-with-business-rule-validations/_static/image10.png)

<span data-ttu-id="cfb84-177">Podemos então implementar nossa classe DinnerRepository usando o código abaixo:</span><span class="sxs-lookup"><span data-stu-id="cfb84-177">We can then implement our DinnerRepository class using the code below:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample3.cs)]

### <a name="retrieving-updating-inserting-and-deleting-using-the-dinnerrepository-class"></a><span data-ttu-id="cfb84-178">Recuperando, atualizando, inserindo e excluindo usando a classe DinnerRepository</span><span class="sxs-lookup"><span data-stu-id="cfb84-178">Retrieving, Updating, Inserting and Deleting using the DinnerRepository class</span></span>

<span data-ttu-id="cfb84-179">Agora que criamos nossa aula de DinnerRepository, vamos olhar alguns exemplos de código que demonstram tarefas comuns que podemos fazer com ela:</span><span class="sxs-lookup"><span data-stu-id="cfb84-179">Now that we've created our DinnerRepository class, let's look at a few code examples that demonstrate common tasks we can do with it:</span></span>

#### <a name="querying-examples"></a><span data-ttu-id="cfb84-180">Exemplos de consulta</span><span class="sxs-lookup"><span data-stu-id="cfb84-180">Querying Examples</span></span>

<span data-ttu-id="cfb84-181">O código abaixo recupera um único Jantar usando o valor DinnerID:</span><span class="sxs-lookup"><span data-stu-id="cfb84-181">The code below retrieves a single Dinner using the DinnerID value:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample4.cs)]

<span data-ttu-id="cfb84-182">O código abaixo recupera todos os jantares próximos e loops sobre eles:</span><span class="sxs-lookup"><span data-stu-id="cfb84-182">The code below retrieves all upcoming dinners and loops over them:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample5.cs)]

#### <a name="insert-and-update-examples"></a><span data-ttu-id="cfb84-183">Inserir e atualizar exemplos</span><span class="sxs-lookup"><span data-stu-id="cfb84-183">Insert and Update Examples</span></span>

<span data-ttu-id="cfb84-184">O código abaixo demonstra a adição de dois novos jantares.</span><span class="sxs-lookup"><span data-stu-id="cfb84-184">The code below demonstrates adding two new dinners.</span></span> <span data-ttu-id="cfb84-185">As adições/modificações no repositório não são comprometidas no banco de dados até que o método "Salvar()" seja chamado nele.</span><span class="sxs-lookup"><span data-stu-id="cfb84-185">Additions/modifications to the repository aren't committed to the database until the "Save()" method is called on it.</span></span> <span data-ttu-id="cfb84-186">Linq para SQL envolve automaticamente todas as alterações em uma transação de banco de dados – de modo que todas as alterações acontecem ou nenhuma delas acontece quando nosso repositório salva:</span><span class="sxs-lookup"><span data-stu-id="cfb84-186">LINQ to SQL automatically wraps all changes in a database transaction – so either all changes happen or none of them do when our repository saves:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample6.cs)]

<span data-ttu-id="cfb84-187">O código abaixo recupera um objeto de Jantar existente e modifica duas propriedades nele.</span><span class="sxs-lookup"><span data-stu-id="cfb84-187">The code below retrieves an existing Dinner object, and modifies two properties on it.</span></span> <span data-ttu-id="cfb84-188">As alterações são comprometidas de volta ao banco de dados quando o método "Salvar()" é chamado em nosso repositório:</span><span class="sxs-lookup"><span data-stu-id="cfb84-188">The changes are committed back to the database when the "Save()" method is called on our repository:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample7.cs)]

<span data-ttu-id="cfb84-189">O código abaixo recupera um jantar e, em seguida, adiciona um RSVP a ele.</span><span class="sxs-lookup"><span data-stu-id="cfb84-189">The code below retrieves a dinner and then adds an RSVP to it.</span></span> <span data-ttu-id="cfb84-190">Ele faz isso usando a coleção de RSVPs no objeto Dinner que linq para SQL criou para nós (porque há uma relação de chave primária/chave estrangeira entre os dois no banco de dados).</span><span class="sxs-lookup"><span data-stu-id="cfb84-190">It does this using the RSVPs collection on the Dinner object that LINQ to SQL created for us (because there is a primary-key/foreign-key relationship between the two in the database).</span></span> <span data-ttu-id="cfb84-191">Essa alteração é persistida de volta ao banco de dados como uma nova linha de tabela RSVP quando o método "Salvar()" é chamado no repositório:</span><span class="sxs-lookup"><span data-stu-id="cfb84-191">This change is persisted back to the database as a new RSVP table row when the "Save()" method is called on the repository:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample8.cs)]

#### <a name="delete-example"></a><span data-ttu-id="cfb84-192">Excluir exemplo</span><span class="sxs-lookup"><span data-stu-id="cfb84-192">Delete Example</span></span>

<span data-ttu-id="cfb84-193">O código abaixo recupera um objeto de Jantar existente e, em seguida, marca-o para ser excluído.</span><span class="sxs-lookup"><span data-stu-id="cfb84-193">The code below retrieves an existing Dinner object, and then marks it to be deleted.</span></span> <span data-ttu-id="cfb84-194">Quando o método "Salvar()" for chamado no repositório, ele comprometerá a exclusão de volta ao banco de dados:</span><span class="sxs-lookup"><span data-stu-id="cfb84-194">When the "Save()" method is called on the repository it will commit the delete back to the database:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample9.cs)]

### <a name="integrating-validation-and-business-rule-logic-with-model-classes"></a><span data-ttu-id="cfb84-195">Integrando a lógica de validação e regra de negócios com classes de modelo</span><span class="sxs-lookup"><span data-stu-id="cfb84-195">Integrating Validation and Business Rule Logic with Model Classes</span></span>

<span data-ttu-id="cfb84-196">Integrar a lógica de validação e regra de negócios é uma parte fundamental de qualquer aplicativo que trabalhe com dados.</span><span class="sxs-lookup"><span data-stu-id="cfb84-196">Integrating validation and business rule logic is a key part of any application that works with data.</span></span>

#### <a name="schema-validation"></a><span data-ttu-id="cfb84-197">Validação de esquemas</span><span class="sxs-lookup"><span data-stu-id="cfb84-197">Schema Validation</span></span>

<span data-ttu-id="cfb84-198">Quando as classes de modelo são definidas usando o designer LINQ para SQL, os tipos de dados das propriedades nas classes de modelo de dados correspondem aos tipos de dados da tabela de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="cfb84-198">When model classes are defined using the LINQ to SQL designer, the datatypes of the properties in the data model classes correspond to the datatypes of the database table.</span></span> <span data-ttu-id="cfb84-199">Por exemplo: se a coluna "EventDate" na tabela Jantares for uma "hora de data", a classe de modelo de dados criada pela LINQ para sql será do tipo "DateTime" (que é um tipo de dados .NET incorporado).</span><span class="sxs-lookup"><span data-stu-id="cfb84-199">For example: if the "EventDate" column in the Dinners table is a "datetime", the data model class created by LINQ to SQL will be of type "DateTime" (which is a built-in .NET datatype).</span></span> <span data-ttu-id="cfb84-200">Isso significa que você terá erros de compilação se tentar atribuir um inteiro ou booleano a ele a partir do código, e ele aumentará um erro automaticamente se você tentar converter implicitamente um tipo de string não-válido para ele em tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="cfb84-200">This means you will get compile errors if you attempt to assign an integer or boolean to it from code, and it will raise an error automatically if you attempt to implicitly convert a non-valid string type to it at runtime.</span></span>

<span data-ttu-id="cfb84-201">LINQ para SQL também lidará automaticamente com a fuga de valores SQL para você ao usar strings - o que ajuda a protegê-lo contra ataques de injeção SQL ao usá-lo.</span><span class="sxs-lookup"><span data-stu-id="cfb84-201">LINQ to SQL will also automatically handles escaping SQL values for you when using strings - which helps protect you against SQL injection attacks when using it.</span></span>

#### <a name="validation-and-business-rule-logic"></a><span data-ttu-id="cfb84-202">Lógica de Validação e Regra de Negócios</span><span class="sxs-lookup"><span data-stu-id="cfb84-202">Validation and Business Rule Logic</span></span>

<span data-ttu-id="cfb84-203">A validação do esquema é útil como um primeiro passo, mas raramente é suficiente.</span><span class="sxs-lookup"><span data-stu-id="cfb84-203">Schema validation is useful as a first step, but is rarely sufficient.</span></span> <span data-ttu-id="cfb84-204">A maioria dos cenários do mundo real requer a capacidade de especificar uma lógica de validação mais rica que pode abranger várias propriedades, executar códigos e, muitas vezes, ter consciência do estado de um modelo (por exemplo: ele está sendo criado /atualizado/excluído, ou dentro de um estado específico de domínio como "arquivado").</span><span class="sxs-lookup"><span data-stu-id="cfb84-204">Most real-world scenarios require the ability to specify richer validation logic that can span multiple properties, execute code, and often have awareness of a model's state (for example: is it being created /updated/deleted, or within a domain-specific state like "archived").</span></span> <span data-ttu-id="cfb84-205">Existem uma variedade de padrões e frameworks diferentes que podem ser usados para definir e aplicar regras de validação para classes de modelo, e existem vários frameworks baseados em .NET lá fora que podem ser usados para ajudar com isso.</span><span class="sxs-lookup"><span data-stu-id="cfb84-205">There are a variety of different patterns and frameworks that can be used to define and apply validation rules to model classes, and there are several .NET based frameworks out there that can be used to help with this.</span></span> <span data-ttu-id="cfb84-206">Você pode usar praticamente qualquer um deles dentro de ASP.NET aplicativos MVC.</span><span class="sxs-lookup"><span data-stu-id="cfb84-206">You can use pretty much any of them within ASP.NET MVC applications.</span></span>

<span data-ttu-id="cfb84-207">Para efeitos do nosso aplicativo NerdDinner, usaremos um padrão relativamente simples e direto onde exporemos uma propriedade IsValid e um método GetRuleViolations() em nosso objeto modelo Dinner.</span><span class="sxs-lookup"><span data-stu-id="cfb84-207">For the purposes of our NerdDinner application, we'll use a relatively simple and straight-forward pattern where we expose an IsValid property and a GetRuleViolations() method on our Dinner model object.</span></span> <span data-ttu-id="cfb84-208">A propriedade IsValid retornará verdadeira ou falsa, dependendo se as regras de validação e de negócios são todas válidas.</span><span class="sxs-lookup"><span data-stu-id="cfb84-208">The IsValid property will return true or false depending on whether the validation and business rules are all valid.</span></span> <span data-ttu-id="cfb84-209">O método GetRuleViolations() retornará uma lista de quaisquer erros de regra.</span><span class="sxs-lookup"><span data-stu-id="cfb84-209">The GetRuleViolations() method will return a list of any rule errors.</span></span>

<span data-ttu-id="cfb84-210">Implementaremos IsValid e GetRuleViolations() para o nosso modelo de jantar adicionando uma "classe parcial" ao nosso projeto.</span><span class="sxs-lookup"><span data-stu-id="cfb84-210">We'll implement IsValid and GetRuleViolations() for our Dinner model by adding a "partial class" to our project.</span></span> <span data-ttu-id="cfb84-211">As aulas parciais podem ser usadas para adicionar métodos/propriedades/eventos às classes mantidas por um designer VS (como a classe Dinner gerada pelo designer LINQ para SQL) e ajudar a evitar que a ferramenta se meta com nosso código.</span><span class="sxs-lookup"><span data-stu-id="cfb84-211">Partial classes can be used to add methods/properties/events to classes maintained by a VS designer (like the Dinner class generated by the LINQ to SQL designer) and help avoid the tool from messing with our code.</span></span> <span data-ttu-id="cfb84-212">Podemos adicionar uma nova classe parcial ao nosso projeto clicando com o botão direito do mouse na pasta \Modelos e, em seguida, selecione o comando menu "Adicionar novo item".</span><span class="sxs-lookup"><span data-stu-id="cfb84-212">We can add a new partial class to our project by right-clicking on the \Models folder, and then select the "Add New Item" menu command.</span></span> <span data-ttu-id="cfb84-213">Em seguida, podemos escolher o modelo "Classe" na caixa de diálogo "Adicionar novo item" e nomeá-lo Dinner.cs.</span><span class="sxs-lookup"><span data-stu-id="cfb84-213">We can then choose the "Class" template within the "Add New Item" dialog and name it Dinner.cs.</span></span>

![](build-a-model-with-business-rule-validations/_static/image11.png)

<span data-ttu-id="cfb84-214">Clicar no botão "Adicionar" adicionará um arquivo Dinner.cs ao nosso projeto e o abrirá dentro do IDE.</span><span class="sxs-lookup"><span data-stu-id="cfb84-214">Clicking the "Add" button will add a Dinner.cs file to our project and open it within the IDE.</span></span> <span data-ttu-id="cfb84-215">Podemos então implementar uma estrutura básica de aplicação de regras/validação usando o código abaixo:</span><span class="sxs-lookup"><span data-stu-id="cfb84-215">We can then implement a basic rule/validation enforcement framework using the below code:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample10.cs)]

<span data-ttu-id="cfb84-216">Algumas notas sobre o código acima:</span><span class="sxs-lookup"><span data-stu-id="cfb84-216">A few notes about the above code:</span></span>

- <span data-ttu-id="cfb84-217">A classe Dinner é pré-confrontada com uma palavra-chave "parcial" – o que significa que o código contido nela será combinado com a classe gerada/mantida pelo designer LINQ para SQL e compilada em uma única classe.</span><span class="sxs-lookup"><span data-stu-id="cfb84-217">The Dinner class is prefaced with a "partial" keyword – which means the code contained within it will be combined with the class generated/maintained by the LINQ to SQL designer and compiled into a single class.</span></span>
- <span data-ttu-id="cfb84-218">A classe RuleViolation é uma classe auxiliar que adicionaremos ao projeto que nos permite fornecer mais detalhes sobre uma violação de regras.</span><span class="sxs-lookup"><span data-stu-id="cfb84-218">The RuleViolation class is a helper class we'll add to the project that allows us to provide more details about a rule violation.</span></span>
- <span data-ttu-id="cfb84-219">O método Dinner.GetRuleViolations() faz com que nossas regras de validação e de negócios sejam avaliadas (vamos implementá-las em breve).</span><span class="sxs-lookup"><span data-stu-id="cfb84-219">The Dinner.GetRuleViolations() method causes our validation and business rules to be evaluated (we'll implement them shortly).</span></span> <span data-ttu-id="cfb84-220">Em seguida, ele retorna uma seqüência de objetos RuleViolation que fornecem mais detalhes sobre quaisquer erros de regra.</span><span class="sxs-lookup"><span data-stu-id="cfb84-220">It then returns back a sequence of RuleViolation objects that provide more details about any rule errors.</span></span>
- <span data-ttu-id="cfb84-221">A propriedade Dinner.IsValid fornece uma propriedade de ajuda conveniente que indica se o objeto Dinner tem alguma violação de regras ativa.</span><span class="sxs-lookup"><span data-stu-id="cfb84-221">The Dinner.IsValid property provides a convenient helper property that indicates whether the Dinner object has any active RuleViolations.</span></span> <span data-ttu-id="cfb84-222">Ele pode ser verificado proativamente por um desenvolvedor usando o objeto Dinner a qualquer momento (e não levanta uma exceção).</span><span class="sxs-lookup"><span data-stu-id="cfb84-222">It can be proactively checked by a developer using the Dinner object at anytime (and does not raise an exception).</span></span>
- <span data-ttu-id="cfb84-223">O método parcial Dinner.OnValidate() é um gancho que linq para SQL fornece que nos permite ser notificados sempre que o objeto Dinner está prestes a ser persistido dentro do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="cfb84-223">The Dinner.OnValidate() partial method is a hook that LINQ to SQL provides that allows us to be notified anytime the Dinner object is about to be persisted within the database.</span></span> <span data-ttu-id="cfb84-224">Nossa implementação onValidate() acima garante que o Jantar não tenha violações de regras antes de ser salvo.</span><span class="sxs-lookup"><span data-stu-id="cfb84-224">Our OnValidate() implementation above ensures that the Dinner has no RuleViolations before it is saved.</span></span> <span data-ttu-id="cfb84-225">Se estiver em um estado inválido, ele levanta uma exceção, o que fará com que linq para SQL aborte a transação.</span><span class="sxs-lookup"><span data-stu-id="cfb84-225">If it is in an invalid state it raises an exception, which will cause LINQ to SQL to abort the transaction.</span></span>

<span data-ttu-id="cfb84-226">Essa abordagem fornece uma estrutura simples em que podemos integrar regras de validação e negócios.</span><span class="sxs-lookup"><span data-stu-id="cfb84-226">This approach provides a simple framework that we can integrate validation and business rules into.</span></span> <span data-ttu-id="cfb84-227">Por enquanto, vamos adicionar as regras abaixo ao nosso método GetRuleViolations(:</span><span class="sxs-lookup"><span data-stu-id="cfb84-227">For now let's add the below rules to our GetRuleViolations() method:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample11.cs)]

<span data-ttu-id="cfb84-228">Estamos usando o recurso "yield return" do C# para retornar uma seqüência de quaisquer Violações de Regras.</span><span class="sxs-lookup"><span data-stu-id="cfb84-228">We are using the "yield return" feature of C# to return a sequence of any RuleViolations.</span></span> <span data-ttu-id="cfb84-229">As primeiras seis verificações de regras acima simplesmente impõem que as propriedades das cordas em nosso Jantar não podem ser nulas ou vazias.</span><span class="sxs-lookup"><span data-stu-id="cfb84-229">The first six rule checks above simply enforce that string properties on our Dinner cannot be null or empty.</span></span> <span data-ttu-id="cfb84-230">A última regra é um pouco mais interessante, e chama um método auxiliar PhoneValidator.IsValidNumber() que podemos adicionar ao nosso projeto para verificar se o formato do número do ContactPhone corresponde ao país do Jantar.</span><span class="sxs-lookup"><span data-stu-id="cfb84-230">The last rule is a little more interesting, and calls a PhoneValidator.IsValidNumber() helper method that we can add to our project to verify that the ContactPhone number format matches the Dinner's country.</span></span>

<span data-ttu-id="cfb84-231">Podemos usar. O suporte de expressão regular da NET para implementar este suporte de validação de telefone.</span><span class="sxs-lookup"><span data-stu-id="cfb84-231">We can use .NET's regular expression support to implement this phone validation support.</span></span> <span data-ttu-id="cfb84-232">Abaixo está uma implementação simples do PhoneValidator que podemos adicionar ao nosso projeto que nos permite adicionar verificações de padrão Regex específicas do país:</span><span class="sxs-lookup"><span data-stu-id="cfb84-232">Below is a simple PhoneValidator implementation that we can add to our project that enables us to add country-specific Regex pattern checks:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample12.cs)]

#### <a name="handling-validation-and-business-logic-violations"></a><span data-ttu-id="cfb84-233">Manipulação de validação e violações lógicas de negócios</span><span class="sxs-lookup"><span data-stu-id="cfb84-233">Handling Validation and Business Logic Violations</span></span>

<span data-ttu-id="cfb84-234">Agora que adicionamos o código de validação e regra de negócios acima, sempre que tentarmos criar ou atualizar um Jantar, nossas regras lógicas de validação serão avaliadas e aplicadas.</span><span class="sxs-lookup"><span data-stu-id="cfb84-234">Now that we've added the above validation and business rule code, any time we try to create or update a Dinner, our validation logic rules will be evaluated and enforced.</span></span>

<span data-ttu-id="cfb84-235">Os desenvolvedores podem escrever código satisfaz abaixo para determinar proativamente se um objeto Dinner é válido e recuperar uma lista de todas as violações nele sem levantar nenhuma exceção:</span><span class="sxs-lookup"><span data-stu-id="cfb84-235">Developers can write code like below to proactively determine if a Dinner object is valid, and retrieve a list of all violations in it without raising any exceptions:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample13.cs)]

<span data-ttu-id="cfb84-236">Se tentarmos salvar um jantar em um estado inválido, uma exceção será levantada quando chamarmos o método Save() no DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="cfb84-236">If we attempt to save a Dinner in an invalid state, an exception will be raised when we call the Save() method on the DinnerRepository.</span></span> <span data-ttu-id="cfb84-237">Isso ocorre porque linq para SQL chama automaticamente o nosso método parcial Dinner.OnValidate() antes de salvar as alterações do Jantar, e adicionamos código ao Dinner.OnValidate() para abrir uma exceção se houver alguma violação de regra no Jantar.</span><span class="sxs-lookup"><span data-stu-id="cfb84-237">This occurs because LINQ to SQL automatically calls our Dinner.OnValidate() partial method before it saves the Dinner's changes, and we added code to Dinner.OnValidate() to raise an exception if any rule violations exist in the Dinner.</span></span> <span data-ttu-id="cfb84-238">Podemos pegar essa exceção e recuperar reativamente uma lista das violações para corrigir:</span><span class="sxs-lookup"><span data-stu-id="cfb84-238">We can catch this exception and reactively retrieve a list of the violations to fix:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample14.cs)]

<span data-ttu-id="cfb84-239">Como nossas regras de validação e negócios são implementadas dentro da nossa camada de modelo, e não dentro da camada de Interface do Usuário, elas serão aplicadas e usadas em todos os cenários dentro do nosso aplicativo.</span><span class="sxs-lookup"><span data-stu-id="cfb84-239">Because our validation and business rules are implemented within our model layer, and not within the UI layer, they will be applied and used across all scenarios within our application.</span></span> <span data-ttu-id="cfb84-240">Mais tarde, podemos mudar ou adicionar regras de negócios e ter todos os códigos que funcionam com nossos objetos de jantar honrá-los.</span><span class="sxs-lookup"><span data-stu-id="cfb84-240">We can later change or add business rules and have all code that works with our Dinner objects honor them.</span></span>

<span data-ttu-id="cfb84-241">Ter a flexibilidade de mudar as regras de negócios em um só lugar, sem ter essas mudanças em toda a lógica de aplicação e interface do usuário, é um sinal de uma aplicação bem escrita, e um benefício que uma estrutura de MVC ajuda a incentivar.</span><span class="sxs-lookup"><span data-stu-id="cfb84-241">Having the flexibility to change business rules in one place, without having these changes ripple throughout the application and UI logic, is a sign of a well-written application, and a benefit that an MVC framework helps encourage.</span></span>

### <a name="next-step"></a><span data-ttu-id="cfb84-242">Próxima etapa</span><span class="sxs-lookup"><span data-stu-id="cfb84-242">Next Step</span></span>

<span data-ttu-id="cfb84-243">Agora temos um modelo que podemos usar para consultar e atualizar nosso banco de dados.</span><span class="sxs-lookup"><span data-stu-id="cfb84-243">We've now got a model that we can use to both query and update our database.</span></span>

<span data-ttu-id="cfb84-244">Vamos agora adicionar alguns controladores e visualizações ao projeto que podemos usar para construir uma experiência de IU HTML em torno dele.</span><span class="sxs-lookup"><span data-stu-id="cfb84-244">Let's now add some controllers and views to the project that we can use to build an HTML UI experience around it.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="cfb84-245">[Próximo](create-a-database.md)
> [anterior](use-controllers-and-views-to-implement-a-listingdetails-ui.md)</span><span class="sxs-lookup"><span data-stu-id="cfb84-245">[Previous](create-a-database.md)
[Next](use-controllers-and-views-to-implement-a-listingdetails-ui.md)</span></span>
