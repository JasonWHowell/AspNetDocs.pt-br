---
uid: mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
title: Habilitar testes automatizados de unidades | Microsoft Docs
author: rick-anderson
description: O passo 12 mostra como desenvolver um conjunto de testes automatizados de unidades que verificam nossa funcionalidade nerdDinner, e que nos dará a confiança para fazer mudanças...
ms.author: riande
ms.date: 07/27/2010
ms.assetid: a19ff2ce-3f7e-4358-9a51-a1403da9c63e
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
msc.type: authoredcontent
ms.openlocfilehash: 7fe84efd9e4cc359c19d5ab9e22c579b80207e9c
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/17/2020
ms.locfileid: "81541462"
---
# <a name="enable-automated-unit-testing"></a><span data-ttu-id="7ecca-103">Habilitar o teste de unidade automatizado</span><span class="sxs-lookup"><span data-stu-id="7ecca-103">Enable Automated Unit Testing</span></span>

<span data-ttu-id="7ecca-104">pela [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="7ecca-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="7ecca-105">Baixar PDF</span><span class="sxs-lookup"><span data-stu-id="7ecca-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="7ecca-106">Este é o passo 12 de um tutorial gratuito do [aplicativo "NerdDinner"](introducing-the-nerddinner-tutorial.md) que mostra como construir um pequeno, mas completo, aplicativo web usando ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="7ecca-106">This is step 12 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="7ecca-107">O passo 12 mostra como desenvolver um conjunto de testes automatizados de unidades que verificam nossa funcionalidade NerdDinner, e que nos dará a confiança para fazer mudanças e melhorias na aplicação no futuro.</span><span class="sxs-lookup"><span data-stu-id="7ecca-107">Step 12 shows how to develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>
> 
> <span data-ttu-id="7ecca-108">Se você estiver usando ASP.NET MVC 3, recomendamos que você siga os tutoriais da [MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) ou [MVC Music Store.](../../older-versions/mvc-music-store/mvc-music-store-part-1.md)</span><span class="sxs-lookup"><span data-stu-id="7ecca-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>

## <a name="nerddinner-step-12-unit-testing"></a><span data-ttu-id="7ecca-109">NerdDinner Passo 12: Testes unitários</span><span class="sxs-lookup"><span data-stu-id="7ecca-109">NerdDinner Step 12: Unit Testing</span></span>

<span data-ttu-id="7ecca-110">Vamos desenvolver um conjunto de testes automatizados de unidades que verificam nossa funcionalidade NerdDinner, e que nos dará a confiança para fazer mudanças e melhorias na aplicação no futuro.</span><span class="sxs-lookup"><span data-stu-id="7ecca-110">Let's develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>

### <a name="why-unit-test"></a><span data-ttu-id="7ecca-111">Por que teste unitário?</span><span class="sxs-lookup"><span data-stu-id="7ecca-111">Why Unit Test?</span></span>

<span data-ttu-id="7ecca-112">No caminho para o trabalho uma manhã você tem um flash repentino de inspiração sobre um aplicativo que você está trabalhando.</span><span class="sxs-lookup"><span data-stu-id="7ecca-112">On the drive into work one morning you have a sudden flash of inspiration about an application you are working on.</span></span> <span data-ttu-id="7ecca-113">Você percebe que há uma mudança que você pode implementar que tornará a aplicação dramaticamente melhor.</span><span class="sxs-lookup"><span data-stu-id="7ecca-113">You realize there is a change you can implement that will make the application dramatically better.</span></span> <span data-ttu-id="7ecca-114">Pode ser uma refatoração que limpa o código, adiciona um novo recurso ou corrige um bug.</span><span class="sxs-lookup"><span data-stu-id="7ecca-114">It might be a refactoring that cleans up the code, adds a new feature, or fixes a bug.</span></span>

<span data-ttu-id="7ecca-115">A pergunta que o confronta quando você chega ao seu computador é : "quão seguro é fazer essa melhoria?"</span><span class="sxs-lookup"><span data-stu-id="7ecca-115">The question that confronts you when you arrive at your computer is – "how safe is it to make this improvement?"</span></span> <span data-ttu-id="7ecca-116">E se fazer a mudança tiver efeitos colaterais ou quebrar alguma coisa?</span><span class="sxs-lookup"><span data-stu-id="7ecca-116">What if making the change has side effects or breaks something?</span></span> <span data-ttu-id="7ecca-117">A mudança pode ser simples e levar apenas alguns minutos para ser implementada, mas e se levar horas para testar manualmente todos os cenários do aplicativo?</span><span class="sxs-lookup"><span data-stu-id="7ecca-117">The change might be simple and only take a few minutes to implement, but what if it takes hours to manually test out all of the application scenarios?</span></span> <span data-ttu-id="7ecca-118">E se você esquecer de cobrir um cenário e uma aplicação quebrada entrar em produção?</span><span class="sxs-lookup"><span data-stu-id="7ecca-118">What if you forget to cover a scenario and a broken application goes into production?</span></span> <span data-ttu-id="7ecca-119">Fazer essa melhoria realmente vale todo o esforço?</span><span class="sxs-lookup"><span data-stu-id="7ecca-119">Is making this improvement really worth all the effort?</span></span>

<span data-ttu-id="7ecca-120">Testes automatizados de unidades podem fornecer uma rede de segurança que permite que você melhore continuamente suas aplicações e evite ter medo do código em que você está trabalhando.</span><span class="sxs-lookup"><span data-stu-id="7ecca-120">Automated unit tests can provide a safety net that enables you to continually enhance your applications, and avoid being afraid of the code you are working on.</span></span> <span data-ttu-id="7ecca-121">Ter testes automatizados que verificam rapidamente a funcionalidade permite que você codifique com confiança – e o capacite a fazer melhorias que você pode não ter se sentido confortável em fazer.</span><span class="sxs-lookup"><span data-stu-id="7ecca-121">Having automated tests that quickly verify functionality enables you to code with confidence – and empower you to make improvements you might otherwise not have felt comfortable doing.</span></span> <span data-ttu-id="7ecca-122">Eles também ajudam a criar soluções que são mais mantenedoras e têm uma vida útil mais longa - o que leva a um retorno muito maior do investimento.</span><span class="sxs-lookup"><span data-stu-id="7ecca-122">They also help create solutions that are more maintainable and have a longer lifetime - which leads to a much higher return on investment.</span></span>

<span data-ttu-id="7ecca-123">O ASP.NET MVC Framework facilita e é natural a funcionalidade do aplicativo de teste unitário.</span><span class="sxs-lookup"><span data-stu-id="7ecca-123">The ASP.NET MVC Framework makes it easy and natural to unit test application functionality.</span></span> <span data-ttu-id="7ecca-124">Ele também permite um fluxo de trabalho TDD (Test Driven Development, desenvolvimento orientado por teste) que permite o desenvolvimento baseado em primeiro teste.</span><span class="sxs-lookup"><span data-stu-id="7ecca-124">It also enables a Test Driven Development (TDD) workflow that enables test-first based development.</span></span>

### <a name="nerddinnertests-project"></a><span data-ttu-id="7ecca-125">Projeto NerdDinner.Tests</span><span class="sxs-lookup"><span data-stu-id="7ecca-125">NerdDinner.Tests Project</span></span>

<span data-ttu-id="7ecca-126">Quando criamos nosso aplicativo NerdDinner no início deste tutorial, fomos solicitados com um diálogo perguntando se queríamos criar um projeto de teste de unidade para acompanhar o projeto do aplicativo:</span><span class="sxs-lookup"><span data-stu-id="7ecca-126">When we created our NerdDinner application at the beginning of this tutorial, we were prompted with a dialog asking whether we wanted to create a unit test project to go along with the application project:</span></span>

![](enable-automated-unit-testing/_static/image1.png)

<span data-ttu-id="7ecca-127">Mantivemos o botão de rádio "Sim, crie um projeto de teste de unidade" selecionado – o que resultou em um projeto "NerdDinner.Tests" sendo adicionado à nossa solução:</span><span class="sxs-lookup"><span data-stu-id="7ecca-127">We kept the "Yes, create a unit test project" radio button selected – which resulted in a "NerdDinner.Tests" project being added to our solution:</span></span>

![](enable-automated-unit-testing/_static/image2.png)

<span data-ttu-id="7ecca-128">O projeto NerdDinner.Tests faz referência à montagem do projeto do aplicativo NerdDinner e nos permite adicionar facilmente testes automatizados a ele que verifiquem a funcionalidade do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="7ecca-128">The NerdDinner.Tests project references the NerdDinner application project assembly, and enables us to easily add automated tests to it that verify the application functionality.</span></span>

### <a name="creating-unit-tests-for-our-dinner-model-class"></a><span data-ttu-id="7ecca-129">Criando testes unitários para nossa classe modelo de jantar</span><span class="sxs-lookup"><span data-stu-id="7ecca-129">Creating Unit Tests for our Dinner Model Class</span></span>

<span data-ttu-id="7ecca-130">Vamos adicionar alguns testes ao nosso projeto NerdDinner.Tests que verificam a aula de Jantar que criamos quando construímos nossa camada de modelo.</span><span class="sxs-lookup"><span data-stu-id="7ecca-130">Let's add some tests to our NerdDinner.Tests project that verify the Dinner class we created when we built our model layer.</span></span>

<span data-ttu-id="7ecca-131">Começaremos criando uma nova pasta dentro do nosso projeto de teste chamado "Modelos", onde colocaremos nossos testes relacionados ao modelo.</span><span class="sxs-lookup"><span data-stu-id="7ecca-131">We'll start by creating a new folder within our test project called "Models" where we'll place our model-related tests.</span></span> <span data-ttu-id="7ecca-132">Em seguida, clique com o botão direito do mouse na pasta e escolha o comando **Adicionar-Novo&gt;menu de teste.**</span><span class="sxs-lookup"><span data-stu-id="7ecca-132">We'll then right-click on the folder and choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="7ecca-133">Isso trará a caixa de diálogo "Adicionar novo teste".</span><span class="sxs-lookup"><span data-stu-id="7ecca-133">This will bring up the "Add New Test" dialog.</span></span>

<span data-ttu-id="7ecca-134">Escolheremos criar um "Teste de Unidade" e nomeá-lo "DinnerTest.cs":</span><span class="sxs-lookup"><span data-stu-id="7ecca-134">We'll choose to create a "Unit Test" and name it "DinnerTest.cs":</span></span>

![](enable-automated-unit-testing/_static/image3.png)

<span data-ttu-id="7ecca-135">Quando clicarmos no botão "ok" o Visual Studio adicionará (e abrirá) um arquivo DinnerTest.cs ao projeto:</span><span class="sxs-lookup"><span data-stu-id="7ecca-135">When we click the "ok" button Visual Studio will add (and open) a DinnerTest.cs file to the project:</span></span>

![](enable-automated-unit-testing/_static/image4.png)

<span data-ttu-id="7ecca-136">O modelo de teste padrão da unidade Visual Studio tem um monte de código de placa de caldeira dentro dele que eu acho um pouco confuso.</span><span class="sxs-lookup"><span data-stu-id="7ecca-136">The default Visual Studio unit test template has a bunch of boiler-plate code within it that I find a little messy.</span></span> <span data-ttu-id="7ecca-137">Vamos limpá-lo para conter o código abaixo:</span><span class="sxs-lookup"><span data-stu-id="7ecca-137">Let's clean it up to just contain the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample1.cs)]

<span data-ttu-id="7ecca-138">O atributo [TestClass] na classe DinnerTest acima o identifica como uma classe que conterá testes, bem como inicialização de teste opcional e código de teardown.</span><span class="sxs-lookup"><span data-stu-id="7ecca-138">The [TestClass] attribute on the DinnerTest class above identifies it as a class that will contain tests, as well as optional test initialization and teardown code.</span></span> <span data-ttu-id="7ecca-139">Podemos definir testes dentro dele adicionando métodos públicos que têm um atributo [TestMethod] neles.</span><span class="sxs-lookup"><span data-stu-id="7ecca-139">We can define tests within it by adding public methods that have a [TestMethod] attribute on them.</span></span>

<span data-ttu-id="7ecca-140">Abaixo estão os primeiros de dois testes que vamos adicionar que o exercício nossa aula de jantar.</span><span class="sxs-lookup"><span data-stu-id="7ecca-140">Below are the first of two tests we'll add that exercise our Dinner class.</span></span> <span data-ttu-id="7ecca-141">O primeiro teste verifica se nosso Jantar é inválido se um novo Jantar for criado sem que todas as propriedades sejam definidas corretamente.</span><span class="sxs-lookup"><span data-stu-id="7ecca-141">The first test verifies that our Dinner is invalid if a new Dinner is created without all properties being set correctly.</span></span> <span data-ttu-id="7ecca-142">O segundo teste verifica se nosso Jantar é válido quando um Jantar tem todas as propriedades definidas com valores válidos:</span><span class="sxs-lookup"><span data-stu-id="7ecca-142">The second test verifies that our Dinner is valid when a Dinner has all properties set with valid values:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample2.cs)]

<span data-ttu-id="7ecca-143">Você notará acima que nossos nomes de teste são muito explícitos (e um pouco verbosos).</span><span class="sxs-lookup"><span data-stu-id="7ecca-143">You'll notice above that our test names are very explicit (and somewhat verbose).</span></span> <span data-ttu-id="7ecca-144">Estamos fazendo isso porque podemos acabar criando centenas ou milhares de pequenos testes, e queremos facilitar a determinação rápida da intenção e comportamento de cada um deles (especialmente quando estamos olhando através de uma lista de falhas em um corredor de teste).</span><span class="sxs-lookup"><span data-stu-id="7ecca-144">We are doing this because we might end up creating hundreds or thousands of small tests, and we want to make it easy to quickly determine the intent and behavior of each of them (especially when we are looking through a list of failures in a test runner).</span></span> <span data-ttu-id="7ecca-145">Os nomes dos testes devem ser nomeados após a funcionalidade que estão testando.</span><span class="sxs-lookup"><span data-stu-id="7ecca-145">The test names should be named after the functionality they are testing.</span></span> <span data-ttu-id="7ecca-146">Acima estamos usando um\_padrão\_de nomeação "Noun Should Verb".</span><span class="sxs-lookup"><span data-stu-id="7ecca-146">Above we are using a "Noun\_Should\_Verb" naming pattern.</span></span>

<span data-ttu-id="7ecca-147">Estamos estruturando os testes usando o padrão de teste "AAA" – que significa "Organizar, Agir, Afirmar":</span><span class="sxs-lookup"><span data-stu-id="7ecca-147">We are structuring the tests using the "AAA" testing pattern – which stands for "Arrange, Act, Assert":</span></span>

- <span data-ttu-id="7ecca-148">Organizar: Configurar a unidade que está sendo testada</span><span class="sxs-lookup"><span data-stu-id="7ecca-148">Arrange: Setup the unit being tested</span></span>
- <span data-ttu-id="7ecca-149">Ato: Exercite a unidade sob resultados de teste e captura</span><span class="sxs-lookup"><span data-stu-id="7ecca-149">Act: Exercise the unit under test and capture results</span></span>
- <span data-ttu-id="7ecca-150">Afirmar: Verificar o comportamento</span><span class="sxs-lookup"><span data-stu-id="7ecca-150">Assert: Verify the behavior</span></span>

<span data-ttu-id="7ecca-151">Quando fazemos testes, queremos evitar que os testes individuais façam demais.</span><span class="sxs-lookup"><span data-stu-id="7ecca-151">When we write tests we want to avoid having the individual tests do too much.</span></span> <span data-ttu-id="7ecca-152">Em vez disso, cada teste deve verificar apenas um único conceito (o que tornará muito mais fácil identificar a causa das falhas).</span><span class="sxs-lookup"><span data-stu-id="7ecca-152">Instead each test should verify only a single concept (which will make it much easier to pinpoint the cause of failures).</span></span> <span data-ttu-id="7ecca-153">Uma boa orientação é tentar e ter apenas uma única declaração de afirmação para cada teste.</span><span class="sxs-lookup"><span data-stu-id="7ecca-153">A good guideline is to try and only have a single assert statement for each test.</span></span> <span data-ttu-id="7ecca-154">Se você tiver mais de uma afirmação em um método de teste, certifique-se de que todos eles estão sendo usados para testar o mesmo conceito.</span><span class="sxs-lookup"><span data-stu-id="7ecca-154">If you have more than one assert statement in a test method, make sure they are all being used to test the same concept.</span></span> <span data-ttu-id="7ecca-155">Na dúvida, faça outro teste.</span><span class="sxs-lookup"><span data-stu-id="7ecca-155">When in doubt, make another test.</span></span>

### <a name="running-tests"></a><span data-ttu-id="7ecca-156">Executando testes</span><span class="sxs-lookup"><span data-stu-id="7ecca-156">Running Tests</span></span>

<span data-ttu-id="7ecca-157">Visual Studio 2008 Professional (e edições superiores) inclui um corredor de teste embutido que pode ser usado para executar projetos de teste de unidade visual studio dentro do IDE.</span><span class="sxs-lookup"><span data-stu-id="7ecca-157">Visual Studio 2008 Professional (and higher editions) includes a built-in test runner that can be used to run Visual Studio Unit Test projects within the IDE.</span></span> <span data-ttu-id="7ecca-158">Podemos selecionar o **comando&gt;Test-Run-&gt;All Tests in Solution** menu (ou tipo Ctrl R, A) para executar todos os testes da unidade.</span><span class="sxs-lookup"><span data-stu-id="7ecca-158">We can select the **Test-&gt;Run-&gt;All Tests in Solution** menu command (or type Ctrl R, A) to run all of our unit tests.</span></span> <span data-ttu-id="7ecca-159">Ou, alternativamente, podemos posicionar nosso cursor dentro de uma classe de teste específica ou método de teste e usar o comando **Test-Run-Tests&gt;&gt;in Current Context menu** (ou tipo Ctrl R, T) para executar um subconjunto dos testes da unidade.</span><span class="sxs-lookup"><span data-stu-id="7ecca-159">Or alternatively we can position our cursor within a specific test class or test method and use the **Test-&gt;Run-&gt;Tests in Current Context** menu command (or type Ctrl R, T) to run a subset of the unit tests.</span></span>

<span data-ttu-id="7ecca-160">Vamos posicionar nosso cursor dentro da classe DinnerTest e digitar "Ctrl R, T" para executar os dois testes que acabamos de definir.</span><span class="sxs-lookup"><span data-stu-id="7ecca-160">Let's position our cursor within the DinnerTest class and type "Ctrl R, T" to run the two tests we just defined.</span></span> <span data-ttu-id="7ecca-161">Quando fizermos isso, uma janela "Resultados de teste" aparecerá dentro do Visual Studio e veremos os resultados da nossa série de testes listadas nele:</span><span class="sxs-lookup"><span data-stu-id="7ecca-161">When we do this a "Test Results" window will appear within Visual Studio and we'll see the results of our test run listed within it:</span></span>

![](enable-automated-unit-testing/_static/image5.png)

<span data-ttu-id="7ecca-162">*Nota: A janela de resultados do teste VS não mostra a coluna Nome de Classe por padrão. Você pode adicionar isso clicando com o botão direito do mouse na janela Resultados de teste e usando o comando Adicionar/Remover colunas do menu.*</span><span class="sxs-lookup"><span data-stu-id="7ecca-162">*Note: The VS test results window does not show the Class Name column by default. You can add this by right-clicking within the Test Results window and using the Add/Remove Columns menu command.*</span></span>

<span data-ttu-id="7ecca-163">Nossos dois testes levaram apenas uma fração de segundo para serem executados – e como você pode ver, ambos passaram.</span><span class="sxs-lookup"><span data-stu-id="7ecca-163">Our two tests took only a fraction of a second to run – and as you can see they both passed.</span></span> <span data-ttu-id="7ecca-164">Agora podemos continuar e aumentá-los criando testes adicionais que verificam validações de regras específicas, bem como cobrir os dois métodos auxiliares - IsUserHost() e IsUserRegistered() – que adicionamos à classe Jantar.</span><span class="sxs-lookup"><span data-stu-id="7ecca-164">We can now go on and augment them by creating additional tests that verify specific rule validations, as well as cover the two helper methods - IsUserHost() and IsUserRegistered() – that we added to the Dinner class.</span></span> <span data-ttu-id="7ecca-165">Ter todos esses testes em vigor para a aula de Jantar tornará muito mais fácil e seguro adicionar novas regras de negócios e validações a ele no futuro.</span><span class="sxs-lookup"><span data-stu-id="7ecca-165">Having all these tests in place for the Dinner class will make it much easier and safer to add new business rules and validations to it in the future.</span></span> <span data-ttu-id="7ecca-166">Podemos adicionar nossa nova lógica de regras ao Jantar, e em segundos verificar que ele não quebrou nenhuma de nossas funcionalidades lógicas anteriores.</span><span class="sxs-lookup"><span data-stu-id="7ecca-166">We can add our new rule logic to Dinner, and then within seconds verify that it hasn't broken any of our previous logic functionality.</span></span>

<span data-ttu-id="7ecca-167">Observe como o uso de um nome de teste descritivo torna fácil entender rapidamente o que cada teste está verificando.</span><span class="sxs-lookup"><span data-stu-id="7ecca-167">Notice how using a descriptive test name makes it easy to quickly understand what each test is verifying.</span></span> <span data-ttu-id="7ecca-168">Recomendo usar o comando **De dicas de&gt;ferramentas,** abrir a tela de configuração de execução de testes e&gt;verificar o resultado da unidade "Clicando duas vezes ou inconclusivos, exibe o ponto de falha na caixa de seleção do teste".</span><span class="sxs-lookup"><span data-stu-id="7ecca-168">I recommend using the **Tools-&gt;Options** menu command, opening the Test Tools-&gt;Test Execution configuration screen, and checking the "Double-clicking a failed or inconclusive unit test result displays the point of failure in the test" checkbox.</span></span> <span data-ttu-id="7ecca-169">Isso permitirá que você clique duas vezes em uma falha na janela de resultados do teste e pule imediatamente para a falha de afirmação.</span><span class="sxs-lookup"><span data-stu-id="7ecca-169">This will allow you to double-click on a failure in the test results window and jump immediately to the assert failure.</span></span>

### <a name="creating-dinnerscontroller-unit-tests"></a><span data-ttu-id="7ecca-170">Criando jantaresTestes unitários do Controlador</span><span class="sxs-lookup"><span data-stu-id="7ecca-170">Creating DinnersController Unit Tests</span></span>

<span data-ttu-id="7ecca-171">Vamos agora criar alguns testes de unidade que verifiquem nossa funcionalidade DinnersController.</span><span class="sxs-lookup"><span data-stu-id="7ecca-171">Let's now create some unit tests that verify our DinnersController functionality.</span></span> <span data-ttu-id="7ecca-172">Começaremos clicando com o botão direito do mouse na pasta "Controladores" dentro do nosso projeto de teste e, em seguida, escolhero o comando **Adicionar-&gt;Novo menu de teste.**</span><span class="sxs-lookup"><span data-stu-id="7ecca-172">We'll start by right-clicking on the "Controllers" folder within our Test project and then choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="7ecca-173">Vamos criar um "Teste de Unidade" e nomeá-lo "DinnersControllerTest.cs".</span><span class="sxs-lookup"><span data-stu-id="7ecca-173">We'll create a "Unit Test" and name it "DinnersControllerTest.cs".</span></span>

<span data-ttu-id="7ecca-174">Criaremos dois métodos de teste que verificam o método de ação Details() no DinnersController.</span><span class="sxs-lookup"><span data-stu-id="7ecca-174">We'll create two test methods that verify the Details() action method on the DinnersController.</span></span> <span data-ttu-id="7ecca-175">O primeiro verificará se uma exibição é devolvida quando um jantar existente é solicitado.</span><span class="sxs-lookup"><span data-stu-id="7ecca-175">The first will verify that a View is returned when an existing Dinner is requested.</span></span> <span data-ttu-id="7ecca-176">A segunda verificará se uma exibição "NotFound" é retornada quando um Jantar inexistente é solicitado:</span><span class="sxs-lookup"><span data-stu-id="7ecca-176">The second will verify that a "NotFound" view is returned when a non-existent Dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample3.cs)]

<span data-ttu-id="7ecca-177">O código acima compila limpo.</span><span class="sxs-lookup"><span data-stu-id="7ecca-177">The above code compiles clean.</span></span> <span data-ttu-id="7ecca-178">Quando fazemos os testes, porém, ambos falham:</span><span class="sxs-lookup"><span data-stu-id="7ecca-178">When we run the tests, though, they both fail:</span></span>

![](enable-automated-unit-testing/_static/image6.png)

<span data-ttu-id="7ecca-179">Se olharmos para as mensagens de erro, veremos que a razão pela qual os testes falharam foi porque nossa turma do DinnersRepository não conseguiu se conectar a um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="7ecca-179">If we look at the error messages, we'll see that the reason the tests failed was because our DinnersRepository class was unable to connect to a database.</span></span> <span data-ttu-id="7ecca-180">Nosso aplicativo NerdDinner está usando uma seqüência de conexões para um\_arquivo local do SQL Server Express que vive sob o diretório \App Data do projeto do aplicativo NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="7ecca-180">Our NerdDinner application is using a connection-string to a local SQL Server Express file which lives under the \App\_Data directory of the NerdDinner application project.</span></span> <span data-ttu-id="7ecca-181">Como nosso projeto NerdDinner.Tests compila e executa em um diretório diferente, então o projeto do aplicativo, a localização relativa do caminho da nossa cadeia de conexão está incorreta.</span><span class="sxs-lookup"><span data-stu-id="7ecca-181">Because our NerdDinner.Tests project compiles and runs in a different directory then the application project, the relative path location of our connection-string is incorrect.</span></span>

<span data-ttu-id="7ecca-182">*Podemos* corrigir isso copiando o arquivo de banco de dados SQL Express para o nosso projeto de teste e, em seguida, adicionar uma seqüência de conexão de teste apropriada para ele no App.config do nosso projeto de teste.</span><span class="sxs-lookup"><span data-stu-id="7ecca-182">We *could* fix this by copying the SQL Express database file to our test project, and then add an appropriate test connection-string to it in the App.config of our test project.</span></span> <span data-ttu-id="7ecca-183">Isso faria com que os testes acima desbloqueassem e funcionassem.</span><span class="sxs-lookup"><span data-stu-id="7ecca-183">This would get the above tests unblocked and running.</span></span>

<span data-ttu-id="7ecca-184">O código de teste unitário usando um banco de dados real, no entanto, traz consigo uma série de desafios.</span><span class="sxs-lookup"><span data-stu-id="7ecca-184">Unit testing code using a real database, though, brings with it a number of challenges.</span></span> <span data-ttu-id="7ecca-185">Especificamente:</span><span class="sxs-lookup"><span data-stu-id="7ecca-185">Specifically:</span></span>

- <span data-ttu-id="7ecca-186">Diminui significativamente o tempo de execução dos testes unitários.</span><span class="sxs-lookup"><span data-stu-id="7ecca-186">It significantly slows down the execution time of unit tests.</span></span> <span data-ttu-id="7ecca-187">Quanto mais tempo demorar para executar testes, menor a probabilidade de executá-los com freqüência.</span><span class="sxs-lookup"><span data-stu-id="7ecca-187">The longer it takes to run tests, the less likely you are to execute them frequently.</span></span> <span data-ttu-id="7ecca-188">Idealmente, você quer que os testes da sua unidade sejam executados em segundos – e que seja algo que você faça tão naturalmente quanto compilar o projeto.</span><span class="sxs-lookup"><span data-stu-id="7ecca-188">Ideally you want your unit tests to be able to be run in seconds – and have it be something you do as naturally as compiling the project.</span></span>
- <span data-ttu-id="7ecca-189">Complica a lógica de configuração e limpeza dentro dos testes.</span><span class="sxs-lookup"><span data-stu-id="7ecca-189">It complicates the setup and cleanup logic within tests.</span></span> <span data-ttu-id="7ecca-190">Você quer que cada teste de unidade seja isolado e independente dos outros (sem efeitos colaterais ou dependências).</span><span class="sxs-lookup"><span data-stu-id="7ecca-190">You want each unit test to be isolated and independent of others (with no side effects or dependencies).</span></span> <span data-ttu-id="7ecca-191">Ao trabalhar contra um banco de dados real, você tem que estar atento ao estado e redefini-lo entre os testes.</span><span class="sxs-lookup"><span data-stu-id="7ecca-191">When working against a real database you have to be mindful of state and reset it between tests.</span></span>

<span data-ttu-id="7ecca-192">Vamos olhar para um padrão de design chamado "injeção de dependência" que pode nos ajudar a contornar esses problemas e evitar a necessidade de usar um banco de dados real com nossos testes.</span><span class="sxs-lookup"><span data-stu-id="7ecca-192">Let's look at a design pattern called "dependency injection" that can help us work around these issues and avoid the need to use a real database with our tests.</span></span>

### <a name="dependency-injection"></a><span data-ttu-id="7ecca-193">Injeção de dependência</span><span class="sxs-lookup"><span data-stu-id="7ecca-193">Dependency Injection</span></span>

<span data-ttu-id="7ecca-194">Neste momento, dinnersController está firmemente "acoplado" à classe DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="7ecca-194">Right now DinnersController is tightly "coupled" to the DinnerRepository class.</span></span> <span data-ttu-id="7ecca-195">"Acoplamento" refere-se a uma situação em que uma classe depende explicitamente de outra classe para funcionar:</span><span class="sxs-lookup"><span data-stu-id="7ecca-195">"Coupling" refers to a situation where a class explicitly relies on another class in order to work:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample4.cs)]

<span data-ttu-id="7ecca-196">Como a classe DinnerRepository requer acesso a um banco de dados, a dependência acoplada que a classe DinnersController tem no DinnerRepository acaba exigindo que tenhamos um banco de dados para que os métodos de ação DinnersController sejam testados.</span><span class="sxs-lookup"><span data-stu-id="7ecca-196">Because the DinnerRepository class requires access to a database, the tightly coupled dependency the DinnersController class has on the DinnerRepository ends up requiring us to have a database in order for the DinnersController action methods to be tested.</span></span>

<span data-ttu-id="7ecca-197">Podemos contornar isso empregando um padrão de design chamado "injeção de dependência" – que é uma abordagem onde as dependências (como classes de repositório que fornecem acesso aos dados) não são mais criadas implicitamente dentro de classes que as usam.</span><span class="sxs-lookup"><span data-stu-id="7ecca-197">We can get around this by employing a design pattern called "dependency injection" – which is an approach where dependencies (like repository classes that provide data access) are no longer implicitly created within classes that use them.</span></span> <span data-ttu-id="7ecca-198">Em vez disso, as dependências podem ser explicitamente passadas para a classe que as usa usando argumentos de construtores.</span><span class="sxs-lookup"><span data-stu-id="7ecca-198">Instead, dependencies can be explicitly passed to the class that uses them using constructor arguments.</span></span> <span data-ttu-id="7ecca-199">Se as dependências forem definidas usando interfaces, então temos a flexibilidade de passar em implementações de dependência "falsas" para cenários de teste de unidade.</span><span class="sxs-lookup"><span data-stu-id="7ecca-199">If the dependencies are defined using interfaces, we then have the flexibility to pass in "fake" dependency implementations for unit test scenarios.</span></span> <span data-ttu-id="7ecca-200">Isso nos permite criar implementações de dependência específicas de teste que não requerem acesso a um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="7ecca-200">This enables us to create test-specific dependency implementations that do not actually require access to a database.</span></span>

<span data-ttu-id="7ecca-201">Para ver isso em ação, vamos implementar injeção de dependência com o nosso DinnersController.</span><span class="sxs-lookup"><span data-stu-id="7ecca-201">To see this in action, let's implement dependency injection with our DinnersController.</span></span>

#### <a name="extracting-an-idinnerrepository-interface"></a><span data-ttu-id="7ecca-202">Extraindo uma interface IDinnerRepository</span><span class="sxs-lookup"><span data-stu-id="7ecca-202">Extracting an IDinnerRepository interface</span></span>

<span data-ttu-id="7ecca-203">Nosso primeiro passo será criar uma nova interface IDinnerRepository que encapsula o contrato de repositório que nossos controladores exigem para recuperar e atualizar Jantares.</span><span class="sxs-lookup"><span data-stu-id="7ecca-203">Our first step will be to create a new IDinnerRepository interface that encapsulates the repository contract our controllers require to retrieve and update Dinners.</span></span>

<span data-ttu-id="7ecca-204">Podemos definir este contrato de interface manualmente clicando com o botão direito do mouse na pasta \Modelos e, em seguida, escolhendo o comando **Menu&gt;Adicionar-Novo Item** e criando uma nova interface chamada IDinnerRepository.cs.</span><span class="sxs-lookup"><span data-stu-id="7ecca-204">We can define this interface contract manually by right-clicking on the \Models folder, and then choosing the **Add-&gt;New Item** menu command and creating a new interface named IDinnerRepository.cs.</span></span>

<span data-ttu-id="7ecca-205">Alternativamente, podemos usar as ferramentas de refatoração incorporadas ao Visual Studio Professional (e edições superiores) para extrair e criar automaticamente uma interface para nós a partir de nossa classe DinnerRepository existente.</span><span class="sxs-lookup"><span data-stu-id="7ecca-205">Alternatively we can use the refactoring tools built-into Visual Studio Professional (and higher editions) to automatically extract and create an interface for us from our existing DinnerRepository class.</span></span> <span data-ttu-id="7ecca-206">Para extrair essa interface usando VS, basta posicionar o cursor no editor de texto na classe DinnerRepository e, em seguida, clicar com o botão direito do mouse e escolher o comando **Menu&gt;Refator-Extract Interface:**</span><span class="sxs-lookup"><span data-stu-id="7ecca-206">To extract this interface using VS, simply position the cursor in the text editor on the DinnerRepository class, and then right-click and choose the **Refactor-&gt;Extract Interface** menu command:</span></span>

![](enable-automated-unit-testing/_static/image7.png)

<span data-ttu-id="7ecca-207">Isso iniciará a caixa de diálogo "Extrair interface" e nos solicitará o nome da interface a ser criada.</span><span class="sxs-lookup"><span data-stu-id="7ecca-207">This will launch the "Extract Interface" dialog and prompt us for the name of the interface to create.</span></span> <span data-ttu-id="7ecca-208">Ele será padrão para iDinnerRepository e selecionará automaticamente todos os métodos públicos na classe DinnerRepository existente para adicionar à interface:</span><span class="sxs-lookup"><span data-stu-id="7ecca-208">It will default to IDinnerRepository and automatically select all public methods on the existing DinnerRepository class to add to the interface:</span></span>

![](enable-automated-unit-testing/_static/image8.png)

<span data-ttu-id="7ecca-209">Quando clicarmos no botão "ok", o Visual Studio adicionará uma nova interface IDinnerRepository ao nosso aplicativo:</span><span class="sxs-lookup"><span data-stu-id="7ecca-209">When we click the "ok" button, Visual Studio will add a new IDinnerRepository interface to our application:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample5.cs)]

<span data-ttu-id="7ecca-210">E nossa classe dinnerrepository existente será atualizada para que implemente a interface:</span><span class="sxs-lookup"><span data-stu-id="7ecca-210">And our existing DinnerRepository class will be updated so that it implements the interface:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample6.cs)]

#### <a name="updating-dinnerscontroller-to-support-constructor-injection"></a><span data-ttu-id="7ecca-211">Atualizando jantaresController para apoiar a injeção de construtores</span><span class="sxs-lookup"><span data-stu-id="7ecca-211">Updating DinnersController to support constructor injection</span></span>

<span data-ttu-id="7ecca-212">Agora atualizaremos a classe DinnersController para usar a nova interface.</span><span class="sxs-lookup"><span data-stu-id="7ecca-212">We'll now update the DinnersController class to use the new interface.</span></span>

<span data-ttu-id="7ecca-213">Atualmente, o DinnersController é codificado de tal forma que seu campo "dinnerRepository" é sempre uma classe DinnerRepository:</span><span class="sxs-lookup"><span data-stu-id="7ecca-213">Currently DinnersController is hard-coded such that its "dinnerRepository" field is always a DinnerRepository class:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample7.cs)]

<span data-ttu-id="7ecca-214">Vamos mudá-lo para que o campo "dinnerRepository" seja do tipo IDinnerRepository em vez de DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="7ecca-214">We'll change it so that the "dinnerRepository" field is of type IDinnerRepository instead of DinnerRepository.</span></span> <span data-ttu-id="7ecca-215">Em seguida, adicionaremos dois jantares públicosConstrutores Controlador.</span><span class="sxs-lookup"><span data-stu-id="7ecca-215">We'll then add two public DinnersController constructors.</span></span> <span data-ttu-id="7ecca-216">Um dos construtores permite que um IDinnerRepository seja aprovado como argumento.</span><span class="sxs-lookup"><span data-stu-id="7ecca-216">One of the constructors allows an IDinnerRepository to be passed as an argument.</span></span> <span data-ttu-id="7ecca-217">O outro é um construtor padrão que usa nossa implementação de DinnerRepository existente:</span><span class="sxs-lookup"><span data-stu-id="7ecca-217">The other is a default constructor that uses our existing DinnerRepository implementation:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample8.cs)]

<span data-ttu-id="7ecca-218">Como ASP.NET MVC por padrão cria classes de controladores usando construtores padrão, nosso DinnersController em tempo de execução continuará a usar a classe DinnerRepository para executar o acesso aos dados.</span><span class="sxs-lookup"><span data-stu-id="7ecca-218">Because ASP.NET MVC by default creates controller classes using default constructors, our DinnersController at runtime will continue to use the DinnerRepository class to perform data access.</span></span>

<span data-ttu-id="7ecca-219">Agora podemos atualizar nossos testes de unidade, no entanto, para passar em uma implementação "falsa" do repositório de jantar usando o construtor de parâmetros.</span><span class="sxs-lookup"><span data-stu-id="7ecca-219">We can now update our unit tests, though, to pass in a "fake" dinner repository implementation using the parameter constructor.</span></span> <span data-ttu-id="7ecca-220">Este repositório de jantar "falso" não exigirá acesso a um banco de dados real e, em vez disso, usará dados de amostra na memória.</span><span class="sxs-lookup"><span data-stu-id="7ecca-220">This "fake" dinner repository will not require access to a real database, and instead will use in-memory sample data.</span></span>

#### <a name="creating-the-fakedinnerrepository-class"></a><span data-ttu-id="7ecca-221">Criando a classe FakeDinnerRepository</span><span class="sxs-lookup"><span data-stu-id="7ecca-221">Creating the FakeDinnerRepository class</span></span>

<span data-ttu-id="7ecca-222">Vamos criar uma aula de FakeDinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="7ecca-222">Let's create a FakeDinnerRepository class.</span></span>

<span data-ttu-id="7ecca-223">Começaremos criando um diretório "Fakes" dentro do nosso projeto NerdDinner.Tests e, em seguida, adicionaremos uma nova classe FakeDinnerRepository a ele (clique com o botão direito do mouse na pasta e escolha **Adicionar-&gt;Nova Classe**):</span><span class="sxs-lookup"><span data-stu-id="7ecca-223">We'll begin by creating a "Fakes" directory within our NerdDinner.Tests project and then add a new FakeDinnerRepository class to it (right-click on the folder and choose **Add-&gt;New Class**):</span></span>

![](enable-automated-unit-testing/_static/image9.png)

<span data-ttu-id="7ecca-224">Atualizaremos o código para que a classe FakeDinnerRepository implemente a interface IDinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="7ecca-224">We'll update the code so that the FakeDinnerRepository class implements the IDinnerRepository interface.</span></span> <span data-ttu-id="7ecca-225">Em seguida, podemos clicar com o botão direito do mouse nele e escolher o menu de menu de contexto "Implementar interface IDinnerRepository":</span><span class="sxs-lookup"><span data-stu-id="7ecca-225">We can then right-click on it and choose the "Implement interface IDinnerRepository" context menu command:</span></span>

![](enable-automated-unit-testing/_static/image10.png)

<span data-ttu-id="7ecca-226">Isso fará com que o Visual Studio adicione automaticamente todos os membros da interface IDinnerRepository à nossa classe FakeDinnerRepository com implementações padrão de "stub out":</span><span class="sxs-lookup"><span data-stu-id="7ecca-226">This will cause Visual Studio to automatically add all of the IDinnerRepository interface members to our FakeDinnerRepository class with default "stub out" implementations:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample9.cs)]

<span data-ttu-id="7ecca-227">Podemos então atualizar a implementação do FakeDinnerRepository para&lt;&gt; trabalhar fora de uma coleção de jantar de lista na memória passada a ele como um argumento construtor:</span><span class="sxs-lookup"><span data-stu-id="7ecca-227">We can then update the FakeDinnerRepository implementation to work off of an in-memory List&lt;Dinner&gt; collection passed to it as a constructor argument:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample10.cs)]

<span data-ttu-id="7ecca-228">Agora temos uma implementação falsa do IDinnerRepository que não requer um banco de dados e pode, em vez disso, trabalhar fora de uma lista na memória de objetos do Jantar.</span><span class="sxs-lookup"><span data-stu-id="7ecca-228">We now have a fake IDinnerRepository implementation that does not require a database, and can instead work off an in-memory list of Dinner objects.</span></span>

#### <a name="using-the-fakedinnerrepository-with-unit-tests"></a><span data-ttu-id="7ecca-229">Usando o FalsoDinnerRepository com testes unitários</span><span class="sxs-lookup"><span data-stu-id="7ecca-229">Using the FakeDinnerRepository with Unit Tests</span></span>

<span data-ttu-id="7ecca-230">Vamos voltar aos testes da unidade DinnersController que falharam antes porque o banco de dados não estava disponível.</span><span class="sxs-lookup"><span data-stu-id="7ecca-230">Let's return to the DinnersController unit tests that failed earlier because the database wasn't available.</span></span> <span data-ttu-id="7ecca-231">Podemos atualizar os métodos de teste para usar um FakeDinnerRepository preenchido com dados de jantar de amostra na memória para o DinnersController usando o código abaixo:</span><span class="sxs-lookup"><span data-stu-id="7ecca-231">We can update the test methods to use a FakeDinnerRepository populated with sample in-memory Dinner data to the DinnersController using the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample11.cs)]

<span data-ttu-id="7ecca-232">E agora, quando fazemos esses testes, ambos passam:</span><span class="sxs-lookup"><span data-stu-id="7ecca-232">And now when we run these tests they both pass:</span></span>

![](enable-automated-unit-testing/_static/image11.png)

<span data-ttu-id="7ecca-233">O melhor de tudo é que eles levam apenas uma fração de segundo para serem executados, e não requerem nenhuma lógica complicada de configuração/limpeza.</span><span class="sxs-lookup"><span data-stu-id="7ecca-233">Best of all, they take only a fraction of a second to run, and do not require any complicated setup/cleanup logic.</span></span> <span data-ttu-id="7ecca-234">Agora podemos testar todos os nossocódigo do método de ação DinnersController (incluindo listagem, paginação, detalhes, criar, atualizar e excluir) sem nunca precisar se conectar a um banco de dados real.</span><span class="sxs-lookup"><span data-stu-id="7ecca-234">We can now unit test all of our DinnersController action method code (including listing, paging, details, create, update and delete) without ever needing to connect to a real database.</span></span>

| <span data-ttu-id="7ecca-235">**Tópico lateral: Frameworks de injeção de dependência**</span><span class="sxs-lookup"><span data-stu-id="7ecca-235">**Side Topic: Dependency Injection Frameworks**</span></span> |
| --- |
| <span data-ttu-id="7ecca-236">Realizar injeção manual de dependência (como estamos acima) funciona bem, mas torna-se mais difícil de manter à medida que o número de dependências e componentes em uma aplicação aumenta.</span><span class="sxs-lookup"><span data-stu-id="7ecca-236">Performing manual dependency injection (like we are above) works fine, but does become harder to maintain as the number of dependencies and components in an application increases.</span></span> <span data-ttu-id="7ecca-237">Existem várias estruturas de injeção de dependência para .NET que podem ajudar a fornecer ainda mais flexibilidade de gerenciamento de dependência.</span><span class="sxs-lookup"><span data-stu-id="7ecca-237">Several dependency injection frameworks exist for .NET that can help provide even more dependency management flexibility.</span></span> <span data-ttu-id="7ecca-238">Esses frameworks, também às vezes chamados de contêineres de "Inversão de Controle" (IoC), fornecem mecanismos que permitem um nível adicional de suporte à configuração para especificar e passar dependências para objetos em tempo de execução (na maioria das vezes usando injeção de construtor).</span><span class="sxs-lookup"><span data-stu-id="7ecca-238">These frameworks, also sometimes called "Inversion of Control" (IoC) containers, provide mechanisms that enable an additional level of configuration support for specifying and passing dependencies to objects at runtime (most often using constructor injection).</span></span> <span data-ttu-id="7ecca-239">Algumas das estruturas mais populares de injeção de dependência do OSS / COI em .NET incluem: AutoFac, Ninject, Spring.NET, StructureMap e Windsor.</span><span class="sxs-lookup"><span data-stu-id="7ecca-239">Some of the more popular OSS Dependency Injection / IOC frameworks in .NET include: AutoFac, Ninject, Spring.NET, StructureMap, and Windsor.</span></span> <span data-ttu-id="7ecca-240">ASP.NET MVC expõe APIs de extensibilidade que permitem aos desenvolvedores participar na resolução e na instanciação dos controladores, e que permite que as estruturas de Injeção de Dependência/IoC sejam integradas de forma limpa dentro desse processo.</span><span class="sxs-lookup"><span data-stu-id="7ecca-240">ASP.NET MVC exposes extensibility APIs that enable developers to participate in the resolution and instantiation of controllers, and which enables Dependency Injection / IoC frameworks to be cleanly integrated within this process.</span></span> <span data-ttu-id="7ecca-241">O uso de uma estrutura DI/COI também nos permitiria remover o construtor padrão do nosso DinnersController – o que removeria completamente o acoplamento entre ele e o DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="7ecca-241">Using a DI/IOC framework would also enable us to remove the default constructor from our DinnersController – which would completely remove the coupling between it and the DinnerRepository.</span></span> <span data-ttu-id="7ecca-242">Não usaremos uma estrutura de injeção de dependência / COI com nosso aplicativo NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="7ecca-242">We won't be using a dependency injection / IOC framework with our NerdDinner application.</span></span> <span data-ttu-id="7ecca-243">Mas é algo que poderíamos considerar para o futuro se a base de códigos nerddinner e capacidades crescessem.</span><span class="sxs-lookup"><span data-stu-id="7ecca-243">But it is something we could consider for the future if the NerdDinner code-base and capabilities grew.</span></span> |

### <a name="creating-edit-action-unit-tests"></a><span data-ttu-id="7ecca-244">Criando testes da unidade de ação de edição</span><span class="sxs-lookup"><span data-stu-id="7ecca-244">Creating Edit Action Unit Tests</span></span>

<span data-ttu-id="7ecca-245">Vamos agora criar alguns testes de unidade que verifiquem a funcionalidade Editar do DinnersController.</span><span class="sxs-lookup"><span data-stu-id="7ecca-245">Let's now create some unit tests that verify the Edit functionality of the DinnersController.</span></span> <span data-ttu-id="7ecca-246">Começaremos testando a versão HTTP-GET da nossa ação Editar:</span><span class="sxs-lookup"><span data-stu-id="7ecca-246">We'll start by testing the HTTP-GET version of our Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample12.cs)]

<span data-ttu-id="7ecca-247">Criaremos um teste que verifica se uma exibição apoiada por um objeto DinnerFormViewModel é renderizada de volta quando um jantar válido é solicitado:</span><span class="sxs-lookup"><span data-stu-id="7ecca-247">We'll create a test that verifies that a View backed by a DinnerFormViewModel object is rendered back when a valid dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample13.cs)]

<span data-ttu-id="7ecca-248">Quando executamos o teste, porém, descobriremos que ele falha porque uma exceção de referência nula é lançada quando o método Editar acessa a propriedade User.Identity.Name para executar a verificação Dinner.IsHostedBy().</span><span class="sxs-lookup"><span data-stu-id="7ecca-248">When we run the test, though, we'll find that it fails because a null reference exception is thrown when the Edit method accesses the User.Identity.Name property to perform the Dinner.IsHostedBy() check.</span></span>

<span data-ttu-id="7ecca-249">O objeto Usuário na classe base do Controlador encapsula detalhes sobre o usuário conectado e é preenchido por ASP.NET MVC quando cria o controlador em tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="7ecca-249">The User object on the Controller base class encapsulates details about the logged-in user, and is populated by ASP.NET MVC when it creates the controller at runtime.</span></span> <span data-ttu-id="7ecca-250">Como estamos testando o DinnersController fora de um ambiente de servidor web, o objeto Usuário não está definido (daí a exceção de referência nula).</span><span class="sxs-lookup"><span data-stu-id="7ecca-250">Because we are testing the DinnersController outside of a web-server environment, the User object isn't set (hence the null reference exception).</span></span>

### <a name="mocking-the-useridentityname-property"></a><span data-ttu-id="7ecca-251">Zombando da propriedade User.Identity.Name</span><span class="sxs-lookup"><span data-stu-id="7ecca-251">Mocking the User.Identity.Name property</span></span>

<span data-ttu-id="7ecca-252">As estruturas de zombaria facilitam os testes, permitindo-nos criar dinamicamente versões falsas de objetos dependentes que suportam nossos testes.</span><span class="sxs-lookup"><span data-stu-id="7ecca-252">Mocking frameworks make testing easier by enabling us to dynamically create fake versions of dependent objects that support our tests.</span></span> <span data-ttu-id="7ecca-253">Por exemplo, podemos usar uma estrutura de zombaria em nosso teste de ação Editar para criar dinamicamente um objeto de usuário que nosso DinnersController pode usar para procurar um nome de usuário simulado.</span><span class="sxs-lookup"><span data-stu-id="7ecca-253">For example, we can use a mocking framework in our Edit action test to dynamically create a User object that our DinnersController can use to lookup a simulated username.</span></span> <span data-ttu-id="7ecca-254">Isso evitará que uma referência nula seja lançada quando executarmos nosso teste.</span><span class="sxs-lookup"><span data-stu-id="7ecca-254">This will avoid a null reference from being thrown when we run our test.</span></span>

<span data-ttu-id="7ecca-255">Existem muitos frameworks .NET zombando que podem ser usados com [http://www.mockframeworks.com/](http://www.mockframeworks.com/)ASP.NET MVC (você pode ver uma lista deles aqui: ).</span><span class="sxs-lookup"><span data-stu-id="7ecca-255">There are many .NET mocking frameworks that can be used with ASP.NET MVC (you can see a list of them here: [http://www.mockframeworks.com/](http://www.mockframeworks.com/)).</span></span> <span data-ttu-id="7ecca-256">Para testar nosso aplicativo NerdDinner, usaremos uma estrutura de zombaria de código [http://www.mockframeworks.com/moq](http://www.mockframeworks.com/moq)aberto chamada "Moq", que pode ser baixada gratuitamente a partir de .</span><span class="sxs-lookup"><span data-stu-id="7ecca-256">For testing our NerdDinner application we'll use an open source mocking framework called "Moq", which can be downloaded for free from [http://www.mockframeworks.com/moq](http://www.mockframeworks.com/moq).</span></span>

<span data-ttu-id="7ecca-257">Uma vez baixado, adicionaremos uma referência em nosso projeto NerdDinner.Tests ao conjunto Moq.dll:</span><span class="sxs-lookup"><span data-stu-id="7ecca-257">Once downloaded, we'll add a reference in our NerdDinner.Tests project to the Moq.dll assembly:</span></span>

![](enable-automated-unit-testing/_static/image12.png)

<span data-ttu-id="7ecca-258">Em seguida, adicionaremos um método de ajuda "CreateDinnersControllerAs(nome de usuário)" à nossa classe de teste que toma um nome de usuário como parâmetro e que, em seguida, "zomba" da propriedade User.Identity.Name na instância DinnersController:</span><span class="sxs-lookup"><span data-stu-id="7ecca-258">We'll then add a "CreateDinnersControllerAs(username)" helper method to our test class that takes a username as a parameter, and which then "mocks" the User.Identity.Name property on the DinnersController instance:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample14.cs)]

<span data-ttu-id="7ecca-259">Acima estamos usando o Moq para criar um objeto Mock que falsifica um objeto ControllerContext (que é o que ASP.NET MVC passa para as classes Controller para expor objetos de tempo de execução como Usuário, Solicitação, Resposta e Sessão).</span><span class="sxs-lookup"><span data-stu-id="7ecca-259">Above we are using Moq to create a Mock object that fakes a ControllerContext object (which is what ASP.NET MVC passes to Controller classes to expose runtime objects like User, Request, Response, and Session).</span></span> <span data-ttu-id="7ecca-260">Estamos chamando o método "SetupGet" no Mock para indicar que a propriedade HttpContext.User.Identity.Name no ControllerContext deve retornar a string de nome de usuário que passamos para o método helper.</span><span class="sxs-lookup"><span data-stu-id="7ecca-260">We are calling the "SetupGet" method on the Mock to indicate that the HttpContext.User.Identity.Name property on ControllerContext should return the username string we passed to the helper method.</span></span>

<span data-ttu-id="7ecca-261">Podemos zombar de qualquer número de propriedades e métodos do ControllerContext.</span><span class="sxs-lookup"><span data-stu-id="7ecca-261">We can mock any number of ControllerContext properties and methods.</span></span> <span data-ttu-id="7ecca-262">Para ilustrar isso, também adicionei uma chamada SetupGet() para a propriedade Request.IsAuthenticated (que não é realmente necessária para os testes abaixo – mas que ajuda a ilustrar como você pode simular propriedades de Solicitação).</span><span class="sxs-lookup"><span data-stu-id="7ecca-262">To illustrate this I've also added a SetupGet() call for the Request.IsAuthenticated property (which isn't actually needed for the tests below – but which helps illustrate how you can mock Request properties).</span></span> <span data-ttu-id="7ecca-263">Quando terminamos, atribuímos uma instância do mock ControllerContext ao DinnersController, nosso método auxiliar retorna.</span><span class="sxs-lookup"><span data-stu-id="7ecca-263">When we are done we assign an instance of the ControllerContext mock to the DinnersController our helper method returns.</span></span>

<span data-ttu-id="7ecca-264">Agora podemos escrever testes unitários que usam este método auxiliar para testar cenários de edição envolvendo diferentes usuários:</span><span class="sxs-lookup"><span data-stu-id="7ecca-264">We can now write unit tests that use this helper method to test Edit scenarios involving different users:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample15.cs)]

<span data-ttu-id="7ecca-265">E agora, quando fazemos os testes, eles passam:</span><span class="sxs-lookup"><span data-stu-id="7ecca-265">And now when we run the tests they pass:</span></span>

![](enable-automated-unit-testing/_static/image13.png)

### <a name="testing-updatemodel-scenarios"></a><span data-ttu-id="7ecca-266">Testando os cenários do UpdateModel()</span><span class="sxs-lookup"><span data-stu-id="7ecca-266">Testing UpdateModel() scenarios</span></span>

<span data-ttu-id="7ecca-267">Criamos testes que cobrem a versão HTTP-GET da ação Editar.</span><span class="sxs-lookup"><span data-stu-id="7ecca-267">We've created tests that cover the HTTP-GET version of the Edit action.</span></span> <span data-ttu-id="7ecca-268">Vamos agora criar alguns testes que verificam a versão HTTP-POST da ação Editar:</span><span class="sxs-lookup"><span data-stu-id="7ecca-268">Let's now create some tests that verify the HTTP-POST version of the Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample16.cs)]

<span data-ttu-id="7ecca-269">O novo cenário de teste interessante para suportarmos com este método de ação é o uso do método de ajuda UpdateModel() na classe base controller.</span><span class="sxs-lookup"><span data-stu-id="7ecca-269">The interesting new testing scenario for us to support with this action method is its usage of the UpdateModel() helper method on the Controller base class.</span></span> <span data-ttu-id="7ecca-270">Estamos usando este método auxiliar para vincular valores de postagem de formulário à nossa instância de objeto jantar.</span><span class="sxs-lookup"><span data-stu-id="7ecca-270">We are using this helper method to bind form-post values to our Dinner object instance.</span></span>

<span data-ttu-id="7ecca-271">Abaixo estão dois testes que demonstram como podemos fornecer valores postados para o método de ajuda UpdateModel() para usar.</span><span class="sxs-lookup"><span data-stu-id="7ecca-271">Below are two tests that demonstrates how we can supply form posted values for the UpdateModel() helper method to use.</span></span> <span data-ttu-id="7ecca-272">Faremos isso criando e povoando um objeto FormCollection e, em seguida, atribuiremos-o à propriedade "ValueProvider" no Controller.</span><span class="sxs-lookup"><span data-stu-id="7ecca-272">We'll do this by creating and populating a FormCollection object, and then assign it to the "ValueProvider" property on the Controller.</span></span>

<span data-ttu-id="7ecca-273">O primeiro teste verifica se em um salvamento bem-sucedido o navegador é redirecionado para a ação de detalhes.</span><span class="sxs-lookup"><span data-stu-id="7ecca-273">The first test verifies that on a successful save the browser is redirected to the details action.</span></span> <span data-ttu-id="7ecca-274">O segundo teste verifica que, quando a entrada inválida é postada, a ação reexibe a exibição de edição novamente com uma mensagem de erro.</span><span class="sxs-lookup"><span data-stu-id="7ecca-274">The second test verifies that when invalid input is posted the action redisplays the edit view again with an error message.</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample17.cs)]

### <a name="testing-wrap-up"></a><span data-ttu-id="7ecca-275">Ensaio de envoltório</span><span class="sxs-lookup"><span data-stu-id="7ecca-275">Testing Wrap-Up</span></span>

<span data-ttu-id="7ecca-276">Nós cobrimos os conceitos principais envolvidos nas aulas de controlador de teste da unidade.</span><span class="sxs-lookup"><span data-stu-id="7ecca-276">We've covered the core concepts involved in unit testing controller classes.</span></span> <span data-ttu-id="7ecca-277">Podemos usar essas técnicas para criar facilmente centenas de testes simples que verificam o comportamento de nossa aplicação.</span><span class="sxs-lookup"><span data-stu-id="7ecca-277">We can use these techniques to easily create hundreds of simple tests that verify the behavior of our application.</span></span>

<span data-ttu-id="7ecca-278">Como nossos testes de controlador e modelo não exigem um banco de dados real, eles são extremamente rápidos e fáceis de executar.</span><span class="sxs-lookup"><span data-stu-id="7ecca-278">Because our controller and model tests do not require a real database, they are extremely fast and easy to run.</span></span> <span data-ttu-id="7ecca-279">Seremos capazes de executar centenas de testes automatizados em segundos, e imediatamente obter feedback sobre se uma mudança que fizemos quebrou algo.</span><span class="sxs-lookup"><span data-stu-id="7ecca-279">We'll be able to execute hundreds of automated tests in seconds, and immediately get feedback as to whether a change we made broke something.</span></span> <span data-ttu-id="7ecca-280">Isso nos ajudará a fornecer a confiança para melhorar continuamente, refatorar e refinar nossa aplicação.</span><span class="sxs-lookup"><span data-stu-id="7ecca-280">This will help provide us the confidence to continually improve, refactor, and refine our application.</span></span>

<span data-ttu-id="7ecca-281">Cobrimos o teste como último tópico deste capítulo – mas não porque o teste é algo que você deve fazer no final de um processo de desenvolvimento!</span><span class="sxs-lookup"><span data-stu-id="7ecca-281">We covered testing as the last topic in this chapter – but not because testing is something you should do at the end of a development process!</span></span> <span data-ttu-id="7ecca-282">Pelo contrário, você deve escrever testes automatizados o mais cedo possível em seu processo de desenvolvimento.</span><span class="sxs-lookup"><span data-stu-id="7ecca-282">On the contrary, you should write automated tests as early as possible in your development process.</span></span> <span data-ttu-id="7ecca-283">Isso permite que você obtenha feedback imediato à medida que você se desenvolve, ajuda você a pensar cuidadosamente sobre os cenários de caso de uso do seu aplicativo e orienta você a projetar seu aplicativo com camadas limpas e acoplamento em mente.</span><span class="sxs-lookup"><span data-stu-id="7ecca-283">Doing so enables you to get immediate feedback as you develop, helps you think thoughtfully about your application's use case scenarios, and guides you to design your application with clean layering and coupling in mind.</span></span>

<span data-ttu-id="7ecca-284">Um capítulo posterior do livro discutirá o TDD (Test Driven Development, desenvolvimento conduzido por teste) e como usá-lo com ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="7ecca-284">A later chapter in the book will discuss Test Driven Development (TDD), and how to use it with ASP.NET MVC.</span></span> <span data-ttu-id="7ecca-285">TDD é uma prática de codificação iterativa onde você escreve primeiro os testes que seu código resultante irá satisfazer.</span><span class="sxs-lookup"><span data-stu-id="7ecca-285">TDD is an iterative coding practice where you first write the tests that your resulting code will satisfy.</span></span> <span data-ttu-id="7ecca-286">Com o TDD você inicia cada recurso criando um teste que verifica a funcionalidade que você está prestes a implementar.</span><span class="sxs-lookup"><span data-stu-id="7ecca-286">With TDD you begin each feature by creating a test that verifies the functionality you are about to implement.</span></span> <span data-ttu-id="7ecca-287">Escrever o teste de unidade primeiro ajuda a garantir que você entenda claramente o recurso e como ele deve funcionar.</span><span class="sxs-lookup"><span data-stu-id="7ecca-287">Writing the unit test first helps ensure that you clearly understand the feature and how it is supposed to work.</span></span> <span data-ttu-id="7ecca-288">Somente depois que o teste é escrito (e você verificou que ele falha) você então implementa a funcionalidade real que o teste verifica.</span><span class="sxs-lookup"><span data-stu-id="7ecca-288">Only after the test is written (and you have verified that it fails) do you then implement the actual functionality the test verifies.</span></span> <span data-ttu-id="7ecca-289">Como você já passou um tempo pensando no caso de uso de como o recurso deve funcionar, você terá uma melhor compreensão dos requisitos e a melhor maneira de implementá-los.</span><span class="sxs-lookup"><span data-stu-id="7ecca-289">Because you've already spent time thinking about the use case of how the feature is supposed to work, you will have a better understanding of the requirements and how best to implement them.</span></span> <span data-ttu-id="7ecca-290">Quando terminar a implementação, você pode reexecutar o teste – e obter feedback imediato sobre se o recurso funciona corretamente.</span><span class="sxs-lookup"><span data-stu-id="7ecca-290">When you are done with the implementation you can re-run the test – and get immediate feedback as to whether the feature works correctly.</span></span> <span data-ttu-id="7ecca-291">Vamos cobrir mais TDD no Capítulo 10.</span><span class="sxs-lookup"><span data-stu-id="7ecca-291">We'll cover TDD more in Chapter 10.</span></span>

### <a name="next-step"></a><span data-ttu-id="7ecca-292">Próxima etapa</span><span class="sxs-lookup"><span data-stu-id="7ecca-292">Next Step</span></span>

<span data-ttu-id="7ecca-293">Alguns comentários finais.</span><span class="sxs-lookup"><span data-stu-id="7ecca-293">Some final wrap up comments.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="7ecca-294">[Próximo](use-ajax-to-implement-mapping-scenarios.md)
> [anterior](nerddinner-wrap-up.md)</span><span class="sxs-lookup"><span data-stu-id="7ecca-294">[Previous](use-ajax-to-implement-mapping-scenarios.md)
[Next](nerddinner-wrap-up.md)</span></span>
