---
uid: mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
title: Habilitar o teste automatizado de unidade | Microsoft Docs
author: microsoft
description: A etapa 12 mostra como desenvolver um pacote de testes de unidade automatizados que verificam nossa funcionalidade NerdDinner e que nos fornecerá a confiança de fazer alterações...
ms.author: riande
ms.date: 07/27/2010
ms.assetid: a19ff2ce-3f7e-4358-9a51-a1403da9c63e
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
msc.type: authoredcontent
ms.openlocfilehash: 09a7aa186605a6cce48ee94028425ded957c00d3
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78541674"
---
# <a name="enable-automated-unit-testing"></a><span data-ttu-id="cde35-103">Habilitar o teste de unidade automatizado</span><span class="sxs-lookup"><span data-stu-id="cde35-103">Enable Automated Unit Testing</span></span>

<span data-ttu-id="cde35-104">pela [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="cde35-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="cde35-105">Baixar PDF</span><span class="sxs-lookup"><span data-stu-id="cde35-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="cde35-106">Esta é a etapa 12 de um [tutorial de aplicativo "NerdDinner"](introducing-the-nerddinner-tutorial.md) gratuito que percorre como criar um aplicativo Web pequeno, mas completo usando o ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="cde35-106">This is step 12 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="cde35-107">A etapa 12 mostra como desenvolver um pacote de testes de unidade automatizados que verificam nossa funcionalidade de NerdDinner e que nos fornecerá a confiança de fazer alterações e melhorias no aplicativo no futuro.</span><span class="sxs-lookup"><span data-stu-id="cde35-107">Step 12 shows how to develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>
> 
> <span data-ttu-id="cde35-108">Se você estiver usando o ASP.NET MVC 3, recomendamos seguir as [introdução com](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) os tutoriais da [loja de música](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) MVC 3 ou MVC.</span><span class="sxs-lookup"><span data-stu-id="cde35-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>

## <a name="nerddinner-step-12-unit-testing"></a><span data-ttu-id="cde35-109">Etapa 12 do NerdDinner: teste de unidade</span><span class="sxs-lookup"><span data-stu-id="cde35-109">NerdDinner Step 12: Unit Testing</span></span>

<span data-ttu-id="cde35-110">Vamos desenvolver um pacote de testes de unidade automatizados que verificam nossa funcionalidade de NerdDinner e que nos fornecerá a confiança de fazer alterações e melhorias no aplicativo no futuro.</span><span class="sxs-lookup"><span data-stu-id="cde35-110">Let's develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>

### <a name="why-unit-test"></a><span data-ttu-id="cde35-111">Por que testar unidade?</span><span class="sxs-lookup"><span data-stu-id="cde35-111">Why Unit Test?</span></span>

<span data-ttu-id="cde35-112">Na unidade no trabalho, uma manhã você tem um flash repentino de inspiração sobre um aplicativo no qual está trabalhando.</span><span class="sxs-lookup"><span data-stu-id="cde35-112">On the drive into work one morning you have a sudden flash of inspiration about an application you are working on.</span></span> <span data-ttu-id="cde35-113">Você percebe que há uma alteração que pode ser implementada, o que tornará o aplicativo muito melhor.</span><span class="sxs-lookup"><span data-stu-id="cde35-113">You realize there is a change you can implement that will make the application dramatically better.</span></span> <span data-ttu-id="cde35-114">Pode ser uma refatoração que limpa o código, adiciona um novo recurso ou corrige um bug.</span><span class="sxs-lookup"><span data-stu-id="cde35-114">It might be a refactoring that cleans up the code, adds a new feature, or fixes a bug.</span></span>

<span data-ttu-id="cde35-115">A pergunta que o levará quando chegar ao seu computador é: "quão segura é para fazer essa melhoria?"</span><span class="sxs-lookup"><span data-stu-id="cde35-115">The question that confronts you when you arrive at your computer is – "how safe is it to make this improvement?"</span></span> <span data-ttu-id="cde35-116">E se fazer a alteração tiver efeitos colaterais ou quebrar algo?</span><span class="sxs-lookup"><span data-stu-id="cde35-116">What if making the change has side effects or breaks something?</span></span> <span data-ttu-id="cde35-117">A alteração pode ser simples e levar apenas alguns minutos para ser implementada, mas e se levar horas para testar manualmente todos os cenários de aplicativos?</span><span class="sxs-lookup"><span data-stu-id="cde35-117">The change might be simple and only take a few minutes to implement, but what if it takes hours to manually test out all of the application scenarios?</span></span> <span data-ttu-id="cde35-118">E se você se esquecer de abordar um cenário e um aplicativo interrompido entrar em produção?</span><span class="sxs-lookup"><span data-stu-id="cde35-118">What if you forget to cover a scenario and a broken application goes into production?</span></span> <span data-ttu-id="cde35-119">Esse aperfeiçoamento vale muito o esforço?</span><span class="sxs-lookup"><span data-stu-id="cde35-119">Is making this improvement really worth all the effort?</span></span>

<span data-ttu-id="cde35-120">Os testes de unidade automatizados podem fornecer uma rede de segurança que permite que você aprimore seus aplicativos continuamente e evite ter medo do código no qual está trabalhando.</span><span class="sxs-lookup"><span data-stu-id="cde35-120">Automated unit tests can provide a safety net that enables you to continually enhance your applications, and avoid being afraid of the code you are working on.</span></span> <span data-ttu-id="cde35-121">Ter testes automatizados que verificam a funcionalidade rapidamente permite codificar com confiança – e capacitar você a fazer melhorias que, de outra forma, você não sentiria confortável.</span><span class="sxs-lookup"><span data-stu-id="cde35-121">Having automated tests that quickly verify functionality enables you to code with confidence – and empower you to make improvements you might otherwise not have felt comfortable doing.</span></span> <span data-ttu-id="cde35-122">Eles também ajudam a criar soluções que são mais fáceis de manter e têm um tempo de vida maior, o que leva a um retorno muito maior sobre o investimento.</span><span class="sxs-lookup"><span data-stu-id="cde35-122">They also help create solutions that are more maintainable and have a longer lifetime - which leads to a much higher return on investment.</span></span>

<span data-ttu-id="cde35-123">O ASP.NET MVC Framework torna mais fácil e natural a funcionalidade do aplicativo de teste de unidade.</span><span class="sxs-lookup"><span data-stu-id="cde35-123">The ASP.NET MVC Framework makes it easy and natural to unit test application functionality.</span></span> <span data-ttu-id="cde35-124">Ele também habilita um fluxo de trabalho de TDD (desenvolvimento controlado por teste) que habilita o desenvolvimento baseado em teste primeiro.</span><span class="sxs-lookup"><span data-stu-id="cde35-124">It also enables a Test Driven Development (TDD) workflow that enables test-first based development.</span></span>

### <a name="nerddinnertests-project"></a><span data-ttu-id="cde35-125">Projeto NerdDinner. Tests</span><span class="sxs-lookup"><span data-stu-id="cde35-125">NerdDinner.Tests Project</span></span>

<span data-ttu-id="cde35-126">Quando criamos nosso aplicativo NerdDinner no início deste tutorial, recebemos uma caixa de diálogo perguntando se queríamos criar um projeto de teste de unidade para acompanhar o projeto de aplicativo:</span><span class="sxs-lookup"><span data-stu-id="cde35-126">When we created our NerdDinner application at the beginning of this tutorial, we were prompted with a dialog asking whether we wanted to create a unit test project to go along with the application project:</span></span>

![](enable-automated-unit-testing/_static/image1.png)

<span data-ttu-id="cde35-127">Mantivemos o botão de opção "Sim, criar um projeto de teste de unidade" selecionado – o que resultou em um projeto "NerdDinner. Tests" que está sendo adicionado à nossa solução:</span><span class="sxs-lookup"><span data-stu-id="cde35-127">We kept the "Yes, create a unit test project" radio button selected – which resulted in a "NerdDinner.Tests" project being added to our solution:</span></span>

![](enable-automated-unit-testing/_static/image2.png)

<span data-ttu-id="cde35-128">O projeto NerdDinner. Tests referencia o assembly do projeto de aplicativo NerdDinner e permite que possamos adicionar facilmente testes automatizados a ele que verificam a funcionalidade do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="cde35-128">The NerdDinner.Tests project references the NerdDinner application project assembly, and enables us to easily add automated tests to it that verify the application functionality.</span></span>

### <a name="creating-unit-tests-for-our-dinner-model-class"></a><span data-ttu-id="cde35-129">Criando testes de unidade para nossa classe de modelo de jantar</span><span class="sxs-lookup"><span data-stu-id="cde35-129">Creating Unit Tests for our Dinner Model Class</span></span>

<span data-ttu-id="cde35-130">Vamos adicionar alguns testes ao nosso projeto NerdDinner. Tests que verificamos a classe de jantar que criamos quando criamos nossa camada de modelo.</span><span class="sxs-lookup"><span data-stu-id="cde35-130">Let's add some tests to our NerdDinner.Tests project that verify the Dinner class we created when we built our model layer.</span></span>

<span data-ttu-id="cde35-131">Vamos começar criando uma nova pasta dentro de nosso projeto de teste chamada "Models", onde colocaremos nossos testes relacionados ao modelo.</span><span class="sxs-lookup"><span data-stu-id="cde35-131">We'll start by creating a new folder within our test project called "Models" where we'll place our model-related tests.</span></span> <span data-ttu-id="cde35-132">Em seguida, clicaremos com o botão direito do mouse na pasta e escolheremos o comando **Add-&gt;New Test** menu.</span><span class="sxs-lookup"><span data-stu-id="cde35-132">We'll then right-click on the folder and choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="cde35-133">Isso abrirá a caixa de diálogo "Adicionar novo teste".</span><span class="sxs-lookup"><span data-stu-id="cde35-133">This will bring up the "Add New Test" dialog.</span></span>

<span data-ttu-id="cde35-134">Vamos optar por criar um "teste de unidade" e nomeá-lo como "DinnerTest.cs":</span><span class="sxs-lookup"><span data-stu-id="cde35-134">We'll choose to create a "Unit Test" and name it "DinnerTest.cs":</span></span>

![](enable-automated-unit-testing/_static/image3.png)

<span data-ttu-id="cde35-135">Quando clicamos no botão "OK", o Visual Studio adicionará (e abrirá) um arquivo DinnerTest.cs ao projeto:</span><span class="sxs-lookup"><span data-stu-id="cde35-135">When we click the "ok" button Visual Studio will add (and open) a DinnerTest.cs file to the project:</span></span>

![](enable-automated-unit-testing/_static/image4.png)

<span data-ttu-id="cde35-136">O modelo de teste de unidade padrão do Visual Studio tem um monte de códigos de chapas dentro dele que acho um pouco confuso.</span><span class="sxs-lookup"><span data-stu-id="cde35-136">The default Visual Studio unit test template has a bunch of boiler-plate code within it that I find a little messy.</span></span> <span data-ttu-id="cde35-137">Vamos limpá-lo para conter apenas o código abaixo:</span><span class="sxs-lookup"><span data-stu-id="cde35-137">Let's clean it up to just contain the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample1.cs)]

<span data-ttu-id="cde35-138">O atributo [TestClass] na classe DinnerTest acima o identifica como uma classe que conterá testes, bem como a inicialização de teste opcional e o código de subdivisão.</span><span class="sxs-lookup"><span data-stu-id="cde35-138">The [TestClass] attribute on the DinnerTest class above identifies it as a class that will contain tests, as well as optional test initialization and teardown code.</span></span> <span data-ttu-id="cde35-139">Podemos definir testes dentro dele adicionando métodos públicos que têm um atributo [TestMethod] neles.</span><span class="sxs-lookup"><span data-stu-id="cde35-139">We can define tests within it by adding public methods that have a [TestMethod] attribute on them.</span></span>

<span data-ttu-id="cde35-140">Abaixo estão os primeiros dois testes que adicionaremos a nossa aula de jantar.</span><span class="sxs-lookup"><span data-stu-id="cde35-140">Below are the first of two tests we'll add that exercise our Dinner class.</span></span> <span data-ttu-id="cde35-141">O primeiro teste verifica se o nosso jantar é inválido se um novo jantar é criado sem que todas as propriedades sejam definidas corretamente.</span><span class="sxs-lookup"><span data-stu-id="cde35-141">The first test verifies that our Dinner is invalid if a new Dinner is created without all properties being set correctly.</span></span> <span data-ttu-id="cde35-142">O segundo teste verifica se o nosso jantar é válido quando um jantar tem todas as propriedades definidas com valores válidos:</span><span class="sxs-lookup"><span data-stu-id="cde35-142">The second test verifies that our Dinner is valid when a Dinner has all properties set with valid values:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample2.cs)]

<span data-ttu-id="cde35-143">Você notará acima que nossos nomes de teste são muito explícitos (e um pouco detalhados).</span><span class="sxs-lookup"><span data-stu-id="cde35-143">You'll notice above that our test names are very explicit (and somewhat verbose).</span></span> <span data-ttu-id="cde35-144">Estamos fazendo isso porque podemos acabar criando centenas ou milhares de pequenos testes, e queremos facilitar a determinação rápida da intenção e do comportamento de cada um deles (especialmente quando estamos examinando uma lista de falhas em um executor de teste).</span><span class="sxs-lookup"><span data-stu-id="cde35-144">We are doing this because we might end up creating hundreds or thousands of small tests, and we want to make it easy to quickly determine the intent and behavior of each of them (especially when we are looking through a list of failures in a test runner).</span></span> <span data-ttu-id="cde35-145">Os nomes de teste devem ser nomeados após a funcionalidade que eles estão testando.</span><span class="sxs-lookup"><span data-stu-id="cde35-145">The test names should be named after the functionality they are testing.</span></span> <span data-ttu-id="cde35-146">Acima, estamos usando um padrão de nomenclatura "substantivo\_deve\_verbo".</span><span class="sxs-lookup"><span data-stu-id="cde35-146">Above we are using a "Noun\_Should\_Verb" naming pattern.</span></span>

<span data-ttu-id="cde35-147">Estamos estruturando os testes usando o padrão de teste "AAA", que significa "Arrange, Act, Assert":</span><span class="sxs-lookup"><span data-stu-id="cde35-147">We are structuring the tests using the "AAA" testing pattern – which stands for "Arrange, Act, Assert":</span></span>

- <span data-ttu-id="cde35-148">Organizar: configurar a unidade que está sendo testada</span><span class="sxs-lookup"><span data-stu-id="cde35-148">Arrange: Setup the unit being tested</span></span>
- <span data-ttu-id="cde35-149">Act: exercitar a unidade em teste e capturar os resultados</span><span class="sxs-lookup"><span data-stu-id="cde35-149">Act: Exercise the unit under test and capture results</span></span>
- <span data-ttu-id="cde35-150">Assert: verificar o comportamento</span><span class="sxs-lookup"><span data-stu-id="cde35-150">Assert: Verify the behavior</span></span>

<span data-ttu-id="cde35-151">Quando escrevemos testes, queremos evitar que os testes individuais façam muito.</span><span class="sxs-lookup"><span data-stu-id="cde35-151">When we write tests we want to avoid having the individual tests do too much.</span></span> <span data-ttu-id="cde35-152">Em vez disso, cada teste deve verificar apenas um único conceito (o que tornará muito mais fácil identificar a causa das falhas).</span><span class="sxs-lookup"><span data-stu-id="cde35-152">Instead each test should verify only a single concept (which will make it much easier to pinpoint the cause of failures).</span></span> <span data-ttu-id="cde35-153">Uma boa diretriz é tentar e ter apenas uma única instrução Assert para cada teste.</span><span class="sxs-lookup"><span data-stu-id="cde35-153">A good guideline is to try and only have a single assert statement for each test.</span></span> <span data-ttu-id="cde35-154">Se você tiver mais de uma instrução Assert em um método de teste, certifique-se de que todas estejam sendo usadas para testar o mesmo conceito.</span><span class="sxs-lookup"><span data-stu-id="cde35-154">If you have more than one assert statement in a test method, make sure they are all being used to test the same concept.</span></span> <span data-ttu-id="cde35-155">Em caso de dúvida, faça outro teste.</span><span class="sxs-lookup"><span data-stu-id="cde35-155">When in doubt, make another test.</span></span>

### <a name="running-tests"></a><span data-ttu-id="cde35-156">Executando testes</span><span class="sxs-lookup"><span data-stu-id="cde35-156">Running Tests</span></span>

<span data-ttu-id="cde35-157">O Visual Studio 2008 Professional (e edições superiores) inclui um executor de teste interno que pode ser usado para executar projetos de teste de unidade do Visual Studio dentro do IDE.</span><span class="sxs-lookup"><span data-stu-id="cde35-157">Visual Studio 2008 Professional (and higher editions) includes a built-in test runner that can be used to run Visual Studio Unit Test projects within the IDE.</span></span> <span data-ttu-id="cde35-158">É possível selecionar o comando **Test-&gt;execute-&gt;todos os testes no menu da solução** (ou digite CTRL R, a) para executar todos os nossos testes de unidade.</span><span class="sxs-lookup"><span data-stu-id="cde35-158">We can select the **Test-&gt;Run-&gt;All Tests in Solution** menu command (or type Ctrl R, A) to run all of our unit tests.</span></span> <span data-ttu-id="cde35-159">Ou, como alternativa, podemos posicionar nosso cursor dentro de uma classe de teste específica ou um método de teste e usar os **testes de execução de&gt;de teste&gt;no** comando de menu de contexto atual (ou digite CTRL R, t) para executar um subconjunto dos testes de unidade.</span><span class="sxs-lookup"><span data-stu-id="cde35-159">Or alternatively we can position our cursor within a specific test class or test method and use the **Test-&gt;Run-&gt;Tests in Current Context** menu command (or type Ctrl R, T) to run a subset of the unit tests.</span></span>

<span data-ttu-id="cde35-160">Vamos posicionar nosso cursor dentro da classe DinnerTest e digitar "CTRL R, T" para executar os dois testes que acabamos de definir.</span><span class="sxs-lookup"><span data-stu-id="cde35-160">Let's position our cursor within the DinnerTest class and type "Ctrl R, T" to run the two tests we just defined.</span></span> <span data-ttu-id="cde35-161">Quando fazemos isso, uma janela "Resultados de Teste" aparecerá no Visual Studio e veremos os resultados da nossa execução de teste listada nele:</span><span class="sxs-lookup"><span data-stu-id="cde35-161">When we do this a "Test Results" window will appear within Visual Studio and we'll see the results of our test run listed within it:</span></span>

![](enable-automated-unit-testing/_static/image5.png)

<span data-ttu-id="cde35-162">*Observação: a janela de resultados de teste do VS não mostra a coluna nome da classe por padrão. Você pode adicionar isso clicando com o botão direito do mouse na janela Resultados de Teste e usando o comando de menu Adicionar/remover colunas.*</span><span class="sxs-lookup"><span data-stu-id="cde35-162">*Note: The VS test results window does not show the Class Name column by default. You can add this by right-clicking within the Test Results window and using the Add/Remove Columns menu command.*</span></span>

<span data-ttu-id="cde35-163">Nossos dois testes levaram apenas uma fração de um segundo a ser executado – e como você pode ver que ambos passaram.</span><span class="sxs-lookup"><span data-stu-id="cde35-163">Our two tests took only a fraction of a second to run – and as you can see they both passed.</span></span> <span data-ttu-id="cde35-164">Agora podemos passar e aumentá-los criando testes adicionais que verificam validações de regra específicas, bem como abrangem os dois métodos auxiliares – IsUserHost () e IsUserRegistered () – que adicionamos à classe jantar.</span><span class="sxs-lookup"><span data-stu-id="cde35-164">We can now go on and augment them by creating additional tests that verify specific rule validations, as well as cover the two helper methods - IsUserHost() and IsUserRegistered() – that we added to the Dinner class.</span></span> <span data-ttu-id="cde35-165">Ter todos esses testes em vigor para a classe jantar tornará muito mais fácil e mais segura a adição de novas regras de negócios e validações a ele no futuro.</span><span class="sxs-lookup"><span data-stu-id="cde35-165">Having all these tests in place for the Dinner class will make it much easier and safer to add new business rules and validations to it in the future.</span></span> <span data-ttu-id="cde35-166">Podemos adicionar nossa nova lógica de regra ao jantar e, em alguns segundos, verificar se ela não violou nenhuma de nossas funcionalidades lógicas anteriores.</span><span class="sxs-lookup"><span data-stu-id="cde35-166">We can add our new rule logic to Dinner, and then within seconds verify that it hasn't broken any of our previous logic functionality.</span></span>

<span data-ttu-id="cde35-167">Observe como usar um nome de teste descritivo torna mais fácil entender rapidamente o que cada teste está verificando.</span><span class="sxs-lookup"><span data-stu-id="cde35-167">Notice how using a descriptive test name makes it easy to quickly understand what each test is verifying.</span></span> <span data-ttu-id="cde35-168">Recomendo usar o comando de menu **ferramentas –&gt;opções** , abrir a tela de configuração de execução de teste ferramentas de&gt;de teste e marcar a caixa de seleção "clicar duas vezes em um resultado de teste de unidade com falha ou inconclusivo exibe o ponto de falha no teste".</span><span class="sxs-lookup"><span data-stu-id="cde35-168">I recommend using the **Tools-&gt;Options** menu command, opening the Test Tools-&gt;Test Execution configuration screen, and checking the "Double-clicking a failed or inconclusive unit test result displays the point of failure in the test" checkbox.</span></span> <span data-ttu-id="cde35-169">Isso permitirá que você clique duas vezes em uma falha na janela de resultados de teste e vá imediatamente para a falha de Assert.</span><span class="sxs-lookup"><span data-stu-id="cde35-169">This will allow you to double-click on a failure in the test results window and jump immediately to the assert failure.</span></span>

### <a name="creating-dinnerscontroller-unit-tests"></a><span data-ttu-id="cde35-170">Criando testes de unidade DinnersController</span><span class="sxs-lookup"><span data-stu-id="cde35-170">Creating DinnersController Unit Tests</span></span>

<span data-ttu-id="cde35-171">Agora, vamos criar alguns testes de unidade que verificam nossa funcionalidade DinnersController.</span><span class="sxs-lookup"><span data-stu-id="cde35-171">Let's now create some unit tests that verify our DinnersController functionality.</span></span> <span data-ttu-id="cde35-172">Começaremos clicando com o botão direito do mouse na pasta "controladores" em nosso projeto de teste e escolheremos o comando de menu **adicionar&gt;novo teste** .</span><span class="sxs-lookup"><span data-stu-id="cde35-172">We'll start by right-clicking on the "Controllers" folder within our Test project and then choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="cde35-173">Vamos criar um "teste de unidade" e nomeá-lo como "DinnersControllerTest.cs".</span><span class="sxs-lookup"><span data-stu-id="cde35-173">We'll create a "Unit Test" and name it "DinnersControllerTest.cs".</span></span>

<span data-ttu-id="cde35-174">Criaremos dois métodos de teste que verificam o método de ação Details () no DinnersController.</span><span class="sxs-lookup"><span data-stu-id="cde35-174">We'll create two test methods that verify the Details() action method on the DinnersController.</span></span> <span data-ttu-id="cde35-175">O primeiro verificará se uma exibição é retornada quando um jantar existente é solicitado.</span><span class="sxs-lookup"><span data-stu-id="cde35-175">The first will verify that a View is returned when an existing Dinner is requested.</span></span> <span data-ttu-id="cde35-176">O segundo verificará se uma exibição "não encontrada" é retornada quando um jantar não existente é solicitado:</span><span class="sxs-lookup"><span data-stu-id="cde35-176">The second will verify that a "NotFound" view is returned when a non-existent Dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample3.cs)]

<span data-ttu-id="cde35-177">O código acima compila a limpeza.</span><span class="sxs-lookup"><span data-stu-id="cde35-177">The above code compiles clean.</span></span> <span data-ttu-id="cde35-178">No entanto, quando executamos os testes, eles falham:</span><span class="sxs-lookup"><span data-stu-id="cde35-178">When we run the tests, though, they both fail:</span></span>

![](enable-automated-unit-testing/_static/image6.png)

<span data-ttu-id="cde35-179">Se observarmos as mensagens de erro, veremos que o motivo da falha nos testes foi porque nossa classe DinnersRepository não pôde se conectar a um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="cde35-179">If we look at the error messages, we'll see that the reason the tests failed was because our DinnersRepository class was unable to connect to a database.</span></span> <span data-ttu-id="cde35-180">Nosso aplicativo NerdDinner está usando uma cadeia de conexão para um arquivo de SQL Server Express local que reside no diretório de dados do \App\_do projeto de aplicativo NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="cde35-180">Our NerdDinner application is using a connection-string to a local SQL Server Express file which lives under the \App\_Data directory of the NerdDinner application project.</span></span> <span data-ttu-id="cde35-181">Como nosso projeto NerdDinner. Tests compila e executa em um diretório diferente, o projeto de aplicativo, o local do caminho relativo da nossa cadeia de conexão está incorreto.</span><span class="sxs-lookup"><span data-stu-id="cde35-181">Because our NerdDinner.Tests project compiles and runs in a different directory then the application project, the relative path location of our connection-string is incorrect.</span></span>

<span data-ttu-id="cde35-182">Poderíamos *corrigir isso* copiando o arquivo de banco de dados do SQL Express para nosso projeto de teste e, em seguida, adicionar uma cadeia de conexão de teste apropriada a ele no app. config do nosso projeto de teste.</span><span class="sxs-lookup"><span data-stu-id="cde35-182">We *could* fix this by copying the SQL Express database file to our test project, and then add an appropriate test connection-string to it in the App.config of our test project.</span></span> <span data-ttu-id="cde35-183">Isso obteria os testes acima desbloqueados e em execução.</span><span class="sxs-lookup"><span data-stu-id="cde35-183">This would get the above tests unblocked and running.</span></span>

<span data-ttu-id="cde35-184">No entanto, o código de teste de unidade usando um banco de dados real traz vários desafios.</span><span class="sxs-lookup"><span data-stu-id="cde35-184">Unit testing code using a real database, though, brings with it a number of challenges.</span></span> <span data-ttu-id="cde35-185">Especificamente:</span><span class="sxs-lookup"><span data-stu-id="cde35-185">Specifically:</span></span>

- <span data-ttu-id="cde35-186">Ele reduz significativamente o tempo de execução dos testes de unidade.</span><span class="sxs-lookup"><span data-stu-id="cde35-186">It significantly slows down the execution time of unit tests.</span></span> <span data-ttu-id="cde35-187">Quanto mais tempo é necessário para executar testes, menor é a probabilidade de executá-los com frequência.</span><span class="sxs-lookup"><span data-stu-id="cde35-187">The longer it takes to run tests, the less likely you are to execute them frequently.</span></span> <span data-ttu-id="cde35-188">O ideal é que você queira que os testes de unidade possam ser executados em segundos – e fazer com que seja algo que você faça tão naturalmente quanto compilar o projeto.</span><span class="sxs-lookup"><span data-stu-id="cde35-188">Ideally you want your unit tests to be able to be run in seconds – and have it be something you do as naturally as compiling the project.</span></span>
- <span data-ttu-id="cde35-189">Isso complica a lógica de configuração e limpeza em testes.</span><span class="sxs-lookup"><span data-stu-id="cde35-189">It complicates the setup and cleanup logic within tests.</span></span> <span data-ttu-id="cde35-190">Você deseja que cada teste de unidade seja isolado e independente de outros (sem efeitos colaterais ou dependências).</span><span class="sxs-lookup"><span data-stu-id="cde35-190">You want each unit test to be isolated and independent of others (with no side effects or dependencies).</span></span> <span data-ttu-id="cde35-191">Ao trabalhar com um banco de dados real, você precisa estar atento ao estado e redefini-lo entre os testes.</span><span class="sxs-lookup"><span data-stu-id="cde35-191">When working against a real database you have to be mindful of state and reset it between tests.</span></span>

<span data-ttu-id="cde35-192">Vamos examinar um padrão de design chamado "injeção de dependência" que pode nos ajudar a solucionar esses problemas e evitar a necessidade de usar um banco de dados real com nossos testes.</span><span class="sxs-lookup"><span data-stu-id="cde35-192">Let's look at a design pattern called "dependency injection" that can help us work around these issues and avoid the need to use a real database with our tests.</span></span>

### <a name="dependency-injection"></a><span data-ttu-id="cde35-193">Injeção de dependência</span><span class="sxs-lookup"><span data-stu-id="cde35-193">Dependency Injection</span></span>

<span data-ttu-id="cde35-194">No momento, DinnersController está rigidamente "acoplado" à classe DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="cde35-194">Right now DinnersController is tightly "coupled" to the DinnerRepository class.</span></span> <span data-ttu-id="cde35-195">"Acoplamento" refere-se a uma situação em que uma classe depende explicitamente de outra classe para funcionar:</span><span class="sxs-lookup"><span data-stu-id="cde35-195">"Coupling" refers to a situation where a class explicitly relies on another class in order to work:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample4.cs)]

<span data-ttu-id="cde35-196">Como a classe DinnerRepository requer acesso a um banco de dados, a dependência rigidamente acoplada que a classe DinnersController tem no DinnerRepository acaba exigindo que tenhamos um banco de dados para que os métodos de ação DinnersController sejam testados.</span><span class="sxs-lookup"><span data-stu-id="cde35-196">Because the DinnerRepository class requires access to a database, the tightly coupled dependency the DinnersController class has on the DinnerRepository ends up requiring us to have a database in order for the DinnersController action methods to be tested.</span></span>

<span data-ttu-id="cde35-197">Podemos contornar isso empregando um padrão de design chamado "injeção de dependência" – que é uma abordagem em que as dependências (como as classes de repositório que fornecem acesso a dados) não são mais implicitamente criadas em classes que as usam.</span><span class="sxs-lookup"><span data-stu-id="cde35-197">We can get around this by employing a design pattern called "dependency injection" – which is an approach where dependencies (like repository classes that provide data access) are no longer implicitly created within classes that use them.</span></span> <span data-ttu-id="cde35-198">Em vez disso, as dependências podem ser passadas explicitamente para a classe que as utiliza usando argumentos de construtor.</span><span class="sxs-lookup"><span data-stu-id="cde35-198">Instead, dependencies can be explicitly passed to the class that uses them using constructor arguments.</span></span> <span data-ttu-id="cde35-199">Se as dependências forem definidas usando interfaces, então temos a flexibilidade para passar por implementações de dependências "falsas" para cenários de teste de unidade.</span><span class="sxs-lookup"><span data-stu-id="cde35-199">If the dependencies are defined using interfaces, we then have the flexibility to pass in "fake" dependency implementations for unit test scenarios.</span></span> <span data-ttu-id="cde35-200">Isso nos permite criar implementações de dependência específicas de teste que, na verdade, não exigem acesso a um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="cde35-200">This enables us to create test-specific dependency implementations that do not actually require access to a database.</span></span>

<span data-ttu-id="cde35-201">Para ver isso em ação, vamos implementar injeção de dependência com nosso DinnersController.</span><span class="sxs-lookup"><span data-stu-id="cde35-201">To see this in action, let's implement dependency injection with our DinnersController.</span></span>

#### <a name="extracting-an-idinnerrepository-interface"></a><span data-ttu-id="cde35-202">Extraindo uma interface IDinnerRepository</span><span class="sxs-lookup"><span data-stu-id="cde35-202">Extracting an IDinnerRepository interface</span></span>

<span data-ttu-id="cde35-203">Nossa primeira etapa será criar uma nova interface IDinnerRepository que encapsula o contrato de repositório que nossos controladores precisam para recuperar e atualizar os jantares.</span><span class="sxs-lookup"><span data-stu-id="cde35-203">Our first step will be to create a new IDinnerRepository interface that encapsulates the repository contract our controllers require to retrieve and update Dinners.</span></span>

<span data-ttu-id="cde35-204">Podemos definir esse contrato de interface manualmente clicando com o botão direito do mouse na pasta \Models e escolhendo o comando de menu **adicionar&gt;novo item** e criando uma nova interface chamada IDinnerRepository.cs.</span><span class="sxs-lookup"><span data-stu-id="cde35-204">We can define this interface contract manually by right-clicking on the \Models folder, and then choosing the **Add-&gt;New Item** menu command and creating a new interface named IDinnerRepository.cs.</span></span>

<span data-ttu-id="cde35-205">Como alternativa, podemos usar as ferramentas de refatoração internas Visual Studio Professional (e edições superiores) para extrair e criar automaticamente uma interface para nós da nossa classe DinnerRepository existente.</span><span class="sxs-lookup"><span data-stu-id="cde35-205">Alternatively we can use the refactoring tools built-into Visual Studio Professional (and higher editions) to automatically extract and create an interface for us from our existing DinnerRepository class.</span></span> <span data-ttu-id="cde35-206">Para extrair essa interface usando VS, basta posicionar o cursor no editor de texto na classe DinnerRepository e clicar com o botão direito do mouse e escolher o comando de menu **Refactor-&gt;extrair interface** :</span><span class="sxs-lookup"><span data-stu-id="cde35-206">To extract this interface using VS, simply position the cursor in the text editor on the DinnerRepository class, and then right-click and choose the **Refactor-&gt;Extract Interface** menu command:</span></span>

![](enable-automated-unit-testing/_static/image7.png)

<span data-ttu-id="cde35-207">Isso abrirá a caixa de diálogo "Extrair interface" e solicitará o nome da interface a ser criada.</span><span class="sxs-lookup"><span data-stu-id="cde35-207">This will launch the "Extract Interface" dialog and prompt us for the name of the interface to create.</span></span> <span data-ttu-id="cde35-208">Ele usará como padrão IDinnerRepository e selecionará automaticamente todos os métodos públicos na classe DinnerRepository existente para adicionar à interface:</span><span class="sxs-lookup"><span data-stu-id="cde35-208">It will default to IDinnerRepository and automatically select all public methods on the existing DinnerRepository class to add to the interface:</span></span>

![](enable-automated-unit-testing/_static/image8.png)

<span data-ttu-id="cde35-209">Quando clicamos no botão "OK", o Visual Studio adicionará uma nova interface IDinnerRepository ao nosso aplicativo:</span><span class="sxs-lookup"><span data-stu-id="cde35-209">When we click the "ok" button, Visual Studio will add a new IDinnerRepository interface to our application:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample5.cs)]

<span data-ttu-id="cde35-210">E nossa classe DinnerRepository existente será atualizada para que ela implemente a interface:</span><span class="sxs-lookup"><span data-stu-id="cde35-210">And our existing DinnerRepository class will be updated so that it implements the interface:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample6.cs)]

#### <a name="updating-dinnerscontroller-to-support-constructor-injection"></a><span data-ttu-id="cde35-211">Atualizando DinnersController para dar suporte à injeção de Construtor</span><span class="sxs-lookup"><span data-stu-id="cde35-211">Updating DinnersController to support constructor injection</span></span>

<span data-ttu-id="cde35-212">Agora, atualizaremos a classe DinnersController para usar a nova interface.</span><span class="sxs-lookup"><span data-stu-id="cde35-212">We'll now update the DinnersController class to use the new interface.</span></span>

<span data-ttu-id="cde35-213">Atualmente, o DinnersController é embutido em código, de modo que seu campo "dinnerRepository" é sempre uma classe DinnerRepository:</span><span class="sxs-lookup"><span data-stu-id="cde35-213">Currently DinnersController is hard-coded such that its "dinnerRepository" field is always a DinnerRepository class:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample7.cs)]

<span data-ttu-id="cde35-214">Vamos alterá-lo para que o campo "dinnerRepository" seja do tipo IDinnerRepository em vez de DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="cde35-214">We'll change it so that the "dinnerRepository" field is of type IDinnerRepository instead of DinnerRepository.</span></span> <span data-ttu-id="cde35-215">Em seguida, adicionaremos dois construtores DinnersController públicos.</span><span class="sxs-lookup"><span data-stu-id="cde35-215">We'll then add two public DinnersController constructors.</span></span> <span data-ttu-id="cde35-216">Um dos construtores permite que um IDinnerRepository seja passado como um argumento.</span><span class="sxs-lookup"><span data-stu-id="cde35-216">One of the constructors allows an IDinnerRepository to be passed as an argument.</span></span> <span data-ttu-id="cde35-217">O outro é um construtor padrão que usa nossa implementação de DinnerRepository existente:</span><span class="sxs-lookup"><span data-stu-id="cde35-217">The other is a default constructor that uses our existing DinnerRepository implementation:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample8.cs)]

<span data-ttu-id="cde35-218">Como o ASP.NET MVC, por padrão, cria classes de controlador usando construtores padrão, nosso DinnersController em tempo de execução continuará a usar a classe DinnerRepository para executar o acesso a dados.</span><span class="sxs-lookup"><span data-stu-id="cde35-218">Because ASP.NET MVC by default creates controller classes using default constructors, our DinnersController at runtime will continue to use the DinnerRepository class to perform data access.</span></span>

<span data-ttu-id="cde35-219">Agora podemos atualizar nossos testes de unidade, no entanto, para passar uma implementação de repositório de jantar "falsa" usando o construtor de parâmetro.</span><span class="sxs-lookup"><span data-stu-id="cde35-219">We can now update our unit tests, though, to pass in a "fake" dinner repository implementation using the parameter constructor.</span></span> <span data-ttu-id="cde35-220">Esse repositório de jantar "falsificado" não exigirá acesso a um banco de dados real e, em vez disso, usará o uso da memória.</span><span class="sxs-lookup"><span data-stu-id="cde35-220">This "fake" dinner repository will not require access to a real database, and instead will use in-memory sample data.</span></span>

#### <a name="creating-the-fakedinnerrepository-class"></a><span data-ttu-id="cde35-221">Criando a classe FakeDinnerRepository</span><span class="sxs-lookup"><span data-stu-id="cde35-221">Creating the FakeDinnerRepository class</span></span>

<span data-ttu-id="cde35-222">Vamos criar uma classe FakeDinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="cde35-222">Let's create a FakeDinnerRepository class.</span></span>

<span data-ttu-id="cde35-223">Vamos começar criando um diretório "falsificações" em nosso projeto NerdDinner. Tests e, em seguida, adicionar uma nova classe FakeDinnerRepository a ela (clique com o botão direito do mouse na pasta e escolha **Add-&gt;nova classe**):</span><span class="sxs-lookup"><span data-stu-id="cde35-223">We'll begin by creating a "Fakes" directory within our NerdDinner.Tests project and then add a new FakeDinnerRepository class to it (right-click on the folder and choose **Add-&gt;New Class**):</span></span>

![](enable-automated-unit-testing/_static/image9.png)

<span data-ttu-id="cde35-224">Atualizaremos o código para que a classe FakeDinnerRepository implemente a interface IDinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="cde35-224">We'll update the code so that the FakeDinnerRepository class implements the IDinnerRepository interface.</span></span> <span data-ttu-id="cde35-225">Em seguida, podemos clicar com o botão direito do mouse nele e escolher o comando de menu de contexto "Implement interface IDinnerRepository":</span><span class="sxs-lookup"><span data-stu-id="cde35-225">We can then right-click on it and choose the "Implement interface IDinnerRepository" context menu command:</span></span>

![](enable-automated-unit-testing/_static/image10.png)

<span data-ttu-id="cde35-226">Isso fará com que o Visual Studio adicione automaticamente todos os membros da interface IDinnerRepository à nossa classe FakeDinnerRepository com implementações padrão de "stub":</span><span class="sxs-lookup"><span data-stu-id="cde35-226">This will cause Visual Studio to automatically add all of the IDinnerRepository interface members to our FakeDinnerRepository class with default "stub out" implementations:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample9.cs)]

<span data-ttu-id="cde35-227">Em seguida, podemos atualizar a implementação de FakeDinnerRepository para trabalhar fora de uma lista na memória&lt;&gt; a coleção de jantar passada como um argumento de construtor:</span><span class="sxs-lookup"><span data-stu-id="cde35-227">We can then update the FakeDinnerRepository implementation to work off of an in-memory List&lt;Dinner&gt; collection passed to it as a constructor argument:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample10.cs)]

<span data-ttu-id="cde35-228">Agora temos uma implementação de IDinnerRepository falsa que não requer um banco de dados e, em vez disso, pode trabalhar com uma lista na memória de objetos de jantar.</span><span class="sxs-lookup"><span data-stu-id="cde35-228">We now have a fake IDinnerRepository implementation that does not require a database, and can instead work off an in-memory list of Dinner objects.</span></span>

#### <a name="using-the-fakedinnerrepository-with-unit-tests"></a><span data-ttu-id="cde35-229">Usando o FakeDinnerRepository com testes de unidade</span><span class="sxs-lookup"><span data-stu-id="cde35-229">Using the FakeDinnerRepository with Unit Tests</span></span>

<span data-ttu-id="cde35-230">Vamos voltar para os testes de unidade DinnersController que falharam anteriormente porque o banco de dados não estava disponível.</span><span class="sxs-lookup"><span data-stu-id="cde35-230">Let's return to the DinnersController unit tests that failed earlier because the database wasn't available.</span></span> <span data-ttu-id="cde35-231">Podemos atualizar os métodos de teste para usar um FakeDinnerRepository populado com dados de jantar na memória de exemplo para o DinnersController usando o código abaixo:</span><span class="sxs-lookup"><span data-stu-id="cde35-231">We can update the test methods to use a FakeDinnerRepository populated with sample in-memory Dinner data to the DinnersController using the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample11.cs)]

<span data-ttu-id="cde35-232">E agora, quando executamos esses testes, ambos eles são aprovados:</span><span class="sxs-lookup"><span data-stu-id="cde35-232">And now when we run these tests they both pass:</span></span>

![](enable-automated-unit-testing/_static/image11.png)

<span data-ttu-id="cde35-233">O melhor de tudo é que eles levam apenas uma fração de um segundo para execução e não exigem nenhuma lógica complicada de instalação/limpeza.</span><span class="sxs-lookup"><span data-stu-id="cde35-233">Best of all, they take only a fraction of a second to run, and do not require any complicated setup/cleanup logic.</span></span> <span data-ttu-id="cde35-234">Agora podemos testar a unidade todo o nosso código de método de ação DinnersController (incluindo listagem, paginação, detalhes, criar, atualizar e excluir) sem precisar se conectar a um banco de dados real.</span><span class="sxs-lookup"><span data-stu-id="cde35-234">We can now unit test all of our DinnersController action method code (including listing, paging, details, create, update and delete) without ever needing to connect to a real database.</span></span>

| <span data-ttu-id="cde35-235">**Tópico lateral: estruturas de injeção de dependência**</span><span class="sxs-lookup"><span data-stu-id="cde35-235">**Side Topic: Dependency Injection Frameworks**</span></span> |
| --- |
| <span data-ttu-id="cde35-236">A execução da injeção de dependência manual (como a que estamos acima) funciona bem, mas torna-se mais difícil de manter à medida que o número de dependências e componentes em um aplicativo aumenta.</span><span class="sxs-lookup"><span data-stu-id="cde35-236">Performing manual dependency injection (like we are above) works fine, but does become harder to maintain as the number of dependencies and components in an application increases.</span></span> <span data-ttu-id="cde35-237">Existem várias estruturas de injeção de dependência para o .NET que podem ajudar a fornecer ainda mais flexibilidade de gerenciamento de dependência.</span><span class="sxs-lookup"><span data-stu-id="cde35-237">Several dependency injection frameworks exist for .NET that can help provide even more dependency management flexibility.</span></span> <span data-ttu-id="cde35-238">Essas estruturas, às vezes chamadas de contêineres IoC (inversão de controle), fornecem mecanismos que permitem um nível adicional de suporte à configuração para especificar e passar dependências para objetos em tempo de execução (com mais frequência usando injeção de Construtor ).</span><span class="sxs-lookup"><span data-stu-id="cde35-238">These frameworks, also sometimes called "Inversion of Control" (IoC) containers, provide mechanisms that enable an additional level of configuration support for specifying and passing dependencies to objects at runtime (most often using constructor injection).</span></span> <span data-ttu-id="cde35-239">Algumas das estruturas de injeção de dependência OSS/IOC mais populares no .NET incluem: AutoFac, Ninject, Spring.NET, StructureMap e Windsor.</span><span class="sxs-lookup"><span data-stu-id="cde35-239">Some of the more popular OSS Dependency Injection / IOC frameworks in .NET include: AutoFac, Ninject, Spring.NET, StructureMap, and Windsor.</span></span> <span data-ttu-id="cde35-240">O ASP.NET MVC expõe APIs de extensibilidade que permitem que os desenvolvedores participem da resolução e da instanciação de controladores, e que permite que as estruturas de injeção de dependência/IoC sejam integradas com clareza nesse processo.</span><span class="sxs-lookup"><span data-stu-id="cde35-240">ASP.NET MVC exposes extensibility APIs that enable developers to participate in the resolution and instantiation of controllers, and which enables Dependency Injection / IoC frameworks to be cleanly integrated within this process.</span></span> <span data-ttu-id="cde35-241">Usar uma estrutura DI/IOC também nos permitiria remover o construtor padrão de nosso DinnersController – que removeria completamente o acoplamento entre ele e o DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="cde35-241">Using a DI/IOC framework would also enable us to remove the default constructor from our DinnersController – which would completely remove the coupling between it and the DinnerRepository.</span></span> <span data-ttu-id="cde35-242">Não vamos usar uma estrutura de injeção de dependência/IOC com nosso aplicativo NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="cde35-242">We won't be using a dependency injection / IOC framework with our NerdDinner application.</span></span> <span data-ttu-id="cde35-243">Mas é algo que poderíamos considerar para o futuro se a base de código e os recursos NerdDinner crescerem.</span><span class="sxs-lookup"><span data-stu-id="cde35-243">But it is something we could consider for the future if the NerdDinner code-base and capabilities grew.</span></span> |

### <a name="creating-edit-action-unit-tests"></a><span data-ttu-id="cde35-244">Criando testes de unidade de ação de edição</span><span class="sxs-lookup"><span data-stu-id="cde35-244">Creating Edit Action Unit Tests</span></span>

<span data-ttu-id="cde35-245">Agora, vamos criar alguns testes de unidade que verificam a funcionalidade de edição do DinnersController.</span><span class="sxs-lookup"><span data-stu-id="cde35-245">Let's now create some unit tests that verify the Edit functionality of the DinnersController.</span></span> <span data-ttu-id="cde35-246">Começaremos testando a versão HTTP-GET da nossa ação de edição:</span><span class="sxs-lookup"><span data-stu-id="cde35-246">We'll start by testing the HTTP-GET version of our Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample12.cs)]

<span data-ttu-id="cde35-247">Vamos criar um teste que verifica se um modo de exibição apoiado por um objeto DinnerFormViewModel é renderizado de volta quando um jantar válido é solicitado:</span><span class="sxs-lookup"><span data-stu-id="cde35-247">We'll create a test that verifies that a View backed by a DinnerFormViewModel object is rendered back when a valid dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample13.cs)]

<span data-ttu-id="cde35-248">No entanto, quando executamos o teste, descobrimos que ele falha porque uma exceção de referência nula é gerada quando o método Edit acessa a propriedade User.Identity.Name para executar a verificação de jantar. IsHostedBy ().</span><span class="sxs-lookup"><span data-stu-id="cde35-248">When we run the test, though, we'll find that it fails because a null reference exception is thrown when the Edit method accesses the User.Identity.Name property to perform the Dinner.IsHostedBy() check.</span></span>

<span data-ttu-id="cde35-249">O objeto user na classe base do controlador encapsula detalhes sobre o usuário conectado e é populado pelo ASP.NET MVC quando ele cria o controlador em tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="cde35-249">The User object on the Controller base class encapsulates details about the logged-in user, and is populated by ASP.NET MVC when it creates the controller at runtime.</span></span> <span data-ttu-id="cde35-250">Como estamos testando o DinnersController fora de um ambiente de servidor Web, o objeto de usuário não é definido (portanto, a exceção de referência nula).</span><span class="sxs-lookup"><span data-stu-id="cde35-250">Because we are testing the DinnersController outside of a web-server environment, the User object isn't set (hence the null reference exception).</span></span>

### <a name="mocking-the-useridentityname-property"></a><span data-ttu-id="cde35-251">Simulação da propriedade User.Identity.Name</span><span class="sxs-lookup"><span data-stu-id="cde35-251">Mocking the User.Identity.Name property</span></span>

<span data-ttu-id="cde35-252">As estruturas fictícias facilitam o teste ao permitir que possamos criar dinamicamente versões falsas de objetos dependentes que dão suporte a nossos testes.</span><span class="sxs-lookup"><span data-stu-id="cde35-252">Mocking frameworks make testing easier by enabling us to dynamically create fake versions of dependent objects that support our tests.</span></span> <span data-ttu-id="cde35-253">Por exemplo, podemos usar uma estrutura fictícia em nosso teste de ação de edição para criar dinamicamente um objeto de usuário que o nosso DinnersController pode usar para pesquisar um nome simulado.</span><span class="sxs-lookup"><span data-stu-id="cde35-253">For example, we can use a mocking framework in our Edit action test to dynamically create a User object that our DinnersController can use to lookup a simulated username.</span></span> <span data-ttu-id="cde35-254">Isso evitará que uma referência nula seja gerada quando executarmos nosso teste.</span><span class="sxs-lookup"><span data-stu-id="cde35-254">This will avoid a null reference from being thrown when we run our test.</span></span>

<span data-ttu-id="cde35-255">Há muitas estruturas de simulação do .NET que podem ser usadas com o ASP.NET MVC (você pode ver uma lista delas aqui: [http://www.mockframeworks.com/](http://www.mockframeworks.com/)).</span><span class="sxs-lookup"><span data-stu-id="cde35-255">There are many .NET mocking frameworks that can be used with ASP.NET MVC (you can see a list of them here: [http://www.mockframeworks.com/](http://www.mockframeworks.com/)).</span></span> <span data-ttu-id="cde35-256">Para testar nosso aplicativo NerdDinner, usaremos uma estrutura fictícia de código-fonte aberto chamada "MOQ", que pode ser baixada gratuitamente do [http://www.mockframeworks.com/moq](http://www.mockframeworks.com/moq).</span><span class="sxs-lookup"><span data-stu-id="cde35-256">For testing our NerdDinner application we'll use an open source mocking framework called "Moq", which can be downloaded for free from [http://www.mockframeworks.com/moq](http://www.mockframeworks.com/moq).</span></span>

<span data-ttu-id="cde35-257">Depois de baixado, adicionaremos uma referência em nosso projeto NerdDinner. Tests ao assembly MOQ. dll:</span><span class="sxs-lookup"><span data-stu-id="cde35-257">Once downloaded, we'll add a reference in our NerdDinner.Tests project to the Moq.dll assembly:</span></span>

![](enable-automated-unit-testing/_static/image12.png)

<span data-ttu-id="cde35-258">Em seguida, adicionaremos um método auxiliar "CreateDinnersControllerAs (username)" à nossa classe de teste que usa um nome de usuário como parâmetro e que, em seguida, "imita" a propriedade User.Identity.Name na instância DinnersController:</span><span class="sxs-lookup"><span data-stu-id="cde35-258">We'll then add a "CreateDinnersControllerAs(username)" helper method to our test class that takes a username as a parameter, and which then "mocks" the User.Identity.Name property on the DinnersController instance:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample14.cs)]

<span data-ttu-id="cde35-259">Acima, estamos usando MOQ para criar um objeto fictício que falsifica um objeto ControllerContext (que é o que o ASP.NET MVC passa para classes de controlador para expor objetos de tempo de execução como usuário, solicitação, resposta e sessão).</span><span class="sxs-lookup"><span data-stu-id="cde35-259">Above we are using Moq to create a Mock object that fakes a ControllerContext object (which is what ASP.NET MVC passes to Controller classes to expose runtime objects like User, Request, Response, and Session).</span></span> <span data-ttu-id="cde35-260">Estamos chamando o método "SetupGet" na simulação para indicar que a propriedade HttpContext.User.Identity.Name em ControllerContext deve retornar a cadeia de caracteres de nome de usuário que passamos para o método auxiliar.</span><span class="sxs-lookup"><span data-stu-id="cde35-260">We are calling the "SetupGet" method on the Mock to indicate that the HttpContext.User.Identity.Name property on ControllerContext should return the username string we passed to the helper method.</span></span>

<span data-ttu-id="cde35-261">Podemos simular qualquer número de propriedades e métodos de ControllerContext.</span><span class="sxs-lookup"><span data-stu-id="cde35-261">We can mock any number of ControllerContext properties and methods.</span></span> <span data-ttu-id="cde35-262">Para ilustrar isso, também adicionei uma chamada SetupGet () para a propriedade Request. IsAuthenticated (que não é realmente necessária para os testes abaixo, mas que ajuda a ilustrar como você pode simular Propriedades de solicitação).</span><span class="sxs-lookup"><span data-stu-id="cde35-262">To illustrate this I've also added a SetupGet() call for the Request.IsAuthenticated property (which isn't actually needed for the tests below – but which helps illustrate how you can mock Request properties).</span></span> <span data-ttu-id="cde35-263">Quando concluímos, atribuímos uma instância da simulação ControllerContext ao DinnersController que nosso método auxiliar retorna.</span><span class="sxs-lookup"><span data-stu-id="cde35-263">When we are done we assign an instance of the ControllerContext mock to the DinnersController our helper method returns.</span></span>

<span data-ttu-id="cde35-264">Agora podemos escrever testes de unidade que usam esse método auxiliar para testar cenários de edição que envolvem usuários diferentes:</span><span class="sxs-lookup"><span data-stu-id="cde35-264">We can now write unit tests that use this helper method to test Edit scenarios involving different users:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample15.cs)]

<span data-ttu-id="cde35-265">E agora, quando executamos os testes que eles passam:</span><span class="sxs-lookup"><span data-stu-id="cde35-265">And now when we run the tests they pass:</span></span>

![](enable-automated-unit-testing/_static/image13.png)

### <a name="testing-updatemodel-scenarios"></a><span data-ttu-id="cde35-266">Testando cenários UpdateModel ()</span><span class="sxs-lookup"><span data-stu-id="cde35-266">Testing UpdateModel() scenarios</span></span>

<span data-ttu-id="cde35-267">Criamos testes que abrangem a versão HTTP-GET da ação editar.</span><span class="sxs-lookup"><span data-stu-id="cde35-267">We've created tests that cover the HTTP-GET version of the Edit action.</span></span> <span data-ttu-id="cde35-268">Agora, vamos criar alguns testes que verificam a versão HTTP-POST da ação editar:</span><span class="sxs-lookup"><span data-stu-id="cde35-268">Let's now create some tests that verify the HTTP-POST version of the Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample16.cs)]

<span data-ttu-id="cde35-269">O novo cenário de teste interessante para que possamos dar suporte com esse método de ação é seu uso do método auxiliar UpdateModel () na classe base do controlador.</span><span class="sxs-lookup"><span data-stu-id="cde35-269">The interesting new testing scenario for us to support with this action method is its usage of the UpdateModel() helper method on the Controller base class.</span></span> <span data-ttu-id="cde35-270">Estamos usando esse método auxiliar para associar valores de formulário-postagem à nossa instância de objeto do jantar.</span><span class="sxs-lookup"><span data-stu-id="cde35-270">We are using this helper method to bind form-post values to our Dinner object instance.</span></span>

<span data-ttu-id="cde35-271">Abaixo estão dois testes que demonstram como podemos fornecer valores postados de formulário para o método auxiliar UpdateModel () a ser usado.</span><span class="sxs-lookup"><span data-stu-id="cde35-271">Below are two tests that demonstrates how we can supply form posted values for the UpdateModel() helper method to use.</span></span> <span data-ttu-id="cde35-272">Faremos isso criando e Populando um objeto FormsCollection e, em seguida, atribuí-lo à propriedade "ValueProvider" no controlador.</span><span class="sxs-lookup"><span data-stu-id="cde35-272">We'll do this by creating and populating a FormCollection object, and then assign it to the "ValueProvider" property on the Controller.</span></span>

<span data-ttu-id="cde35-273">O primeiro teste verifica se, em um salvamento bem-sucedido, o navegador é redirecionado para a ação de detalhes.</span><span class="sxs-lookup"><span data-stu-id="cde35-273">The first test verifies that on a successful save the browser is redirected to the details action.</span></span> <span data-ttu-id="cde35-274">O segundo teste verifica se, quando a entrada inválida é postada, a ação reexibe a exibição editar novamente com uma mensagem de erro.</span><span class="sxs-lookup"><span data-stu-id="cde35-274">The second test verifies that when invalid input is posted the action redisplays the edit view again with an error message.</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample17.cs)]

### <a name="testing-wrap-up"></a><span data-ttu-id="cde35-275">Testando a conclusão</span><span class="sxs-lookup"><span data-stu-id="cde35-275">Testing Wrap-Up</span></span>

<span data-ttu-id="cde35-276">Nós abordamos os conceitos básicos envolvidos nas classes do controlador de teste de unidade.</span><span class="sxs-lookup"><span data-stu-id="cde35-276">We've covered the core concepts involved in unit testing controller classes.</span></span> <span data-ttu-id="cde35-277">Podemos usar essas técnicas para criar facilmente centenas de testes simples que verificam o comportamento de nosso aplicativo.</span><span class="sxs-lookup"><span data-stu-id="cde35-277">We can use these techniques to easily create hundreds of simple tests that verify the behavior of our application.</span></span>

<span data-ttu-id="cde35-278">Como nossos testes de controlador e modelo não exigem um banco de dados real, eles são extremamente rápidos e fáceis de executar.</span><span class="sxs-lookup"><span data-stu-id="cde35-278">Because our controller and model tests do not require a real database, they are extremely fast and easy to run.</span></span> <span data-ttu-id="cde35-279">Poderemos executar centenas de testes automatizados em segundos e, imediatamente, obter comentários sobre se uma alteração que fizemos ou não quebrou algo.</span><span class="sxs-lookup"><span data-stu-id="cde35-279">We'll be able to execute hundreds of automated tests in seconds, and immediately get feedback as to whether a change we made broke something.</span></span> <span data-ttu-id="cde35-280">Isso ajudará a nos fornecer a confiança para aprimorar, Refatorar e refinar continuamente nosso aplicativo.</span><span class="sxs-lookup"><span data-stu-id="cde35-280">This will help provide us the confidence to continually improve, refactor, and refine our application.</span></span>

<span data-ttu-id="cde35-281">Abordamos o teste como o último tópico deste capítulo, mas não porque o teste é algo que você deve fazer no final de um processo de desenvolvimento!</span><span class="sxs-lookup"><span data-stu-id="cde35-281">We covered testing as the last topic in this chapter – but not because testing is something you should do at the end of a development process!</span></span> <span data-ttu-id="cde35-282">Por contrário, você deve escrever testes automatizados o mais cedo possível em seu processo de desenvolvimento.</span><span class="sxs-lookup"><span data-stu-id="cde35-282">On the contrary, you should write automated tests as early as possible in your development process.</span></span> <span data-ttu-id="cde35-283">Isso permite que você obtenha comentários imediatos à medida que desenvolve, ajuda você a pensar em consideração sobre os cenários de caso de uso do seu aplicativo e o orienta a projetar seu aplicativo com a disposição em camadas e acoplamento em mente.</span><span class="sxs-lookup"><span data-stu-id="cde35-283">Doing so enables you to get immediate feedback as you develop, helps you think thoughtfully about your application's use case scenarios, and guides you to design your application with clean layering and coupling in mind.</span></span>

<span data-ttu-id="cde35-284">Um capítulo posterior no livro discutirá o TDD (desenvolvimento controlado por teste) e como usá-lo com o ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="cde35-284">A later chapter in the book will discuss Test Driven Development (TDD), and how to use it with ASP.NET MVC.</span></span> <span data-ttu-id="cde35-285">O TDD é uma prática de codificação iterativa na qual você primeiro escreve os testes que seu código resultante atenderá.</span><span class="sxs-lookup"><span data-stu-id="cde35-285">TDD is an iterative coding practice where you first write the tests that your resulting code will satisfy.</span></span> <span data-ttu-id="cde35-286">Com o TDD, você começa cada recurso criando um teste que verifica a funcionalidade que você está prestes a implementar.</span><span class="sxs-lookup"><span data-stu-id="cde35-286">With TDD you begin each feature by creating a test that verifies the functionality you are about to implement.</span></span> <span data-ttu-id="cde35-287">Escrever o teste de unidade primeiro ajuda a garantir que você entenda claramente o recurso e como ele deve funcionar.</span><span class="sxs-lookup"><span data-stu-id="cde35-287">Writing the unit test first helps ensure that you clearly understand the feature and how it is supposed to work.</span></span> <span data-ttu-id="cde35-288">Somente depois que o teste é gravado (e você verificou que ele falha), você implementa a funcionalidade real que o teste verifica.</span><span class="sxs-lookup"><span data-stu-id="cde35-288">Only after the test is written (and you have verified that it fails) do you then implement the actual functionality the test verifies.</span></span> <span data-ttu-id="cde35-289">Como você já passou o tempo pensando no caso de uso de como o recurso deve funcionar, você terá uma melhor compreensão dos requisitos e da melhor maneira de implementá-los.</span><span class="sxs-lookup"><span data-stu-id="cde35-289">Because you've already spent time thinking about the use case of how the feature is supposed to work, you will have a better understanding of the requirements and how best to implement them.</span></span> <span data-ttu-id="cde35-290">Quando terminar a implementação, você poderá executar novamente o teste e obter comentários imediatos sobre se o recurso funciona corretamente.</span><span class="sxs-lookup"><span data-stu-id="cde35-290">When you are done with the implementation you can re-run the test – and get immediate feedback as to whether the feature works correctly.</span></span> <span data-ttu-id="cde35-291">Abordaremos mais o TDD no capítulo 10.</span><span class="sxs-lookup"><span data-stu-id="cde35-291">We'll cover TDD more in Chapter 10.</span></span>

### <a name="next-step"></a><span data-ttu-id="cde35-292">Próxima etapa</span><span class="sxs-lookup"><span data-stu-id="cde35-292">Next Step</span></span>

<span data-ttu-id="cde35-293">Alguns comentários finais de retorno.</span><span class="sxs-lookup"><span data-stu-id="cde35-293">Some final wrap up comments.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="cde35-294">[Anterior](use-ajax-to-implement-mapping-scenarios.md)
> [Próximo](nerddinner-wrap-up.md)</span><span class="sxs-lookup"><span data-stu-id="cde35-294">[Previous](use-ajax-to-implement-mapping-scenarios.md)
[Next](nerddinner-wrap-up.md)</span></span>
