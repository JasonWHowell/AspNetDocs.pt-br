---
uid: mvc/overview/older-versions-1/unit-testing/creating-unit-tests-for-asp-net-mvc-applications-cs
title: Criando testes de unidade para aplicativos ASP.NET MVCC#() | Microsoft Docs
author: StephenWalther
description: Saiba como criar testes de unidade para ações do controlador. Neste tutorial, Stephen Walther demonstra como testar se uma ação do controlador retorna uma partir de...
ms.author: riande
ms.date: 08/19/2008
ms.assetid: d3a270b9-d7b1-47f2-8775-fc3beb518b5c
msc.legacyurl: /mvc/overview/older-versions-1/unit-testing/creating-unit-tests-for-asp-net-mvc-applications-cs
msc.type: authoredcontent
ms.openlocfilehash: 35fd0d85c63e5bd196394ce11b851c822a6405d9
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78623938"
---
# <a name="creating-unit-tests-for-aspnet-mvc-applications-c"></a><span data-ttu-id="7256b-104">Criação de testes de unidade para aplicativos do ASP.NET MVC (C#)</span><span class="sxs-lookup"><span data-stu-id="7256b-104">Creating Unit Tests for ASP.NET MVC Applications (C#)</span></span>

<span data-ttu-id="7256b-105">por [Stephen Walther](https://github.com/StephenWalther)</span><span class="sxs-lookup"><span data-stu-id="7256b-105">by [Stephen Walther](https://github.com/StephenWalther)</span></span>

[<span data-ttu-id="7256b-106">Baixar PDF</span><span class="sxs-lookup"><span data-stu-id="7256b-106">Download PDF</span></span>](https://download.microsoft.com/download/8/4/8/84843d8d-1575-426c-bcb5-9d0c42e51416/ASPNET_MVC_Tutorial_07_CS.pdf)

> <span data-ttu-id="7256b-107">Saiba como criar testes de unidade para ações do controlador.</span><span class="sxs-lookup"><span data-stu-id="7256b-107">Learn how to create unit tests for controller actions.</span></span> <span data-ttu-id="7256b-108">Neste tutorial, Stephen Walther demonstra como testar se uma ação do controlador retorna uma determinada exibição, retorna um determinado conjunto de dados ou retorna um tipo diferente de resultado de ação.</span><span class="sxs-lookup"><span data-stu-id="7256b-108">In this tutorial, Stephen Walther demonstrates how to test whether a controller action returns a particular view, returns a particular set of data, or returns a different type of action result.</span></span>

<span data-ttu-id="7256b-109">O objetivo deste tutorial é demonstrar como você pode escrever testes de unidade para os controladores em seus aplicativos MVC do ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="7256b-109">The goal of this tutorial is to demonstrate how you can write unit tests for the controllers in your ASP.NET MVC applications.</span></span> <span data-ttu-id="7256b-110">Discutiremos como criar três tipos diferentes de testes de unidade.</span><span class="sxs-lookup"><span data-stu-id="7256b-110">We discuss how to build three different types of unit tests.</span></span> <span data-ttu-id="7256b-111">Você aprende a testar o modo de exibição retornado por uma ação do controlador, como testar os dados de exibição retornados por uma ação do controlador e como testar se uma ação do controlador redireciona ou não para uma segunda ação do controlador.</span><span class="sxs-lookup"><span data-stu-id="7256b-111">You learn how to test the view returned by a controller action, how to test the View Data returned by a controller action, and how to test whether or not one controller action redirects you to a second controller action.</span></span>

## <a name="creating-the-controller-under-test"></a><span data-ttu-id="7256b-112">Criando o controlador em teste</span><span class="sxs-lookup"><span data-stu-id="7256b-112">Creating the Controller under Test</span></span>

<span data-ttu-id="7256b-113">Vamos começar criando o controlador que pretendemos testar.</span><span class="sxs-lookup"><span data-stu-id="7256b-113">Let's start by creating the controller that we intend to test.</span></span> <span data-ttu-id="7256b-114">O controlador, chamado de `ProductController`, está contido na Listagem 1.</span><span class="sxs-lookup"><span data-stu-id="7256b-114">The controller, named the `ProductController`, is contained in Listing 1.</span></span>

<span data-ttu-id="7256b-115">**Listagem 1 – `ProductController.cs`**</span><span class="sxs-lookup"><span data-stu-id="7256b-115">**Listing 1 – `ProductController.cs`**</span></span>

[!code-csharp[Main](creating-unit-tests-for-asp-net-mvc-applications-cs/samples/sample1.cs)]

<span data-ttu-id="7256b-116">O `ProductController` contém dois métodos de ação chamados `Index()` e `Details()`.</span><span class="sxs-lookup"><span data-stu-id="7256b-116">The `ProductController` contains two action methods named `Index()` and `Details()`.</span></span> <span data-ttu-id="7256b-117">Ambos os métodos de ação retornam uma exibição.</span><span class="sxs-lookup"><span data-stu-id="7256b-117">Both action methods return a view.</span></span> <span data-ttu-id="7256b-118">Observe que a ação `Details()` aceita um parâmetro chamado ID.</span><span class="sxs-lookup"><span data-stu-id="7256b-118">Notice that the `Details()` action accepts a parameter named Id.</span></span>

## <a name="testing-the-view-returned-by-a-controller"></a><span data-ttu-id="7256b-119">Testando a exibição retornada por um controlador</span><span class="sxs-lookup"><span data-stu-id="7256b-119">Testing the View returned by a Controller</span></span>

<span data-ttu-id="7256b-120">Imagine que desejamos testar se o `ProductController` retorna ou não o modo de exibição correto.</span><span class="sxs-lookup"><span data-stu-id="7256b-120">Imagine that we want to test whether or not the `ProductController` returns the right view.</span></span> <span data-ttu-id="7256b-121">Queremos garantir que quando a ação de `ProductController.Details()` for invocada, a exibição de detalhes será retornada.</span><span class="sxs-lookup"><span data-stu-id="7256b-121">We want to make sure that when the `ProductController.Details()` action is invoked, the Details view is returned.</span></span> <span data-ttu-id="7256b-122">A classe de teste na Listagem 2 contém um teste de unidade para testar a exibição retornada pela ação de `ProductController.Details()`.</span><span class="sxs-lookup"><span data-stu-id="7256b-122">The test class in Listing 2 contains a unit test for testing the view returned by the `ProductController.Details()` action.</span></span>

<span data-ttu-id="7256b-123">**Listagem 2 – `ProductControllerTest.cs`**</span><span class="sxs-lookup"><span data-stu-id="7256b-123">**Listing 2 – `ProductControllerTest.cs`**</span></span>

[!code-csharp[Main](creating-unit-tests-for-asp-net-mvc-applications-cs/samples/sample2.cs)]

<span data-ttu-id="7256b-124">A classe na Listagem 2 inclui um método de teste chamado `TestDetailsView()`.</span><span class="sxs-lookup"><span data-stu-id="7256b-124">The class in Listing 2 includes a test method named `TestDetailsView()`.</span></span> <span data-ttu-id="7256b-125">Esse método contém três linhas de código.</span><span class="sxs-lookup"><span data-stu-id="7256b-125">This method contains three lines of code.</span></span> <span data-ttu-id="7256b-126">A primeira linha de código cria uma nova instância da classe `ProductController`.</span><span class="sxs-lookup"><span data-stu-id="7256b-126">The first line of code creates a new instance of the `ProductController` class.</span></span> <span data-ttu-id="7256b-127">A segunda linha de código invoca o método de ação de `Details()` do controlador.</span><span class="sxs-lookup"><span data-stu-id="7256b-127">The second line of code invokes the controller's `Details()` action method.</span></span> <span data-ttu-id="7256b-128">Por fim, a última linha de código verifica se a exibição retornada pela ação de `Details()` é a exibição de detalhes.</span><span class="sxs-lookup"><span data-stu-id="7256b-128">Finally, the last line of code checks whether or not the view returned by the `Details()` action is the Details view.</span></span>

<span data-ttu-id="7256b-129">A propriedade `ViewResult.ViewName` representa o nome da exibição retornada por um controlador.</span><span class="sxs-lookup"><span data-stu-id="7256b-129">The `ViewResult.ViewName` property represents the name of the view returned by a controller.</span></span> <span data-ttu-id="7256b-130">Um grande aviso sobre como testar essa propriedade.</span><span class="sxs-lookup"><span data-stu-id="7256b-130">One big warning about testing this property.</span></span> <span data-ttu-id="7256b-131">Há duas maneiras de um controlador poder retornar uma exibição.</span><span class="sxs-lookup"><span data-stu-id="7256b-131">There are two ways that a controller can return a view.</span></span> <span data-ttu-id="7256b-132">Um controlador pode retornar explicitamente uma exibição como esta:</span><span class="sxs-lookup"><span data-stu-id="7256b-132">A controller can explicitly return a view like this:</span></span>

[!code-csharp[Main](creating-unit-tests-for-asp-net-mvc-applications-cs/samples/sample3.cs)]

<span data-ttu-id="7256b-133">Como alternativa, o nome da exibição pode ser inferido a partir do nome da ação do controlador como esta:</span><span class="sxs-lookup"><span data-stu-id="7256b-133">Alternatively, the name of the view can be inferred from the name of the controller action like this:</span></span>

[!code-csharp[Main](creating-unit-tests-for-asp-net-mvc-applications-cs/samples/sample4.cs)]

<span data-ttu-id="7256b-134">Essa ação do controlador também retorna uma exibição chamada `Details`.</span><span class="sxs-lookup"><span data-stu-id="7256b-134">This controller action also returns a view named `Details`.</span></span> <span data-ttu-id="7256b-135">No entanto, o nome da exibição é inferido do nome da ação.</span><span class="sxs-lookup"><span data-stu-id="7256b-135">However, the name of the view is inferred from the action name.</span></span> <span data-ttu-id="7256b-136">Se desejar testar o nome da exibição, você deverá retornar explicitamente o nome da exibição da ação do controlador.</span><span class="sxs-lookup"><span data-stu-id="7256b-136">If you want to test the view name, then you must explicitly return the view name from the controller action.</span></span>

<span data-ttu-id="7256b-137">Você pode executar o teste de unidade na Listagem 2 inserindo a combinação de teclado **Ctrl-R, a** ou clicando no botão **executar todos os testes na solução** (veja a Figura 1).</span><span class="sxs-lookup"><span data-stu-id="7256b-137">You can run the unit test in Listing 2 by either entering the keyboard combination **Ctrl-R, A** or by clicking the **Run All Tests in Solution** button (see Figure 1).</span></span> <span data-ttu-id="7256b-138">Se o teste passar, você verá a janela Resultados de Teste na Figura 2.</span><span class="sxs-lookup"><span data-stu-id="7256b-138">If the test passes, you'll see the Test Results window in Figure 2.</span></span>

<span data-ttu-id="7256b-139">[![executar todos os testes na solução](creating-unit-tests-for-asp-net-mvc-applications-cs/_static/image2.png)](creating-unit-tests-for-asp-net-mvc-applications-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="7256b-139">[![Run All Tests in Solution](creating-unit-tests-for-asp-net-mvc-applications-cs/_static/image2.png)](creating-unit-tests-for-asp-net-mvc-applications-cs/_static/image1.png)</span></span>

<span data-ttu-id="7256b-140">**Figura 01**: executar todos os testes na solução ([clique para exibir a imagem em tamanho normal](creating-unit-tests-for-asp-net-mvc-applications-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="7256b-140">**Figure 01**: Run All Tests in Solution ([Click to view full-size image](creating-unit-tests-for-asp-net-mvc-applications-cs/_static/image3.png))</span></span>

<span data-ttu-id="7256b-141">[![êxito!](creating-unit-tests-for-asp-net-mvc-applications-cs/_static/image5.png)](creating-unit-tests-for-asp-net-mvc-applications-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="7256b-141">[![Success!](creating-unit-tests-for-asp-net-mvc-applications-cs/_static/image5.png)](creating-unit-tests-for-asp-net-mvc-applications-cs/_static/image4.png)</span></span>

<span data-ttu-id="7256b-142">**Figura 02**: sucesso!</span><span class="sxs-lookup"><span data-stu-id="7256b-142">**Figure 02**: Success!</span></span> <span data-ttu-id="7256b-143">([Clique para exibir a imagem em tamanho normal](creating-unit-tests-for-asp-net-mvc-applications-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="7256b-143">([Click to view full-size image](creating-unit-tests-for-asp-net-mvc-applications-cs/_static/image6.png))</span></span>

## <a name="testing-the-view-data-returned-by-a-controller"></a><span data-ttu-id="7256b-144">Testando os dados de exibição retornados por um controlador</span><span class="sxs-lookup"><span data-stu-id="7256b-144">Testing the View Data returned by a Controller</span></span>

<span data-ttu-id="7256b-145">Um controlador MVC passa dados para uma exibição usando algo chamado *`View Data`* .</span><span class="sxs-lookup"><span data-stu-id="7256b-145">An MVC controller passes data to a view by using something called *`View Data`*.</span></span> <span data-ttu-id="7256b-146">Por exemplo, imagine que você deseja exibir os detalhes de um produto específico ao invocar a ação de `ProductController Details()`.</span><span class="sxs-lookup"><span data-stu-id="7256b-146">For example, imagine that you want to display the details for a particular product when you invoke the `ProductController Details()` action.</span></span> <span data-ttu-id="7256b-147">Nesse caso, você pode criar uma instância de uma classe de `Product` (definida em seu modelo) e passar a instância para a exibição de `Details` aproveitando o `View Data`.</span><span class="sxs-lookup"><span data-stu-id="7256b-147">In that case, you can create an instance of a `Product` class (defined in your model) and pass the instance to the `Details` view by taking advantage of `View Data`.</span></span>

<span data-ttu-id="7256b-148">A `ProductController` modificada na Listagem 3 inclui uma ação de `Details()` atualizada que retorna um produto.</span><span class="sxs-lookup"><span data-stu-id="7256b-148">The modified `ProductController` in Listing 3 includes an updated `Details()` action that returns a Product.</span></span>

<span data-ttu-id="7256b-149">**Listagem 3 – `ProductController.cs`**</span><span class="sxs-lookup"><span data-stu-id="7256b-149">**Listing 3 – `ProductController.cs`**</span></span>

[!code-csharp[Main](creating-unit-tests-for-asp-net-mvc-applications-cs/samples/sample5.cs)]

<span data-ttu-id="7256b-150">Primeiro, a ação `Details()` cria uma nova instância da classe `Product` que representa um computador laptop.</span><span class="sxs-lookup"><span data-stu-id="7256b-150">First, the `Details()` action creates a new instance of the `Product` class that represents a laptop computer.</span></span> <span data-ttu-id="7256b-151">Em seguida, a instância da classe `Product` é passada como o segundo parâmetro para o método `View()`.</span><span class="sxs-lookup"><span data-stu-id="7256b-151">Next, the instance of the `Product` class is passed as the second parameter to the `View()` method.</span></span>

<span data-ttu-id="7256b-152">Você pode escrever testes de unidade para testar se os dados esperados estão contidos na exibição de dados.</span><span class="sxs-lookup"><span data-stu-id="7256b-152">You can write unit tests to test whether the expected data is contained in view data.</span></span> <span data-ttu-id="7256b-153">O teste de unidade na Listagem 4 testa se um produto que representa um computador laptop é retornado quando você chama o método de ação `ProductController Details()`.</span><span class="sxs-lookup"><span data-stu-id="7256b-153">The unit test in Listing 4 tests whether or not a Product representing a laptop computer is returned when you call the `ProductController Details()` action method.</span></span>

<span data-ttu-id="7256b-154">**Listagem 4 – `ProductControllerTest.cs`**</span><span class="sxs-lookup"><span data-stu-id="7256b-154">**Listing 4 – `ProductControllerTest.cs`**</span></span>

[!code-csharp[Main](creating-unit-tests-for-asp-net-mvc-applications-cs/samples/sample6.cs)]

<span data-ttu-id="7256b-155">Na Listagem 4, o método `TestDetailsView()` testa os dados de exibição retornados invocando o método `Details()`.</span><span class="sxs-lookup"><span data-stu-id="7256b-155">In Listing 4, the `TestDetailsView()` method tests the View Data returned by invoking the `Details()` method.</span></span> <span data-ttu-id="7256b-156">O `ViewData` é exposto como uma propriedade no `ViewResult` retornado pela invocação do método `Details()`.</span><span class="sxs-lookup"><span data-stu-id="7256b-156">The `ViewData` is exposed as a property on the `ViewResult` returned by invoking the `Details()` method.</span></span> <span data-ttu-id="7256b-157">A propriedade `ViewData.Model` contém o produto passado para a exibição.</span><span class="sxs-lookup"><span data-stu-id="7256b-157">The `ViewData.Model` property contains the product passed to the view.</span></span> <span data-ttu-id="7256b-158">O teste simplesmente verifica se o produto contido na exibição de dados tem o nome laptop.</span><span class="sxs-lookup"><span data-stu-id="7256b-158">The test simply verifies that the product contained in the View Data has the name Laptop.</span></span>

## <a name="testing-the-action-result-returned-by-a-controller"></a><span data-ttu-id="7256b-159">Testando o resultado da ação retornado por um controlador</span><span class="sxs-lookup"><span data-stu-id="7256b-159">Testing the Action Result returned by a Controller</span></span>

<span data-ttu-id="7256b-160">Uma ação de controlador mais complexa pode retornar tipos diferentes de resultados de ação, dependendo dos valores dos parâmetros passados para a ação do controlador.</span><span class="sxs-lookup"><span data-stu-id="7256b-160">A more complex controller action might return different types of action results depending on the values of the parameters passed to the controller action.</span></span> <span data-ttu-id="7256b-161">Uma ação do controlador pode retornar uma variedade de tipos de resultados de ação, incluindo um `ViewResult`, `RedirectToRouteResult`ou `JsonResult`.</span><span class="sxs-lookup"><span data-stu-id="7256b-161">A controller action can return a variety of types of action results including a `ViewResult`, `RedirectToRouteResult`, or `JsonResult`.</span></span>

<span data-ttu-id="7256b-162">Por exemplo, a ação `Details()` modificada na listagem 5 retorna a exibição `Details` quando você passa uma ID de produto válida para a ação.</span><span class="sxs-lookup"><span data-stu-id="7256b-162">For example, the modified `Details()` action in Listing 5 returns the `Details` view when you pass a valid product Id to the action.</span></span> <span data-ttu-id="7256b-163">Se você passar uma ID de produto inválida – uma ID com um valor menor que 1--você será redirecionado para a ação de `Index()`.</span><span class="sxs-lookup"><span data-stu-id="7256b-163">If you pass an invalid product Id -- an Id with a value less than 1 -- then you are redirected to the `Index()` action.</span></span>

<span data-ttu-id="7256b-164">**Listagem 5 – `ProductController.cs`**</span><span class="sxs-lookup"><span data-stu-id="7256b-164">**Listing 5 – `ProductController.cs`**</span></span>

[!code-csharp[Main](creating-unit-tests-for-asp-net-mvc-applications-cs/samples/sample7.cs)]

<span data-ttu-id="7256b-165">Você pode testar o comportamento da ação de `Details()` com o teste de unidade na Listagem 6.</span><span class="sxs-lookup"><span data-stu-id="7256b-165">You can test the behavior of the `Details()` action with the unit test in Listing 6.</span></span> <span data-ttu-id="7256b-166">O teste de unidade na Listagem 6 verifica se você é redirecionado para a exibição `Index` quando uma ID com o valor-1 é passada para o método `Details()`.</span><span class="sxs-lookup"><span data-stu-id="7256b-166">The unit test in Listing 6 verifies that you are redirected to the `Index` view when an Id with the value -1 is passed to the `Details()` method.</span></span>

<span data-ttu-id="7256b-167">**Listagem 6 – `ProductControllerTest.cs`**</span><span class="sxs-lookup"><span data-stu-id="7256b-167">**Listing 6 – `ProductControllerTest.cs`**</span></span>

[!code-csharp[Main](creating-unit-tests-for-asp-net-mvc-applications-cs/samples/sample8.cs)]

<span data-ttu-id="7256b-168">Quando você chama o método `RedirectToAction()` em uma ação do controlador, a ação do controlador retorna um `RedirectToRouteResult`.</span><span class="sxs-lookup"><span data-stu-id="7256b-168">When you call the `RedirectToAction()` method in a controller action, the controller action returns a `RedirectToRouteResult`.</span></span> <span data-ttu-id="7256b-169">O teste verifica se o `RedirectToRouteResult` redirecionará o usuário para uma ação de controlador chamada `Index`.</span><span class="sxs-lookup"><span data-stu-id="7256b-169">The test checks whether the `RedirectToRouteResult` will redirect the user to a controller action named `Index`.</span></span>

## <a name="summary"></a><span data-ttu-id="7256b-170">Resumo</span><span class="sxs-lookup"><span data-stu-id="7256b-170">Summary</span></span>

<span data-ttu-id="7256b-171">Neste tutorial, você aprendeu a criar testes de unidade para ações do controlador MVC.</span><span class="sxs-lookup"><span data-stu-id="7256b-171">In this tutorial, you learned how to build unit tests for MVC controller actions.</span></span> <span data-ttu-id="7256b-172">Primeiro, você aprendeu como verificar se a exibição correta é retornada por uma ação do controlador.</span><span class="sxs-lookup"><span data-stu-id="7256b-172">First, you learned how to verify whether the right view is returned by a controller action.</span></span> <span data-ttu-id="7256b-173">Você aprendeu a usar a propriedade `ViewResult.ViewName` para verificar o nome de uma exibição.</span><span class="sxs-lookup"><span data-stu-id="7256b-173">You learned how to use the `ViewResult.ViewName` property to verify the name of a view.</span></span>

<span data-ttu-id="7256b-174">Em seguida, examinamos como você pode testar o conteúdo de `View Data`.</span><span class="sxs-lookup"><span data-stu-id="7256b-174">Next, we examined how you can test the contents of `View Data`.</span></span> <span data-ttu-id="7256b-175">Você aprendeu como verificar se o produto correto foi retornado em `View Data` depois de chamar uma ação do controlador.</span><span class="sxs-lookup"><span data-stu-id="7256b-175">You learned how to check whether the right product was returned in `View Data` after calling a controller action.</span></span>

<span data-ttu-id="7256b-176">Por fim, discutimos como você pode testar se diferentes tipos de resultados de ação são retornados de uma ação do controlador.</span><span class="sxs-lookup"><span data-stu-id="7256b-176">Finally, we discussed how you can test whether different types of action results are returned from a controller action.</span></span> <span data-ttu-id="7256b-177">Você aprendeu como testar se um controlador retorna um `ViewResult` ou um `RedirectToRouteResult`.</span><span class="sxs-lookup"><span data-stu-id="7256b-177">You learned how to test whether a controller returns a `ViewResult` or a `RedirectToRouteResult`.</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="7256b-178">Próximo</span><span class="sxs-lookup"><span data-stu-id="7256b-178">Next</span></span>](creating-unit-tests-for-asp-net-mvc-applications-vb.md)
