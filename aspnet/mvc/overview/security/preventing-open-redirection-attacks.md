---
uid: mvc/overview/security/preventing-open-redirection-attacks
title: Impedindo ataques de redirecionamentoC#aberto () | Microsoft Docs
author: jongalloway
description: Este tutorial explica como você pode impedir ataques de redirecionamento abertos em seus aplicativos MVC do ASP.NET. Este tutorial discute as alterações que foram feitas...
ms.author: riande
ms.date: 02/27/2014
ms.assetid: 69fb02e0-f5b7-4c35-878c-fa87164fc785
msc.legacyurl: /mvc/overview/security/preventing-open-redirection-attacks
msc.type: authoredcontent
ms.openlocfilehash: cfa635d4fd14d031993c5b452325cbe334f82dc2
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78538167"
---
# <a name="preventing-open-redirection-attacks-c"></a><span data-ttu-id="c7bfe-104">Impedir ataques de redirecionamento aberto (C#)</span><span class="sxs-lookup"><span data-stu-id="c7bfe-104">Preventing Open Redirection Attacks (C#)</span></span>

<span data-ttu-id="c7bfe-105">por [Jon Galloway](https://github.com/jongalloway)</span><span class="sxs-lookup"><span data-stu-id="c7bfe-105">by [Jon Galloway](https://github.com/jongalloway)</span></span>

> <span data-ttu-id="c7bfe-106">Este tutorial explica como você pode impedir ataques de redirecionamento abertos em seus aplicativos MVC do ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-106">This tutorial explains how you can prevent open redirection attacks in your ASP.NET MVC applications.</span></span> <span data-ttu-id="c7bfe-107">Este tutorial discute as alterações feitas no AccountController no ASP.NET MVC 3 e demonstra como você pode aplicar essas alterações em seus aplicativos ASP.NET MVC 1,0 e 2 existentes.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-107">This tutorial discusses the changes that have been made in the AccountController in ASP.NET MVC 3 and demonstrates how you can apply these changes in your existing ASP.NET MVC 1.0 and 2 applications.</span></span>

## <a name="what-is-an-open-redirection-attack"></a><span data-ttu-id="c7bfe-108">O que é um ataque de redirecionamento aberto?</span><span class="sxs-lookup"><span data-stu-id="c7bfe-108">What is an Open Redirection Attack?</span></span>

<span data-ttu-id="c7bfe-109">Qualquer aplicativo Web que redireciona para uma URL especificada por meio da solicitação, como a QueryString ou os dados de formulário, pode ser adulterado para redirecionar os usuários para uma URL externa e mal-intencionada.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-109">Any web application that redirects to a URL that is specified via the request such as the querystring or form data can potentially be tampered with to redirect users to an external, malicious URL.</span></span> <span data-ttu-id="c7bfe-110">Essa violação é chamada de ataque de redirecionamento aberto.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-110">This tampering is called an open redirection attack.</span></span>

<span data-ttu-id="c7bfe-111">Sempre que a lógica do aplicativo redireciona para uma URL especificada, você deve verificar se a URL de redirecionamento não foi violada.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-111">Whenever your application logic redirects to a specified URL, you must verify that the redirection URL hasn't been tampered with.</span></span> <span data-ttu-id="c7bfe-112">O logon usado no AccountController padrão para o ASP.NET MVC 1,0 e o ASP.NET MVC 2 é vulnerável a ataques de redirecionamento abertos.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-112">The login used in the default AccountController for both ASP.NET MVC 1.0 and ASP.NET MVC 2 is vulnerable to open redirection attacks.</span></span> <span data-ttu-id="c7bfe-113">Felizmente, é fácil atualizar seus aplicativos existentes para usar as correções da visualização do ASP.NET MVC 3.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-113">Fortunately, it is easy to update your existing applications to use the corrections from the ASP.NET MVC 3 Preview.</span></span>

<span data-ttu-id="c7bfe-114">Para entender a vulnerabilidade, vejamos como o redirecionamento de logon funciona em um projeto de aplicativo Web do ASP.NET MVC 2 padrão.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-114">To understand the vulnerability, let's look at how the login redirection works in a default ASP.NET MVC 2 Web Application project.</span></span> <span data-ttu-id="c7bfe-115">Neste aplicativo, a tentativa de visitar uma ação do controlador que tenha o atributo [autorizar] redirecionará usuários não autorizados para a exibição/Account/LogOn.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-115">In this application, attempting to visit a controller action that has the [Authorize] attribute will redirect unauthorized users to the /Account/LogOn view.</span></span> <span data-ttu-id="c7bfe-116">Esse redirecionamento para/Account/LogOn incluirá um parâmetro returnUrl QueryString para que o usuário possa ser retornado para a URL solicitada originalmente depois que tiver feito logon com êxito.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-116">This redirect to /Account/LogOn will include a returnUrl querystring parameter so that the user can be returned to the originally requested URL after they have successfully logged in.</span></span>

<span data-ttu-id="c7bfe-117">Na captura de tela abaixo, podemos ver que uma tentativa de acessar a exibição/Account/ChangePassword quando não fez logon resulta em um redirecionamento para/Account/LogOn? ReturnUrl =% 2fAccount% 2fChangePassword% 2F.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-117">In the screenshot below, we can see that an attempt to access the /Account/ChangePassword view when not logged in results in a redirect to /Account/LogOn?ReturnUrl=%2fAccount%2fChangePassword%2f.</span></span>

[![](preventing-open-redirection-attacks/_static/image2.png)](preventing-open-redirection-attacks/_static/image1.png)

<span data-ttu-id="c7bfe-118">**Figura 01**: página de logon com um redirecionamento aberto</span><span class="sxs-lookup"><span data-stu-id="c7bfe-118">**Figure 01**: Login page with an open redirection</span></span>

<span data-ttu-id="c7bfe-119">Como o parâmetro ReturnUrl QueryString não é validado, um invasor pode modificá-lo para injetar qualquer endereço URL no parâmetro para conduzir um ataque de redirecionamento aberto.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-119">Since the ReturnUrl querystring parameter is not validated, an attacker can modify it to inject any URL address into the parameter to conduct an open redirection attack.</span></span> <span data-ttu-id="c7bfe-120">Para demonstrar isso, podemos modificar o parâmetro ReturnUrl para [http://bing.com](http://bing.com), de modo que a URL de logon resultante será/Account/logon? ReturnUrl =<http://www.bing.com/>.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-120">To demonstrate this, we can modify the ReturnUrl parameter to [http://bing.com](http://bing.com), so the resulting login URL will be /Account/LogOn?ReturnUrl=<http://www.bing.com/>.</span></span> <span data-ttu-id="c7bfe-121">Após fazer logon com êxito no site, somos redirecionados para [http://bing.com](http://bing.com).</span><span class="sxs-lookup"><span data-stu-id="c7bfe-121">Upon successfully logging in to the site, we are redirected to [http://bing.com](http://bing.com).</span></span> <span data-ttu-id="c7bfe-122">Uma vez que esse redirecionamento não é validado, ele pode apontar para um site mal-intencionado que tenta enganar o usuário.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-122">Since this redirection is not validated, it could instead point to a malicious site that attempts to trick the user.</span></span>

### <a name="a-more-complex-open-redirection-attack"></a><span data-ttu-id="c7bfe-123">Um ataque de redirecionamento aberto mais complexo</span><span class="sxs-lookup"><span data-stu-id="c7bfe-123">A more complex Open Redirection Attack</span></span>

<span data-ttu-id="c7bfe-124">Os ataques de redirecionamento abertos são especialmente perigosos porque um invasor sabe que estamos tentando fazer logon em um site específico, o que nos torna vulnerável a um [ataque de phishing](https://www.microsoft.com/protect/fraud/phishing/symptoms.aspx).</span><span class="sxs-lookup"><span data-stu-id="c7bfe-124">Open redirection attacks are especially dangerous because an attacker knows that we're trying to log into a specific website, which makes us vulnerable to a [phishing attack](https://www.microsoft.com/protect/fraud/phishing/symptoms.aspx).</span></span> <span data-ttu-id="c7bfe-125">Por exemplo, um invasor pode enviar emails mal-intencionados aos usuários do site em uma tentativa de capturar suas senhas.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-125">For example, an attacker could send malicious emails to website users in an attempt to capture their passwords.</span></span> <span data-ttu-id="c7bfe-126">Vejamos como isso funcionaria no site do NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-126">Let's look at how this would work on the NerdDinner site.</span></span> <span data-ttu-id="c7bfe-127">(Observe que o site NerdDinner ao vivo foi atualizado para proteger contra ataques de redirecionamento abertos.)</span><span class="sxs-lookup"><span data-stu-id="c7bfe-127">(Note that the live NerdDinner site has been updated to protect against open redirection attacks.)</span></span>

<span data-ttu-id="c7bfe-128">Primeiro, um invasor nos envia um link para a página de logon no NerdDinner que inclui um redirecionamento para sua página forjada:</span><span class="sxs-lookup"><span data-stu-id="c7bfe-128">First, an attacker sends us a link to the login page on NerdDinner that includes a redirect to their forged page:</span></span>

[http://nerddinner.com/Account/LogOn?returnUrl=http://nerddiner.com/Account/LogOn](http://nerddinner.com/Account/LogOn?returnUrl=http://nerddiner.com/Account/LogOn)

<span data-ttu-id="c7bfe-129">Observe que a URL de retorno aponta para nerddiner.com, que não tem um "n" do jantar de palavras.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-129">Note that the return URL points to nerddiner.com, which is missing an "n" from the word dinner.</span></span> <span data-ttu-id="c7bfe-130">Neste exemplo, esse é um domínio que o invasor controla.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-130">In this example, this is a domain that the attacker controls.</span></span> <span data-ttu-id="c7bfe-131">Quando acessamos o link acima, vamos para a página de logon NerdDinner.com legítima.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-131">When we access the above link, we're taken to the legitimate NerdDinner.com login page.</span></span>

[![](preventing-open-redirection-attacks/_static/image4.png)](preventing-open-redirection-attacks/_static/image3.png)

<span data-ttu-id="c7bfe-132">**Figura 02**: página de logon do NerdDinner com um redirecionamento aberto</span><span class="sxs-lookup"><span data-stu-id="c7bfe-132">**Figure 02**: NerdDinner login page with an open redirection</span></span>

<span data-ttu-id="c7bfe-133">Quando fazemos logon corretamente, a ação de LogOn do ASP.NET MVC AccountController redireciona-nos para a URL especificada no parâmetro returnUrl QueryString.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-133">When we correctly log in, the ASP.NET MVC AccountController's LogOn action redirects us to the URL specified in the returnUrl querystring parameter.</span></span> <span data-ttu-id="c7bfe-134">Nesse caso, é a URL que o invasor inseriu, que é [http://nerddiner.com/Account/LogOn](http://nerddiner.com/Account/LogOn).</span><span class="sxs-lookup"><span data-stu-id="c7bfe-134">In this case, it's the URL that the attacker has entered, which is [http://nerddiner.com/Account/LogOn](http://nerddiner.com/Account/LogOn).</span></span> <span data-ttu-id="c7bfe-135">A menos que seja extremamente olhar, é muito provável que não Notemos isso, especialmente porque o invasor tem cuidado para se certificar de que a página forjada é exatamente como a página de logon legítima.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-135">Unless we're extremely watchful, it's very likely we won't notice this, especially because the attacker has been careful to make sure that their forged page looks exactly like the legitimate login page.</span></span> <span data-ttu-id="c7bfe-136">Essa página de logon inclui uma mensagem de erro solicitando que façamos logon novamente.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-136">This login page includes an error message requesting that we login again.</span></span> <span data-ttu-id="c7bfe-137">Atarefado, devemos ter digitado a nossa senha inalguma.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-137">Clumsy us, we must have mistyped our password.</span></span>

[![](preventing-open-redirection-attacks/_static/image6.png)](preventing-open-redirection-attacks/_static/image5.png)

<span data-ttu-id="c7bfe-138">**Figura 03**: tela de logon do NerdDinner forjado</span><span class="sxs-lookup"><span data-stu-id="c7bfe-138">**Figure 03**: Forged NerdDinner Login screen</span></span>

<span data-ttu-id="c7bfe-139">Quando redigitamos nosso nome de usuário e senha, a página de logon forjado salva as informações e nos envia de volta para o site NerdDinner.com legítimo.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-139">When we retype our user name and password, the forged login page saves the information and sends us back to the legitimate NerdDinner.com site.</span></span> <span data-ttu-id="c7bfe-140">Neste ponto, o site do NerdDinner.com já se autenticou, portanto, a página de logon forjada pode redirecionar diretamente para essa página.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-140">At this point, the NerdDinner.com site has already authenticated us, so the forged login page can redirect directly to that page.</span></span> <span data-ttu-id="c7bfe-141">O resultado final é que o invasor tem nosso nome de usuário e senha, e não estamos cientes de que fornecemos a eles.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-141">The end result is that the attacker has our user name and password, and we are unaware that we've provided it to them.</span></span>

## <a name="looking-at-the-vulnerable-code-in-the-accountcontroller-logon-action"></a><span data-ttu-id="c7bfe-142">Examinando o código vulnerável na ação de LogOn do AccountController</span><span class="sxs-lookup"><span data-stu-id="c7bfe-142">Looking at the vulnerable code in the AccountController LogOn Action</span></span>

<span data-ttu-id="c7bfe-143">O código para a ação de LogOn em um aplicativo ASP.NET MVC 2 é mostrado abaixo.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-143">The code for the LogOn action in an ASP.NET MVC 2 application is shown below.</span></span> <span data-ttu-id="c7bfe-144">Observe que, após um logon bem-sucedido, o controlador retorna um redirecionamento para a returnUrl.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-144">Note that upon a successful login, the controller returns a redirect to the returnUrl.</span></span> <span data-ttu-id="c7bfe-145">Você pode ver que nenhuma validação está sendo executada em relação ao parâmetro returnUrl.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-145">You can see that no validation is being performed against the returnUrl parameter.</span></span>

<span data-ttu-id="c7bfe-146">**Listagem 1 – ASP.NET a ação de LogOn MVC 2 no `AccountController.cs`**</span><span class="sxs-lookup"><span data-stu-id="c7bfe-146">**Listing 1 – ASP.NET MVC 2 LogOn action in `AccountController.cs`**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample1.cs)]

<span data-ttu-id="c7bfe-147">Agora, vejamos as alterações na ação de LogOn do ASP.NET MVC 3.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-147">Now let's look at the changes to the ASP.NET MVC 3 LogOn action.</span></span> <span data-ttu-id="c7bfe-148">Esse código foi alterado para validar o parâmetro returnUrl chamando um novo método na classe auxiliar System. Web. Mvc. URL chamada `IsLocalUrl()`.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-148">This code has been changed to validate the returnUrl parameter by calling a new method in the System.Web.Mvc.Url helper class named `IsLocalUrl()`.</span></span>

<span data-ttu-id="c7bfe-149">**Listagem 2 – ação de LogOn do ASP.NET MVC 3 no `AccountController.cs`**</span><span class="sxs-lookup"><span data-stu-id="c7bfe-149">**Listing 2 – ASP.NET MVC 3 LogOn action in `AccountController.cs`**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample2.cs)]

<span data-ttu-id="c7bfe-150">Isso foi alterado para validar o parâmetro de URL de retorno chamando um novo método na classe auxiliar System. Web. Mvc. URL, `IsLocalUrl()`.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-150">This has been changed to validate the return URL parameter by calling a new method in the System.Web.Mvc.Url helper class, `IsLocalUrl()`.</span></span>

## <a name="protecting-your-aspnet-mvc-10-and-mvc-2-applications"></a><span data-ttu-id="c7bfe-151">Protegendo seus aplicativos ASP.NET MVC 1,0 e MVC 2</span><span class="sxs-lookup"><span data-stu-id="c7bfe-151">Protecting Your ASP.NET MVC 1.0 and MVC 2 Applications</span></span>

<span data-ttu-id="c7bfe-152">Podemos aproveitar as alterações do ASP.NET MVC 3 em nossos aplicativos ASP.NET MVC 1,0 e 2 existentes adicionando o método auxiliar IsLocalUrl () e atualizando a ação de LogOn para validar o parâmetro returnUrl.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-152">We can take advantage of the ASP.NET MVC 3 changes in our existing ASP.NET MVC 1.0 and 2 applications by adding the IsLocalUrl() helper method and updating the LogOn action to validate the returnUrl parameter.</span></span>

<span data-ttu-id="c7bfe-153">O método UrlHelper IsLocalUrl (), na verdade, simplesmente chamando um método em System. Web. webpages, pois essa validação também é usada por aplicativos Páginas da Web do ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-153">The UrlHelper IsLocalUrl() method actually just calling into a method in System.Web.WebPages, as this validation is also used by ASP.NET Web Pages applications.</span></span>

<span data-ttu-id="c7bfe-154">**Listagem 3 – o método IsLocalUrl () do ASP.NET MVC 3 UrlHelper `class`**</span><span class="sxs-lookup"><span data-stu-id="c7bfe-154">**Listing 3 – The IsLocalUrl() method from the ASP.NET MVC 3 UrlHelper `class`**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample3.cs)]

<span data-ttu-id="c7bfe-155">O método IsUrlLocalToHost contém a lógica de validação real, conforme mostrado na Listagem 4.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-155">The IsUrlLocalToHost method contains the actual validation logic, as shown in Listing 4.</span></span>

<span data-ttu-id="c7bfe-156">**Listando o método 4 – IsUrlLocalToHost () da classe System. Web. webpages RequestExtensions**</span><span class="sxs-lookup"><span data-stu-id="c7bfe-156">**Listing 4 – IsUrlLocalToHost() method from the System.Web.WebPages RequestExtensions class**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample4.cs)]

<span data-ttu-id="c7bfe-157">Em nosso aplicativo ASP.NET MVC 1,0 ou 2, adicionaremos um método IsLocalUrl () ao AccountController, mas você será incentivado a adicioná-lo a uma classe auxiliar separada, se possível.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-157">In our ASP.NET MVC 1.0 or 2 application, we'll add a IsLocalUrl() method to the AccountController, but you're encouraged to add it to a separate helper class if possible.</span></span> <span data-ttu-id="c7bfe-158">Vamos fazer duas pequenas alterações na versão ASP.NET MVC 3 do IsLocalUrl () para que ela funcione dentro do AccountController.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-158">We will make two small changes to the ASP.NET MVC 3 version of IsLocalUrl() so that it will work inside the AccountController.</span></span> <span data-ttu-id="c7bfe-159">Primeiro, vamos alterá-lo de um método público para um método particular, já que os métodos públicos nos controladores podem ser acessados como ações do controlador.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-159">First, we'll change it from a public method to a private method, since public methods in controllers can be accessed as controller actions.</span></span> <span data-ttu-id="c7bfe-160">Em segundo lugar, modificaremos a chamada que verifica o host da URL no host do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-160">Second, we'll modify the call that checks the URL host against the application host.</span></span> <span data-ttu-id="c7bfe-161">Essa chamada faz uso de um campo RequestContext local na classe UrlHelper.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-161">That call makes use of a local RequestContext field in the UrlHelper class.</span></span> <span data-ttu-id="c7bfe-162">Em vez de usar isso. RequestContext. HttpContext. Request. URL. host, usaremos isso. Request. URL. host.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-162">Instead of using this.RequestContext.HttpContext.Request.Url.Host, we will use this.Request.Url.Host.</span></span> <span data-ttu-id="c7bfe-163">O código a seguir mostra o método IsLocalUrl () modificado para uso com uma classe de controlador nos aplicativos ASP.NET MVC 1,0 e 2.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-163">The following code shows the modified IsLocalUrl() method for use with a controller class in ASP.NET MVC 1.0 and 2 applications.</span></span>

<span data-ttu-id="c7bfe-164">**Listagem 5 – método IsLocalUrl (), que é modificado para uso com uma classe de controlador MVC**</span><span class="sxs-lookup"><span data-stu-id="c7bfe-164">**Listing 5 – IsLocalUrl() method, which is modified for use with an MVC Controller class**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample5.cs)]

<span data-ttu-id="c7bfe-165">Agora que o método IsLocalUrl () está em vigor, podemos chamá-lo da nossa ação de LogOn para validar o parâmetro returnUrl, conforme mostrado no código a seguir.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-165">Now that the IsLocalUrl() method is in place, we can call it from our LogOn action to validate the returnUrl parameter, as shown in the following code.</span></span>

<span data-ttu-id="c7bfe-166">**Listagem 6 – método de LogOn atualizado que valida o parâmetro returnUrl**</span><span class="sxs-lookup"><span data-stu-id="c7bfe-166">**Listing 6 – Updated LogOn method which validates the returnUrl parameter**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample6.cs)]

<span data-ttu-id="c7bfe-167">Agora, podemos testar um ataque de redirecionamento aberto ao tentar fazer logon usando uma URL de retorno externa.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-167">Now we can test an open redirection attack by attempting to log in using an external return URL.</span></span> <span data-ttu-id="c7bfe-168">Vamos usar/Account/LogOn? ReturnUrl =<http://www.bing.com/> novamente.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-168">Let's use /Account/LogOn?ReturnUrl=<http://www.bing.com/> again.</span></span>

[![](preventing-open-redirection-attacks/_static/image8.png)](preventing-open-redirection-attacks/_static/image7.png)

<span data-ttu-id="c7bfe-169">**Figura 04**: testando a ação de logon atualizada</span><span class="sxs-lookup"><span data-stu-id="c7bfe-169">**Figure 04**: Testing the updated LogOn Action</span></span>

<span data-ttu-id="c7bfe-170">Depois de fazer logon com êxito, somos redirecionados para a ação do controlador Home/index em vez da URL externa.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-170">After successfully logging in, we are redirected to the Home/Index Controller action rather than the external URL.</span></span>

[![](preventing-open-redirection-attacks/_static/image10.png)](preventing-open-redirection-attacks/_static/image9.png)

<span data-ttu-id="c7bfe-171">**Figura 05**: o ataque de redirecionamento de abertura é derrotado</span><span class="sxs-lookup"><span data-stu-id="c7bfe-171">**Figure 05**: Open Redirection attack defeated</span></span>

## <a name="summary"></a><span data-ttu-id="c7bfe-172">Resumo</span><span class="sxs-lookup"><span data-stu-id="c7bfe-172">Summary</span></span>

<span data-ttu-id="c7bfe-173">Os ataques de redirecionamento abertos podem ocorrer quando as URLs de redirecionamento são passadas como parâmetros na URL para um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-173">Open redirection attacks can occur when redirection URLs are passed as parameters in the URL for an application.</span></span> <span data-ttu-id="c7bfe-174">O modelo ASP.NET MVC 3 inclui código para proteger contra ataques de redirecionamento abertos.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-174">The ASP.NET MVC 3 template includes code to protect against open redirection attacks.</span></span> <span data-ttu-id="c7bfe-175">Você pode adicionar esse código com alguma modificação nos aplicativos ASP.NET MVC 1,0 e 2.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-175">You can add this code with some modification to ASP.NET MVC 1.0 and 2 applications.</span></span> <span data-ttu-id="c7bfe-176">Para proteger contra ataques de redirecionamento abertos ao fazer logon em aplicativos ASP.NET 1,0 e 2, adicione um método IsLocalUrl () e valide o parâmetro returnUrl na ação de LogOn.</span><span class="sxs-lookup"><span data-stu-id="c7bfe-176">To protect against open redirection attacks when logging into ASP.NET 1.0 and 2 applications, add a IsLocalUrl() method and validate the returnUrl parameter in the LogOn action.</span></span>
