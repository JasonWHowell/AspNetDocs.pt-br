---
uid: signalr/overview/older-versions/tutorial-server-broadcast-with-aspnet-signalr
title: 'Tutorial: transmissão de servidor com o Signalr 1. x do ASP.NET | Microsoft Docs'
author: bradygaster
description: Este tutorial mostra como criar um aplicativo Web que usa o Signalr ASP.NET para fornecer a funcionalidade de difusão do servidor. Difusão do servidor significa que Communic...
ms.author: bradyg
ms.date: 04/10/2013
ms.assetid: ab7b2554-956a-4f6d-b2a0-4ae0c62e8580
msc.legacyurl: /signalr/overview/older-versions/tutorial-server-broadcast-with-aspnet-signalr
msc.type: authoredcontent
ms.openlocfilehash: 68908be34f6b010e512677fe5f5e31bfdefab592
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78579404"
---
# <a name="tutorial-server-broadcast-with-aspnet-signalr-1x"></a><span data-ttu-id="d32eb-104">Tutorial: transmissão de servidor com o Signalr 1. x ASP.NET</span><span class="sxs-lookup"><span data-stu-id="d32eb-104">Tutorial: Server Broadcast with ASP.NET SignalR 1.x</span></span>

<span data-ttu-id="d32eb-105">por [Patrick Fletcher](https://github.com/pfletcher), [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="d32eb-105">by [Patrick Fletcher](https://github.com/pfletcher), [Tom Dykstra](https://github.com/tdykstra)</span></span>

[!INCLUDE [Consider ASP.NET Core SignalR](~/includes/signalr/signalr-version-disambiguation.md)]

> <span data-ttu-id="d32eb-106">Este tutorial mostra como criar um aplicativo Web que usa o Signalr ASP.NET para fornecer a funcionalidade de difusão do servidor.</span><span class="sxs-lookup"><span data-stu-id="d32eb-106">This tutorial shows how to create a web application that uses ASP.NET SignalR to provide server broadcast functionality.</span></span> <span data-ttu-id="d32eb-107">A difusão do servidor significa que as comunicações enviadas aos clientes são iniciadas pelo servidor.</span><span class="sxs-lookup"><span data-stu-id="d32eb-107">Server broadcast means that communications sent to clients are initiated by the server.</span></span> <span data-ttu-id="d32eb-108">Esse cenário requer uma abordagem de programação diferente dos cenários ponto a ponto, como aplicativos de chat, nos quais as comunicações enviadas aos clientes são iniciadas por um ou mais dos clientes.</span><span class="sxs-lookup"><span data-stu-id="d32eb-108">This scenario requires a different programming approach than peer-to-peer scenarios such as chat applications, in which communications sent to clients are initiated by one or more of the clients.</span></span>
> 
> <span data-ttu-id="d32eb-109">O aplicativo que você criará neste tutorial simula uma cotação de ações, um cenário típico para a funcionalidade de difusão do servidor.</span><span class="sxs-lookup"><span data-stu-id="d32eb-109">The application that you'll create in this tutorial simulates a stock ticker, a typical scenario for server broadcast functionality.</span></span>
> 
> <span data-ttu-id="d32eb-110">Comentários sobre o tutorial são bem-vindos.</span><span class="sxs-lookup"><span data-stu-id="d32eb-110">Comments on the tutorial are welcome.</span></span> <span data-ttu-id="d32eb-111">Se você tiver dúvidas que não estão diretamente relacionadas ao tutorial, poderá lançá-las no fórum do [signalr ASP.net](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) ou [stackoverflow.com](http://stackoverflow.com).</span><span class="sxs-lookup"><span data-stu-id="d32eb-111">If you have questions that are not directly related to the tutorial, you can post them to the [ASP.NET SignalR forum](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) or [StackOverflow.com](http://stackoverflow.com).</span></span>

## <a name="overview"></a><span data-ttu-id="d32eb-112">Visão geral</span><span class="sxs-lookup"><span data-stu-id="d32eb-112">Overview</span></span>

<span data-ttu-id="d32eb-113">O pacote NuGet [Microsoft. AspNet. signalr. Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) instala um exemplo de aplicativo de cotação de ações simuladas em um projeto do Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="d32eb-113">The [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) NuGet package installs a sample simulated stock ticker application in a Visual Studio project.</span></span> <span data-ttu-id="d32eb-114">Na primeira parte deste tutorial, você criará uma versão simplificada desse aplicativo a partir do zero.</span><span class="sxs-lookup"><span data-stu-id="d32eb-114">In the first part of this tutorial, you'll create a simplified version of that application from scratch.</span></span> <span data-ttu-id="d32eb-115">No restante do tutorial, você instalará o pacote NuGet e examinará os recursos adicionais e o código que ele cria.</span><span class="sxs-lookup"><span data-stu-id="d32eb-115">In the remainder of the tutorial, you'll install the NuGet package and review the additional features and code that it creates.</span></span>

<span data-ttu-id="d32eb-116">O aplicativo de cotação de ações é um representante de um tipo de aplicativo em tempo real no qual você deseja "enviar por push", ou transmitir, periodicamente notificações do servidor para todos os clientes conectados.</span><span class="sxs-lookup"><span data-stu-id="d32eb-116">The stock ticker application is a representative of a kind of real-time application in which you want to periodically "push," or broadcast, notifications from the server to all connected clients.</span></span>

<span data-ttu-id="d32eb-117">O aplicativo que você criará na primeira parte deste tutorial exibirá uma grade com dados de ações.</span><span class="sxs-lookup"><span data-stu-id="d32eb-117">The application that you'll build in the first part of this tutorial displays a grid with stock data.</span></span>

![Versão inicial do StockTicker](tutorial-server-broadcast-with-aspnet-signalr/_static/image1.png)

<span data-ttu-id="d32eb-119">Periodicamente, o servidor atualiza de forma aleatória os preços de ações e envia por push as atualizações para todos os clientes conectados.</span><span class="sxs-lookup"><span data-stu-id="d32eb-119">Periodically the server randomly updates stock prices and pushes the updates to all connected clients.</span></span> <span data-ttu-id="d32eb-120">No navegador, os números e símbolos nas colunas de **alteração** e **%** mudam dinamicamente em resposta a notificações do servidor.</span><span class="sxs-lookup"><span data-stu-id="d32eb-120">In the browser the numbers and symbols in the **Change** and **%** columns dynamically change in response to notifications from the server.</span></span> <span data-ttu-id="d32eb-121">Se você abrir navegadores adicionais para a mesma URL, todos eles mostrarão os mesmos dados e as mesmas alterações aos dados simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="d32eb-121">If you open additional browsers to the same URL, they all show the same data and the same changes to the data simultaneously.</span></span>

<span data-ttu-id="d32eb-122">Este tutorial contém as seguintes seções:</span><span class="sxs-lookup"><span data-stu-id="d32eb-122">This tutorial contains the following sections:</span></span>

- [<span data-ttu-id="d32eb-123">Pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="d32eb-123">Prerequisites</span></span>](#prerequisites)
- [<span data-ttu-id="d32eb-124">Criar o projeto</span><span class="sxs-lookup"><span data-stu-id="d32eb-124">Create the project</span></span>](#createproject)
- [<span data-ttu-id="d32eb-125">Adicionar os pacotes NuGet do Signalr</span><span class="sxs-lookup"><span data-stu-id="d32eb-125">Add the SignalR NuGet packages</span></span>](#nugetpackages)
- [<span data-ttu-id="d32eb-126">Configurar o código do servidor</span><span class="sxs-lookup"><span data-stu-id="d32eb-126">Set up the server code</span></span>](#server)
- [<span data-ttu-id="d32eb-127">Configurar o código do cliente</span><span class="sxs-lookup"><span data-stu-id="d32eb-127">Set up the client code</span></span>](#client)
- [<span data-ttu-id="d32eb-128">Testar o aplicativo</span><span class="sxs-lookup"><span data-stu-id="d32eb-128">Test the application</span></span>](#test)
- [<span data-ttu-id="d32eb-129">Habilitar o registro em log</span><span class="sxs-lookup"><span data-stu-id="d32eb-129">Enable logging</span></span>](#enablelogging)
- [<span data-ttu-id="d32eb-130">Instalar e examinar o exemplo de StockTicker completo</span><span class="sxs-lookup"><span data-stu-id="d32eb-130">Install and review the full StockTicker sample</span></span>](#fullsample)
- [<span data-ttu-id="d32eb-131">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="d32eb-131">Next steps</span></span>](#nextsteps)

> [!NOTE]
> <span data-ttu-id="d32eb-132">Se você não quiser trabalhar com as etapas de criação do aplicativo, poderá instalar o pacote Signalr. Sample em um novo projeto de **aplicativo Web ASP.net vazio** e ler essas etapas para obter explicações sobre o código.</span><span class="sxs-lookup"><span data-stu-id="d32eb-132">If you don't want to work through the steps of building the application, you can install the SignalR.Sample package in a new **Empty ASP.NET Web Application** project, and read through these steps to get explanations of the code.</span></span> <span data-ttu-id="d32eb-133">A primeira parte do tutorial aborda um subconjunto do código Signalr. Sample, e a segunda parte explica os principais recursos da funcionalidade adicional no pacote Signalr. Sample.</span><span class="sxs-lookup"><span data-stu-id="d32eb-133">The first part of the tutorial covers a subset of the SignalR.Sample code, and the second part explains key features of the additional functionality in the SignalR.Sample package.</span></span>

<a id="prerequisites"></a>

## <a name="prerequisites"></a><span data-ttu-id="d32eb-134">Prerequisites</span><span class="sxs-lookup"><span data-stu-id="d32eb-134">Prerequisites</span></span>

<span data-ttu-id="d32eb-135">Antes de começar, verifique se você tem o Visual Studio 2012 ou 2010 SP1 instalado no computador.</span><span class="sxs-lookup"><span data-stu-id="d32eb-135">Before you start, make sure that you have Visual Studio 2012 or 2010 SP1 installed on your computer.</span></span> <span data-ttu-id="d32eb-136">Se você não tiver o Visual Studio, consulte [downloads do ASP.net](https://www.asp.net/downloads) para obter o visual Studio 2012 Express for Web gratuito.</span><span class="sxs-lookup"><span data-stu-id="d32eb-136">If you don't have Visual Studio, see [ASP.NET Downloads](https://www.asp.net/downloads) to get the free Visual Studio 2012 Express for Web.</span></span>

<span data-ttu-id="d32eb-137">Se você tiver o Visual Studio 2010, verifique se o [NuGet](https://visualstudiogallery.msdn.microsoft.com/27077b70-9dad-4c64-adcf-c7cf6bc9970c) está instalado.</span><span class="sxs-lookup"><span data-stu-id="d32eb-137">If you have Visual Studio 2010, make sure that [NuGet](https://visualstudiogallery.msdn.microsoft.com/27077b70-9dad-4c64-adcf-c7cf6bc9970c) is installed.</span></span>

<a id="createproject"></a>

## <a name="create-the-project"></a><span data-ttu-id="d32eb-138">Criar o projeto</span><span class="sxs-lookup"><span data-stu-id="d32eb-138">Create the project</span></span>

1. <span data-ttu-id="d32eb-139">No menu **Arquivo**, clique em **Novo Projeto**.</span><span class="sxs-lookup"><span data-stu-id="d32eb-139">From the **File** menu click **New Project**.</span></span>
2. <span data-ttu-id="d32eb-140">Na caixa de diálogo **novo projeto** , expanda **C#** em **modelos** e selecione **Web**.</span><span class="sxs-lookup"><span data-stu-id="d32eb-140">In the **New Project** dialog box, expand **C#** under **Templates** and select **Web**.</span></span>
3. <span data-ttu-id="d32eb-141">Selecione o modelo de **aplicativo Web ASP.net vazio** , nomeie o Project *signalr. StockTicker*e clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="d32eb-141">Select the **ASP.NET Empty Web Application** template, name the project *SignalR.StockTicker*, and click **OK**.</span></span>

    ![Caixa de diálogo Novo Projeto](tutorial-server-broadcast-with-aspnet-signalr/_static/image2.png)

<a id="nugetpackages"></a>

## <a name="add-the-signalr-nuget-packages"></a><span data-ttu-id="d32eb-143">Adicionar os pacotes NuGet do Signalr</span><span class="sxs-lookup"><span data-stu-id="d32eb-143">Add the SignalR NuGet Packages</span></span>

### <a name="add-the-signalr-and-jquery-nuget-packages"></a><span data-ttu-id="d32eb-144">Adicionar os pacotes do Signalr e do NuGet do JQuery</span><span class="sxs-lookup"><span data-stu-id="d32eb-144">Add the SignalR and JQuery NuGet Packages</span></span>

<span data-ttu-id="d32eb-145">Você pode adicionar a funcionalidade do Signalr a um projeto instalando um pacote NuGet.</span><span class="sxs-lookup"><span data-stu-id="d32eb-145">You can add SignalR functionality to a project by installing a NuGet package.</span></span>

1. <span data-ttu-id="d32eb-146">Clique em **ferramentas | Gerenciador de pacotes NuGet | Console do Gerenciador de pacotes**.</span><span class="sxs-lookup"><span data-stu-id="d32eb-146">Click **Tools | NuGet Package Manager | Package Manager Console**.</span></span>
2. <span data-ttu-id="d32eb-147">Insira o comando a seguir no Gerenciador de pacotes.</span><span class="sxs-lookup"><span data-stu-id="d32eb-147">Enter the following command in the package manager.</span></span>

    [!code-powershell[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample1.ps1)]

    <span data-ttu-id="d32eb-148">O pacote do Signalr instala vários outros pacotes NuGet como dependências.</span><span class="sxs-lookup"><span data-stu-id="d32eb-148">The SignalR package installs a number of other NuGet packages as dependencies.</span></span> <span data-ttu-id="d32eb-149">Quando a instalação for concluída, você terá todos os componentes de cliente e servidor necessários para usar o Signalr em um aplicativo ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="d32eb-149">When the installation is finished you have all of the server and client components required to use SignalR in an ASP.NET application.</span></span>

<a id="server"></a>

## <a name="set-up-the-server-code"></a><span data-ttu-id="d32eb-150">Configurar o código de servidor</span><span class="sxs-lookup"><span data-stu-id="d32eb-150">Set up the server code</span></span>

<span data-ttu-id="d32eb-151">Nesta seção, você configura o código que é executado no servidor.</span><span class="sxs-lookup"><span data-stu-id="d32eb-151">In this section you set up the code that runs on the server.</span></span>

### <a name="create-the-stock-class"></a><span data-ttu-id="d32eb-152">Criar a classe Stock</span><span class="sxs-lookup"><span data-stu-id="d32eb-152">Create the Stock class</span></span>

<span data-ttu-id="d32eb-153">Comece criando a classe de modelo de estoque que você usará para armazenar e transmitir informações sobre um estoque.</span><span class="sxs-lookup"><span data-stu-id="d32eb-153">You begin by creating the Stock model class that you'll use to store and transmit information about a stock.</span></span>

1. <span data-ttu-id="d32eb-154">Crie um novo arquivo de classe na pasta do projeto, nomeie-o *stock.cs*e substitua o código do modelo pelo código a seguir:</span><span class="sxs-lookup"><span data-stu-id="d32eb-154">Create a new class file in the project folder, name it *Stock.cs*, and then replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample2.cs)]

    <span data-ttu-id="d32eb-155">As duas propriedades que você definirá quando criar ações serão o símbolo (por exemplo, MSFT para Microsoft) e o preço.</span><span class="sxs-lookup"><span data-stu-id="d32eb-155">The two properties that you'll set when you create stocks are the Symbol (for example, MSFT for Microsoft) and the Price.</span></span> <span data-ttu-id="d32eb-156">As outras propriedades dependem de como e quando você define o preço.</span><span class="sxs-lookup"><span data-stu-id="d32eb-156">The other properties depend on how and when you set Price.</span></span> <span data-ttu-id="d32eb-157">Na primeira vez que você definir o preço, o valor será propagado para DayOpen.</span><span class="sxs-lookup"><span data-stu-id="d32eb-157">The first time you set Price, the value gets propagated to DayOpen.</span></span> <span data-ttu-id="d32eb-158">Os tempos subsequentes quando você define o preço, os valores da propriedade Change e PercentChange são calculados com base na diferença entre Price e DayOpen.</span><span class="sxs-lookup"><span data-stu-id="d32eb-158">Subsequent times when you set Price, the Change and PercentChange property values are calculated based on the difference between Price and DayOpen.</span></span>

### <a name="create-the-stockticker-and-stocktickerhub-classes"></a><span data-ttu-id="d32eb-159">Criar as classes StockTicker e StockTickerHub</span><span class="sxs-lookup"><span data-stu-id="d32eb-159">Create the StockTicker and StockTickerHub classes</span></span>

<span data-ttu-id="d32eb-160">Você usará a API do Hub do Signalr para lidar com a interação de servidor para cliente.</span><span class="sxs-lookup"><span data-stu-id="d32eb-160">You'll use the SignalR Hub API to handle server-to-client interaction.</span></span> <span data-ttu-id="d32eb-161">Uma classe StockTickerHub que deriva da classe Hub do Signalr tratará conexões de recebimento e chamadas de método de clientes.</span><span class="sxs-lookup"><span data-stu-id="d32eb-161">A StockTickerHub class that derives from the SignalR Hub class will handle receiving connections and method calls from clients.</span></span> <span data-ttu-id="d32eb-162">Você também precisa manter os dados de estoque e executar um objeto de timer para disparar periodicamente as atualizações de preço, independentemente das conexões de cliente.</span><span class="sxs-lookup"><span data-stu-id="d32eb-162">You also need to maintain stock data and run a Timer object to periodically trigger price updates, independently of client connections.</span></span> <span data-ttu-id="d32eb-163">Você não pode colocar essas funções em uma classe de Hub, pois as instâncias de Hub são transitórias.</span><span class="sxs-lookup"><span data-stu-id="d32eb-163">You can't put these functions in a Hub class, because Hub instances are transient.</span></span> <span data-ttu-id="d32eb-164">Uma instância de classe de Hub é criada para cada operação no Hub, como conexões e chamadas do cliente para o servidor.</span><span class="sxs-lookup"><span data-stu-id="d32eb-164">A Hub class instance is created for each operation on the hub, such as connections and calls from the client to the server.</span></span> <span data-ttu-id="d32eb-165">Portanto, o mecanismo que mantém os dados de estoque, atualiza os preços e transmite as atualizações de preço deve ser executado em uma classe separada, que você chamará de StockTicker.</span><span class="sxs-lookup"><span data-stu-id="d32eb-165">So the mechanism that keeps stock data, updates prices, and broadcasts the price updates has to run in a separate class, which you'll name StockTicker.</span></span>

![Transmitindo do StockTicker](tutorial-server-broadcast-with-aspnet-signalr/_static/image4.png)

<span data-ttu-id="d32eb-167">Você deseja que apenas uma instância da classe StockTicker seja executada no servidor, portanto, você precisará configurar uma referência de cada instância do StockTickerHub para a instância StockTicker singleton.</span><span class="sxs-lookup"><span data-stu-id="d32eb-167">You only want one instance of the StockTicker class to run on the server, so you'll need to set up a reference from each StockTickerHub instance to the singleton StockTicker instance.</span></span> <span data-ttu-id="d32eb-168">A classe StockTicker precisa ser capaz de difundir para os clientes porque ele tem os dados de estoque e as atualizações de gatilho, mas StockTicker não é uma classe de Hub.</span><span class="sxs-lookup"><span data-stu-id="d32eb-168">The StockTicker class has to be able to broadcast to clients because it has the stock data and triggers updates, but StockTicker is not a Hub class.</span></span> <span data-ttu-id="d32eb-169">Portanto, a classe StockTicker precisa obter uma referência ao objeto de contexto de conexão do Hub Signalr.</span><span class="sxs-lookup"><span data-stu-id="d32eb-169">Therefore, the StockTicker class has to get a reference to the SignalR Hub connection context object.</span></span> <span data-ttu-id="d32eb-170">Em seguida, ele pode usar o objeto de contexto de conexão do Signalr para transmitir para os clientes.</span><span class="sxs-lookup"><span data-stu-id="d32eb-170">It can then use the SignalR connection context object to broadcast to clients.</span></span>

1. <span data-ttu-id="d32eb-171">Em **Gerenciador de soluções**, clique com o botão direito do mouse no projeto e clique em **Adicionar novo item**.</span><span class="sxs-lookup"><span data-stu-id="d32eb-171">In **Solution Explorer**, right-click the project and click **Add New Item**.</span></span>
2. <span data-ttu-id="d32eb-172">Se você tiver o Visual Studio 2012 com a [atualização do ASP.net and Web Tools 2012,2](https://go.microsoft.com/fwlink/?LinkId=279941), clique em **Web** em **Visual C#**  e selecione o modelo de item de **classe Hub do signalr** .</span><span class="sxs-lookup"><span data-stu-id="d32eb-172">If you have Visual Studio 2012 with the [ASP.NET and Web Tools 2012.2 Update](https://go.microsoft.com/fwlink/?LinkId=279941), click **Web** under **Visual C#** and select the **SignalR Hub Class** item template.</span></span> <span data-ttu-id="d32eb-173">Caso contrário, selecione o modelo de **classe** .</span><span class="sxs-lookup"><span data-stu-id="d32eb-173">Otherwise, select the **Class** template.</span></span>
3. <span data-ttu-id="d32eb-174">Nomeie a nova classe *StockTickerHub.cs*e clique em **Adicionar**.</span><span class="sxs-lookup"><span data-stu-id="d32eb-174">Name the new class *StockTickerHub.cs*, and then click **Add**.</span></span>

    ![Adicionar StockTickerHub.cs](tutorial-server-broadcast-with-aspnet-signalr/_static/image5.png)
4. <span data-ttu-id="d32eb-176">Substitua o código do modelo pelo seguinte código:</span><span class="sxs-lookup"><span data-stu-id="d32eb-176">Replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample3.cs)]

    <span data-ttu-id="d32eb-177">A classe [Hub](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hub(v=vs.111).aspx) é usada para definir métodos que os clientes podem chamar no servidor.</span><span class="sxs-lookup"><span data-stu-id="d32eb-177">The [Hub](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hub(v=vs.111).aspx) class is used to define methods the clients can call on the server.</span></span> <span data-ttu-id="d32eb-178">Você está definindo um método: `GetAllStocks()`.</span><span class="sxs-lookup"><span data-stu-id="d32eb-178">You are defining one method: `GetAllStocks()`.</span></span> <span data-ttu-id="d32eb-179">Quando um cliente se conecta inicialmente ao servidor, ele chamará esse método para obter uma lista de todas as ações com seus preços atuais.</span><span class="sxs-lookup"><span data-stu-id="d32eb-179">When a client initially connects to the server, it will call this method to get a list of all of the stocks with their current prices.</span></span> <span data-ttu-id="d32eb-180">O método pode ser executado de forma síncrona e retornar `IEnumerable<Stock>` porque ele está retornando dados da memória.</span><span class="sxs-lookup"><span data-stu-id="d32eb-180">The method can execute synchronously and return `IEnumerable<Stock>` because it is returning data from memory.</span></span> <span data-ttu-id="d32eb-181">Se o método tivesse que obter os dados fazendo algo que envolvesse esperar, como uma pesquisa de banco de dado ou uma chamada de serviço Web, você especificaria `Task<IEnumerable<Stock>>` como o valor de retorno para habilitar o processamento assíncrono.</span><span class="sxs-lookup"><span data-stu-id="d32eb-181">If the method had to get the data by doing something that would involve waiting, such as a database lookup or a web service call, you would specify `Task<IEnumerable<Stock>>` as the return value to enable asynchronous processing.</span></span> <span data-ttu-id="d32eb-182">Para obter mais informações, consulte [guia da API de hubs do ASP.net signalr-Server-quando executar de forma assíncrona](index.md).</span><span class="sxs-lookup"><span data-stu-id="d32eb-182">For more information, see [ASP.NET SignalR Hubs API Guide - Server - When to execute asynchronously](index.md).</span></span>

    <span data-ttu-id="d32eb-183">O atributo HubName especifica como o Hub será referenciado no código JavaScript no cliente.</span><span class="sxs-lookup"><span data-stu-id="d32eb-183">The HubName attribute specifies how the Hub will be referenced in JavaScript code on the client.</span></span> <span data-ttu-id="d32eb-184">O nome padrão no cliente se você não usar esse atributo é uma versão do nome de classe do camel case, que nesse caso seria stockTickerHub.</span><span class="sxs-lookup"><span data-stu-id="d32eb-184">The default name on the client if you don't use this attribute is a camel-cased version of the class name, which in this case would be stockTickerHub.</span></span>

    <span data-ttu-id="d32eb-185">Como você verá posteriormente ao criar a classe StockTicker, uma instância singleton dessa classe é criada em sua propriedade de instância estática.</span><span class="sxs-lookup"><span data-stu-id="d32eb-185">As you'll see later when you create the StockTicker class, a singleton instance of that class is created in its static Instance property.</span></span> <span data-ttu-id="d32eb-186">Essa instância singleton do StockTicker permanece na memória, independentemente de quantos clientes se conectam ou se desconectam, e essa instância é o que o método GetAllStocks usa para retornar informações de ações atuais.</span><span class="sxs-lookup"><span data-stu-id="d32eb-186">That singleton instance of StockTicker remains in memory no matter how many clients connect or disconnect, and that instance is what the GetAllStocks method uses to return current stock information.</span></span>
5. <span data-ttu-id="d32eb-187">Crie um novo arquivo de classe na pasta do projeto, nomeie-o *StockTicker.cs*e substitua o código do modelo pelo código a seguir:</span><span class="sxs-lookup"><span data-stu-id="d32eb-187">Create a new class file in the project folder, name it *StockTicker.cs*, and then replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample4.cs)]

    <span data-ttu-id="d32eb-188">Como vários threads executarão a mesma instância do código StockTicker, a classe StockTicker deve ser threadsafe.</span><span class="sxs-lookup"><span data-stu-id="d32eb-188">Since multiple threads will be running the same instance of StockTicker code, the StockTicker class has to be threadsafe.</span></span>

    ### <a name="storing-the-singleton-instance-in-a-static-field"></a><span data-ttu-id="d32eb-189">Armazenando a instância singleton em um campo estático</span><span class="sxs-lookup"><span data-stu-id="d32eb-189">Storing the singleton instance in a static field</span></span>

    <span data-ttu-id="d32eb-190">O código inicializa o campo de instância de \_estática que faz o backup da propriedade de instância com uma instância da classe, e essa é a única instância da classe que pode ser criada, pois o construtor é marcado como particular.</span><span class="sxs-lookup"><span data-stu-id="d32eb-190">The code initializes the static \_instance field that backs the Instance property with an instance of the class, and this is the only instance of the class that can be created, because the constructor is marked as private.</span></span> <span data-ttu-id="d32eb-191">A [inicialização lenta](https://msdn.microsoft.com/library/dd997286.aspx) é usada para o campo de instância de \_, não por motivos de desempenho, mas para garantir que a criação da instância seja threadsafe.</span><span class="sxs-lookup"><span data-stu-id="d32eb-191">[Lazy initialization](https://msdn.microsoft.com/library/dd997286.aspx) is used for the \_instance field, not for performance reasons but to ensure that the instance creation is threadsafe.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample5.cs)]

    <span data-ttu-id="d32eb-192">Cada vez que um cliente se conecta ao servidor, uma nova instância da classe StockTickerHub em execução em um thread separado Obtém a instância singleton StockTicker da propriedade estática StockTicker. Instance, como vimos anteriormente na classe StockTickerHub.</span><span class="sxs-lookup"><span data-stu-id="d32eb-192">Each time a client connects to the server, a new instance of the StockTickerHub class running in a separate thread gets the StockTicker singleton instance from the StockTicker.Instance static property, as you saw earlier in the StockTickerHub class.</span></span>

    ### <a name="storing-stock-data-in-a-concurrentdictionary"></a><span data-ttu-id="d32eb-193">Armazenando dados de ações em um ConcurrentDictionary</span><span class="sxs-lookup"><span data-stu-id="d32eb-193">Storing stock data in a ConcurrentDictionary</span></span>

    <span data-ttu-id="d32eb-194">O construtor inicializa a coleção \_stocks com alguns dados de estoque de exemplo e GetAllStocks retorna as ações.</span><span class="sxs-lookup"><span data-stu-id="d32eb-194">The constructor initializes the \_stocks collection with some sample stock data, and GetAllStocks returns the stocks.</span></span> <span data-ttu-id="d32eb-195">Como vimos anteriormente, essa coleção de ações é, por sua vez, retornada por StockTickerHub. GetAllStocks, que é um método de servidor na classe de Hub que os clientes podem chamar.</span><span class="sxs-lookup"><span data-stu-id="d32eb-195">As you saw earlier, this collection of stocks is in turn returned by StockTickerHub.GetAllStocks which is a server method in the Hub class that clients can call.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample6.cs)]

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample7.cs)]

    <span data-ttu-id="d32eb-196">A coleção de ações é definida como um tipo de [ConcurrentDictionary](https://msdn.microsoft.com/library/dd287191.aspx) para segurança de thread.</span><span class="sxs-lookup"><span data-stu-id="d32eb-196">The stocks collection is defined as a [ConcurrentDictionary](https://msdn.microsoft.com/library/dd287191.aspx) type for thread safety.</span></span> <span data-ttu-id="d32eb-197">Como alternativa, você pode usar um objeto [Dictionary](https://msdn.microsoft.com/library/xfhwa508.aspx) e bloquear explicitamente o dicionário quando fizer alterações nele.</span><span class="sxs-lookup"><span data-stu-id="d32eb-197">As an alternative, you could use a [Dictionary](https://msdn.microsoft.com/library/xfhwa508.aspx) object and explicitly lock the dictionary when you make changes to it.</span></span>

    <span data-ttu-id="d32eb-198">Para este aplicativo de exemplo, é possível armazenar dados de aplicativo na memória e perder os dados quando a instância StockTicker for descartada.</span><span class="sxs-lookup"><span data-stu-id="d32eb-198">For this sample application, it's OK to store application data in memory and to lose the data when the StockTicker instance is disposed.</span></span> <span data-ttu-id="d32eb-199">Em um aplicativo real, você trabalharia com um armazenamento de dados de back-end, como um Database.</span><span class="sxs-lookup"><span data-stu-id="d32eb-199">In a real application you would work with a back-end data store such as a database.</span></span>

    ### <a name="periodically-updating-stock-prices"></a><span data-ttu-id="d32eb-200">Atualizando periodicamente os preços de ações</span><span class="sxs-lookup"><span data-stu-id="d32eb-200">Periodically updating stock prices</span></span>

    <span data-ttu-id="d32eb-201">O Construtor inicia um objeto de temporizador que chama periodicamente os métodos que atualizam os preços de ações em uma base aleatória.</span><span class="sxs-lookup"><span data-stu-id="d32eb-201">The constructor starts up a Timer object that periodically calls methods that update stock prices on a random basis.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample8.cs)]

    <span data-ttu-id="d32eb-202">UpdateStockPrices é chamado pelo timer, que passa em NULL no parâmetro State.</span><span class="sxs-lookup"><span data-stu-id="d32eb-202">UpdateStockPrices is called by the Timer, which passes in null in the state parameter.</span></span> <span data-ttu-id="d32eb-203">Antes de atualizar os preços, um bloqueio é obtido no objeto \_updateStockPricesLock.</span><span class="sxs-lookup"><span data-stu-id="d32eb-203">Before updating prices, a lock is taken on the \_updateStockPricesLock object.</span></span> <span data-ttu-id="d32eb-204">O código verifica se outro thread já está atualizando os preços e, em seguida, chama TryUpdateStockPrice em cada estoque na lista.</span><span class="sxs-lookup"><span data-stu-id="d32eb-204">The code checks if another thread is already updating prices, and then it calls TryUpdateStockPrice on each stock in the list.</span></span> <span data-ttu-id="d32eb-205">O método TryUpdateStockPrice decide se o preço da ação deve ser alterado e o quanto alterar.</span><span class="sxs-lookup"><span data-stu-id="d32eb-205">The TryUpdateStockPrice method decides whether to change the stock price, and how much to change it.</span></span> <span data-ttu-id="d32eb-206">Se o preço da ação for alterado, BroadcastStockPrice será chamado para difundir a alteração de preço de estoque para todos os clientes conectados.</span><span class="sxs-lookup"><span data-stu-id="d32eb-206">If the stock price is changed, BroadcastStockPrice is called to broadcast the stock price change to all connected clients.</span></span>

    <span data-ttu-id="d32eb-207">O sinalizador \_updatingStockPrices é marcado como [volátil](https://msdn.microsoft.com/library/x13ttww7.aspx) para garantir que o acesso a ele seja threadsafe.</span><span class="sxs-lookup"><span data-stu-id="d32eb-207">The \_updatingStockPrices flag is marked as [volatile](https://msdn.microsoft.com/library/x13ttww7.aspx) to ensure that access to it is threadsafe.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample9.cs)]

    <span data-ttu-id="d32eb-208">Em um aplicativo real, o método TryUpdateStockPrice chamaria um serviço Web para pesquisar o preço; Nesse código, ele usa um gerador de números aleatórios para fazer alterações aleatoriamente.</span><span class="sxs-lookup"><span data-stu-id="d32eb-208">In a real application, the TryUpdateStockPrice method would call a web service to look up the price; in this code it uses a random number generator to make changes randomly.</span></span>

    ### <a name="getting-the-signalr-context-so-that-the-stockticker-class-can-broadcast-to-clients"></a><span data-ttu-id="d32eb-209">Obter o contexto do Signalr para que a classe StockTicker possa difundir para os clientes</span><span class="sxs-lookup"><span data-stu-id="d32eb-209">Getting the SignalR context so that the StockTicker class can broadcast to clients</span></span>

    <span data-ttu-id="d32eb-210">Como as alterações de preço são originadas aqui no objeto StockTicker, esse é o objeto que precisa chamar um método updateStockPrice em todos os clientes conectados.</span><span class="sxs-lookup"><span data-stu-id="d32eb-210">Because the price changes originate here in the StockTicker object, this is the object that needs to call an updateStockPrice method on all connected clients.</span></span> <span data-ttu-id="d32eb-211">Em uma classe de Hub, você tem uma API para chamar métodos de cliente, mas StockTicker não deriva da classe Hub e não tem uma referência a nenhum objeto Hub.</span><span class="sxs-lookup"><span data-stu-id="d32eb-211">In a Hub class you have an API for calling client methods, but StockTicker does not derive from the Hub class and does not have a reference to any Hub object.</span></span> <span data-ttu-id="d32eb-212">Portanto, para difundir para clientes conectados, a classe StockTicker precisa obter a instância de contexto do Signalr para a classe StockTickerHub e usá-la para chamar métodos em clientes.</span><span class="sxs-lookup"><span data-stu-id="d32eb-212">Therefore, in order to broadcast to connected clients, the StockTicker class has to get the SignalR context instance for the StockTickerHub class and use that to call methods on clients.</span></span>

    <span data-ttu-id="d32eb-213">O código obtém uma referência ao contexto do Signalr quando ele cria a instância da classe singleton, passa essa referência para o construtor e o Construtor a coloca na propriedade clients.</span><span class="sxs-lookup"><span data-stu-id="d32eb-213">The code gets a reference to the SignalR context when it creates the singleton class instance, passes that reference to the constructor, and the constructor puts it in the Clients property.</span></span>

    <span data-ttu-id="d32eb-214">Há dois motivos pelos quais você deseja obter o contexto apenas uma vez: obter o contexto é uma operação cara e obtê-lo uma vez garante que a ordem pretendida de mensagens enviadas aos clientes é preservada.</span><span class="sxs-lookup"><span data-stu-id="d32eb-214">There are two reasons why you want to get the context just once: getting the context is an expensive operation, and getting it once ensures that the intended order of messages sent to clients is preserved.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample10.cs)]

    <span data-ttu-id="d32eb-215">Obter a propriedade clients do contexto e colocá-la na propriedade StockTickerClient permite que você escreva o código para chamar os métodos de cliente que têm a mesma aparência em uma classe de Hub.</span><span class="sxs-lookup"><span data-stu-id="d32eb-215">Getting the Clients property of the context and putting it in the StockTickerClient property lets you write code to call client methods that looks the same as it would in a Hub class.</span></span> <span data-ttu-id="d32eb-216">Por exemplo, para difundir para todos os clientes, você pode gravar clientes. All. updateStockPrice (stock).</span><span class="sxs-lookup"><span data-stu-id="d32eb-216">For instance, to broadcast to all clients you can write Clients.All.updateStockPrice(stock).</span></span>

    <span data-ttu-id="d32eb-217">O método updateStockPrice que você está chamando no BroadcastStockPrice ainda não existe; Você o adicionará posteriormente quando escrever o código que é executado no cliente.</span><span class="sxs-lookup"><span data-stu-id="d32eb-217">The updateStockPrice method that you are calling in BroadcastStockPrice doesn't exist yet; you'll add it later when you write code that runs on the client.</span></span> <span data-ttu-id="d32eb-218">Você pode fazer referência a updateStockPrice aqui porque clients. All é dinâmico, o que significa que a expressão será avaliada em tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="d32eb-218">You can refer to updateStockPrice here because Clients.All is dynamic, which means the expression will be evaluated at runtime.</span></span> <span data-ttu-id="d32eb-219">Quando essa chamada de método for executada, o Signalr enviará o nome do método e o valor do parâmetro para o cliente e, se o cliente tiver um método chamado updateStockPrice, esse método será chamado e o valor do parâmetro será passado para ele.</span><span class="sxs-lookup"><span data-stu-id="d32eb-219">When this method call executes, SignalR will send the method name and the parameter value to the client, and if the client has a method named updateStockPrice, that method will be called and the parameter value will be passed to it.</span></span>

    <span data-ttu-id="d32eb-220">Clients. All significa enviar para todos os clientes.</span><span class="sxs-lookup"><span data-stu-id="d32eb-220">Clients.All means send to all clients.</span></span> <span data-ttu-id="d32eb-221">O signalr oferece outras opções para especificar a quais clientes ou grupos de clientes enviar.</span><span class="sxs-lookup"><span data-stu-id="d32eb-221">SignalR gives you other options to specify which clients or groups of clients to send to.</span></span> <span data-ttu-id="d32eb-222">Para obter mais informações, consulte [HubConnectionContext](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubs.hubconnectioncontext(v=vs.111).aspx).</span><span class="sxs-lookup"><span data-stu-id="d32eb-222">For more information, see [HubConnectionContext](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubs.hubconnectioncontext(v=vs.111).aspx).</span></span>

### <a name="register-the-signalr-route"></a><span data-ttu-id="d32eb-223">Registrar a rota do Signalr</span><span class="sxs-lookup"><span data-stu-id="d32eb-223">Register the SignalR route</span></span>

<span data-ttu-id="d32eb-224">O servidor precisa saber qual URL interceptar e direcionar para o Signalr.</span><span class="sxs-lookup"><span data-stu-id="d32eb-224">The server needs to know which URL to intercept and direct to SignalR.</span></span> <span data-ttu-id="d32eb-225">Para fazer isso, você adicionará um código ao arquivo *global. asax* .</span><span class="sxs-lookup"><span data-stu-id="d32eb-225">To do that you'll add some code to the *Global.asax* file.</span></span>

1. <span data-ttu-id="d32eb-226">Em **Gerenciador de soluções**, clique com o botão direito do mouse no projeto e clique em **Adicionar novo item**.</span><span class="sxs-lookup"><span data-stu-id="d32eb-226">In **Solution Explorer**, right-click the project, and then click **Add New Item**.</span></span>
2. <span data-ttu-id="d32eb-227">Selecione o modelo de item de **classe de aplicativo global** e clique em **Adicionar**.</span><span class="sxs-lookup"><span data-stu-id="d32eb-227">Select the **Global Application Class** item template, and then click **Add**.</span></span>

    ![Adicionar global. asax](tutorial-server-broadcast-with-aspnet-signalr/_static/image6.png)
3. <span data-ttu-id="d32eb-229">Adicione o código de registro de rota do Signalr ao aplicativo\_método de início:</span><span class="sxs-lookup"><span data-stu-id="d32eb-229">Add the SignalR route registration code to the Application\_Start method:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample11.cs)]

    <span data-ttu-id="d32eb-230">Por padrão, a URL base para todo o tráfego de sinalização é "/signalr" e "/signalr/hubs" é usado para recuperar um arquivo JavaScript gerado dinamicamente que define proxies para todos os hubs que você tem em seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d32eb-230">By default, the base URL for all SignalR traffic is "/signalr", and "/signalr/hubs" is used to retrieve a dynamically generated JavaScript file that defines proxies for all the Hubs you have in your application.</span></span> <span data-ttu-id="d32eb-231">O método MapHubs inclui sobrecargas que permitem especificar uma URL base diferente e determinadas opções de Signalr em uma instância da classe [HubConfiguration](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubconfiguration(v=vs.111).aspx) .</span><span class="sxs-lookup"><span data-stu-id="d32eb-231">The MapHubs method includes overloads that let you specify a different base URL and certain SignalR options in an instance of the [HubConfiguration](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubconfiguration(v=vs.111).aspx) class.</span></span>
4. <span data-ttu-id="d32eb-232">Adicione uma instrução using na parte superior do arquivo:</span><span class="sxs-lookup"><span data-stu-id="d32eb-232">Add a using statement at the top of the file:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample12.cs)]
5. <span data-ttu-id="d32eb-233">Salve e feche o arquivo *global. asax* e compile o projeto.</span><span class="sxs-lookup"><span data-stu-id="d32eb-233">Save and close the *Global.asax* file, and build the project.</span></span>

<span data-ttu-id="d32eb-234">Agora você concluiu a configuração do código do servidor.</span><span class="sxs-lookup"><span data-stu-id="d32eb-234">You have now completed setting up the server code.</span></span> <span data-ttu-id="d32eb-235">Na próxima seção, você configurará o cliente.</span><span class="sxs-lookup"><span data-stu-id="d32eb-235">In the next section you'll set up the client.</span></span>

<a id="client"></a>

## <a name="set-up-the-client-code"></a><span data-ttu-id="d32eb-236">Configurar o código do cliente</span><span class="sxs-lookup"><span data-stu-id="d32eb-236">Set up the client code</span></span>

1. <span data-ttu-id="d32eb-237">Crie um novo arquivo HTML na pasta do projeto e nomeie-o *StockTicker. html*.</span><span class="sxs-lookup"><span data-stu-id="d32eb-237">Create a new HTML file in the project folder, and name it *StockTicker.html*.</span></span>
2. <span data-ttu-id="d32eb-238">Substitua o código do modelo pelo seguinte código:</span><span class="sxs-lookup"><span data-stu-id="d32eb-238">Replace the template code with the following code:</span></span>

    [!code-html[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample13.html)]

    <span data-ttu-id="d32eb-239">O HTML cria uma tabela com 5 colunas, uma linha de cabeçalho e uma linha de dados com uma única célula que abrange todas as 5 colunas.</span><span class="sxs-lookup"><span data-stu-id="d32eb-239">The HTML creates a table with 5 columns, a header row, and a data row with a single cell that spans all 5 columns.</span></span> <span data-ttu-id="d32eb-240">A linha de dados exibe "carregando..." e será mostrado momentaneamente apenas quando o aplicativo for iniciado.</span><span class="sxs-lookup"><span data-stu-id="d32eb-240">The data row displays "loading..." and will only be shown momentarily when the application starts.</span></span> <span data-ttu-id="d32eb-241">O código JavaScript removerá essa linha e adicionará suas linhas locais com os dados de estoque recuperados do servidor.</span><span class="sxs-lookup"><span data-stu-id="d32eb-241">JavaScript code will remove that row and add in its place rows with stock data retrieved from the server.</span></span>

    <span data-ttu-id="d32eb-242">As marcas de script especificam o arquivo de script jQuery, o arquivo de script do Signalr Core, o arquivo de script de proxies do Signalr e um arquivo de script StockTicker que você criará mais tarde.</span><span class="sxs-lookup"><span data-stu-id="d32eb-242">The script tags specify the jQuery script file, the SignalR core script file, the SignalR proxies script file, and a StockTicker script file that you'll create later.</span></span> <span data-ttu-id="d32eb-243">O arquivo de script de proxies do Signalr, que especifica a URL "/signalr/hubs", é gerado dinamicamente e define métodos de proxy para os métodos na classe Hub, nesse caso, para StockTickerHub. GetAllStocks.</span><span class="sxs-lookup"><span data-stu-id="d32eb-243">The SignalR proxies script file, which specifies the "/signalr/hubs" URL, is dynamically generated and defines proxy methods for the methods on the Hub class, in this case for StockTickerHub.GetAllStocks.</span></span> <span data-ttu-id="d32eb-244">Se preferir, você pode gerar esse arquivo JavaScript manualmente usando os [utilitários do signalr](http://nuget.org/packages/Microsoft.AspNet.SignalR.Utils/) e desabilitar a criação dinâmica de arquivos na chamada do método MapHubs.</span><span class="sxs-lookup"><span data-stu-id="d32eb-244">If you prefer, you can generate this JavaScript file manually by using [SignalR Utilities](http://nuget.org/packages/Microsoft.AspNet.SignalR.Utils/) and disable dynamic file creation in the MapHubs method call.</span></span>
3. > [!IMPORTANT]
   > <span data-ttu-id="d32eb-245">Verifique se as referências de arquivo JavaScript em *StockTicker. html* estão corretas.</span><span class="sxs-lookup"><span data-stu-id="d32eb-245">Make sure that the JavaScript file references in *StockTicker.html* are correct.</span></span> <span data-ttu-id="d32eb-246">Ou seja, certifique-se de que a versão do jQuery na sua marca de script (1.8.2 no exemplo) seja a mesma que a versão do jQuery na pasta de *scripts* do projeto e certifique-se de que a versão do signalr na marca do script seja igual à versão do signalr na pasta de *scripts* do projeto.</span><span class="sxs-lookup"><span data-stu-id="d32eb-246">That is, make sure that the jQuery version in your script tag (1.8.2 in the example) is the same as the jQuery version in your project's *Scripts* folder, and make sure that the SignalR version in your script tag is the same as the SignalR version in your project's *Scripts* folder.</span></span> <span data-ttu-id="d32eb-247">Altere os nomes de arquivo nas marcas de script, se necessário.</span><span class="sxs-lookup"><span data-stu-id="d32eb-247">Change the file names in the script tags if necessary.</span></span>
4. <span data-ttu-id="d32eb-248">No **Gerenciador de soluções**, clique com o botão direito do mouse em *StockTicker. html*e clique em **definir como página inicial**.</span><span class="sxs-lookup"><span data-stu-id="d32eb-248">In **Solution Explorer**, right-click *StockTicker.html*, and then click **Set as Start Page**.</span></span>
5. <span data-ttu-id="d32eb-249">Crie um novo arquivo JavaScript na pasta do projeto e nomeie-o *StockTicker. js*.</span><span class="sxs-lookup"><span data-stu-id="d32eb-249">Create a new JavaScript file in the project folder and name it *StockTicker.js*..</span></span>
6. <span data-ttu-id="d32eb-250">Substitua o código do modelo pelo seguinte código:</span><span class="sxs-lookup"><span data-stu-id="d32eb-250">Replace the template code with the following code:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample14.js)]

    <span data-ttu-id="d32eb-251">$. conexão refere-se aos proxies do Signalr.</span><span class="sxs-lookup"><span data-stu-id="d32eb-251">$.connection refers to the SignalR proxies.</span></span> <span data-ttu-id="d32eb-252">O código obtém uma referência ao proxy para a classe StockTickerHub e a coloca na variável de marca.</span><span class="sxs-lookup"><span data-stu-id="d32eb-252">The code gets a reference to the proxy for the StockTickerHub class and puts it in the ticker variable.</span></span> <span data-ttu-id="d32eb-253">O nome do proxy é o nome que foi definido pelo atributo [HubName]:</span><span class="sxs-lookup"><span data-stu-id="d32eb-253">The proxy name is the name that was set by the [HubName] attribute:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample15.js)]

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample16.cs)]

    <span data-ttu-id="d32eb-254">Depois que todas as variáveis e funções são definidas, a última linha de código no arquivo Inicializa a conexão do Signalr chamando a função de início do Signalr.</span><span class="sxs-lookup"><span data-stu-id="d32eb-254">After all the variables and functions are defined, the last line of code in the file initializes the SignalR connection by calling the SignalR start function.</span></span> <span data-ttu-id="d32eb-255">A função Start é executada de forma assíncrona e retorna um [objeto do jQuery adiado](http://api.jquery.com/category/deferred-object/), o que significa que você pode chamar a função Done para especificar a função a ser chamada quando a operação assíncrona for concluída.</span><span class="sxs-lookup"><span data-stu-id="d32eb-255">The start function executes asynchronously and returns a [jQuery Deferred object](http://api.jquery.com/category/deferred-object/), which means you can call the done function to specify the function to call when the asynchronous operation is completed..</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample17.js)]

    <span data-ttu-id="d32eb-256">A função init chama a função getAllStocks no servidor e usa as informações que o servidor retorna para atualizar a tabela de estoque.</span><span class="sxs-lookup"><span data-stu-id="d32eb-256">The init function calls the getAllStocks function on the server and uses the information that the server returns to update the stock table.</span></span> <span data-ttu-id="d32eb-257">Observe que, por padrão, você precisa usar o camel case no cliente, embora o nome do método seja Pascal-case no servidor.</span><span class="sxs-lookup"><span data-stu-id="d32eb-257">Notice that by default, you have to use camel casing on the client although the method name is pascal-cased on the server.</span></span> <span data-ttu-id="d32eb-258">A regra de camel-case só se aplica a métodos, não a objetos.</span><span class="sxs-lookup"><span data-stu-id="d32eb-258">The camel-casing rule only applies to methods, not objects.</span></span> <span data-ttu-id="d32eb-259">Por exemplo, você se refere a ações. Símbolo e estoque. Preço, não estoque. símbolo ou estoque. preço.</span><span class="sxs-lookup"><span data-stu-id="d32eb-259">For example, you refer to stock.Symbol and stock.Price, not stock.symbol or stock.price.</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample18.js)]

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample19.cs)]

    <span data-ttu-id="d32eb-260">Se você quisesse usar a capitalização de Pascal no cliente ou se quisesse usar um nome de método completamente diferente, poderia decorar o método de Hub com o atributo HubMethodName da mesma forma que você decorau a própria classe de Hub com o atributo HubName.</span><span class="sxs-lookup"><span data-stu-id="d32eb-260">If you wanted to use pascal casing on the client, or if you wanted to use a completely different method name, you could decorate the Hub method with the HubMethodName attribute the same way you decorated the Hub class itself with the HubName attribute.</span></span>

    <span data-ttu-id="d32eb-261">No método Init, o HTML para uma linha de tabela é criado para cada objeto de estoque recebido do servidor chamando formatStock para formatar as propriedades do objeto Stock e, em seguida, chamando suplantar (que é definido na parte superior de *StockTicker. js*) para substituir os espaços reservados na variável rowgroup pelos valores de Propriedade do objeto stock.</span><span class="sxs-lookup"><span data-stu-id="d32eb-261">In the init method, HTML for a table row is created for each stock object received from the server by calling formatStock to format properties of the stock object, and then by calling supplant (which is defined at the top of *StockTicker.js*) to replace placeholders in the rowTemplate variable with the stock object property values.</span></span> <span data-ttu-id="d32eb-262">O HTML resultante é então anexado à tabela stock.</span><span class="sxs-lookup"><span data-stu-id="d32eb-262">The resulting HTML is then appended to the stock table.</span></span>

    <span data-ttu-id="d32eb-263">Chame init passando-o como uma função de retorno de chamada que é executada após a conclusão da função de início assíncrono.</span><span class="sxs-lookup"><span data-stu-id="d32eb-263">You call init by passing it in as a callback function that executes after the asynchronous start function completes.</span></span> <span data-ttu-id="d32eb-264">Se você chamou init como uma instrução JavaScript separada depois de chamar Start, a função falhará porque ela seria executada imediatamente sem esperar que a função start termine de estabelecer a conexão.</span><span class="sxs-lookup"><span data-stu-id="d32eb-264">If you called init as a separate JavaScript statement after calling start, the function would fail because it would execute immediately without waiting for the start function to finish establishing the connection.</span></span> <span data-ttu-id="d32eb-265">Nesse caso, a função init tentaria chamar a função getAllStocks antes que a conexão do servidor seja estabelecida.</span><span class="sxs-lookup"><span data-stu-id="d32eb-265">In that case, the init function would try to call the getAllStocks function before the server connection is established.</span></span>

    <span data-ttu-id="d32eb-266">Quando o servidor altera o preço de uma ação, ele chama o updateStockPrice em clientes conectados.</span><span class="sxs-lookup"><span data-stu-id="d32eb-266">When the server changes a stock's price, it calls the updateStockPrice on connected clients.</span></span> <span data-ttu-id="d32eb-267">A função é adicionada à propriedade Client do proxy stockTicker para disponibilizá-la a chamadas do servidor.</span><span class="sxs-lookup"><span data-stu-id="d32eb-267">The function is added to the client property of the stockTicker proxy in order to make it available to calls from the server.</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample20.js)]

    <span data-ttu-id="d32eb-268">A função updateStockPrice formata um objeto de estoque recebido do servidor para uma linha de tabela da mesma maneira que na função init.</span><span class="sxs-lookup"><span data-stu-id="d32eb-268">The updateStockPrice function formats a stock object received from the server into a table row the same way as in the init function.</span></span> <span data-ttu-id="d32eb-269">No entanto, em vez de acrescentar a linha à tabela, ela localiza a linha atual do estoque na tabela e substitui essa linha pela nova.</span><span class="sxs-lookup"><span data-stu-id="d32eb-269">However, instead of appending the row to the table, it finds the stock's current row in the table and replaces that row with the new one.</span></span>

<a id="test"></a>

## <a name="test-the-application"></a><span data-ttu-id="d32eb-270">Testar o aplicativo</span><span class="sxs-lookup"><span data-stu-id="d32eb-270">Test the application</span></span>

1. <span data-ttu-id="d32eb-271">Pressione F5 para executar o aplicativo em modo de depuração.</span><span class="sxs-lookup"><span data-stu-id="d32eb-271">Press F5 to run the application in debug mode.</span></span>

    <span data-ttu-id="d32eb-272">A tabela Stock inicialmente exibe o "carregando..." , depois de um pequeno atraso, os dados iniciais de ações são exibidos e, em seguida, os preços de ações começam a ser alterados.</span><span class="sxs-lookup"><span data-stu-id="d32eb-272">The stock table initially displays the "loading..." line, then after a short delay the initial stock data is displayed, and then the stock prices start to change.</span></span>

    ![Carregando](tutorial-server-broadcast-with-aspnet-signalr/_static/image7.png)

    ![Tabela de estoque inicial](tutorial-server-broadcast-with-aspnet-signalr/_static/image8.png)

    ![Tabela de ações recebendo alterações do servidor](tutorial-server-broadcast-with-aspnet-signalr/_static/image9.png)
2. <span data-ttu-id="d32eb-276">Copie a URL da barra de endereços do navegador e cole-a em uma ou mais novas janela (s) do navegador.</span><span class="sxs-lookup"><span data-stu-id="d32eb-276">Copy the URL from the browser address bar and paste it into one or more new browser window(s).</span></span>

    <span data-ttu-id="d32eb-277">A exibição de estoque inicial é a mesma do primeiro navegador e as alterações acontecem simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="d32eb-277">The initial stock display is the same as the first browser and changes happen simultaneously.</span></span>
3. <span data-ttu-id="d32eb-278">Feche todos os navegadores e abra um novo navegador e vá para a mesma URL.</span><span class="sxs-lookup"><span data-stu-id="d32eb-278">Close all browsers and open a new browser, then go to the same URL.</span></span>

    <span data-ttu-id="d32eb-279">O objeto singleton StockTicker continuou a ser executado no servidor, portanto, a exibição da tabela Stock mostra que as ações continuaram a ser alteradas.</span><span class="sxs-lookup"><span data-stu-id="d32eb-279">The StockTicker singleton object has continued to run in the server, so the stock table display shows that the stocks have continued to change.</span></span> <span data-ttu-id="d32eb-280">(Você não vê a tabela inicial com valores de alteração zero.)</span><span class="sxs-lookup"><span data-stu-id="d32eb-280">(You don't see the initial table with zero change figures.)</span></span>
4. <span data-ttu-id="d32eb-281">Feche o navegador.</span><span class="sxs-lookup"><span data-stu-id="d32eb-281">Close the browser.</span></span>

<a id="enablelogging"></a>

## <a name="enable-logging"></a><span data-ttu-id="d32eb-282">Habilitar o registro em log</span><span class="sxs-lookup"><span data-stu-id="d32eb-282">Enable logging</span></span>

<span data-ttu-id="d32eb-283">O signalr tem uma função de log interna que você pode habilitar no cliente para auxiliar na solução de problemas.</span><span class="sxs-lookup"><span data-stu-id="d32eb-283">SignalR has a built-in logging function that you can enable on the client to aid in troubleshooting.</span></span> <span data-ttu-id="d32eb-284">Nesta seção, você habilitará o registro em log e verá exemplos que mostram como os logs informam quais dos seguintes métodos de transporte o Signalr está usando:</span><span class="sxs-lookup"><span data-stu-id="d32eb-284">In this section you enable logging and see examples that show how logs tell you which of the following transport methods SignalR is using:</span></span>

- <span data-ttu-id="d32eb-285">[WebSockets](http://en.wikipedia.org/wiki/WebSocket), com suporte do IIS 8 e navegadores atuais.</span><span class="sxs-lookup"><span data-stu-id="d32eb-285">[WebSockets](http://en.wikipedia.org/wiki/WebSocket), supported by IIS 8 and current browsers.</span></span>
- <span data-ttu-id="d32eb-286">[Eventos enviados pelo servidor](http://en.wikipedia.org/wiki/Server-sent_events), com suporte de navegadores diferentes do Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="d32eb-286">[Server-sent events](http://en.wikipedia.org/wiki/Server-sent_events), supported by browsers other than Internet Explorer.</span></span>
- <span data-ttu-id="d32eb-287">[Quadro contínuo](http://en.wikipedia.org/wiki/Comet_(programming)#Hidden_iframe), com suporte do Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="d32eb-287">[Forever frame](http://en.wikipedia.org/wiki/Comet_(programming)#Hidden_iframe), supported by Internet Explorer.</span></span>
- <span data-ttu-id="d32eb-288">[Sondagem longa do AJAX](http://en.wikipedia.org/wiki/Comet_(programming)#Ajax_with_long_polling), com suporte de todos os navegadores.</span><span class="sxs-lookup"><span data-stu-id="d32eb-288">[Ajax long polling](http://en.wikipedia.org/wiki/Comet_(programming)#Ajax_with_long_polling), supported by all browsers.</span></span>

<span data-ttu-id="d32eb-289">Para qualquer conexão fornecida, o Signalr escolhe o melhor método de transporte que o servidor e o cliente oferecem suporte.</span><span class="sxs-lookup"><span data-stu-id="d32eb-289">For any given connection, SignalR chooses the best transport method that both the server and the client support.</span></span>

1. <span data-ttu-id="d32eb-290">Abra *StockTicker. js* e adicione uma linha de código para habilitar o registro em log imediatamente antes do código que inicializa a conexão no final do arquivo:</span><span class="sxs-lookup"><span data-stu-id="d32eb-290">Open *StockTicker.js* and add a line of code to enable logging immediately before the code that initializes the connection at the end of the file:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample21.js)]
2. <span data-ttu-id="d32eb-291">Pressione F5 para executar o projeto.</span><span class="sxs-lookup"><span data-stu-id="d32eb-291">Press F5 to run the project.</span></span>
3. <span data-ttu-id="d32eb-292">Abra a janela de ferramentas de desenvolvedor do navegador e selecione o console do para ver os logs.</span><span class="sxs-lookup"><span data-stu-id="d32eb-292">Open your browser's developer tools window, and select the Console to see the logs.</span></span> <span data-ttu-id="d32eb-293">Talvez seja necessário atualizar a página para ver os logs do Signalr negociando o método de transporte para uma nova conexão.</span><span class="sxs-lookup"><span data-stu-id="d32eb-293">You might have to refresh the page to see the logs of Signalr negotiating the transport method for a new connection.</span></span>

    <span data-ttu-id="d32eb-294">Se você estiver executando o Internet Explorer 10 no Windows 8 (IIS 8), o método de transporte será WebSockets.</span><span class="sxs-lookup"><span data-stu-id="d32eb-294">If you are running Internet Explorer 10 on Windows 8 (IIS 8), the transport method is WebSockets.</span></span>

    ![Console do IE 10 IIS 8](tutorial-server-broadcast-with-aspnet-signalr/_static/image10.png)

    <span data-ttu-id="d32eb-296">Se você estiver executando o Internet Explorer 10 no Windows 7 (IIS 7,5), o método de transporte será iframe.</span><span class="sxs-lookup"><span data-stu-id="d32eb-296">If you are running Internet Explorer 10 on Windows 7 (IIS 7.5), the transport method is iframe.</span></span>

    ![Console do IE 10, IIS 7,5](tutorial-server-broadcast-with-aspnet-signalr/_static/image11.png)

    <span data-ttu-id="d32eb-298">No Firefox, instale o suplemento do Firebug para obter uma janela de console.</span><span class="sxs-lookup"><span data-stu-id="d32eb-298">In Firefox, install the Firebug add-in to get a Console window.</span></span> <span data-ttu-id="d32eb-299">Se você estiver executando o Firefox 19 no Windows 8 (IIS 8), o método de transporte será WebSockets.</span><span class="sxs-lookup"><span data-stu-id="d32eb-299">If you are running Firefox 19 on Windows 8 (IIS 8), the transport method is WebSockets.</span></span>

    ![WebSockets do Firefox 19 IIS 8](tutorial-server-broadcast-with-aspnet-signalr/_static/image12.png)

    <span data-ttu-id="d32eb-301">Se você estiver executando o Firefox 19 no Windows 7 (IIS 7,5), o método de transporte será um evento enviado pelo servidor.</span><span class="sxs-lookup"><span data-stu-id="d32eb-301">If you are running Firefox 19 on Windows 7 (IIS 7.5), the transport method is server-sent events.</span></span>

    ![Console do Firefox 19 IIS 7,5](tutorial-server-broadcast-with-aspnet-signalr/_static/image13.png)

<a id="fullsample"></a>

## <a name="install-and-review-the-full-stockticker-sample"></a><span data-ttu-id="d32eb-303">Instalar e examinar o exemplo de StockTicker completo</span><span class="sxs-lookup"><span data-stu-id="d32eb-303">Install and review the full StockTicker sample</span></span>

<span data-ttu-id="d32eb-304">O aplicativo StockTicker que é instalado pelo pacote do NuGet [Microsoft. AspNet. signaler. Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) inclui mais recursos do que a versão simplificada que você acabou de criar do zero.</span><span class="sxs-lookup"><span data-stu-id="d32eb-304">The StockTicker application that is installed by the [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) NuGet package includes more features than the simplified version that you just created from scratch.</span></span> <span data-ttu-id="d32eb-305">Nesta seção do tutorial, você instala o pacote NuGet e examina os novos recursos e o código que os implementa.</span><span class="sxs-lookup"><span data-stu-id="d32eb-305">In this section of the tutorial, you install the NuGet package and review the new features and the code that implements them.</span></span>

### <a name="install-the-signalrsample-nuget-package"></a><span data-ttu-id="d32eb-306">Instalar o pacote NuGet. Sample do Signalr</span><span class="sxs-lookup"><span data-stu-id="d32eb-306">Install the SignalR.Sample NuGet package</span></span>

1. <span data-ttu-id="d32eb-307">Em **Gerenciador de soluções**, clique com o botão direito do mouse no projeto e clique em **gerenciar pacotes NuGet**.</span><span class="sxs-lookup"><span data-stu-id="d32eb-307">In **Solution Explorer**, right-click the project and click **Manage NuGet Packages**.</span></span>
2. <span data-ttu-id="d32eb-308">Na caixa de diálogo **gerenciar pacotes NuGet** , clique em **online**, *digite signalr. Sample* na caixa **Pesquisar online** e clique em **instalar** no pacote **signalr. Sample** .</span><span class="sxs-lookup"><span data-stu-id="d32eb-308">In the **Manage NuGet Packages** dialog box, click **Online**, enter *SignalR.Sample* in the **Search Online** box, and then click **Install** in the **SignalR.Sample** package.</span></span>

    ![Instalar um pacote. Sample do Signalr](tutorial-server-broadcast-with-aspnet-signalr/_static/image14.png)
3. <span data-ttu-id="d32eb-310">No arquivo *global. asax* , comente o RouteTable. routes. MapHubs (); linha que você adicionou anteriormente no método Start do\_do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d32eb-310">In the *Global.asax* file, comment out the RouteTable.Routes.MapHubs(); line that you added earlier in the Application\_Start method.</span></span>

    <span data-ttu-id="d32eb-311">O código em *global. asax* não é mais necessário porque o pacote signalr. Sample registra a rota do signalr no *aplicativo\_Start/RegisterHubs. cs* file:</span><span class="sxs-lookup"><span data-stu-id="d32eb-311">The code in *Global.asax* is no longer needed because the SignalR.Sample package registers the SignalR route in the *App\_Start/RegisterHubs.cs* file:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample22.cs)]

    <span data-ttu-id="d32eb-312">A classe webactivator que é referenciada pelo atributo assembly está incluída no pacote NuGet WebActivatorEx, que é instalado como uma dependência do pacote Signalr. Sample.</span><span class="sxs-lookup"><span data-stu-id="d32eb-312">The WebActivator class that is referenced by the assembly attribute is included in the WebActivatorEx NuGet package, which is installed as a dependency of the SignalR.Sample package.</span></span>
4. <span data-ttu-id="d32eb-313">Em **Gerenciador de soluções**, expanda a pasta *signalr. Sample* que foi criada pela instalação do pacote signalr. Sample.</span><span class="sxs-lookup"><span data-stu-id="d32eb-313">In **Solution Explorer**, expand the *SignalR.Sample* folder which was created by installing the SignalR.Sample package.</span></span>
5. <span data-ttu-id="d32eb-314">Na pasta *signalr. Sample* , clique com o botão direito do mouse em *StockTicker. html*e clique em **definir como página inicial**.</span><span class="sxs-lookup"><span data-stu-id="d32eb-314">In the *SignalR.Sample* folder, right-click *StockTicker.html*, and then click **Set As Start Page**.</span></span>

    > [!NOTE]
    > <span data-ttu-id="d32eb-315">A instalação do pacote NuGet do Signalr. Sample pode alterar a versão do jQuery que você tem em sua pasta *scripts* .</span><span class="sxs-lookup"><span data-stu-id="d32eb-315">Installing The SignalR.Sample NuGet package might change the version of jQuery that you have in your *Scripts* folder.</span></span> <span data-ttu-id="d32eb-316">O novo arquivo *StockTicker. html* que o pacote instala na pasta *signalr. Sample* estará em sincronia com a versão do jQuery instalada pelo pacote, mas se você quiser executar o arquivo *StockTicker. html* original novamente, talvez seja necessário atualizar a referência do jQuery na marca do script primeiro.</span><span class="sxs-lookup"><span data-stu-id="d32eb-316">The new *StockTicker.html* file that the package installs in the *SignalR.Sample* folder will be in sync with the jQuery version that the package installs, but if you want to run your original *StockTicker.html* file again, you might have to update the jQuery reference in the script tag first.</span></span>

### <a name="run-the-application"></a><span data-ttu-id="d32eb-317">Executar o aplicativo</span><span class="sxs-lookup"><span data-stu-id="d32eb-317">Run the application</span></span>

1. <span data-ttu-id="d32eb-318">Pressione F5 para executar o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d32eb-318">Press F5 to run the application.</span></span>

    <span data-ttu-id="d32eb-319">Além da grade que você viu anteriormente, o aplicativo de cotação de ações completo mostra uma janela de rolagem horizontal que exibe os mesmos dados de ações.</span><span class="sxs-lookup"><span data-stu-id="d32eb-319">In addition to the grid that you saw earlier, the full stock ticker application shows a horizontally scrolling window that displays the same stock data.</span></span> <span data-ttu-id="d32eb-320">Quando você executa o aplicativo pela primeira vez, o "mercado" é "fechado" e você vê uma grade estática e uma janela de marcação que não está rolando.</span><span class="sxs-lookup"><span data-stu-id="d32eb-320">When you run the application for the first time, the "market" is "closed" and you see a static grid and a ticker window that isn't scrolling.</span></span>

    ![Início da tela StockTicker](tutorial-server-broadcast-with-aspnet-signalr/_static/image15.png)

    <span data-ttu-id="d32eb-322">Quando você clica em **abrir mercado**, a caixa de Cotações de **estoque ao vivo** começa a rolar horizontalmente, e o servidor começa a transmitir periodicamente as alterações de preço de ações aleatoriamente.</span><span class="sxs-lookup"><span data-stu-id="d32eb-322">When you click **Open Market**, the **Live Stock Ticker** box starts to scroll horizontally, and the server starts to periodically broadcast stock price changes on a random basis.</span></span> <span data-ttu-id="d32eb-323">Cada vez que o preço de uma ação é alterado, a grade da **tabela de estoque ao** vivo e a caixa de Cotações de **estoque ao vivo** são atualizadas.</span><span class="sxs-lookup"><span data-stu-id="d32eb-323">Each time a stock price changes, both the **Live Stock Table** grid and the **Live Stock Ticker** box are updated.</span></span> <span data-ttu-id="d32eb-324">Quando a alteração de preço de um estoque é positiva, o estoque é mostrado com um plano de fundo verde e, quando a alteração é negativa, o estoque é mostrado com um plano de fundo vermelho.</span><span class="sxs-lookup"><span data-stu-id="d32eb-324">When a stock's price change is positive, the stock is shown with a green background, and when the change is negative, the stock is shown with a red background.</span></span>

    ![Aplicativo StockTicker, mercado aberto](tutorial-server-broadcast-with-aspnet-signalr/_static/image16.png)

    <span data-ttu-id="d32eb-326">O botão **fechar mercado** interrompe as alterações e interrompe a rolagem do marcador e o botão **Redefinir** redefine todos os dados de ações para o estado inicial antes do início das alterações de preço.</span><span class="sxs-lookup"><span data-stu-id="d32eb-326">The **Close Market** button stops the changes and stops the ticker scrolling, and the **Reset** button resets all stock data to the initial state before price changes started.</span></span> <span data-ttu-id="d32eb-327">Se você abrir mais janelas do navegador e ir para a mesma URL, verá os mesmos dados atualizados dinamicamente ao mesmo tempo em cada navegador.</span><span class="sxs-lookup"><span data-stu-id="d32eb-327">If you open more browser windows and go to the same URL, you see the same data dynamically updated at the same time in each browser.</span></span> <span data-ttu-id="d32eb-328">Quando você clica em um dos botões, todos os navegadores respondem da mesma maneira ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="d32eb-328">When you click one of the buttons, all browsers respond the same way at the same time.</span></span>

### <a name="live-stock-ticker-display"></a><span data-ttu-id="d32eb-329">Exibição de Cotações de estoque ao vivo</span><span class="sxs-lookup"><span data-stu-id="d32eb-329">Live Stock Ticker display</span></span>

<span data-ttu-id="d32eb-330">A exibição de **Cotações de estoque ao vivo** é uma lista não ordenada em um elemento div que é formatada em uma única linha por estilos CSS.</span><span class="sxs-lookup"><span data-stu-id="d32eb-330">The **Live Stock Ticker** display is an unordered list in a div element that is formatted into a single line by CSS styles.</span></span> <span data-ttu-id="d32eb-331">O marcador é inicializado e atualizado da mesma maneira que a tabela: substituindo espaços reservados em uma cadeia de caracteres de modelo &lt;li&gt; e adicionando dinamicamente os elementos de&gt; de &lt;li ao elemento &lt;UL&gt;.</span><span class="sxs-lookup"><span data-stu-id="d32eb-331">The ticker is initialized and updated the same way as the table: by replacing placeholders in a &lt;li&gt; template string and dynamically adding the &lt;li&gt; elements to the &lt;ul&gt; element.</span></span> <span data-ttu-id="d32eb-332">A rolagem é executada usando a função de animação jQuery para variar a margem esquerda da lista não ordenada dentro da div.</span><span class="sxs-lookup"><span data-stu-id="d32eb-332">The scrolling is performed by using the jQuery animate function to vary the margin-left of the unordered list within the div.</span></span>

<span data-ttu-id="d32eb-333">O HTML da bolsa de ações:</span><span class="sxs-lookup"><span data-stu-id="d32eb-333">The stock ticker HTML:</span></span>

[!code-html[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample23.html)]

<span data-ttu-id="d32eb-334">O CSS de Cotações de ações:</span><span class="sxs-lookup"><span data-stu-id="d32eb-334">The stock ticker CSS:</span></span>

[!code-html[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample24.html)]

<span data-ttu-id="d32eb-335">O código do jQuery que faz a rolagem:</span><span class="sxs-lookup"><span data-stu-id="d32eb-335">The jQuery code that makes it scroll:</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample25.js)]

### <a name="additional-methods-on-the-server-that-the-client-can-call"></a><span data-ttu-id="d32eb-336">Métodos adicionais no servidor que o cliente pode chamar</span><span class="sxs-lookup"><span data-stu-id="d32eb-336">Additional methods on the server that the client can call</span></span>

<span data-ttu-id="d32eb-337">A classe StockTickerHub define quatro métodos adicionais que o cliente pode chamar:</span><span class="sxs-lookup"><span data-stu-id="d32eb-337">The StockTickerHub class defines four additional methods that the client can call:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample26.cs)]

<span data-ttu-id="d32eb-338">OpenMarket, CloseMarket e Reset são chamados em resposta aos botões na parte superior da página.</span><span class="sxs-lookup"><span data-stu-id="d32eb-338">OpenMarket, CloseMarket, and Reset are called in response to the buttons at the top of the page.</span></span> <span data-ttu-id="d32eb-339">Eles demonstram o padrão de um cliente que dispara uma alteração no estado que é propagada imediatamente para todos os clientes.</span><span class="sxs-lookup"><span data-stu-id="d32eb-339">They demonstrate the pattern of one client triggering a change in state that is immediately propagated to all clients.</span></span> <span data-ttu-id="d32eb-340">Cada um desses métodos chama um método na classe StockTicker que afeta a alteração de estado do mercado e, em seguida, transmite o novo estado.</span><span class="sxs-lookup"><span data-stu-id="d32eb-340">Each of these methods calls a method in the StockTicker class that effects the market state change and then broadcasts the new state.</span></span>

<span data-ttu-id="d32eb-341">Na classe StockTicker, o estado do mercado é mantido por uma propriedade Marketstate que retorna um valor de enumeração Marketstate:</span><span class="sxs-lookup"><span data-stu-id="d32eb-341">In the StockTicker class, the state of the market is maintained by a MarketState property that returns a MarketState enum value:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample27.cs)]

<span data-ttu-id="d32eb-342">Cada um dos métodos que alteram o estado do mercado faz isso dentro de um bloco de bloqueio porque a classe StockTicker deve ser threadsafe:</span><span class="sxs-lookup"><span data-stu-id="d32eb-342">Each of the methods that change the market state do so inside a lock block because the StockTicker class has to be threadsafe:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample28.cs)]

<span data-ttu-id="d32eb-343">Para garantir que esse código seja threadsafe, o campo marketstate \_que faz backup da propriedade Marketstate é marcado como volátil,</span><span class="sxs-lookup"><span data-stu-id="d32eb-343">To ensure that this code is threadsafe, the \_marketState field that backs the MarketState property is marked as volatile,</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample29.cs)]

<span data-ttu-id="d32eb-344">Os métodos BroadcastMarketStateChange e BroadcastMarketReset são semelhantes ao método BroadcastStockPrice que você já viu, exceto que eles chamam métodos diferentes definidos no cliente:</span><span class="sxs-lookup"><span data-stu-id="d32eb-344">The BroadcastMarketStateChange and BroadcastMarketReset methods are similar to the BroadcastStockPrice method that you already saw, except they call different methods defined at the client:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample30.cs)]

### <a name="additional-functions-on-the-client-that-the-server-can-call"></a><span data-ttu-id="d32eb-345">Funções adicionais no cliente que o servidor pode chamar</span><span class="sxs-lookup"><span data-stu-id="d32eb-345">Additional functions on the client that the server can call</span></span>

<span data-ttu-id="d32eb-346">A função updateStockPrice agora lida com a exibição da grade e da marca e usa jQuery. Color para piscar as cores vermelhas e verdes.</span><span class="sxs-lookup"><span data-stu-id="d32eb-346">The updateStockPrice function now handles both the grid and the ticker display, and it uses jQuery.Color to flash red and green colors.</span></span>

<span data-ttu-id="d32eb-347">Novas funções no *signalr. StockTicker. js* habilitam e desabilitam os botões com base no estado do mercado, e eles param ou iniciam a rolagem horizontal da janela de marcação.</span><span class="sxs-lookup"><span data-stu-id="d32eb-347">New functions in *SignalR.StockTicker.js* enable and disable the buttons based on market state, and they stop or start the ticker window horizontal scrolling.</span></span> <span data-ttu-id="d32eb-348">Como várias funções estão sendo adicionadas ao tickr. Client, a [função de extensão jQuery](http://api.jquery.com/jQuery.extend/) é usada para adicioná-las.</span><span class="sxs-lookup"><span data-stu-id="d32eb-348">Since multiple functions are being added to ticker.client, the [jQuery extend function](http://api.jquery.com/jQuery.extend/) is used to add them.</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample31.js)]

### <a name="additional-client-setup-after-establishing-the-connection"></a><span data-ttu-id="d32eb-349">Configuração adicional do cliente depois de estabelecer a conexão</span><span class="sxs-lookup"><span data-stu-id="d32eb-349">Additional client setup after establishing the connection</span></span>

<span data-ttu-id="d32eb-350">Depois que o cliente estabelece a conexão, ele tem algum trabalho adicional a fazer: Descubra se o mercado está aberto ou fechado para chamar a função marketOpened ou marketClosed apropriada e anexe as chamadas de método de servidor aos botões.</span><span class="sxs-lookup"><span data-stu-id="d32eb-350">After the client establishes the connection, it has some additional work to do: find out if the market is open or closed in order to call the appropriate marketOpened or marketClosed function, and attach the server method calls to the buttons.</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample32.js)]

<span data-ttu-id="d32eb-351">Os métodos de servidor não são conectados aos botões até que a conexão seja estabelecida, para que o código não possa tentar chamar os métodos de servidor antes que eles estejam disponíveis.</span><span class="sxs-lookup"><span data-stu-id="d32eb-351">The server methods are not wired up to the buttons until after the connection is established, so that the code can't try to call the server methods before they are available.</span></span>

<a id="nextsteps"></a>

## <a name="next-steps"></a><span data-ttu-id="d32eb-352">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="d32eb-352">Next steps</span></span>

<span data-ttu-id="d32eb-353">Neste tutorial, você aprendeu a programar um aplicativo Signalr que transmite mensagens do servidor para todos os clientes conectados, periodicamente e em resposta a notificações de qualquer cliente.</span><span class="sxs-lookup"><span data-stu-id="d32eb-353">In this tutorial you've learned how to program a SignalR application that broadcasts messages from the server to all connected clients, both on a periodic basis and in response to notifications from any client.</span></span> <span data-ttu-id="d32eb-354">O padrão de usar uma instância singleton multi-threaded para manter o estado do servidor também pode ser usado em cenários de jogos online de vários jogadores.</span><span class="sxs-lookup"><span data-stu-id="d32eb-354">The pattern of using a multi-threaded singleton instance to maintain server state can also be also used in multi-player online game scenarios.</span></span> <span data-ttu-id="d32eb-355">Para obter um exemplo, consulte [o jogo de partida que se baseia no signalr](https://github.com/NTaylorMullen/ShootR).</span><span class="sxs-lookup"><span data-stu-id="d32eb-355">For an example, see [the ShootR game that is based on SignalR](https://github.com/NTaylorMullen/ShootR).</span></span>

<span data-ttu-id="d32eb-356">Para obter tutoriais que mostrem cenários de comunicação ponto a ponto, confira [introdução com sinalizador](index.md) e [atualização em tempo real com o signalr](index.md).</span><span class="sxs-lookup"><span data-stu-id="d32eb-356">For tutorials that show peer-to-peer communication scenarios, see [Getting Started with SignalR](index.md) and [Real-Time Updating with SignalR](index.md).</span></span>

<span data-ttu-id="d32eb-357">Para saber mais sobre os conceitos avançados de desenvolvimento do Signalr, visite os seguintes sites para código-fonte e recursos do Signalr:</span><span class="sxs-lookup"><span data-stu-id="d32eb-357">To learn more advanced SignalR development concepts, visit the following sites for SignalR source code and resources:</span></span>

- [<span data-ttu-id="d32eb-358">ASP.NET SignalR</span><span class="sxs-lookup"><span data-stu-id="d32eb-358">ASP.NET SignalR</span></span>](https://asp.net/signalr/)
- [<span data-ttu-id="d32eb-359">Projeto do signalr</span><span class="sxs-lookup"><span data-stu-id="d32eb-359">SignalR Project</span></span>](http://signalr.net/)
- [<span data-ttu-id="d32eb-360">GitHub e exemplos do signalr</span><span class="sxs-lookup"><span data-stu-id="d32eb-360">SignalR Github and Samples</span></span>](https://github.com/SignalR/SignalR)
- [<span data-ttu-id="d32eb-361">Wiki do signalr</span><span class="sxs-lookup"><span data-stu-id="d32eb-361">SignalR Wiki</span></span>](https://github.com/SignalR/SignalR/wiki)
