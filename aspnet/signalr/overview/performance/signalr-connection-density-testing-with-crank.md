---
uid: signalr/overview/performance/signalr-connection-density-testing-with-crank
title: Teste de densidade de conexão do signalr com pedais | Microsoft Docs
author: bradygaster
description: Testes de densidade de conexão do SignalR com Crank
ms.author: bradyg
ms.date: 02/22/2015
ms.assetid: 148d9ca7-1af1-44b6-a9fb-91e261b9b463
msc.legacyurl: /signalr/overview/performance/signalr-connection-density-testing-with-crank
msc.type: authoredcontent
ms.openlocfilehash: 901e039fbb81651ed18d560c99745b7e7f716e01
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78558334"
---
# <a name="signalr-connection-density-testing-with-crank"></a><span data-ttu-id="e3590-103">Testes de densidade de conexão do SignalR com Crank</span><span class="sxs-lookup"><span data-stu-id="e3590-103">SignalR Connection Density Testing with Crank</span></span>

<span data-ttu-id="e3590-104">por [Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="e3590-104">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

[!INCLUDE [Consider ASP.NET Core SignalR](~/includes/signalr/signalr-version-disambiguation.md)]

> <span data-ttu-id="e3590-105">Este artigo descreve como usar a ferramenta de pedais para testar um aplicativo com vários clientes simulados.</span><span class="sxs-lookup"><span data-stu-id="e3590-105">This article describes how to use the Crank tool to test an application with multiple simulated clients.</span></span>

<span data-ttu-id="e3590-106">Depois que o aplicativo estiver em execução em seu ambiente de hospedagem (uma função Web do Azure, o IIS ou o autohospedado usando Owin), você poderá testar a resposta do aplicativo para um alto nível de densidade de conexão usando a ferramenta de distribuição.</span><span class="sxs-lookup"><span data-stu-id="e3590-106">Once your application is running in its hosting environment (either an Azure web role, IIS, or self-hosted using Owin), you can test application's response to a high level of connection density using the Crank tool.</span></span> <span data-ttu-id="e3590-107">O ambiente de hospedagem pode ser um servidor Serviços de Informações da Internet (IIS), um host Owin ou uma função Web do Azure.</span><span class="sxs-lookup"><span data-stu-id="e3590-107">The hosting environment can be an Internet Information Services (IIS) server, an Owin host, or an Azure web role.</span></span> <span data-ttu-id="e3590-108">(Observação: os contadores de desempenho não estão disponíveis em aplicativos Web do Azure App Service, portanto, você não poderá obter dados de desempenho de um teste de densidade de conexão.)</span><span class="sxs-lookup"><span data-stu-id="e3590-108">(Note: Performance counters are not available on Azure App Service Web Apps, so you will not be able to get performance data from a connection density test.)</span></span>

<span data-ttu-id="e3590-109">A densidade de conexão refere-se ao número de conexões TCP simultâneas que podem ser estabelecidas em um servidor.</span><span class="sxs-lookup"><span data-stu-id="e3590-109">Connection Density refers to the number of simultaneous TCP connections that can be established on a server.</span></span> <span data-ttu-id="e3590-110">Cada conexão TCP incorre em sua própria sobrecarga e a abertura de um grande número de conexões ociosas eventualmente criará um afunilamento de memória.</span><span class="sxs-lookup"><span data-stu-id="e3590-110">Each TCP connection incurs its own overhead, and opening a large number of idle connections will eventually create a memory bottleneck.</span></span>

<span data-ttu-id="e3590-111">[A base de código do signalr](https://github.com/signalr/signalr) inclui uma ferramenta de teste de carga chamada **pedais**.</span><span class="sxs-lookup"><span data-stu-id="e3590-111">[The SignalR codebase](https://github.com/signalr/signalr) includes a load-testing tool called **Crank**.</span></span> <span data-ttu-id="e3590-112">A versão mais recente do pedais pode ser encontrada no [Branch de desenvolvimento](https://github.com/SignalR/signalr/tree/dev) no github.</span><span class="sxs-lookup"><span data-stu-id="e3590-112">The latest version of Crank can be found in [the Dev branch](https://github.com/SignalR/signalr/tree/dev) on GitHub.</span></span> <span data-ttu-id="e3590-113">Você pode baixar um arquivo zip da ramificação de desenvolvimento da base de código do Signalr [aqui](https://github.com/SignalR/SignalR/archive/dev.zip).</span><span class="sxs-lookup"><span data-stu-id="e3590-113">You can download a Zip archive of the Dev branch of the SignalR codebase [here](https://github.com/SignalR/SignalR/archive/dev.zip).</span></span>

<span data-ttu-id="e3590-114">O pedais pode ser usado para saturar totalmente a memória do servidor a fim de calcular o número total de conexões ociosas possíveis no hardware do servidor.</span><span class="sxs-lookup"><span data-stu-id="e3590-114">Crank may be used to fully saturate the server's memory in order to calculate the total number of idle connections possible on the server hardware.</span></span> <span data-ttu-id="e3590-115">Como alternativa, você também pode usar o pedais para testar a carga do servidor sob uma determinada quantidade de pressão de memória, aumentando as conexões até que uma contagem específica ou um limite de memória específico seja atingido.</span><span class="sxs-lookup"><span data-stu-id="e3590-115">Alternatively, you may also use Crank to load test the server under a certain amount of memory pressure, by ramping up connections until a specific count or a specific memory threshold is reached.</span></span>

<span data-ttu-id="e3590-116">Ao testar, é importante usar os clientes remotos para evitar qualquer competição por recursos (por exemplo, conexões TCP e memória).</span><span class="sxs-lookup"><span data-stu-id="e3590-116">When testing, it is important to use remote client(s) to avoid any competition for resources (i.e., TCP connections and memory).</span></span> <span data-ttu-id="e3590-117">Monitore os clientes para garantir que eles não estejam atingindo nenhum afunilamento que possa impedir que o servidor atinja sua capacidade total (memória ou CPU).</span><span class="sxs-lookup"><span data-stu-id="e3590-117">Monitor the client(s) to ensure that they are not hitting any bottlenecks that may prevent the server from reaching its full capacity (memory or CPU).</span></span> <span data-ttu-id="e3590-118">Pode ser necessário aumentar o número de clientes para carregar totalmente o servidor.</span><span class="sxs-lookup"><span data-stu-id="e3590-118">You may need to increase the number of clients in order to fully load the server.</span></span>

### <a name="running-a-connection-density-test"></a><span data-ttu-id="e3590-119">Executando um teste de densidade de conexão</span><span class="sxs-lookup"><span data-stu-id="e3590-119">Running a Connection Density Test</span></span>

<span data-ttu-id="e3590-120">Esta seção descreve as etapas necessárias para executar um teste de densidade de conexão em um aplicativo Signalr.</span><span class="sxs-lookup"><span data-stu-id="e3590-120">This section describes the steps needed to run a connection density test on a SignalR application.</span></span>

1. <span data-ttu-id="e3590-121">Baixe e Compile a [ramificação de desenvolvimento da base de código do signalr](https://github.com/SignalR/SignalR/archive/dev.zip).</span><span class="sxs-lookup"><span data-stu-id="e3590-121">Download and build the [Dev branch of the SignalR codebase](https://github.com/SignalR/SignalR/archive/dev.zip).</span></span> <span data-ttu-id="e3590-122">Em um prompt de comando, navegue até &lt;diretório do projeto&gt;\src\Microsoft.AspNet.SignalR.Crank\bin\debug.</span><span class="sxs-lookup"><span data-stu-id="e3590-122">In a command prompt, navigate to &lt;project directory&gt;\src\Microsoft.AspNet.SignalR.Crank\bin\debug.</span></span>
2. <span data-ttu-id="e3590-123">Implante seu aplicativo em seu ambiente de hospedagem pretendido.</span><span class="sxs-lookup"><span data-stu-id="e3590-123">Deploy your application to its intended hosting environment.</span></span> <span data-ttu-id="e3590-124">Anote o ponto de extremidade que seu aplicativo usa; por exemplo, no aplicativo criado no [tutorial introdução](../getting-started/tutorial-getting-started-with-signalr.md), o ponto de extremidade é `http://<yourhost>:8080/signalr`.</span><span class="sxs-lookup"><span data-stu-id="e3590-124">Make a note of the endpoint that your application uses; for example, in the application created in the [Getting Started tutorial](../getting-started/tutorial-getting-started-with-signalr.md), the endpoint is `http://<yourhost>:8080/signalr`.</span></span>
3. <span data-ttu-id="e3590-125">Instale [contadores de desempenho do signalr](signalr-performance.md#perfcounters) no servidor.</span><span class="sxs-lookup"><span data-stu-id="e3590-125">Install [SignalR performance counters](signalr-performance.md#perfcounters) on the server.</span></span> <span data-ttu-id="e3590-126">Se seu aplicativo estiver em execução no Azure, consulte [usando contadores de desempenho do signalr em uma função Web do Azure](using-signalr-performance-counters-in-an-azure-web-role.md).</span><span class="sxs-lookup"><span data-stu-id="e3590-126">If your application is running on Azure, see [Using SignalR Performance Counters in an Azure Web Role](using-signalr-performance-counters-in-an-azure-web-role.md).</span></span>

<span data-ttu-id="e3590-127">Depois de baixar e criar a base de código e instalar os contadores de desempenho em seu host, a ferramenta de linha de comando do pedais pode ser encontrada na pasta `src\Microsoft.AspNet.SignalR.Crank\bin\Debug`.</span><span class="sxs-lookup"><span data-stu-id="e3590-127">Once you've downloaded and built the codebase, and installed performance counters on your host, the Crank command-line tool can be found in the `src\Microsoft.AspNet.SignalR.Crank\bin\Debug` folder.</span></span>

<span data-ttu-id="e3590-128">As opções disponíveis para a ferramenta de pedais incluem:</span><span class="sxs-lookup"><span data-stu-id="e3590-128">Available options for the Crank tool include:</span></span>

- <span data-ttu-id="e3590-129">**/?** : Mostra a tela de ajuda.</span><span class="sxs-lookup"><span data-stu-id="e3590-129">**/?**: Shows the help screen.</span></span> <span data-ttu-id="e3590-130">As opções disponíveis também serão exibidas se o parâmetro de **URL** for omitido.</span><span class="sxs-lookup"><span data-stu-id="e3590-130">The available options are also displayed if the **Url** parameter is omitted.</span></span>
- <span data-ttu-id="e3590-131">**/URL**: a URL para conexões de signalr.</span><span class="sxs-lookup"><span data-stu-id="e3590-131">**/Url**: The URL for SignalR connections.</span></span> <span data-ttu-id="e3590-132">Este parâmetro é obrigatório.</span><span class="sxs-lookup"><span data-stu-id="e3590-132">This parameter is required.</span></span> <span data-ttu-id="e3590-133">Para um aplicativo Signalr usando o mapeamento padrão, o caminho terminará em "/signalr".</span><span class="sxs-lookup"><span data-stu-id="e3590-133">For a SignalR application using the default mapping, the path will end in "/signalr".</span></span>
- <span data-ttu-id="e3590-134">**/Transport**: o nome do transporte usado.</span><span class="sxs-lookup"><span data-stu-id="e3590-134">**/Transport**: The name of the transport used.</span></span> <span data-ttu-id="e3590-135">O padrão é `auto`, que selecionará o melhor protocolo disponível.</span><span class="sxs-lookup"><span data-stu-id="e3590-135">The default is `auto`, which will select the best available protocol.</span></span> <span data-ttu-id="e3590-136">As opções incluem `WebSockets`, `ServerSentEvents`e `LongPolling` (`ForeverFrame` não é uma opção para o pedais, já que o cliente .NET em vez do Internet Explorer é usado).</span><span class="sxs-lookup"><span data-stu-id="e3590-136">Options include `WebSockets`, `ServerSentEvents`, and `LongPolling` (`ForeverFrame` is not an option for Crank, since the .NET client rather than Internet Explorer is used).</span></span> <span data-ttu-id="e3590-137">Para obter mais informações sobre como o Signalr seleciona transportes, consulte [transportes e fallbacks](../getting-started/introduction-to-signalr.md#transports).</span><span class="sxs-lookup"><span data-stu-id="e3590-137">For more information on how SignalR selects transports, see [Transports and Fallbacks](../getting-started/introduction-to-signalr.md#transports).</span></span>
- <span data-ttu-id="e3590-138">**/BatchSize**: o número de clientes adicionados em cada lote.</span><span class="sxs-lookup"><span data-stu-id="e3590-138">**/BatchSize**: The number of clients added in each batch.</span></span> <span data-ttu-id="e3590-139">O padrão é 50.</span><span class="sxs-lookup"><span data-stu-id="e3590-139">The default is 50.</span></span>
- <span data-ttu-id="e3590-140">**/ConnectInterval**: o intervalo em milissegundos entre a adição de conexões.</span><span class="sxs-lookup"><span data-stu-id="e3590-140">**/ConnectInterval**: The interval in milliseconds between adding connections.</span></span> <span data-ttu-id="e3590-141">O padrão é 500.</span><span class="sxs-lookup"><span data-stu-id="e3590-141">The default is 500.</span></span>
- <span data-ttu-id="e3590-142">**/Connections**: o número de conexões usadas para carregar e testar o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e3590-142">**/Connections**: The number of connections used to load-test the application.</span></span> <span data-ttu-id="e3590-143">O padrão é 100.000.</span><span class="sxs-lookup"><span data-stu-id="e3590-143">The default is 100,000.</span></span>
- <span data-ttu-id="e3590-144">**/ConnectTimeout**: o tempo limite em segundos antes de abortar o teste.</span><span class="sxs-lookup"><span data-stu-id="e3590-144">**/ConnectTimeout**: The timeout in seconds before aborting the test.</span></span> <span data-ttu-id="e3590-145">O padrão é 300.</span><span class="sxs-lookup"><span data-stu-id="e3590-145">The default is 300.</span></span>
- <span data-ttu-id="e3590-146">**MinServerMBytes**: o mínimo de megabytes do servidor a alcançar.</span><span class="sxs-lookup"><span data-stu-id="e3590-146">**MinServerMBytes**: The minimum server megabytes to reach.</span></span> <span data-ttu-id="e3590-147">O padrão é 500.</span><span class="sxs-lookup"><span data-stu-id="e3590-147">The default is 500.</span></span>
- <span data-ttu-id="e3590-148">**SendBytes**: o tamanho da carga enviada ao servidor em bytes.</span><span class="sxs-lookup"><span data-stu-id="e3590-148">**SendBytes**: The size of the payload sent to the server in bytes.</span></span> <span data-ttu-id="e3590-149">O padrão é 0.</span><span class="sxs-lookup"><span data-stu-id="e3590-149">The default is 0.</span></span>
- <span data-ttu-id="e3590-150">**SendInterval**: o atraso em milissegundos entre as mensagens para o servidor.</span><span class="sxs-lookup"><span data-stu-id="e3590-150">**SendInterval**: The delay in milliseconds between messages to the server.</span></span> <span data-ttu-id="e3590-151">O padrão é 500.</span><span class="sxs-lookup"><span data-stu-id="e3590-151">The default is 500.</span></span>
- <span data-ttu-id="e3590-152">**SendTimeout**: o tempo limite em milissegundos para mensagens para o servidor.</span><span class="sxs-lookup"><span data-stu-id="e3590-152">**SendTimeout**: The timeout in milliseconds for messages to the server.</span></span> <span data-ttu-id="e3590-153">O padrão é 300.</span><span class="sxs-lookup"><span data-stu-id="e3590-153">The default is 300.</span></span>
- <span data-ttu-id="e3590-154">**ControllerUrl**: a URL em que um cliente hospedará um Hub do controlador.</span><span class="sxs-lookup"><span data-stu-id="e3590-154">**ControllerUrl**: The Url where one client will host a controller hub.</span></span> <span data-ttu-id="e3590-155">O padrão é NULL (sem Hub do controlador).</span><span class="sxs-lookup"><span data-stu-id="e3590-155">The default is null (no controller hub).</span></span> <span data-ttu-id="e3590-156">O Hub do controlador é iniciado quando a sessão de pedais é iniciada; Não é feito nenhum contato adicional entre o Hub do controlador e o pedais.</span><span class="sxs-lookup"><span data-stu-id="e3590-156">The controller hub is started when the Crank session starts; no further contact between the controller hub and Crank is made.</span></span>
- <span data-ttu-id="e3590-157">**NumClients**: o número de clientes simulados para se conectar ao aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e3590-157">**NumClients**: The number of simulated clients to connect to the application.</span></span> <span data-ttu-id="e3590-158">O padrão é um.</span><span class="sxs-lookup"><span data-stu-id="e3590-158">The default is one.</span></span>
- <span data-ttu-id="e3590-159">**Logfile**: o FileName do arquivo de log para a execução de teste.</span><span class="sxs-lookup"><span data-stu-id="e3590-159">**Logfile**: The filename for the logfile for the test run.</span></span> <span data-ttu-id="e3590-160">O padrão é `crank.csv`.</span><span class="sxs-lookup"><span data-stu-id="e3590-160">The default is `crank.csv`.</span></span>
- <span data-ttu-id="e3590-161">**SampleInterval**: o tempo em milissegundos entre os exemplos do contador de desempenho.</span><span class="sxs-lookup"><span data-stu-id="e3590-161">**SampleInterval**: The time in milliseconds between performance counter samples.</span></span> <span data-ttu-id="e3590-162">O padrão é 1000.</span><span class="sxs-lookup"><span data-stu-id="e3590-162">The default is 1000.</span></span>
- <span data-ttu-id="e3590-163">**SignalRInstance**: o nome da instância para os contadores de desempenho no servidor.</span><span class="sxs-lookup"><span data-stu-id="e3590-163">**SignalRInstance**: The instance name for the performance counters on the server.</span></span> <span data-ttu-id="e3590-164">O padrão é usar o estado de conexão do cliente.</span><span class="sxs-lookup"><span data-stu-id="e3590-164">The default is to use the client connection state.</span></span>

### <a name="example"></a><span data-ttu-id="e3590-165">Exemplo</span><span class="sxs-lookup"><span data-stu-id="e3590-165">Example</span></span>

<span data-ttu-id="e3590-166">O comando a seguir testará um site chamado `pfsignalr` no Azure que hospeda um aplicativo na porta 8080 com um Hub chamado "ControllerHub", usando conexões 100.</span><span class="sxs-lookup"><span data-stu-id="e3590-166">The following command will test a site called `pfsignalr` on Azure that hosts an application on port 8080 with a hub named "ControllerHub", using 100 connections.</span></span>

`crank /Connections:100 /Url:http://pfsignalr.cloudapp.net:8080/signalr`
