---
uid: visual-studio/overview/2012/windows-azure-authentication
title: Autenticação do Windows Azure | Microsoft Docs
author: Rick-Anderson
description: As ferramentas de Microsoft ASP.NET para o Windows Azure Active Directory simplificam a habilitação da autenticação para aplicativos Web hospedados em sites do Windows Azure....
ms.author: riande
ms.date: 02/20/2013
ms.assetid: a3cef801-a54b-4ebd-93c3-55764e2e14b1
msc.legacyurl: /visual-studio/overview/2012/windows-azure-authentication
msc.type: authoredcontent
ms.openlocfilehash: ce98effe18dd739504fb0d5453bae8a46c3ba102
ms.sourcegitcommit: 7709c0a091b8d55b7b33bad8849f7b66b23c3d72
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 02/19/2020
ms.locfileid: "77457473"
---
# <a name="windows-azure-authentication"></a><span data-ttu-id="04ea8-103">Autenticação do Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="04ea8-103">Windows Azure Authentication</span></span>

<span data-ttu-id="04ea8-104">por [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="04ea8-104">by [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

> <span data-ttu-id="04ea8-105">As ferramentas de Microsoft ASP.NET para o Windows Azure Active Directory simplificam a habilitação da autenticação para aplicativos Web hospedados em [sites do Windows Azure](https://www.windowsazure.com/home/features/web-sites/).</span><span class="sxs-lookup"><span data-stu-id="04ea8-105">Microsoft ASP.NET tools for Windows Azure Active Directory makes it simple to enable authentication for web applications hosted on [Windows Azure Web Sites](https://www.windowsazure.com/home/features/web-sites/).</span></span> <span data-ttu-id="04ea8-106">Você pode usar a autenticação do Windows Azure para autenticar usuários do Office 365 de sua organização, contas corporativas sincronizadas do Active Directory local ou usuários criados em seu próprio domínio personalizado do Windows Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="04ea8-106">You can use Windows Azure Authentication to authenticate Office 365 users from your organization, corporate accounts synced from your on-premise Active Directory or users created in your own custom Windows Azure Active Directory domain.</span></span> <span data-ttu-id="04ea8-107">Habilitar a autenticação do Windows Azure configura seu aplicativo para autenticar usuários usando um único locatário do [Windows Azure Active Directory](https://docs.microsoft.com/azure/active-directory/) .</span><span class="sxs-lookup"><span data-stu-id="04ea8-107">Enabling Windows Azure Authentication configures your application to authenticate users using a single [Windows Azure Active Directory](https://docs.microsoft.com/azure/active-directory/) tenant.</span></span>
>
> <span data-ttu-id="04ea8-108">A ferramenta de autenticação ASP.NET do Windows Azure não tem suporte para funções Web em um serviço de nuvem, mas planejamos fazer isso em uma versão futura.</span><span class="sxs-lookup"><span data-stu-id="04ea8-108">The ASP.NET Windows Azure Authentication tool is not supported for web roles in a cloud service but we plan to do so in a future release.</span></span> <span data-ttu-id="04ea8-109">O [Windows Identity Foundation](https://msdn.microsoft.com/library/hh291066(v=VS.110).aspx) (WIF) tem suporte em funções Web do Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="04ea8-109">[Windows Identity Foundation](https://msdn.microsoft.com/library/hh291066(v=VS.110).aspx) (WIF) is supported in Windows Azure web roles.</span></span>
>
> <span data-ttu-id="04ea8-110">Para obter detalhes sobre como configurar a sincronização entre o Active Directory local e o locatário do Windows Azure Active Directory, consulte [usar AD FS 2,0 para implementar e gerenciar o logon único](https://technet.microsoft.com/library/jj205462.aspx).</span><span class="sxs-lookup"><span data-stu-id="04ea8-110">For details on how to setup synchronization between your on-premise Active Directory and your Windows Azure Active Directory tenant please see [Use AD FS 2.0 to implement and manage single sign-on](https://technet.microsoft.com/library/jj205462.aspx).</span></span>
>
> <span data-ttu-id="04ea8-111">O Windows Azure Active Directory está disponível atualmente como um [serviço de visualização gratuito](https://azure.microsoft.com/free/?WT.mc_id=A443DD604).</span><span class="sxs-lookup"><span data-stu-id="04ea8-111">Windows Azure Active Directory is currently available as a [free preview service](https://azure.microsoft.com/free/?WT.mc_id=A443DD604).</span></span>

## <a name="requirements"></a><span data-ttu-id="04ea8-112">Requisitos:</span><span class="sxs-lookup"><span data-stu-id="04ea8-112">Requirements:</span></span>

- <span data-ttu-id="04ea8-113">Visual Studio 2012 ou [Visual Studio Express 2012](https://www.microsoft.com/visualstudio/11/products/express)</span><span class="sxs-lookup"><span data-stu-id="04ea8-113">Visual Studio 2012 or [Visual Studio Express 2012](https://www.microsoft.com/visualstudio/11/products/express)</span></span>
- <span data-ttu-id="04ea8-114">[Extensões de ferramentas da Web para Visual Studio 2012](https://go.microsoft.com/fwlink/?LinkID=282228&amp;clcid=0x409) ou [extensões de ferramentas da web para Visual Studio Express 2012](https://go.microsoft.com/fwlink/?LinkID=282231&amp;clcid=0x409)</span><span class="sxs-lookup"><span data-stu-id="04ea8-114">[Web Tools Extensions for Visual Studio 2012](https://go.microsoft.com/fwlink/?LinkID=282228&amp;clcid=0x409) or [Web Tools Extensions for Visual Studio Express 2012](https://go.microsoft.com/fwlink/?LinkID=282231&amp;clcid=0x409)</span></span>
- <span data-ttu-id="04ea8-115">[Ferramentas de Microsoft ASP.net para windows Azure Active Directory – Visual Studio 2012](https://go.microsoft.com/fwlink/?LinkID=282306) ou [ferramentas de Microsoft ASP.NET para windows Azure Active Directory – Visual Studio Express 2012 para Web](https://go.microsoft.com/fwlink/?LinkId=282652)</span><span class="sxs-lookup"><span data-stu-id="04ea8-115">[Microsoft ASP.NET Tools for Windows Azure Active Directory – Visual Studio 2012](https://go.microsoft.com/fwlink/?LinkID=282306) or [Microsoft ASP.NET Tools for Windows Azure Active Directory – Visual Studio Express 2012 for Web](https://go.microsoft.com/fwlink/?LinkId=282652)</span></span>

## <a name="create-an-aspnet-web-application-with-visual-studio-2012"></a><span data-ttu-id="04ea8-116">Criar um aplicativo Web ASP.NET com o Visual Studio 2012</span><span class="sxs-lookup"><span data-stu-id="04ea8-116">Create an ASP.NET Web Application with Visual Studio 2012</span></span>

<span data-ttu-id="04ea8-117">Você pode criar qualquer aplicativo Web com o Visual Studio 2012, este tutorial usa o modelo de intranet ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="04ea8-117">You can create any Web Application with Visual Studio 2012, this tutorial uses the ASP.NET MVC intranet template.</span></span>

1. <span data-ttu-id="04ea8-118">Crie um novo aplicativo de intranet do ASP.NET MVC 4 e aceite todos os padrões.</span><span class="sxs-lookup"><span data-stu-id="04ea8-118">Create a new ASP.NET MVC 4 Intranet Application and accept all the defaults.</span></span> <span data-ttu-id="04ea8-119">(Deve ser um no **Traversal** net e não no projeto **de rede** de entrada).</span><span class="sxs-lookup"><span data-stu-id="04ea8-119">(It must be an In **tra** net and not In **ter** net project).</span></span>
     ![](windows-azure-authentication/_static/image1.png)

## <a name="enable-window-azure-authentication-when-you-are-a-global-administrator-of-the-tenet"></a><span data-ttu-id="04ea8-120">Habilitar a autenticação do Windows Azure (quando você for um administrador global da filosofia)</span><span class="sxs-lookup"><span data-stu-id="04ea8-120">Enable Window Azure Authentication (When you are a Global Administrator of the Tenet)</span></span>

<span data-ttu-id="04ea8-121">Se você não tiver um locatário do Windows Azure Active Directory existente (por exemplo, por meio de uma conta existente do Office 365), poderá criar um novo locatário inscrevendo-se em uma [nova conta do Windows Azure Active Directory](https://g.microsoftonline.com/0AX00en/5).</span><span class="sxs-lookup"><span data-stu-id="04ea8-121">If you do not have an existing Windows Azure Active Directory tenant (For example, through an existing Office 365 account) you can create a new tenant by signing up for a [new Windows Azure Active Directory account](https://g.microsoftonline.com/0AX00en/5).</span></span>

1. <span data-ttu-id="04ea8-122">No menu do projeto, selecione **habilitar autenticação do Windows Azure**:</span><span class="sxs-lookup"><span data-stu-id="04ea8-122">From the Project menu select **Enable Windows Azure Authentication**:</span></span>

   ![](windows-azure-authentication/_static/image2.png)

2. <span data-ttu-id="04ea8-123">Insira o domínio para seu locatário do Windows Azure Active Directory (por exemplo, contoso.onmicrosoft.com) e clique em **habilitar**:</span><span class="sxs-lookup"><span data-stu-id="04ea8-123">Enter the domain for your Windows Azure Active Directory tenant (for example, contoso.onmicrosoft.com) and click **Enable**:</span></span>

![](windows-azure-authentication/_static/image3.png)

3. <span data-ttu-id="04ea8-124">Na caixa de diálogo autenticação da Web, entre como um administrador para seu locatário do Windows Azure Active Directory:</span><span class="sxs-lookup"><span data-stu-id="04ea8-124">In the Web Authentication dialog sign in as an administrator for your Windows Azure Active Directory tenant:</span></span>

   ![](windows-azure-authentication/_static/image4.png)

![](windows-azure-authentication/_static/image5.png)

## <a name="enable-window-azure-by-a-non-administrator-of-the-tenet"></a><span data-ttu-id="04ea8-125">Habilitar o Windows Azure por um não administrador da filosofia</span><span class="sxs-lookup"><span data-stu-id="04ea8-125">Enable Window Azure by a non-administrator of the Tenet</span></span>

<span data-ttu-id="04ea8-126">Se você não tiver o privilégio de administrador global para seu locatário do Windows Azure Active Directory, você poderá desmarcar a caixa de seleção para provisionar o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="04ea8-126">If you do not have Global Administrator privilege for your Windows Azure Active Directory tenant, you can uncheck the checkbox for provisioning the application.</span></span>

![](windows-azure-authentication/_static/image6.png)

<span data-ttu-id="04ea8-127">A caixa de diálogo exibirá o **domínio**, a **ID da entidade de segurança do aplicativo** e a URL de **resposta** , que são necessários para provisionar o aplicativo com um Azure Active Directory filosofia.</span><span class="sxs-lookup"><span data-stu-id="04ea8-127">The dialog will display the **Domain**, **Application Principal Id** and **Reply URL** which are required for provisioning the application with an Azure Active Directory tenet.</span></span> <span data-ttu-id="04ea8-128">Você precisa fornecer essas informações a alguém que tenha privilégios suficientes para provisionar o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="04ea8-128">You need to give this information to someone who has sufficient privilege to provision the application.</span></span> <span data-ttu-id="04ea8-129">Consulte[como implementar o logon único com o Windows Azure Active Directory-aplicativo ASP.net](https://github.com/Azure-Samples/active-directory-dotnet-webapp-openidconnect) para obter detalhes sobre como usar o cmdlet para criar a entidade de serviço manualmente.</span><span class="sxs-lookup"><span data-stu-id="04ea8-129">See[How to implement single sign-on with Windows Azure Active Directory - ASP.NET Application](https://github.com/Azure-Samples/active-directory-dotnet-webapp-openidconnect) for details on how to use cmdlet to create the service principal manually.</span></span>
<span data-ttu-id="04ea8-130">Depois que o aplicativo tiver sido provisionado com êxito, você poderá clicar em **continuar para atualizar o Web. config com as configurações selecionadas**.</span><span class="sxs-lookup"><span data-stu-id="04ea8-130">Once the application has been successfully provisioned, you can click on **Continue to update web.config with the selected settings**.</span></span> <span data-ttu-id="04ea8-131">Se você quiser continuar desenvolvendo o aplicativo enquanto aguarda o provisionamento acontecer, clique em **fechar para lembrar as configurações no arquivo de projeto**.</span><span class="sxs-lookup"><span data-stu-id="04ea8-131">If you want to continue developing the application while waiting for provisioning to happen, you can click **Close to remember the settings in project file**.</span></span> <span data-ttu-id="04ea8-132">Na próxima vez que você invocar habilitar a autenticação do Windows Azure e desmarcar a caixa de seleção provisionamento, verá as mesmas configurações e poderá clicar em **continuar**e, em seguida, **aplicar essas configurações em Web. config**.</span><span class="sxs-lookup"><span data-stu-id="04ea8-132">The next time you invoke Enable Windows Azure Authentication and uncheck the provisioning checkbox, you will see the same settings and you can click **Continue**, then click, **Apply these settings in web.config**.</span></span>

1. <span data-ttu-id="04ea8-133">Aguarde enquanto o aplicativo é configurado para autenticação do Windows Azure e provisionado com o Windows Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="04ea8-133">Wait while your application is configured for Windows Azure Authentication and provisioned with Windows Azure Active Directory.</span></span>
2. <span data-ttu-id="04ea8-134">Depois que a autenticação do Windows Azure tiver sido habilitada para seu aplicativo, clique em **fechar:**</span><span class="sxs-lookup"><span data-stu-id="04ea8-134">Once Windows Azure Authentication has been enabled for your application, click **Close:**</span></span>

    ![](windows-azure-authentication/_static/image7.png)
3. <span data-ttu-id="04ea8-135">Pressione F5 para executar o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="04ea8-135">Hit F5 to run your application.</span></span> <span data-ttu-id="04ea8-136">Você deve ser automaticamente redirecionado para a página de logon.</span><span class="sxs-lookup"><span data-stu-id="04ea8-136">You should automatically get redirected to login page.</span></span> <span data-ttu-id="04ea8-137">Use as credenciais de usuário da filosofia do diretório para fazer logon no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="04ea8-137">Use the directory tenet user credentials to login to the application..</span></span>

    ![](windows-azure-authentication/_static/image1.jpg)
4. <span data-ttu-id="04ea8-138">Como seu aplicativo está usando um certificado de teste autoassinado, você receberá um aviso do navegador de que o certificado não foi emitido por uma autoridade de certificação confiável.</span><span class="sxs-lookup"><span data-stu-id="04ea8-138">Because your application is currently using a self-signed test certificate you will receive a warning from the browser that the certificate was not issued by a trusted certificate authority.</span></span>

    <span data-ttu-id="04ea8-139">Esse aviso pode ser ignorado com segurança durante o desenvolvimento local clicando em **continuar neste site:**</span><span class="sxs-lookup"><span data-stu-id="04ea8-139">This warning can be safely ignored during local development by clicking **Continue to this website:**</span></span>

    ![](windows-azure-authentication/_static/image8.png)
5. <span data-ttu-id="04ea8-140">Agora você fez logon com êxito no seu aplicativo usando a autenticação do Windows Azure!</span><span class="sxs-lookup"><span data-stu-id="04ea8-140">You have now successfully logged in to your application using Windows Azure Authentication!</span></span>

    ![](windows-azure-authentication/_static/image2.jpg)

<span data-ttu-id="04ea8-141">Habilitar a autenticação do Windows Azure faz as seguintes alterações em seu aplicativo:</span><span class="sxs-lookup"><span data-stu-id="04ea8-141">Enabling Windows Azure authentication makes the following changes to your application:</span></span>

- <span data-ttu-id="04ea8-142">Uma classe[antiCSRF](https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF))(solicitação de site forjada) ( *aplicativo\_Start\AntiXsrfConfig.cs* ) é adicionada ao seu projeto.</span><span class="sxs-lookup"><span data-stu-id="04ea8-142">An Anti-Cross-Site Request Forgery ([CSRF](https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF))) class ( *App\_Start\AntiXsrfConfig.cs* ) is added to your project.</span></span>
- <span data-ttu-id="04ea8-143">Os pacotes NuGet `System.IdentityModel.Tokens.ValidatingIssuerNameRegistry` são adicionados ao seu projeto.</span><span class="sxs-lookup"><span data-stu-id="04ea8-143">The NuGet packages `System.IdentityModel.Tokens.ValidatingIssuerNameRegistry` is added to your project.</span></span>
- <span data-ttu-id="04ea8-144">As configurações do Windows Identity Foundation em seu aplicativo serão configuradas para aceitar tokens de segurança do seu locatário do Windows Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="04ea8-144">Windows Identity Foundation settings in your application will be configured to accept security tokens from your Windows Azure Active Directory tenant.</span></span> <span data-ttu-id="04ea8-145">Clique na imagem abaixo para ver uma exibição expandida das alterações feitas no arquivo *Web. config* .</span><span class="sxs-lookup"><span data-stu-id="04ea8-145">Click on the image below to see an expanded view of the changes made to the *Web.config* file.</span></span>

     ![](windows-azure-authentication/_static/image9.png)
- <span data-ttu-id="04ea8-146">Uma entidade de serviço para seu aplicativo no seu locatário do Windows Azure Active Directory será provisionada.</span><span class="sxs-lookup"><span data-stu-id="04ea8-146">A service principal for your application in your Windows Azure Active Directory tenant will be provisioned.</span></span>
- <span data-ttu-id="04ea8-147">O HTTPS está habilitado.</span><span class="sxs-lookup"><span data-stu-id="04ea8-147">HTTPS is enabled.</span></span>

## <a name="deploy-the-application-to-windows-azure"></a><span data-ttu-id="04ea8-148">Implantar o aplicativo no Windows Azure</span><span class="sxs-lookup"><span data-stu-id="04ea8-148">Deploy the application to Windows Azure</span></span>

<span data-ttu-id="04ea8-149">Para obter instruções completas, consulte [implantando um aplicativo Web ASP.net em um site do Windows Azure](https://docs.microsoft.com/azure/app-service-web/app-service-web-get-started-dotnet).</span><span class="sxs-lookup"><span data-stu-id="04ea8-149">For complete instructions, see [Deploying an ASP.NET Web Application to a Windows Azure Web Site](https://docs.microsoft.com/azure/app-service-web/app-service-web-get-started-dotnet).</span></span>

<span data-ttu-id="04ea8-150">Para publicar um aplicativo usando a autenticação do Windows Azure em um site do Azure:</span><span class="sxs-lookup"><span data-stu-id="04ea8-150">To publish an application using Windows Azure Authentication to an Azure Web Site:</span></span>

1. <span data-ttu-id="04ea8-151">Clique com o botão direito do mouse em seu aplicativo e selecione **publicar:**</span><span class="sxs-lookup"><span data-stu-id="04ea8-151">Right click on your application and select **Publish:**</span></span>

    ![](windows-azure-authentication/_static/image3.jpg)
2. <span data-ttu-id="04ea8-152">Na caixa de diálogo Publicar na Web, baixe e importe um perfil de publicação para seu site do Azure.</span><span class="sxs-lookup"><span data-stu-id="04ea8-152">From the Publish Web dialog download and import a publishing profile for your Azure Web Site.</span></span>

    ![](windows-azure-authentication/_static/image4.jpg)
3. <span data-ttu-id="04ea8-153">A guia **conexão** mostra a **URL de destino** (a URL voltada para o público para seu aplicativo).</span><span class="sxs-lookup"><span data-stu-id="04ea8-153">The **Connection** tab shows the **Destination URL** (the public facing URL for your application).</span></span> <span data-ttu-id="04ea8-154">Clique em **validar conexão** para testar sua conexão:</span><span class="sxs-lookup"><span data-stu-id="04ea8-154">Click **Validate Connection** to test your connection:</span></span>

    ![](windows-azure-authentication/_static/image5.jpg)
4. <span data-ttu-id="04ea8-155">Se você publicou neste site do Azure, considere marcar a configuração **remover arquivos adicionais no destino** para garantir que seu aplicativo seja publicado corretamente.</span><span class="sxs-lookup"><span data-stu-id="04ea8-155">If you have published to this Azure Web Site previously consider checking the **Remove additional files at destination** setting to ensure your application publishes cleanly.</span></span> <span data-ttu-id="04ea8-156">Observe que a caixa de seleção **habilitar a autenticação do Windows Azure** está marcada.</span><span class="sxs-lookup"><span data-stu-id="04ea8-156">Notice the **Enable Windows Azure Authentication** check box is selected.</span></span>

    ![](windows-azure-authentication/_static/image10.png)
5. <span data-ttu-id="04ea8-157">Opcional: na guia **Visualizar** , clique em **Iniciar visualização** para ver os arquivos implantados.</span><span class="sxs-lookup"><span data-stu-id="04ea8-157">Optional: On the **Preview** tab click **Start Preview** to see the files deployed.</span></span>

    ![](windows-azure-authentication/_static/image6.jpg)
6. <span data-ttu-id="04ea8-158">Clique em **publicar.**</span><span class="sxs-lookup"><span data-stu-id="04ea8-158">Click **Publish.**</span></span>

    <span data-ttu-id="04ea8-159">Você será solicitado a habilitar a autenticação do Windows Azure para o host de destino.</span><span class="sxs-lookup"><span data-stu-id="04ea8-159">You will be prompted to enable Windows Azure Authentication for the target host.</span></span> <span data-ttu-id="04ea8-160">Clique em **habilitar** para continuar:</span><span class="sxs-lookup"><span data-stu-id="04ea8-160">Click **Enable** to continue:</span></span>

    ![](windows-azure-authentication/_static/image11.png)
7. <span data-ttu-id="04ea8-161">Insira suas credenciais de administrador para seu locatário do Windows Azure Active Directory:</span><span class="sxs-lookup"><span data-stu-id="04ea8-161">Enter your administrator credentials for your Windows Azure Active Directory tenant:</span></span>

    ![](windows-azure-authentication/_static/image7.jpg)
8. <span data-ttu-id="04ea8-162">Depois que o aplicativo for publicado com êxito, um navegador será aberto no site da Web publicado.</span><span class="sxs-lookup"><span data-stu-id="04ea8-162">Once your application has been successfully published, a browser will open to the published web site.</span></span>

    > [!NOTE]
    > <span data-ttu-id="04ea8-163">Pode levar até cinco minutos (normalmente deve menos) para que seu aplicativo seja totalmente provisionado com o Windows Azure Active Directory depois de habilitar a autenticação do Windows Azure para o host de destino.</span><span class="sxs-lookup"><span data-stu-id="04ea8-163">It may take up to five minutes (typically must less) for your application to be fully provisioned with Windows Azure Active Directory after enabling Windows Azure Authentication for the target host.</span></span> <span data-ttu-id="04ea8-164">Quando você executar o aplicativo pela primeira vez, se receber o erro ACS50001: a terceira parte confiável com o nome ' [Realm] ' não foi encontrada, aguarde alguns minutos e tente executar o aplicativo novamente.</span><span class="sxs-lookup"><span data-stu-id="04ea8-164">When you first run your application if you receive error ACS50001: Relying party with name ‘[realm]' was not found, then wait a few minutes and try running the application again.</span></span>
9. <span data-ttu-id="04ea8-165">Quando solicitado, faça logon como um usuário em seu diretório:</span><span class="sxs-lookup"><span data-stu-id="04ea8-165">When prompted, log in as a user in your directory:</span></span>

    ![](windows-azure-authentication/_static/image8.jpg)
10. <span data-ttu-id="04ea8-166">Agora você fez logon com êxito no seu aplicativo hospedado do Azure usando a autenticação do Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="04ea8-166">You have now successfully logged into your Azure hosted application using Windows Azure Authentication.</span></span>

     ![](windows-azure-authentication/_static/image9.jpg)

## <a name="known-issues"></a><span data-ttu-id="04ea8-167">Problemas conhecidos</span><span class="sxs-lookup"><span data-stu-id="04ea8-167">Known Issues</span></span>

#### <a name="role-based-authorization-fails-when-using-windows-azure-authentication"></a><span data-ttu-id="04ea8-168">A autorização baseada em função falha ao usar a autenticação do Windows Azure</span><span class="sxs-lookup"><span data-stu-id="04ea8-168">Role-based authorization fails when using Windows Azure Authentication</span></span>

<span data-ttu-id="04ea8-169">No momento, a autenticação do Windows Azure não fornece a declaração de função necessária para que a autorização baseada em função possa ser executada.</span><span class="sxs-lookup"><span data-stu-id="04ea8-169">Windows Azure Authentication does not currently provide the necessary role claim so that role-based authorization can be performed.</span></span> <span data-ttu-id="04ea8-170">A função do usuário autenticado deve ser recuperada manualmente do Windows Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="04ea8-170">The role of the authenticated user must be manually retrieved from Windows Azure Active Directory.</span></span>

#### <a name="browsing-to-an-application-with-windows-azure-authentication-results-in-the-error-acs20016-the-domain-of-the-logged-in-user-livecom-does-not-match-any-allowed-domain-of-this-sts"></a><span data-ttu-id="04ea8-171">Navegar até um aplicativo com a autenticação do Windows Azure resulta no erro "ACS20016 o domínio do usuário conectado (live.com) não corresponde a nenhum domínio permitido deste STS"</span><span class="sxs-lookup"><span data-stu-id="04ea8-171">Browsing to an application with Windows Azure Authentication results in the error "ACS20016 The domain of the logged in user (live.com) does not match any allowed domain of this STS"</span></span>

<span data-ttu-id="04ea8-172">Se você já estiver conectado a uma conta da Microsoft (por exemplo, hotmail.com, live.com, outlook.com) e tentar acessar um aplicativo que habilitou a autenticação do Windows Azure, poderá receber uma resposta de erro 400, pois o domínio da sua conta da Microsoft Não é reconhecido pelo Windows Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="04ea8-172">If you are already logged in to a Microsoft Account (for example hotmail.com, live.com, outlook.com) and you attempt to access an application that has enabled Windows Azure Authentication you may get a 400 error response because the domain of your Microsoft Account is not recognized by Windows Azure Active Directory.</span></span> <span data-ttu-id="04ea8-173">Para fazer logon no aplicativo, faça logoff da sua conta da Microsoft primeiro.</span><span class="sxs-lookup"><span data-stu-id="04ea8-173">To log into the application, log out from your Microsoft Account first.</span></span>

#### <a name="logging-into-an-application-with-windows-azure-authentication-enabled-and-a-x509certificatevalidationmode-other-than-none-results-in-certificate-validation-errors-for-the-accountsaccesscontrolwindowsnet-certificate"></a><span data-ttu-id="04ea8-174">Fazer logon em um aplicativo com a autenticação do Windows Azure habilitada e um X509CertificateValidationMode diferente de nenhum resulta em erros de validação de certificado para o certificado accounts.accesscontrol.windows.net</span><span class="sxs-lookup"><span data-stu-id="04ea8-174">Logging into an application with Windows Azure Authentication enabled and a X509CertificateValidationMode other than None results in certificate validation errors for the accounts.accesscontrol.windows.net certificate</span></span>

<span data-ttu-id="04ea8-175">A validação de certificado não é necessária e deve ser deixada desabilitada.</span><span class="sxs-lookup"><span data-stu-id="04ea8-175">Certificate validation is not required and should be left disabled.</span></span> <span data-ttu-id="04ea8-176">A impressão digital do certificado do emissor é validada pelo WSFederationAuthenticationModule.</span><span class="sxs-lookup"><span data-stu-id="04ea8-176">The thumbprint of the issuer certificate is validated by the WSFederationAuthenticationModule.</span></span>

#### <a name="when-attempting-to-enable-windows-azure-authentication-the-web-authentication-dialog-shows-the-error-acs20016-the-domain-of-the-logged-in-user-contosoonmicrosoftcom-does-not-match-any-allowed-domain-of-this-sts"></a><span data-ttu-id="04ea8-177">Ao tentar habilitar a autenticação do Windows Azure, a caixa de diálogo de autenticação da Web mostra o erro "ACS20016: o domínio do usuário conectado (contoso.onmicrosoft.com) não corresponde a nenhum domínio permitido deste STS."</span><span class="sxs-lookup"><span data-stu-id="04ea8-177">When attempting to enable Windows Azure Authentication the Web Authentication dialog shows the error "ACS20016: The domain of the logged in user (contoso.onmicrosoft.com) does not match any allowed domain of this STS."</span></span>

<span data-ttu-id="04ea8-178">Você poderá ver esse erro quando tiver feito logon com êxito usando uma conta diferente do Windows Azure Active Directory de dentro do mesmo processo do Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="04ea8-178">You may see this error when you have previously successfully logged in using a different Windows Azure Active Directory account from within the same Visual Studio process.</span></span> <span data-ttu-id="04ea8-179">Faça logoff da conta especificada ou reinicie o Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="04ea8-179">Log out from the specified account or restart Visual Studio.</span></span> <span data-ttu-id="04ea8-180">Se você fez logon anteriormente e selecionou a opção para "manter-me conectado", talvez seja necessário limpar os cookies do navegador.</span><span class="sxs-lookup"><span data-stu-id="04ea8-180">If you previously logged in and selected the option to "Keep me signed in" then you may need to clear your browser cookies.</span></span>

## <a name="acs20012-the-request-is-not-a-valid-ws-federation-protocol-message"></a><span data-ttu-id="04ea8-181">ACS20012: a solicitação não é uma mensagem de protocolo WS-Federation válida</span><span class="sxs-lookup"><span data-stu-id="04ea8-181">ACS20012: The request is not a valid WS-Federation protocol message</span></span>

<span data-ttu-id="04ea8-182">Isso pode acontecer se você já estiver conectado com alguma outra ID da Microsoft a um dos serviços do Azure.</span><span class="sxs-lookup"><span data-stu-id="04ea8-182">This can happen if you are already logged in with some other Microsoft ID to one of the Azure services.</span></span> <span data-ttu-id="04ea8-183">Use a janela particular do navegador, como InPrivate no IE ou Incognito no Chrome, ou limpe todos os cookies.</span><span class="sxs-lookup"><span data-stu-id="04ea8-183">Use Private browser window like InPrivate in IE or Incognito in Chrome or clear all the cookies.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="04ea8-184">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="04ea8-184">Additional Resources</span></span>

- <span data-ttu-id="04ea8-185">[Microsoft ASP.net Tools for Windows Azure Active Directory – Visual Studio 2012](https://blogs.msdn.com/b/vbertocci/archive/2013/02/18/microsoft-asp-net-tools-for-windows-azure-active-directory-visual-studio-2012.aspx) – Vittorio Bertocci</span><span class="sxs-lookup"><span data-stu-id="04ea8-185">[Microsoft ASP.NET Tools for Windows Azure Active Directory – Visual Studio 2012](https://blogs.msdn.com/b/vbertocci/archive/2013/02/18/microsoft-asp-net-tools-for-windows-azure-active-directory-visual-studio-2012.aspx) – Vittorio Bertocci</span></span>
- [<span data-ttu-id="04ea8-186">Recursos do Windows Azure: identidade</span><span class="sxs-lookup"><span data-stu-id="04ea8-186">Windows Azure Features: Identity</span></span>](https://docs.microsoft.com/azure/active-directory/)
- [<span data-ttu-id="04ea8-187">TechNet: Windows Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="04ea8-187">TechNet: Windows Azure Active Directory</span></span>](https://technet.microsoft.com/library/hh967619.aspx)
- [<span data-ttu-id="04ea8-188">Windows Azure Active Directory: desenvolver aplicativos para sua organização</span><span class="sxs-lookup"><span data-stu-id="04ea8-188">Windows Azure Active Directory: Develop Apps for your organization</span></span>](https://activedirectory.windowsazure.com/Develop/Single-Tenant.aspx)
- [<span data-ttu-id="04ea8-189">Windows Azure Active Directory: desenvolver aplicativos para várias organizações</span><span class="sxs-lookup"><span data-stu-id="04ea8-189">Windows Azure Active Directory: Develop Apps for multiple organizations</span></span>](https://activedirectory.windowsazure.com/Develop/Multi-Tenant.aspx)
- [<span data-ttu-id="04ea8-190">Como implementar o logon único com o Windows Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="04ea8-190">How to implement single sign-on with Windows Azure Active Directory</span></span>](https://github.com/Azure-Samples/active-directory-dotnet-webapp-openidconnect)
- <span data-ttu-id="04ea8-191">[Logon único com o Windows Azure Active Directory: um](https://blogs.msdn.com/b/vbertocci/archive/2012/07/05/single-sign-on-with-windows-azure-active-directory-a-deep-dive.aspx) aprofundamento – Vittorio Bertocci</span><span class="sxs-lookup"><span data-stu-id="04ea8-191">[Single Sign-On with Windows Azure Active Directory: a Deep Dive](https://blogs.msdn.com/b/vbertocci/archive/2012/07/05/single-sign-on-with-windows-azure-active-directory-a-deep-dive.aspx) – Vittorio Bertocci</span></span>
- [<span data-ttu-id="04ea8-192">Use AD FS 2,0 para implementar e gerenciar o logon único</span><span class="sxs-lookup"><span data-stu-id="04ea8-192">Use AD FS 2.0 to implement and manage single sign-on</span></span>](https://technet.microsoft.com/library/jj205462.aspx)
