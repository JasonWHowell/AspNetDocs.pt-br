---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/adding-additional-datatable-columns-cs
title: Adicionando colunas DataTable adicionais (C#) | Microsoft Docs
author: rick-anderson
description: Ao usar o assistente TableAdapter para criar um conjunto de dados tipado, a DataTable correspondente contém as colunas retornadas pela consulta de banco de dados principal. Mas lá...
ms.author: riande
ms.date: 07/18/2007
ms.assetid: 615f3361-f21f-4338-8bc1-fce8ae071de9
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/adding-additional-datatable-columns-cs
msc.type: authoredcontent
ms.openlocfilehash: a96f254aa54e7077456ac1a9bd6c5e2a17619d96
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78552062"
---
# <a name="adding-additional-datatable-columns-c"></a><span data-ttu-id="71574-104">Adicionar mais colunas DataTable (C#)</span><span class="sxs-lookup"><span data-stu-id="71574-104">Adding Additional DataTable Columns (C#)</span></span>

<span data-ttu-id="71574-105">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="71574-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="71574-106">[Baixar código](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_70_CS.zip) ou [baixar PDF](adding-additional-datatable-columns-cs/_static/datatutorial70cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="71574-106">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_70_CS.zip) or [Download PDF](adding-additional-datatable-columns-cs/_static/datatutorial70cs1.pdf)</span></span>

> <span data-ttu-id="71574-107">Ao usar o assistente TableAdapter para criar um conjunto de dados tipado, a DataTable correspondente contém as colunas retornadas pela consulta de banco de dados principal.</span><span class="sxs-lookup"><span data-stu-id="71574-107">When using the TableAdapter Wizard to create a Typed DataSet, the corresponding DataTable contains the columns returned by the main database query.</span></span> <span data-ttu-id="71574-108">Mas há ocasiões em que a DataTable precisa incluir colunas adicionais.</span><span class="sxs-lookup"><span data-stu-id="71574-108">But there are occasions when the DataTable needs to include additional columns.</span></span> <span data-ttu-id="71574-109">Neste tutorial, aprendemos por que procedimentos armazenados são recomendados quando precisamos de colunas de DataTable adicionais.</span><span class="sxs-lookup"><span data-stu-id="71574-109">In this tutorial we learn why stored procedures are recommended when we need additional DataTable columns.</span></span>

## <a name="introduction"></a><span data-ttu-id="71574-110">Introdução</span><span class="sxs-lookup"><span data-stu-id="71574-110">Introduction</span></span>

<span data-ttu-id="71574-111">Ao adicionar um TableAdapter a um DataSet tipado, o esquema DataTable s correspondente é determinado pela consulta principal do TableAdapter s.</span><span class="sxs-lookup"><span data-stu-id="71574-111">When adding a TableAdapter to a Typed DataSet, the corresponding DataTable s schema is determined by the TableAdapter s main query.</span></span> <span data-ttu-id="71574-112">Por exemplo, se a consulta principal retornar os campos *de dados A*, *b*e *c*, a DataTable terá três colunas correspondentes chamadas *A*, *b*e *c*. Além de sua consulta principal, um TableAdapter pode incluir consultas adicionais que retornam, talvez, um subconjunto dos dados com base em algum parâmetro.</span><span class="sxs-lookup"><span data-stu-id="71574-112">For example, if the main query returns data fields *A*, *B*, and *C*, the DataTable will have three corresponding columns named *A*, *B*, and *C*. In addition to its main query, a TableAdapter can include additional queries that return, perhaps, a subset of the data based on some parameter.</span></span> <span data-ttu-id="71574-113">Por exemplo, além da consulta principal `ProductsTableAdapter` s, que retorna informações sobre todos os produtos, ele também contém métodos como `GetProductsByCategoryID(categoryID)` e `GetProductByProductID(productID)`, que retornam informações específicas do produto com base em um parâmetro fornecido.</span><span class="sxs-lookup"><span data-stu-id="71574-113">For instance, in addition to the `ProductsTableAdapter` s main query, which returns information about all products, it also contains methods like `GetProductsByCategoryID(categoryID)` and `GetProductByProductID(productID)`, which return specific product information based on a supplied parameter.</span></span>

<span data-ttu-id="71574-114">O modelo de ter o esquema DataTable s reflete a consulta principal TableAdapter s funciona bem se todos os métodos TableAdapter s retornarem os mesmos ou menos campos de dados do que os especificados na consulta principal.</span><span class="sxs-lookup"><span data-stu-id="71574-114">The model of having the DataTable s schema reflect the TableAdapter s main query works well if all of the TableAdapter s methods return the same or fewer data fields than those specified in the main query.</span></span> <span data-ttu-id="71574-115">Se um método TableAdapter precisar retornar campos de dados adicionais, então, devemos expandir o esquema DataTable s de acordo.</span><span class="sxs-lookup"><span data-stu-id="71574-115">If a TableAdapter method needs to return additional data fields, then we should expand the DataTable s schema accordingly.</span></span> <span data-ttu-id="71574-116">No [mestre/detalhes usando uma lista com marcadores de registros mestres com um tutorial de DataList detalhes](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md) , adicionamos um método ao `CategoriesTableAdapter` que retornava os campos de dados `CategoryID`, `CategoryName`e `Description` definidos na consulta principal mais `NumberOfProducts`, um campo de dados adicional que reportou o número de produtos associados a cada categoria.</span><span class="sxs-lookup"><span data-stu-id="71574-116">In the [Master/Detail Using a Bulleted List of Master Records with a Details DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md) tutorial we added a method to the `CategoriesTableAdapter` that returned the `CategoryID`, `CategoryName`, and `Description` data fields defined in the main query plus `NumberOfProducts`, an additional data field that reported the number of products associated with each category.</span></span> <span data-ttu-id="71574-117">Adicionamos manualmente uma nova coluna à `CategoriesDataTable` para capturar o valor do campo de dados de `NumberOfProducts` desse novo método.</span><span class="sxs-lookup"><span data-stu-id="71574-117">We manually added a new column to the `CategoriesDataTable` in order to capture the `NumberOfProducts` data field value from this new method.</span></span>

<span data-ttu-id="71574-118">Conforme discutido no tutorial [carregar arquivos](../working-with-binary-files/uploading-files-cs.md) , é preciso ter muito cuidado com os TableAdapters que usam instruções SQL ad hoc e têm métodos cujos campos de dados não correspondem precisamente à consulta principal.</span><span class="sxs-lookup"><span data-stu-id="71574-118">As discussed in the [Uploading Files](../working-with-binary-files/uploading-files-cs.md) tutorial, great care must be taken with TableAdapters that use ad-hoc SQL statements and have methods whose data fields do not precisely match the main query.</span></span> <span data-ttu-id="71574-119">Se o assistente de configuração do TableAdapter for executado novamente, ele atualizará todos os métodos TableAdapter s para que sua lista de campos de dados corresponda à consulta principal.</span><span class="sxs-lookup"><span data-stu-id="71574-119">If the TableAdapter Configuration wizard is re-run, it will update all of the TableAdapter s methods so that their data field list matches the main query.</span></span> <span data-ttu-id="71574-120">Consequentemente, todos os métodos com listas de colunas personalizadas serão revertidos para a lista de colunas da consulta principal e não retornarão os dados esperados.</span><span class="sxs-lookup"><span data-stu-id="71574-120">Consequently, any methods with customized column lists will revert to the main query s column list and not return the expected data.</span></span> <span data-ttu-id="71574-121">Esse problema não ocorre ao usar procedimentos armazenados.</span><span class="sxs-lookup"><span data-stu-id="71574-121">This issue does not arise when using stored procedures.</span></span>

<span data-ttu-id="71574-122">Neste tutorial, veremos como estender um esquema DataTable s para incluir colunas adicionais.</span><span class="sxs-lookup"><span data-stu-id="71574-122">In this tutorial we will look at how to extend a DataTable s schema to include additional columns.</span></span> <span data-ttu-id="71574-123">Devido à fragilidade do TableAdapter ao usar instruções SQL ad hoc, neste tutorial, usaremos procedimentos armazenados.</span><span class="sxs-lookup"><span data-stu-id="71574-123">Due to the brittleness of the TableAdapter when using ad-hoc SQL statements, in this tutorial we will use stored procedures.</span></span> <span data-ttu-id="71574-124">Consulte a [criando novos procedimentos armazenados para os TableAdapters do conjunto de dados tipados](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md) e [usando procedimentos armazenados existentes para os tutoriais dos TableAdapters do DataSet tipados](https://data-access/tutorials/using-existing-stored-procedures-for-the-typed-dataset-amp-rsquo-s-tableadapters-cs) para obter mais informações sobre como configurar um TableAdapter para usar procedimentos armazenados.</span><span class="sxs-lookup"><span data-stu-id="71574-124">Refer to the [Creating New Stored Procedures for the Typed DataSet s TableAdapters](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md) and [Using Existing Stored Procedures for the Typed DataSet s TableAdapters](https://data-access/tutorials/using-existing-stored-procedures-for-the-typed-dataset-amp-rsquo-s-tableadapters-cs) tutorials for more information on configuring a TableAdapter to use stored procedures.</span></span>

## <a name="step-1-adding-apricequartilecolumn-to-theproductsdatatable"></a><span data-ttu-id="71574-125">Etapa 1: adicionando uma coluna de`PriceQuartile`à`ProductsDataTable`</span><span class="sxs-lookup"><span data-stu-id="71574-125">Step 1: Adding a`PriceQuartile`Column to the`ProductsDataTable`</span></span>

<span data-ttu-id="71574-126">No tutorial *criando novos procedimentos armazenados para o DataSet s tipados* , criamos um conjunto de tipos chamado `NorthwindWithSprocs`.</span><span class="sxs-lookup"><span data-stu-id="71574-126">In the *Creating New Stored Procedures for the Typed DataSet s TableAdapters* tutorial we created a Typed DataSet named `NorthwindWithSprocs`.</span></span> <span data-ttu-id="71574-127">No momento, esse conjunto de conteúdo contém duas datatabelas: `ProductsDataTable` e `EmployeesDataTable`.</span><span class="sxs-lookup"><span data-stu-id="71574-127">This DataSet currently contains two DataTables: `ProductsDataTable` and `EmployeesDataTable`.</span></span> <span data-ttu-id="71574-128">O `ProductsTableAdapter` tem os três métodos a seguir:</span><span class="sxs-lookup"><span data-stu-id="71574-128">The `ProductsTableAdapter` has the following three methods:</span></span>

- <span data-ttu-id="71574-129">`GetProducts`-a consulta principal, que retorna todos os registros da tabela `Products`</span><span class="sxs-lookup"><span data-stu-id="71574-129">`GetProducts` - the main query, which returns all records from the `Products` table</span></span>
- <span data-ttu-id="71574-130">`GetProductsByCategoryID(categoryID)`-retorna todos os produtos com a *CategoryID*especificada.</span><span class="sxs-lookup"><span data-stu-id="71574-130">`GetProductsByCategoryID(categoryID)` - returns all products with the specified *categoryID*.</span></span>
- <span data-ttu-id="71574-131">`GetProductByProductID(productID)`-retorna o produto específico com o *ProductID*especificado.</span><span class="sxs-lookup"><span data-stu-id="71574-131">`GetProductByProductID(productID)` - returns the particular product with the specified *productID*.</span></span>

<span data-ttu-id="71574-132">A consulta principal e os dois métodos adicionais retornam o mesmo conjunto de campos de dados, ou seja, todas as colunas da tabela `Products`.</span><span class="sxs-lookup"><span data-stu-id="71574-132">The main query and the two additional methods all return the same set of data fields, namely all of the columns from the `Products` table.</span></span> <span data-ttu-id="71574-133">Não há Subconsultas correlacionadas ou `JOIN` s recebendo dados relacionados das tabelas `Categories` ou `Suppliers`.</span><span class="sxs-lookup"><span data-stu-id="71574-133">There are no correlated subqueries or `JOIN` s pulling related data from the `Categories` or `Suppliers` tables.</span></span> <span data-ttu-id="71574-134">Portanto, o `ProductsDataTable` tem uma coluna correspondente para cada campo na tabela `Products`.</span><span class="sxs-lookup"><span data-stu-id="71574-134">Therefore, the `ProductsDataTable` has a corresponding column for each field in the `Products` table.</span></span>

<span data-ttu-id="71574-135">Para este tutorial, vamos adicionar um método ao `ProductsTableAdapter` chamado `GetProductsWithPriceQuartile` que retorna todos os produtos.</span><span class="sxs-lookup"><span data-stu-id="71574-135">For this tutorial, let s add a method to the `ProductsTableAdapter` named `GetProductsWithPriceQuartile` that returns all of the products.</span></span> <span data-ttu-id="71574-136">Além dos campos de dados do produto padrão, `GetProductsWithPriceQuartile` também incluirá um campo de dados de `PriceQuartile` que indica sob qual quartil o preço do produto se enquadra.</span><span class="sxs-lookup"><span data-stu-id="71574-136">In addition to the standard product data fields, `GetProductsWithPriceQuartile` will also include a `PriceQuartile` data field that indicates under which quartile the product s price falls.</span></span> <span data-ttu-id="71574-137">Por exemplo, os produtos cujos preços estão nos 25% mais caros terão um valor de `PriceQuartile` de 1, enquanto aqueles cujos preços se enquadram nos 25% inferiores terão um valor de 4.</span><span class="sxs-lookup"><span data-stu-id="71574-137">For example, those products whose prices are in the most expensive 25% will have a `PriceQuartile` value of 1, while those whose prices fall in the bottom 25% will have a value of 4.</span></span> <span data-ttu-id="71574-138">Antes de nos preocuparmos em criar o procedimento armazenado para retornar essas informações, no entanto, primeiro precisamos atualizar o `ProductsDataTable` para incluir uma coluna para manter os resultados da `PriceQuartile` quando o método `GetProductsWithPriceQuartile` for usado.</span><span class="sxs-lookup"><span data-stu-id="71574-138">Before we worry about creating the stored procedure to return this information, however, we first need to update the `ProductsDataTable` to include a column to hold the `PriceQuartile` results when the `GetProductsWithPriceQuartile` method is used.</span></span>

<span data-ttu-id="71574-139">Abra o conjunto de `NorthwindWithSprocs` DataSet e clique com o botão direito do mouse na `ProductsDataTable`.</span><span class="sxs-lookup"><span data-stu-id="71574-139">Open the `NorthwindWithSprocs` DataSet and right-click on the `ProductsDataTable`.</span></span> <span data-ttu-id="71574-140">Escolha Adicionar no menu de contexto e, em seguida, selecione coluna.</span><span class="sxs-lookup"><span data-stu-id="71574-140">Choose Add from the context-menu and then pick Column.</span></span>

<span data-ttu-id="71574-141">[![adicionar uma nova coluna ao ProductsDataTable](adding-additional-datatable-columns-cs/_static/image2.png)](adding-additional-datatable-columns-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="71574-141">[![Add a New Column to the ProductsDataTable](adding-additional-datatable-columns-cs/_static/image2.png)](adding-additional-datatable-columns-cs/_static/image1.png)</span></span>

<span data-ttu-id="71574-142">**Figura 1**: adicionar uma nova coluna à `ProductsDataTable` ([clique para exibir a imagem em tamanho normal](adding-additional-datatable-columns-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="71574-142">**Figure 1**: Add a New Column to the `ProductsDataTable` ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image3.png))</span></span>

<span data-ttu-id="71574-143">Isso adicionará uma nova coluna à DataTable chamada Coluna1 do tipo `System.String`.</span><span class="sxs-lookup"><span data-stu-id="71574-143">This will add a new column to the DataTable named Column1 of type `System.String`.</span></span> <span data-ttu-id="71574-144">Precisamos atualizar esse nome de coluna para PriceQuartile e seu tipo para `System.Int32`, pois ele será usado para manter um número entre 1 e 4.</span><span class="sxs-lookup"><span data-stu-id="71574-144">We need to update this column s name to PriceQuartile and its type to `System.Int32` since it will be used to hold a number between 1 and 4.</span></span> <span data-ttu-id="71574-145">Selecione a coluna recém-adicionada no `ProductsDataTable` e, na janela Propriedades, defina a propriedade `Name` como PriceQuartile e a propriedade `DataType` como `System.Int32`.</span><span class="sxs-lookup"><span data-stu-id="71574-145">Select the newly-added column in the `ProductsDataTable` and, from the Properties window, set the `Name` property to PriceQuartile and the `DataType` property to `System.Int32`.</span></span>

<span data-ttu-id="71574-146">[![definir as propriedades nome e tipo de dados da nova coluna](adding-additional-datatable-columns-cs/_static/image5.png)](adding-additional-datatable-columns-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="71574-146">[![Set the New Column s Name and DataType Properties](adding-additional-datatable-columns-cs/_static/image5.png)](adding-additional-datatable-columns-cs/_static/image4.png)</span></span>

<span data-ttu-id="71574-147">**Figura 2**: definir as propriedades da nova coluna s `Name` e `DataType` ([clique para exibir a imagem em tamanho normal](adding-additional-datatable-columns-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="71574-147">**Figure 2**: Set the New Column s `Name` and `DataType` Properties ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image6.png))</span></span>

<span data-ttu-id="71574-148">Como mostra a Figura 2, há propriedades adicionais que podem ser definidas, como se os valores na coluna devem ser exclusivos, se a coluna for uma coluna de incremento automático, se o banco de dados `NULL` valores são permitidos e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="71574-148">As Figure 2 shows, there are additional properties that can be set, such as whether the values in the column must be unique, if the column is an auto-increment column, whether or not database `NULL` values are allowed, and so on.</span></span> <span data-ttu-id="71574-149">Deixe esses valores definidos como seus padrões.</span><span class="sxs-lookup"><span data-stu-id="71574-149">Leave these values set to their defaults.</span></span>

## <a name="step-2-creating-thegetproductswithpricequartilemethod"></a><span data-ttu-id="71574-150">Etapa 2: criando o método de`GetProductsWithPriceQuartile`</span><span class="sxs-lookup"><span data-stu-id="71574-150">Step 2: Creating the`GetProductsWithPriceQuartile`Method</span></span>

<span data-ttu-id="71574-151">Agora que o `ProductsDataTable` foi atualizado para incluir a coluna `PriceQuartile`, estamos prontos para criar o método `GetProductsWithPriceQuartile`.</span><span class="sxs-lookup"><span data-stu-id="71574-151">Now that the `ProductsDataTable` has been updated to include the `PriceQuartile` column, we are ready to create the `GetProductsWithPriceQuartile` method.</span></span> <span data-ttu-id="71574-152">Comece clicando com o botão direito do mouse no TableAdapter e escolhendo Adicionar consulta no menu de contexto.</span><span class="sxs-lookup"><span data-stu-id="71574-152">Start by right-clicking on the TableAdapter and choosing Add Query from the context-menu.</span></span> <span data-ttu-id="71574-153">Isso abre o assistente de configuração de consulta do TableAdapter, que primeiro nos solicita se desejamos usar instruções SQL ad hoc ou um procedimento armazenado novo ou existente.</span><span class="sxs-lookup"><span data-stu-id="71574-153">This brings up the TableAdapter Query Configuration wizard, which first prompts us as to whether we want to use ad-hoc SQL statements or a new or existing stored procedure.</span></span> <span data-ttu-id="71574-154">Como ainda não temos um procedimento armazenado que retorna os dados do preço quartil, vamos permitir que o TableAdapter crie esse procedimento armazenado para nós.</span><span class="sxs-lookup"><span data-stu-id="71574-154">Since we don t yet have a stored procedure that returns the price quartile data, let s allow the TableAdapter to create this stored procedure for us.</span></span> <span data-ttu-id="71574-155">Selecione a opção Criar novo procedimento armazenado e clique em Avançar.</span><span class="sxs-lookup"><span data-stu-id="71574-155">Select the Create new stored procedure option and click Next.</span></span>

<span data-ttu-id="71574-156">[![instrua o assistente TableAdapter a criar o procedimento armazenado para nós](adding-additional-datatable-columns-cs/_static/image8.png)](adding-additional-datatable-columns-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="71574-156">[![Instruct the TableAdapter Wizard to Create the Stored Procedure For Us](adding-additional-datatable-columns-cs/_static/image8.png)](adding-additional-datatable-columns-cs/_static/image7.png)</span></span>

<span data-ttu-id="71574-157">**Figura 3**: Instrua o assistente do TableAdapter a criar o procedimento armazenado para nós ([clique para exibir a imagem em tamanho normal](adding-additional-datatable-columns-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="71574-157">**Figure 3**: Instruct the TableAdapter Wizard to Create the Stored Procedure For Us ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image9.png))</span></span>

<span data-ttu-id="71574-158">Na tela subsequente, mostrada na Figura 4, o assistente nos pergunta que tipo de consulta adicionar.</span><span class="sxs-lookup"><span data-stu-id="71574-158">In the subsequent screen, shown in Figure 4, the wizard asks us what type of query to add.</span></span> <span data-ttu-id="71574-159">Como o método `GetProductsWithPriceQuartile` retornará todas as colunas e registros da tabela `Products`, selecione a opção Selecionar que retorna linhas e clique em Avançar.</span><span class="sxs-lookup"><span data-stu-id="71574-159">Since the `GetProductsWithPriceQuartile` method will return all columns and records from the `Products` table, select the SELECT which returns rows option and click Next.</span></span>

<span data-ttu-id="71574-160">[![nossa consulta será uma instrução SELECT que retorna várias linhas](adding-additional-datatable-columns-cs/_static/image11.png)](adding-additional-datatable-columns-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="71574-160">[![Our Query will be a SELECT Statement that Returns Multiple Rows](adding-additional-datatable-columns-cs/_static/image11.png)](adding-additional-datatable-columns-cs/_static/image10.png)</span></span>

<span data-ttu-id="71574-161">**Figura 4**: nossa consulta será uma instrução `SELECT` que retorna várias linhas ([clique para exibir a imagem em tamanho normal](adding-additional-datatable-columns-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="71574-161">**Figure 4**: Our Query will be a `SELECT` Statement that Returns Multiple Rows ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image12.png))</span></span>

<span data-ttu-id="71574-162">Em seguida, solicitamos a consulta `SELECT`.</span><span class="sxs-lookup"><span data-stu-id="71574-162">Next we are prompted for the `SELECT` query.</span></span> <span data-ttu-id="71574-163">Insira a seguinte consulta no assistente:</span><span class="sxs-lookup"><span data-stu-id="71574-163">Enter the following query into the wizard:</span></span>

[!code-sql[Main](adding-additional-datatable-columns-cs/samples/sample1.sql)]

<span data-ttu-id="71574-164">A consulta acima usa SQL Server a nova [função`NTILE`](https://msdn.microsoft.com/library/ms175126.aspx) do 2005 para dividir os resultados em quatro grupos nos quais os grupos são determinados pelos valores de `UnitPrice` classificados em ordem decrescente.</span><span class="sxs-lookup"><span data-stu-id="71574-164">The above query uses SQL Server 2005 s new [`NTILE` function](https://msdn.microsoft.com/library/ms175126.aspx) to divide the results into four groups where the groups are determined by the `UnitPrice` values sorted in descending order.</span></span>

<span data-ttu-id="71574-165">Infelizmente, o Construtor de Consultas não sabe como analisar a palavra-chave `OVER` e exibirá um erro ao analisar a consulta acima.</span><span class="sxs-lookup"><span data-stu-id="71574-165">Unfortunately, the Query Builder does not know how to parse the `OVER` keyword and will display an error when parsing the above query.</span></span> <span data-ttu-id="71574-166">Portanto, insira a consulta acima diretamente na caixa de texto no assistente sem usar o Construtor de Consultas.</span><span class="sxs-lookup"><span data-stu-id="71574-166">Therefore, enter the above query directly in the textbox in the wizard without using the Query Builder.</span></span>

> [!NOTE]
> <span data-ttu-id="71574-167">Para obter mais informações sobre as outras funções de classificação do NTILE e SQL Server 2005 s, consulte [retornando resultados classificados com Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml) e a [seção funções de classificação](https://msdn.microsoft.com/library/ms189798.aspx) dos [manuais online do SQL Server 2005](https://msdn.microsoft.com/library/ms189798.aspx).</span><span class="sxs-lookup"><span data-stu-id="71574-167">For more information on NTILE and SQL Server 2005 s other ranking functions, see [Returning Ranked Results with Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml) and the [Ranking Functions section](https://msdn.microsoft.com/library/ms189798.aspx) from the [SQL Server 2005 Books Online](https://msdn.microsoft.com/library/ms189798.aspx).</span></span>

<span data-ttu-id="71574-168">Depois de inserir a consulta `SELECT` e clicar em avançar, o assistente nos solicitará que forneça um nome para o procedimento armazenado que ele criará.</span><span class="sxs-lookup"><span data-stu-id="71574-168">After entering the `SELECT` query and clicking Next, the wizard asks us to provide a name for the stored procedure it will create.</span></span> <span data-ttu-id="71574-169">Nomeie o novo procedimento armazenado `Products_SelectWithPriceQuartile` e clique em Avançar.</span><span class="sxs-lookup"><span data-stu-id="71574-169">Name the new stored procedure `Products_SelectWithPriceQuartile` and click Next.</span></span>

<span data-ttu-id="71574-170">[![nomear o procedimento armazenado Products_SelectWithPriceQuartile](adding-additional-datatable-columns-cs/_static/image14.png)](adding-additional-datatable-columns-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="71574-170">[![Name the Stored Procedure Products_SelectWithPriceQuartile](adding-additional-datatable-columns-cs/_static/image14.png)](adding-additional-datatable-columns-cs/_static/image13.png)</span></span>

<span data-ttu-id="71574-171">**Figura 5**: nomear o procedimento armazenado `Products_SelectWithPriceQuartile` ([clique para exibir a imagem em tamanho normal](adding-additional-datatable-columns-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="71574-171">**Figure 5**: Name the Stored Procedure `Products_SelectWithPriceQuartile` ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image15.png))</span></span>

<span data-ttu-id="71574-172">Por fim, são solicitados a nomear os métodos TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="71574-172">Lastly, we are prompted to name the TableAdapter methods.</span></span> <span data-ttu-id="71574-173">Deixe as caixas de seleção preencher uma DataTable e retornar uma DataTable marcadas e nomeie os métodos `FillWithPriceQuartile` e `GetProductsWithPriceQuartile`.</span><span class="sxs-lookup"><span data-stu-id="71574-173">Leave both the Fill a DataTable and Return a DataTable checkboxes checked and name the methods `FillWithPriceQuartile` and `GetProductsWithPriceQuartile`.</span></span>

<span data-ttu-id="71574-174">[![nomear os métodos TableAdapter s e clicar em concluir](adding-additional-datatable-columns-cs/_static/image17.png)](adding-additional-datatable-columns-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="71574-174">[![Name the TableAdapter s Methods and Click Finish](adding-additional-datatable-columns-cs/_static/image17.png)](adding-additional-datatable-columns-cs/_static/image16.png)</span></span>

<span data-ttu-id="71574-175">**Figura 6**: Nomeie os métodos TableAdapter s e clique em concluir ([clique para exibir a imagem em tamanho normal](adding-additional-datatable-columns-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="71574-175">**Figure 6**: Name the TableAdapter s Methods and Click Finish ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image18.png))</span></span>

<span data-ttu-id="71574-176">Com a consulta `SELECT` especificada e os métodos de procedimento armazenado e TableAdapter chamados, clique em concluir para concluir o assistente.</span><span class="sxs-lookup"><span data-stu-id="71574-176">With the `SELECT` query specified and the stored procedure and TableAdapter methods named, click Finish to complete the wizard.</span></span> <span data-ttu-id="71574-177">Neste ponto, você pode receber um ou dois avisos do assistente informando que não há suporte para a construção ou instrução SQL `OVER`.</span><span class="sxs-lookup"><span data-stu-id="71574-177">At this point you may get a warning or two from the wizard saying that The `OVER` SQL construct or statement is not supported.</span></span> <span data-ttu-id="71574-178">Esses avisos podem ser ignorados.</span><span class="sxs-lookup"><span data-stu-id="71574-178">These warnings can be ignored.</span></span>

<span data-ttu-id="71574-179">Depois de concluir o assistente, o TableAdapter deve incluir os métodos `FillWithPriceQuartile` e `GetProductsWithPriceQuartile` e o banco de dados deve incluir um procedimento armazenado chamado `Products_SelectWithPriceQuartile`.</span><span class="sxs-lookup"><span data-stu-id="71574-179">After completing the wizard, the TableAdapter should include the `FillWithPriceQuartile` and `GetProductsWithPriceQuartile` methods and the database should include a stored procedure named `Products_SelectWithPriceQuartile`.</span></span> <span data-ttu-id="71574-180">Reserve um tempo para verificar se o TableAdapter realmente contém esse novo método e se o procedimento armazenado foi adicionado corretamente ao banco de dados.</span><span class="sxs-lookup"><span data-stu-id="71574-180">Take a moment to verify that the TableAdapter does indeed contain this new method and that the stored procedure has been correctly added to the database.</span></span> <span data-ttu-id="71574-181">Ao verificar o banco de dados, se você não vir o procedimento armazenado, tente clicar com o botão direito do mouse na pasta procedimentos armazenados e escolher atualizar.</span><span class="sxs-lookup"><span data-stu-id="71574-181">When checking the database, if you do not see the stored procedure try right-clicking on the Stored Procedures folder and choosing Refresh.</span></span>

![Verifique se um novo método foi adicionado ao TableAdapter](adding-additional-datatable-columns-cs/_static/image19.png)

<span data-ttu-id="71574-183">**Figura 7**: verificar se um novo método foi adicionado ao TableAdapter</span><span class="sxs-lookup"><span data-stu-id="71574-183">**Figure 7**: Verify that a New Method Has Been Added to the TableAdapter</span></span>

<span data-ttu-id="71574-184">[![garantir que o banco de dados contenha o procedimento armazenado Products_SelectWithPriceQuartile](adding-additional-datatable-columns-cs/_static/image21.png)](adding-additional-datatable-columns-cs/_static/image20.png)</span><span class="sxs-lookup"><span data-stu-id="71574-184">[![Ensure that the Database Contains the Products_SelectWithPriceQuartile Stored Procedure](adding-additional-datatable-columns-cs/_static/image21.png)](adding-additional-datatable-columns-cs/_static/image20.png)</span></span>

<span data-ttu-id="71574-185">**Figura 8**: Verifique se o banco de dados contém o procedimento armazenado `Products_SelectWithPriceQuartile` ([clique para exibir a imagem em tamanho normal](adding-additional-datatable-columns-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="71574-185">**Figure 8**: Ensure that the Database Contains the `Products_SelectWithPriceQuartile` Stored Procedure ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image22.png))</span></span>

> [!NOTE]
> <span data-ttu-id="71574-186">Um dos benefícios de usar procedimentos armazenados em vez de instruções SQL ad hoc é que executar novamente o assistente de configuração do TableAdapter não modificará as listas de colunas de procedimentos armazenados.</span><span class="sxs-lookup"><span data-stu-id="71574-186">One of the benefits of using stored procedures instead of ad-hoc SQL statements is that re-running the TableAdapter Configuration wizard will not modify the stored procedures column lists.</span></span> <span data-ttu-id="71574-187">Verifique isso clicando com o botão direito do mouse no TableAdapter, escolhendo a opção configurar no menu de contexto para iniciar o assistente e, em seguida, clicando em concluir para concluí-lo.</span><span class="sxs-lookup"><span data-stu-id="71574-187">Verify this by right-clicking on the TableAdapter, choosing the Configure option from the context-menu to start the wizard, and then clicking Finish to complete it.</span></span> <span data-ttu-id="71574-188">Em seguida, vá para o banco de dados e exiba o procedimento armazenado `Products_SelectWithPriceQuartile`.</span><span class="sxs-lookup"><span data-stu-id="71574-188">Next, go to the database and view the `Products_SelectWithPriceQuartile` stored procedure.</span></span> <span data-ttu-id="71574-189">Observe que sua lista de colunas não foi modificada.</span><span class="sxs-lookup"><span data-stu-id="71574-189">Note that its column list has not been modified.</span></span> <span data-ttu-id="71574-190">Estava usando instruções SQL ad hoc, executar novamente o assistente de configuração do TableAdapter reverteria essa lista de colunas de consulta para corresponder à lista de colunas da consulta principal, removendo assim a instrução NTILE da consulta usada pelo método `GetProductsWithPriceQuartile`.</span><span class="sxs-lookup"><span data-stu-id="71574-190">Had we been using ad-hoc SQL statements, re-running the TableAdapter Configuration wizard would have reverted this query s column list to match the main query column list, thereby removing the NTILE statement from the query used by the `GetProductsWithPriceQuartile` method.</span></span>

<span data-ttu-id="71574-191">Quando o método de `GetProductsWithPriceQuartile` da camada de acesso a dados é invocado, o TableAdapter executa o procedimento armazenado `Products_SelectWithPriceQuartile` e adiciona uma linha à `ProductsDataTable` para cada registro retornado.</span><span class="sxs-lookup"><span data-stu-id="71574-191">When the Data Access Layer s `GetProductsWithPriceQuartile` method is invoked, the TableAdapter executes the `Products_SelectWithPriceQuartile` stored procedure and adds a row to the `ProductsDataTable` for each returned record.</span></span> <span data-ttu-id="71574-192">Os campos de dados retornados pelo procedimento armazenado são mapeados para as colunas `ProductsDataTable` s.</span><span class="sxs-lookup"><span data-stu-id="71574-192">The data fields returned by the stored procedure are mapped to the `ProductsDataTable` s columns.</span></span> <span data-ttu-id="71574-193">Como há um campo de dados `PriceQuartile` retornado do procedimento armazenado, seu valor é atribuído à coluna `ProductsDataTable` s `PriceQuartile`.</span><span class="sxs-lookup"><span data-stu-id="71574-193">Since there is a `PriceQuartile` data field returned from the stored procedure, its value is assigned to the `ProductsDataTable` s `PriceQuartile` column.</span></span>

<span data-ttu-id="71574-194">Para esses métodos TableAdapter cujas consultas não retornam um campo de dados `PriceQuartile`, o valor de s da coluna `PriceQuartile` é o valor especificado por sua propriedade `DefaultValue`.</span><span class="sxs-lookup"><span data-stu-id="71574-194">For those TableAdapter methods whose queries do not return a `PriceQuartile` data field, the `PriceQuartile` column s value is the value specified by its `DefaultValue` property.</span></span> <span data-ttu-id="71574-195">Como mostra a Figura 2, esse valor é definido como `DBNull`, o padrão.</span><span class="sxs-lookup"><span data-stu-id="71574-195">As Figure 2 shows, this value is set to `DBNull`, the default.</span></span> <span data-ttu-id="71574-196">Se você preferir um valor padrão diferente, basta definir a propriedade `DefaultValue` de acordo.</span><span class="sxs-lookup"><span data-stu-id="71574-196">If you would prefer a different default value, simply set the `DefaultValue` property accordingly.</span></span> <span data-ttu-id="71574-197">Apenas certifique-se de que o valor de `DefaultValue` é válido, dado à coluna s `DataType` (ou seja, `System.Int32` para a coluna `PriceQuartile`).</span><span class="sxs-lookup"><span data-stu-id="71574-197">Just make sure that the `DefaultValue` value is valid given the column s `DataType` (i.e., `System.Int32` for the `PriceQuartile` column).</span></span>

<span data-ttu-id="71574-198">Neste ponto, realizamos as etapas necessárias para adicionar uma coluna adicional a uma DataTable.</span><span class="sxs-lookup"><span data-stu-id="71574-198">At this point we have performed the necessary steps for adding an additional column to a DataTable.</span></span> <span data-ttu-id="71574-199">Para verificar se essa coluna adicional funciona conforme o esperado, vamos criar uma página ASP.NET que exibe cada nome de produto, preço e preço quartil.</span><span class="sxs-lookup"><span data-stu-id="71574-199">To verify that this additional column works as expected, let s create an ASP.NET page that displays each product s name, price, and price quartile.</span></span> <span data-ttu-id="71574-200">No entanto, antes de fazermos isso, primeiro precisamos atualizar a camada de lógica de negócios para incluir um método que chame para o método da DAL s `GetProductsWithPriceQuartile`.</span><span class="sxs-lookup"><span data-stu-id="71574-200">Before we do that, though, we first need to update the Business Logic Layer to include a method that calls down to the DAL s `GetProductsWithPriceQuartile` method.</span></span> <span data-ttu-id="71574-201">Atualizaremos a BLL em seguida, na etapa 3, e, em seguida, criaremos a página ASP.NET na etapa 4.</span><span class="sxs-lookup"><span data-stu-id="71574-201">We will update the BLL next, in Step 3, and then create the ASP.NET page in Step 4.</span></span>

## <a name="step-3-augmenting-the-business-logic-layer"></a><span data-ttu-id="71574-202">Etapa 3: aumentando a camada de lógica de negócios</span><span class="sxs-lookup"><span data-stu-id="71574-202">Step 3: Augmenting the Business Logic Layer</span></span>

<span data-ttu-id="71574-203">Antes de usarmos o novo método `GetProductsWithPriceQuartile` da camada de apresentação, primeiro devemos adicionar um método correspondente à BLL.</span><span class="sxs-lookup"><span data-stu-id="71574-203">Before we use the new `GetProductsWithPriceQuartile` method from the Presentation Layer, we should first add a corresponding method to the BLL.</span></span> <span data-ttu-id="71574-204">Abra o arquivo de classe `ProductsBLLWithSprocs` e adicione o seguinte código:</span><span class="sxs-lookup"><span data-stu-id="71574-204">Open the `ProductsBLLWithSprocs` class file and add the following code:</span></span>

[!code-csharp[Main](adding-additional-datatable-columns-cs/samples/sample2.cs)]

<span data-ttu-id="71574-205">Como os outros métodos de recuperação de dados no `ProductsBLLWithSprocs`, o método `GetProductsWithPriceQuartile` simplesmente chama o método `GetProductsWithPriceQuartile` DAL s correspondente e retorna seus resultados.</span><span class="sxs-lookup"><span data-stu-id="71574-205">Like the other data retrieval methods in `ProductsBLLWithSprocs`, the `GetProductsWithPriceQuartile` method simply calls the DAL s corresponding `GetProductsWithPriceQuartile` method and returns its results.</span></span>

## <a name="step-4-displaying-the-price-quartile-information-in-an-aspnet-web-page"></a><span data-ttu-id="71574-206">Etapa 4: exibindo as informações do quartil de preço em uma página da Web do ASP.NET</span><span class="sxs-lookup"><span data-stu-id="71574-206">Step 4: Displaying the Price Quartile Information in an ASP.NET Web Page</span></span>

<span data-ttu-id="71574-207">Com a adição de BLL concluída, estamos prontos para criar uma página ASP.NET que mostra o preço quartil para cada produto.</span><span class="sxs-lookup"><span data-stu-id="71574-207">With the BLL addition complete we re ready to create an ASP.NET page that shows the price quartile for each product.</span></span> <span data-ttu-id="71574-208">Abra a página `AddingColumns.aspx` na pasta `AdvancedDAL` e arraste um GridView da caixa de ferramentas para o designer, definindo sua propriedade `ID` como `Products`.</span><span class="sxs-lookup"><span data-stu-id="71574-208">Open the `AddingColumns.aspx` page in the `AdvancedDAL` folder and drag a GridView from the Toolbox onto the Designer, setting its `ID` property to `Products`.</span></span> <span data-ttu-id="71574-209">Na marca inteligente s GridView, associe-o a um novo ObjectDataSource chamado `ProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="71574-209">From the GridView s smart tag, bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="71574-210">Configure o ObjectDataSource para usar o método de `GetProductsWithPriceQuartile` da classe `ProductsBLLWithSprocs`.</span><span class="sxs-lookup"><span data-stu-id="71574-210">Configure the ObjectDataSource to use the `ProductsBLLWithSprocs` class s `GetProductsWithPriceQuartile` method.</span></span> <span data-ttu-id="71574-211">Como essa será uma grade somente leitura, defina as listas suspensas nas guias atualizar, inserir e excluir como (nenhum).</span><span class="sxs-lookup"><span data-stu-id="71574-211">Since this will be a read-only grid, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>

<span data-ttu-id="71574-212">[![configurar o ObjectDataSource para usar a classe ProductsBLLWithSprocs](adding-additional-datatable-columns-cs/_static/image24.png)](adding-additional-datatable-columns-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="71574-212">[![Configure the ObjectDataSource to Use the ProductsBLLWithSprocs Class](adding-additional-datatable-columns-cs/_static/image24.png)](adding-additional-datatable-columns-cs/_static/image23.png)</span></span>

<span data-ttu-id="71574-213">**Figura 9**: configurar o ObjectDataSource para usar a classe `ProductsBLLWithSprocs` ([clique para exibir a imagem em tamanho normal](adding-additional-datatable-columns-cs/_static/image25.png))</span><span class="sxs-lookup"><span data-stu-id="71574-213">**Figure 9**: Configure the ObjectDataSource to Use the `ProductsBLLWithSprocs` Class ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image25.png))</span></span>

<span data-ttu-id="71574-214">[![recuperar informações do produto do método GetProductsWithPriceQuartile](adding-additional-datatable-columns-cs/_static/image27.png)](adding-additional-datatable-columns-cs/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="71574-214">[![Retrieve Product Information from the GetProductsWithPriceQuartile Method](adding-additional-datatable-columns-cs/_static/image27.png)](adding-additional-datatable-columns-cs/_static/image26.png)</span></span>

<span data-ttu-id="71574-215">**Figura 10**: recuperar informações do produto do método `GetProductsWithPriceQuartile` ([clique para exibir a imagem em tamanho normal](adding-additional-datatable-columns-cs/_static/image28.png))</span><span class="sxs-lookup"><span data-stu-id="71574-215">**Figure 10**: Retrieve Product Information from the `GetProductsWithPriceQuartile` Method ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image28.png))</span></span>

<span data-ttu-id="71574-216">Depois de concluir o assistente para configurar fonte de dados, o Visual Studio adicionará automaticamente um BoundField ou CheckBoxField ao GridView para cada um dos campos de dados retornados pelo método.</span><span class="sxs-lookup"><span data-stu-id="71574-216">After completing the Configure Data Source wizard, Visual Studio will automatically add a BoundField or CheckBoxField to the GridView for each of the data fields returned by the method.</span></span> <span data-ttu-id="71574-217">Um desses campos de dados é `PriceQuartile`, que é a coluna que adicionamos ao `ProductsDataTable` na etapa 1.</span><span class="sxs-lookup"><span data-stu-id="71574-217">One of these data fields is `PriceQuartile`, which is the column we added to the `ProductsDataTable` in Step 1.</span></span>

<span data-ttu-id="71574-218">Edite os campos GridView, removendo todos os `ProductName`, `UnitPrice`e `PriceQuartile` BoundFields.</span><span class="sxs-lookup"><span data-stu-id="71574-218">Edit the GridView s fields, removing all but the `ProductName`, `UnitPrice`, and `PriceQuartile` BoundFields.</span></span> <span data-ttu-id="71574-219">Configure o `UnitPrice` BoundField para formatar seu valor como uma moeda e ter os `UnitPrice` e `PriceQuartile` BoundFields à direita e centralizado, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="71574-219">Configure the `UnitPrice` BoundField to format its value as a currency and have the `UnitPrice` and `PriceQuartile` BoundFields right- and center-aligned, respectively.</span></span> <span data-ttu-id="71574-220">Por fim, atualize os BoundFields restantes `HeaderText` Propriedades para produto, preço e preço quartil, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="71574-220">Finally, update the remaining BoundFields `HeaderText` properties to Product, Price, and Price Quartile, respectively.</span></span> <span data-ttu-id="71574-221">Além disso, marque a caixa de seleção Habilitar classificação na marca inteligente s GridView.</span><span class="sxs-lookup"><span data-stu-id="71574-221">Also, check the Enable Sorting checkbox from the GridView s smart tag.</span></span>

<span data-ttu-id="71574-222">Após essas modificações, a marcação declarativa de GridView e ObjectDataSource s deve ser parecida com a seguinte:</span><span class="sxs-lookup"><span data-stu-id="71574-222">After these modifications, the GridView and ObjectDataSource s declarative markup should look like the following:</span></span>

[!code-aspx[Main](adding-additional-datatable-columns-cs/samples/sample3.aspx)]

<span data-ttu-id="71574-223">A Figura 11 mostra essa página quando visitada por meio de um navegador.</span><span class="sxs-lookup"><span data-stu-id="71574-223">Figure 11 shows this page when visited through a browser.</span></span> <span data-ttu-id="71574-224">Observe que, inicialmente, os produtos são ordenados por seu preço em ordem decrescente, com cada produto atribuído um valor de `PriceQuartile` apropriado.</span><span class="sxs-lookup"><span data-stu-id="71574-224">Note that, initially, the products are ordered by their price in descending order with each product assigned an appropriate `PriceQuartile` value.</span></span> <span data-ttu-id="71574-225">É claro que esses dados podem ser classificados por outros critérios com o valor da coluna Price quartil ainda refletindo a classificação do produto em relação ao preço (consulte a Figura 12).</span><span class="sxs-lookup"><span data-stu-id="71574-225">Of course this data can be sorted by other criteria with the Price Quartile column value still reflecting the product s ranking with respect to price (see Figure 12).</span></span>

<span data-ttu-id="71574-226">[![os produtos são ordenados por seus preços](adding-additional-datatable-columns-cs/_static/image30.png)](adding-additional-datatable-columns-cs/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="71574-226">[![The Products are Ordered by their Prices](adding-additional-datatable-columns-cs/_static/image30.png)](adding-additional-datatable-columns-cs/_static/image29.png)</span></span>

<span data-ttu-id="71574-227">**Figura 11**: os produtos são ordenados por seus preços ([clique para exibir a imagem em tamanho normal](adding-additional-datatable-columns-cs/_static/image31.png))</span><span class="sxs-lookup"><span data-stu-id="71574-227">**Figure 11**: The Products are Ordered by their Prices ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image31.png))</span></span>

<span data-ttu-id="71574-228">[![os produtos são ordenados por seus nomes](adding-additional-datatable-columns-cs/_static/image33.png)](adding-additional-datatable-columns-cs/_static/image32.png)</span><span class="sxs-lookup"><span data-stu-id="71574-228">[![The Products are Ordered by their Names](adding-additional-datatable-columns-cs/_static/image33.png)](adding-additional-datatable-columns-cs/_static/image32.png)</span></span>

<span data-ttu-id="71574-229">**Figura 12**: os produtos são ordenados por seus nomes ([clique para exibir a imagem em tamanho normal](adding-additional-datatable-columns-cs/_static/image34.png))</span><span class="sxs-lookup"><span data-stu-id="71574-229">**Figure 12**: The Products are Ordered by their Names ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image34.png))</span></span>

> [!NOTE]
> <span data-ttu-id="71574-230">Com algumas linhas de código, poderíamos ampliar o GridView para que ele tenha colorido as linhas do produto com base em seu valor `PriceQuartile`.</span><span class="sxs-lookup"><span data-stu-id="71574-230">With a few lines of code we could augment the GridView so that it colored the product rows based on their `PriceQuartile` value.</span></span> <span data-ttu-id="71574-231">Podemos colorir esses produtos no primeiro quartil um verde claro, aqueles no segundo quartil a amarelo claro e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="71574-231">We might color those products in the first quartile a light green, those in the second quartile a light yellow, and so forth.</span></span> <span data-ttu-id="71574-232">Recomendo que você reserve um tempo para adicionar essa funcionalidade.</span><span class="sxs-lookup"><span data-stu-id="71574-232">I encourage you to take a moment to add this functionality.</span></span> <span data-ttu-id="71574-233">Se você precisar de um atualizador na formatação de um GridView, consulte o tutorial [formatação personalizada com base no data](../custom-formatting/custom-formatting-based-upon-data-cs.md) .</span><span class="sxs-lookup"><span data-stu-id="71574-233">If you need a refresher on formatting a GridView, consult the [Custom Formatting Based Upon Data](../custom-formatting/custom-formatting-based-upon-data-cs.md) tutorial.</span></span>

## <a name="an-alternative-approach---creating-another-tableadapter"></a><span data-ttu-id="71574-234">Uma abordagem alternativa – criar outro TableAdapter</span><span class="sxs-lookup"><span data-stu-id="71574-234">An Alternative Approach - Creating Another TableAdapter</span></span>

<span data-ttu-id="71574-235">Como vimos neste tutorial, ao adicionar um método a um TableAdapter que retorna campos de dados diferentes daqueles escritos pela consulta principal, podemos adicionar colunas correspondentes à DataTable.</span><span class="sxs-lookup"><span data-stu-id="71574-235">As we saw in this tutorial, when adding a method to a TableAdapter that returns data fields other than those spelled out by the main query, we can add corresponding columns to the DataTable.</span></span> <span data-ttu-id="71574-236">Essa abordagem, no entanto, funciona bem apenas se houver um pequeno número de métodos no TableAdapter que retornam campos de dados diferentes e se esses campos de dados alternativos não variarem muito da consulta principal.</span><span class="sxs-lookup"><span data-stu-id="71574-236">Such an approach, however, works well only if there are a small number of methods in the TableAdapter that return different data fields and if those alternate data fields do not vary too much from the main query.</span></span>

<span data-ttu-id="71574-237">Em vez de adicionar colunas à DataTable, você pode adicionar outro TableAdapter ao DataSet que contém os métodos do primeiro TableAdapter que retornam campos de dados diferentes.</span><span class="sxs-lookup"><span data-stu-id="71574-237">Rather than adding columns to the DataTable, you can instead add another TableAdapter to the DataSet that contains the methods from the first TableAdapter that return different data fields.</span></span> <span data-ttu-id="71574-238">Para este tutorial, em vez de adicionar a coluna de `PriceQuartile` à `ProductsDataTable` (onde ela é usada apenas pelo método de `GetProductsWithPriceQuartile`), poderíamos ter adicionado um TableAdapter adicional ao conjunto de conjuntos chamado `ProductsWithPriceQuartileTableAdapter` que usava o procedimento armazenado `Products_SelectWithPriceQuartile` como sua consulta principal.</span><span class="sxs-lookup"><span data-stu-id="71574-238">For this tutorial, rather than add the `PriceQuartile` column to the `ProductsDataTable` (where it is only used by the `GetProductsWithPriceQuartile` method), we could have added an additional TableAdapter to the DataSet named `ProductsWithPriceQuartileTableAdapter` that used the `Products_SelectWithPriceQuartile` stored procedure as its main query.</span></span> <span data-ttu-id="71574-239">ASP.NET páginas que precisavam obter informações de produto com o preço quartil usaria o `ProductsWithPriceQuartileTableAdapter`, enquanto aqueles que não podiam continuar a usar o `ProductsTableAdapter`.</span><span class="sxs-lookup"><span data-stu-id="71574-239">ASP.NET pages that needed to get product information with the price quartile would use the `ProductsWithPriceQuartileTableAdapter`, while those that did not could continue to use the `ProductsTableAdapter`.</span></span>

<span data-ttu-id="71574-240">Ao adicionar um novo TableAdapter, as tabelas de dados permanecem untarnished e suas colunas espelham com precisão os campos de dado retornados pelos seus métodos TableAdapter s.</span><span class="sxs-lookup"><span data-stu-id="71574-240">By adding a new TableAdapter, the DataTables remain untarnished and their columns precisely mirror the data fields returned by their TableAdapter s methods.</span></span> <span data-ttu-id="71574-241">No entanto, TableAdapters adicionais podem introduzir tarefas repetitivas e funcionalidades.</span><span class="sxs-lookup"><span data-stu-id="71574-241">However, additional TableAdapters can introduce repetitive tasks and functionality.</span></span> <span data-ttu-id="71574-242">Por exemplo, se as páginas ASP.NET que exibirem a coluna `PriceQuartile` também precisarem fornecer suporte para inserir, atualizar e excluir, a `ProductsWithPriceQuartileTableAdapter` deverá ter suas propriedades `InsertCommand`, `UpdateCommand`e `DeleteCommand` configuradas corretamente.</span><span class="sxs-lookup"><span data-stu-id="71574-242">For example, if those ASP.NET pages that displayed the `PriceQuartile` column also needed to provide insert, update, and delete support, the `ProductsWithPriceQuartileTableAdapter` would need to have its `InsertCommand`, `UpdateCommand`, and `DeleteCommand` properties properly configured.</span></span> <span data-ttu-id="71574-243">Embora essas propriedades espelhem o `ProductsTableAdapter` s, essa configuração apresenta uma etapa extra.</span><span class="sxs-lookup"><span data-stu-id="71574-243">While these properties would mirror the `ProductsTableAdapter` s, this configuration introduces an extra step.</span></span> <span data-ttu-id="71574-244">Além disso, agora há duas maneiras de atualizar, excluir ou adicionar um produto ao banco de dados, por meio das classes `ProductsTableAdapter` e `ProductsWithPriceQuartileTableAdapter`.</span><span class="sxs-lookup"><span data-stu-id="71574-244">Moreover, there are now two ways to update, delete, or add a product to the database - through the `ProductsTableAdapter` and `ProductsWithPriceQuartileTableAdapter` classes.</span></span>

<span data-ttu-id="71574-245">O download para este tutorial inclui uma classe `ProductsWithPriceQuartileTableAdapter` no conjunto de `NorthwindWithSprocs` DataSet que ilustra essa abordagem alternativa.</span><span class="sxs-lookup"><span data-stu-id="71574-245">The download for this tutorial includes a `ProductsWithPriceQuartileTableAdapter` class in the `NorthwindWithSprocs` DataSet that illustrates this alternative approach.</span></span>

## <a name="summary"></a><span data-ttu-id="71574-246">Resumo</span><span class="sxs-lookup"><span data-stu-id="71574-246">Summary</span></span>

<span data-ttu-id="71574-247">Na maioria dos cenários, todos os métodos em um TableAdapter retornarão o mesmo conjunto de campos de dados, mas há ocasiões em que um determinado método ou dois pode precisar retornar um campo adicional.</span><span class="sxs-lookup"><span data-stu-id="71574-247">In most scenarios, all of the methods in a TableAdapter will return the same set of data fields, but there are times when a particular method or two may need to return an additional field.</span></span> <span data-ttu-id="71574-248">Por exemplo, no [mestre/detalhes usando uma lista com marcadores de registros mestres com um tutorial de DataList detalhes](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md) , adicionamos um método ao `CategoriesTableAdapter` que, além dos campos de dados da consulta principal, retornava um campo `NumberOfProducts` que reportou o número de produtos associados a cada categoria.</span><span class="sxs-lookup"><span data-stu-id="71574-248">For example, in the [Master/Detail Using a Bulleted List of Master Records with a Details DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md) tutorial we added a method to the `CategoriesTableAdapter` that, in addition to the main query s data fields, returned a `NumberOfProducts` field that reported the number of products associated with each category.</span></span> <span data-ttu-id="71574-249">Neste tutorial, examinamos a adição de um método no `ProductsTableAdapter` que retornava um campo `PriceQuartile` além dos campos de dados da consulta principal.</span><span class="sxs-lookup"><span data-stu-id="71574-249">In this tutorial we looked at adding a method in the `ProductsTableAdapter` that returned a `PriceQuartile` field in addition to the main query s data fields.</span></span> <span data-ttu-id="71574-250">Para capturar campos de dados adicionais retornados pelos métodos TableAdapter s, precisamos adicionar colunas correspondentes à DataTable.</span><span class="sxs-lookup"><span data-stu-id="71574-250">To capture additional data fields returned by the TableAdapter s methods we need to add corresponding columns to the DataTable.</span></span>

<span data-ttu-id="71574-251">Se você planeja adicionar colunas manualmente à DataTable, é recomendável que o TableAdapter use procedimentos armazenados.</span><span class="sxs-lookup"><span data-stu-id="71574-251">If you plan on manually adding columns to the DataTable, it is recommended that the TableAdapter use stored procedures.</span></span> <span data-ttu-id="71574-252">Se o TableAdapter usar instruções SQL ad hoc, sempre que o assistente de configuração do TableAdapter for executado, todas as listas de campos de dados de métodos serão revertidas para os campos de dados retornados pela consulta principal.</span><span class="sxs-lookup"><span data-stu-id="71574-252">If the TableAdapter uses ad-hoc SQL statements, any time the TableAdapter Configuration wizard is run all of the methods data field lists revert to the data fields returned by the main query.</span></span> <span data-ttu-id="71574-253">Esse problema não se estende aos procedimentos armazenados, que é o motivo pelo qual eles são recomendados e que foram usados neste tutorial.</span><span class="sxs-lookup"><span data-stu-id="71574-253">This problem does not extend to stored procedures, which is why they are recommended and were used in this tutorial.</span></span>

<span data-ttu-id="71574-254">Boa programação!</span><span class="sxs-lookup"><span data-stu-id="71574-254">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="71574-255">Sobre o autor</span><span class="sxs-lookup"><span data-stu-id="71574-255">About the Author</span></span>

<span data-ttu-id="71574-256">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor de sete livros sobre ASP/ASP. net e fundador da [4guysfromrolla.com](http://www.4guysfromrolla.com), tem trabalhado com tecnologias Web da Microsoft desde 1998.</span><span class="sxs-lookup"><span data-stu-id="71574-256">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="71574-257">Scott trabalha como consultor, instrutor e escritor independentes.</span><span class="sxs-lookup"><span data-stu-id="71574-257">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="71574-258">Seu livro mais recente é que a [*Sams ensina a ASP.NET 2,0 em 24 horas*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="71574-258">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="71574-259">Ele pode ser acessado em [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="71574-259">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="71574-260">ou por meio de seu blog, que pode ser encontrado em [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="71574-260">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="71574-261">Agradecimentos especiais a</span><span class="sxs-lookup"><span data-stu-id="71574-261">Special Thanks To</span></span>

<span data-ttu-id="71574-262">Esta série de tutoriais foi revisada por muitos revisores úteis.</span><span class="sxs-lookup"><span data-stu-id="71574-262">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="71574-263">Os revisores potenciais para este tutorial foram Randy Schmidt, Jacky Goor, Bernadette Leigh e Hilton Giesenow.</span><span class="sxs-lookup"><span data-stu-id="71574-263">Lead reviewers for this tutorial were Randy Schmidt, Jacky Goor, Bernadette Leigh, and Hilton Giesenow.</span></span> <span data-ttu-id="71574-264">Está interessado em revisar meus artigos futuros do MSDN?</span><span class="sxs-lookup"><span data-stu-id="71574-264">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="71574-265">Em caso afirmativo, solte-me uma linha em [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="71574-265">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="71574-266">[Anterior](updating-the-tableadapter-to-use-joins-cs.md)
> [Próximo](working-with-computed-columns-cs.md)</span><span class="sxs-lookup"><span data-stu-id="71574-266">[Previous](updating-the-tableadapter-to-use-joins-cs.md)
[Next](working-with-computed-columns-cs.md)</span></span>
