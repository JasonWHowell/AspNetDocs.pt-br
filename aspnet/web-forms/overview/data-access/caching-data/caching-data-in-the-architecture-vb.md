---
uid: web-forms/overview/data-access/caching-data/caching-data-in-the-architecture-vb
title: Armazenando dados em cache na arquitetura (VB) | Microsoft Docs
author: rick-anderson
description: No tutorial anterior, aprendemos como aplicar o Caching na camada de apresentação. Neste tutorial, aprendemos como tirar proveito de nossa arquitetada em camadas...
ms.author: riande
ms.date: 05/30/2007
ms.assetid: 5e189dd7-f4f9-4f28-9b3a-6cb7d392e9c7
msc.legacyurl: /web-forms/overview/data-access/caching-data/caching-data-in-the-architecture-vb
msc.type: authoredcontent
ms.openlocfilehash: dc991a205fa7e61f604bc0f26e9b24b3faefd3d3
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/28/2019
ms.locfileid: "74607485"
---
# <a name="caching-data-in-the-architecture-vb"></a><span data-ttu-id="e5be2-104">Armazenar dados em cache na arquitetura (VB)</span><span class="sxs-lookup"><span data-stu-id="e5be2-104">Caching Data in the Architecture (VB)</span></span>

<span data-ttu-id="e5be2-105">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="e5be2-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="e5be2-106">[Baixar o aplicativo de exemplo](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_59_VB.exe) ou [baixar PDF](caching-data-in-the-architecture-vb/_static/datatutorial59vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="e5be2-106">[Download Sample App](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_59_VB.exe) or [Download PDF](caching-data-in-the-architecture-vb/_static/datatutorial59vb1.pdf)</span></span>

> <span data-ttu-id="e5be2-107">No tutorial anterior, aprendemos como aplicar o Caching na camada de apresentação.</span><span class="sxs-lookup"><span data-stu-id="e5be2-107">In the previous tutorial we learned how to apply caching at the Presentation Layer.</span></span> <span data-ttu-id="e5be2-108">Neste tutorial, aprendemos a aproveitar nossa arquitetura em camadas para armazenar dados em cache na camada de lógica de negócios.</span><span class="sxs-lookup"><span data-stu-id="e5be2-108">In this tutorial we learn how to take advantage of our layered architecture to cache data at the Business Logic Layer.</span></span> <span data-ttu-id="e5be2-109">Fazemos isso estendendo a arquitetura para incluir uma camada de cache.</span><span class="sxs-lookup"><span data-stu-id="e5be2-109">We do this by extending the architecture to include a Caching Layer.</span></span>

## <a name="introduction"></a><span data-ttu-id="e5be2-110">Introdução</span><span class="sxs-lookup"><span data-stu-id="e5be2-110">Introduction</span></span>

<span data-ttu-id="e5be2-111">Como vimos no tutorial anterior, o Caching dos dados de ObjectDataSource s é tão simples quanto definir algumas propriedades.</span><span class="sxs-lookup"><span data-stu-id="e5be2-111">As we saw in the preceding tutorial, caching the ObjectDataSource s data is as simple as setting a couple of properties.</span></span> <span data-ttu-id="e5be2-112">Infelizmente, o ObjectDataSource aplica o Caching na camada de apresentação, que acopla rigidamente as políticas de cache com a página ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="e5be2-112">Unfortunately, the ObjectDataSource applies caching at the Presentation Layer, which tightly couples the caching policies with the ASP.NET page.</span></span> <span data-ttu-id="e5be2-113">Um dos motivos para criar uma arquitetura em camadas é permitir que esses acoplamentos sejam quebrados.</span><span class="sxs-lookup"><span data-stu-id="e5be2-113">One of the reasons for creating a layered architecture is to allow such couplings to be broken.</span></span> <span data-ttu-id="e5be2-114">A camada de lógica de negócios, por exemplo, dissocia a lógica de negócios das páginas ASP.NET, enquanto a camada de acesso a dados dissocia os detalhes de acesso a dados.</span><span class="sxs-lookup"><span data-stu-id="e5be2-114">The Business Logic Layer, for instance, decouples the business logic from the ASP.NET pages, while the Data Access Layer decouples the data access details.</span></span> <span data-ttu-id="e5be2-115">Essa desassociação da lógica de negócios e dos detalhes de acesso a dados é preferida, em parte, porque torna o sistema mais legível, mais passível de manutenção e mais flexível para mudar.</span><span class="sxs-lookup"><span data-stu-id="e5be2-115">This decoupling of business logic and data access details is preferred, in part, because it makes the system more readable, more maintainable, and more flexible to change.</span></span> <span data-ttu-id="e5be2-116">Ele também permite o conhecimento do domínio e a divisão de mão-de-obra que um desenvolvedor que trabalha na camada de apresentação não precisa estar familiarizado com os detalhes do banco de dados para fazer seu trabalho.</span><span class="sxs-lookup"><span data-stu-id="e5be2-116">It also allows for domain knowledge and division of labor a developer working on the Presentation Layer doesn t need to be familiar with the database s details in order to do her job.</span></span> <span data-ttu-id="e5be2-117">A separação da política de cache da camada de apresentação oferece benefícios semelhantes.</span><span class="sxs-lookup"><span data-stu-id="e5be2-117">Decoupling the caching policy from the Presentation Layer offers similar benefits.</span></span>

<span data-ttu-id="e5be2-118">Neste tutorial, ampliaremos nossa arquitetura para incluir uma *camada de cache* (ou CL por curto) que emprega nossa política de cache.</span><span class="sxs-lookup"><span data-stu-id="e5be2-118">In this tutorial we will augment our architecture to include a *Caching Layer* (or CL for short) that employs our caching policy.</span></span> <span data-ttu-id="e5be2-119">A camada de cache incluirá uma classe `ProductsCL` que fornece acesso a informações do produto com métodos como `GetProducts()`, `GetProductsByCategoryID(categoryID)`e assim por diante, que, quando invocado, tentará primeiro recuperar os dados do cache.</span><span class="sxs-lookup"><span data-stu-id="e5be2-119">The Caching Layer will include a `ProductsCL` class that provides access to product information with methods like `GetProducts()`, `GetProductsByCategoryID(categoryID)`, and so forth, that, when invoked, will first attempt to retrieve the data from the cache.</span></span> <span data-ttu-id="e5be2-120">Se o cache estiver vazio, esses métodos invocarão o método de `ProductsBLL` apropriado na BLL, que, por sua vez, obteria os dados da DAL.</span><span class="sxs-lookup"><span data-stu-id="e5be2-120">If the cache is empty, these methods will invoke the appropriate `ProductsBLL` method in the BLL, which would in turn get the data from the DAL.</span></span> <span data-ttu-id="e5be2-121">Os métodos de `ProductsCL` armazenam em cache os dados recuperados da BLL antes de retorná-los.</span><span class="sxs-lookup"><span data-stu-id="e5be2-121">The `ProductsCL` methods cache the data retrieved from the BLL before returning it.</span></span>

<span data-ttu-id="e5be2-122">Como mostra a Figura 1, o CL reside entre as camadas de lógica de negócios e de apresentação.</span><span class="sxs-lookup"><span data-stu-id="e5be2-122">As Figure 1 shows, the CL resides between the Presentation and Business Logic Layers.</span></span>

![A camada de cache (CL) é outra camada em nossa arquitetura](caching-data-in-the-architecture-vb/_static/image1.png)

<span data-ttu-id="e5be2-124">**Figura 1**: a camada de cache (CL) é outra camada em nossa arquitetura</span><span class="sxs-lookup"><span data-stu-id="e5be2-124">**Figure 1**: The Caching Layer (CL) is Another Layer in Our Architecture</span></span>

## <a name="step-1-creating-the-caching-layer-classes"></a><span data-ttu-id="e5be2-125">Etapa 1: criando as classes de camada de cache</span><span class="sxs-lookup"><span data-stu-id="e5be2-125">Step 1: Creating the Caching Layer Classes</span></span>

<span data-ttu-id="e5be2-126">Neste tutorial, criaremos um CL muito simples com uma única classe `ProductsCL` que tem apenas alguns métodos.</span><span class="sxs-lookup"><span data-stu-id="e5be2-126">In this tutorial we will create a very simple CL with a single class `ProductsCL` that has only a handful of methods.</span></span> <span data-ttu-id="e5be2-127">Criar uma camada de cache completa para todo o aplicativo exigiria a criação de classes `CategoriesCL`, `EmployeesCL`e `SuppliersCL` e o fornecimento de um método nessas classes de camada de cache para cada método de acesso a dados ou modificação na BLL.</span><span class="sxs-lookup"><span data-stu-id="e5be2-127">Building a complete Caching Layer for the entire application would require creating `CategoriesCL`, `EmployeesCL`, and `SuppliersCL` classes, and providing a method in these Caching Layer classes for each data access or modification method in the BLL.</span></span> <span data-ttu-id="e5be2-128">Assim como com a BLL e a DAL, a camada de cache deve, idealmente, ser implementada como um projeto de biblioteca de classes separado; no entanto, iremos implementá-lo como uma classe na pasta `App_Code`.</span><span class="sxs-lookup"><span data-stu-id="e5be2-128">As with the BLL and DAL, the Caching Layer should ideally be implemented as a separate Class Library project; however, we will implement it as a class in the `App_Code` folder.</span></span>

<span data-ttu-id="e5be2-129">Para separar com mais clareza as classes CL das classes DAL e BLL, vamos criar uma nova subpasta na pasta `App_Code`.</span><span class="sxs-lookup"><span data-stu-id="e5be2-129">To more cleanly separate the CL classes from the DAL and BLL classes, let s create a new subfolder in the `App_Code` folder.</span></span> <span data-ttu-id="e5be2-130">Clique com o botão direito do mouse na pasta `App_Code` no Gerenciador de Soluções, escolha nova pasta e nomeie a nova pasta `CL`.</span><span class="sxs-lookup"><span data-stu-id="e5be2-130">Right-click on the `App_Code` folder in the Solution Explorer, choose New Folder, and name the new folder `CL`.</span></span> <span data-ttu-id="e5be2-131">Depois de criar essa pasta, adicione a ela uma nova classe chamada `ProductsCL.vb`.</span><span class="sxs-lookup"><span data-stu-id="e5be2-131">After creating this folder, add to it a new class named `ProductsCL.vb`.</span></span>

![Adicione uma nova pasta chamada CL e uma classe chamada ProductsCL. vb](caching-data-in-the-architecture-vb/_static/image2.png)

<span data-ttu-id="e5be2-133">**Figura 2**: adicionar uma nova pasta chamada `CL` e uma classe chamada `ProductsCL.vb`</span><span class="sxs-lookup"><span data-stu-id="e5be2-133">**Figure 2**: Add a New Folder Named `CL` and a Class Named `ProductsCL.vb`</span></span>

<span data-ttu-id="e5be2-134">A classe `ProductsCL` deve incluir o mesmo conjunto de métodos de acesso e modificação de dados, conforme encontrado em sua classe de camada lógica de negócios correspondente (`ProductsBLL`).</span><span class="sxs-lookup"><span data-stu-id="e5be2-134">The `ProductsCL` class should include the same set of data access and modification methods as found in its corresponding Business Logic Layer class (`ProductsBLL`).</span></span> <span data-ttu-id="e5be2-135">Em vez de criar todos esses métodos, vamos apenas criar dois aqui para ter uma ideia dos padrões usados pelo CL.</span><span class="sxs-lookup"><span data-stu-id="e5be2-135">Rather than creating all of these methods, let s just build a couple here to get a feel for the patterns used by the CL.</span></span> <span data-ttu-id="e5be2-136">Em particular, adicionaremos os métodos `GetProducts()` e `GetProductsByCategoryID(categoryID)` na etapa 3 e uma sobrecarga `UpdateProduct` na etapa 4.</span><span class="sxs-lookup"><span data-stu-id="e5be2-136">In particular, we'll add the `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods in Step 3 and an `UpdateProduct` overload in Step 4.</span></span> <span data-ttu-id="e5be2-137">Você pode adicionar os métodos de `ProductsCL` restantes e as classes `CategoriesCL`, `EmployeesCL`e `SuppliersCL` ao seu lazer.</span><span class="sxs-lookup"><span data-stu-id="e5be2-137">You can add the remaining `ProductsCL` methods and `CategoriesCL`, `EmployeesCL`, and `SuppliersCL` classes at your leisure.</span></span>

## <a name="step-2-reading-and-writing-to-the-data-cache"></a><span data-ttu-id="e5be2-138">Etapa 2: lendo e gravando no cache de dados</span><span class="sxs-lookup"><span data-stu-id="e5be2-138">Step 2: Reading and Writing to the Data Cache</span></span>

<span data-ttu-id="e5be2-139">O recurso de cache ObjectDataSource explorado no tutorial anterior usa internamente o cache de dados ASP.NET para armazenar os dados recuperados da BLL.</span><span class="sxs-lookup"><span data-stu-id="e5be2-139">The ObjectDataSource caching feature explored in the preceding tutorial internally uses the ASP.NET data cache to store the data retrieved from the BLL.</span></span> <span data-ttu-id="e5be2-140">O cache de dados também pode ser acessado programaticamente de classes de código-behind de páginas ASP.NET ou das classes na arquitetura do aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="e5be2-140">The data cache can also be accessed programmatically from ASP.NET pages code-behind classes or from the classes in the web application s architecture.</span></span> <span data-ttu-id="e5be2-141">Para ler e gravar no cache de dados de uma classe code-behind da página ASP.NET, use o seguinte padrão:</span><span class="sxs-lookup"><span data-stu-id="e5be2-141">To read and write to the data cache from an ASP.NET page s code-behind class, use the following pattern:</span></span>

[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample1.vb)]

<span data-ttu-id="e5be2-142">O [método`Insert`](https://msdn.microsoft.com/library/system.web.caching.cache.insert.aspx) da [classe`Cache`](https://msdn.microsoft.com/library/system.web.caching.cache.aspx) tem várias sobrecargas.</span><span class="sxs-lookup"><span data-stu-id="e5be2-142">The [`Cache` class](https://msdn.microsoft.com/library/system.web.caching.cache.aspx) s [`Insert` method](https://msdn.microsoft.com/library/system.web.caching.cache.insert.aspx) has a number of overloads.</span></span> <span data-ttu-id="e5be2-143">`Cache("key") = value` e `Cache.Insert(key, value)` são sinônimos e ambos adicionam um item ao cache usando a chave especificada sem uma expiração definida.</span><span class="sxs-lookup"><span data-stu-id="e5be2-143">`Cache("key") = value` and `Cache.Insert(key, value)` are synonymous and both add an item to the cache using the specified key without a defined expiry.</span></span> <span data-ttu-id="e5be2-144">Normalmente, queremos especificar uma expiração ao adicionar um item ao cache, seja como uma dependência, uma expiração baseada em tempo ou ambos.</span><span class="sxs-lookup"><span data-stu-id="e5be2-144">Typically, we want to specify an expiry when adding an item to the cache, either as a dependency, a time-based expiry, or both.</span></span> <span data-ttu-id="e5be2-145">Use um dos outros `Insert` sobrecargas de método para fornecer informações de expiração com base na dependência ou em tempo.</span><span class="sxs-lookup"><span data-stu-id="e5be2-145">Use one of the other `Insert` method s overloads to provide dependency- or time-based expiry information.</span></span>

<span data-ttu-id="e5be2-146">Os métodos s da camada de cache precisam primeiro verificar se os dados solicitados estão no cache e, em caso afirmativo, retorná-los a partir daí.</span><span class="sxs-lookup"><span data-stu-id="e5be2-146">The Caching Layer s methods need to first check if the requested data is in the cache and, if so, return it from there.</span></span> <span data-ttu-id="e5be2-147">Se os dados solicitados não estiverem no cache, o método BLL apropriado precisará ser invocado.</span><span class="sxs-lookup"><span data-stu-id="e5be2-147">If the requested data is not in the cache, the appropriate BLL method needs to be invoked.</span></span> <span data-ttu-id="e5be2-148">Seu valor de retorno deve ser armazenado em cache e, em seguida, retornado, como ilustra o diagrama de sequência a seguir.</span><span class="sxs-lookup"><span data-stu-id="e5be2-148">Its return value should be cached and then returned, as the following sequence diagram illustrates.</span></span>

![Os métodos s da camada de cache retornam dados do cache se estiverem disponíveis](caching-data-in-the-architecture-vb/_static/image3.png)

<span data-ttu-id="e5be2-150">**Figura 3**: os métodos s da camada de cache retornam dados do cache, se estiverem disponíveis</span><span class="sxs-lookup"><span data-stu-id="e5be2-150">**Figure 3**: The Caching Layer s Methods Return Data from the Cache if it s Available</span></span>

<span data-ttu-id="e5be2-151">A sequência representada na Figura 3 é realizada nas classes CL usando o seguinte padrão:</span><span class="sxs-lookup"><span data-stu-id="e5be2-151">The sequence depicted in Figure 3 is accomplished in the CL classes using the following pattern:</span></span>

[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample2.vb)]

<span data-ttu-id="e5be2-152">Aqui, *Type* é o tipo de dados que estão sendo armazenados no cache `Northwind.ProductsDataTable`, por exemplo, enquanto *Key* é a chave que identifica exclusivamente o item de cache.</span><span class="sxs-lookup"><span data-stu-id="e5be2-152">Here, *Type* is the type of data being stored in the cache `Northwind.ProductsDataTable`, for example while *key* is the key that uniquely identifies the cache item.</span></span> <span data-ttu-id="e5be2-153">Se o item com a *chave* especificada não estiver no cache, a *instância* será `Nothing` e os dados serão recuperados do método BLL apropriado e adicionados ao cache.</span><span class="sxs-lookup"><span data-stu-id="e5be2-153">If the item with the specified *key* is not in the cache, then *instance* will be `Nothing` and the data will be retrieved from the appropriate BLL method and added to the cache.</span></span> <span data-ttu-id="e5be2-154">Quando o `Return instance` de tempo é atingido, a *instância* contém uma referência aos dados, do cache ou extraído da BLL.</span><span class="sxs-lookup"><span data-stu-id="e5be2-154">By the time `Return instance` is reached, *instance* contains a reference to the data, either from the cache or pulled from the BLL.</span></span>

<span data-ttu-id="e5be2-155">Certifique-se de usar o padrão acima ao acessar dados do cache.</span><span class="sxs-lookup"><span data-stu-id="e5be2-155">Be sure to use the above pattern when accessing data from the cache.</span></span> <span data-ttu-id="e5be2-156">O padrão a seguir, que, à primeira vista, parece equivalente, contém uma diferença sutil que introduz uma condição de corrida.</span><span class="sxs-lookup"><span data-stu-id="e5be2-156">The following pattern, which, at first glance, looks equivalent, contains a subtle difference that introduces a race condition.</span></span> <span data-ttu-id="e5be2-157">As condições de corrida são difíceis de depurar porque revelam esporadicamente e são difíceis de reproduzir.</span><span class="sxs-lookup"><span data-stu-id="e5be2-157">Race conditions are difficult to debug because they reveal themselves sporadically and are difficult to reproduce.</span></span>

[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample3.vb)]

<span data-ttu-id="e5be2-158">A diferença neste segundo, trecho de código incorreto, é que, em vez de armazenar uma referência ao item armazenado em cache em uma variável local, o cache de dados é acessado diretamente na instrução condicional *e* no `Return`.</span><span class="sxs-lookup"><span data-stu-id="e5be2-158">The difference in this second, incorrect code snippet is that rather than storing a reference to the cached item in a local variable, the data cache is accessed directly in the conditional statement *and* in the `Return`.</span></span> <span data-ttu-id="e5be2-159">Imagine que, quando esse código for atingido, `Cache("key")` não seja `Nothing`, mas antes que a instrução `Return` seja atingida, o sistema removerá a *chave* do cache.</span><span class="sxs-lookup"><span data-stu-id="e5be2-159">Imagine that when this code is reached, `Cache("key")` is not `Nothing`, but before the `Return` statement is reached, the system evicts *key* from the cache.</span></span> <span data-ttu-id="e5be2-160">Nesse caso raro, o código retornará `Nothing` em vez de um objeto do tipo esperado.</span><span class="sxs-lookup"><span data-stu-id="e5be2-160">In this rare case, the code will return `Nothing` rather than an object of the expected type.</span></span>

> [!NOTE]
> <span data-ttu-id="e5be2-161">O cache de dados é thread-safe, portanto, você não precisa sincronizar o acesso ao thread para leituras ou gravações simples.</span><span class="sxs-lookup"><span data-stu-id="e5be2-161">The data cache is thread-safe, so you don't need to synchronize thread access for simple reads or writes.</span></span> <span data-ttu-id="e5be2-162">No entanto, se você precisar executar várias operações em dados no cache que precisam ser atômicas, será responsável pela implementação de um bloqueio ou algum outro mecanismo para garantir a segurança do thread.</span><span class="sxs-lookup"><span data-stu-id="e5be2-162">However, if you need to perform multiple operations on data in the cache that need to be atomic, you are responsible for implementing a lock or some other mechanism to ensure thread safety.</span></span> <span data-ttu-id="e5be2-163">Consulte [sincronizando o acesso ao Cache ASP.net](http://www.ddj.com/184406369) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="e5be2-163">See [Synchronizing Access to the ASP.NET Cache](http://www.ddj.com/184406369) for more information.</span></span>

<span data-ttu-id="e5be2-164">Um item pode ser removido programaticamente do cache de dados usando o [método`Remove`](https://msdn.microsoft.com/library/system.web.caching.cache.remove.aspx) da seguinte forma:</span><span class="sxs-lookup"><span data-stu-id="e5be2-164">An item can be programmatically evicted from the data cache using the [`Remove` method](https://msdn.microsoft.com/library/system.web.caching.cache.remove.aspx) like so:</span></span>

[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample4.vb)]

## <a name="step-3-returning-product-information-from-theproductsclclass"></a><span data-ttu-id="e5be2-165">Etapa 3: retornando informações do produto da classe`ProductsCL`</span><span class="sxs-lookup"><span data-stu-id="e5be2-165">Step 3: Returning Product Information from the`ProductsCL`Class</span></span>

<span data-ttu-id="e5be2-166">Para este tutorial, vamos implementar dois métodos para retornar informações de produto da classe `ProductsCL`: `GetProducts()` e `GetProductsByCategoryID(categoryID)`.</span><span class="sxs-lookup"><span data-stu-id="e5be2-166">For this tutorial let s implement two methods for returning product information from the `ProductsCL` class: `GetProducts()` and `GetProductsByCategoryID(categoryID)`.</span></span> <span data-ttu-id="e5be2-167">Assim como com a classe `ProductsBL` na camada de lógica de negócios, o método `GetProducts()` no CL retorna informações sobre todos os produtos como um objeto `Northwind.ProductsDataTable`, enquanto `GetProductsByCategoryID(categoryID)` retorna todos os produtos de uma categoria especificada.</span><span class="sxs-lookup"><span data-stu-id="e5be2-167">Like with the `ProductsBL` class in the Business Logic Layer, the `GetProducts()` method in the CL returns information about all of the products as a `Northwind.ProductsDataTable` object, while `GetProductsByCategoryID(categoryID)` returns all of the products from a specified category.</span></span>

<span data-ttu-id="e5be2-168">O código a seguir mostra uma parte dos métodos na classe `ProductsCL`:</span><span class="sxs-lookup"><span data-stu-id="e5be2-168">The following code shows a portion of the methods in the `ProductsCL` class:</span></span>

[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample5.vb)]

<span data-ttu-id="e5be2-169">Primeiro, observe os atributos `DataObject` e `DataObjectMethodAttribute` aplicados à classe e aos métodos.</span><span class="sxs-lookup"><span data-stu-id="e5be2-169">First, note the `DataObject` and `DataObjectMethodAttribute` attributes applied to the class and methods.</span></span> <span data-ttu-id="e5be2-170">Esses atributos fornecem informações para o assistente ObjectDataSource s, indicando quais classes e métodos devem aparecer nas etapas do assistente.</span><span class="sxs-lookup"><span data-stu-id="e5be2-170">These attributes provide information to the ObjectDataSource s wizard, indicating what classes and methods should appear in the wizard s steps.</span></span> <span data-ttu-id="e5be2-171">Como as classes e os métodos CL serão acessados de um ObjectDataSource na camada de apresentação, adicionei esses atributos para aprimorar a experiência em tempo de design.</span><span class="sxs-lookup"><span data-stu-id="e5be2-171">Since the CL classes and methods will be accessed from an ObjectDataSource in the Presentation Layer, I added these attributes to enhance the design-time experience.</span></span> <span data-ttu-id="e5be2-172">Consulte o tutorial [criando uma camada de lógica de negócios](../introduction/creating-a-business-logic-layer-vb.md) para obter uma descrição mais completa sobre esses atributos e seus efeitos.</span><span class="sxs-lookup"><span data-stu-id="e5be2-172">Refer back to the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-vb.md) tutorial for a more thorough description on these attributes and their effects.</span></span>

<span data-ttu-id="e5be2-173">Nos métodos `GetProducts()` e `GetProductsByCategoryID(categoryID)`, os dados retornados do método `GetCacheItem(key)` são atribuídos a uma variável local.</span><span class="sxs-lookup"><span data-stu-id="e5be2-173">In the `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods, the data returned from the `GetCacheItem(key)` method is assigned to a local variable.</span></span> <span data-ttu-id="e5be2-174">O método `GetCacheItem(key)`, que examinaremos em breve, retorna um item específico do cache com base na *chave*especificada.</span><span class="sxs-lookup"><span data-stu-id="e5be2-174">The `GetCacheItem(key)` method, which we'll examine shortly, returns a particular item from the cache based on the specified *key*.</span></span> <span data-ttu-id="e5be2-175">Se esses dados não forem encontrados no cache, eles serão recuperados do método de classe de `ProductsBLL` correspondente e, em seguida, adicionados ao cache usando o método `AddCacheItem(key, value)`.</span><span class="sxs-lookup"><span data-stu-id="e5be2-175">If no such data is found in cache, it is retrieved from the corresponding `ProductsBLL` class method and then added to the cache using the `AddCacheItem(key, value)` method.</span></span>

<span data-ttu-id="e5be2-176">A interface de métodos `GetCacheItem(key)` e `AddCacheItem(key, value)` com o cache de dados, leitura e gravação de valores, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="e5be2-176">The `GetCacheItem(key)` and `AddCacheItem(key, value)` methods interface with the data cache, reading and writing values, respectively.</span></span> <span data-ttu-id="e5be2-177">O método `GetCacheItem(key)` é o mais simples dos dois.</span><span class="sxs-lookup"><span data-stu-id="e5be2-177">The `GetCacheItem(key)` method is the simpler of the two.</span></span> <span data-ttu-id="e5be2-178">Ele simplesmente retorna o valor da classe de cache usando a *chave*passada:</span><span class="sxs-lookup"><span data-stu-id="e5be2-178">It simply returns the value from the Cache class using the passed-in *key*:</span></span>

[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample6.vb)]

<span data-ttu-id="e5be2-179">`GetCacheItem(key)` não usa o valor de *chave* conforme fornecido, mas chama o método `GetCacheKey(key)`, que retorna a *chave* precedida por ProductsCache-.</span><span class="sxs-lookup"><span data-stu-id="e5be2-179">`GetCacheItem(key)` does not use *key* value as supplied, but instead calls the `GetCacheKey(key)` method, which returns the *key* prepended with ProductsCache-.</span></span> <span data-ttu-id="e5be2-180">O `MasterCacheKeyArray`, que contém a cadeia de caracteres ProductsCache, também é usado pelo método `AddCacheItem(key, value)`, como veremos momentaneamente.</span><span class="sxs-lookup"><span data-stu-id="e5be2-180">The `MasterCacheKeyArray`, which holds the string ProductsCache, is also used by the `AddCacheItem(key, value)` method, as we'll see momentarily.</span></span>

<span data-ttu-id="e5be2-181">De uma classe code-behind da página ASP.NET s, o cache de dados pode ser acessado usando a [propriedade `Page``Cache`](https://msdn.microsoft.com/library/system.web.ui.page.cache.aspx)classe e permite sintaxe como `Cache("key") = value`, conforme discutido na etapa 2.</span><span class="sxs-lookup"><span data-stu-id="e5be2-181">From an ASP.NET page s code-behind class, the data cache can be accessed using the `Page` class s [`Cache` property](https://msdn.microsoft.com/library/system.web.ui.page.cache.aspx), and allows for syntax like `Cache("key") = value`, as discussed in Step 2.</span></span> <span data-ttu-id="e5be2-182">De uma classe dentro da arquitetura, o cache de dados pode ser acessado usando `HttpRuntime.Cache` ou `HttpContext.Current.Cache`.</span><span class="sxs-lookup"><span data-stu-id="e5be2-182">From a class within the architecture, the data cache can be accessed using either `HttpRuntime.Cache` or `HttpContext.Current.Cache`.</span></span> <span data-ttu-id="e5be2-183">A entrada de blog de [Peter Johnson](https://weblogs.asp.net/pjohnson/default.aspx)em [HttpRuntime. cache versus HttpContext. Current. cache](https://weblogs.asp.net/pjohnson/httpruntime-cache-vs-httpcontext-current-cache) observa a ligeira vantagem de desempenho no uso de `HttpRuntime` em vez de `HttpContext.Current`; Consequentemente, `ProductsCL` usa `HttpRuntime`.</span><span class="sxs-lookup"><span data-stu-id="e5be2-183">[Peter Johnson](https://weblogs.asp.net/pjohnson/default.aspx)'s blog entry [HttpRuntime.Cache vs. HttpContext.Current.Cache](https://weblogs.asp.net/pjohnson/httpruntime-cache-vs-httpcontext-current-cache) notes the slight performance advantage in using `HttpRuntime` instead of `HttpContext.Current`; consequently, `ProductsCL` uses `HttpRuntime`.</span></span>

> [!NOTE]
> <span data-ttu-id="e5be2-184">Se sua arquitetura for implementada usando projetos de biblioteca de classes, você precisará adicionar uma referência ao assembly de `System.Web` para usar as classes [`HttpRuntime`](https://msdn.microsoft.com/library/system.web.httpruntime.aspx) e [`HttpContext`](https://msdn.microsoft.com/library/system.web.httpcontext.aspx) .</span><span class="sxs-lookup"><span data-stu-id="e5be2-184">If your architecture is implemented using Class Library projects then you will need to add a reference to the `System.Web` assembly in order to use the [`HttpRuntime`](https://msdn.microsoft.com/library/system.web.httpruntime.aspx) and [`HttpContext`](https://msdn.microsoft.com/library/system.web.httpcontext.aspx) classes.</span></span>

<span data-ttu-id="e5be2-185">Se o item não for encontrado no cache, os métodos s da classe `ProductsCL` obterão os dados da BLL e o adicionarão ao cache usando o método `AddCacheItem(key, value)`.</span><span class="sxs-lookup"><span data-stu-id="e5be2-185">If the item is not found in the cache, the `ProductsCL` class s methods get the data from the BLL and add it to the cache using the `AddCacheItem(key, value)` method.</span></span> <span data-ttu-id="e5be2-186">Para adicionar *valor* ao cache, poderíamos usar o código a seguir, que usa um período de expiração de 60 segundos:</span><span class="sxs-lookup"><span data-stu-id="e5be2-186">To add *value* to the cache we could use the following code, which uses a 60 second time expiry:</span></span>

[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample7.vb)]

<span data-ttu-id="e5be2-187">`DateTime.Now.AddSeconds(CacheDuration)` especifica a expiração baseada em tempo de 60 segundos no futuro, enquanto [`System.Web.Caching.Cache.NoSlidingExpiration`](https://msdn.microsoft.com/library/system.web.caching.cache.noslidingexpiration(vs.80).aspx) indica que não há nenhuma expiração deslizante.</span><span class="sxs-lookup"><span data-stu-id="e5be2-187">`DateTime.Now.AddSeconds(CacheDuration)` specifies the time-based expiry 60 seconds in the future while [`System.Web.Caching.Cache.NoSlidingExpiration`](https://msdn.microsoft.com/library/system.web.caching.cache.noslidingexpiration(vs.80).aspx) indicates that there s no sliding expiration.</span></span> <span data-ttu-id="e5be2-188">Embora esse `Insert` sobrecarga de método tenha parâmetros de entrada para uma expiração absoluta e deslizante, você só pode fornecer um dos dois.</span><span class="sxs-lookup"><span data-stu-id="e5be2-188">While this `Insert` method overload has input parameters for both an absolute and sliding expiry, you can only provide one of the two.</span></span> <span data-ttu-id="e5be2-189">Se você tentar especificar uma hora absoluta e um período de tempo, o método `Insert` gerará uma exceção de `ArgumentException`.</span><span class="sxs-lookup"><span data-stu-id="e5be2-189">If you attempt to specify both an absolute time and a time span, the `Insert` method will throw an `ArgumentException` exception.</span></span>

> [!NOTE]
> <span data-ttu-id="e5be2-190">Essa implementação do método `AddCacheItem(key, value)` atualmente tem algumas deficiências.</span><span class="sxs-lookup"><span data-stu-id="e5be2-190">This implementation of the `AddCacheItem(key, value)` method currently has some shortcomings.</span></span> <span data-ttu-id="e5be2-191">Abordaremos e superaremos esses problemas na etapa 4.</span><span class="sxs-lookup"><span data-stu-id="e5be2-191">We'll address and overcome these issues in Step 4.</span></span>

## <a name="step-4-invalidating-the-cache-when-the-data-is-modified-through-the-architecture"></a><span data-ttu-id="e5be2-192">Etapa 4: invalidando o cache quando os dados são modificados por meio da arquitetura</span><span class="sxs-lookup"><span data-stu-id="e5be2-192">Step 4: Invalidating the Cache When the Data is Modified Through the Architecture</span></span>

<span data-ttu-id="e5be2-193">Juntamente com os métodos de recuperação de dados, a camada de cache precisa fornecer os mesmos métodos que a BLL para inserir, atualizar e excluir dados.</span><span class="sxs-lookup"><span data-stu-id="e5be2-193">Along with data retrieval methods, the Caching Layer needs to provide the same methods as the BLL for inserting, updating, and deleting data.</span></span> <span data-ttu-id="e5be2-194">Os métodos de modificação de dados CI s não modificam os dados armazenados em cache, mas chamam o método de modificação de dados correspondente da BLL e, em seguida, invalidam o cache.</span><span class="sxs-lookup"><span data-stu-id="e5be2-194">The CL s data modification methods do not modify the cached data, but rather call the BLL s corresponding data modification method and then invalidate the cache.</span></span> <span data-ttu-id="e5be2-195">Como vimos no tutorial anterior, esse é o mesmo comportamento que o ObjectDataSource aplica quando seus recursos de caching estão habilitados e seus `Insert`, `Update`ou `Delete` métodos são invocados.</span><span class="sxs-lookup"><span data-stu-id="e5be2-195">As we saw in the preceding tutorial, this is the same behavior that the ObjectDataSource applies when its caching features are enabled and its `Insert`, `Update`, or `Delete` methods are invoked.</span></span>

<span data-ttu-id="e5be2-196">A sobrecarga de `UpdateProduct` a seguir ilustra como implementar os métodos de modificação de dados no CL:</span><span class="sxs-lookup"><span data-stu-id="e5be2-196">The following `UpdateProduct` overload illustrates how to implement the data modification methods in the CL:</span></span>

[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample8.vb)]

<span data-ttu-id="e5be2-197">O método apropriado da camada de lógica de negócios de modificação de dados é invocado, mas antes de sua resposta ser retornada, precisamos invalidar o cache.</span><span class="sxs-lookup"><span data-stu-id="e5be2-197">The appropriate data modification Business Logic Layer method is invoked, but before its response is returned we need to invalidate the cache.</span></span> <span data-ttu-id="e5be2-198">Infelizmente, a invalidação do cache não é simples porque a classe `ProductsCL` s `GetProducts()` e os métodos `GetProductsByCategoryID(categoryID)` cada um adiciona itens ao cache com chaves diferentes, e o método `GetProductsByCategoryID(categoryID)` adiciona um item de cache diferente para cada *CategoryID*exclusiva.</span><span class="sxs-lookup"><span data-stu-id="e5be2-198">Unfortunately, invalidating the cache is not straightforward because the `ProductsCL` class s `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods each add items to the cache with different keys, and the `GetProductsByCategoryID(categoryID)` method adds a different cache item for each unique *categoryID*.</span></span>

<span data-ttu-id="e5be2-199">Ao invalidar o cache, precisamos remover *todos* os itens que podem ter sido adicionados pela classe `ProductsCL`.</span><span class="sxs-lookup"><span data-stu-id="e5be2-199">When invalidating the cache, we need to remove *all* of the items that may have been added by the `ProductsCL` class.</span></span> <span data-ttu-id="e5be2-200">Isso pode ser feito associando uma *dependência de cache* a cada item adicionado ao cache no método `AddCacheItem(key, value)`.</span><span class="sxs-lookup"><span data-stu-id="e5be2-200">This can be accomplished by associating a *cache dependency* with the each item added to the cache in the `AddCacheItem(key, value)` method.</span></span> <span data-ttu-id="e5be2-201">Em geral, uma dependência de cache pode ser outro item no cache, um arquivo no sistema de arquivos ou dados de um banco de dado Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="e5be2-201">In general, a cache dependency can be another item in the cache, a file on the file system, or data from a Microsoft SQL Server database.</span></span> <span data-ttu-id="e5be2-202">Quando a dependência é alterada ou removida do cache, os itens de cache aos quais ele está associado são automaticamente removidos do cache.</span><span class="sxs-lookup"><span data-stu-id="e5be2-202">When the dependency changes or is removed from the cache, the cache items it is associated with are automatically evicted from the cache.</span></span> <span data-ttu-id="e5be2-203">Para este tutorial, queremos criar um item adicional no cache que serve como uma dependência de cache para todos os itens adicionados por meio da classe `ProductsCL`.</span><span class="sxs-lookup"><span data-stu-id="e5be2-203">For this tutorial, we want to create an additional item in the cache that serves as a cache dependency for all items added through the `ProductsCL` class.</span></span> <span data-ttu-id="e5be2-204">Dessa forma, todos esses itens podem ser removidos do cache simplesmente removendo a dependência de cache.</span><span class="sxs-lookup"><span data-stu-id="e5be2-204">That way, all of these items can be removed from the cache by simply removing the cache dependency.</span></span>

<span data-ttu-id="e5be2-205">Deixe que os s atualizem o método `AddCacheItem(key, value)` para que cada item adicionado ao cache por meio desse método esteja associado a uma única dependência de cache:</span><span class="sxs-lookup"><span data-stu-id="e5be2-205">Let s update the `AddCacheItem(key, value)` method so that each item added to the cache through this method is associated with a single cache dependency:</span></span>

[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample9.vb)]

<span data-ttu-id="e5be2-206">`MasterCacheKeyArray` é uma matriz de cadeia de caracteres que contém um único valor, ProductsCache.</span><span class="sxs-lookup"><span data-stu-id="e5be2-206">`MasterCacheKeyArray` is a string array that holds a single value, ProductsCache.</span></span> <span data-ttu-id="e5be2-207">Primeiro, um item de cache é adicionado ao cache e atribuído a data e hora atuais.</span><span class="sxs-lookup"><span data-stu-id="e5be2-207">First, a cache item is added to the cache and assigned the current date and time.</span></span> <span data-ttu-id="e5be2-208">Se o item de cache já existir, ele será atualizado.</span><span class="sxs-lookup"><span data-stu-id="e5be2-208">If the cache item already exists, it is updated.</span></span> <span data-ttu-id="e5be2-209">Em seguida, uma dependência de cache é criada.</span><span class="sxs-lookup"><span data-stu-id="e5be2-209">Next, a cache dependency is created.</span></span> <span data-ttu-id="e5be2-210">O construtor [classe s`CacheDependency`](https://msdn.microsoft.com/library/system.web.caching.cachedependency(VS.80).aspx) tem várias sobrecargas, mas o que está sendo usado aqui espera duas entradas de matriz `String`.</span><span class="sxs-lookup"><span data-stu-id="e5be2-210">The [`CacheDependency` class](https://msdn.microsoft.com/library/system.web.caching.cachedependency(VS.80).aspx) s constructor has a number of overloads, but the one being used in here expects two `String` array inputs.</span></span> <span data-ttu-id="e5be2-211">O primeiro especifica o conjunto de arquivos a ser usado como dependências.</span><span class="sxs-lookup"><span data-stu-id="e5be2-211">The first one specifies the set of files to be used as dependencies.</span></span> <span data-ttu-id="e5be2-212">Como não queremos usar nenhuma dependência baseada em arquivo, um valor de `Nothing` é usado para o primeiro parâmetro de entrada.</span><span class="sxs-lookup"><span data-stu-id="e5be2-212">Since we don t want to use any file-based dependencies, a value of `Nothing` is used for the first input parameter.</span></span> <span data-ttu-id="e5be2-213">O segundo parâmetro de entrada especifica o conjunto de chaves de cache a ser usado como dependências.</span><span class="sxs-lookup"><span data-stu-id="e5be2-213">The second input parameter specifies the set of cache keys to use as dependencies.</span></span> <span data-ttu-id="e5be2-214">Aqui, especificamos nossa única dependência, `MasterCacheKeyArray`.</span><span class="sxs-lookup"><span data-stu-id="e5be2-214">Here we specify our single dependency, `MasterCacheKeyArray`.</span></span> <span data-ttu-id="e5be2-215">Em seguida, o `CacheDependency` é passado para o método `Insert`.</span><span class="sxs-lookup"><span data-stu-id="e5be2-215">The `CacheDependency` is then passed into the `Insert` method.</span></span>

<span data-ttu-id="e5be2-216">Com essa modificação para `AddCacheItem(key, value)`, invalidar o cache é tão simples quanto remover a dependência.</span><span class="sxs-lookup"><span data-stu-id="e5be2-216">With this modification to `AddCacheItem(key, value)`, invaliding the cache is as simple as removing the dependency.</span></span>

[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample10.vb)]

## <a name="step-5-calling-the-caching-layer-from-the-presentation-layer"></a><span data-ttu-id="e5be2-217">Etapa 5: chamando a camada de cache da camada de apresentação</span><span class="sxs-lookup"><span data-stu-id="e5be2-217">Step 5: Calling the Caching Layer from the Presentation Layer</span></span>

<span data-ttu-id="e5be2-218">As classes e os métodos da camada de cache podem ser usados para trabalhar com dados usando as técnicas que veremos em todos esses tutoriais.</span><span class="sxs-lookup"><span data-stu-id="e5be2-218">The Caching Layer s classes and methods can be used to work with data using the techniques we ve examined throughout these tutorials.</span></span> <span data-ttu-id="e5be2-219">Para ilustrar como trabalhar com dados armazenados em cache, salve as alterações na classe `ProductsCL` e, em seguida, abra a página `FromTheArchitecture.aspx` na pasta `Caching` e adicione um GridView.</span><span class="sxs-lookup"><span data-stu-id="e5be2-219">To illustrate working with cached data, save your changes to the `ProductsCL` class and then open the `FromTheArchitecture.aspx` page in the `Caching` folder and add a GridView.</span></span> <span data-ttu-id="e5be2-220">Na marca inteligente s GridView, crie um novo ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="e5be2-220">From the GridView s smart tag, create a new ObjectDataSource.</span></span> <span data-ttu-id="e5be2-221">Na primeira etapa do assistente, você deve ver a classe `ProductsCL` como uma das opções da lista suspensa.</span><span class="sxs-lookup"><span data-stu-id="e5be2-221">In the wizard s first step you should see the `ProductsCL` class as one of the options from the drop-down list.</span></span>

<span data-ttu-id="e5be2-222">[![a classe ProductsCL está incluída na lista suspensa objeto comercial](caching-data-in-the-architecture-vb/_static/image5.png)](caching-data-in-the-architecture-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="e5be2-222">[![The ProductsCL Class is Included in the Business Object Drop-Down List](caching-data-in-the-architecture-vb/_static/image5.png)](caching-data-in-the-architecture-vb/_static/image4.png)</span></span>

<span data-ttu-id="e5be2-223">**Figura 4**: a classe `ProductsCL` está incluída na lista suspensa objeto comercial ([clique para exibir a imagem em tamanho normal](caching-data-in-the-architecture-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="e5be2-223">**Figure 4**: The `ProductsCL` Class is Included in the Business Object Drop-Down List ([Click to view full-size image](caching-data-in-the-architecture-vb/_static/image6.png))</span></span>

<span data-ttu-id="e5be2-224">Depois de selecionar `ProductsCL`, clique em Avançar.</span><span class="sxs-lookup"><span data-stu-id="e5be2-224">After selecting `ProductsCL`, click Next.</span></span> <span data-ttu-id="e5be2-225">A lista suspensa na guia selecionar tem dois itens-`GetProducts()` e `GetProductsByCategoryID(categoryID)` e a guia atualizar tem a única sobrecarga de `UpdateProduct`.</span><span class="sxs-lookup"><span data-stu-id="e5be2-225">The drop-down list in the SELECT tab has two items - `GetProducts()` and `GetProductsByCategoryID(categoryID)` and the UPDATE tab has the sole `UpdateProduct` overload.</span></span> <span data-ttu-id="e5be2-226">Escolha o método `GetProducts()` na guia selecionar e o método `UpdateProducts` na guia atualizar e clique em concluir.</span><span class="sxs-lookup"><span data-stu-id="e5be2-226">Choose the `GetProducts()` method from the SELECT tab and the `UpdateProducts` method from the UPDATE tab and click Finish.</span></span>

<span data-ttu-id="e5be2-227">[![os métodos de s da classe ProductsCL são listados nas listas suspensas](caching-data-in-the-architecture-vb/_static/image8.png)](caching-data-in-the-architecture-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="e5be2-227">[![The ProductsCL Class s Methods are Listed in the Drop-Down Lists](caching-data-in-the-architecture-vb/_static/image8.png)](caching-data-in-the-architecture-vb/_static/image7.png)</span></span>

<span data-ttu-id="e5be2-228">**Figura 5**: os métodos da classe s `ProductsCL` são listados nas listas suspensas ([clique para exibir a imagem em tamanho normal](caching-data-in-the-architecture-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="e5be2-228">**Figure 5**: The `ProductsCL` Class s Methods are Listed in the Drop-Down Lists ([Click to view full-size image](caching-data-in-the-architecture-vb/_static/image9.png))</span></span>

<span data-ttu-id="e5be2-229">Depois de concluir o assistente, o Visual Studio definirá a Propriedade ObjectDataSource s `OldValuesParameterFormatString` como `original_{0}` e adicionará os campos apropriados ao GridView.</span><span class="sxs-lookup"><span data-stu-id="e5be2-229">After completing the wizard, Visual Studio will set the ObjectDataSource s `OldValuesParameterFormatString` property to `original_{0}` and add the appropriate fields to the GridView.</span></span> <span data-ttu-id="e5be2-230">Altere a propriedade `OldValuesParameterFormatString` de volta para seu valor padrão, `{0}`e configure o GridView para dar suporte à paginação, classificação e edição.</span><span class="sxs-lookup"><span data-stu-id="e5be2-230">Change the `OldValuesParameterFormatString` property back to its default value, `{0}`, and configure the GridView to support paging, sorting, and editing.</span></span> <span data-ttu-id="e5be2-231">Como a sobrecarga de `UploadProducts` usada pelo CL aceita apenas o nome e o preço do produto editado, limite o GridView para que apenas esses campos sejam editáveis.</span><span class="sxs-lookup"><span data-stu-id="e5be2-231">Since the `UploadProducts` overload used by the CL accepts only the edited product s name and price, limit the GridView so that only these fields are editable.</span></span>

<span data-ttu-id="e5be2-232">No tutorial anterior, definimos um GridView para incluir campos para os campos `ProductName`, `CategoryName`e `UnitPrice`.</span><span class="sxs-lookup"><span data-stu-id="e5be2-232">In the preceding tutorial we defined a GridView to include fields for the `ProductName`, `CategoryName`, and `UnitPrice` fields.</span></span> <span data-ttu-id="e5be2-233">Sinta-se à vontade para replicar essa formatação e estrutura, caso em que a marcação declarativa de GridView e ObjectDataSource s deve ser semelhante ao seguinte:</span><span class="sxs-lookup"><span data-stu-id="e5be2-233">Feel free to replicate this formatting and structure, in which case your GridView and ObjectDataSource s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](caching-data-in-the-architecture-vb/samples/sample11.aspx)]

<span data-ttu-id="e5be2-234">Neste ponto, temos uma página que usa a camada de cache.</span><span class="sxs-lookup"><span data-stu-id="e5be2-234">At this point we have a page that uses the Caching Layer.</span></span> <span data-ttu-id="e5be2-235">Para ver o cache em ação, defina os pontos de interrupção nos métodos `GetProducts()` e `UpdateProduct` da classe `ProductsCL`.</span><span class="sxs-lookup"><span data-stu-id="e5be2-235">To see the cache in action, set breakpoints in the `ProductsCL` class s `GetProducts()` and `UpdateProduct` methods.</span></span> <span data-ttu-id="e5be2-236">Visite a página em um navegador e percorra o código ao classificar e paginar para ver os dados extraídos do cache.</span><span class="sxs-lookup"><span data-stu-id="e5be2-236">Visit the page in a browser and step through the code when sorting and paging in order to see the data pulled from the cache.</span></span> <span data-ttu-id="e5be2-237">Em seguida, atualize um registro e observe que o cache é invalidado e, consequentemente, ele é recuperado da BLL quando os dados são reassociados ao GridView.</span><span class="sxs-lookup"><span data-stu-id="e5be2-237">Then update a record and note that the cache is invalidated and, consequently, it is retrieved from the BLL when the data is rebound to the GridView.</span></span>

> [!NOTE]
> <span data-ttu-id="e5be2-238">A camada de cache fornecida no download que acompanha este artigo não está completa.</span><span class="sxs-lookup"><span data-stu-id="e5be2-238">The Caching Layer provided in the download accompanying this article is not complete.</span></span> <span data-ttu-id="e5be2-239">Ele contém apenas uma classe, `ProductsCL`, que apenas apresenta alguns métodos.</span><span class="sxs-lookup"><span data-stu-id="e5be2-239">It contains only one class, `ProductsCL`, which only sports a handful of methods.</span></span> <span data-ttu-id="e5be2-240">Além disso, apenas uma única página ASP.NET usa o CL (`~/Caching/FromTheArchitecture.aspx`), todos os outros ainda referenciam a BLL diretamente.</span><span class="sxs-lookup"><span data-stu-id="e5be2-240">Moreover, only a single ASP.NET page uses the CL (`~/Caching/FromTheArchitecture.aspx`) all others still reference the BLL directly.</span></span> <span data-ttu-id="e5be2-241">Se você planeja usar um CL em seu aplicativo, todas as chamadas da camada de apresentação devem ir para CL, o que exigiria que as classes e métodos da CL abrangissem essas classes e métodos na BLL usados atualmente pela camada de apresentação.</span><span class="sxs-lookup"><span data-stu-id="e5be2-241">If you plan on using a CL in your application, all calls from the Presentation Layer should go to the CL, which would require that the CL s classes and methods covered those classes and methods in the BLL currently used by the Presentation Layer.</span></span>

## <a name="summary"></a><span data-ttu-id="e5be2-242">Resumo</span><span class="sxs-lookup"><span data-stu-id="e5be2-242">Summary</span></span>

<span data-ttu-id="e5be2-243">Embora o cache possa ser aplicado na camada de apresentação com os controles SqlDataSource e ObjectDataSource de ASP.NET 2,0 s, as responsabilidades de cache ideais seriam delegadas a uma camada separada na arquitetura.</span><span class="sxs-lookup"><span data-stu-id="e5be2-243">While caching can be applied at the Presentation Layer with ASP.NET 2.0 s SqlDataSource and ObjectDataSource controls, ideally caching responsibilities would be delegated to a separate layer in the architecture.</span></span> <span data-ttu-id="e5be2-244">Neste tutorial, criamos uma camada de cache que reside entre a camada de apresentação e a camada de lógica de negócios.</span><span class="sxs-lookup"><span data-stu-id="e5be2-244">In this tutorial we created a Caching Layer that resides between the Presentation Layer and the Business Logic Layer.</span></span> <span data-ttu-id="e5be2-245">A camada de cache precisa fornecer o mesmo conjunto de classes e métodos que existem na BLL e são chamados da camada de apresentação.</span><span class="sxs-lookup"><span data-stu-id="e5be2-245">The Caching Layer needs to provide the same set of classes and methods that exist in the BLL and are called from the Presentation Layer.</span></span>

<span data-ttu-id="e5be2-246">Os exemplos de camada de cache que exploramos neste e os tutoriais anteriores exibiram o *carregamento reativo*.</span><span class="sxs-lookup"><span data-stu-id="e5be2-246">The Caching Layer examples we explored in this and the preceding tutorials exhibited *reactive loading*.</span></span> <span data-ttu-id="e5be2-247">Com o carregamento reativo, os dados são carregados no cache somente quando uma solicitação de dados é feita e esses dados estão ausentes do cache.</span><span class="sxs-lookup"><span data-stu-id="e5be2-247">With reactive loading, the data is loaded into the cache only when a request for the data is made and that data is missing from the cache.</span></span> <span data-ttu-id="e5be2-248">Os dados também podem ser *carregados proativamente* no cache, uma técnica que carrega os dados no cache antes que seja realmente necessário.</span><span class="sxs-lookup"><span data-stu-id="e5be2-248">Data can also be *proactively loaded* into the cache, a technique that loads the data into the cache before it is actually needed.</span></span> <span data-ttu-id="e5be2-249">No próximo tutorial, veremos um exemplo de carregamento proativo quando examinamos como armazenar valores estáticos no cache na inicialização do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e5be2-249">In the next tutorial we'll see an example of proactive loading when we look at how to store static values into the cache at application startup.</span></span>

<span data-ttu-id="e5be2-250">Boa programação!</span><span class="sxs-lookup"><span data-stu-id="e5be2-250">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="e5be2-251">Sobre o autor</span><span class="sxs-lookup"><span data-stu-id="e5be2-251">About the Author</span></span>

<span data-ttu-id="e5be2-252">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor de sete livros sobre ASP/ASP. net e fundador da [4guysfromrolla.com](http://www.4guysfromrolla.com), tem trabalhado com tecnologias Web da Microsoft desde 1998.</span><span class="sxs-lookup"><span data-stu-id="e5be2-252">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="e5be2-253">Scott trabalha como consultor, instrutor e escritor independentes.</span><span class="sxs-lookup"><span data-stu-id="e5be2-253">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="e5be2-254">Seu livro mais recente é que a [*Sams ensina a ASP.NET 2,0 em 24 horas*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="e5be2-254">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="e5be2-255">Ele pode ser acessado em [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="e5be2-255">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="e5be2-256">ou por meio de seu blog, que pode ser encontrado em [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="e5be2-256">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="e5be2-257">Agradecimentos especiais a</span><span class="sxs-lookup"><span data-stu-id="e5be2-257">Special Thanks To</span></span>

<span data-ttu-id="e5be2-258">Esta série de tutoriais foi revisada por muitos revisores úteis.</span><span class="sxs-lookup"><span data-stu-id="e5be2-258">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="e5be2-259">O revisor de Lead para este tutorial foi Teresa Murphy.</span><span class="sxs-lookup"><span data-stu-id="e5be2-259">Lead reviewer for this tutorial was Teresa Murphy.</span></span> <span data-ttu-id="e5be2-260">Está interessado em revisar meus artigos futuros do MSDN?</span><span class="sxs-lookup"><span data-stu-id="e5be2-260">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="e5be2-261">Em caso afirmativo, solte-me uma linha em [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="e5be2-261">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="e5be2-262">[Anterior](caching-data-with-the-objectdatasource-vb.md)
> [Próximo](caching-data-at-application-startup-vb.md)</span><span class="sxs-lookup"><span data-stu-id="e5be2-262">[Previous](caching-data-with-the-objectdatasource-vb.md)
[Next](caching-data-at-application-startup-vb.md)</span></span>
