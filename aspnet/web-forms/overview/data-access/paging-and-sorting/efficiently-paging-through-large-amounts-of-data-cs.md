---
uid: web-forms/overview/data-access/paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs
title: Paginar com eficiência por meio de grandes quantidades de dados (C#) | Microsoft Docs
author: rick-anderson
description: A opção de paginação padrão de um controle de apresentação de dados é inadequada ao trabalhar com grandes quantidades de dados, como sua recuperação de controle de fonte de dados subjacente...
ms.author: riande
ms.date: 08/15/2006
ms.assetid: 59c01998-9326-4ecb-9392-cb9615962140
msc.legacyurl: /web-forms/overview/data-access/paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs
msc.type: authoredcontent
ms.openlocfilehash: 154bcfeed8e64869b7c32d35b4fb05b6e611dadc
ms.sourcegitcommit: 4e6d586faadbe4d9ef27122f86335ec9385134af
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/28/2020
ms.locfileid: "89045267"
---
# <a name="efficiently-paging-through-large-amounts-of-data-c"></a><span data-ttu-id="b6497-103">Paginação de grandes quantidades de dados com eficiência (C#)</span><span class="sxs-lookup"><span data-stu-id="b6497-103">Efficiently Paging Through Large Amounts of Data (C#)</span></span>

<span data-ttu-id="b6497-104">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="b6497-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="b6497-105">[Baixar o aplicativo de exemplo](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_25_CS.exe) ou [baixar PDF](efficiently-paging-through-large-amounts-of-data-cs/_static/datatutorial25cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="b6497-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_25_CS.exe) or [Download PDF](efficiently-paging-through-large-amounts-of-data-cs/_static/datatutorial25cs1.pdf)</span></span>

> <span data-ttu-id="b6497-106">A opção de paginação padrão de um controle de apresentação de dados é inadequada ao trabalhar com grandes quantidades de dados, pois seu controle de fonte de dados subjacente recupera todos os registros, mesmo que apenas um subconjunto de dados seja exibido.</span><span class="sxs-lookup"><span data-stu-id="b6497-106">The default paging option of a data presentation control is unsuitable when working with large amounts of data, as its underlying data source control retrieves all records, even though only a subset of data is displayed.</span></span> <span data-ttu-id="b6497-107">Em tais circunstâncias, devemos reativar a paginação personalizada.</span><span class="sxs-lookup"><span data-stu-id="b6497-107">In such circumstances, we must turn to custom paging.</span></span>

## <a name="introduction"></a><span data-ttu-id="b6497-108">Introdução</span><span class="sxs-lookup"><span data-stu-id="b6497-108">Introduction</span></span>

<span data-ttu-id="b6497-109">Como discutimos no tutorial anterior, a paginação pode ser implementada de uma das duas maneiras:</span><span class="sxs-lookup"><span data-stu-id="b6497-109">As we discussed in the preceding tutorial, paging can be implemented in one of two ways:</span></span>

- <span data-ttu-id="b6497-110">A **paginação padrão** pode ser implementada simplesmente marcando a opção habilitar paginação na marca inteligente s do controle da Web de dados; no entanto, sempre que exibir uma página de dados, o ObjectDataSource recupera *todos* os registros, embora apenas um subconjunto deles seja exibido na página</span><span class="sxs-lookup"><span data-stu-id="b6497-110">**Default Paging** can be implemented by simply checking the Enable Paging option in the data Web control s smart tag; however, whenever viewing a page of data, the ObjectDataSource retrieves *all* of the records, even though only a subset of them are displayed in the page</span></span>
- <span data-ttu-id="b6497-111">A **paginação personalizada** melhora o desempenho da paginação padrão, recuperando somente os registros do banco de dados que precisam ser exibidos para a página específica do dado solicitado pelo usuário; no entanto, a paginação personalizada envolve um pouco mais de esforço para implementar que a paginação padrão</span><span class="sxs-lookup"><span data-stu-id="b6497-111">**Custom Paging** improves the performance of default paging by retrieving only those records from the database that need to be displayed for the particular page of data requested by the user; however, custom paging involves a bit more effort to implement than default paging</span></span>

<span data-ttu-id="b6497-112">Devido à facilidade de implementação, basta marcar uma caixa de seleção e pronto!</span><span class="sxs-lookup"><span data-stu-id="b6497-112">Due to the ease of implementation just check a checkbox and you re done!</span></span> <span data-ttu-id="b6497-113">a paginação padrão é uma opção atraente.</span><span class="sxs-lookup"><span data-stu-id="b6497-113">default paging is an attractive option.</span></span> <span data-ttu-id="b6497-114">Sua abordagem ingênua na recuperação de todos os registros, no entanto, o torna uma opção insatisfatória ao paginar por quantidades de dados suficientemente grandes ou para sites com muitos usuários simultâneos.</span><span class="sxs-lookup"><span data-stu-id="b6497-114">Its naive approach in retrieving all of the records, though, makes it an implausible choice when paging through sufficiently large amounts of data or for sites with many concurrent users.</span></span> <span data-ttu-id="b6497-115">Em tais circunstâncias, devemos reativar a paginação personalizada para fornecer um sistema responsivo.</span><span class="sxs-lookup"><span data-stu-id="b6497-115">In such circumstances, we must turn to custom paging in order to provide a responsive system.</span></span>

<span data-ttu-id="b6497-116">O desafio da paginação personalizada é a capacidade de escrever uma consulta que retorna o conjunto preciso de registros necessários para uma determinada página de dados.</span><span class="sxs-lookup"><span data-stu-id="b6497-116">The challenge of custom paging is being able to write a query that returns the precise set of records needed for a particular page of data.</span></span> <span data-ttu-id="b6497-117">Felizmente, Microsoft SQL Server 2005 fornece uma nova palavra-chave para classificar resultados, que nos permite escrever uma consulta que pode recuperar com eficiência o subconjunto apropriado de registros.</span><span class="sxs-lookup"><span data-stu-id="b6497-117">Fortunately, Microsoft SQL Server 2005 provides a new keyword for ranking results, which enables us to write a query that can efficiently retrieve the proper subset of records.</span></span> <span data-ttu-id="b6497-118">Neste tutorial, veremos como usar essa nova palavra-chave SQL Server 2005 para implementar a paginação personalizada em um controle GridView.</span><span class="sxs-lookup"><span data-stu-id="b6497-118">In this tutorial we'll see how to use this new SQL Server 2005 keyword to implement custom paging in a GridView control.</span></span> <span data-ttu-id="b6497-119">Embora a interface do usuário para paginação personalizada seja idêntica à de paginação padrão, a depuração de uma página para a próxima usando a paginação personalizada pode ser várias ordens de magnitude mais rápido que a paginação padrão.</span><span class="sxs-lookup"><span data-stu-id="b6497-119">While the user interface for custom paging is identical to that for default paging, stepping from one page to the next using custom paging can be several orders of magnitude faster than default paging.</span></span>

> [!NOTE]
> <span data-ttu-id="b6497-120">O lucro de desempenho exato exibido por paginação personalizada depende do número total de registros sendo paginados e da carga que está sendo colocada no servidor de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="b6497-120">The exact performance gain exhibited by custom paging depends on the total number of records being paged through and the load being placed on the database server.</span></span> <span data-ttu-id="b6497-121">No final deste tutorial, veremos algumas métricas aproximadas que demonstram os benefícios no desempenho obtido por meio de paginação personalizada.</span><span class="sxs-lookup"><span data-stu-id="b6497-121">At the end of this tutorial we'll look at some rough metrics that showcase the benefits in performance obtained through custom paging.</span></span>

## <a name="step-1-understanding-the-custom-paging-process"></a><span data-ttu-id="b6497-122">Etapa 1: Noções básicas sobre o processo de paginação personalizada</span><span class="sxs-lookup"><span data-stu-id="b6497-122">Step 1: Understanding the Custom Paging Process</span></span>

<span data-ttu-id="b6497-123">Ao paginar por meio de dados, os registros precisos exibidos em uma página dependem da página de dados que estão sendo solicitadas e do número de registros exibidos por página.</span><span class="sxs-lookup"><span data-stu-id="b6497-123">When paging through data, the precise records displayed in a page depend upon the page of data being requested and the number of records displayed per page.</span></span> <span data-ttu-id="b6497-124">Por exemplo, imagine que queríamos paginar os produtos 81, exibindo 10 produtos por página.</span><span class="sxs-lookup"><span data-stu-id="b6497-124">For example, imagine that we wanted to page through the 81 products, displaying 10 products per page.</span></span> <span data-ttu-id="b6497-125">Ao exibir a primeira página, nós d desejamos produtos de 1 a 10; ao exibir a segunda página, temos interesse nos produtos 11 a 20 e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="b6497-125">When viewing the first page, we d want products 1 through 10; when viewing the second page we d be interested in products 11 through 20, and so on.</span></span>

<span data-ttu-id="b6497-126">Há três variáveis que ditam quais registros precisam ser recuperados e como a interface de paginação deve ser renderizada:</span><span class="sxs-lookup"><span data-stu-id="b6497-126">There are three variables that dictate what records need to be retrieved and how the paging interface should be rendered:</span></span>

- <span data-ttu-id="b6497-127">**Iniciar índice de linha** o índice da primeira linha na página de dados a ser exibida; Esse índice pode ser calculado multiplicando-se o índice da página pelos registros a serem exibidos por página e adicionando um.</span><span class="sxs-lookup"><span data-stu-id="b6497-127">**Start Row Index** the index of the first row in the page of data to display; this index can be calculated by multiplying the page index by the records to display per page and adding one.</span></span> <span data-ttu-id="b6497-128">Por exemplo, ao paginar por meio de registros 10 por vez, para a primeira página (cujo índice de página é 0), o índice de linha inicial é 0 \* 10 + 1, ou 1; para a segunda página (cujo índice de página é 1), o índice de linha inicial é 1 \* 10 + 1 ou 11.</span><span class="sxs-lookup"><span data-stu-id="b6497-128">For example, when paging through records 10 at a time, for the first page (whose page index is 0), the Start Row Index is 0 \* 10 + 1, or 1; for the second page (whose page index is 1), the Start Row Index is 1 \* 10 + 1, or 11.</span></span>
- <span data-ttu-id="b6497-129">**Máximo de linhas** o número máximo de registros a serem exibidos por página.</span><span class="sxs-lookup"><span data-stu-id="b6497-129">**Maximum Rows** the maximum number of records to display per page.</span></span> <span data-ttu-id="b6497-130">Essa variável é conhecida como máximo de linhas desde a última página pode haver menos registros retornados do que o tamanho da página.</span><span class="sxs-lookup"><span data-stu-id="b6497-130">This variable is referred to as maximum rows since for the last page there may be fewer records returned than the page size.</span></span> <span data-ttu-id="b6497-131">Por exemplo, ao paginar por meio de 81 produtos 10 registros por página, a nona e a última página terão apenas um registro.</span><span class="sxs-lookup"><span data-stu-id="b6497-131">For example, when paging through the 81 products 10 records per page, the ninth and final page will have just one record.</span></span> <span data-ttu-id="b6497-132">Nenhuma página, no entanto, mostrará mais registros do que o valor máximo de linhas.</span><span class="sxs-lookup"><span data-stu-id="b6497-132">No page, though, will show more records than the Maximum Rows value.</span></span>
- <span data-ttu-id="b6497-133">**Contagem** de registros total o número total de registros que estão sendo paginados.</span><span class="sxs-lookup"><span data-stu-id="b6497-133">**Total Record Count** the total number of records being paged through.</span></span> <span data-ttu-id="b6497-134">Embora essa variável não seja necessária para determinar quais registros recuperar para uma determinada página, ele dita a interface de paginação.</span><span class="sxs-lookup"><span data-stu-id="b6497-134">While this variable isn t needed to determine what records to retrieve for a given page, it does dictate the paging interface.</span></span> <span data-ttu-id="b6497-135">Por exemplo, se houver 81 produtos sendo paginados, a interface de paginação saberá exibir nove números de página na interface do usuário de paginação.</span><span class="sxs-lookup"><span data-stu-id="b6497-135">For example, if there are 81 products being paged through, the paging interface knows to display nine page numbers in the paging UI.</span></span>

<span data-ttu-id="b6497-136">Com a paginação padrão, o índice de linha inicial é calculado como o produto do índice de página e o tamanho da página, mais um, enquanto o máximo de linhas é simplesmente o tamanho da página.</span><span class="sxs-lookup"><span data-stu-id="b6497-136">With default paging, the Start Row Index is computed as the product of the page index and the page size plus one, whereas the Maximum Rows is simply the page size.</span></span> <span data-ttu-id="b6497-137">Uma vez que a paginação padrão recupera todos os registros do banco de dados durante a renderização de qualquer página, o índice de cada linha é conhecido, tornando a mudança para a linha de índice de linha inicial uma tarefa trivial.</span><span class="sxs-lookup"><span data-stu-id="b6497-137">Since default paging retrieves all of the records from the database when rendering any page of data, the index for each row is known, thereby making moving to Start Row Index row a trivial task.</span></span> <span data-ttu-id="b6497-138">Além disso, a contagem total de registros está prontamente disponível, pois s simplesmente o número de registros na DataTable (ou qualquer objeto que esteja sendo usado para manter os resultados do banco de dados).</span><span class="sxs-lookup"><span data-stu-id="b6497-138">Moreover, the Total Record Count is readily available, as it s simply the number of records in the DataTable (or whatever object is being used to hold the database results).</span></span>

<span data-ttu-id="b6497-139">Dadas as variáveis de índice de linha inicial e máximo de linhas, uma implementação de paginação personalizada deve retornar apenas o subconjunto preciso de registros começando no índice de linha inicial e até o número máximo de linhas de registros depois disso.</span><span class="sxs-lookup"><span data-stu-id="b6497-139">Given the Start Row Index and Maximum Rows variables, a custom paging implementation must only return the precise subset of records starting at the Start Row Index and up to Maximum Rows number of records after that.</span></span> <span data-ttu-id="b6497-140">A paginação personalizada fornece dois desafios:</span><span class="sxs-lookup"><span data-stu-id="b6497-140">Custom paging provides two challenges:</span></span>

- <span data-ttu-id="b6497-141">Devemos ser capazes de associar com eficiência um índice de linha a cada linha em todos os dados que são paginados por meio de forma que possamos começar a retornar registros no índice de linha inicial especificado</span><span class="sxs-lookup"><span data-stu-id="b6497-141">We must be able to efficiently associate a row index with each row in the entire data being paged through so that we can start returning records at the specified Start Row Index</span></span>
- <span data-ttu-id="b6497-142">Precisamos fornecer o número total de registros sendo paginados</span><span class="sxs-lookup"><span data-stu-id="b6497-142">We need to provide the total number of records being paged through</span></span>

<span data-ttu-id="b6497-143">Nas próximas duas etapas, examinaremos o script SQL necessário para responder a esses dois desafios.</span><span class="sxs-lookup"><span data-stu-id="b6497-143">In the next two steps we'll examine the SQL script needed to respond to these two challenges.</span></span> <span data-ttu-id="b6497-144">Além do script SQL, também precisaremos implementar métodos na DAL e na BLL.</span><span class="sxs-lookup"><span data-stu-id="b6497-144">In addition to the SQL script, we'll also need to implement methods in the DAL and BLL.</span></span>

## <a name="step-2-returning-the-total-number-of-records-being-paged-through"></a><span data-ttu-id="b6497-145">Etapa 2: retornando o número total de registros sendo paginados por</span><span class="sxs-lookup"><span data-stu-id="b6497-145">Step 2: Returning the Total Number of Records Being Paged Through</span></span>

<span data-ttu-id="b6497-146">Antes de examinarmos como recuperar o subconjunto preciso de registros para a página que está sendo exibida, vamos primeiro examinar como retornar o número total de registros sendo paginados.</span><span class="sxs-lookup"><span data-stu-id="b6497-146">Before we examine how to retrieve the precise subset of records for the page being displayed, let s first look at how to return the total number of records being paged through.</span></span> <span data-ttu-id="b6497-147">Essas informações são necessárias para configurar corretamente a interface do usuário de paginação.</span><span class="sxs-lookup"><span data-stu-id="b6497-147">This information is needed in order to properly configure the paging user interface.</span></span> <span data-ttu-id="b6497-148">O número total de registros retornados por uma consulta SQL específica pode ser obtido usando a [ `COUNT` função de agregação](https://msdn.microsoft.com/library/ms175997.aspx).</span><span class="sxs-lookup"><span data-stu-id="b6497-148">The total number of records returned by a particular SQL query can be obtained by using the [`COUNT` aggregate function](https://msdn.microsoft.com/library/ms175997.aspx).</span></span> <span data-ttu-id="b6497-149">Por exemplo, para determinar o número total de registros na `Products` tabela, podemos usar a seguinte consulta:</span><span class="sxs-lookup"><span data-stu-id="b6497-149">For example, to determine the total number of records in the `Products` table, we can use the following query:</span></span>

[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample1.sql)]

<span data-ttu-id="b6497-150">Vamos adicionar um método à nossa DAL que retorna essas informações.</span><span class="sxs-lookup"><span data-stu-id="b6497-150">Let s add a method to our DAL that returns this information.</span></span> <span data-ttu-id="b6497-151">Em particular, criaremos um método DAL chamado `TotalNumberOfProducts()` que executa a `SELECT` instrução mostrada acima.</span><span class="sxs-lookup"><span data-stu-id="b6497-151">In particular, we'll create a DAL method called `TotalNumberOfProducts()` that executes the `SELECT` statement shown above.</span></span>

<span data-ttu-id="b6497-152">Comece abrindo o `Northwind.xsd` arquivo dataset tipado na `App_Code/DAL` pasta.</span><span class="sxs-lookup"><span data-stu-id="b6497-152">Start by opening the `Northwind.xsd` Typed DataSet file in the `App_Code/DAL` folder.</span></span> <span data-ttu-id="b6497-153">Em seguida, clique com o botão direito do mouse em `ProductsTableAdapter` no designer e escolha Adicionar consulta.</span><span class="sxs-lookup"><span data-stu-id="b6497-153">Next, right-click on the `ProductsTableAdapter` in the Designer and choose Add Query.</span></span> <span data-ttu-id="b6497-154">Como vimos nos tutoriais anteriores, isso nos permitirá adicionar um novo método à DAL que, quando invocada, executará uma instrução SQL específica ou um procedimento armazenado.</span><span class="sxs-lookup"><span data-stu-id="b6497-154">As we ve seen in previous tutorials, this will allow us to add a new method to the DAL that, when invoked, will execute a particular SQL statement or stored procedure.</span></span> <span data-ttu-id="b6497-155">Assim como acontece com nossos métodos do TableAdapter nos tutoriais anteriores, para esta opção usar uma instrução SQL ad hoc.</span><span class="sxs-lookup"><span data-stu-id="b6497-155">As with our TableAdapter methods in previous tutorials, for this one opt to use an ad-hoc SQL statement.</span></span>

![Usar uma instrução SQL ad hoc](efficiently-paging-through-large-amounts-of-data-cs/_static/image1.png)

<span data-ttu-id="b6497-157">**Figura 1**: usar uma instrução SQL ad hoc</span><span class="sxs-lookup"><span data-stu-id="b6497-157">**Figure 1**: Use an Ad-Hoc SQL Statement</span></span>

<span data-ttu-id="b6497-158">Na próxima tela, podemos especificar o tipo de consulta a ser criado.</span><span class="sxs-lookup"><span data-stu-id="b6497-158">On the next screen we can specify what type of query to create.</span></span> <span data-ttu-id="b6497-159">Como essa consulta retornará um único valor escalar, o número total de registros na `Products` tabela escolha o `SELECT` que retorna uma opção de valor individual.</span><span class="sxs-lookup"><span data-stu-id="b6497-159">Since this query will return a single, scalar value the total number of records in the `Products` table choose the `SELECT` which returns a singe value option.</span></span>

![Configurar a consulta para usar uma instrução SELECT que retorna um único valor](efficiently-paging-through-large-amounts-of-data-cs/_static/image2.png)

<span data-ttu-id="b6497-161">**Figura 2**: configurar a consulta para usar uma instrução SELECT que retorna um único valor</span><span class="sxs-lookup"><span data-stu-id="b6497-161">**Figure 2**: Configure the Query to Use a SELECT Statement that Returns a Single Value</span></span>

<span data-ttu-id="b6497-162">Depois de indicar o tipo de consulta a ser usado, devemos especificar a consulta.</span><span class="sxs-lookup"><span data-stu-id="b6497-162">After indicating the type of query to use, we must next specify the query.</span></span>

![Usar a consulta Selecionar contagem (\*) de produtos](efficiently-paging-through-large-amounts-of-data-cs/_static/image3.png)

<span data-ttu-id="b6497-164">**Figura 3**: usar a consulta Selecionar contagem ( \* ) de produtos</span><span class="sxs-lookup"><span data-stu-id="b6497-164">**Figure 3**: Use the SELECT COUNT(\*) FROM Products Query</span></span>

<span data-ttu-id="b6497-165">Por fim, especifique o nome para o método.</span><span class="sxs-lookup"><span data-stu-id="b6497-165">Finally, specify the name for the method.</span></span> <span data-ttu-id="b6497-166">Como mencionado anteriormente, vamos usar `TotalNumberOfProducts` .</span><span class="sxs-lookup"><span data-stu-id="b6497-166">As aforementioned, let s use `TotalNumberOfProducts`.</span></span>

![Nomeie o método DAL TotalNumberOfProducts](efficiently-paging-through-large-amounts-of-data-cs/_static/image4.png)

<span data-ttu-id="b6497-168">**Figura 4**: nomear o método Dal TotalNumberOfProducts</span><span class="sxs-lookup"><span data-stu-id="b6497-168">**Figure 4**: Name the DAL Method TotalNumberOfProducts</span></span>

<span data-ttu-id="b6497-169">Depois de clicar em concluir, o assistente adicionará o `TotalNumberOfProducts` método à Dal.</span><span class="sxs-lookup"><span data-stu-id="b6497-169">After clicking Finish, the wizard will add the `TotalNumberOfProducts` method to the DAL.</span></span> <span data-ttu-id="b6497-170">Os métodos de retorno escalares na DAL retornam tipos anuláveis, caso o resultado da consulta SQL seja `NULL` .</span><span class="sxs-lookup"><span data-stu-id="b6497-170">The scalar returning methods in the DAL return nullable types, in case the result from the SQL query is `NULL`.</span></span> <span data-ttu-id="b6497-171">Nossa `COUNT` consulta, no entanto, sempre retornará um `NULL` valor diferente; independentemente do método Dal retornar um inteiro anulável.</span><span class="sxs-lookup"><span data-stu-id="b6497-171">Our `COUNT` query, however, will always return a non-`NULL` value; regardless, the DAL method returns a nullable integer.</span></span>

<span data-ttu-id="b6497-172">Além do método DAL, também precisamos de um método na BLL.</span><span class="sxs-lookup"><span data-stu-id="b6497-172">In addition to the DAL method, we also need a method in the BLL.</span></span> <span data-ttu-id="b6497-173">Abra o `ProductsBLL` arquivo de classe e adicione um `TotalNumberOfProducts` método que simplesmente chame para o método da Dal s `TotalNumberOfProducts` :</span><span class="sxs-lookup"><span data-stu-id="b6497-173">Open the `ProductsBLL` class file and add a `TotalNumberOfProducts` method that simply calls down to the DAL s `TotalNumberOfProducts` method:</span></span>

[!code-csharp[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample2.cs)]

<span data-ttu-id="b6497-174">O método s DAL `TotalNumberOfProducts` retorna um inteiro anulável; no entanto, criamos o `ProductsBLL` método Class s `TotalNumberOfProducts` para que ele retorne um número inteiro padrão.</span><span class="sxs-lookup"><span data-stu-id="b6497-174">The DAL s `TotalNumberOfProducts` method returns a nullable integer; however, we ve created the `ProductsBLL` class s `TotalNumberOfProducts` method so that it returns a standard integer.</span></span> <span data-ttu-id="b6497-175">Portanto, precisamos que o método da `ProductsBLL` classe s `TotalNumberOfProducts` retorne a parte do valor do inteiro anulável retornado pelo método da Dal s `TotalNumberOfProducts` .</span><span class="sxs-lookup"><span data-stu-id="b6497-175">Therefore, we need to have the `ProductsBLL` class s `TotalNumberOfProducts` method return the value portion of the nullable integer returned by the DAL s `TotalNumberOfProducts` method.</span></span> <span data-ttu-id="b6497-176">A chamada para `GetValueOrDefault()` retorna o valor do inteiro anulável, se existir; se o inteiro anulável for `null` , no entanto, ele retornará o valor inteiro padrão, 0.</span><span class="sxs-lookup"><span data-stu-id="b6497-176">The call to `GetValueOrDefault()` returns the value of the nullable integer, if it exists; if the nullable integer is `null`, however, it returns the default integer value, 0.</span></span>

## <a name="step-3-returning-the-precise-subset-of-records"></a><span data-ttu-id="b6497-177">Etapa 3: retornando o subconjunto preciso de registros</span><span class="sxs-lookup"><span data-stu-id="b6497-177">Step 3: Returning the Precise Subset of Records</span></span>

<span data-ttu-id="b6497-178">Nossa próxima tarefa é criar métodos na DAL e na BLL que aceitem as variáveis de índice de linha inicial e máximo de linhas discutidas anteriormente e retornam os registros apropriados.</span><span class="sxs-lookup"><span data-stu-id="b6497-178">Our next task is to create methods in the DAL and BLL that accept the Start Row Index and Maximum Rows variables discussed earlier and return the appropriate records.</span></span> <span data-ttu-id="b6497-179">Antes de fazermos isso, vamos examinar primeiro o script SQL necessário.</span><span class="sxs-lookup"><span data-stu-id="b6497-179">Before we do that, let s first look at the needed SQL script.</span></span> <span data-ttu-id="b6497-180">O desafio voltado para nós é que devemos ser capazes de atribuir com eficiência um índice a cada linha em que os resultados inteiros fossem paginados para que possamos retornar apenas os registros que começam no índice de linha inicial (e até o número máximo de registros de registros).</span><span class="sxs-lookup"><span data-stu-id="b6497-180">The challenge facing us is that we must be able to efficiently assign an index to each row in the entire results being paged through so that we can return just those records starting at the Start Row Index (and up to the Maximum Records number of records).</span></span>

<span data-ttu-id="b6497-181">Isso não é um desafio se já houver uma coluna na tabela de banco de dados que serve como um índice de linha.</span><span class="sxs-lookup"><span data-stu-id="b6497-181">This is not a challenge if there is already a column in the database table that serves as a row index.</span></span> <span data-ttu-id="b6497-182">À primeira vista, podemos imaginar que o `Products` campo s da tabela `ProductID` seria suficiente, pois o primeiro produto tem `ProductID` de 1, a segunda 2 e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="b6497-182">At first glance we might think that the `Products` table s `ProductID` field would suffice, as the first product has `ProductID` of 1, the second a 2, and so on.</span></span> <span data-ttu-id="b6497-183">No entanto, a exclusão de um produto deixa uma lacuna na sequência, anulando essa abordagem.</span><span class="sxs-lookup"><span data-stu-id="b6497-183">However, deleting a product leaves a gap in the sequence, nullifying this approach.</span></span>

<span data-ttu-id="b6497-184">Há duas técnicas gerais usadas para associar com eficiência um índice de linha com os dados a serem paginados, habilitando assim o subconjunto preciso de registros a serem recuperados:</span><span class="sxs-lookup"><span data-stu-id="b6497-184">There are two general techniques used to efficiently associate a row index with the data to page through, thereby enabling the precise subset of records to be retrieved:</span></span>

- <span data-ttu-id="b6497-185">**Usando SQL Server 2005 s `ROW_NUMBER()` Palavra-chave** New para SQL Server 2005, a `ROW_NUMBER()` palavra-chave associa uma classificação a cada registro retornado com base em alguma ordenação.</span><span class="sxs-lookup"><span data-stu-id="b6497-185">**Using SQL Server 2005 s `ROW_NUMBER()` Keyword** new to SQL Server 2005, the `ROW_NUMBER()` keyword associates a ranking with each returned record based on some ordering.</span></span> <span data-ttu-id="b6497-186">Essa classificação pode ser usada como um índice de linha para cada linha.</span><span class="sxs-lookup"><span data-stu-id="b6497-186">This ranking can be used as a row index for each row.</span></span>
- <span data-ttu-id="b6497-187">**Usando uma variável de tabela `SET ROWCOUNT` e** A [ `SET ROWCOUNT` instrução](https://msdn.microsoft.com/library/ms188774.aspx) SQL Server s pode ser usada para especificar quantos registros totais uma consulta deve processar antes de terminar; [variáveis de tabela](http://www.sqlteam.com/item.asp?ItemID=9454) são variáveis T-SQL locais que podem conter dados tabulares, semelhante a [tabelas temporárias](http://www.sqlteam.com/item.asp?ItemID=2029).</span><span class="sxs-lookup"><span data-stu-id="b6497-187">**Using a Table Variable and `SET ROWCOUNT`** SQL Server s [`SET ROWCOUNT` statement](https://msdn.microsoft.com/library/ms188774.aspx) can be used to specify how many total records a query should process before terminating; [table variables](http://www.sqlteam.com/item.asp?ItemID=9454) are local T-SQL variables that can hold tabular data, akin to [temporary tables](http://www.sqlteam.com/item.asp?ItemID=2029).</span></span> <span data-ttu-id="b6497-188">Essa abordagem funciona igualmente bem com Microsoft SQL Server 2005 e SQL Server 2000 (enquanto a `ROW_NUMBER()` abordagem só funciona com SQL Server 2005).</span><span class="sxs-lookup"><span data-stu-id="b6497-188">This approach works equally well with both Microsoft SQL Server 2005 and SQL Server 2000 (whereas the `ROW_NUMBER()` approach only works with SQL Server 2005).</span></span>  
  
  <span data-ttu-id="b6497-189">A ideia aqui é criar uma variável de tabela que tenha uma `IDENTITY` coluna e colunas para as chaves primárias da tabela cujos dados estão sendo paginados.</span><span class="sxs-lookup"><span data-stu-id="b6497-189">The idea here is to create a table variable that has an `IDENTITY` column and columns for the primary keys of the table whose data is being paged through.</span></span> <span data-ttu-id="b6497-190">Em seguida, o conteúdo da tabela cujos dados estão sendo paginados é despejado na variável de tabela, associando assim um índice de linha sequencial (por meio da `IDENTITY` coluna) para cada registro na tabela.</span><span class="sxs-lookup"><span data-stu-id="b6497-190">Next, the contents of the table whose data is being paged through is dumped into the table variable, thereby associating a sequential row index (via the `IDENTITY` column) for each record in the table.</span></span> <span data-ttu-id="b6497-191">Depois que a variável de tabela tiver sido populada, uma `SELECT` instrução na variável de tabela, unida à tabela subjacente, poderá ser executada para extrair os registros específicos.</span><span class="sxs-lookup"><span data-stu-id="b6497-191">Once the table variable has been populated, a `SELECT` statement on the table variable, joined with the underlying table, can be executed to pull out the particular records.</span></span> <span data-ttu-id="b6497-192">A `SET ROWCOUNT` instrução é usada para limitar de forma inteligente o número de registros que precisam ser despejados na variável de tabela.</span><span class="sxs-lookup"><span data-stu-id="b6497-192">The `SET ROWCOUNT` statement is used to intelligently limit the number of records that need to be dumped into the table variable.</span></span>  
  
  <span data-ttu-id="b6497-193">Essa abordagem de eficiência é baseada no número de página que está sendo solicitado, uma vez que o valor `SET ROWCOUNT` é atribuído ao valor de índice de linha inicial mais o máximo de linhas.</span><span class="sxs-lookup"><span data-stu-id="b6497-193">This approach s efficiency is based on the page number being requested, as the `SET ROWCOUNT` value is assigned the value of Start Row Index plus the Maximum Rows.</span></span> <span data-ttu-id="b6497-194">Ao paginar por meio de páginas de menor número, como as primeiras páginas de dados, essa abordagem é muito eficiente.</span><span class="sxs-lookup"><span data-stu-id="b6497-194">When paging through low-numbered pages such as the first few pages of data this approach is very efficient.</span></span> <span data-ttu-id="b6497-195">No entanto, ele exibe o desempenho padrão como paginação ao recuperar uma página próxima ao final.</span><span class="sxs-lookup"><span data-stu-id="b6497-195">However, it exhibits default paging-like performance when retrieving a page near the end.</span></span>

<span data-ttu-id="b6497-196">Este tutorial implementa a paginação personalizada usando a `ROW_NUMBER()` palavra-chave.</span><span class="sxs-lookup"><span data-stu-id="b6497-196">This tutorial implements custom paging using the `ROW_NUMBER()` keyword.</span></span> <span data-ttu-id="b6497-197">Para obter mais informações sobre como usar a variável e a técnica de tabela `SET ROWCOUNT` , consulte [um método mais eficiente para paginar por meio de grandes conjuntos de resultados](http://www.4guysfromrolla.com/webtech/042606-1.shtml).</span><span class="sxs-lookup"><span data-stu-id="b6497-197">For more information on using the table variable and `SET ROWCOUNT` technique, see [A More Efficient Method for Paging Through Large Result Sets](http://www.4guysfromrolla.com/webtech/042606-1.shtml).</span></span>

<span data-ttu-id="b6497-198">A `ROW_NUMBER()` palavra-chave associada a uma classificação com cada registro retornado em uma ordem específica usando a seguinte sintaxe:</span><span class="sxs-lookup"><span data-stu-id="b6497-198">The `ROW_NUMBER()` keyword associated a ranking with each record returned over a particular ordering using the following syntax:</span></span>

[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample3.sql)]

<span data-ttu-id="b6497-199">`ROW_NUMBER()` Retorna um valor numérico que especifica a classificação de cada registro com relação à ordenação indicada.</span><span class="sxs-lookup"><span data-stu-id="b6497-199">`ROW_NUMBER()` returns a numerical value that specifies the rank for each record with regards to the indicated ordering.</span></span> <span data-ttu-id="b6497-200">Por exemplo, para ver a classificação de cada produto, ordenada do mais caro para o menos, poderíamos usar a seguinte consulta:</span><span class="sxs-lookup"><span data-stu-id="b6497-200">For example, to see the rank for each product, ordered from the most expensive to the least, we could use the following query:</span></span>

[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample4.sql)]

<span data-ttu-id="b6497-201">A Figura 5 mostra esses resultados da consulta quando executados por meio da janela de consulta no Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="b6497-201">Figure 5 shows this query s results when run through the query window in Visual Studio.</span></span> <span data-ttu-id="b6497-202">Observe que os produtos são ordenados por preço, juntamente com uma classificação de preço para cada linha.</span><span class="sxs-lookup"><span data-stu-id="b6497-202">Note that the products are ordered by price, along with a price rank for each row.</span></span>

![A classificação de preço está incluída para cada registro retornado](efficiently-paging-through-large-amounts-of-data-cs/_static/image5.png)

<span data-ttu-id="b6497-204">**Figura 5**: a classificação de preço é incluída para cada registro retornado</span><span class="sxs-lookup"><span data-stu-id="b6497-204">**Figure 5**: The Price Rank is Included for Each Returned Record</span></span>

> [!NOTE]
> <span data-ttu-id="b6497-205">`ROW_NUMBER()` é apenas uma das muitas funções de classificação novas disponíveis no SQL Server 2005.</span><span class="sxs-lookup"><span data-stu-id="b6497-205">`ROW_NUMBER()` is just one of the many new ranking functions available in SQL Server 2005.</span></span> <span data-ttu-id="b6497-206">Para obter uma discussão mais completa sobre `ROW_NUMBER()` o, juntamente com outras funções de classificação, leia [retornando resultados classificados com Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml).</span><span class="sxs-lookup"><span data-stu-id="b6497-206">For a more thorough discussion of `ROW_NUMBER()`, along with the other ranking functions, read [Returning Ranked Results with Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml).</span></span>

<span data-ttu-id="b6497-207">Ao ordenar os resultados pela `ORDER BY` coluna especificada na `OVER` cláusula ( `UnitPrice` , no exemplo acima), SQL Server deve classificar os resultados.</span><span class="sxs-lookup"><span data-stu-id="b6497-207">When ranking the results by the specified `ORDER BY` column in the `OVER` clause (`UnitPrice`, in the above example), SQL Server must sort the results.</span></span> <span data-ttu-id="b6497-208">Essa é uma operação rápida se houver um índice clusterizado sobre as colunas em que os resultados estão sendo ordenados ou se houver um índice de cobertura, mas pode ser mais dispendioso do contrário.</span><span class="sxs-lookup"><span data-stu-id="b6497-208">This is a quick operation if there is a clustered index over the column(s) the results are being ordered by, or if there is a covering index, but can be more costly otherwise.</span></span> <span data-ttu-id="b6497-209">Para ajudar a melhorar o desempenho de consultas grandes o suficiente, considere adicionar um índice não clusterizado à coluna pela qual os resultados são ordenados.</span><span class="sxs-lookup"><span data-stu-id="b6497-209">To help improve performance for sufficiently large queries, consider adding a non-clustered index for the column by which the results are ordered by.</span></span> <span data-ttu-id="b6497-210">Consulte [classificando funções e desempenho no SQL Server 2005](http://www.sql-server-performance.com/ak_ranking_functions.asp) para obter uma visão mais detalhada das considerações sobre desempenho.</span><span class="sxs-lookup"><span data-stu-id="b6497-210">See [Ranking Functions and Performance in SQL Server 2005](http://www.sql-server-performance.com/ak_ranking_functions.asp) for a more detailed look at the performance considerations.</span></span>

<span data-ttu-id="b6497-211">As informações de classificação retornadas pelo `ROW_NUMBER()` não podem ser usadas diretamente na `WHERE` cláusula.</span><span class="sxs-lookup"><span data-stu-id="b6497-211">The ranking information returned by `ROW_NUMBER()` cannot directly be used in the `WHERE` clause.</span></span> <span data-ttu-id="b6497-212">No entanto, uma tabela derivada pode ser usada para retornar o `ROW_NUMBER()` resultado, que pode aparecer na `WHERE` cláusula.</span><span class="sxs-lookup"><span data-stu-id="b6497-212">However, a derived table can be used to return the `ROW_NUMBER()` result, which can then appear in the `WHERE` clause.</span></span> <span data-ttu-id="b6497-213">Por exemplo, a consulta a seguir usa uma tabela derivada para retornar as colunas NomeDoProduto e UnitPrice, juntamente com o `ROW_NUMBER()` resultado, e, em seguida, usa uma `WHERE` cláusula para retornar apenas os produtos cuja classificação de preço esteja entre 11 e 20:</span><span class="sxs-lookup"><span data-stu-id="b6497-213">For example, the following query uses a derived table to return the ProductName and UnitPrice columns, along with the `ROW_NUMBER()` result, and then uses a `WHERE` clause to only return those products whose price rank is between 11 and 20:</span></span>

[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample5.sql)]

<span data-ttu-id="b6497-214">Ampliando esse conceito um pouco mais, podemos utilizar essa abordagem para recuperar uma página específica de dados de acordo com o índice de linha de início desejado e os valores máximos de linhas:</span><span class="sxs-lookup"><span data-stu-id="b6497-214">Extending this concept a bit further, we can utilize this approach to retrieve a specific page of data given the desired Start Row Index and Maximum Rows values:</span></span>

[!code-html[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample6.html)]

> [!NOTE]
> <span data-ttu-id="b6497-215">Como veremos mais adiante neste tutorial, o *`StartRowIndex`* fornecido pelo ObjectDataSource é indexado a partir de zero, enquanto o `ROW_NUMBER()` valor retornado pelo SQL Server 2005 é indexado a partir de 1.</span><span class="sxs-lookup"><span data-stu-id="b6497-215">As we will see later on in this tutorial, the *`StartRowIndex`* supplied by the ObjectDataSource is indexed starting at zero, whereas the `ROW_NUMBER()` value returned by SQL Server 2005 is indexed starting at 1.</span></span> <span data-ttu-id="b6497-216">Portanto, a `WHERE` cláusula retorna os registros onde `PriceRank` é estritamente maior que *`StartRowIndex`* e menor ou igual a *`StartRowIndex`*  +  *`MaximumRows`* .</span><span class="sxs-lookup"><span data-stu-id="b6497-216">Therefore, the `WHERE` clause returns those records where `PriceRank` is strictly greater than *`StartRowIndex`* and less than or equal to *`StartRowIndex`* + *`MaximumRows`*.</span></span>

<span data-ttu-id="b6497-217">Agora que vimos como `ROW_NUMBER()` o pode ser usado para recuperar uma determinada página de dados de acordo com os valores de índice de linha inicial e máximo de linhas, agora precisamos implementar essa lógica como métodos na Dal e na BLL.</span><span class="sxs-lookup"><span data-stu-id="b6497-217">Now that we ve discussed how `ROW_NUMBER()` can be used to retrieve a particular page of data given the Start Row Index and Maximum Rows values, we now need to implement this logic as methods in the DAL and BLL.</span></span>

<span data-ttu-id="b6497-218">Ao criar essa consulta, devemos decidir a ordenação pela qual os resultados serão classificados; Vamos classificar os produtos por seu nome em ordem alfabética.</span><span class="sxs-lookup"><span data-stu-id="b6497-218">When creating this query we must decide the ordering by which the results will be ranked; let s sort the products by their name in alphabetical order.</span></span> <span data-ttu-id="b6497-219">Isso significa que, com a implementação de paginação personalizada neste tutorial, não será possível criar um relatório paginado personalizado do que também possa ser classificado.</span><span class="sxs-lookup"><span data-stu-id="b6497-219">This means that with the custom paging implementation in this tutorial we will not be able to create a custom paged report than can also be sorted.</span></span> <span data-ttu-id="b6497-220">No entanto, no próximo tutorial, veremos como essa funcionalidade pode ser fornecida.</span><span class="sxs-lookup"><span data-stu-id="b6497-220">In the next tutorial, though, we'll see how such functionality can be provided.</span></span>

<span data-ttu-id="b6497-221">Na seção anterior, criamos o método DAL como uma instrução SQL ad hoc.</span><span class="sxs-lookup"><span data-stu-id="b6497-221">In the previous section we created the DAL method as an ad-hoc SQL statement.</span></span> <span data-ttu-id="b6497-222">Infelizmente, o analisador T-SQL no Visual Studio usado pelo assistente TableAdapter não gosta da `OVER` sintaxe usada pela `ROW_NUMBER()` função.</span><span class="sxs-lookup"><span data-stu-id="b6497-222">Unfortunately, the T-SQL parser in Visual Studio used by the TableAdapter wizard doesn t like the `OVER` syntax used by the `ROW_NUMBER()` function.</span></span> <span data-ttu-id="b6497-223">Portanto, devemos criar esse método DAL como um procedimento armazenado.</span><span class="sxs-lookup"><span data-stu-id="b6497-223">Therefore, we must create this DAL method as a stored procedure.</span></span> <span data-ttu-id="b6497-224">Selecione o Gerenciador de Servidores no menu Exibir (ou pressione CTRL + ALT + S) e expanda o `NORTHWND.MDF` nó.</span><span class="sxs-lookup"><span data-stu-id="b6497-224">Select the Server Explorer from the View menu (or hit Ctrl+Alt+S) and expand the `NORTHWND.MDF` node.</span></span> <span data-ttu-id="b6497-225">Para adicionar um novo procedimento armazenado, clique com o botão direito do mouse no nó procedimentos armazenados e escolha Adicionar um novo procedimento armazenado (consulte a Figura 6).</span><span class="sxs-lookup"><span data-stu-id="b6497-225">To add a new stored procedure, right-click on the Stored Procedures node and choose Add a New Stored Procedure (see Figure 6).</span></span>

![Adicionar um novo procedimento armazenado para paginação por meio dos produtos](efficiently-paging-through-large-amounts-of-data-cs/_static/image6.png)

<span data-ttu-id="b6497-227">**Figura 6**: adicionar um novo procedimento armazenado para paginação por meio dos produtos</span><span class="sxs-lookup"><span data-stu-id="b6497-227">**Figure 6**: Add a New Stored Procedure for Paging Through the Products</span></span>

<span data-ttu-id="b6497-228">Esse procedimento armazenado deve aceitar dois parâmetros de entrada de inteiro – `@startRowIndex` e `@maximumRows` usar a `ROW_NUMBER()` função ordenada pelo `ProductName` campo, retornando apenas as linhas maiores que o especificado `@startRowIndex` e menor ou igual a `@startRowIndex`  +  `@maximumRow` s.</span><span class="sxs-lookup"><span data-stu-id="b6497-228">This stored procedure should accept two integer input parameters - `@startRowIndex` and `@maximumRows` and use the `ROW_NUMBER()` function ordered by the `ProductName` field, returning only those rows greater than the specified `@startRowIndex` and less than or equal to `@startRowIndex` + `@maximumRow` s.</span></span> <span data-ttu-id="b6497-229">Insira o script a seguir no novo procedimento armazenado e, em seguida, clique no ícone salvar para adicionar o procedimento armazenado ao banco de dados.</span><span class="sxs-lookup"><span data-stu-id="b6497-229">Enter the following script into the new stored procedure and then click the Save icon to add the stored procedure to the database.</span></span>

[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample7.sql)]

<span data-ttu-id="b6497-230">Depois de criar o procedimento armazenado, Reserve um tempo para testá-lo. Clique com o botão direito do mouse no `GetProductsPaged` nome do procedimento armazenado na Gerenciador de servidores e escolha a opção Executar.</span><span class="sxs-lookup"><span data-stu-id="b6497-230">After creating the stored procedure, take a moment to test it out. Right-click on the `GetProductsPaged` stored procedure name in the Server Explorer and choose the Execute option.</span></span> <span data-ttu-id="b6497-231">O Visual Studio solicitará os parâmetros de entrada e os `@startRowIndex` `@maximumRow` s (consulte a Figura 7).</span><span class="sxs-lookup"><span data-stu-id="b6497-231">Visual Studio will then prompt you for the input parameters, `@startRowIndex` and `@maximumRow` s (see Figure 7).</span></span> <span data-ttu-id="b6497-232">Tente valores diferentes e examine os resultados.</span><span class="sxs-lookup"><span data-stu-id="b6497-232">Try different values and examine the results.</span></span>

![Insira um valor para os @startRowIndex @maximumRows parâmetros e](efficiently-paging-through-large-amounts-of-data-cs/_static/image7.png)

<span data-ttu-id="b6497-234"><strong>Figura 7</strong>: inserir um valor para os @startRowIndex @maximumRows parâmetros e</span><span class="sxs-lookup"><span data-stu-id="b6497-234"><strong>Figure 7</strong>: Enter a Value for the @startRowIndex and @maximumRows Parameters</span></span>

<span data-ttu-id="b6497-235">Depois de escolher esses valores de parâmetros de entrada, a janela de saída mostrará os resultados.</span><span class="sxs-lookup"><span data-stu-id="b6497-235">After choosing these input parameters values, the Output window will show the results.</span></span> <span data-ttu-id="b6497-236">A Figura 8 mostra os resultados ao passar 10 para os `@startRowIndex` parâmetros e `@maximumRows` .</span><span class="sxs-lookup"><span data-stu-id="b6497-236">Figure 8 shows the results when passing in 10 for both the `@startRowIndex` and `@maximumRows` parameters.</span></span>

<span data-ttu-id="b6497-237">[![Os registros que apareceriam na segunda página de dados são retornados](efficiently-paging-through-large-amounts-of-data-cs/_static/image9.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="b6497-237">[![The Records That Would Appear in the Second Page of Data are Returned](efficiently-paging-through-large-amounts-of-data-cs/_static/image9.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image8.png)</span></span>

<span data-ttu-id="b6497-238">**Figura 8**: os registros que apareceriam na segunda página de dados são retornados ([clique para exibir a imagem em tamanho normal](efficiently-paging-through-large-amounts-of-data-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="b6497-238">**Figure 8**: The Records That Would Appear in the Second Page of Data are Returned ([Click to view full-size image](efficiently-paging-through-large-amounts-of-data-cs/_static/image10.png))</span></span>

<span data-ttu-id="b6497-239">Com esse procedimento armazenado criado, estamos prontos para criar o `ProductsTableAdapter` método.</span><span class="sxs-lookup"><span data-stu-id="b6497-239">With this stored procedure created, we re ready to create the `ProductsTableAdapter` method.</span></span> <span data-ttu-id="b6497-240">Abra o `Northwind.xsd` dataset tipado, clique com o botão direito do mouse no `ProductsTableAdapter` e escolha a opção Adicionar consulta.</span><span class="sxs-lookup"><span data-stu-id="b6497-240">Open the `Northwind.xsd` Typed DataSet, right-click in the `ProductsTableAdapter`, and choose the Add Query option.</span></span> <span data-ttu-id="b6497-241">Em vez de criar a consulta usando uma instrução SQL ad hoc, crie-a usando um procedimento armazenado existente.</span><span class="sxs-lookup"><span data-stu-id="b6497-241">Instead of creating the query using an ad-hoc SQL statement, create it using an existing stored procedure.</span></span>

![Criar o método DAL usando um procedimento armazenado existente](efficiently-paging-through-large-amounts-of-data-cs/_static/image11.png)

<span data-ttu-id="b6497-243">**Figura 9**: criar o método Dal usando um procedimento armazenado existente</span><span class="sxs-lookup"><span data-stu-id="b6497-243">**Figure 9**: Create the DAL Method Using an Existing Stored Procedure</span></span>

<span data-ttu-id="b6497-244">Em seguida, é solicitado que você selecione o procedimento armazenado a ser invocado.</span><span class="sxs-lookup"><span data-stu-id="b6497-244">Next, we are prompted to select the stored procedure to invoke.</span></span> <span data-ttu-id="b6497-245">Selecione o `GetProductsPaged` procedimento armazenado na lista suspensa.</span><span class="sxs-lookup"><span data-stu-id="b6497-245">Pick the `GetProductsPaged` stored procedure from the drop-down list.</span></span>

![Escolha o procedimento armazenado GetProductsPaged na lista suspensa](efficiently-paging-through-large-amounts-of-data-cs/_static/image12.png)

<span data-ttu-id="b6497-247">**Figura 10**: escolha o procedimento armazenado GetProductsPaged na lista suspensa</span><span class="sxs-lookup"><span data-stu-id="b6497-247">**Figure 10**: Choose the GetProductsPaged Stored Procedure from the Drop-Down List</span></span>

<span data-ttu-id="b6497-248">A próxima tela perguntará que tipo de dados é retornado pelo procedimento armazenado: dados tabulares, um único valor ou nenhum valor.</span><span class="sxs-lookup"><span data-stu-id="b6497-248">The next screen then asks you what kind of data is returned by the stored procedure: tabular data, a single value, or no value.</span></span> <span data-ttu-id="b6497-249">Como o `GetProductsPaged` procedimento armazenado pode retornar vários registros, indique que ele retorna dados tabulares.</span><span class="sxs-lookup"><span data-stu-id="b6497-249">Since the `GetProductsPaged` stored procedure can return multiple records, indicate that it returns tabular data.</span></span>

![Indicar que o procedimento armazenado retorna dados tabulares](efficiently-paging-through-large-amounts-of-data-cs/_static/image13.png)

<span data-ttu-id="b6497-251">**Figura 11**: indicar que o procedimento armazenado retorna dados tabulares</span><span class="sxs-lookup"><span data-stu-id="b6497-251">**Figure 11**: Indicate that the Stored Procedure Returns Tabular Data</span></span>

<span data-ttu-id="b6497-252">Por fim, indique os nomes dos métodos que você deseja criar.</span><span class="sxs-lookup"><span data-stu-id="b6497-252">Finally, indicate the names of the methods you want to have created.</span></span> <span data-ttu-id="b6497-253">Assim como nos tutoriais anteriores, vá em frente e crie métodos usando o Fill a DataTable e retorne uma DataTable.</span><span class="sxs-lookup"><span data-stu-id="b6497-253">As with our previous tutorials, go ahead and create methods using both the Fill a DataTable and Return a DataTable.</span></span> <span data-ttu-id="b6497-254">Nomeie o primeiro método `FillPaged` e o segundo `GetProductsPaged` .</span><span class="sxs-lookup"><span data-stu-id="b6497-254">Name the first method `FillPaged` and the second `GetProductsPaged`.</span></span>

![Nomeie os métodos FillPaged e GetProductsPaged](efficiently-paging-through-large-amounts-of-data-cs/_static/image14.png)

<span data-ttu-id="b6497-256">**Figura 12**: nomear os métodos FillPaged e GetProductsPaged</span><span class="sxs-lookup"><span data-stu-id="b6497-256">**Figure 12**: Name the Methods FillPaged and GetProductsPaged</span></span>

<span data-ttu-id="b6497-257">Além de criar um método DAL para retornar uma página específica de produtos, também precisamos fornecer essa funcionalidade na BLL.</span><span class="sxs-lookup"><span data-stu-id="b6497-257">In addition to created a DAL method to return a particular page of products, we also need to provide such functionality in the BLL.</span></span> <span data-ttu-id="b6497-258">Como o método DAL, o método GetProductsPaged de BLL deve aceitar duas entradas de inteiro para especificar o índice de linha inicial e o máximo de linhas, e deve retornar apenas os registros que se enquadram no intervalo especificado.</span><span class="sxs-lookup"><span data-stu-id="b6497-258">Like the DAL method, the BLL s GetProductsPaged method must accept two integer inputs for specifying the Start Row Index and Maximum Rows, and must return just those records that fall within the specified range.</span></span> <span data-ttu-id="b6497-259">Crie um método de BLL na classe ProductsBLL que meramente chama o método da DAL s GetProductsPaged, desta forma:</span><span class="sxs-lookup"><span data-stu-id="b6497-259">Create such a BLL method in the ProductsBLL class that merely calls down into the DAL s GetProductsPaged method, like so:</span></span>

[!code-csharp[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample8.cs)]

<span data-ttu-id="b6497-260">Você pode usar qualquer nome para os parâmetros de entrada do método de BLL, mas, como veremos em breve, optando por usar `startRowIndex` e `maximumRows` nos pouparei de um pouco de trabalho ao configurar um ObjectDataSource para usar esse método.</span><span class="sxs-lookup"><span data-stu-id="b6497-260">You can use any name for the BLL method s input parameters, but, as we will see shortly, choosing to use `startRowIndex` and `maximumRows` saves us from an extra bit of work when configuring an ObjectDataSource to use this method.</span></span>

## <a name="step-4-configuring-the-objectdatasource-to-use-custom-paging"></a><span data-ttu-id="b6497-261">Etapa 4: Configurando o ObjectDataSource para usar a paginação personalizada</span><span class="sxs-lookup"><span data-stu-id="b6497-261">Step 4: Configuring the ObjectDataSource to Use Custom Paging</span></span>

<span data-ttu-id="b6497-262">Com os métodos BLL e DAL para acessar um subconjunto específico de registros concluídos, estamos prontos para criar um controle GridView que páginas por meio de seus registros subjacentes usando a paginação personalizada.</span><span class="sxs-lookup"><span data-stu-id="b6497-262">With the BLL and DAL methods for accessing a particular subset of records complete, we re ready to create a GridView control that pages through its underlying records using custom paging.</span></span> <span data-ttu-id="b6497-263">Comece abrindo a `EfficientPaging.aspx` página na `PagingAndSorting` pasta, adicione um GridView à página e configure-o para usar um novo controle ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="b6497-263">Start by opening the `EfficientPaging.aspx` page in the `PagingAndSorting` folder, add a GridView to the page, and configure it to use a new ObjectDataSource control.</span></span> <span data-ttu-id="b6497-264">Nos nossos tutoriais anteriores, frequentemente tivemos o ObjectDataSource configurado para usar o `ProductsBLL` método Class s `GetProducts` .</span><span class="sxs-lookup"><span data-stu-id="b6497-264">In our past tutorials, we often had the ObjectDataSource configured to use the `ProductsBLL` class s `GetProducts` method.</span></span> <span data-ttu-id="b6497-265">Desta vez, no entanto, desejamos usar o `GetProductsPaged` método, uma vez que o `GetProducts` método retorna *todos* os produtos no banco de dados, enquanto `GetProductsPaged` retorna apenas um subconjunto específico de registros.</span><span class="sxs-lookup"><span data-stu-id="b6497-265">This time, however, we want to use the `GetProductsPaged` method instead, since the `GetProducts` method returns *all* of the products in the database whereas `GetProductsPaged` returns just a particular subset of records.</span></span>

![Configurar o ObjectDataSource para usar o método GetProductsPaged da classe ProductsBLL](efficiently-paging-through-large-amounts-of-data-cs/_static/image15.png)

<span data-ttu-id="b6497-267">**Figura 13**: configurar o ObjectDataSource para usar o método GetProductsPaged da classe ProductsBLL</span><span class="sxs-lookup"><span data-stu-id="b6497-267">**Figure 13**: Configure the ObjectDataSource to Use the ProductsBLL Class s GetProductsPaged Method</span></span>

<span data-ttu-id="b6497-268">Como recriamos um GridView somente leitura, Reserve um momento para definir a lista suspensa método nas guias inserir, atualizar e excluir para (nenhum).</span><span class="sxs-lookup"><span data-stu-id="b6497-268">Since we re creating a read-only GridView, take a moment to set the method drop-down list in the INSERT, UPDATE, and DELETE tabs to (None).</span></span>

<span data-ttu-id="b6497-269">Em seguida, o assistente ObjectDataSource solicitará as fontes dos valores de `GetProductsPaged` método s `startRowIndex` e de `maximumRows` parâmetros de entrada.</span><span class="sxs-lookup"><span data-stu-id="b6497-269">Next, the ObjectDataSource wizard prompts us for the sources of the `GetProductsPaged` method s `startRowIndex` and `maximumRows` input parameters values.</span></span> <span data-ttu-id="b6497-270">Esses parâmetros de entrada serão realmente definidos pelo GridView automaticamente, portanto, basta deixar a fonte definida como nenhum e clicar em concluir.</span><span class="sxs-lookup"><span data-stu-id="b6497-270">These input parameters will actually be set by the GridView automatically, so simply leave the source set to None and click Finish.</span></span>

![Deixar as origens do parâmetro de entrada como nenhuma](efficiently-paging-through-large-amounts-of-data-cs/_static/image16.png)

<span data-ttu-id="b6497-272">**Figura 14**: deixar as origens do parâmetro de entrada como nenhuma</span><span class="sxs-lookup"><span data-stu-id="b6497-272">**Figure 14**: Leave the Input Parameter Sources as None</span></span>

<span data-ttu-id="b6497-273">Depois de concluir o assistente ObjectDataSource, o GridView conterá um BoundField ou CheckBoxField para cada um dos campos de dados do produto.</span><span class="sxs-lookup"><span data-stu-id="b6497-273">After completing the ObjectDataSource wizard, the GridView will contain a BoundField or CheckBoxField for each of the product data fields.</span></span> <span data-ttu-id="b6497-274">Sinta-se à vontade para personalizar a aparência do GridView como você pode ver.</span><span class="sxs-lookup"><span data-stu-id="b6497-274">Feel free to tailor the GridView s appearance as you see fit.</span></span> <span data-ttu-id="b6497-275">Eu optei por exibir apenas o `ProductName` , `CategoryName` , `SupplierName` , `QuantityPerUnit` e `UnitPrice` boundfields.</span><span class="sxs-lookup"><span data-stu-id="b6497-275">I ve opted to display only the `ProductName`, `CategoryName`, `SupplierName`, `QuantityPerUnit`, and `UnitPrice` BoundFields.</span></span> <span data-ttu-id="b6497-276">Além disso, configure o GridView para dar suporte à paginação marcando a caixa de seleção habilitar paginação em sua marca inteligente.</span><span class="sxs-lookup"><span data-stu-id="b6497-276">Also, configure the GridView to support paging by checking the Enable Paging checkbox in its smart tag.</span></span> <span data-ttu-id="b6497-277">Após essas alterações, a marcação declarativa de GridView e ObjectDataSource deve ser semelhante ao seguinte:</span><span class="sxs-lookup"><span data-stu-id="b6497-277">After these changes, the GridView and ObjectDataSource declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample9.aspx)]

<span data-ttu-id="b6497-278">Se você visitar a página por meio de um navegador, no entanto, o GridView não será encontrado.</span><span class="sxs-lookup"><span data-stu-id="b6497-278">If you visit the page through a browser, however, the GridView is no where to be found.</span></span>

![O GridView não é exibido](efficiently-paging-through-large-amounts-of-data-cs/_static/image17.png)

<span data-ttu-id="b6497-280">**Figura 15**: o GridView não é exibido</span><span class="sxs-lookup"><span data-stu-id="b6497-280">**Figure 15**: The GridView is Not Displayed</span></span>

<span data-ttu-id="b6497-281">O GridView está ausente porque o ObjectDataSource está usando 0 como os valores para ambos os parâmetros de `GetProductsPaged` `startRowIndex` `maximumRows` entrada e.</span><span class="sxs-lookup"><span data-stu-id="b6497-281">The GridView is missing because the ObjectDataSource is currently using 0 as the values for both of the `GetProductsPaged` `startRowIndex` and `maximumRows` input parameters.</span></span> <span data-ttu-id="b6497-282">Portanto, a consulta SQL resultante está retornando nenhum registro e, portanto, o GridView não é exibido.</span><span class="sxs-lookup"><span data-stu-id="b6497-282">Hence, the resulting SQL query is returning no records and therefore the GridView is not displayed.</span></span>

<span data-ttu-id="b6497-283">Para corrigir isso, precisamos configurar o ObjectDataSource para usar a paginação personalizada.</span><span class="sxs-lookup"><span data-stu-id="b6497-283">To remedy this, we need to configure the ObjectDataSource to use custom paging.</span></span> <span data-ttu-id="b6497-284">Isso pode ser feito nas seguintes etapas:</span><span class="sxs-lookup"><span data-stu-id="b6497-284">This can be accomplished in the following steps:</span></span>

1. <span data-ttu-id="b6497-285">\*\*Defina a Propriedade ObjectDataSource s `EnablePaging` como `true` \*\* this indica para o ObjectDataSource que ele deve passar para os `SelectMethod` dois parâmetros adicionais: um para especificar o índice de linha inicial ( [`StartRowIndexParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.startrowindexparametername.aspx) ) e outro para especificar o número máximo de linhas ( [`MaximumRowsParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.maximumrowsparametername.aspx) ).</span><span class="sxs-lookup"><span data-stu-id="b6497-285">**Set the ObjectDataSource s `EnablePaging` property to `true`** this indicates to the ObjectDataSource that it must pass to the `SelectMethod` two additional parameters: one to specify the Start Row Index ([`StartRowIndexParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.startrowindexparametername.aspx)), and one to specify the Maximum Rows ([`MaximumRowsParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.maximumrowsparametername.aspx)).</span></span>
2. <span data-ttu-id="b6497-286">**Defina as propriedades ObjectDataSource `StartRowIndexParameterName` e, `MaximumRowsParameterName` adequadamente** , as `StartRowIndexParameterName` `MaximumRowsParameterName` Propriedades e indicam os nomes dos parâmetros de entrada passados para o `SelectMethod` para fins de paginação personalizada.</span><span class="sxs-lookup"><span data-stu-id="b6497-286">**Set the ObjectDataSource s `StartRowIndexParameterName` and `MaximumRowsParameterName` Properties Accordingly** the `StartRowIndexParameterName` and `MaximumRowsParameterName` properties indicate the names of the input parameters passed into the `SelectMethod` for custom paging purposes.</span></span> <span data-ttu-id="b6497-287">Por padrão, esses nomes de parâmetro são `startIndexRow` e `maximumRows` , que é o motivo pelo qual, ao criar o `GetProductsPaged` método na BLL, usei esses valores para os parâmetros de entrada.</span><span class="sxs-lookup"><span data-stu-id="b6497-287">By default, these parameter names are `startIndexRow` and `maximumRows`, which is why, when creating the `GetProductsPaged` method in the BLL, I used these values for the input parameters.</span></span> <span data-ttu-id="b6497-288">Se você optar por usar nomes de parâmetro diferentes para o método da BLL s `GetProductsPaged` , como `startIndex` e `maxRows` , por exemplo, precisaria definir o ObjectDataSource s `StartRowIndexParameterName` e `MaximumRowsParameterName` as propriedades de acordo (como startIndex para `StartRowIndexParameterName` e maxRows para `MaximumRowsParameterName` ).</span><span class="sxs-lookup"><span data-stu-id="b6497-288">If you chose to use different parameter names for the BLL s `GetProductsPaged` method such as `startIndex` and `maxRows`, for example you would need to set the ObjectDataSource s `StartRowIndexParameterName` and `MaximumRowsParameterName` properties accordingly (such as startIndex for `StartRowIndexParameterName` and maxRows for `MaximumRowsParameterName`).</span></span>
3. <span data-ttu-id="b6497-289">**Defina a [ `SelectCountMethod` Propriedade](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.selectcountmethod(VS.80).aspx) ObjectDataSource s como o nome do método que retorna o número total de registros sendo paginados por meio de ( `TotalNumberOfProducts` )** Lembre-se de que o `ProductsBLL` método Class s `TotalNumberOfProducts` retorna o número total de registros sendo paginados por meio do uso de um método Dal que executa uma `SELECT COUNT(*) FROM Products` consulta.</span><span class="sxs-lookup"><span data-stu-id="b6497-289">**Set the ObjectDataSource s [`SelectCountMethod` Property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.selectcountmethod(VS.80).aspx) to the Name of the Method that Returns the Total Number of Records Being Paged Through (`TotalNumberOfProducts`)** recall that the `ProductsBLL` class s `TotalNumberOfProducts` method returns the total number of records being paged through using a DAL method that executes a `SELECT COUNT(*) FROM Products` query.</span></span> <span data-ttu-id="b6497-290">Essas informações são necessárias para o ObjectDataSource a fim de processar corretamente a interface de paginação.</span><span class="sxs-lookup"><span data-stu-id="b6497-290">This information is needed by the ObjectDataSource in order to correctly render the paging interface.</span></span>
4. <span data-ttu-id="b6497-291">**Remover os `startRowIndex` `maximumRows` `<asp:Parameter>` elementos e da marcação declaradora de ObjectDataSource s** ao configurar o ObjectDataSource por meio do assistente, o Visual Studio adicionou automaticamente dois `<asp:Parameter>` elementos para os `GetProductsPaged` parâmetros de entrada do método.</span><span class="sxs-lookup"><span data-stu-id="b6497-291">**Remove the `startRowIndex` and `maximumRows` `<asp:Parameter>` Elements from the ObjectDataSource s Declarative Markup** when configuring the ObjectDataSource through the wizard, Visual Studio automatically added two `<asp:Parameter>` elements for the `GetProductsPaged` method s input parameters.</span></span> <span data-ttu-id="b6497-292">Ao definir `EnablePaging` como `true` , esses parâmetros serão passados automaticamente; se eles também aparecerem na sintaxe declarativa, o ObjectDataSource tentará passar *quatro* parâmetros para o `GetProductsPaged` método e dois parâmetros para o `TotalNumberOfProducts` método.</span><span class="sxs-lookup"><span data-stu-id="b6497-292">By setting `EnablePaging` to `true`, these parameters will be passed automatically; if they also appear in the declarative syntax, the ObjectDataSource will attempt to pass *four* parameters to the `GetProductsPaged` method and two parameters to the `TotalNumberOfProducts` method.</span></span> <span data-ttu-id="b6497-293">Se você esquecer de remover esses `<asp:Parameter>` elementos, ao visitar a página por meio de um navegador, receberá uma mensagem de erro como: *ObjectDataSource ' ObjectDataSource1 ' não pôde encontrar um método não genérico ' TotalNumberOfProducts ' que tenha parâmetros: StartRowIndex, MaximumRows*.</span><span class="sxs-lookup"><span data-stu-id="b6497-293">If you forget to remove these `<asp:Parameter>` elements, when visiting the page through a browser you'll get an error message like: *ObjectDataSource 'ObjectDataSource1' could not find a non-generic method 'TotalNumberOfProducts' that has parameters: startRowIndex, maximumRows*.</span></span>

<span data-ttu-id="b6497-294">Depois de fazer essas alterações, a sintaxe declarada de ObjectDataSource s deve ser semelhante ao seguinte:</span><span class="sxs-lookup"><span data-stu-id="b6497-294">After making these changes, the ObjectDataSource s declarative syntax should look like the following:</span></span>

[!code-aspx[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample10.aspx)]

<span data-ttu-id="b6497-295">Observe que as `EnablePaging` Propriedades e foram `SelectCountMethod` definidas e que os `<asp:Parameter>` elementos foram removidos.</span><span class="sxs-lookup"><span data-stu-id="b6497-295">Note that the `EnablePaging` and `SelectCountMethod` properties have been set and the `<asp:Parameter>` elements have been removed.</span></span> <span data-ttu-id="b6497-296">A Figura 16 mostra uma captura de tela da janela Propriedades após essas alterações terem sido feitas.</span><span class="sxs-lookup"><span data-stu-id="b6497-296">Figure 16 shows a screen shot of the Properties window after these changes have been made.</span></span>

![Para usar a paginação personalizada, configure o controle ObjectDataSource](efficiently-paging-through-large-amounts-of-data-cs/_static/image18.png)

<span data-ttu-id="b6497-298">**Figura 16**: para usar a paginação personalizada, configure o controle ObjectDataSource</span><span class="sxs-lookup"><span data-stu-id="b6497-298">**Figure 16**: To Use Custom Paging, Configure the ObjectDataSource Control</span></span>

<span data-ttu-id="b6497-299">Depois de fazer essas alterações, visite esta página por meio de um navegador.</span><span class="sxs-lookup"><span data-stu-id="b6497-299">After making these changes, visit this page through a browser.</span></span> <span data-ttu-id="b6497-300">Você deve ver 10 produtos listados, ordenados alfabeticamente.</span><span class="sxs-lookup"><span data-stu-id="b6497-300">You should see 10 products listed, ordered alphabetically.</span></span> <span data-ttu-id="b6497-301">Reserve um momento para percorrer os dados uma página por vez.</span><span class="sxs-lookup"><span data-stu-id="b6497-301">Take a moment to step through the data one page at a time.</span></span> <span data-ttu-id="b6497-302">Embora não haja nenhuma diferença visual da perspectiva do usuário final entre a paginação padrão e a paginação personalizada, a paginação personalizada é mais eficiente para páginas por meio de grandes quantidades de dados, uma vez que recupera apenas os registros que precisam ser exibidos para uma determinada página.</span><span class="sxs-lookup"><span data-stu-id="b6497-302">While there is no visual difference from the end user s perspective between default paging and custom paging, custom paging more efficiently pages through large amounts of data as it only retrieves those records that need to be displayed for a given page.</span></span>

<span data-ttu-id="b6497-303">[![Os dados, ordenados pelo nome do produto, são paginados usando a paging personalizado](efficiently-paging-through-large-amounts-of-data-cs/_static/image20.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="b6497-303">[![The Data, Ordered by the Product s Name, is Paged Using Custom Paging](efficiently-paging-through-large-amounts-of-data-cs/_static/image20.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image19.png)</span></span>

<span data-ttu-id="b6497-304">**Figura 17**: os dados, ordenados pelo nome do produto, são paginados usando a paging personalizado ([clique para exibir a imagem em tamanho normal](efficiently-paging-through-large-amounts-of-data-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="b6497-304">**Figure 17**: The Data, Ordered by the Product s Name, is Paged Using Custom Paging ([Click to view full-size image](efficiently-paging-through-large-amounts-of-data-cs/_static/image21.png))</span></span>

> [!NOTE]
> <span data-ttu-id="b6497-305">Com a paginação personalizada, o valor de contagem de páginas retornado pelo ObjectDataSource `SelectCountMethod` é armazenado no estado de exibição do GridView.</span><span class="sxs-lookup"><span data-stu-id="b6497-305">With custom paging, the page count value returned by the ObjectDataSource's `SelectCountMethod` is stored in the GridView's view state.</span></span> <span data-ttu-id="b6497-306">Outras variáveis GridView, a coleção,,, `PageIndex` `EditIndex` `SelectedIndex` `DataKeys` e assim por diante, são armazenadas no *estado de controle*, que é persistido independentemente do valor da `EnableViewState` Propriedade GridView.</span><span class="sxs-lookup"><span data-stu-id="b6497-306">Other GridView variables the `PageIndex`, `EditIndex`, `SelectedIndex`, `DataKeys` collection, and so on are stored in *control state*, which is persisted regardless of the value of the GridView's `EnableViewState` property.</span></span> <span data-ttu-id="b6497-307">Como o `PageCount` valor é mantido entre postbacks usando o estado de exibição, ao usar uma interface de paginação que inclui um link para levá-lo até a última página, é imperativo que o estado de exibição do GridView seja habilitado.</span><span class="sxs-lookup"><span data-stu-id="b6497-307">Since the `PageCount` value is persisted across postbacks using view state, when using a paging interface that includes a link to take you to the last page, it is imperative that the GridView's view state be enabled.</span></span> <span data-ttu-id="b6497-308">(Se a sua interface de paginação não incluir um link direto para a última página, você poderá desabilitar o estado de exibição.)</span><span class="sxs-lookup"><span data-stu-id="b6497-308">(If your paging interface does not include a direct link to the last page, then you may disable view state.)</span></span>

<span data-ttu-id="b6497-309">Clicar no link da última página causa um postback e instrui o GridView a atualizar sua `PageIndex` propriedade.</span><span class="sxs-lookup"><span data-stu-id="b6497-309">Clicking the last page link causes a postback and instructs the GridView to update its `PageIndex` property.</span></span> <span data-ttu-id="b6497-310">Se o link da última página for clicado, o GridView atribuirá sua `PageIndex` Propriedade a um valor menor que sua `PageCount` propriedade.</span><span class="sxs-lookup"><span data-stu-id="b6497-310">If the last page link is clicked, the GridView assigns its `PageIndex` property to a value one less than its `PageCount` property.</span></span> <span data-ttu-id="b6497-311">Com o estado de exibição desabilitado, o `PageCount` valor é perdido em postagens e o `PageIndex` valor inteiro máximo é atribuído ao seu.</span><span class="sxs-lookup"><span data-stu-id="b6497-311">With view state disabled, the `PageCount` value is lost across postbacks and the `PageIndex` is assigned the maximum integer value instead.</span></span> <span data-ttu-id="b6497-312">Em seguida, o GridView tenta determinar o índice de linha inicial multiplicando as `PageSize` `PageCount` Propriedades e.</span><span class="sxs-lookup"><span data-stu-id="b6497-312">Next, the GridView attempts to determine the starting row index by multiplying the `PageSize` and `PageCount` properties.</span></span> <span data-ttu-id="b6497-313">Isso resulta em um `OverflowException` desde que o produto exceda o tamanho máximo de inteiro permitido.</span><span class="sxs-lookup"><span data-stu-id="b6497-313">This results in an `OverflowException` since the product exceeds the maximum allowed integer size.</span></span>

## <a name="implement-custom-paging-and-sorting"></a><span data-ttu-id="b6497-314">Implementar paginação e classificação personalizadas</span><span class="sxs-lookup"><span data-stu-id="b6497-314">Implement Custom Paging and Sorting</span></span>

<span data-ttu-id="b6497-315">Nossa implementação de paginação personalizada atual requer que a ordem pela qual os dados são paginados seja especificada estaticamente ao criar o `GetProductsPaged` procedimento armazenado.</span><span class="sxs-lookup"><span data-stu-id="b6497-315">Our current custom paging implementation requires that the order by which the data is paged through be specified statically when creating the `GetProductsPaged` stored procedure.</span></span> <span data-ttu-id="b6497-316">No entanto, você pode ter observado que a marca inteligente GridView s contém uma caixa de seleção Habilitar classificação, além da opção habilitar paginação.</span><span class="sxs-lookup"><span data-stu-id="b6497-316">However, you may have noted that the GridView s smart tag contains an Enable Sorting checkbox in addition to the Enable Paging option.</span></span> <span data-ttu-id="b6497-317">Infelizmente, adicionar suporte à classificação ao GridView com nossa implementação de paginação personalizada atual classificará apenas os registros na página de dados exibida atualmente.</span><span class="sxs-lookup"><span data-stu-id="b6497-317">Unfortunately, adding sorting support to the GridView with our current custom paging implementation will only sort the records on the currently viewed page of data.</span></span> <span data-ttu-id="b6497-318">Por exemplo, se você configurar o GridView para também oferecer suporte à paginação e, em seguida, ao exibir a primeira página de dados, classificar por nome do produto em ordem decrescente, ele inverterá a ordem dos produtos na página 1.</span><span class="sxs-lookup"><span data-stu-id="b6497-318">For example, if you configure the GridView to also support paging and then, when viewing the first page of data, sort by product name in descending order, it will reverse the order of the products on page 1.</span></span> <span data-ttu-id="b6497-319">Como mostra a Figura 18, mostra Carnarvon, tigres como o primeiro produto ao classificar em ordem alfabética inversa, que ignora os 71 outros produtos que vêm após Carnarvon, tigres, alfabeticamente; somente os registros na primeira página são considerados na classificação.</span><span class="sxs-lookup"><span data-stu-id="b6497-319">As Figure 18 shows, such shows Carnarvon Tigers as the first product when sorting in reverse alphabetical order, which ignores the 71 other products that come after Carnarvon Tigers, alphabetically; only those records on the first page are considered in the sorting.</span></span>

<span data-ttu-id="b6497-320">[![Somente os dados mostrados na página atual são classificados](efficiently-paging-through-large-amounts-of-data-cs/_static/image23.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="b6497-320">[![Only the Data Shown on the Current Page is Sorted](efficiently-paging-through-large-amounts-of-data-cs/_static/image23.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image22.png)</span></span>

<span data-ttu-id="b6497-321">**Figura 18**: somente os dados mostrados na página atual são classificados ([clique para exibir a imagem em tamanho normal](efficiently-paging-through-large-amounts-of-data-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="b6497-321">**Figure 18**: Only the Data Shown on the Current Page is Sorted ([Click to view full-size image](efficiently-paging-through-large-amounts-of-data-cs/_static/image24.png))</span></span>

<span data-ttu-id="b6497-322">A classificação só se aplica à página de dados atual porque a classificação está ocorrendo depois que os dados são recuperados do método da BLL s `GetProductsPaged` , e esse método retorna apenas os registros para a página específica.</span><span class="sxs-lookup"><span data-stu-id="b6497-322">The sorting only applies to the current page of data because the sorting is occurring after the data has been retrieved from the BLL s `GetProductsPaged` method, and this method only returns those records for the specific page.</span></span> <span data-ttu-id="b6497-323">Para implementar a classificação corretamente, precisamos passar a expressão de classificação para o `GetProductsPaged` método para que os dados possam ser classificados adequadamente antes de retornar a página de dados específica.</span><span class="sxs-lookup"><span data-stu-id="b6497-323">To implement sorting correctly, we need to pass the sort expression to the `GetProductsPaged` method so that the data can be ranked appropriately before returning the specific page of data.</span></span> <span data-ttu-id="b6497-324">Veremos como fazer isso em nosso próximo tutorial.</span><span class="sxs-lookup"><span data-stu-id="b6497-324">We'll see how to accomplish this in our next tutorial.</span></span>

## <a name="implementing-custom-paging-and-deleting"></a><span data-ttu-id="b6497-325">Implementando paginação personalizada e excluindo</span><span class="sxs-lookup"><span data-stu-id="b6497-325">Implementing Custom Paging and Deleting</span></span>

<span data-ttu-id="b6497-326">Se você estiver habilitando a funcionalidade de exclusão em um GridView cujos dados são paginados usando técnicas de paging personalizadas, descobrirá que, ao excluir o último registro da última página, o GridView desaparecerá em vez de reduzir adequadamente os s GridView `PageIndex` .</span><span class="sxs-lookup"><span data-stu-id="b6497-326">If you enabling deleting functionality in a GridView whose data is paged using custom paging techniques you will find that when deleting the last record from the last page, the GridView disappears rather than appropriately decrementing the GridView s `PageIndex`.</span></span> <span data-ttu-id="b6497-327">Para reproduzir esse bug, habilite a exclusão para o tutorial que acabamos de criar.</span><span class="sxs-lookup"><span data-stu-id="b6497-327">To reproduce this bug, enable deleting for the tutorial just we just created.</span></span> <span data-ttu-id="b6497-328">Vá para a última página (página 9), em que você verá um único produto, já que estamos paginando por meio de 81 produtos, 10 produtos por vez.</span><span class="sxs-lookup"><span data-stu-id="b6497-328">Go to the last page (page 9), where you should see a single product since we are paging through 81 products, 10 products at a time.</span></span> <span data-ttu-id="b6497-329">Excluir este produto.</span><span class="sxs-lookup"><span data-stu-id="b6497-329">Delete this product.</span></span>

<span data-ttu-id="b6497-330">Ao excluir o último produto, o GridView *deve* ir automaticamente para a oitava página, e essa funcionalidade é exibida com paginação padrão.</span><span class="sxs-lookup"><span data-stu-id="b6497-330">Upon deleting the last product, the GridView *should* automatically go to the eighth page, and such functionality is exhibited with default paging.</span></span> <span data-ttu-id="b6497-331">Com a paginação personalizada, no entanto, depois de excluir o último produto na última página, o GridView simplesmente desaparece da tela completamente.</span><span class="sxs-lookup"><span data-stu-id="b6497-331">With custom paging, however, after deleting that last product on the last page, the GridView simply disappears from the screen altogether.</span></span> <span data-ttu-id="b6497-332">O motivo preciso *pelo qual* isso acontece é um pouco além do escopo deste tutorial; consulte [excluindo o último registro na última página de um GridView com paginação personalizada](http://scottonwriting.net/sowblog/posts/7326.aspx) para obter detalhes de baixo nível sobre a origem desse problema.</span><span class="sxs-lookup"><span data-stu-id="b6497-332">The precise reason *why* this happens is a bit beyond the scope of this tutorial; see [Deleting the Last Record on the Last Page from a GridView with Custom Paging](http://scottonwriting.net/sowblog/posts/7326.aspx) for the low-level details as to the source of this problem.</span></span> <span data-ttu-id="b6497-333">Em resumo, isso ocorre devido à seguinte sequência de etapas executadas pelo GridView quando o botão excluir é clicado:</span><span class="sxs-lookup"><span data-stu-id="b6497-333">In summary it s due to the following sequence of steps that are performed by the GridView when the Delete button is clicked:</span></span>

1. <span data-ttu-id="b6497-334">Excluir o registro</span><span class="sxs-lookup"><span data-stu-id="b6497-334">Delete the record</span></span>
2. <span data-ttu-id="b6497-335">Obter os registros apropriados a serem exibidos para o especificado `PageIndex` e `PageSize`</span><span class="sxs-lookup"><span data-stu-id="b6497-335">Get the appropriate records to display for the specified `PageIndex` and `PageSize`</span></span>
3. <span data-ttu-id="b6497-336">Verifique se o `PageIndex` não excede o número de páginas de dados na fonte de dados; se tiver, decrementará automaticamente a Propriedade GridView s `PageIndex`</span><span class="sxs-lookup"><span data-stu-id="b6497-336">Check to ensure that the `PageIndex` does not exceed the number of pages of data in the data source; if it does, automatically decrement the GridView s `PageIndex` property</span></span>
4. <span data-ttu-id="b6497-337">Associar a página de dados apropriada ao GridView usando os registros obtidos na etapa 2</span><span class="sxs-lookup"><span data-stu-id="b6497-337">Bind the appropriate page of data to the GridView using the records obtained in Step 2</span></span>

<span data-ttu-id="b6497-338">O problema se origina do fato de que, na etapa 2, o que `PageIndex` é usado ao captar os registros a serem exibidos ainda é a `PageIndex` da última página cujo registro único acabou de ser excluído.</span><span class="sxs-lookup"><span data-stu-id="b6497-338">The problem stems from the fact that in Step 2 the `PageIndex` used when grabbing the records to display is still the `PageIndex` of the last page whose sole record was just deleted.</span></span> <span data-ttu-id="b6497-339">Portanto, na etapa 2, *nenhum* registro é retornado, já que a última página de dados não contém mais nenhum registro.</span><span class="sxs-lookup"><span data-stu-id="b6497-339">Therefore, in Step 2, *no* records are returned since that last page of data no longer contains any records.</span></span> <span data-ttu-id="b6497-340">Em seguida, na etapa 3, o GridView percebe que sua `PageIndex` propriedade é maior do que o número total de páginas na fonte de dados (desde que tenhamos excluído o último registro na última página) e, portanto, decrementa sua `PageIndex` propriedade.</span><span class="sxs-lookup"><span data-stu-id="b6497-340">Then, in Step 3, the GridView realizes that its `PageIndex` property is greater than the total number of pages in the data source (since we ve deleted the last record in the last page) and therefore decrements its `PageIndex` property.</span></span> <span data-ttu-id="b6497-341">Na etapa 4, o GridView tenta se associar aos dados recuperados na etapa 2; no entanto, na etapa 2, nenhum registro foi retornado, portanto, resultando em um GridView vazio.</span><span class="sxs-lookup"><span data-stu-id="b6497-341">In Step 4 the GridView attempts to bind itself to the data retrieved in Step 2; however, in Step 2 no records were returned, therefore resulting in an empty GridView.</span></span> <span data-ttu-id="b6497-342">Com a paginação padrão, esse problema não está na superfície, pois na etapa 2 *todos os* registros são recuperados da fonte de dados.</span><span class="sxs-lookup"><span data-stu-id="b6497-342">With default paging, this problem doesn t surface because in Step 2 *all* records are retrieved from the data source.</span></span>

<span data-ttu-id="b6497-343">Para corrigir isso, temos duas opções.</span><span class="sxs-lookup"><span data-stu-id="b6497-343">To fix this we have two options.</span></span> <span data-ttu-id="b6497-344">A primeira é criar um manipulador de eventos para o manipulador de `RowDeleted` eventos GridView que determina quantos registros foram exibidos na página que acabou de ser excluída.</span><span class="sxs-lookup"><span data-stu-id="b6497-344">The first is to create an event handler for the GridView s `RowDeleted` event handler that determines how many records were displayed in the page that was just deleted.</span></span> <span data-ttu-id="b6497-345">Se houvesse apenas um registro, o registro acabou de ser excluído deve ter sido o último e precisamos decrementar os s GridView `PageIndex` .</span><span class="sxs-lookup"><span data-stu-id="b6497-345">If there was only one record, then the record just deleted must have been the last one and we need to decrement the GridView s `PageIndex`.</span></span> <span data-ttu-id="b6497-346">É claro que só queremos atualizar o `PageIndex` se a operação de exclusão foi realmente bem-sucedida, o que pode ser determinado garantindo que a `e.Exception` propriedade seja `null` .</span><span class="sxs-lookup"><span data-stu-id="b6497-346">Of course, we only want to update the `PageIndex` if the delete operation was actually successful, which can be determined by ensuring that the `e.Exception` property is `null`.</span></span>

<span data-ttu-id="b6497-347">Essa abordagem funciona porque atualiza o `PageIndex` após a etapa 1, mas antes da etapa 2.</span><span class="sxs-lookup"><span data-stu-id="b6497-347">This approach works because it updates the `PageIndex` after Step 1 but before Step 2.</span></span> <span data-ttu-id="b6497-348">Portanto, na etapa 2, o conjunto apropriado de registros é retornado.</span><span class="sxs-lookup"><span data-stu-id="b6497-348">Therefore, in Step 2, the appropriate set of records is returned.</span></span> <span data-ttu-id="b6497-349">Para fazer isso, use um código semelhante ao seguinte:</span><span class="sxs-lookup"><span data-stu-id="b6497-349">To accomplish this, use code like the following:</span></span>

[!code-csharp[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample11.cs)]

<span data-ttu-id="b6497-350">Uma alternativa alternativa é criar um manipulador de eventos para o evento ObjectDataSource s `RowDeleted` e definir a `AffectedRows` propriedade com um valor de 1.</span><span class="sxs-lookup"><span data-stu-id="b6497-350">An alternative workaround is to create an event handler for the ObjectDataSource s `RowDeleted` event and to set the `AffectedRows` property to a value of 1.</span></span> <span data-ttu-id="b6497-351">Depois de excluir o registro na etapa 1 (mas antes de recuperar os dados novamente na etapa 2), o GridView atualizará sua `PageIndex` propriedade se uma ou mais linhas tiverem sido afetadas pela operação.</span><span class="sxs-lookup"><span data-stu-id="b6497-351">After deleting the record in Step 1 (but before re-retrieving the data in Step 2), the GridView updates its `PageIndex` property if one or more rows were affected by the operation.</span></span> <span data-ttu-id="b6497-352">No entanto, a `AffectedRows` propriedade não é definida pelo ObjectDataSource e, portanto, essa etapa é omitida.</span><span class="sxs-lookup"><span data-stu-id="b6497-352">However, the `AffectedRows` property is not set by the ObjectDataSource and therefore this step is omitted.</span></span> <span data-ttu-id="b6497-353">Uma maneira de executar essa etapa é definir manualmente a `AffectedRows` propriedade se a operação de exclusão for concluída com êxito.</span><span class="sxs-lookup"><span data-stu-id="b6497-353">One way to have this step executed is to manually set the `AffectedRows` property if the delete operation completes successfully.</span></span> <span data-ttu-id="b6497-354">Isso pode ser feito usando um código semelhante ao seguinte:</span><span class="sxs-lookup"><span data-stu-id="b6497-354">This can be accomplished using code like the following:</span></span>

[!code-csharp[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample12.cs)]

<span data-ttu-id="b6497-355">O código para ambos os manipuladores de eventos pode ser encontrado na classe code-behind do `EfficientPaging.aspx` exemplo.</span><span class="sxs-lookup"><span data-stu-id="b6497-355">The code for both of these events handlers can be found in code-behind class of the `EfficientPaging.aspx` example.</span></span>

## <a name="comparing-the-performance-of-default-and-custom-paging"></a><span data-ttu-id="b6497-356">Comparando o desempenho da paginação padrão e personalizada</span><span class="sxs-lookup"><span data-stu-id="b6497-356">Comparing the Performance of Default and Custom Paging</span></span>

<span data-ttu-id="b6497-357">Como a paginação personalizada recupera apenas os registros necessários, enquanto a paginação padrão retorna *todos* os registros de cada página que está sendo exibida, ela limpa se a paginação personalizada é mais eficiente do que a paginação padrão.</span><span class="sxs-lookup"><span data-stu-id="b6497-357">Since custom paging only retrieves the needed records, whereas default paging returns *all* of the records for each page being viewed, it s clear that custom paging is more efficient than default paging.</span></span> <span data-ttu-id="b6497-358">Mas o quanto mais eficiente é a paginação personalizada?</span><span class="sxs-lookup"><span data-stu-id="b6497-358">But just how much more efficient is custom paging?</span></span> <span data-ttu-id="b6497-359">Que tipo de ganhos de desempenho pode ser visto movendo-se da paginação padrão para a paginação personalizada?</span><span class="sxs-lookup"><span data-stu-id="b6497-359">What sort of performance gains can be seen by moving from default paging to custom paging?</span></span>

<span data-ttu-id="b6497-360">Infelizmente, não há nenhum tamanho que atenda a todas as respostas aqui.</span><span class="sxs-lookup"><span data-stu-id="b6497-360">Unfortunately, there s no one size fits all answer here.</span></span> <span data-ttu-id="b6497-361">O lucro de desempenho depende de uma série de fatores, quanto mais proeminente dois são o número de registros sendo paginados e a carga colocada no servidor de banco de dados e nos canais de comunicação entre o servidor Web e o servidor de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="b6497-361">The performance gain depends on a number of factors, the most prominent two being the number of records being paged through and the load placed on the database server and communication channels between the web server and database server.</span></span> <span data-ttu-id="b6497-362">Para tabelas pequenas com apenas algumas dúzias de registros, a diferença de desempenho pode ser insignificante.</span><span class="sxs-lookup"><span data-stu-id="b6497-362">For small tables with just a few dozen records, the performance difference may be negligible.</span></span> <span data-ttu-id="b6497-363">No entanto, para tabelas grandes, com milhares a centenas de milhares de linhas, a diferença de desempenho é de acento agudo.</span><span class="sxs-lookup"><span data-stu-id="b6497-363">For large tables, with thousands to hundreds of thousands of rows, though, the performance difference is acute.</span></span>

<span data-ttu-id="b6497-364">Um artigo de minha, [paginação personalizada no ASP.NET 2,0 com SQL Server 2005](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx), contém alguns testes de desempenho que executei para exibir as diferenças no desempenho entre essas duas técnicas de paginação ao paginar por meio de uma tabela de banco de dados com registros 50.000.</span><span class="sxs-lookup"><span data-stu-id="b6497-364">An article of mine, [Custom Paging in ASP.NET 2.0 with SQL Server 2005](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx), contains some performance tests I ran to exhibit the differences in performance between these two paging techniques when paging through a database table with 50,000 records.</span></span> <span data-ttu-id="b6497-365">Nesses testes, examinei o tempo para executar a consulta no nível de SQL Server (usando o [SQL Profiler](https://msdn.microsoft.com/library/ms173757.aspx)) e na página ASP.NET usando os [recursos de rastreamento de ASP.net](https://msdn.microsoft.com/library/y13fw6we.aspx).</span><span class="sxs-lookup"><span data-stu-id="b6497-365">In these tests I examined both the time to execute the query at the SQL Server level (using [SQL Profiler](https://msdn.microsoft.com/library/ms173757.aspx)) and at the ASP.NET page using [ASP.NET s tracing features](https://msdn.microsoft.com/library/y13fw6we.aspx).</span></span> <span data-ttu-id="b6497-366">Tenha em mente que esses testes foram executados na minha caixa de desenvolvimento com um único usuário ativo e, portanto, não são científicos e não imitam padrões de carga de site típicos.</span><span class="sxs-lookup"><span data-stu-id="b6497-366">Keep in mind that these tests were run on my development box with a single active user, and therefore are unscientific and do not mimic typical website load patterns.</span></span> <span data-ttu-id="b6497-367">Independentemente disso, os resultados ilustram as diferenças relativas no tempo de execução para a paginação padrão e personalizada ao trabalhar com quantidades de dados suficientemente grandes.</span><span class="sxs-lookup"><span data-stu-id="b6497-367">Regardless, the results illustrate the relative differences in execution time for default and custom paging when working with sufficiently large amounts of data.</span></span>

|  | <span data-ttu-id="b6497-368">**Duração média (s)**</span><span class="sxs-lookup"><span data-stu-id="b6497-368">**Avg. Duration (sec)**</span></span> | <span data-ttu-id="b6497-369">**Reads**</span><span class="sxs-lookup"><span data-stu-id="b6497-369">**Reads**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="b6497-370">**Paginação padrão do SQL Profiler**</span><span class="sxs-lookup"><span data-stu-id="b6497-370">**Default Paging SQL Profiler**</span></span> | <span data-ttu-id="b6497-371">1,411</span><span class="sxs-lookup"><span data-stu-id="b6497-371">1.411</span></span> | <span data-ttu-id="b6497-372">383</span><span class="sxs-lookup"><span data-stu-id="b6497-372">383</span></span> |
| <span data-ttu-id="b6497-373">**Paginação personalizada do SQL Profiler**</span><span class="sxs-lookup"><span data-stu-id="b6497-373">**Custom Paging SQL Profiler**</span></span> | <span data-ttu-id="b6497-374">0, 2</span><span class="sxs-lookup"><span data-stu-id="b6497-374">0.002</span></span> | <span data-ttu-id="b6497-375">29</span><span class="sxs-lookup"><span data-stu-id="b6497-375">29</span></span> |
| <span data-ttu-id="b6497-376">**Rastreamento de ASP.NET de paginação padrão**</span><span class="sxs-lookup"><span data-stu-id="b6497-376">**Default Paging ASP.NET Trace**</span></span> | <span data-ttu-id="b6497-377">2,379</span><span class="sxs-lookup"><span data-stu-id="b6497-377">2.379</span></span> | <span data-ttu-id="b6497-378">*N/A*</span><span class="sxs-lookup"><span data-stu-id="b6497-378">*N/A*</span></span> |
| <span data-ttu-id="b6497-379">**Rastreamento de ASP.NET de paginação personalizada**</span><span class="sxs-lookup"><span data-stu-id="b6497-379">**Custom Paging ASP.NET Trace**</span></span> | <span data-ttu-id="b6497-380">0, 29</span><span class="sxs-lookup"><span data-stu-id="b6497-380">0.029</span></span> | <span data-ttu-id="b6497-381">*N/A*</span><span class="sxs-lookup"><span data-stu-id="b6497-381">*N/A*</span></span> |

<span data-ttu-id="b6497-382">Como você pode ver, a recuperação de uma página específica de dados exigiu 354 menos leituras em média e é concluída em uma fração do tempo.</span><span class="sxs-lookup"><span data-stu-id="b6497-382">As you can see, retrieving a particular page of data required 354 less reads on average and completed in a fraction of the time.</span></span> <span data-ttu-id="b6497-383">Na página ASP.NET, a página personalizada foi capaz de renderizar perto<sup>de 1/100,</sup> do tempo necessário ao usar a paginação padrão.</span><span class="sxs-lookup"><span data-stu-id="b6497-383">At the ASP.NET page, custom the page was able to render in close to 1/100<sup>th</sup> of the time it took when using default paging.</span></span> <span data-ttu-id="b6497-384">Consulte [meu artigo](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx) para obter mais informações sobre esses resultados juntamente com o código e um banco de dados que você pode baixar para reproduzir esses testes em seu próprio ambiente.</span><span class="sxs-lookup"><span data-stu-id="b6497-384">See [my article](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx) for more information on these results along with code and a database you can download to reproduce these tests in your own environment.</span></span>

## <a name="summary"></a><span data-ttu-id="b6497-385">Resumo</span><span class="sxs-lookup"><span data-stu-id="b6497-385">Summary</span></span>

<span data-ttu-id="b6497-386">A paginação padrão é um fácil para implementar apenas marque a caixa de seleção habilitar paginação na marca inteligente s de controle da Web de dados, mas essa simplicidade é o custo do desempenho.</span><span class="sxs-lookup"><span data-stu-id="b6497-386">Default paging is a cinch to implement just check the Enable Paging checkbox in the data Web control s smart tag but such simplicity comes at the cost of performance.</span></span> <span data-ttu-id="b6497-387">Com a paginação padrão, quando um usuário solicita qualquer página de dados, *todos os* registros são retornados, embora apenas uma pequena fração deles possa ser mostrada.</span><span class="sxs-lookup"><span data-stu-id="b6497-387">With default paging, when a user requests any page of data *all* records are returned, even though only a tiny fraction of them may be shown.</span></span> <span data-ttu-id="b6497-388">Para combater essa sobrecarga de desempenho, o ObjectDataSource oferece uma paginação personalizada de opção de paginação alternativa.</span><span class="sxs-lookup"><span data-stu-id="b6497-388">To combat this performance overhead, the ObjectDataSource offers an alternative paging option custom paging.</span></span>

<span data-ttu-id="b6497-389">Embora a paginação personalizada Aprimore os problemas de desempenho de paginação padrão, recuperando apenas os registros que precisam ser exibidos, mais envolvida para implementar a paginação personalizada.</span><span class="sxs-lookup"><span data-stu-id="b6497-389">While custom paging improves upon default paging s performance issues by retrieving only those records that need to be displayed, it s more involved to implement custom paging.</span></span> <span data-ttu-id="b6497-390">Primeiro, uma consulta deve ser escrita de forma correta (e eficiente) acessa o subconjunto específico de registros solicitados.</span><span class="sxs-lookup"><span data-stu-id="b6497-390">First, a query must be written that correctly (and efficiently) accesses the specific subset of records requested.</span></span> <span data-ttu-id="b6497-391">Isso pode ser feito de várias maneiras; o que examinamos neste tutorial é usar SQL Server nova função de 2005 s `ROW_NUMBER()` para classificar os resultados e, em seguida, retornar apenas os resultados cuja classificação esteja dentro de um intervalo especificado.</span><span class="sxs-lookup"><span data-stu-id="b6497-391">This can be accomplished in a number of ways; the one we examined in this tutorial is to use SQL Server 2005 s new `ROW_NUMBER()` function to rank results, and then to return just those results whose ranking falls within a specified range.</span></span> <span data-ttu-id="b6497-392">Além disso, precisamos adicionar um meio para determinar o número total de registros sendo paginados.</span><span class="sxs-lookup"><span data-stu-id="b6497-392">Furthermore, we need to add a means to determine the total number of records being paged through.</span></span> <span data-ttu-id="b6497-393">Depois de criar esses métodos DAL e BLL, também precisamos configurar o ObjectDataSource para que ele possa determinar quantos registros totais estão sendo paginados e pode passar corretamente os valores de índice de linha inicial e máximo de linhas para a BLL.</span><span class="sxs-lookup"><span data-stu-id="b6497-393">After creating these DAL and BLL methods, we also need to configure the ObjectDataSource so that it can determine how many total records are being paged through and can correctly pass the Start Row Index and Maximum Rows values to the BLL.</span></span>

<span data-ttu-id="b6497-394">Embora a implementação de paginação personalizada exija várias etapas e não seja tão simples quanto a paginação padrão, a paginação personalizada é uma necessidade durante a paginação por quantidades de dados suficientemente grandes.</span><span class="sxs-lookup"><span data-stu-id="b6497-394">While implementing custom paging does require a number of steps and is not nearly as simple as default paging, custom paging is a necessity when paging through sufficiently large amounts of data.</span></span> <span data-ttu-id="b6497-395">À medida que os resultados são examinados, a paginação personalizada pode lançar segundos fora do tempo de renderização da página ASP.NET e pode clarear a carga no servidor de banco de dados por uma ou mais ordens de magnitude.</span><span class="sxs-lookup"><span data-stu-id="b6497-395">As the results examined showed, custom paging can shed seconds off of the ASP.NET page render time and can lighten the load on the database server by one ore more orders of magnitude.</span></span>

<span data-ttu-id="b6497-396">Boa programação!</span><span class="sxs-lookup"><span data-stu-id="b6497-396">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="b6497-397">Sobre o autor</span><span class="sxs-lookup"><span data-stu-id="b6497-397">About the Author</span></span>

<span data-ttu-id="b6497-398">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor de sete livros sobre ASP/ASP. net e fundador da [4guysfromrolla.com](http://www.4guysfromrolla.com), tem trabalhado com tecnologias Web da Microsoft desde 1998.</span><span class="sxs-lookup"><span data-stu-id="b6497-398">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="b6497-399">Scott trabalha como consultor, instrutor e escritor independentes.</span><span class="sxs-lookup"><span data-stu-id="b6497-399">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="b6497-400">Seu livro mais recente é que a [*Sams ensina a ASP.NET 2,0 em 24 horas*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="b6497-400">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="b6497-401">Ele pode ser acessado em [ mitchell@4GuysFromRolla.com .](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="b6497-401">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="b6497-402">ou por meio de seu blog, que pode ser encontrado em [http://ScottOnWriting.NET](http://ScottOnWriting.NET) .</span><span class="sxs-lookup"><span data-stu-id="b6497-402">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="b6497-403">[Anterior](paging-and-sorting-report-data-cs.md) 
>  [Avançar](sorting-custom-paged-data-cs.md)</span><span class="sxs-lookup"><span data-stu-id="b6497-403">[Previous](paging-and-sorting-report-data-cs.md)
[Next](sorting-custom-paged-data-cs.md)</span></span>
