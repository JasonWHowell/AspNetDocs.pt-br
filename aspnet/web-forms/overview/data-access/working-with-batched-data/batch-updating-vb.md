---
uid: web-forms/overview/data-access/working-with-batched-data/batch-updating-vb
title: Atualização do lote (VB) | Microsoft Docs
author: rick-anderson
description: Saiba como atualizar vários registros de banco de dados em uma única operação. Na camada da interface do usuário, criamos um GridView em que cada linha é editável. Nos dados...
ms.author: riande
ms.date: 06/26/2007
ms.assetid: d191a204-d7ea-458d-b81c-0b9049ecb55f
msc.legacyurl: /web-forms/overview/data-access/working-with-batched-data/batch-updating-vb
msc.type: authoredcontent
ms.openlocfilehash: f0bb83b17585876dd6d28a5893a223cce15da31d
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/28/2019
ms.locfileid: "74591073"
---
# <a name="batch-updating-vb"></a><span data-ttu-id="1ab3a-105">Atualização em lote (VB)</span><span class="sxs-lookup"><span data-stu-id="1ab3a-105">Batch Updating (VB)</span></span>

<span data-ttu-id="1ab3a-106">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="1ab3a-106">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="1ab3a-107">[Baixar código](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_64_VB.zip) ou [baixar PDF](batch-updating-vb/_static/datatutorial64vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="1ab3a-107">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_64_VB.zip) or [Download PDF](batch-updating-vb/_static/datatutorial64vb1.pdf)</span></span>

> <span data-ttu-id="1ab3a-108">Saiba como atualizar vários registros de banco de dados em uma única operação.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-108">Learn how to update multiple database records in a single operation.</span></span> <span data-ttu-id="1ab3a-109">Na camada da interface do usuário, criamos um GridView em que cada linha é editável.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-109">In the User Interface Layer we build a GridView where each row is editable.</span></span> <span data-ttu-id="1ab3a-110">Na camada de acesso a dados, Encapsulamos as várias operações de atualização em uma transação para garantir que todas as atualizações tenham sucesso ou todas as atualizações sejam revertidas.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-110">In the Data Access Layer we wrap the multiple Update operations within a transaction to ensure that all updates succeed or all updates are rolled back.</span></span>

## <a name="introduction"></a><span data-ttu-id="1ab3a-111">Introdução</span><span class="sxs-lookup"><span data-stu-id="1ab3a-111">Introduction</span></span>

<span data-ttu-id="1ab3a-112">No [tutorial anterior](wrapping-database-modifications-within-a-transaction-vb.md) , vimos como estender a camada de acesso a dados para adicionar suporte para transações de banco de dado.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-112">In the [preceding tutorial](wrapping-database-modifications-within-a-transaction-vb.md) we saw how to extend the Data Access Layer to add support for database transactions.</span></span> <span data-ttu-id="1ab3a-113">As transações de banco de dados garantem que uma série de instruções de modificação de dado será tratada como uma operação atômica, o que garante que todas as modificações falhem ou todas tenham êxito.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-113">Database transactions guarantee that a series of data modification statements will be treated as one atomic operation, which ensures that all modifications will fail or all will succeed.</span></span> <span data-ttu-id="1ab3a-114">Com essa funcionalidade de nível inferior da DAL, estamos prontos para transformar nossa atenção em criar interfaces de modificação de dados em lotes.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-114">With this low-level DAL functionality out of the way, we re ready to turn our attention to creating batch data modification interfaces.</span></span>

<span data-ttu-id="1ab3a-115">Neste tutorial, criaremos um GridView em que cada linha é editável (veja a Figura 1).</span><span class="sxs-lookup"><span data-stu-id="1ab3a-115">In this tutorial we'll build a GridView where each row is editable (see Figure 1).</span></span> <span data-ttu-id="1ab3a-116">Como cada linha é renderizada em sua interface de edição, não há necessidade de uma coluna de botões editar, atualizar e cancelar.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-116">Since each row is rendered in its editing interface, there s no need for a column of Edit, Update, and Cancel buttons.</span></span> <span data-ttu-id="1ab3a-117">Em vez disso, há dois botões de produtos de atualização na página que, quando clicados, enumeram as linhas GridView e atualizam o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-117">Instead, there are two Update Products buttons on the page that, when clicked, enumerate the GridView rows and update the database.</span></span>

<span data-ttu-id="1ab3a-118">[![cada linha em GridView é editável](batch-updating-vb/_static/image1.gif)](batch-updating-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="1ab3a-118">[![Each Row in the GridView is Editable](batch-updating-vb/_static/image1.gif)](batch-updating-vb/_static/image1.png)</span></span>

<span data-ttu-id="1ab3a-119">**Figura 1**: cada linha no GridView é editável ([clique para exibir a imagem em tamanho normal](batch-updating-vb/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="1ab3a-119">**Figure 1**: Each Row in the GridView is Editable ([Click to view full-size image](batch-updating-vb/_static/image2.png))</span></span>

<span data-ttu-id="1ab3a-120">Vamos começar!</span><span class="sxs-lookup"><span data-stu-id="1ab3a-120">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="1ab3a-121">No tutorial [executando atualizações em lote](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb.md) , criamos uma interface de edição em lote usando o controle DataList.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-121">In the [Performing Batch Updates](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb.md) tutorial we created a batch editing interface using the DataList control.</span></span> <span data-ttu-id="1ab3a-122">Este tutorial é diferente do anterior no que usa um GridView e a atualização do lote é executada dentro do escopo de uma transação.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-122">This tutorial differs from the previous one in that is uses a GridView and the batch update is performed within the scope of a transaction.</span></span> <span data-ttu-id="1ab3a-123">Depois de concluir este tutorial, recomendo que você retorne ao tutorial anterior e atualize-o para usar a funcionalidade relacionada à transação do banco de dados adicionada no tutorial anterior.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-123">After completing this tutorial I encourage you to return to the earlier tutorial and update it to use the database transaction-related functionality added in the preceding tutorial.</span></span>

## <a name="examining-the-steps-for-making-all-gridview-rows-editable"></a><span data-ttu-id="1ab3a-124">Examinando as etapas para tornar todas as linhas GridView editáveis</span><span class="sxs-lookup"><span data-stu-id="1ab3a-124">Examining the Steps for Making All GridView Rows Editable</span></span>

<span data-ttu-id="1ab3a-125">Conforme discutido em [uma visão geral do tutorial inserir, atualizar e excluir dados](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md) , o GridView oferece suporte interno para a edição de seus dados subjacentes em uma base por linha.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-125">As discussed in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md) tutorial, the GridView offers built-in support for editing its underlying data on a per-row basis.</span></span> <span data-ttu-id="1ab3a-126">Internamente, o GridView observa qual linha é editável por meio de sua [propriedade`EditIndex`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.editindex(VS.80).aspx).</span><span class="sxs-lookup"><span data-stu-id="1ab3a-126">Internally, the GridView notes what row is editable through its [`EditIndex` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.editindex(VS.80).aspx).</span></span> <span data-ttu-id="1ab3a-127">Como o GridView está sendo associado à sua fonte de dados, ele verifica cada linha para ver se o índice da linha é igual ao valor de `EditIndex`.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-127">As the GridView is being bound to its data source, it checks each row to see if the index of the row equals the value of `EditIndex`.</span></span> <span data-ttu-id="1ab3a-128">Nesse caso, os campos da linha s são renderizados usando suas interfaces de edição.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-128">If so, that row s fields are rendered using their editing interfaces.</span></span> <span data-ttu-id="1ab3a-129">Para BoundFields, a interface de edição é uma caixa de texto cuja propriedade `Text` é atribuída ao valor do campo de dados especificado pela propriedade `DataField` BoundField s.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-129">For BoundFields, the editing interface is a TextBox whose `Text` property is assigned the value of the data field specified by the BoundField s `DataField` property.</span></span> <span data-ttu-id="1ab3a-130">Para TemplateFields, o `EditItemTemplate` é usado no lugar do `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-130">For TemplateFields, the `EditItemTemplate` is used in place of the `ItemTemplate`.</span></span>

<span data-ttu-id="1ab3a-131">Lembre-se de que o fluxo de trabalho de edição é iniciado quando um usuário clica em um botão de edição de linha.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-131">Recall that the editing workflow starts when a user clicks a row s Edit button.</span></span> <span data-ttu-id="1ab3a-132">Isso causa um postback, define a Propriedade GridView s `EditIndex` como o índice s de linha clicado e reassocia os dados à grade.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-132">This causes a postback, sets the GridView s `EditIndex` property to the clicked row s index, and rebinds the data to the grid.</span></span> <span data-ttu-id="1ab3a-133">Quando um botão de cancelamento de uma linha é clicado, no postback, o `EditIndex` é definido com um valor de `-1` antes de reassociar os dados à grade.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-133">When a row s Cancel button is clicked, on postback the `EditIndex` is set to a value of `-1` before rebinding the data to the grid.</span></span> <span data-ttu-id="1ab3a-134">Como as linhas de GridView começam a indexação em zero, definir `EditIndex` como `-1` tem o efeito de exibir o GridView no modo somente leitura.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-134">Since the GridView s rows start indexing at zero, setting `EditIndex` to `-1` has the effect of displaying the GridView in read-only mode.</span></span>

<span data-ttu-id="1ab3a-135">A propriedade `EditIndex` funciona bem para a edição por linha, mas não é projetada para edição em lotes.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-135">The `EditIndex` property works well for per-row editing, but is not designed for batch editing.</span></span> <span data-ttu-id="1ab3a-136">Para tornar todo o GridView editável, precisamos que cada linha seja renderizada usando sua interface de edição.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-136">To make the entire GridView editable, we need to have each row render using its editing interface.</span></span> <span data-ttu-id="1ab3a-137">A maneira mais fácil de fazer isso é criar onde cada campo editável é implementado como um TemplateField com sua interface de edição definida no `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-137">The easiest way to accomplish this is to create where each editable field is implemented as a TemplateField with its editing interface defined in the `ItemTemplate`.</span></span>

<span data-ttu-id="1ab3a-138">Nas próximas várias etapas, criaremos um GridView totalmente editável.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-138">Over the next several steps we'll create a completely editable GridView.</span></span> <span data-ttu-id="1ab3a-139">Na etapa 1, vamos começar criando o GridView e seu ObjectDataSource e converter seus BoundFields e CheckBoxField em TemplateFields.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-139">In Step 1 we'll start by creating the GridView and its ObjectDataSource and convert its BoundFields and CheckBoxField into TemplateFields.</span></span> <span data-ttu-id="1ab3a-140">Nas etapas 2 e 3, moveremos as interfaces de edição do TemplateFields `EditItemTemplate` s para suas `ItemTemplate` s.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-140">In Steps 2 and 3 we'll move the editing interfaces from the TemplateFields `EditItemTemplate` s to their `ItemTemplate` s.</span></span>

## <a name="step-1-displaying-product-information"></a><span data-ttu-id="1ab3a-141">Etapa 1: exibindo informações do produto</span><span class="sxs-lookup"><span data-stu-id="1ab3a-141">Step 1: Displaying Product Information</span></span>

<span data-ttu-id="1ab3a-142">Antes de nos preocuparmos em criar um GridView em que as linhas são editáveis, vamos começar simplesmente exibindo as informações do produto.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-142">Before we worry about creating a GridView where are rows are editable, let s start by simply displaying the product information.</span></span> <span data-ttu-id="1ab3a-143">Abra a página `BatchUpdate.aspx` na pasta `BatchData` e arraste um GridView da caixa de ferramentas para o designer.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-143">Open the `BatchUpdate.aspx` page in the `BatchData` folder and drag a GridView from the Toolbox onto the Designer.</span></span> <span data-ttu-id="1ab3a-144">Defina o `ID` s de GridView como `ProductsGrid` e, em sua marca inteligente, escolha associá-lo a um novo ObjectDataSource chamado `ProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-144">Set the GridView s `ID` to `ProductsGrid` and, from its smart tag, choose to bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="1ab3a-145">Configure o ObjectDataSource para recuperar seus dados do método de `GetProducts` da classe `ProductsBLL`.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-145">Configure the ObjectDataSource to retrieve its data from the `ProductsBLL` class s `GetProducts` method.</span></span>

<span data-ttu-id="1ab3a-146">[![configurar o ObjectDataSource para usar a classe ProductsBLL](batch-updating-vb/_static/image2.gif)](batch-updating-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="1ab3a-146">[![Configure the ObjectDataSource to Use the ProductsBLL Class](batch-updating-vb/_static/image2.gif)](batch-updating-vb/_static/image3.png)</span></span>

<span data-ttu-id="1ab3a-147">**Figura 2**: configurar o ObjectDataSource para usar a classe `ProductsBLL` ([clique para exibir a imagem em tamanho normal](batch-updating-vb/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="1ab3a-147">**Figure 2**: Configure the ObjectDataSource to Use the `ProductsBLL` Class ([Click to view full-size image](batch-updating-vb/_static/image4.png))</span></span>

<span data-ttu-id="1ab3a-148">[![recuperar os dados do produto usando o método GetProducts](batch-updating-vb/_static/image3.gif)](batch-updating-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="1ab3a-148">[![Retrieve the Product Data Using the GetProducts Method](batch-updating-vb/_static/image3.gif)](batch-updating-vb/_static/image5.png)</span></span>

<span data-ttu-id="1ab3a-149">**Figura 3**: recuperar os dados do produto usando o método `GetProducts` ([clique para exibir a imagem em tamanho normal](batch-updating-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="1ab3a-149">**Figure 3**: Retrieve the Product Data Using the `GetProducts` Method ([Click to view full-size image](batch-updating-vb/_static/image6.png))</span></span>

<span data-ttu-id="1ab3a-150">Como o GridView, os recursos de modificação do ObjectDataSource s são projetados para funcionar por linha.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-150">Like the GridView, the ObjectDataSource s modification features are designed to work on a per-row basis.</span></span> <span data-ttu-id="1ab3a-151">Para atualizar um conjunto de registros, precisaremos escrever um pouco de código na classe code-behind da página ASP.NET, que coloca os dados em lotes e os transmite para a BLL.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-151">In order to update a set of records, we'll need to write a bit of code in the ASP.NET page s code-behind class that batches the data and passes it to the BLL.</span></span> <span data-ttu-id="1ab3a-152">Portanto, defina as listas suspensas nas guias ObjectDataSource s UPDATE, INSERT e DELETE como (None).</span><span class="sxs-lookup"><span data-stu-id="1ab3a-152">Therefore, set the drop-down lists in the ObjectDataSource s UPDATE, INSERT, and DELETE tabs to (None).</span></span> <span data-ttu-id="1ab3a-153">Clique em Concluir para concluir o assistente.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-153">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="1ab3a-154">[![definir as listas suspensas nas guias atualizar, inserir e excluir para (nenhum)](batch-updating-vb/_static/image4.gif)](batch-updating-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="1ab3a-154">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](batch-updating-vb/_static/image4.gif)](batch-updating-vb/_static/image7.png)</span></span>

<span data-ttu-id="1ab3a-155">**Figura 4**: definir as listas suspensas nas guias atualizar, inserir e excluir para (nenhum) ([clique para exibir a imagem em tamanho normal](batch-updating-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="1ab3a-155">**Figure 4**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](batch-updating-vb/_static/image8.png))</span></span>

<span data-ttu-id="1ab3a-156">Depois de concluir o assistente para configurar fonte de dados, a marcação declarativa de ObjectDataSource s deve ser parecida com a seguinte:</span><span class="sxs-lookup"><span data-stu-id="1ab3a-156">After completing the Configure Data Source wizard, the ObjectDataSource s declarative markup should look like the following:</span></span>

[!code-aspx[Main](batch-updating-vb/samples/sample1.aspx)]

<span data-ttu-id="1ab3a-157">A conclusão do assistente para configurar fonte de dados também faz com que o Visual Studio crie BoundFields e um CheckBoxField para os campos de dados do produto no GridView.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-157">Completing the Configure Data Source wizard also causes Visual Studio to create BoundFields and a CheckBoxField for the product data fields in the GridView.</span></span> <span data-ttu-id="1ab3a-158">Para este tutorial, vamos permitir que apenas o usuário exiba e edite o nome, a categoria, o preço e o status descontinuados do produto.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-158">For this tutorial, let s only allow the user to view and edit the product s name, category, price, and discontinued status.</span></span> <span data-ttu-id="1ab3a-159">Remova todos os campos, exceto os `ProductName`, `CategoryName`, `UnitPrice`e `Discontinued` e renomeie as propriedades `HeaderText` dos três primeiros campos para produto, categoria e preço, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-159">Remove all but the `ProductName`, `CategoryName`, `UnitPrice`, and `Discontinued` fields and rename the `HeaderText` properties of the first three fields to Product, Category, and Price, respectively.</span></span> <span data-ttu-id="1ab3a-160">Por fim, marque as caixas de seleção habilitar paginação e Habilitar classificação na marca inteligente s do GridView.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-160">Lastly, check the Enable Paging and Enable Sorting checkboxes in the GridView s smart tag.</span></span>

<span data-ttu-id="1ab3a-161">Neste ponto, o GridView tem três BoundFields (`ProductName`, `CategoryName`e `UnitPrice`) e um CheckBoxField (`Discontinued`).</span><span class="sxs-lookup"><span data-stu-id="1ab3a-161">At this point the GridView has three BoundFields (`ProductName`, `CategoryName`, and `UnitPrice`) and a CheckBoxField (`Discontinued`).</span></span> <span data-ttu-id="1ab3a-162">Precisamos converter esses quatro campos em TemplateFields e, em seguida, mover a interface de edição do `EditItemTemplate` de modelos s para sua `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-162">We need to convert these four fields into TemplateFields and then move the editing interface from the TemplateField s `EditItemTemplate` to its `ItemTemplate`.</span></span>

> [!NOTE]
> <span data-ttu-id="1ab3a-163">Exploramos a criação e a personalização do TemplateFields no tutorial [Personalizando a interface de modificação de dados](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) .</span><span class="sxs-lookup"><span data-stu-id="1ab3a-163">We explored creating and customizing TemplateFields in the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) tutorial.</span></span> <span data-ttu-id="1ab3a-164">Vamos percorrer as etapas de conversão de BoundFields e CheckBoxField em TemplateFields e definir suas interfaces de edição em seus `ItemTemplate` s, mas se você ficar preso ou precisar de um atualizador, Don t hesitará em consultar este tutorial anterior.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-164">We'll walk through the steps of converting the BoundFields and CheckBoxField into TemplateFields and defining their editing interfaces in their `ItemTemplate` s, but if you get stuck or need a refresher, don t hesitate to refer back to this earlier tutorial.</span></span>

<span data-ttu-id="1ab3a-165">Na marca inteligente de GridView, clique no link Editar colunas para abrir a caixa de diálogo campos.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-165">From the GridView s smart tag, click the Edit Columns link to open the Fields dialog box.</span></span> <span data-ttu-id="1ab3a-166">Em seguida, selecione cada campo e clique no link converter este campo em um modelo.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-166">Next, select each field and click the Convert this field into a TemplateField link.</span></span>

![Converter os BoundFields e CheckBoxField existentes em TemplateFields](batch-updating-vb/_static/image5.gif)

<span data-ttu-id="1ab3a-168">**Figura 5**: converter os boundfields e CheckBoxField existentes em TemplateFields</span><span class="sxs-lookup"><span data-stu-id="1ab3a-168">**Figure 5**: Convert the Existing BoundFields and CheckBoxField Into TemplateFields</span></span>

<span data-ttu-id="1ab3a-169">Agora que cada campo é um TemplateField, estamos prontos para mover a interface de edição do `EditItemTemplate` s para o `ItemTemplate` s.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-169">Now that each field is a TemplateField, we re ready to move the editing interface from the `EditItemTemplate` s to the `ItemTemplate` s.</span></span>

## <a name="step-2-creating-theproductnameunitprice-anddiscontinuedediting-interfaces"></a><span data-ttu-id="1ab3a-170">Etapa 2: criando as interfaces de edição`ProductName`,`UnitPrice`e`Discontinued`</span><span class="sxs-lookup"><span data-stu-id="1ab3a-170">Step 2: Creating the`ProductName`,`UnitPrice`, and`Discontinued`Editing Interfaces</span></span>

<span data-ttu-id="1ab3a-171">A criação das interfaces de edição `ProductName`, `UnitPrice`e `Discontinued` é o tópico desta etapa e é bem simples, pois cada interface já está definida no `EditItemTemplate`de modelos.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-171">Creating the `ProductName`, `UnitPrice`, and `Discontinued` editing interfaces are the topic of this step and are pretty straightforward, as each interface is already defined in the TemplateField s `EditItemTemplate`.</span></span> <span data-ttu-id="1ab3a-172">Criar a interface de edição de `CategoryName` é um pouco mais envolvido, já que precisamos criar uma DropDownList das categorias aplicáveis.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-172">Creating the `CategoryName` editing interface is a bit more involved since we need to create a DropDownList of the applicable categories.</span></span> <span data-ttu-id="1ab3a-173">Esse `CategoryName` interface de edição é resolvido na etapa 3.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-173">This `CategoryName` editing interface is tackled in Step 3.</span></span>

<span data-ttu-id="1ab3a-174">Deixe que s comecem com o `ProductName` TemplateField.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-174">Let s start with the `ProductName` TemplateField.</span></span> <span data-ttu-id="1ab3a-175">Clique no link editar modelos na marca inteligente GridView s e faça uma busca detalhada até a `ProductName` TemplateField s `EditItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-175">Click on the Edit Templates link from the GridView s smart tag and drill down to the `ProductName` TemplateField s `EditItemTemplate`.</span></span> <span data-ttu-id="1ab3a-176">Selecione a caixa de texto, copie-a para a área de transferência e cole-a no `ProductName` TemplateField s `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-176">Select the TextBox, copy it to the clipboard, and then paste it to the `ProductName` TemplateField s `ItemTemplate`.</span></span> <span data-ttu-id="1ab3a-177">Altere a Propriedade TextBox s `ID` para `ProductName`.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-177">Change the TextBox s `ID` property to `ProductName`.</span></span>

<span data-ttu-id="1ab3a-178">Em seguida, adicione um RequiredFieldValidator ao `ItemTemplate` para garantir que o usuário forneça um valor para cada nome de produto.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-178">Next, add a RequiredFieldValidator to the `ItemTemplate` to ensure that the user provides a value for each product s name.</span></span> <span data-ttu-id="1ab3a-179">Defina a propriedade `ControlToValidate` como ProductName, a propriedade `ErrorMessage` para você deve fornecer o nome do produto.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-179">Set the `ControlToValidate` property to ProductName, the `ErrorMessage` property to You must provide the product's name.</span></span> <span data-ttu-id="1ab3a-180">e a propriedade `Text` como \*.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-180">and the `Text` property to \*.</span></span> <span data-ttu-id="1ab3a-181">Depois de fazer essas adições ao `ItemTemplate`, sua tela deve ser semelhante à figura 6.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-181">After making these additions to the `ItemTemplate`, your screen should look similar to Figure 6.</span></span>

<span data-ttu-id="1ab3a-182">[![o TemplateField do ProductName agora inclui uma caixa de texto e um RequiredFieldValidator](batch-updating-vb/_static/image6.gif)](batch-updating-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="1ab3a-182">[![The ProductName TemplateField Now Includes a TextBox and a RequiredFieldValidator](batch-updating-vb/_static/image6.gif)](batch-updating-vb/_static/image9.png)</span></span>

<span data-ttu-id="1ab3a-183">**Figura 6**: o `ProductName` TemplateField agora inclui uma caixa de texto e um RequiredFieldValidator ([clique para exibir a imagem em tamanho normal](batch-updating-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="1ab3a-183">**Figure 6**: The `ProductName` TemplateField Now Includes a TextBox and a RequiredFieldValidator ([Click to view full-size image](batch-updating-vb/_static/image10.png))</span></span>

<span data-ttu-id="1ab3a-184">Para a interface de edição de `UnitPrice`, comece copiando a caixa de texto da `EditItemTemplate` para a `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-184">For the `UnitPrice` editing interface, start by copying the TextBox from the `EditItemTemplate` to the `ItemTemplate`.</span></span> <span data-ttu-id="1ab3a-185">Em seguida, coloque um $ na frente da caixa de texto e defina sua propriedade `ID` como UnitPrice e sua propriedade `Columns` como 8.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-185">Next, place a $ in front of the TextBox and set its `ID` property to UnitPrice and its `Columns` property to 8 .</span></span>

<span data-ttu-id="1ab3a-186">Além disso, adicione um CompareValidator à `UnitPrice` s `ItemTemplate` para garantir que o valor inserido pelo usuário seja um valor de moeda válido maior ou igual a $0.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-186">Also add a CompareValidator to the `UnitPrice` s `ItemTemplate` to ensure that the value entered by the user is a valid currency value greater than or equal to $0.00.</span></span> <span data-ttu-id="1ab3a-187">Defina a propriedade `ControlToValidate` do validador como PreçoUnitário, sua propriedade `ErrorMessage` para você deve inserir um valor de moeda válido.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-187">Set the validator s `ControlToValidate` property to UnitPrice, its `ErrorMessage` property to You must enter a valid currency value.</span></span> <span data-ttu-id="1ab3a-188">Omita todos os símbolos de moeda., sua propriedade `Text` para \*, sua propriedade `Type` como `Currency`, sua propriedade `Operator` como `GreaterThanEqual`e sua propriedade `ValueToCompare` como 0.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-188">Please omit any currency symbols., its `Text` property to \*, its `Type` property to `Currency`, its `Operator` property to `GreaterThanEqual`, and its `ValueToCompare` property to 0 .</span></span>

<span data-ttu-id="1ab3a-189">[![adicionar um CompareValidator para garantir que o preço inserido é um valor de moeda não negativo](batch-updating-vb/_static/image7.gif)](batch-updating-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="1ab3a-189">[![Add a CompareValidator to Ensure the Price Entered is a Non-Negative Currency Value](batch-updating-vb/_static/image7.gif)](batch-updating-vb/_static/image11.png)</span></span>

<span data-ttu-id="1ab3a-190">**Figura 7**: adicionar um CompareValidator para garantir que o preço inserido é um valor de moeda não negativo ([clique para exibir a imagem em tamanho normal](batch-updating-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="1ab3a-190">**Figure 7**: Add a CompareValidator to Ensure the Price Entered is a Non-Negative Currency Value ([Click to view full-size image](batch-updating-vb/_static/image12.png))</span></span>

<span data-ttu-id="1ab3a-191">Para o `Discontinued` TemplateField, você pode usar a caixa de seleção já definida no `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-191">For the `Discontinued` TemplateField you can use the CheckBox already defined in the `ItemTemplate`.</span></span> <span data-ttu-id="1ab3a-192">Basta definir seu `ID` como descontinuado e sua propriedade `Enabled` como `True`.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-192">Simply set its `ID` to Discontinued and its `Enabled` property to `True`.</span></span>

## <a name="step-3-creating-thecategorynameediting-interface"></a><span data-ttu-id="1ab3a-193">Etapa 3: criando a interface de edição de`CategoryName`</span><span class="sxs-lookup"><span data-stu-id="1ab3a-193">Step 3: Creating the`CategoryName`Editing Interface</span></span>

<span data-ttu-id="1ab3a-194">A interface de edição no `CategoryName` TemplateField s `EditItemTemplate` contém uma caixa de texto que exibe o valor do campo de dados `CategoryName`.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-194">The editing interface in the `CategoryName` TemplateField s `EditItemTemplate` contains a TextBox that displays the value of the `CategoryName` data field.</span></span> <span data-ttu-id="1ab3a-195">Precisamos substituir isso por uma DropDownList que liste as categorias possíveis.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-195">We need to replace this with a DropDownList that lists the possible categories.</span></span>

> [!NOTE]
> <span data-ttu-id="1ab3a-196">O tutorial [Personalizando a interface de modificação de dados](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) contém uma discussão mais completa e completa sobre como personalizar um modelo para incluir uma DropDownList em oposição a uma caixa de texto.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-196">The [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) tutorial contains a more thorough and complete discussion on customizing a template to include a DropDownList as opposed to a TextBox.</span></span> <span data-ttu-id="1ab3a-197">Embora as etapas aqui sejam concluídas, elas são apresentadas tersely.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-197">While the steps here are complete, they are presented tersely.</span></span> <span data-ttu-id="1ab3a-198">Para obter uma visão mais detalhada sobre como criar e configurar as categorias DropDownList, consulte o tutorial [Personalizando a interface de modificação de dados](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) .</span><span class="sxs-lookup"><span data-stu-id="1ab3a-198">For a more in-depth look at creating and configuring the categories DropDownList, refer back to the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) tutorial.</span></span>

<span data-ttu-id="1ab3a-199">Arraste uma DropDownList da caixa de ferramentas até a `CategoryName` TemplateField s `ItemTemplate`, definindo sua `ID` como `Categories`.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-199">Drag a DropDownList from the Toolbox onto the `CategoryName` TemplateField s `ItemTemplate`, setting its `ID` to `Categories`.</span></span> <span data-ttu-id="1ab3a-200">Neste ponto, normalmente definimos a fonte de dados DropDownLists s por meio de sua marca inteligente, criando um novo ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-200">At this point we would usually define the DropDownLists s data source through its smart tag, creating a new ObjectDataSource.</span></span> <span data-ttu-id="1ab3a-201">No entanto, isso adicionará o ObjectDataSource no `ItemTemplate`, o que resultará em uma instância de ObjectDataSource criada para cada linha GridView.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-201">However, this will add the ObjectDataSource within the `ItemTemplate`, which will result in an ObjectDataSource instance created for each GridView row.</span></span> <span data-ttu-id="1ab3a-202">Em vez disso, vamos criar o ObjectDataSource fora do TemplateFields GridView.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-202">Instead, let s create the ObjectDataSource outside of the GridView s TemplateFields.</span></span> <span data-ttu-id="1ab3a-203">Finalize a edição do modelo e arraste um ObjectDataSource da caixa de ferramentas para o designer sob o `ProductsDataSource` ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-203">End the template editing and drag an ObjectDataSource from the Toolbox onto the Designer beneath the `ProductsDataSource` ObjectDataSource.</span></span> <span data-ttu-id="1ab3a-204">Nomeie o novo ObjectDataSource `CategoriesDataSource` e configure-o para usar o método `CategoriesBLL` Class s `GetCategories`.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-204">Name the new ObjectDataSource `CategoriesDataSource` and configure it to use the `CategoriesBLL` class s `GetCategories` method.</span></span>

<span data-ttu-id="1ab3a-205">[![configurar o ObjectDataSource para usar a classe CategoriesBLL](batch-updating-vb/_static/image8.gif)](batch-updating-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="1ab3a-205">[![Configure the ObjectDataSource to Use the CategoriesBLL Class](batch-updating-vb/_static/image8.gif)](batch-updating-vb/_static/image13.png)</span></span>

<span data-ttu-id="1ab3a-206">**Figura 8**: configurar o ObjectDataSource para usar a classe `CategoriesBLL` ([clique para exibir a imagem em tamanho normal](batch-updating-vb/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="1ab3a-206">**Figure 8**: Configure the ObjectDataSource to Use the `CategoriesBLL` Class ([Click to view full-size image](batch-updating-vb/_static/image14.png))</span></span>

<span data-ttu-id="1ab3a-207">[![recuperar os dados da categoria usando o método GetCategories](batch-updating-vb/_static/image9.gif)](batch-updating-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="1ab3a-207">[![Retrieve the Category Data Using the GetCategories Method](batch-updating-vb/_static/image9.gif)](batch-updating-vb/_static/image15.png)</span></span>

<span data-ttu-id="1ab3a-208">**Figura 9**: recuperar os dados da categoria usando o método `GetCategories` ([clique para exibir a imagem em tamanho normal](batch-updating-vb/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="1ab3a-208">**Figure 9**: Retrieve the Category Data Using the `GetCategories` Method ([Click to view full-size image](batch-updating-vb/_static/image16.png))</span></span>

<span data-ttu-id="1ab3a-209">Como esse ObjectDataSource é usado apenas para recuperar dados, defina as listas suspensas nas guias atualizar e excluir como (nenhum).</span><span class="sxs-lookup"><span data-stu-id="1ab3a-209">Since this ObjectDataSource is used merely to retrieve data, set the drop-down lists in the UPDATE and DELETE tabs to (None).</span></span> <span data-ttu-id="1ab3a-210">Clique em Concluir para concluir o assistente.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-210">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="1ab3a-211">[![definir as listas suspensas nas guias atualizar e excluir para (nenhum)](batch-updating-vb/_static/image10.gif)](batch-updating-vb/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="1ab3a-211">[![Set the Drop-Down Lists in the UPDATE and DELETE Tabs to (None)](batch-updating-vb/_static/image10.gif)](batch-updating-vb/_static/image17.png)</span></span>

<span data-ttu-id="1ab3a-212">**Figura 10**: definir as listas suspensas nas guias atualizar e excluir para (nenhum) ([clique para exibir a imagem em tamanho normal](batch-updating-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="1ab3a-212">**Figure 10**: Set the Drop-Down Lists in the UPDATE and DELETE Tabs to (None) ([Click to view full-size image](batch-updating-vb/_static/image18.png))</span></span>

<span data-ttu-id="1ab3a-213">Depois de concluir o assistente, a marcação declarativa de `CategoriesDataSource` s deve ser parecida com a seguinte:</span><span class="sxs-lookup"><span data-stu-id="1ab3a-213">After completing the wizard, the `CategoriesDataSource` s declarative markup should look like the following:</span></span>

[!code-aspx[Main](batch-updating-vb/samples/sample2.aspx)]

<span data-ttu-id="1ab3a-214">Com a `CategoriesDataSource` criada e configurada, retorne ao `CategoryName` TemplateField s `ItemTemplate` e, na marca inteligente DropDownList s, clique no link escolher fonte de dados.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-214">With the `CategoriesDataSource` created and configured, return to the `CategoryName` TemplateField s `ItemTemplate` and, from the DropDownList s smart tag, click on the Choose Data Source link.</span></span> <span data-ttu-id="1ab3a-215">No assistente de configuração da fonte de dados, selecione a opção `CategoriesDataSource` na primeira lista suspensa e escolha `CategoryName` usada para a exibição e `CategoryID` como o valor.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-215">In the Data Source Configuration wizard, select the `CategoriesDataSource` option from the first drop-down list and choose to have `CategoryName` used for the display and `CategoryID` as the value.</span></span>

<span data-ttu-id="1ab3a-216">[![associar a DropDownList ao CategoriesDataSource](batch-updating-vb/_static/image11.gif)](batch-updating-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="1ab3a-216">[![Bind the DropDownList to the CategoriesDataSource](batch-updating-vb/_static/image11.gif)](batch-updating-vb/_static/image19.png)</span></span>

<span data-ttu-id="1ab3a-217">**Figura 11**: associar o DropDownList ao `CategoriesDataSource` ([clique para exibir a imagem em tamanho normal](batch-updating-vb/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="1ab3a-217">**Figure 11**: Bind the DropDownList to the `CategoriesDataSource` ([Click to view full-size image](batch-updating-vb/_static/image20.png))</span></span>

<span data-ttu-id="1ab3a-218">Neste ponto, o `Categories` DropDownList lista todas as categorias, mas ela ainda não seleciona automaticamente a categoria apropriada para o produto associado à linha GridView.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-218">At this point the `Categories` DropDownList lists all of the categories, but it does not yet automatically select the appropriate category for the product bound to the GridView row.</span></span> <span data-ttu-id="1ab3a-219">Para fazer isso, precisamos definir o `Categories` DropDownList s `SelectedValue` ao valor de `CategoryID` do produto.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-219">To accomplish this we need to set the `Categories` DropDownList s `SelectedValue` to the product s `CategoryID` value.</span></span> <span data-ttu-id="1ab3a-220">Clique no link editar DataBindings da marca inteligente DropDownList s e associe a propriedade `SelectedValue` com o campo de dados `CategoryID`, como mostrado na Figura 12.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-220">Click on the Edit DataBindings link from the DropDownList s smart tag and associate the `SelectedValue` property with the `CategoryID` data field as shown in Figure 12.</span></span>

![Associar o valor de CategoryID do produto à propriedade SelectedValue da DropDownList](batch-updating-vb/_static/image12.gif)

<span data-ttu-id="1ab3a-222">**Figura 12**: associar o valor de `CategoryID` do produto à Propriedade DropDownList s `SelectedValue`</span><span class="sxs-lookup"><span data-stu-id="1ab3a-222">**Figure 12**: Bind the Product s `CategoryID` Value to the DropDownList s `SelectedValue` Property</span></span>

<span data-ttu-id="1ab3a-223">Um último problema permanece: se o produto não tiver um valor `CategoryID` especificado, a instrução DataBinding em `SelectedValue` resultará em uma exceção.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-223">One last problem remains: if the product doesn t have a `CategoryID` value specified then the databinding statement on `SelectedValue` will result in an exception.</span></span> <span data-ttu-id="1ab3a-224">Isso ocorre porque a DropDownList contém apenas itens para as categorias e não oferece uma opção para os produtos que têm um valor de banco de dados `NULL` para `CategoryID`.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-224">This is because the DropDownList contains only items for the categories and does not offer an option for those products that have a `NULL` database value for `CategoryID`.</span></span> <span data-ttu-id="1ab3a-225">Para corrigir isso, defina a Propriedade DropDownList s `AppendDataBoundItems` como `True` e adicione um novo item à DropDownList, omitindo a propriedade `Value` da sintaxe declarativa.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-225">To remedy this, set the DropDownList s `AppendDataBoundItems` property to `True` and add a new item to the DropDownList, omitting the `Value` property from the declarative syntax.</span></span> <span data-ttu-id="1ab3a-226">Ou seja, certifique-se de que a sintaxe declarativa `Categories` DropDownList s seja parecida com a seguinte:</span><span class="sxs-lookup"><span data-stu-id="1ab3a-226">That is, make sure that the `Categories` DropDownList s declarative syntax looks like the following:</span></span>

[!code-aspx[Main](batch-updating-vb/samples/sample3.aspx)]

<span data-ttu-id="1ab3a-227">Observe como o `<asp:ListItem Value="">`--Select One--tem seu atributo `Value` definido explicitamente como uma cadeia de caracteres vazia.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-227">Note how the `<asp:ListItem Value="">` -- Select One -- has its `Value` attribute explicitly set to an empty string.</span></span> <span data-ttu-id="1ab3a-228">Consulte o tutorial [Personalizando a interface de modificação de dados](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) para obter uma discussão mais completa sobre por que esse item DropDownList adicional é necessário para lidar com o `NULL` caso e por que a atribuição da propriedade `Value` a uma cadeia de caracteres vazia é essencial.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-228">Refer back to the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) tutorial for a more thorough discussion on why this additional DropDownList item is needed to handle the `NULL` case and why assignment of the `Value` property to an empty string is essential.</span></span>

> [!NOTE]
> <span data-ttu-id="1ab3a-229">Há um problema potencial de desempenho e escalabilidade aqui que vale a pena mencionar.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-229">There is a potential performance and scalability issue here that is worth mentioning.</span></span> <span data-ttu-id="1ab3a-230">Como cada linha tem uma DropDownList que usa o `CategoriesDataSource` como sua fonte de dados, a classe `CategoriesBLL` s `GetCategories` método será chamada *n* vezes por página de visita, em que *n* é o número de linhas no GridView.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-230">Since each row has a DropDownList that uses the `CategoriesDataSource` as its data source, the `CategoriesBLL` class s `GetCategories` method will be called *n* times per page visit, where *n* is the number of rows in the GridView.</span></span> <span data-ttu-id="1ab3a-231">Essas *n* chamadas para `GetCategories` resultam em consultas *n* para o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-231">These *n* calls to `GetCategories` result in *n* queries to the database.</span></span> <span data-ttu-id="1ab3a-232">Esse impacto no banco de dados pode ser diminuído armazenando em cache as categorias retornadas em um cache por solicitação ou por meio da camada de cache usando uma dependência de cache do SQL ou uma expiração muito curta baseada em tempo.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-232">This impact on the database could be lessened by caching the returned categories either in a per-request cache or through the Caching Layer using a SQL caching dependency or a very short time-based expiry.</span></span> <span data-ttu-id="1ab3a-233">Para obter mais informações sobre a opção de cache por solicitação, consulte [`HttpContext.Items` um repositório de cache por solicitação](http://aspnet.4guysfromrolla.com/articles/060904-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="1ab3a-233">For more information on the per-request caching option, see [`HttpContext.Items` a Per-Request Cache Store](http://aspnet.4guysfromrolla.com/articles/060904-1.aspx).</span></span>

## <a name="step-4-completing-the-editing-interface"></a><span data-ttu-id="1ab3a-234">Etapa 4: concluindo a interface de edição</span><span class="sxs-lookup"><span data-stu-id="1ab3a-234">Step 4: Completing the Editing Interface</span></span>

<span data-ttu-id="1ab3a-235">Fizemos várias alterações nos modelos GridView s sem pausar para exibir nosso progresso.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-235">We ve made a number of changes to the GridView s templates without pausing to view our progress.</span></span> <span data-ttu-id="1ab3a-236">Reserve um tempo para exibir nosso progresso por meio de um navegador.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-236">Take a moment to view our progress through a browser.</span></span> <span data-ttu-id="1ab3a-237">Como a Figura 13 mostra, cada linha é renderizada usando seu `ItemTemplate`, que contém a interface de edição da célula.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-237">As Figure 13 shows, each row is rendered using its `ItemTemplate`, which contains the cell s editing interface.</span></span>

<span data-ttu-id="1ab3a-238">[![cada linha GridView é editável](batch-updating-vb/_static/image13.gif)](batch-updating-vb/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="1ab3a-238">[![Each GridView Row is Editable](batch-updating-vb/_static/image13.gif)](batch-updating-vb/_static/image21.png)</span></span>

<span data-ttu-id="1ab3a-239">**Figura 13**: cada linha GridView é editável ([clique para exibir a imagem em tamanho normal](batch-updating-vb/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="1ab3a-239">**Figure 13**: Each GridView Row is Editable ([Click to view full-size image](batch-updating-vb/_static/image22.png))</span></span>

<span data-ttu-id="1ab3a-240">Há alguns problemas de formatação menores que devemos cuidar deste ponto.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-240">There are a few minor formatting issues that we should take care of at this point.</span></span> <span data-ttu-id="1ab3a-241">Primeiro, observe que o valor de `UnitPrice` contém quatro pontos decimais.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-241">First, note that the `UnitPrice` value contains four decimal points.</span></span> <span data-ttu-id="1ab3a-242">Para corrigir isso, retorne ao `UnitPrice` TemplateField s `ItemTemplate` e, na marca inteligente s da caixa de texto, clique no link editar DataBindings.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-242">To fix this, return to the `UnitPrice` TemplateField s `ItemTemplate` and, from the TextBox s smart tag, click on the Edit DataBindings link.</span></span> <span data-ttu-id="1ab3a-243">Em seguida, especifique que a propriedade `Text` deve ser formatada como um número.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-243">Next, specify that the `Text` property should be formatted as a number.</span></span>

![Formatar a propriedade de texto como um número](batch-updating-vb/_static/image14.gif)

<span data-ttu-id="1ab3a-245">**Figura 14**: Formatar a propriedade `Text` como um número</span><span class="sxs-lookup"><span data-stu-id="1ab3a-245">**Figure 14**: Format the `Text` Property as a Number</span></span>

<span data-ttu-id="1ab3a-246">Em segundo lugar, deixe o s centralizar a caixa de seleção na coluna `Discontinued` (em vez de tê-la alinhada à esquerda).</span><span class="sxs-lookup"><span data-stu-id="1ab3a-246">Second, let s center the checkbox in the `Discontinued` column (rather than having it left-aligned).</span></span> <span data-ttu-id="1ab3a-247">Clique em Editar colunas na marca inteligente s de GridView e selecione o `Discontinued` TemplateField na lista de campos no canto inferior esquerdo.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-247">Click on Edit Columns from the GridView s smart tag and select the `Discontinued` TemplateField from the list of fields in the bottom left corner.</span></span> <span data-ttu-id="1ab3a-248">Faça uma busca detalhada em `ItemStyle` e defina a propriedade `HorizontalAlign` como centralizar, conforme mostrado na Figura 15.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-248">Drill down into `ItemStyle` and set the `HorizontalAlign` property to Center as shown in Figure 15.</span></span>

![Centralizar a caixa de seleção descontinuada](batch-updating-vb/_static/image15.gif)

<span data-ttu-id="1ab3a-250">**Figura 15**: centralizar a caixa de seleção de `Discontinued`</span><span class="sxs-lookup"><span data-stu-id="1ab3a-250">**Figure 15**: Center the `Discontinued` CheckBox</span></span>

<span data-ttu-id="1ab3a-251">Em seguida, adicione um controle ValidationSummary à página e defina sua propriedade `ShowMessageBox` como `True` e sua propriedade `ShowSummary` como `False`.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-251">Next, add a ValidationSummary control to the page and set its `ShowMessageBox` property to `True` and its `ShowSummary` property to `False`.</span></span> <span data-ttu-id="1ab3a-252">Além disso, adicione o botão controles da Web que, quando clicado, atualizará as alterações do usuário.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-252">Also add the Button Web controls that, when clicked, will update the user s changes.</span></span> <span data-ttu-id="1ab3a-253">Especificamente, adicione dois controles de botão da Web, um acima do GridView e um abaixo dele, definindo ambos os controles `Text` Propriedades para atualizar produtos.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-253">Specifically, add two Button Web controls, one above the GridView and one below it, setting both controls `Text` properties to Update Products .</span></span>

<span data-ttu-id="1ab3a-254">Como a interface de edição de GridView está definida em seu TemplateFields `ItemTemplate` s, as `EditItemTemplate` s são supérfluas e podem ser excluídas.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-254">Since the GridView s editing interface is defined in its TemplateFields `ItemTemplate` s, the `EditItemTemplate` s are superfluous and may be deleted.</span></span>

<span data-ttu-id="1ab3a-255">Depois de fazer as alterações de formatação mencionadas acima, adicionar os controles de botão e remover as `EditItemTemplate` s desnecessárias, a sintaxe declarativa de s de página deverá ser parecida com a seguinte:</span><span class="sxs-lookup"><span data-stu-id="1ab3a-255">After making the above mentioned formatting changes, adding the Button controls, and removing the unnecessary `EditItemTemplate` s, your page s declarative syntax should look like the following:</span></span>

[!code-aspx[Main](batch-updating-vb/samples/sample4.aspx)]

<span data-ttu-id="1ab3a-256">A Figura 16 mostra essa página quando exibida por meio de um navegador depois que os controles da Web do botão são adicionados e as alterações de formatação feitas.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-256">Figure 16 shows this page when viewed through a browser after the Button Web controls have been added and the formatting changes made.</span></span>

<span data-ttu-id="1ab3a-257">[![a página agora inclui dois botões atualizar produtos](batch-updating-vb/_static/image16.gif)](batch-updating-vb/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="1ab3a-257">[![The Page Now Includes Two Update Products Buttons](batch-updating-vb/_static/image16.gif)](batch-updating-vb/_static/image23.png)</span></span>

<span data-ttu-id="1ab3a-258">**Figura 16**: a página agora inclui dois botões de produtos de atualização ([clique para exibir a imagem em tamanho normal](batch-updating-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="1ab3a-258">**Figure 16**: The Page Now Includes Two Update Products Buttons ([Click to view full-size image](batch-updating-vb/_static/image24.png))</span></span>

## <a name="step-5-updating-the-products"></a><span data-ttu-id="1ab3a-259">Etapa 5: atualizando os produtos</span><span class="sxs-lookup"><span data-stu-id="1ab3a-259">Step 5: Updating the Products</span></span>

<span data-ttu-id="1ab3a-260">Quando um usuário visitar essa página, ele fará suas modificações e, em seguida, clicará em um dos dois botões atualizar produtos.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-260">When a user visits this page they will make their modifications and then click one of the two Update Products buttons.</span></span> <span data-ttu-id="1ab3a-261">Nesse ponto, precisamos, de alguma forma, salvar os valores inseridos pelo usuário para cada linha em uma `ProductsDataTable` instância e, em seguida, passá-lo para um método BLL que passará essa instância de `ProductsDataTable` para o método da DAL s `UpdateWithTransaction`.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-261">At that point we need to somehow save the user-entered values for each row into a `ProductsDataTable` instance and then pass that to a BLL method that will then pass that `ProductsDataTable` instance to the DAL s `UpdateWithTransaction` method.</span></span> <span data-ttu-id="1ab3a-262">O método `UpdateWithTransaction`, que criamos no [tutorial anterior](wrapping-database-modifications-within-a-transaction-vb.md), garante que o lote de alterações será atualizado como uma operação atômica.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-262">The `UpdateWithTransaction` method, which we created in the [preceding tutorial](wrapping-database-modifications-within-a-transaction-vb.md), ensures that the batch of changes will be updated as an atomic operation.</span></span>

<span data-ttu-id="1ab3a-263">Crie um método chamado `BatchUpdate` em `BatchUpdate.aspx.vb` e adicione o seguinte código:</span><span class="sxs-lookup"><span data-stu-id="1ab3a-263">Create a method named `BatchUpdate` in `BatchUpdate.aspx.vb` and add the following code:</span></span>

[!code-vb[Main](batch-updating-vb/samples/sample5.vb)]

<span data-ttu-id="1ab3a-264">Esse método começa obtendo todos os produtos em um `ProductsDataTable` por meio de uma chamada para o método de `GetProducts` de BLL.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-264">This method starts out by getting all of the products back in a `ProductsDataTable` via a call to the BLL s `GetProducts` method.</span></span> <span data-ttu-id="1ab3a-265">Em seguida, ele enumera a coleção `ProductGrid` GridView s [`Rows`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rows(VS.80).aspx).</span><span class="sxs-lookup"><span data-stu-id="1ab3a-265">It then enumerates the `ProductGrid` GridView s [`Rows` collection](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rows(VS.80).aspx).</span></span> <span data-ttu-id="1ab3a-266">A coleção de `Rows` contém uma [instância de`GridViewRow`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewrow.aspx) para cada linha exibida no GridView.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-266">The `Rows` collection contains a [`GridViewRow` instance](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewrow.aspx) for each row displayed in the GridView.</span></span> <span data-ttu-id="1ab3a-267">Como estamos mostrando no máximo dez linhas por página, a coleção GridView s `Rows` não terá mais de dez itens.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-267">Since we are showing at most ten rows per page, the GridView s `Rows` collection will have no more than ten items.</span></span>

<span data-ttu-id="1ab3a-268">Para cada linha, a `ProductID` é capturada da coleção de `DataKeys` e a `ProductsRow` apropriada é selecionada no `ProductsDataTable`.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-268">For each row the `ProductID` is grabbed from the `DataKeys` collection and the appropriate `ProductsRow` is selected from the `ProductsDataTable`.</span></span> <span data-ttu-id="1ab3a-269">Os quatro controles de entrada TemplateField são referenciados por meio de programação e seus valores atribuídos às propriedades da instância do `ProductsRow` s.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-269">The four TemplateField input controls are programmatically referenced and their values assigned to the `ProductsRow` instance s properties.</span></span> <span data-ttu-id="1ab3a-270">Depois de cada linha de GridView, os valores de s foram usados para atualizar o `ProductsDataTable`, os s passados para o método de `UpdateWithTransaction` de BLL que, como vimos no tutorial anterior, simplesmente chamam o método de `UpdateWithTransaction` DAL.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-270">After each GridView row s values have been used to update the `ProductsDataTable`, it s passed to the BLL s `UpdateWithTransaction` method which, as we saw in the preceding tutorial, simply calls down into the DAL s `UpdateWithTransaction` method.</span></span>

<span data-ttu-id="1ab3a-271">O algoritmo de atualização do lote usado para este tutorial atualiza cada linha no `ProductsDataTable` que corresponde a uma linha no GridView, independentemente de as informações do produto terem sido alteradas.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-271">The batch update algorithm used for this tutorial updates each row in the `ProductsDataTable` that corresponds to a row in the GridView, regardless of whether the product s information has been changed.</span></span> <span data-ttu-id="1ab3a-272">Embora essas atualizações cegas não sejam geralmente um problema de desempenho, elas podem levar a registros supérfluos se você reauditar as alterações na tabela do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-272">While such blind updates aren't usually a performance issue, they can lead to superfluous records if you re auditing changes to the database table.</span></span> <span data-ttu-id="1ab3a-273">De volta ao tutorial [executando atualizações em lote](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb.md) , exploramos uma interface de atualização do lote com o DataList e adicionei o código que só atualizaria os registros que foram realmente modificados pelo usuário.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-273">Back in the [Performing Batch Updates](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb.md) tutorial we explored a batch updating interface with the DataList and added code that would only update those records that were actually modified by the user.</span></span> <span data-ttu-id="1ab3a-274">Sinta-se à vontade para usar as técnicas da [execução de atualizações em lote](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb.md) para atualizar o código neste tutorial, se desejado.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-274">Feel free to use the techniques from [Performing Batch Updates](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb.md) to update the code in this tutorial, if desired.</span></span>

> [!NOTE]
> <span data-ttu-id="1ab3a-275">Ao associar a fonte de dados ao GridView por meio de sua marca inteligente, o Visual Studio atribui automaticamente os valores de chave primária da fonte de dados à Propriedade GridView s `DataKeyNames`.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-275">When binding the data source to the GridView through its smart tag, Visual Studio automatically assigns the data source s primary key value(s) to the GridView s `DataKeyNames` property.</span></span> <span data-ttu-id="1ab3a-276">Se você não tiver associado o ObjectDataSource ao GridView por meio da marca inteligente GridView s, conforme descrito na etapa 1, você precisará definir manualmente a Propriedade GridView `DataKeyNames` como ProductID para acessar o valor de `ProductID` para cada linha por meio da coleção de `DataKeys`.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-276">If you did not bind the ObjectDataSource to the GridView through the GridView s smart tag as outlined in Step 1, then you will need to manually set the GridView s `DataKeyNames` property to ProductID in order to access the `ProductID` value for each row through the `DataKeys` collection.</span></span>

<span data-ttu-id="1ab3a-277">O código usado em `BatchUpdate` é semelhante ao usado nos métodos de `UpdateProduct` de BLL. a principal diferença é que, nos métodos de `UpdateProduct`, apenas uma única instância de `ProductRow` é recuperada da arquitetura.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-277">The code used in `BatchUpdate` is similar to that used in the BLL s `UpdateProduct` methods, the main difference being that in the `UpdateProduct` methods only a single `ProductRow` instance is retrieved from the architecture.</span></span> <span data-ttu-id="1ab3a-278">O código que atribui as propriedades do `ProductRow` é o mesmo entre os métodos `UpdateProducts` e o código dentro do loop `For Each` no `BatchUpdate`, assim como o padrão geral.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-278">The code that assigns the properties of the `ProductRow` is the same between the `UpdateProducts` methods and the code within the `For Each` loop in `BatchUpdate`, as is the overall pattern.</span></span>

<span data-ttu-id="1ab3a-279">Para concluir este tutorial, precisamos ter o método `BatchUpdate` invocado quando um dos botões atualizar produtos for clicado.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-279">To complete this tutorial, we need to have the `BatchUpdate` method invoked when either of the Update Products buttons is clicked.</span></span> <span data-ttu-id="1ab3a-280">Crie manipuladores de eventos para os eventos de `Click` desses dois controles de botão e adicione o seguinte código nos manipuladores de eventos:</span><span class="sxs-lookup"><span data-stu-id="1ab3a-280">Create event handlers for the `Click` events of these two Button controls and add the following code in the event handlers:</span></span>

[!code-vb[Main](batch-updating-vb/samples/sample6.vb)]

<span data-ttu-id="1ab3a-281">Primeiro, é feita uma chamada para `BatchUpdate`.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-281">First a call is made to `BatchUpdate`.</span></span> <span data-ttu-id="1ab3a-282">Em seguida, a [propriedade`ClientScript`](https://msdn.microsoft.com/library/system.web.ui.page.clientscript(VS.80).aspx) é usada para injetar JavaScript que exibirá uma MessageBox que leia os produtos foram atualizados.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-282">Next, the [`ClientScript` property](https://msdn.microsoft.com/library/system.web.ui.page.clientscript(VS.80).aspx) is used to inject JavaScript that will display a messagebox that reads The products have been updated.</span></span>

<span data-ttu-id="1ab3a-283">Reserve um minuto para testar esse código.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-283">Take a minute to test out this code.</span></span> <span data-ttu-id="1ab3a-284">Visite `BatchUpdate.aspx` por meio de um navegador, edite um número de linhas e clique em um dos botões atualizar produtos.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-284">Visit `BatchUpdate.aspx` through a browser, edit a number of rows, and click one of the Update Products buttons.</span></span> <span data-ttu-id="1ab3a-285">Supondo que não haja erros de validação de entrada, você deverá ver uma MessageBox que leia os produtos foram atualizados.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-285">Assuming there are no input validation errors, you should see a messagebox that reads The products have been updated.</span></span> <span data-ttu-id="1ab3a-286">Para verificar a atomicidade da atualização, considere adicionar uma restrição de `CHECK` aleatória, como uma que despermita `UnitPrice` valores de 1234,56.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-286">To verify the atomicity of the update, consider adding a random `CHECK` constraint, like one that disallows `UnitPrice` values of 1234.56.</span></span> <span data-ttu-id="1ab3a-287">Em seguida, em `BatchUpdate.aspx`, edite um número de registros, certificando-se de definir um valor de `UnitPrice` do produto para o valor proibido (1234,56).</span><span class="sxs-lookup"><span data-stu-id="1ab3a-287">Then from `BatchUpdate.aspx`, edit a number of records, making sure to set one of the product s `UnitPrice` value to the forbidden value ( 1234.56 ).</span></span> <span data-ttu-id="1ab3a-288">Isso deve resultar em um erro ao clicar em atualizar produtos com as outras alterações durante essa operação de lote revertidas para seus valores originais.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-288">This should result in an error when clicking Update Products with the other changes during that batch operation rolled back to their original values.</span></span>

## <a name="an-alternativebatchupdatemethod"></a><span data-ttu-id="1ab3a-289">Um método de`BatchUpdate`alternativo</span><span class="sxs-lookup"><span data-stu-id="1ab3a-289">An Alternative`BatchUpdate`Method</span></span>

<span data-ttu-id="1ab3a-290">O método `BatchUpdate` que acabamos de examinar recupera *todos* os produtos do método de `GetProducts` BLL s e, em seguida, atualiza apenas os registros que aparecem no GridView.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-290">The `BatchUpdate` method we just examined retrieves *all* of the products from the BLL s `GetProducts` method and then updates just those records that appear in the GridView.</span></span> <span data-ttu-id="1ab3a-291">Essa abordagem é ideal se o GridView não usar paginação, mas, se isso ocorrer, pode haver centenas, milhares ou dezenas de milhares de produtos, mas apenas dez linhas no GridView.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-291">This approach is ideal if the GridView does not use paging, but if it does, there may be hundreds, thousands, or tens of thousands of products, but only ten rows in the GridView.</span></span> <span data-ttu-id="1ab3a-292">Nesse caso, obter todos os produtos do banco de dados apenas para modificar 10 deles é menor do que o ideal.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-292">In such a case, getting all of the products from the database only to modify 10 of them is less than ideal.</span></span>

<span data-ttu-id="1ab3a-293">Para esses tipos de situações, considere o uso do seguinte método `BatchUpdateAlternate` em vez disso:</span><span class="sxs-lookup"><span data-stu-id="1ab3a-293">For those types of situations, consider using the following `BatchUpdateAlternate` method instead:</span></span>

[!code-vb[Main](batch-updating-vb/samples/sample7.vb)]

<span data-ttu-id="1ab3a-294">`BatchMethodAlternate` começa criando um novo `ProductsDataTable` vazio chamado `products`.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-294">`BatchMethodAlternate` starts by creating a new empty `ProductsDataTable` named `products`.</span></span> <span data-ttu-id="1ab3a-295">Em seguida, ele percorre a coleção GridView s `Rows` e, para cada linha, obtém as informações específicas do produto usando o método de `GetProductByProductID(productID)` de BLL.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-295">It then steps through the GridView s `Rows` collection and for each row gets the particular product information using the BLL s `GetProductByProductID(productID)` method.</span></span> <span data-ttu-id="1ab3a-296">A instância do `ProductsRow` recuperada tem suas propriedades atualizadas da mesma maneira que `BatchUpdate`, mas depois de atualizar a linha, ela é importada para a `products` `ProductsDataTable` por meio do método DataTable s [`ImportRow(DataRow)`](https://msdn.microsoft.com/library/system.data.datatable.importrow(VS.80).aspx).</span><span class="sxs-lookup"><span data-stu-id="1ab3a-296">The retrieved `ProductsRow` instance has its properties updated in the same fashion as `BatchUpdate`, but after updating the row it is imported into the `products` `ProductsDataTable` via the DataTable s [`ImportRow(DataRow)` method](https://msdn.microsoft.com/library/system.data.datatable.importrow(VS.80).aspx).</span></span>

<span data-ttu-id="1ab3a-297">Após a conclusão do loop de `For Each`, `products` contém uma instância `ProductsRow` para cada linha no GridView.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-297">After the `For Each` loop completes, `products` contains one `ProductsRow` instance for each row in the GridView.</span></span> <span data-ttu-id="1ab3a-298">Uma vez que cada uma das instâncias de `ProductsRow` foram adicionadas ao `products` (em vez de atualizadas), se forem repassadas para o método `UpdateWithTransaction`, a `ProductsTableAdapter` tentará inserir cada um dos registros no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-298">Since each of the `ProductsRow` instances have been added to the `products` (instead of updated), if we blindly pass it to the `UpdateWithTransaction` method the `ProductsTableAdapter` will try to insert each of the records into the database.</span></span> <span data-ttu-id="1ab3a-299">Em vez disso, precisamos especificar que cada uma dessas linhas foi modificada (não adicionada).</span><span class="sxs-lookup"><span data-stu-id="1ab3a-299">Instead, we need to specify that each of these rows has been modified (not added).</span></span>

<span data-ttu-id="1ab3a-300">Isso pode ser feito adicionando um novo método à BLL chamado `UpdateProductsWithTransaction`.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-300">This can be accomplished by adding a new method to the BLL named `UpdateProductsWithTransaction`.</span></span> <span data-ttu-id="1ab3a-301">`UpdateProductsWithTransaction`, mostrado abaixo, define o `RowState` de cada uma das instâncias de `ProductsRow` no `ProductsDataTable` para `Modified` e, em seguida, passa o `ProductsDataTable` para o método da DAL s `UpdateWithTransaction`.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-301">`UpdateProductsWithTransaction`, shown below, sets the `RowState` of each of the `ProductsRow` instances in the `ProductsDataTable` to `Modified` and then passes the `ProductsDataTable` to the DAL s `UpdateWithTransaction` method.</span></span>

[!code-vb[Main](batch-updating-vb/samples/sample8.vb)]

## <a name="summary"></a><span data-ttu-id="1ab3a-302">Resumo</span><span class="sxs-lookup"><span data-stu-id="1ab3a-302">Summary</span></span>

<span data-ttu-id="1ab3a-303">O GridView fornece recursos internos de edição por linha, mas não tem suporte para a criação de interfaces totalmente editáveis.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-303">The GridView provides built-in per-row editing capabilities, but lacks support for creating fully editable interfaces.</span></span> <span data-ttu-id="1ab3a-304">Como vimos neste tutorial, essas interfaces são possíveis, mas exigem um pouco de trabalho.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-304">As we saw in this tutorial, such interfaces are possible, but require a bit of work.</span></span> <span data-ttu-id="1ab3a-305">Para criar um GridView em que cada linha é editável, precisamos converter os campos de GridView em TemplateFields e definir a interface de edição dentro do `ItemTemplate` s.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-305">To create a GridView where every row is editable, we need to convert the GridView s fields into TemplateFields and define the editing interface within the `ItemTemplate` s.</span></span> <span data-ttu-id="1ab3a-306">Além disso, os controles da Web do botão atualizar todos os tipos devem ser adicionados à página, separados do GridView.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-306">Additionally, Update All -type Button Web controls must be added to the page, separate from the GridView.</span></span> <span data-ttu-id="1ab3a-307">Esses botões `Click` manipuladores de eventos precisam enumerar a coleção GridView s `Rows`, armazenar as alterações em uma `ProductsDataTable`e passar as informações atualizadas para o método BLL apropriado.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-307">These Buttons `Click` event handlers need to enumerate the GridView s `Rows` collection, store the changes in a `ProductsDataTable`, and pass the updated information into the appropriate BLL method.</span></span>

<span data-ttu-id="1ab3a-308">No próximo tutorial, veremos como criar uma interface para exclusão em lote.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-308">In the next tutorial we'll see how to create an interface for batch deleting.</span></span> <span data-ttu-id="1ab3a-309">Em particular, cada linha GridView incluirá uma caixa de seleção e, em vez de atualizar os botões de todos os tipos, os botões excluir linhas selecionadas serão excluídos.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-309">In particular, each GridView row will include a checkbox and instead of Update All -type buttons, we'll have Delete Selected Rows buttons.</span></span>

<span data-ttu-id="1ab3a-310">Boa programação!</span><span class="sxs-lookup"><span data-stu-id="1ab3a-310">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="1ab3a-311">Sobre o autor</span><span class="sxs-lookup"><span data-stu-id="1ab3a-311">About the Author</span></span>

<span data-ttu-id="1ab3a-312">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor de sete livros sobre ASP/ASP. net e fundador da [4guysfromrolla.com](http://www.4guysfromrolla.com), tem trabalhado com tecnologias Web da Microsoft desde 1998.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-312">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="1ab3a-313">Scott trabalha como consultor, instrutor e escritor independentes.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-313">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="1ab3a-314">Seu livro mais recente é que a [*Sams ensina a ASP.NET 2,0 em 24 horas*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="1ab3a-314">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="1ab3a-315">Ele pode ser acessado em [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="1ab3a-315">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="1ab3a-316">ou por meio de seu blog, que pode ser encontrado em [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="1ab3a-316">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="1ab3a-317">Agradecimentos especiais a</span><span class="sxs-lookup"><span data-stu-id="1ab3a-317">Special Thanks To</span></span>

<span data-ttu-id="1ab3a-318">Esta série de tutoriais foi revisada por muitos revisores úteis.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-318">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="1ab3a-319">Os revisores potenciais para este tutorial foram Teresa Murphy e David Suru.</span><span class="sxs-lookup"><span data-stu-id="1ab3a-319">Lead reviewers for this tutorial were Teresa Murphy and David Suru.</span></span> <span data-ttu-id="1ab3a-320">Está interessado em revisar meus artigos futuros do MSDN?</span><span class="sxs-lookup"><span data-stu-id="1ab3a-320">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="1ab3a-321">Em caso afirmativo, solte-me uma linha em [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="1ab3a-321">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="1ab3a-322">[Anterior](wrapping-database-modifications-within-a-transaction-vb.md)
> [Próximo](batch-deleting-vb.md)</span><span class="sxs-lookup"><span data-stu-id="1ab3a-322">[Previous](wrapping-database-modifications-within-a-transaction-vb.md)
[Next](batch-deleting-vb.md)</span></span>
