---
uid: web-forms/overview/data-access/working-with-binary-files/uploading-files-cs
title: Carregando arquivos (C#) | Microsoft Docs
author: rick-anderson
description: Saiba como permitir que os usuários carreguem arquivos binários (como documentos do Word ou PDF) em seu site onde eles podem ser armazenados no sistema de arquivos do servidor...
ms.author: riande
ms.date: 03/27/2007
ms.assetid: b381b1da-feb3-4776-bc1b-75db53eb90ab
msc.legacyurl: /web-forms/overview/data-access/working-with-binary-files/uploading-files-cs
msc.type: authoredcontent
ms.openlocfilehash: 4e3e32a829de386a681504c8d5d61dd258b8b2e6
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/28/2019
ms.locfileid: "74581674"
---
# <a name="uploading-files-c"></a><span data-ttu-id="82701-103">Carregar arquivos (C#)</span><span class="sxs-lookup"><span data-stu-id="82701-103">Uploading Files (C#)</span></span>

<span data-ttu-id="82701-104">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="82701-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="82701-105">[Baixar o aplicativo de exemplo](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_54_CS.exe) ou [baixar PDF](uploading-files-cs/_static/datatutorial54cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="82701-105">[Download Sample App](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_54_CS.exe) or [Download PDF](uploading-files-cs/_static/datatutorial54cs1.pdf)</span></span>

> <span data-ttu-id="82701-106">Saiba como permitir que os usuários carreguem arquivos binários (como documentos do Word ou PDF) em seu site onde eles podem ser armazenados no sistema de arquivos ou no banco de dados do servidor.</span><span class="sxs-lookup"><span data-stu-id="82701-106">Learn how to allow users to upload binary files (such as Word or PDF documents) to your Web site where they may be stored in either the server's file system or the database.</span></span>

## <a name="introduction"></a><span data-ttu-id="82701-107">Introdução</span><span class="sxs-lookup"><span data-stu-id="82701-107">Introduction</span></span>

<span data-ttu-id="82701-108">Todos os tutoriais que nós examinamos até agora trabalharam exclusivamente com dados de texto.</span><span class="sxs-lookup"><span data-stu-id="82701-108">All of the tutorials we ve examined so far have worked exclusively with text data.</span></span> <span data-ttu-id="82701-109">No entanto, muitos aplicativos têm modelos de dados que capturam texto e dados binários.</span><span class="sxs-lookup"><span data-stu-id="82701-109">However, many applications have data models that capture both text and binary data.</span></span> <span data-ttu-id="82701-110">Um site de encontros online pode permitir que os usuários carreguem uma imagem para associar ao seu perfil.</span><span class="sxs-lookup"><span data-stu-id="82701-110">An online dating site might allow users to upload a picture to associate with their profile.</span></span> <span data-ttu-id="82701-111">Um site de recrutamento pode permitir que os usuários carreguem seu currículo como um documento do Microsoft Word ou PDF.</span><span class="sxs-lookup"><span data-stu-id="82701-111">A recruiting website might let users upload their resume as a Microsoft Word or PDF document.</span></span>

<span data-ttu-id="82701-112">Trabalhar com dados binários adiciona um novo conjunto de desafios.</span><span class="sxs-lookup"><span data-stu-id="82701-112">Working with binary data adds a new set of challenges.</span></span> <span data-ttu-id="82701-113">Devemos decidir como os dados binários são armazenados no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="82701-113">We must decide how the binary data is stored in the application.</span></span> <span data-ttu-id="82701-114">A interface usada para inserir novos registros deve ser atualizada para permitir que o usuário carregue um arquivo de seu computador e etapas adicionais devem ser executadas para exibir ou fornecer um meio de baixar dados binários associados a um registro.</span><span class="sxs-lookup"><span data-stu-id="82701-114">The interface used for inserting new records has to be updated to allow the user to upload a file from their computer and extra steps must be taken to display or provide a means for downloading a record s associated binary data.</span></span> <span data-ttu-id="82701-115">Neste tutorial e nos próximos três, exploraremos como enfrentar esses desafios.</span><span class="sxs-lookup"><span data-stu-id="82701-115">In this tutorial and the next three we'll explore how to hurdle these challenges.</span></span> <span data-ttu-id="82701-116">No final desses tutoriais, criaremos um aplicativo totalmente funcional que associa um folheto de imagem e PDF a cada categoria.</span><span class="sxs-lookup"><span data-stu-id="82701-116">At the end of these tutorials we'll have built a fully functional application that associates a picture and PDF brochure with each category.</span></span> <span data-ttu-id="82701-117">Neste tutorial específico, veremos técnicas diferentes para armazenar dados binários e exploraremos como permitir que os usuários carreguem um arquivo de seu computador e o Salvem no sistema de arquivos do servidor Web.</span><span class="sxs-lookup"><span data-stu-id="82701-117">In this particular tutorial we'll look at different techniques for storing binary data and explore how to enable users to upload a file from their computer and have it saved on the web server s file system.</span></span>

> [!NOTE]
> <span data-ttu-id="82701-118">Os dados binários que fazem parte de um modelo de dados do aplicativo são, às vezes, chamados de [blob](http://en.wikipedia.org/wiki/Binary_large_object), um acrônimo para objeto binário grande.</span><span class="sxs-lookup"><span data-stu-id="82701-118">Binary data that is part of an application s data model is sometimes referred to as a [BLOB](http://en.wikipedia.org/wiki/Binary_large_object), an acronym for Binary Large OBject.</span></span> <span data-ttu-id="82701-119">Nesses tutoriais, escolhi usar os dados binários de terminologia, embora o termo BLOB seja sinônimo.</span><span class="sxs-lookup"><span data-stu-id="82701-119">In these tutorials I have chosen to use the terminology binary data, although the term BLOB is synonymous.</span></span>

## <a name="step-1-creating-the-working-with-binary-data-web-pages"></a><span data-ttu-id="82701-120">Etapa 1: criando o trabalho com páginas da Web de dados binários</span><span class="sxs-lookup"><span data-stu-id="82701-120">Step 1: Creating the Working with Binary Data Web Pages</span></span>

<span data-ttu-id="82701-121">Antes de começarmos a explorar os desafios associados à adição de suporte para dados binários, primeiro vamos reservar um momento para criar as páginas ASP.NET em nosso projeto de site, que precisaremos para este tutorial e os três seguintes.</span><span class="sxs-lookup"><span data-stu-id="82701-121">Before we begin to explore the challenges associated with adding support for binary data, let s first take a moment to create the ASP.NET pages in our website project that we'll need for this tutorial and the next three.</span></span> <span data-ttu-id="82701-122">Comece adicionando uma nova pasta chamada `BinaryData`.</span><span class="sxs-lookup"><span data-stu-id="82701-122">Start by adding a new folder named `BinaryData`.</span></span> <span data-ttu-id="82701-123">Em seguida, adicione as seguintes páginas ASP.NET a essa pasta, assegurando a associação de cada página com a página mestra `Site.master`:</span><span class="sxs-lookup"><span data-stu-id="82701-123">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `FileUpload.aspx`
- `DisplayOrDownloadData.aspx`
- `UploadInDetailsView.aspx`
- `UpdatingAndDeleting.aspx`

![Adicionar as páginas ASP.NET para os tutoriais relacionados a dados binários](uploading-files-cs/_static/image1.gif)

<span data-ttu-id="82701-125">**Figura 1**: adicionar as páginas ASP.net para os tutoriais relacionados a dados binários</span><span class="sxs-lookup"><span data-stu-id="82701-125">**Figure 1**: Add the ASP.NET Pages for the Binary Data-Related Tutorials</span></span>

<span data-ttu-id="82701-126">Assim como nas outras pastas, `Default.aspx` na pasta `BinaryData` listará os tutoriais em sua seção.</span><span class="sxs-lookup"><span data-stu-id="82701-126">Like in the other folders, `Default.aspx` in the `BinaryData` folder will list the tutorials in its section.</span></span> <span data-ttu-id="82701-127">Lembre-se de que o controle de usuário `SectionLevelTutorialListing.ascx` fornece essa funcionalidade.</span><span class="sxs-lookup"><span data-stu-id="82701-127">Recall that the `SectionLevelTutorialListing.ascx` User Control provides this functionality.</span></span> <span data-ttu-id="82701-128">Portanto, adicione esse controle de usuário a `Default.aspx` arrastando-o da Gerenciador de Soluções para a página s modo de exibição de Design.</span><span class="sxs-lookup"><span data-stu-id="82701-128">Therefore, add this User Control to `Default.aspx` by dragging it from the Solution Explorer onto the page s Design view.</span></span>

<span data-ttu-id="82701-129">[![adicionar o controle de usuário SectionLevelTutorialListing. ascx a default. aspx](uploading-files-cs/_static/image2.gif)](uploading-files-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="82701-129">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](uploading-files-cs/_static/image2.gif)](uploading-files-cs/_static/image1.png)</span></span>

<span data-ttu-id="82701-130">**Figura 2**: Adicionar o controle de usuário `SectionLevelTutorialListing.ascx` ao `Default.aspx` ([clique para exibir a imagem em tamanho normal](uploading-files-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="82701-130">**Figure 2**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](uploading-files-cs/_static/image2.png))</span></span>

<span data-ttu-id="82701-131">Por fim, adicione essas páginas como entradas ao arquivo de `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="82701-131">Lastly, add these pages as entries to the `Web.sitemap` file.</span></span> <span data-ttu-id="82701-132">Especificamente, adicione a seguinte marcação depois de aprimorar o `<siteMapNode>`GridView:</span><span class="sxs-lookup"><span data-stu-id="82701-132">Specifically, add the following markup after the Enhancing the GridView `<siteMapNode>`:</span></span>

[!code-xml[Main](uploading-files-cs/samples/sample1.xml)]

<span data-ttu-id="82701-133">Depois de atualizar `Web.sitemap`, Reserve um momento para exibir o site de tutoriais por meio de um navegador.</span><span class="sxs-lookup"><span data-stu-id="82701-133">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="82701-134">O menu à esquerda agora inclui itens para os tutoriais de trabalho com dados binários.</span><span class="sxs-lookup"><span data-stu-id="82701-134">The menu on the left now includes items for the Working with Binary Data tutorials.</span></span>

![O mapa do site agora inclui entradas para os tutoriais de trabalho com dados binários](uploading-files-cs/_static/image3.gif)

<span data-ttu-id="82701-136">**Figura 3**: o mapa do site agora inclui entradas para os tutoriais de trabalho com dados binários</span><span class="sxs-lookup"><span data-stu-id="82701-136">**Figure 3**: The Site Map Now Includes Entries for the Working with Binary Data Tutorials</span></span>

## <a name="step-2-deciding-where-to-store-the-binary-data"></a><span data-ttu-id="82701-137">Etapa 2: decidindo onde armazenar os dados binários</span><span class="sxs-lookup"><span data-stu-id="82701-137">Step 2: Deciding Where to Store the Binary Data</span></span>

<span data-ttu-id="82701-138">Os dados binários associados ao modelo de dados do aplicativo podem ser armazenados em um dos dois locais: no sistema de arquivos do servidor Web, com uma referência ao arquivo armazenado no banco de dados; ou diretamente no próprio banco de dados (consulte a Figura 4).</span><span class="sxs-lookup"><span data-stu-id="82701-138">Binary data that is associated with the application s data model can be stored in one of two places: on the web server s file system with a reference to the file stored in the database; or directly within the database itself (see Figure 4).</span></span> <span data-ttu-id="82701-139">Cada abordagem tem seu próprio conjunto de prós e contras e merece uma discussão mais detalhada.</span><span class="sxs-lookup"><span data-stu-id="82701-139">Each approach has its own set of pros and cons and merits a more detailed discussion.</span></span>

<span data-ttu-id="82701-140">[![dados binários podem ser armazenados no sistema de arquivos ou diretamente no banco](uploading-files-cs/_static/image4.gif)](uploading-files-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="82701-140">[![Binary Data Can Be Stored On the File System or Directly in the Database](uploading-files-cs/_static/image4.gif)](uploading-files-cs/_static/image3.png)</span></span>

<span data-ttu-id="82701-141">**Figura 4**: dados binários podem ser armazenados no sistema de arquivos ou diretamente no banco de dado ([clique para exibir a imagem em tamanho normal](uploading-files-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="82701-141">**Figure 4**: Binary Data Can Be Stored On the File System or Directly in the Database ([Click to view full-size image](uploading-files-cs/_static/image4.png))</span></span>

<span data-ttu-id="82701-142">Imagine que queríamos estender o banco de dados Northwind para associar uma imagem a cada produto.</span><span class="sxs-lookup"><span data-stu-id="82701-142">Imagine that we wanted to extend the Northwind database to associate a picture with each product.</span></span> <span data-ttu-id="82701-143">Uma opção seria armazenar esses arquivos de imagem no sistema de arquivos do servidor Web e registrar o caminho na tabela `Products`.</span><span class="sxs-lookup"><span data-stu-id="82701-143">One option would be to store these image files on the web server s file system and record the path in the `Products` table.</span></span> <span data-ttu-id="82701-144">Com essa abordagem, nós d adicionamos uma coluna `ImagePath` à tabela `Products` do tipo `varchar(200)`, talvez.</span><span class="sxs-lookup"><span data-stu-id="82701-144">With this approach, we d add an `ImagePath` column to the `Products` table of type `varchar(200)`, perhaps.</span></span> <span data-ttu-id="82701-145">Quando um usuário carregou uma imagem para Chai, essa imagem pode ser armazenada no sistema de arquivos do servidor Web em `~/Images/Tea.jpg`, em que `~` representa o caminho físico do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="82701-145">When a user uploaded a picture for Chai, that picture might be stored on the web server s file system at `~/Images/Tea.jpg`, where `~` represents the application s physical path.</span></span> <span data-ttu-id="82701-146">Ou seja, se o site tiver raiz no caminho físico `C:\Websites\Northwind\`, `~/Images/Tea.jpg` será equivalente a `C:\Websites\Northwind\Images\Tea.jpg`.</span><span class="sxs-lookup"><span data-stu-id="82701-146">That is, if the web site is rooted at the physical path `C:\Websites\Northwind\`, `~/Images/Tea.jpg` would be equivalent to `C:\Websites\Northwind\Images\Tea.jpg`.</span></span> <span data-ttu-id="82701-147">Depois de carregar o arquivo de imagem, nós d atualizamos o registro Chai na tabela `Products` de forma que sua coluna de `ImagePath` referenciava o caminho da nova imagem.</span><span class="sxs-lookup"><span data-stu-id="82701-147">After uploading the image file, we d update the Chai record in the `Products` table so that its `ImagePath` column referenced the path of the new image.</span></span> <span data-ttu-id="82701-148">Poderíamos usar `~/Images/Tea.jpg` ou apenas `Tea.jpg` se decidirmos que todas as imagens do produto seriam colocadas na pasta de `Images` do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="82701-148">We could use `~/Images/Tea.jpg` or just `Tea.jpg` if we decided that all product images would be placed in the application s `Images` folder.</span></span>

<span data-ttu-id="82701-149">As principais vantagens de armazenar os dados binários no sistema de arquivos são:</span><span class="sxs-lookup"><span data-stu-id="82701-149">The main advantages of storing the binary data on the file system are:</span></span>

- <span data-ttu-id="82701-150">A **facilidade de implementação** como veremos em breve, o armazenamento e a recuperação de dados binários armazenados diretamente dentro dele envolve um pouco mais de código do que ao trabalhar com dados por meio do sistema de arquivos.</span><span class="sxs-lookup"><span data-stu-id="82701-150">**Ease of implementation** as we'll see shortly, storing and retrieving binary data stored directly within the database involves a bit more code than when working with data through the file system.</span></span> <span data-ttu-id="82701-151">Além disso, para que um usuário exiba ou baixe dados binários, eles devem receber uma URL para esses dados.</span><span class="sxs-lookup"><span data-stu-id="82701-151">Additionally, in order for a user to view or download binary data they must be presented with a URL to that data.</span></span> <span data-ttu-id="82701-152">Se os dados residirem no sistema de arquivos do servidor Web, a URL será simples.</span><span class="sxs-lookup"><span data-stu-id="82701-152">If the data resides on the web server s file system, the URL is straightforward.</span></span> <span data-ttu-id="82701-153">No entanto, se os dados forem armazenados no banco de dado, será necessário criar uma página da Web que recuperará e retornará os dados do banco de dado.</span><span class="sxs-lookup"><span data-stu-id="82701-153">If the data is stored in the database, however, a web page needs to be created that will retrieve and return the data from the database.</span></span>
- <span data-ttu-id="82701-154">**Acesso mais amplo aos dados binários** talvez os dados binários precisem ser acessíveis a outros serviços ou aplicativos, aqueles que não podem efetuar pull dos dados do Database.</span><span class="sxs-lookup"><span data-stu-id="82701-154">**Wider access to the binary data** the binary data may need to be accessible to other services or applications, ones that cannot pull the data from the database.</span></span> <span data-ttu-id="82701-155">Por exemplo, as imagens associadas a cada produto também podem precisar estar disponíveis para os usuários por [FTP](http://en.wikipedia.org/wiki/File_Transfer_Protocol); nesse caso, a que d queremos armazenar os dados binários no sistema de arquivos.</span><span class="sxs-lookup"><span data-stu-id="82701-155">For example, the images associated with each product might also need to be available to users through [FTP](http://en.wikipedia.org/wiki/File_Transfer_Protocol), in which case we d want to store the binary data on the file system.</span></span>
- <span data-ttu-id="82701-156">**Desempenho** se os dados binários forem armazenados no sistema de arquivos, a demanda e o congestionamento de rede entre o servidor de banco de dados e o servidor Web serão menores do que se os dados binários forem armazenados diretamente no banco de dado.</span><span class="sxs-lookup"><span data-stu-id="82701-156">**Performance** if the binary data is stored on the file system, the demand and network congestion between the database server and web server will be less than if the binary data is stored directly within the database.</span></span>

<span data-ttu-id="82701-157">A principal desvantagem de armazenar dados binários no sistema de arquivos é que ele separa os dados do banco de dado.</span><span class="sxs-lookup"><span data-stu-id="82701-157">The main disadvantage of storing binary data on the file system is that it decouples the data from the database.</span></span> <span data-ttu-id="82701-158">Se um registro for excluído da tabela de `Products`, o arquivo associado no sistema de arquivos do servidor Web não será excluído automaticamente.</span><span class="sxs-lookup"><span data-stu-id="82701-158">If a record is deleted from the `Products` table, the associated file on the web server s file system is not automatically deleted.</span></span> <span data-ttu-id="82701-159">Devemos escrever um código extra para excluir o arquivo ou o sistema de arquivos ficará desorganizado com arquivos órfãos e não utilizados.</span><span class="sxs-lookup"><span data-stu-id="82701-159">We must write extra code to delete the file or the file system will become cluttered with unused, orphaned files.</span></span> <span data-ttu-id="82701-160">Além disso, ao fazer backup do banco de dados, devemos nos certificar também de fazer backups do arquivo binário associado no sistema de arquivos.</span><span class="sxs-lookup"><span data-stu-id="82701-160">Furthermore, when backing up the database, we must make sure to make backups of the associated binary data on the file system, as well.</span></span> <span data-ttu-id="82701-161">Mover o banco de dados para outro site ou servidor apresenta desafios semelhantes.</span><span class="sxs-lookup"><span data-stu-id="82701-161">Moving the database to another site or server poses similar challenges.</span></span>

<span data-ttu-id="82701-162">Como alternativa, os dados binários podem ser armazenados diretamente em um banco de dado Microsoft SQL Server 2005 criando uma coluna do tipo `varbinary`.</span><span class="sxs-lookup"><span data-stu-id="82701-162">Alternatively, binary data can be stored directly in a Microsoft SQL Server 2005 database by creating a column of type `varbinary`.</span></span> <span data-ttu-id="82701-163">Assim como com outros tipos de dados de comprimento variável, você pode especificar um comprimento máximo dos dados binários que podem ser mantidos nesta coluna.</span><span class="sxs-lookup"><span data-stu-id="82701-163">Like with other variable length data types, you can specify a maximum length of the binary data that can be held in this column.</span></span> <span data-ttu-id="82701-164">Por exemplo, para reservar no máximo 5.000 bytes de uso `varbinary(5000)`; `varbinary(MAX)` permite o tamanho máximo de armazenamento, cerca de 2 GB.</span><span class="sxs-lookup"><span data-stu-id="82701-164">For example, to reserve at most 5,000 bytes use `varbinary(5000)`; `varbinary(MAX)` allows for the maximum storage size, about 2 GB.</span></span>

<span data-ttu-id="82701-165">A principal vantagem de armazenar os dados binários diretamente no banco de dados é o acoplamento rígido entre a data e o registro do banco de dados binários.</span><span class="sxs-lookup"><span data-stu-id="82701-165">The main advantage of storing binary data directly in the database is the tight coupling between the binary data and the database record.</span></span> <span data-ttu-id="82701-166">Isso simplifica muito as tarefas de administração do banco de dados, como backups ou movimentação do banco de dados para um site ou servidor diferente.</span><span class="sxs-lookup"><span data-stu-id="82701-166">This greatly simplifies database administration tasks, like backups or moving the database to a different site or server.</span></span> <span data-ttu-id="82701-167">Além disso, a exclusão de um registro exclui automaticamente os dados binários correspondentes.</span><span class="sxs-lookup"><span data-stu-id="82701-167">Also, deleting a record automatically deletes the corresponding binary data.</span></span> <span data-ttu-id="82701-168">Também há benefícios mais sutis de armazenar os dados binários no banco de dado.</span><span class="sxs-lookup"><span data-stu-id="82701-168">There are also more subtle benefits of storing the binary data in the database.</span></span> <span data-ttu-id="82701-169">Consulte [armazenar arquivos binários diretamente no banco de dados usando o ASP.NET 2,0](http://aspnet.4guysfromrolla.com/articles/120606-1.aspx) para obter uma discussão mais detalhada.</span><span class="sxs-lookup"><span data-stu-id="82701-169">See [Storing Binary Files Directly in the Database Using ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/120606-1.aspx) for a more in-depth discussion.</span></span>

> [!NOTE]
> <span data-ttu-id="82701-170">No Microsoft SQL Server 2000 e versões anteriores, o tipo de dados `varbinary` tinha um limite máximo de 8.000 bytes.</span><span class="sxs-lookup"><span data-stu-id="82701-170">In Microsoft SQL Server 2000 and earlier versions, the `varbinary` data type had a maximum limit of 8,000 bytes.</span></span> <span data-ttu-id="82701-171">Para armazenar até 2 GB de dados binários, é necessário usar o [tipo de dados`image`](https://msdn.microsoft.com/library/ms187993.aspx) .</span><span class="sxs-lookup"><span data-stu-id="82701-171">To store up to 2 GB of binary data the [`image` data type](https://msdn.microsoft.com/library/ms187993.aspx) needs to be used instead.</span></span> <span data-ttu-id="82701-172">No entanto, com a adição de `MAX` no SQL Server 2005, o tipo de dados `image` foi preterido.</span><span class="sxs-lookup"><span data-stu-id="82701-172">With the addition of `MAX` in SQL Server 2005, however, the `image` data type has been deprecated.</span></span> <span data-ttu-id="82701-173">Ainda há suporte para a compatibilidade com versões anteriores, mas a Microsoft anunciou que o tipo de dados `image` será removido em uma versão futura do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="82701-173">It s still supported for backwards compatibility, but Microsoft has announced that the `image` data type will be removed in a future version of SQL Server.</span></span>

<span data-ttu-id="82701-174">Se você estiver trabalhando com um modelo de dados mais antigo, poderá ver o tipo de dados `image`.</span><span class="sxs-lookup"><span data-stu-id="82701-174">If you are working with an older data model you may see the `image` data type.</span></span> <span data-ttu-id="82701-175">A tabela de `Categories` do banco de dados Northwind tem uma coluna `Picture` que pode ser usada para armazenar os dados binários de um arquivo de imagem para a categoria.</span><span class="sxs-lookup"><span data-stu-id="82701-175">The Northwind database s `Categories` table has a `Picture` column that can be used to store the binary data of an image file for the category.</span></span> <span data-ttu-id="82701-176">Como o banco de dados Northwind tem suas raízes no Microsoft Access e em versões anteriores do SQL Server, essa coluna é do tipo `image`.</span><span class="sxs-lookup"><span data-stu-id="82701-176">Since the Northwind database has its roots in Microsoft Access and earlier versions of SQL Server, this column is of type `image`.</span></span>

<span data-ttu-id="82701-177">Para este tutorial e os próximos três, usaremos as duas abordagens.</span><span class="sxs-lookup"><span data-stu-id="82701-177">For this tutorial and the next three, we'll use both approaches.</span></span> <span data-ttu-id="82701-178">A tabela `Categories` já tem uma coluna `Picture` para armazenar o conteúdo binário de uma imagem para a categoria.</span><span class="sxs-lookup"><span data-stu-id="82701-178">The `Categories` table already has a `Picture` column for storing the binary content of an image for the category.</span></span> <span data-ttu-id="82701-179">Adicionaremos uma coluna adicional, `BrochurePath`, para armazenar um caminho para um PDF no sistema de arquivos do servidor Web que pode ser usado para fornecer uma visão geral elegante da qualidade de impressão da categoria.</span><span class="sxs-lookup"><span data-stu-id="82701-179">We'll add an additional column, `BrochurePath`, to store a path to a PDF on the web server s file system that can be used to provide a print-quality, polished overview of the category.</span></span>

## <a name="step-3-adding-thebrochurepathcolumn-to-thecategoriestable"></a><span data-ttu-id="82701-180">Etapa 3: adicionar a coluna de`BrochurePath`à tabela`Categories`</span><span class="sxs-lookup"><span data-stu-id="82701-180">Step 3: Adding the`BrochurePath`Column to the`Categories`Table</span></span>

<span data-ttu-id="82701-181">Atualmente, a tabela Categories tem apenas quatro colunas: `CategoryID`, `CategoryName`, `Description`e `Picture`.</span><span class="sxs-lookup"><span data-stu-id="82701-181">Currently the Categories table has only four columns: `CategoryID`, `CategoryName`, `Description`, and `Picture`.</span></span> <span data-ttu-id="82701-182">Além desses campos, precisamos adicionar um novo que apontará para o folheto da categoria s (se houver).</span><span class="sxs-lookup"><span data-stu-id="82701-182">In addition to these fields, we need to add a new one that will point to the category s brochure (if one exists).</span></span> <span data-ttu-id="82701-183">Para adicionar essa coluna, vá para a Gerenciador de Servidores, faça uma busca detalhada nas tabelas, clique com o botão direito do mouse na tabela `Categories` e escolha Abrir definição de tabela (veja a Figura 5).</span><span class="sxs-lookup"><span data-stu-id="82701-183">To add this column, go to the Server Explorer, drill down into the Tables, right-click on the `Categories` table and choose Open Table Definition (see Figure 5).</span></span> <span data-ttu-id="82701-184">Se você não vir o Gerenciador de Servidores, exiba-o selecionando a opção Gerenciador de Servidores no menu exibir ou pressione CTRL + ALT + S.</span><span class="sxs-lookup"><span data-stu-id="82701-184">If you do not see the Server Explorer, bring it up by selecting the Server Explorer option from the View menu, or hit Ctrl+Alt+S.</span></span>

<span data-ttu-id="82701-185">Adicione uma nova coluna `varchar(200)` à tabela `Categories` chamada `BrochurePath` e permita `NULL` s e clique no ícone salvar (ou pressione Ctrl + S).</span><span class="sxs-lookup"><span data-stu-id="82701-185">Add a new `varchar(200)` column to the `Categories` table that is named `BrochurePath` and allows `NULL` s and click the Save icon (or hit Ctrl+S).</span></span>

<span data-ttu-id="82701-186">[![adicionar uma coluna BrochurePath à tabela Categories](uploading-files-cs/_static/image5.gif)](uploading-files-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="82701-186">[![Add a BrochurePath Column to the Categories Table](uploading-files-cs/_static/image5.gif)](uploading-files-cs/_static/image5.png)</span></span>

<span data-ttu-id="82701-187">**Figura 5**: adicionar uma coluna `BrochurePath` à tabela `Categories` ([clique para exibir a imagem em tamanho normal](uploading-files-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="82701-187">**Figure 5**: Add a `BrochurePath` Column to the `Categories` Table ([Click to view full-size image](uploading-files-cs/_static/image6.png))</span></span>

## <a name="step-4-updating-the-architecture-to-use-thepictureandbrochurepathcolumns"></a><span data-ttu-id="82701-188">Etapa 4: atualizando a arquitetura para usar as colunas`Picture`e`BrochurePath`</span><span class="sxs-lookup"><span data-stu-id="82701-188">Step 4: Updating the Architecture to Use the`Picture`and`BrochurePath`Columns</span></span>

<span data-ttu-id="82701-189">O `CategoriesDataTable` na DAL (camada de acesso a dados) atualmente tem quatro `DataColumn` s definidos: `CategoryID`, `CategoryName`, `Description`e `NumberOfProducts`.</span><span class="sxs-lookup"><span data-stu-id="82701-189">The `CategoriesDataTable` in the Data Access Layer (DAL) currently has four `DataColumn` s defined: `CategoryID`, `CategoryName`, `Description`, and `NumberOfProducts`.</span></span> <span data-ttu-id="82701-190">Quando originalmente criamos essa DataTable no tutorial [criando uma camada de acesso a dados](../introduction/creating-a-data-access-layer-cs.md) , a `CategoriesDataTable` tinha apenas as três primeiras colunas; a coluna `NumberOfProducts` foi adicionada ao [mestre/detalhes usando uma lista com marcadores de registros mestres com um tutorial de DataList detalhes](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md) .</span><span class="sxs-lookup"><span data-stu-id="82701-190">When we originally designed this DataTable in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-cs.md) tutorial, the `CategoriesDataTable` only had the first three columns; the `NumberOfProducts` column was added in the [Master/Detail Using a Bulleted List of Master Records with a Details DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md) tutorial.</span></span>

<span data-ttu-id="82701-191">Conforme discutido na *criação de uma camada de acesso a dados*, as DataTables no dataset tipado compõem os objetos comerciais.</span><span class="sxs-lookup"><span data-stu-id="82701-191">As discussed in *Creating a Data Access Layer*, the DataTables in the Typed DataSet make up the business objects.</span></span> <span data-ttu-id="82701-192">Os TableAdapters são responsáveis por se comunicar com o banco de dados e preencher os objetos comerciais com os resultados da consulta.</span><span class="sxs-lookup"><span data-stu-id="82701-192">The TableAdapters are responsible for communicating with the database and populating the business objects with the query results.</span></span> <span data-ttu-id="82701-193">O `CategoriesDataTable` é preenchido pelo `CategoriesTableAdapter`, que tem três métodos de recuperação de dados:</span><span class="sxs-lookup"><span data-stu-id="82701-193">The `CategoriesDataTable` is populated by the `CategoriesTableAdapter`, which has three data retrieval methods:</span></span>

- <span data-ttu-id="82701-194">`GetCategories()` executa a consulta principal do TableAdapter s e retorna os campos `CategoryID`, `CategoryName`e `Description` de todos os registros na tabela `Categories`.</span><span class="sxs-lookup"><span data-stu-id="82701-194">`GetCategories()` executes the TableAdapter s main query and returns the `CategoryID`, `CategoryName`, and `Description` fields of all records in the `Categories` table.</span></span> <span data-ttu-id="82701-195">A consulta principal é o que é usado pelos métodos `Insert` e `Update` gerados automaticamente.</span><span class="sxs-lookup"><span data-stu-id="82701-195">The main query is what is used by the auto-generated `Insert` and `Update` methods.</span></span>
- <span data-ttu-id="82701-196">`GetCategoryByCategoryID(categoryID)` retorna os campos `CategoryID`, `CategoryName`e `Description` da categoria cujo `CategoryID` é igual a *CategoryID*.</span><span class="sxs-lookup"><span data-stu-id="82701-196">`GetCategoryByCategoryID(categoryID)` returns the `CategoryID`, `CategoryName`, and `Description` fields of the category whose `CategoryID` equals *categoryID*.</span></span>
- <span data-ttu-id="82701-197">`GetCategoriesAndNumberOfProducts()`-retorna os campos `CategoryID`, `CategoryName`e `Description` para todos os registros na tabela `Categories`.</span><span class="sxs-lookup"><span data-stu-id="82701-197">`GetCategoriesAndNumberOfProducts()` - returns the `CategoryID`, `CategoryName`, and `Description` fields for all records in the `Categories` table.</span></span> <span data-ttu-id="82701-198">Também usa uma subconsulta para retornar o número de produtos associados a cada categoria.</span><span class="sxs-lookup"><span data-stu-id="82701-198">Also uses a subquery to return the number of products associated with each category.</span></span>

<span data-ttu-id="82701-199">Observe que nenhuma dessas consultas retorna a tabela `Categories` s `Picture` ou `BrochurePath` colunas; Nem o `CategoriesDataTable` fornecer `DataColumn` s para esses campos.</span><span class="sxs-lookup"><span data-stu-id="82701-199">Notice that none of these queries return the `Categories` table s `Picture` or `BrochurePath` columns; nor does the `CategoriesDataTable` provide `DataColumn` s for these fields.</span></span> <span data-ttu-id="82701-200">Para trabalhar com as propriedades Picture e `BrochurePath`, precisamos primeiro adicioná-las ao `CategoriesDataTable` e, em seguida, atualizar a classe `CategoriesTableAdapter` para retornar essas colunas.</span><span class="sxs-lookup"><span data-stu-id="82701-200">In order to work with the Picture and `BrochurePath` properties, we need to first add them to the `CategoriesDataTable` and then update the `CategoriesTableAdapter` class to return these columns.</span></span>

## <a name="adding-thepictureandbrochurepathdatacolumn-s"></a><span data-ttu-id="82701-201">Adicionando o`Picture`e`BrochurePath``DataColumn` s</span><span class="sxs-lookup"><span data-stu-id="82701-201">Adding the`Picture`and`BrochurePath``DataColumn` s</span></span>

<span data-ttu-id="82701-202">Comece adicionando essas duas colunas à `CategoriesDataTable`.</span><span class="sxs-lookup"><span data-stu-id="82701-202">Start by adding these two columns to the `CategoriesDataTable`.</span></span> <span data-ttu-id="82701-203">Clique com o botão direito do mouse no cabeçalho `CategoriesDataTable` s, selecione Adicionar no menu de contexto e escolha a opção coluna.</span><span class="sxs-lookup"><span data-stu-id="82701-203">Right-click on the `CategoriesDataTable` s header, select Add from the context menu and then choose the Column option.</span></span> <span data-ttu-id="82701-204">Isso criará um novo `DataColumn` na DataTable chamada `Column1`.</span><span class="sxs-lookup"><span data-stu-id="82701-204">This will create a new `DataColumn` in the DataTable named `Column1`.</span></span> <span data-ttu-id="82701-205">Renomeie esta coluna como `Picture`.</span><span class="sxs-lookup"><span data-stu-id="82701-205">Rename this column to `Picture`.</span></span> <span data-ttu-id="82701-206">Na janela Propriedades, defina a propriedade `DataColumn` s `DataType` como `System.Byte[]` (isso não é uma opção na lista suspensa; você precisa digitá-la).</span><span class="sxs-lookup"><span data-stu-id="82701-206">From the Properties window, set the `DataColumn` s `DataType` property to `System.Byte[]` (this is not an option in the drop-down list; you need to type it in).</span></span>

<span data-ttu-id="82701-207">[![criar uma DataColumn denominada Picture cujo tipo de dados é System. Byte []](uploading-files-cs/_static/image6.gif)](uploading-files-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="82701-207">[![Create a DataColumn Named Picture whose DataType is System.Byte[]](uploading-files-cs/_static/image6.gif)](uploading-files-cs/_static/image7.png)</span></span>

<span data-ttu-id="82701-208">**Figura 6**: criar um `DataColumn` nomeado `Picture` cujo `DataType` é `System.Byte[]` ([clique para exibir a imagem em tamanho normal](uploading-files-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="82701-208">**Figure 6**: Create a `DataColumn` Named `Picture` whose `DataType` is `System.Byte[]` ([Click to view full-size image](uploading-files-cs/_static/image8.png))</span></span>

<span data-ttu-id="82701-209">Adicione outro `DataColumn` à DataTable, nomeando-o `BrochurePath` usando o valor de `DataType` padrão (`System.String`).</span><span class="sxs-lookup"><span data-stu-id="82701-209">Add another `DataColumn` to the DataTable, naming it `BrochurePath` using the default `DataType` value (`System.String`).</span></span>

## <a name="returning-thepictureandbrochurepathvalues-from-the-tableadapter"></a><span data-ttu-id="82701-210">Retornando os valores de`Picture`e`BrochurePath`do TableAdapter</span><span class="sxs-lookup"><span data-stu-id="82701-210">Returning the`Picture`and`BrochurePath`Values from the TableAdapter</span></span>

<span data-ttu-id="82701-211">Com esses dois `DataColumn` s adicionados ao `CategoriesDataTable`, estamos prontos para atualizar o `CategoriesTableAdapter`.</span><span class="sxs-lookup"><span data-stu-id="82701-211">With these two `DataColumn` s added to the `CategoriesDataTable`, we re ready to update the `CategoriesTableAdapter`.</span></span> <span data-ttu-id="82701-212">Poderíamos ter esses dois valores de coluna retornados na consulta principal do TableAdapter, mas isso colocaria os dados binários sempre que o método `GetCategories()` fosse invocado.</span><span class="sxs-lookup"><span data-stu-id="82701-212">We could have both of these column values returned in the main TableAdapter query, but this would bring back the binary data every time the `GetCategories()` method was invoked.</span></span> <span data-ttu-id="82701-213">Em vez disso, vamos atualizar a consulta principal do TableAdapter para trazer de volta `BrochurePath` e criar um método de recuperação de dados adicional que retorna uma coluna de `Picture` de categoria específica.</span><span class="sxs-lookup"><span data-stu-id="82701-213">Instead, let s update the main TableAdapter query to bring back `BrochurePath` and create an additional data retrieval method that returns a particular category s `Picture` column.</span></span>

<span data-ttu-id="82701-214">Para atualizar a consulta principal do TableAdapter, clique com o botão direito do mouse no cabeçalho `CategoriesTableAdapter` s e escolha a opção configurar no menu de contexto.</span><span class="sxs-lookup"><span data-stu-id="82701-214">To update the main TableAdapter query, right-click on the `CategoriesTableAdapter` s header and choose the Configure option from the context menu.</span></span> <span data-ttu-id="82701-215">Isso abre o assistente de configuração do adaptador de tabela, que vimos em vários tutoriais anteriores.</span><span class="sxs-lookup"><span data-stu-id="82701-215">This brings up the Table Adapter Configuration Wizard, which we ve seen in a number of past tutorials.</span></span> <span data-ttu-id="82701-216">Atualize a consulta para retornar o `BrochurePath` e clique em concluir.</span><span class="sxs-lookup"><span data-stu-id="82701-216">Update the query to bring back the `BrochurePath` and click Finish.</span></span>

<span data-ttu-id="82701-217">[![atualizar a lista de colunas na instrução SELECT para retornar também BrochurePath](uploading-files-cs/_static/image7.gif)](uploading-files-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="82701-217">[![Update the Column List in the SELECT Statement to Also Return BrochurePath](uploading-files-cs/_static/image7.gif)](uploading-files-cs/_static/image9.png)</span></span>

<span data-ttu-id="82701-218">**Figura 7**: atualizar a lista de colunas na instrução `SELECT` para também retornar `BrochurePath` ([clique para exibir a imagem em tamanho normal](uploading-files-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="82701-218">**Figure 7**: Update the Column List in the `SELECT` Statement to Also Return `BrochurePath` ([Click to view full-size image](uploading-files-cs/_static/image10.png))</span></span>

<span data-ttu-id="82701-219">Ao usar instruções SQL ad hoc para o TableAdapter, atualizar a lista de colunas na consulta principal atualiza a lista de colunas para todos os métodos de consulta de `SELECT` no TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="82701-219">When using ad-hoc SQL statements for the TableAdapter, updating the column list in the main query updates the column list for all of the `SELECT` query methods in the TableAdapter.</span></span> <span data-ttu-id="82701-220">Isso significa que o método `GetCategoryByCategoryID(categoryID)` foi atualizado para retornar a coluna `BrochurePath`, que pode ser o que pretendemos.</span><span class="sxs-lookup"><span data-stu-id="82701-220">That means the `GetCategoryByCategoryID(categoryID)` method has been updated to return the `BrochurePath` column, which might be what we intended.</span></span> <span data-ttu-id="82701-221">No entanto, ela também atualizou a lista de colunas no método `GetCategoriesAndNumberOfProducts()`, removendo a subconsulta que retorna o número de produtos para cada categoria!</span><span class="sxs-lookup"><span data-stu-id="82701-221">However, it also updated the column list in the `GetCategoriesAndNumberOfProducts()` method, removing the subquery that returns the number of products for each category!</span></span> <span data-ttu-id="82701-222">Portanto, precisamos atualizar esse método s `SELECT` consulta.</span><span class="sxs-lookup"><span data-stu-id="82701-222">Therefore, we need to update this method s `SELECT` query.</span></span> <span data-ttu-id="82701-223">Clique com o botão direito do mouse no método `GetCategoriesAndNumberOfProducts()`, escolha configurar e reverta a consulta `SELECT` de volta para seu valor original:</span><span class="sxs-lookup"><span data-stu-id="82701-223">Right-click on the `GetCategoriesAndNumberOfProducts()` method, choose Configure, and revert the `SELECT` query back to its original value:</span></span>

[!code-sql[Main](uploading-files-cs/samples/sample2.sql)]

<span data-ttu-id="82701-224">Em seguida, crie um novo método TableAdapter que retorna uma categoria específica `Picture` valor da coluna.</span><span class="sxs-lookup"><span data-stu-id="82701-224">Next, create a new TableAdapter method that returns a particular category s `Picture` column value.</span></span> <span data-ttu-id="82701-225">Clique com o botão direito do mouse no cabeçalho `CategoriesTableAdapter` s e escolha a opção Adicionar consulta para iniciar o assistente de configuração de consulta do TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="82701-225">Right-click on the `CategoriesTableAdapter` s header and choose the Add Query option to launch the TableAdapter Query Configuration Wizard.</span></span> <span data-ttu-id="82701-226">A primeira etapa desse assistente nos pergunta se queremos consultar dados usando uma instrução SQL ad hoc, um novo procedimento armazenado ou um existente.</span><span class="sxs-lookup"><span data-stu-id="82701-226">The first step of this wizard asks us if we want to query data using an ad-hoc SQL statement, a new stored procedure, or an existing one.</span></span> <span data-ttu-id="82701-227">Selecione usar instruções SQL e clique em Avançar.</span><span class="sxs-lookup"><span data-stu-id="82701-227">Select Use SQL statements and click Next.</span></span> <span data-ttu-id="82701-228">Como retornaremos uma linha, escolha a opção Selecionar que retorna linhas da segunda etapa.</span><span class="sxs-lookup"><span data-stu-id="82701-228">Since we will be returning a row, choose the SELECT which returns rows option from the second step.</span></span>

<span data-ttu-id="82701-229">[![selecionar a opção usar instruções SQL](uploading-files-cs/_static/image8.gif)](uploading-files-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="82701-229">[![Select the Use SQL statements Option](uploading-files-cs/_static/image8.gif)](uploading-files-cs/_static/image11.png)</span></span>

<span data-ttu-id="82701-230">**Figura 8**: selecione a opção usar instruções SQL ([clique para exibir a imagem em tamanho normal](uploading-files-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="82701-230">**Figure 8**: Select the Use SQL statements Option ([Click to view full-size image](uploading-files-cs/_static/image12.png))</span></span>

<span data-ttu-id="82701-231">[![uma vez que a consulta retornará um registro da tabela categorias, escolha Selecionar que retorna linhas](uploading-files-cs/_static/image9.gif)](uploading-files-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="82701-231">[![Since the Query Will Return a Record from the Categories Table, Choose SELECT which returns rows](uploading-files-cs/_static/image9.gif)](uploading-files-cs/_static/image13.png)</span></span>

<span data-ttu-id="82701-232">**Figura 9**: como a consulta retornará um registro da tabela categorias, escolha Selecionar que retorna linhas ([clique para exibir a imagem em tamanho normal](uploading-files-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="82701-232">**Figure 9**: Since the Query Will Return a Record from the Categories Table, Choose SELECT which returns rows ([Click to view full-size image](uploading-files-cs/_static/image14.png))</span></span>

<span data-ttu-id="82701-233">Na terceira etapa, insira a seguinte consulta SQL e clique em Avançar:</span><span class="sxs-lookup"><span data-stu-id="82701-233">In the third step, enter the following SQL query and click Next:</span></span>

[!code-sql[Main](uploading-files-cs/samples/sample3.sql)]

<span data-ttu-id="82701-234">A última etapa é escolher o nome para o novo método.</span><span class="sxs-lookup"><span data-stu-id="82701-234">The last step is to choose the name for the new method.</span></span> <span data-ttu-id="82701-235">Use `FillCategoryWithBinaryDataByCategoryID` e `GetCategoryWithBinaryDataByCategoryID` para preencher uma DataTable e retornar os padrões de DataTable, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="82701-235">Use `FillCategoryWithBinaryDataByCategoryID` and `GetCategoryWithBinaryDataByCategoryID` for the Fill a DataTable and Return a DataTable patterns, respectively.</span></span> <span data-ttu-id="82701-236">Clique em Concluir para concluir o assistente.</span><span class="sxs-lookup"><span data-stu-id="82701-236">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="82701-237">[![escolher os nomes para os métodos TableAdapter s](uploading-files-cs/_static/image10.gif)](uploading-files-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="82701-237">[![Choose the Names for the TableAdapter s Methods](uploading-files-cs/_static/image10.gif)](uploading-files-cs/_static/image15.png)</span></span>

<span data-ttu-id="82701-238">**Figura 10**: escolha os nomes para os métodos TableAdapter s ([clique para exibir a imagem em tamanho normal](uploading-files-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="82701-238">**Figure 10**: Choose the Names for the TableAdapter s Methods ([Click to view full-size image](uploading-files-cs/_static/image16.png))</span></span>

> [!NOTE]
> <span data-ttu-id="82701-239">Depois de concluir o assistente de configuração de consulta do adaptador de tabela, você poderá ver uma caixa de diálogo informando que o novo texto de comando retorna dados com esquema diferente do esquema da consulta principal.</span><span class="sxs-lookup"><span data-stu-id="82701-239">After completing the Table Adapter Query Configuration Wizard you may see a dialog box informing you that the new command text returns data with schema different from the schema of the main query.</span></span> <span data-ttu-id="82701-240">Em suma, o assistente está observando que a consulta principal do TableAdapter s `GetCategories()` retorna um esquema diferente daquele que acabamos de criar.</span><span class="sxs-lookup"><span data-stu-id="82701-240">In short, the wizard is noting that the TableAdapter s main query `GetCategories()` returns a different schema than the one we just created.</span></span> <span data-ttu-id="82701-241">Mas isso é o que queremos, para que você possa desconsiderar essa mensagem.</span><span class="sxs-lookup"><span data-stu-id="82701-241">But this is what we want, so you can disregard this message.</span></span>

<span data-ttu-id="82701-242">Além disso, tenha em mente que, se você estiver usando instruções SQL ad hoc e usar o assistente para alterar a consulta principal do TableAdapter s em algum momento posterior, ele modificará a lista de colunas do `GetCategoryWithBinaryDataByCategoryID` método s `SELECT` instrução s para incluir apenas as colunas da consulta principal (ou seja, removerá a coluna `Picture` da consulta).</span><span class="sxs-lookup"><span data-stu-id="82701-242">Also, keep in mind that if you are using ad-hoc SQL statements and use the wizard to change the TableAdapter s main query at some later point in time, it will modify the `GetCategoryWithBinaryDataByCategoryID` method s `SELECT` statement s column list to include just those columns from the main query (that is, it will remove the `Picture` column from the query).</span></span> <span data-ttu-id="82701-243">Você precisará atualizar manualmente a lista de colunas para retornar a coluna `Picture`, semelhante ao que fizemos com o método `GetCategoriesAndNumberOfProducts()` anteriormente nesta etapa.</span><span class="sxs-lookup"><span data-stu-id="82701-243">You will have to manually update the column list to return the `Picture` column, similar to what we did with the `GetCategoriesAndNumberOfProducts()` method earlier in this step.</span></span>

<span data-ttu-id="82701-244">Depois de adicionar os dois `DataColumn` s ao `CategoriesDataTable` e ao método `GetCategoryWithBinaryDataByCategoryID` ao `CategoriesTableAdapter`, essas classes no designer de conjunto de um DataSet devem ser semelhantes à captura de tela da Figura 11.</span><span class="sxs-lookup"><span data-stu-id="82701-244">After adding the two `DataColumn` s to the `CategoriesDataTable` and the `GetCategoryWithBinaryDataByCategoryID` method to the `CategoriesTableAdapter`, these classes in the Typed DataSet Designer should look like the screenshot in Figure 11.</span></span>

![O designer de conjunto de um inclui as novas colunas e o método](uploading-files-cs/_static/image11.gif)

<span data-ttu-id="82701-246">**Figura 11**: o DataSet Designer inclui as novas colunas e o método</span><span class="sxs-lookup"><span data-stu-id="82701-246">**Figure 11**: The DataSet Designer Includes the New Columns and Method</span></span>

## <a name="updating-the-business-logic-layer-bll"></a><span data-ttu-id="82701-247">Atualizando a camada de lógica de negócios (BLL)</span><span class="sxs-lookup"><span data-stu-id="82701-247">Updating the Business Logic Layer (BLL)</span></span>

<span data-ttu-id="82701-248">Com a DAL atualizada, tudo o que resta é aumentar a camada de lógica de negócios (BLL) para incluir um método para o novo método de `CategoriesTableAdapter`.</span><span class="sxs-lookup"><span data-stu-id="82701-248">With the DAL updated, all that remains is to augment the Business Logic Layer (BLL) to include a method for the new `CategoriesTableAdapter` method.</span></span> <span data-ttu-id="82701-249">Adicione o seguinte método à classe `CategoriesBLL`:</span><span class="sxs-lookup"><span data-stu-id="82701-249">Add the following method to the `CategoriesBLL` class:</span></span>

[!code-csharp[Main](uploading-files-cs/samples/sample4.cs)]

## <a name="step-5-uploading-a-file-from-the-client-to-the-web-server"></a><span data-ttu-id="82701-250">Etapa 5: carregando um arquivo do cliente para o servidor Web</span><span class="sxs-lookup"><span data-stu-id="82701-250">Step 5: Uploading a File From the Client to the Web Server</span></span>

<span data-ttu-id="82701-251">Ao coletar dados binários, muitas vezes esses dados são fornecidos por um usuário final.</span><span class="sxs-lookup"><span data-stu-id="82701-251">When collecting binary data, oftentimes this data is supplied by an end user.</span></span> <span data-ttu-id="82701-252">Para capturar essas informações, o usuário precisa ser capaz de carregar um arquivo de seu computador para o servidor Web.</span><span class="sxs-lookup"><span data-stu-id="82701-252">To capture this information, the user needs to be able to upload a file from their computer to the web server.</span></span> <span data-ttu-id="82701-253">Os dados carregados, em seguida, precisam ser integrados ao modelo de dados, o que pode significar salvar o arquivo no sistema de arquivos do servidor Web e adicionar um caminho ao arquivo no banco de dado ou gravar o conteúdo binário diretamente no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="82701-253">The uploaded data then needs to be integrated with the data model, which may mean saving the file to the web server s file system and adding a path to the file in the database, or writing the binary contents directly into the database.</span></span> <span data-ttu-id="82701-254">Nesta etapa, veremos como permitir que um usuário carregue arquivos de seu computador para o servidor.</span><span class="sxs-lookup"><span data-stu-id="82701-254">In this step we'll look at how to allow a user to upload files from their computer to the server.</span></span> <span data-ttu-id="82701-255">No próximo tutorial, vamos transformar nossa atenção para integrar o arquivo carregado com o modelo de dados.</span><span class="sxs-lookup"><span data-stu-id="82701-255">In the next tutorial we'll turn our attention to integrating the uploaded file with data model.</span></span>

<span data-ttu-id="82701-256">O novo [controle da Web de FileUpload](https://msdn.microsoft.com/library/ms227677(VS.80).aspx) do ASP.NET 2,0 fornece um mecanismo para que os usuários enviem um arquivo do computador para o servidor Web.</span><span class="sxs-lookup"><span data-stu-id="82701-256">ASP.NET 2.0 s new [FileUpload Web control](https://msdn.microsoft.com/library/ms227677(VS.80).aspx) provides a mechanism for users to send a file from their computer to the web server.</span></span> <span data-ttu-id="82701-257">O controle FileUpload é renderizado como um elemento `<input>` cujo atributo `type` é definido como File, que os navegadores exibem como uma caixa de texto com um botão procurar.</span><span class="sxs-lookup"><span data-stu-id="82701-257">The FileUpload control renders as an `<input>` element whose `type` attribute is set to file, which browsers display as a textbox with a Browse button.</span></span> <span data-ttu-id="82701-258">Clicar no botão procurar abre uma caixa de diálogo da qual o usuário pode selecionar um arquivo.</span><span class="sxs-lookup"><span data-stu-id="82701-258">Clicking the Browse button brings up a dialog box from which the user can select a file.</span></span> <span data-ttu-id="82701-259">Quando o formulário é Postado de volta, o conteúdo do arquivo s selecionado é enviado junto com o postback.</span><span class="sxs-lookup"><span data-stu-id="82701-259">When the form is posted back, the selected file s contents are sent along with the postback.</span></span> <span data-ttu-id="82701-260">No lado do servidor, as informações sobre o arquivo carregado podem ser acessadas por meio das propriedades do controle FileUpload s.</span><span class="sxs-lookup"><span data-stu-id="82701-260">On the server-side, information about the uploaded file is accessible through the FileUpload control s properties.</span></span>

<span data-ttu-id="82701-261">Para demonstrar o carregamento de arquivos, abra a página `FileUpload.aspx` na pasta `BinaryData`, arraste um controle FileUpload da caixa de ferramentas para o designer e defina a propriedade do controle s `ID` como `UploadTest`.</span><span class="sxs-lookup"><span data-stu-id="82701-261">To demonstrate uploading files, open the `FileUpload.aspx` page in the `BinaryData` folder, drag a FileUpload control from the Toolbox onto the Designer, and set the control s `ID` property to `UploadTest`.</span></span> <span data-ttu-id="82701-262">Em seguida, adicione um botão controle da Web definindo suas propriedades `ID` e `Text` para `UploadButton` e carregar o arquivo selecionado, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="82701-262">Next, add a Button Web control setting its `ID` and `Text` properties to `UploadButton` and Upload Selected File, respectively.</span></span> <span data-ttu-id="82701-263">Por fim, coloque um controle da Web de rótulo abaixo do botão, desmarque sua propriedade `Text` e defina sua propriedade `ID` como `UploadDetails`.</span><span class="sxs-lookup"><span data-stu-id="82701-263">Finally, place a Label Web control beneath the Button, clear out its `Text` property and set its `ID` property to `UploadDetails`.</span></span>

<span data-ttu-id="82701-264">[![adicionar um controle FileUpload à página ASP.NET](uploading-files-cs/_static/image12.gif)](uploading-files-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="82701-264">[![Add a FileUpload Control to the ASP.NET Page](uploading-files-cs/_static/image12.gif)](uploading-files-cs/_static/image17.png)</span></span>

<span data-ttu-id="82701-265">**Figura 12**: adicionar um controle FileUpload à página ASP.net ([clique para exibir a imagem em tamanho normal](uploading-files-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="82701-265">**Figure 12**: Add a FileUpload Control to the ASP.NET Page ([Click to view full-size image](uploading-files-cs/_static/image18.png))</span></span>

<span data-ttu-id="82701-266">A Figura 13 mostra essa página quando exibida por meio de um navegador.</span><span class="sxs-lookup"><span data-stu-id="82701-266">Figure 13 shows this page when viewed through a browser.</span></span> <span data-ttu-id="82701-267">Observe que clicar no botão procurar abre uma caixa de diálogo de seleção de arquivo, permitindo que o usuário escolha um arquivo de seu computador.</span><span class="sxs-lookup"><span data-stu-id="82701-267">Note that clicking the Browse button brings up a file selection dialog box, allowing the user to pick a file from their computer.</span></span> <span data-ttu-id="82701-268">Depois que um arquivo tiver sido selecionado, clicar no botão carregar arquivo selecionado causará um postback que envia o conteúdo binário do arquivo selecionado para o servidor Web.</span><span class="sxs-lookup"><span data-stu-id="82701-268">Once a file has been selected, clicking the Upload Selected File button causes a postback that sends the selected file s binary content to the web server.</span></span>

<span data-ttu-id="82701-269">[![o usuário pode selecionar um arquivo para carregar de seu computador para o servidor](uploading-files-cs/_static/image13.gif)](uploading-files-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="82701-269">[![The User Can Select a File to Upload from their Computer to the Server](uploading-files-cs/_static/image13.gif)](uploading-files-cs/_static/image19.png)</span></span>

<span data-ttu-id="82701-270">**Figura 13**: o usuário pode selecionar um arquivo para carregar de seu computador para o servidor ([clique para exibir a imagem em tamanho normal](uploading-files-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="82701-270">**Figure 13**: The User Can Select a File to Upload from their Computer to the Server ([Click to view full-size image](uploading-files-cs/_static/image20.png))</span></span>

<span data-ttu-id="82701-271">No postback, o arquivo carregado pode ser salvo no sistema de arquivos ou seus dados binários podem ser trabalhados diretamente por meio de um fluxo.</span><span class="sxs-lookup"><span data-stu-id="82701-271">On postback, the uploaded file can be saved to the file system or its binary data can be worked with directly through a Stream.</span></span> <span data-ttu-id="82701-272">Para este exemplo, vamos criar uma pasta `~/Brochures` e salvar o arquivo carregado.</span><span class="sxs-lookup"><span data-stu-id="82701-272">For this example, let s create a `~/Brochures` folder and save the uploaded file there.</span></span> <span data-ttu-id="82701-273">Comece adicionando a pasta `Brochures` ao site como uma subpasta do diretório raiz.</span><span class="sxs-lookup"><span data-stu-id="82701-273">Start by adding the `Brochures` folder to the site as a subfolder of the root directory.</span></span> <span data-ttu-id="82701-274">Em seguida, crie um manipulador de eventos para o evento `UploadButton` s `Click` e adicione o seguinte código:</span><span class="sxs-lookup"><span data-stu-id="82701-274">Next, create an event handler for the `UploadButton` s `Click` event and add the following code:</span></span>

[!code-csharp[Main](uploading-files-cs/samples/sample5.cs)]

<span data-ttu-id="82701-275">O controle FileUpload fornece uma variedade de propriedades para trabalhar com os dados carregados.</span><span class="sxs-lookup"><span data-stu-id="82701-275">The FileUpload control provides a variety of properties for working with the uploaded data.</span></span> <span data-ttu-id="82701-276">Por exemplo, a [propriedade`HasFile`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.hasfile.aspx) indica se um arquivo foi carregado pelo usuário, enquanto a [Propriedade`FileBytes`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.filebytes.aspx) fornece acesso aos dados binários carregados como uma matriz de bytes.</span><span class="sxs-lookup"><span data-stu-id="82701-276">For instance, the [`HasFile` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.hasfile.aspx) indicates whether a file was uploaded by the user, while the [`FileBytes` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.filebytes.aspx) provides access to the uploaded binary data as an array of bytes.</span></span> <span data-ttu-id="82701-277">O manipulador de eventos `Click` começa garantindo que um arquivo foi carregado.</span><span class="sxs-lookup"><span data-stu-id="82701-277">The `Click` event handler starts by ensuring that a file has been uploaded.</span></span> <span data-ttu-id="82701-278">Se um arquivo tiver sido carregado, o rótulo mostrará o nome do arquivo carregado, seu tamanho em bytes e seu tipo de conteúdo.</span><span class="sxs-lookup"><span data-stu-id="82701-278">If a file has been uploaded, the Label shows the name of the uploaded file, its size in bytes, and its content-type.</span></span>

> [!NOTE]
> <span data-ttu-id="82701-279">Para garantir que o usuário carregue um arquivo, você pode verificar a propriedade `HasFile` e exibir um aviso se ele `false`, ou você pode usar o [controle RequiredFieldValidator](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/validation/default.aspx) em vez disso.</span><span class="sxs-lookup"><span data-stu-id="82701-279">To ensure that the user uploads a file you can check the `HasFile` property and display a warning if it s `false`, or you may use the [RequiredFieldValidator control](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/validation/default.aspx) instead.</span></span>

<span data-ttu-id="82701-280">A `SaveAs(filePath)` FileUpload s salva o arquivo carregado no *FilePath*especificado.</span><span class="sxs-lookup"><span data-stu-id="82701-280">The FileUpload s `SaveAs(filePath)` saves the uploaded file to the specified *filePath*.</span></span> <span data-ttu-id="82701-281">*FilePath* deve ser um *caminho físico* (`C:\Websites\Brochures\SomeFile.pdf`) em vez de um *caminho* *virtual* (`/Brochures/SomeFile.pdf`).</span><span class="sxs-lookup"><span data-stu-id="82701-281">*filePath* must be a *physical path* (`C:\Websites\Brochures\SomeFile.pdf`) rather than a *virtual* *path* (`/Brochures/SomeFile.pdf`).</span></span> <span data-ttu-id="82701-282">O [método`Server.MapPath(virtPath)`](https://msdn.microsoft.com/library/system.web.httpserverutility.mappath.aspx) usa um caminho virtual e retorna seu caminho físico correspondente.</span><span class="sxs-lookup"><span data-stu-id="82701-282">The [`Server.MapPath(virtPath)` method](https://msdn.microsoft.com/library/system.web.httpserverutility.mappath.aspx) takes a virtual path and returns its corresponding physical path.</span></span> <span data-ttu-id="82701-283">Aqui, o caminho virtual é `~/Brochures/fileName`, em que *filename* é o nome do arquivo carregado.</span><span class="sxs-lookup"><span data-stu-id="82701-283">Here, the virtual path is `~/Brochures/fileName`, where *fileName* is the name of the uploaded file.</span></span> <span data-ttu-id="82701-284">Consulte [usando o Server. MapPath](http://www.4guysfromrolla.com/webtech/121799-1.shtml) para obter mais informações sobre caminhos físicos e virtuais e usando `Server.MapPath`.</span><span class="sxs-lookup"><span data-stu-id="82701-284">See [Using Server.MapPath](http://www.4guysfromrolla.com/webtech/121799-1.shtml) for more information on virtual and physical paths and using `Server.MapPath`.</span></span>

<span data-ttu-id="82701-285">Depois de concluir o manipulador de eventos `Click`, Reserve um tempo para testar a página em um navegador.</span><span class="sxs-lookup"><span data-stu-id="82701-285">After completing the `Click` event handler, take a moment to test out the page in a browser.</span></span> <span data-ttu-id="82701-286">Clique no botão procurar e selecione um arquivo do disco rígido e, em seguida, clique no botão carregar arquivo selecionado.</span><span class="sxs-lookup"><span data-stu-id="82701-286">Click the Browse button and select a file from your hard drive and then click the Upload Selected File button.</span></span> <span data-ttu-id="82701-287">O postback enviará o conteúdo do arquivo selecionado para o servidor Web, que exibirá informações sobre o arquivo antes de salvá-lo na pasta `~/Brochures`.</span><span class="sxs-lookup"><span data-stu-id="82701-287">The postback will send the contents of the selected file to the web server, which will then display information about the file before saving it to the `~/Brochures` folder.</span></span> <span data-ttu-id="82701-288">Depois de carregar o arquivo, retorne ao Visual Studio e clique no botão atualizar na Gerenciador de Soluções.</span><span class="sxs-lookup"><span data-stu-id="82701-288">After uploading the file, return to Visual Studio and click the Refresh button in the Solution Explorer.</span></span> <span data-ttu-id="82701-289">Você deve ver o arquivo que acabou de carregar na pasta ~/brochures!</span><span class="sxs-lookup"><span data-stu-id="82701-289">You should see the file you just uploaded in the ~/Brochures folder!</span></span>

<span data-ttu-id="82701-290">[![o arquivo EvolutionValley. jpg foi carregado no servidor Web](uploading-files-cs/_static/image14.gif)](uploading-files-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="82701-290">[![The File EvolutionValley.jpg Has Been Uploaded to the Web Server](uploading-files-cs/_static/image14.gif)](uploading-files-cs/_static/image21.png)</span></span>

<span data-ttu-id="82701-291">**Figura 14**: o arquivo `EvolutionValley.jpg` foi carregado no servidor Web ([clique para exibir a imagem em tamanho normal](uploading-files-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="82701-291">**Figure 14**: The File `EvolutionValley.jpg` Has Been Uploaded to the Web Server ([Click to view full-size image](uploading-files-cs/_static/image22.png))</span></span>

![EvolutionValley. jpg foi salvo na pasta ~/brochures](uploading-files-cs/_static/image15.gif)

<span data-ttu-id="82701-293">**Figura 15**: `EvolutionValley.jpg` foi salva na pasta `~/Brochures`</span><span class="sxs-lookup"><span data-stu-id="82701-293">**Figure 15**: `EvolutionValley.jpg` Was Saved to the `~/Brochures` Folder</span></span>

## <a name="subtleties-with-saving-uploaded-files-to-the-file-system"></a><span data-ttu-id="82701-294">Sutilezas com o salvamento de arquivos carregados no sistema de arquivos</span><span class="sxs-lookup"><span data-stu-id="82701-294">Subtleties with Saving Uploaded Files to the File System</span></span>

<span data-ttu-id="82701-295">Há várias sutilezas que devem ser abordadas ao salvar os arquivos de carregamento no sistema de arquivos do servidor Web.</span><span class="sxs-lookup"><span data-stu-id="82701-295">There are several subtleties that must be addressed when saving uploading files to the web server s file system.</span></span> <span data-ttu-id="82701-296">Primeiro, há o problema de segurança.</span><span class="sxs-lookup"><span data-stu-id="82701-296">First, there s the issue of security.</span></span> <span data-ttu-id="82701-297">Para salvar um arquivo no sistema de arquivos, o contexto de segurança no qual a página ASP.NET está sendo executada deve ter permissões de gravação.</span><span class="sxs-lookup"><span data-stu-id="82701-297">To save a file to the file system, the security context under which the ASP.NET page is executing must have Write permissions.</span></span> <span data-ttu-id="82701-298">O servidor Web de desenvolvimento ASP.NET é executado sob o contexto da sua conta de usuário atual.</span><span class="sxs-lookup"><span data-stu-id="82701-298">The ASP.NET Development Web Server runs under the context of your current user account.</span></span> <span data-ttu-id="82701-299">Se você estiver usando o Microsoft s Serviços de Informações da Internet (IIS) como o servidor Web, o contexto de segurança dependerá da versão do IIS e de sua configuração.</span><span class="sxs-lookup"><span data-stu-id="82701-299">If you are using Microsoft s Internet Information Services (IIS) as the web server, the security context depends on the version of IIS and its configuration.</span></span>

<span data-ttu-id="82701-300">Outro desafio de salvar arquivos no sistema de arquivos gira em contranomear os arquivos.</span><span class="sxs-lookup"><span data-stu-id="82701-300">Another challenge of saving files to the file system revolves around naming the files.</span></span> <span data-ttu-id="82701-301">Atualmente, nossa página salva todos os arquivos carregados no diretório `~/Brochures` usando o mesmo nome do arquivo no computador do cliente.</span><span class="sxs-lookup"><span data-stu-id="82701-301">Currently, our page saves all of the uploaded files to the `~/Brochures` directory using the same name as the file on the client s computer.</span></span> <span data-ttu-id="82701-302">Se o usuário A carregar um folheto com o nome `Brochure.pdf`, o arquivo será salvo como `~/Brochure/Brochure.pdf`.</span><span class="sxs-lookup"><span data-stu-id="82701-302">If User A uploads a brochure with the name `Brochure.pdf`, the file will be saved as `~/Brochure/Brochure.pdf`.</span></span> <span data-ttu-id="82701-303">Mas e se algum tempo depois o usuário B carregar um arquivo de folheto diferente que tem o mesmo nome de arquivo (`Brochure.pdf`)?</span><span class="sxs-lookup"><span data-stu-id="82701-303">But what if sometime later User B uploads a different brochure file that happens to have the same filename (`Brochure.pdf`)?</span></span> <span data-ttu-id="82701-304">Com o código que temos agora, o arquivo A s do usuário será substituído pelo carregamento do usuário B s.</span><span class="sxs-lookup"><span data-stu-id="82701-304">With the code we have now, User A s file will be overwritten with User B s upload.</span></span>

<span data-ttu-id="82701-305">Há várias técnicas para resolver conflitos de nome de arquivo.</span><span class="sxs-lookup"><span data-stu-id="82701-305">There are a number of techniques for resolving file name conflicts.</span></span> <span data-ttu-id="82701-306">Uma opção é proibir o carregamento de um arquivo, caso já exista um com o mesmo nome.</span><span class="sxs-lookup"><span data-stu-id="82701-306">One option is to prohibit uploading a file if there already exists one with the same name.</span></span> <span data-ttu-id="82701-307">Com essa abordagem, quando o usuário B tenta carregar um arquivo chamado `Brochure.pdf`, o sistema não salvaria seu arquivo e exibiria uma mensagem informando ao usuário B para renomear o arquivo e tentar novamente.</span><span class="sxs-lookup"><span data-stu-id="82701-307">With this approach, when User B attempts to upload a file named `Brochure.pdf`, the system would not save their file and instead display a message informing User B to rename the file and try again.</span></span> <span data-ttu-id="82701-308">Outra abordagem é salvar o arquivo usando um nome de arquivo exclusivo, que poderia ser um [GUID (identificador global exclusivo)](http://en.wikipedia.org/wiki/Globally_Unique_Identifier) ou o valor das colunas de chave primária (s) do registro de banco de dados correspondente (supondo que o carregamento esteja associado a uma linha específica no modelo de dados).</span><span class="sxs-lookup"><span data-stu-id="82701-308">Another approach is to save the file using a unique file name, which could be a [globally unique identifier (GUID)](http://en.wikipedia.org/wiki/Globally_Unique_Identifier) or the value from the corresponding database record s primary key column(s) (assuming that the upload is associated with a particular row in the data model).</span></span> <span data-ttu-id="82701-309">No próximo tutorial, exploraremos essas opções mais detalhadamente.</span><span class="sxs-lookup"><span data-stu-id="82701-309">In the next tutorial we'll explore these options in more detail.</span></span>

## <a name="challenges-involved-with-very-large-amounts-of-binary-data"></a><span data-ttu-id="82701-310">Desafios envolvidos com grandes quantidades de dados binários</span><span class="sxs-lookup"><span data-stu-id="82701-310">Challenges Involved with Very Large Amounts of Binary Data</span></span>

<span data-ttu-id="82701-311">Esses tutoriais pressupõem que os dados binários capturados tenham um tamanho modesto.</span><span class="sxs-lookup"><span data-stu-id="82701-311">These tutorials assume that the binary data captured is modest in size.</span></span> <span data-ttu-id="82701-312">Trabalhar com grandes quantidades de arquivos de dados binários que são vários megabytes ou maiores apresenta novos desafios que estão além do escopo desses tutoriais.</span><span class="sxs-lookup"><span data-stu-id="82701-312">Working with very large amounts of binary data files that are several megabytes or larger introduces new challenges that are beyond the scope of these tutorials.</span></span> <span data-ttu-id="82701-313">Por exemplo, por padrão, o ASP.NET rejeitará os carregamentos de mais de 4 MB, embora isso possa ser configurado por meio do [elemento`<httpRuntime>`](https://msdn.microsoft.com/library/e1f13641.aspx) no `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="82701-313">For example, by default ASP.NET will reject uploads of more than 4 MB, although this can be configured through the [`<httpRuntime>` element](https://msdn.microsoft.com/library/e1f13641.aspx) in `Web.config`.</span></span> <span data-ttu-id="82701-314">O IIS impõe também suas próprias limitações de tamanho de upload de arquivo.</span><span class="sxs-lookup"><span data-stu-id="82701-314">IIS imposes its own file upload size limitations, too.</span></span> <span data-ttu-id="82701-315">Consulte [tamanho do arquivo de carregamento do IIS](http://vandamme.typepad.com/development/2005/09/iis_upload_file.html) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="82701-315">See [IIS Upload File Size](http://vandamme.typepad.com/development/2005/09/iis_upload_file.html) for more information.</span></span> <span data-ttu-id="82701-316">Além disso, o tempo necessário para carregar arquivos grandes pode exceder o padrão de 110 segundos ASP.NET aguardará uma solicitação.</span><span class="sxs-lookup"><span data-stu-id="82701-316">Furthermore, the time taken to upload large files might exceed the default 110 seconds ASP.NET will wait for a request.</span></span> <span data-ttu-id="82701-317">Também há problemas de memória e desempenho que surgem ao trabalhar com arquivos grandes.</span><span class="sxs-lookup"><span data-stu-id="82701-317">There are also memory and performance issues that arise when working with large files.</span></span>

<span data-ttu-id="82701-318">O controle FileUpload é impraticável para carregamentos de arquivos grandes.</span><span class="sxs-lookup"><span data-stu-id="82701-318">The FileUpload control is impractical for large file uploads.</span></span> <span data-ttu-id="82701-319">À medida que o conteúdo do arquivo está sendo Postado no servidor, o usuário final deve aguardar o paciente sem qualquer confirmação de que o upload está progredindo.</span><span class="sxs-lookup"><span data-stu-id="82701-319">As the file s contents are being posted to the server, the end user must patiently wait without any confirmation that their upload is progressing.</span></span> <span data-ttu-id="82701-320">Isso não é muito um problema ao lidar com arquivos menores que podem ser carregados em alguns segundos, mas pode ser um problema ao lidar com arquivos maiores que podem levar minutos para serem carregados.</span><span class="sxs-lookup"><span data-stu-id="82701-320">This is not so much an issue when dealing with smaller files that can be uploaded in a few seconds, but can be an issue when dealing with larger files that may take minutes to upload.</span></span> <span data-ttu-id="82701-321">Há uma variedade de controles de upload de arquivo de terceiros que são mais adequados para lidar com grandes carregamentos e muitos desses fornecedores fornecem indicadores de progresso e gerenciadores de carregamento do ActiveX que apresentam uma experiência de usuário muito mais elegante.</span><span class="sxs-lookup"><span data-stu-id="82701-321">There are a variety of third-party file upload controls that are better suited for handling large uploads and many of these vendors provide progress indicators and ActiveX upload managers that present a much more polished user experience.</span></span>

<span data-ttu-id="82701-322">Se seu aplicativo precisar lidar com arquivos grandes, você precisará investigar cuidadosamente os desafios e encontrar soluções adequadas para suas necessidades específicas.</span><span class="sxs-lookup"><span data-stu-id="82701-322">If your application needs to handle large files, you'll need to carefully investigate the challenges and find suitable solutions for your particular needs.</span></span>

## <a name="summary"></a><span data-ttu-id="82701-323">Resumo</span><span class="sxs-lookup"><span data-stu-id="82701-323">Summary</span></span>

<span data-ttu-id="82701-324">A criação de um aplicativo que precisa capturar dados binários apresenta vários desafios.</span><span class="sxs-lookup"><span data-stu-id="82701-324">Building an application that needs to capture binary data introduces a number of challenges.</span></span> <span data-ttu-id="82701-325">Neste tutorial, exploramos os dois primeiros: decidindo onde armazenar os dados binários e permitindo que um usuário carregue conteúdo binário por meio de uma página da Web.</span><span class="sxs-lookup"><span data-stu-id="82701-325">In this tutorial we explored the first two: deciding where to store the binary data and allowing a user to upload binary content through a web page.</span></span> <span data-ttu-id="82701-326">Nos próximos três tutoriais, veremos como associar os dados carregados a um registro no banco de dados, além de como exibir os dados binários junto com seus campos de texto.</span><span class="sxs-lookup"><span data-stu-id="82701-326">Over the next three tutorials, we'll see how to associate the uploaded data with a record in the database as well as how to display the binary data alongside its text data fields.</span></span>

<span data-ttu-id="82701-327">Boa programação!</span><span class="sxs-lookup"><span data-stu-id="82701-327">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="82701-328">Leitura adicional</span><span class="sxs-lookup"><span data-stu-id="82701-328">Further Reading</span></span>

<span data-ttu-id="82701-329">Para obter mais informações sobre os tópicos discutidos neste tutorial, consulte os seguintes recursos:</span><span class="sxs-lookup"><span data-stu-id="82701-329">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="82701-330">Usando tipos de dados de valor grande</span><span class="sxs-lookup"><span data-stu-id="82701-330">Using Large-Value Data Types</span></span>](https://msdn.microsoft.com/library/ms178158.aspx)
- [<span data-ttu-id="82701-331">Início rápido do controle FileUpload</span><span class="sxs-lookup"><span data-stu-id="82701-331">FileUpload Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/standard/fileupload.aspx)
- [<span data-ttu-id="82701-332">O controle de servidor FileUpload do ASP.NET 2,0</span><span class="sxs-lookup"><span data-stu-id="82701-332">The ASP.NET 2.0 FileUpload Server Control</span></span>](http://www.wrox.com/WileyCDA/Section/id-292158.html)
- [<span data-ttu-id="82701-333">O lado escuro dos carregamentos de arquivos</span><span class="sxs-lookup"><span data-stu-id="82701-333">The Dark Side of File Uploads</span></span>](http://www.aspnetresources.com/articles/dark_side_of_file_uploads.aspx)

## <a name="about-the-author"></a><span data-ttu-id="82701-334">Sobre o autor</span><span class="sxs-lookup"><span data-stu-id="82701-334">About the Author</span></span>

<span data-ttu-id="82701-335">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor de sete livros sobre ASP/ASP. net e fundador da [4guysfromrolla.com](http://www.4guysfromrolla.com), tem trabalhado com tecnologias Web da Microsoft desde 1998.</span><span class="sxs-lookup"><span data-stu-id="82701-335">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="82701-336">Scott trabalha como consultor, instrutor e escritor independentes.</span><span class="sxs-lookup"><span data-stu-id="82701-336">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="82701-337">Seu livro mais recente é que a [*Sams ensina a ASP.NET 2,0 em 24 horas*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="82701-337">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="82701-338">Ele pode ser acessado em [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="82701-338">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="82701-339">ou por meio de seu blog, que pode ser encontrado em [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="82701-339">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="82701-340">Agradecimentos especiais a</span><span class="sxs-lookup"><span data-stu-id="82701-340">Special Thanks To</span></span>

<span data-ttu-id="82701-341">Esta série de tutoriais foi revisada por muitos revisores úteis.</span><span class="sxs-lookup"><span data-stu-id="82701-341">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="82701-342">Os revisores potenciais para este tutorial foram Teresa Murphy e Bernadette Leigh.</span><span class="sxs-lookup"><span data-stu-id="82701-342">Lead reviewers for this tutorial were Teresa Murphy and Bernadette Leigh.</span></span> <span data-ttu-id="82701-343">Está interessado em revisar meus artigos futuros do MSDN?</span><span class="sxs-lookup"><span data-stu-id="82701-343">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="82701-344">Em caso afirmativo, solte-me uma linha em [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="82701-344">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="82701-345">Avançar</span><span class="sxs-lookup"><span data-stu-id="82701-345">Next</span></span>](displaying-binary-data-in-the-data-web-controls-cs.md)
