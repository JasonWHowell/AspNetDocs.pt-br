---
uid: web-forms/overview/deployment/advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments
title: Personalizando implantações de banco de dados para vários ambientes | Microsoft Docs
author: jrjlee
description: 'Este tópico descreve como personalizar as propriedades de um banco de dados para ambientes de destino específicos como parte do processo de implantação. Observação: o tópico pressupõe th...'
ms.author: riande
ms.date: 05/04/2012
ms.assetid: a172979a-1318-4318-a9c6-4f9560d26267
msc.legacyurl: /web-forms/overview/deployment/advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments
msc.type: authoredcontent
ms.openlocfilehash: 8ae8cb1a322afb95c5d2e8d5e73c7825c7b2fe5a
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78604023"
---
# <a name="customizing-database-deployments-for-multiple-environments"></a><span data-ttu-id="f93a5-104">Personalização das implantações de banco de dados para vários ambientes</span><span class="sxs-lookup"><span data-stu-id="f93a5-104">Customizing Database Deployments for Multiple Environments</span></span>

<span data-ttu-id="f93a5-105">por [Jason Lee](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="f93a5-105">by [Jason Lee](https://github.com/jrjlee)</span></span>

[<span data-ttu-id="f93a5-106">Baixar PDF</span><span class="sxs-lookup"><span data-stu-id="f93a5-106">Download PDF</span></span>](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> <span data-ttu-id="f93a5-107">Este tópico descreve como personalizar as propriedades de um banco de dados para ambientes de destino específicos como parte do processo de implantação.</span><span class="sxs-lookup"><span data-stu-id="f93a5-107">This topic describes how to tailor the properties of a database to specific target environments as part of the deployment process.</span></span>
> 
> > [!NOTE]
> > <span data-ttu-id="f93a5-108">O tópico pressupõe que você está implantando um projeto de banco de dados do Visual Studio 2010 usando MSBuild. exe e VSDBCMD. exe.</span><span class="sxs-lookup"><span data-stu-id="f93a5-108">The topic assumes that you're deploying a Visual Studio 2010 database project using MSBuild.exe and VSDBCMD.exe.</span></span> <span data-ttu-id="f93a5-109">Para obter mais informações sobre por que você pode escolher essa abordagem, consulte [implantação da Web na empresa](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md) e [Implantando projetos de banco de dados](../web-deployment-in-the-enterprise/deploying-database-projects.md).</span><span class="sxs-lookup"><span data-stu-id="f93a5-109">For more information on why you might choose this approach, see [Web Deployment in the Enterprise](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md) and [Deploying Database Projects](../web-deployment-in-the-enterprise/deploying-database-projects.md).</span></span>
> 
> 
> <span data-ttu-id="f93a5-110">Ao implantar um projeto de banco de dados em vários destinos, muitas vezes você desejará personalizar as propriedades de implantação de banco de dados para cada ambiente de destino.</span><span class="sxs-lookup"><span data-stu-id="f93a5-110">When you deploy a database project to multiple destinations, you'll often want to customize the database deployment properties for each target environment.</span></span> <span data-ttu-id="f93a5-111">Por exemplo, em ambientes de teste, você normalmente recriaria o banco de dados em todas as implantações, enquanto em ambientes de preparo ou de produção você seria muito mais provável de fazer atualizações incrementais para preservar seus dados.</span><span class="sxs-lookup"><span data-stu-id="f93a5-111">For example, in test environments you'd typically recreate the database on every deployment, whereas in staging or production environments you'd be a lot more likely to make incremental updates to preserve your data.</span></span>
> 
> <span data-ttu-id="f93a5-112">Em um projeto de banco de dados do Visual Studio 2010, as configurações de implantação estão contidas em um arquivo de configuração de implantação (. sqldeployment).</span><span class="sxs-lookup"><span data-stu-id="f93a5-112">In a Visual Studio 2010 database project, deployment settings are contained within a deployment configuration (.sqldeployment) file.</span></span> <span data-ttu-id="f93a5-113">Este tópico mostrará como criar arquivos de configuração de implantação específicos do ambiente e especificar aquele que você deseja usar como um parâmetro VSDBCMD.</span><span class="sxs-lookup"><span data-stu-id="f93a5-113">This topic will show you how to create environment-specific deployment configuration files and specify the one you want to use as a VSDBCMD parameter.</span></span>

<span data-ttu-id="f93a5-114">Este tópico faz parte de uma série de tutoriais com base em relação aos requisitos de implantação empresarial de uma empresa fictícia chamada Fabrikam, Inc. Esta série de tutoriais usa uma solução&#x2014;de exemplo da&#x2014; [solução Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)para representar um aplicativo Web com um nível realista de complexidade, incluindo um aplicativo ASP.NET MVC 3, um serviço Windows Communication Foundation (WCF) e um projeto de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="f93a5-114">This topic forms part of a series of tutorials based around the enterprise deployment requirements of a fictional company named Fabrikam, Inc. This tutorial series uses a sample solution&#x2014;the [Contact Manager solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;to represent a web application with a realistic level of complexity, including an ASP.NET MVC 3 application, a Windows Communication Foundation (WCF) service, and a database project.</span></span>

<span data-ttu-id="f93a5-115">O método de implantação no coração desses tutoriais baseia-se na abordagem de arquivo de projeto dividido descrita em [noções básicas sobre o arquivo de projeto](../web-deployment-in-the-enterprise/understanding-the-project-file.md), no qual o processo de compilação é&#x2014;controlado por dois arquivos de projeto, um contendo instruções de Build que se aplicam a todos os ambientes de destino e um contendo configurações específicas de ambiente e de implantação.</span><span class="sxs-lookup"><span data-stu-id="f93a5-115">The deployment method at the heart of these tutorials is based on the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), in which the build process is controlled by two project files&#x2014;one containing build instructions that apply to every destination environment, and one containing environment-specific build and deployment settings.</span></span> <span data-ttu-id="f93a5-116">No momento da compilação, o arquivo de projeto específico do ambiente é mesclado no arquivo de projeto independente do ambiente para formar um conjunto completo de instruções de compilação.</span><span class="sxs-lookup"><span data-stu-id="f93a5-116">At build time, the environment-specific project file is merged into the environment-agnostic project file to form a complete set of build instructions.</span></span>

## <a name="task-overview"></a><span data-ttu-id="f93a5-117">Visão geral da tarefa</span><span class="sxs-lookup"><span data-stu-id="f93a5-117">Task Overview</span></span>

<span data-ttu-id="f93a5-118">Este tópico pressupõe que:</span><span class="sxs-lookup"><span data-stu-id="f93a5-118">This topic assumes that:</span></span>

- <span data-ttu-id="f93a5-119">Você usa a abordagem de arquivo de projeto dividido para implantação de solução, conforme descrito em [noções básicas sobre o arquivo de projeto](../web-deployment-in-the-enterprise/understanding-the-project-file.md).</span><span class="sxs-lookup"><span data-stu-id="f93a5-119">You use the split project file approach to solution deployment, as described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md).</span></span>
- <span data-ttu-id="f93a5-120">Você chama VSDBCMD do arquivo de projeto para implantar seu projeto de banco de dados, conforme descrito em [noções básicas sobre o processo de compilação](../web-deployment-in-the-enterprise/understanding-the-build-process.md).</span><span class="sxs-lookup"><span data-stu-id="f93a5-120">You call VSDBCMD from the project file to deploy your database project, as described in [Understanding the Build Process](../web-deployment-in-the-enterprise/understanding-the-build-process.md).</span></span>

<span data-ttu-id="f93a5-121">Para criar um sistema de implantação que dê suporte à variação das propriedades de implantação de banco de dados entre os ambientes de destino, você precisará:</span><span class="sxs-lookup"><span data-stu-id="f93a5-121">To create a deployment system that supports varying the database deployment properties between target environments, you'll need to:</span></span>

- <span data-ttu-id="f93a5-122">Crie um arquivo de configuração de implantação (. sqldeployment) para cada ambiente de destino.</span><span class="sxs-lookup"><span data-stu-id="f93a5-122">Create a deployment configuration (.sqldeployment) file for each target environment.</span></span>
- <span data-ttu-id="f93a5-123">Crie um comando VSDBCMD que especifique o arquivo de configuração de implantação como uma opção de linha de comando.</span><span class="sxs-lookup"><span data-stu-id="f93a5-123">Create a VSDBCMD command that specifies the deployment configuration file as a command-line switch.</span></span>
- <span data-ttu-id="f93a5-124">Parametrizar o comando VSDBCMD em um arquivo de projeto Microsoft Build Engine (MSBuild), para que as opções VSDBCMD sejam apropriadas para o ambiente de destino.</span><span class="sxs-lookup"><span data-stu-id="f93a5-124">Parameterize the VSDBCMD command in a Microsoft Build Engine (MSBuild) project file, so that the VSDBCMD options are appropriate to the target environment.</span></span>

<span data-ttu-id="f93a5-125">Este tópico mostrará como executar cada um desses procedimentos.</span><span class="sxs-lookup"><span data-stu-id="f93a5-125">This topic will show you how to perform each of these procedures.</span></span>

## <a name="creating-environment-specific-deployment-configuration-files"></a><span data-ttu-id="f93a5-126">Criando arquivos de configuração de implantação específicos do ambiente</span><span class="sxs-lookup"><span data-stu-id="f93a5-126">Creating Environment-Specific Deployment Configuration Files</span></span>

<span data-ttu-id="f93a5-127">Por padrão, um projeto de banco de dados contém um único arquivo de configuração de implantação chamado *Database. sqldeployment*.</span><span class="sxs-lookup"><span data-stu-id="f93a5-127">By default, a database project contains a single deployment configuration file named *Database.sqldeployment*.</span></span> <span data-ttu-id="f93a5-128">Se você abrir esse arquivo no Visual Studio 2010, poderá ver as diferentes opções de implantação disponíveis para você:</span><span class="sxs-lookup"><span data-stu-id="f93a5-128">If you open this file in Visual Studio 2010, you can see the different deployment options that are available to you:</span></span>

- <span data-ttu-id="f93a5-129">**Agrupamento de comparação de implantação**.</span><span class="sxs-lookup"><span data-stu-id="f93a5-129">**Deployment comparison collation**.</span></span> <span data-ttu-id="f93a5-130">Isso permite que você escolha se deseja usar o agrupamento de banco de dados do seu projeto (o agrupamento de *origem* ) ou o agrupamento de banco de dados do seu servidor de destino (o agrupamento de *destino* ).</span><span class="sxs-lookup"><span data-stu-id="f93a5-130">This lets you choose whether to use the database collation of your project (the *source* collation) or the database collation of your destination server (the *target* collation).</span></span> <span data-ttu-id="f93a5-131">Na maioria dos casos, você desejará usar o agrupamento de origem ao implantar em um ambiente de desenvolvimento ou teste.</span><span class="sxs-lookup"><span data-stu-id="f93a5-131">In most cases, you'll want to use the source collation when you deploy to a development or test environment.</span></span> <span data-ttu-id="f93a5-132">Ao implantar em um ambiente de preparo ou de produção, normalmente você desejará deixar o agrupamento de destino inalterado para evitar problemas de interoperabilidade.</span><span class="sxs-lookup"><span data-stu-id="f93a5-132">When you deploy to a staging or production environment, you'll usually want to leave the target collation unchanged to avoid any interoperability issues.</span></span>
- <span data-ttu-id="f93a5-133">**Implantar Propriedades de banco de dados**.</span><span class="sxs-lookup"><span data-stu-id="f93a5-133">**Deploy database properties**.</span></span> <span data-ttu-id="f93a5-134">Isso permite que você escolha se deseja aplicar as propriedades do banco de dados, conforme definido no arquivo *Database. sqlsettings* .</span><span class="sxs-lookup"><span data-stu-id="f93a5-134">This lets you choose whether to apply the database properties, as defined in the *Database.sqlsettings* file.</span></span> <span data-ttu-id="f93a5-135">Ao implantar um banco de dados pela primeira vez, você deve implantar as propriedades do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="f93a5-135">When you deploy a database for the first time, you should deploy the database properties.</span></span> <span data-ttu-id="f93a5-136">Se você estiver atualizando um banco de dados existente, as propriedades já deverão estar em vigor e você não precisará implantá-los novamente.</span><span class="sxs-lookup"><span data-stu-id="f93a5-136">If you're updating an existing database, the properties should already be in place, and you shouldn't need to deploy them again.</span></span>
- <span data-ttu-id="f93a5-137">**Sempre recriar banco de dados**.</span><span class="sxs-lookup"><span data-stu-id="f93a5-137">**Always re-create database**.</span></span> <span data-ttu-id="f93a5-138">Isso permite que você escolha se deseja recriar o banco de dados de destino toda vez que implantar ou fazer alterações incrementais para colocar o banco de dados de destino atualizado com o esquema.</span><span class="sxs-lookup"><span data-stu-id="f93a5-138">This lets you choose whether to re-create the target database every time you deploy or make incremental changes to bring the target database up to date with your schema.</span></span> <span data-ttu-id="f93a5-139">Se você recriar o banco de dados, perderá qualquer dado no banco de dados existente.</span><span class="sxs-lookup"><span data-stu-id="f93a5-139">If you re-create the database, you'll lose any data in the existing database.</span></span> <span data-ttu-id="f93a5-140">Como tal, você geralmente deve definir isso como **false** para implantações em ambientes de preparo ou de produção.</span><span class="sxs-lookup"><span data-stu-id="f93a5-140">As such, you should usually set this to **false** for deployments to staging or production environments.</span></span>
- <span data-ttu-id="f93a5-141">**Bloquear a implantação incremental se ocorrer perda de dados**.</span><span class="sxs-lookup"><span data-stu-id="f93a5-141">**Block incremental deployment if data loss might occur**.</span></span> <span data-ttu-id="f93a5-142">Isso permite que você escolha se a implantação deve ser interrompida se uma alteração no esquema de banco de dados causar a perda de dado.</span><span class="sxs-lookup"><span data-stu-id="f93a5-142">This lets you choose whether deployment should stop if a change to the database schema will cause the loss of data.</span></span> <span data-ttu-id="f93a5-143">Normalmente, você define isso como **verdadeiro** para uma implantação em um ambiente de produção, para dar a oportunidade de intervir e proteger dados importantes.</span><span class="sxs-lookup"><span data-stu-id="f93a5-143">You typically set this to **true** for a deployment to a production environment, to give you the opportunity to intervene and protect any important data.</span></span> <span data-ttu-id="f93a5-144">Se você tiver definido **sempre recriar banco de dados** como **false**, essa configuração não terá efeito.</span><span class="sxs-lookup"><span data-stu-id="f93a5-144">If you have set **Always re-create database** to **false**, this setting will have no effect.</span></span>
- <span data-ttu-id="f93a5-145">**Execute a implantação no modo de usuário único**.</span><span class="sxs-lookup"><span data-stu-id="f93a5-145">**Execute deployment in single-user mode**.</span></span> <span data-ttu-id="f93a5-146">Isso geralmente não é um problema em ambientes de desenvolvimento ou teste.</span><span class="sxs-lookup"><span data-stu-id="f93a5-146">This is not usually an issue in development or test environments.</span></span> <span data-ttu-id="f93a5-147">No entanto, você normalmente deve definir isso como **true** para implantações em ambientes de preparo ou produção.</span><span class="sxs-lookup"><span data-stu-id="f93a5-147">However, you should typically set this to **true** for deployments to staging or production environments.</span></span> <span data-ttu-id="f93a5-148">Isso impede que os usuários façam alterações no banco de dados enquanto a implantação está em andamento.</span><span class="sxs-lookup"><span data-stu-id="f93a5-148">This prevents users from making changes to the database while the deployment is underway.</span></span>
- <span data-ttu-id="f93a5-149">**Faça backup do banco de dados antes da implantação**.</span><span class="sxs-lookup"><span data-stu-id="f93a5-149">**Back up database before deployment**.</span></span> <span data-ttu-id="f93a5-150">Normalmente, você define isso como **verdadeiro** ao implantar em um ambiente de produção, como uma precaução contra perda de dados.</span><span class="sxs-lookup"><span data-stu-id="f93a5-150">You typically set this to **true** when you deploy to a production environment, as a precaution against data loss.</span></span> <span data-ttu-id="f93a5-151">Talvez você também queira defini-lo como **true** quando implantar em um ambiente de preparo, se o banco de dados de preparo contiver muitos Data.</span><span class="sxs-lookup"><span data-stu-id="f93a5-151">You may also want to set it to **true** when you deploy to a staging environment, if your staging database contains a lot of data.</span></span>
- <span data-ttu-id="f93a5-152">**Gerar instruções DROP para objetos que estão no banco de dados de destino, mas que não estão no projeto de banco de dados**.</span><span class="sxs-lookup"><span data-stu-id="f93a5-152">**Generate DROP statements for objects that are in the target database but that are not in the database project**.</span></span> <span data-ttu-id="f93a5-153">Na maioria dos casos, essa é uma parte integral e essencial da realização de alterações incrementais em um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="f93a5-153">In most cases, this is an integral and essential part of making incremental changes to a database.</span></span> <span data-ttu-id="f93a5-154">Se você tiver definido **sempre recriar banco de dados** como **false**, essa configuração não terá efeito.</span><span class="sxs-lookup"><span data-stu-id="f93a5-154">If you have set **Always re-create database** to **false**, this setting will have no effect.</span></span>
- <span data-ttu-id="f93a5-155">Não **use instruções ALTER assembly para atualizar tipos CLR**.</span><span class="sxs-lookup"><span data-stu-id="f93a5-155">**Do not use ALTER ASSEMBLY statements to update CLR types**.</span></span> <span data-ttu-id="f93a5-156">Essa configuração determina como SQL Server deve atualizar os tipos de Common Language Runtime (CLR) para versões mais recentes do assembly.</span><span class="sxs-lookup"><span data-stu-id="f93a5-156">This setting determines how SQL Server should update common language runtime (CLR) types to newer assembly versions.</span></span> <span data-ttu-id="f93a5-157">Isso deve ser definido como **false** na maioria dos cenários.</span><span class="sxs-lookup"><span data-stu-id="f93a5-157">This should be set to **false** in most scenarios.</span></span>

<span data-ttu-id="f93a5-158">Esta tabela mostra configurações de implantação típicas para ambientes de destino diferentes.</span><span class="sxs-lookup"><span data-stu-id="f93a5-158">This table shows typical deployment settings for different destination environments.</span></span> <span data-ttu-id="f93a5-159">No entanto, suas configurações podem ser diferentes dependendo dos requisitos exatos.</span><span class="sxs-lookup"><span data-stu-id="f93a5-159">However, your settings may be different depending on your exact requirements.</span></span>

|  | <span data-ttu-id="f93a5-160">Desenvolvedor/teste</span><span class="sxs-lookup"><span data-stu-id="f93a5-160">Developer/Test</span></span> | <span data-ttu-id="f93a5-161">Preparo/integração</span><span class="sxs-lookup"><span data-stu-id="f93a5-161">Staging/Integration</span></span> | <span data-ttu-id="f93a5-162">Produção</span><span class="sxs-lookup"><span data-stu-id="f93a5-162">Production</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="f93a5-163">**Agrupamento de comparação de implantação**</span><span class="sxs-lookup"><span data-stu-id="f93a5-163">**Deployment comparison collation**</span></span> | <span data-ttu-id="f93a5-164">Fonte</span><span class="sxs-lookup"><span data-stu-id="f93a5-164">Source</span></span> | <span data-ttu-id="f93a5-165">Destino</span><span class="sxs-lookup"><span data-stu-id="f93a5-165">Target</span></span> | <span data-ttu-id="f93a5-166">Destino</span><span class="sxs-lookup"><span data-stu-id="f93a5-166">Target</span></span> |
| <span data-ttu-id="f93a5-167">**Implantar Propriedades de banco de dados**</span><span class="sxs-lookup"><span data-stu-id="f93a5-167">**Deploy database properties**</span></span> | <span data-ttu-id="f93a5-168">True</span><span class="sxs-lookup"><span data-stu-id="f93a5-168">True</span></span> | <span data-ttu-id="f93a5-169">Somente a primeira vez</span><span class="sxs-lookup"><span data-stu-id="f93a5-169">First time only</span></span> | <span data-ttu-id="f93a5-170">Somente a primeira vez</span><span class="sxs-lookup"><span data-stu-id="f93a5-170">First time only</span></span> |
| <span data-ttu-id="f93a5-171">**Sempre recriar banco de dados**</span><span class="sxs-lookup"><span data-stu-id="f93a5-171">**Always re-create database**</span></span> | <span data-ttu-id="f93a5-172">True</span><span class="sxs-lookup"><span data-stu-id="f93a5-172">True</span></span> | <span data-ttu-id="f93a5-173">Falso</span><span class="sxs-lookup"><span data-stu-id="f93a5-173">False</span></span> | <span data-ttu-id="f93a5-174">Falso</span><span class="sxs-lookup"><span data-stu-id="f93a5-174">False</span></span> |
| <span data-ttu-id="f93a5-175">**Bloquear a implantação incremental se puder ocorrer perda de dados**</span><span class="sxs-lookup"><span data-stu-id="f93a5-175">**Block incremental deployment if data loss might occur**</span></span> | <span data-ttu-id="f93a5-176">Falso</span><span class="sxs-lookup"><span data-stu-id="f93a5-176">False</span></span> | <span data-ttu-id="f93a5-177">Talvez</span><span class="sxs-lookup"><span data-stu-id="f93a5-177">Maybe</span></span> | <span data-ttu-id="f93a5-178">True</span><span class="sxs-lookup"><span data-stu-id="f93a5-178">True</span></span> |
| <span data-ttu-id="f93a5-179">**Executar script de implantação no modo de usuário único**</span><span class="sxs-lookup"><span data-stu-id="f93a5-179">**Execute deployment script in single-user mode**</span></span> | <span data-ttu-id="f93a5-180">Falso</span><span class="sxs-lookup"><span data-stu-id="f93a5-180">False</span></span> | <span data-ttu-id="f93a5-181">True</span><span class="sxs-lookup"><span data-stu-id="f93a5-181">True</span></span> | <span data-ttu-id="f93a5-182">True</span><span class="sxs-lookup"><span data-stu-id="f93a5-182">True</span></span> |
| <span data-ttu-id="f93a5-183">**Fazer backup do banco de dados antes da implantação**</span><span class="sxs-lookup"><span data-stu-id="f93a5-183">**Back up database before deployment**</span></span> | <span data-ttu-id="f93a5-184">Falso</span><span class="sxs-lookup"><span data-stu-id="f93a5-184">False</span></span> | <span data-ttu-id="f93a5-185">Talvez</span><span class="sxs-lookup"><span data-stu-id="f93a5-185">Maybe</span></span> | <span data-ttu-id="f93a5-186">True</span><span class="sxs-lookup"><span data-stu-id="f93a5-186">True</span></span> |
| <span data-ttu-id="f93a5-187">**Gerar instruções DROP para objetos que estão no banco de dados de destino, mas que não estão no projeto de banco de dados**</span><span class="sxs-lookup"><span data-stu-id="f93a5-187">**Generate DROP statements for objects that are in the target database but that are not in the database project**</span></span> | <span data-ttu-id="f93a5-188">Falso</span><span class="sxs-lookup"><span data-stu-id="f93a5-188">False</span></span> | <span data-ttu-id="f93a5-189">True</span><span class="sxs-lookup"><span data-stu-id="f93a5-189">True</span></span> | <span data-ttu-id="f93a5-190">True</span><span class="sxs-lookup"><span data-stu-id="f93a5-190">True</span></span> |
| <span data-ttu-id="f93a5-191">**Não usar instruções ALTER ASSEMBLY para atualizar tipos CLR**</span><span class="sxs-lookup"><span data-stu-id="f93a5-191">**Do not use ALTER ASSEMBLY statements to update CLR types**</span></span> | <span data-ttu-id="f93a5-192">Falso</span><span class="sxs-lookup"><span data-stu-id="f93a5-192">False</span></span> | <span data-ttu-id="f93a5-193">Falso</span><span class="sxs-lookup"><span data-stu-id="f93a5-193">False</span></span> | <span data-ttu-id="f93a5-194">Falso</span><span class="sxs-lookup"><span data-stu-id="f93a5-194">False</span></span> |

> [!NOTE]
> <span data-ttu-id="f93a5-195">Para obter mais informações sobre as propriedades de implantação de banco de dados e considerações de ambiente, consulte [uma visão geral das configurações de projeto de banco de dados](https://msdn.microsoft.com/library/aa833291(v=VS.100).aspx), [como configurar propriedades de detalhes de implantação](https://msdn.microsoft.com/library/dd172125.aspx), [criar e implantar banco de dados em um ambiente de desenvolvimento isolado](https://msdn.microsoft.com/library/dd193409.aspx)e [criar e implantar bancos de dados em um ambiente de preparo ou de produção](https://msdn.microsoft.com/library/dd193413.aspx).</span><span class="sxs-lookup"><span data-stu-id="f93a5-195">For more information on database deployment properties and environment considerations, see [An Overview of Database Project Settings](https://msdn.microsoft.com/library/aa833291(v=VS.100).aspx), [How to: Configure Properties for Deployment Details](https://msdn.microsoft.com/library/dd172125.aspx), [Build and Deploy Database to an Isolated Development Environment](https://msdn.microsoft.com/library/dd193409.aspx), and [Build and Deploy Databases to a Staging or Production Environment](https://msdn.microsoft.com/library/dd193413.aspx).</span></span>

<span data-ttu-id="f93a5-196">Para dar suporte à implantação de um projeto de banco de dados em vários destinos, você deve criar um arquivo de configuração de implantação para cada ambiente de destino.</span><span class="sxs-lookup"><span data-stu-id="f93a5-196">To support the deployment of a database project to multiple destinations, you should create a deployment configuration file for each target environment.</span></span>

<span data-ttu-id="f93a5-197">**Para criar um arquivo de configuração específico do ambiente**</span><span class="sxs-lookup"><span data-stu-id="f93a5-197">**To create an environment-specific configuration file**</span></span>

1. <span data-ttu-id="f93a5-198">No Visual Studio 2010, na janela **Gerenciador de soluções** , clique com o botão direito do mouse no projeto de banco de dados e clique em **Propriedades**.</span><span class="sxs-lookup"><span data-stu-id="f93a5-198">In Visual Studio 2010, in the **Solution Explorer** window, right-click your database project, and then click **Properties**.</span></span>
2. <span data-ttu-id="f93a5-199">Na página Propriedades do projeto de banco de dados, na guia **implantar** , na linha **arquivo de configuração de implantação** , clique em **novo**.</span><span class="sxs-lookup"><span data-stu-id="f93a5-199">On the database project properties page, on the **Deploy** tab, in the **Deployment configuration file** row, click **New**.</span></span>

    ![](customizing-database-deployments-for-multiple-environments/_static/image1.png)
3. <span data-ttu-id="f93a5-200">Na caixa de diálogo **novo arquivo de configuração de implantação** , dê ao arquivo um nome significativo (por exemplo, **TestEnvironment. sqldeployment**) e, em seguida, clique em **salvar**.</span><span class="sxs-lookup"><span data-stu-id="f93a5-200">In the **New Deployment Configuration File** dialog box, give the file a meaningful name (for example, **TestEnvironment.sqldeployment**), and then click **Save**.</span></span>
4. <span data-ttu-id="f93a5-201">Na página \*[filename] \* \* \*. sqldeployment\*\*, defina as propriedades de implantação para corresponder aos requisitos do seu ambiente de destino e, em seguida, salve o arquivo.</span><span class="sxs-lookup"><span data-stu-id="f93a5-201">On the *[Filename]\*\*\*.sqldeployment*\* page, set the deployment properties to match the requirements of your destination environment, and then save the file.</span></span>

    ![](customizing-database-deployments-for-multiple-environments/_static/image2.png)
5. <span data-ttu-id="f93a5-202">Observe que o novo arquivo é adicionado à pasta propriedades em seu projeto de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="f93a5-202">Notice that the new file is added to the Properties folder in your database project.</span></span>

    ![](customizing-database-deployments-for-multiple-environments/_static/image3.png)

## <a name="specifying-the-deployment-configuration-file-in-vsdbcmd"></a><span data-ttu-id="f93a5-203">Especificando o arquivo de configuração de implantação no VSDBCMD</span><span class="sxs-lookup"><span data-stu-id="f93a5-203">Specifying the Deployment Configuration File in VSDBCMD</span></span>

<span data-ttu-id="f93a5-204">Ao usar as configurações de solução (como Debug e Release) no Visual Studio 2010, você pode associar um arquivo de configuração de implantação a cada configuração.</span><span class="sxs-lookup"><span data-stu-id="f93a5-204">When you use solution configurations (like Debug and Release) within Visual Studio 2010, you can associate a deployment configuration file with each configuration.</span></span> <span data-ttu-id="f93a5-205">Quando você cria uma configuração específica, o processo de compilação gera um arquivo de manifesto de implantação específico da configuração que aponta para o arquivo de configuração de implantação específica da configuração.</span><span class="sxs-lookup"><span data-stu-id="f93a5-205">When you build a particular configuration, the build process generates a configuration-specific deployment manifest file that points to the configuration-specific deployment configuration file.</span></span> <span data-ttu-id="f93a5-206">No entanto, um dos principais objetivos da abordagem da implantação descrita nesses tutoriais é dar às pessoas a capacidade de controlar o processo de implantação sem usar o Visual Studio 2010 e as configurações de solução.</span><span class="sxs-lookup"><span data-stu-id="f93a5-206">However, one of the main aims of the approach to deployment described in these tutorials is to give people the ability to control the deployment process without using Visual Studio 2010 and solution configurations.</span></span> <span data-ttu-id="f93a5-207">Nessa abordagem, a configuração da solução é a mesma, independentemente do ambiente de implantação de destino.</span><span class="sxs-lookup"><span data-stu-id="f93a5-207">In this approach, the solution configuration is the same regardless of the target deployment environment.</span></span> <span data-ttu-id="f93a5-208">Para personalizar sua implantação de banco de dados para um ambiente de destino específico, você pode usar as opções de linha de comando VSDBCMD para especificar o arquivo de configuração de implantação.</span><span class="sxs-lookup"><span data-stu-id="f93a5-208">To tailor your database deployment to a specific destination environment, you can use the VSDBCMD command-line options to specify your deployment configuration file.</span></span>

<span data-ttu-id="f93a5-209">Para especificar um arquivo de configuração de implantação em seu VSDBCMD, use a opção **p:/DeploymentConfigurationFile** e forneça o caminho completo para o arquivo.</span><span class="sxs-lookup"><span data-stu-id="f93a5-209">To specify a deployment configuration file in your VSDBCMD, use the **p:/DeploymentConfigurationFile** switch and provide the full path to your file.</span></span> <span data-ttu-id="f93a5-210">Isso substituirá o arquivo de configuração de implantação que o manifesto de implantação identifica.</span><span class="sxs-lookup"><span data-stu-id="f93a5-210">This will override the deployment configuration file that the deployment manifest identifies.</span></span> <span data-ttu-id="f93a5-211">Por exemplo, você pode usar esse comando VSDBCMD para implantar o banco de dados **ContactManager** em um ambiente de teste:</span><span class="sxs-lookup"><span data-stu-id="f93a5-211">For example, you could use this VSDBCMD command to deploy the **ContactManager** database to a test environment:</span></span>

[!code-console[Main](customizing-database-deployments-for-multiple-environments/samples/sample1.cmd)]

> [!NOTE]
> <span data-ttu-id="f93a5-212">Observe que o processo de compilação pode renomear o arquivo de implantação. sqlquando ele copia o arquivo para o diretório de saída.</span><span class="sxs-lookup"><span data-stu-id="f93a5-212">Note that the build process may rename your .sqldeployment file when it copies the file to the output directory.</span></span>

<span data-ttu-id="f93a5-213">Se você usar variáveis de comando SQL em seus scripts SQL de pré-implantação ou pós-implantação, poderá usar uma abordagem semelhante para associar um arquivo. sqlcmdvars específico ao ambiente à sua implantação.</span><span class="sxs-lookup"><span data-stu-id="f93a5-213">If you use SQL command variables in your pre-deployment or post-deployment SQL scripts, you can use a similar approach to associate an environment-specific .sqlcmdvars file with your deployment.</span></span> <span data-ttu-id="f93a5-214">Nesse caso, você usa a opção **p:/SqlCommandVariablesFile** para identificar o arquivo. sqlcmdvars.</span><span class="sxs-lookup"><span data-stu-id="f93a5-214">In this case, you use the **p:/SqlCommandVariablesFile** switch to identify your .sqlcmdvars file.</span></span>

## <a name="running-the-vsdbcmd-command-from-an-msbuild-project-file"></a><span data-ttu-id="f93a5-215">Executando o comando VSDBCMD de um arquivo de projeto do MSBuild</span><span class="sxs-lookup"><span data-stu-id="f93a5-215">Running the VSDBCMD Command from an MSBuild Project File</span></span>

<span data-ttu-id="f93a5-216">Você pode invocar um comando VSDBCMD de um arquivo de projeto do MSBuild usando uma tarefa **exec** em um destino do MSBuild.</span><span class="sxs-lookup"><span data-stu-id="f93a5-216">You can invoke a VSDBCMD command from an MSBuild project file by using an **Exec** task within an MSBuild target.</span></span> <span data-ttu-id="f93a5-217">Em sua forma mais simples, ele ficaria assim:</span><span class="sxs-lookup"><span data-stu-id="f93a5-217">In its simplest form, it would look like this:</span></span>

[!code-xml[Main](customizing-database-deployments-for-multiple-environments/samples/sample2.xml)]

- <span data-ttu-id="f93a5-218">Na prática, para tornar os arquivos de projeto fáceis de ler e reutilizar, você desejará criar propriedades para armazenar os vários parâmetros de linha de comando.</span><span class="sxs-lookup"><span data-stu-id="f93a5-218">In practice, to make your project files easy to read and reuse, you'll want to create properties to store the various command-line parameters.</span></span> <span data-ttu-id="f93a5-219">Isso facilita que os usuários forneçam valores de propriedade em um arquivo de projeto específico do ambiente ou substituam os valores padrão da linha de comando do MSBuild.</span><span class="sxs-lookup"><span data-stu-id="f93a5-219">This makes it easier for users to provide property values in an environment-specific project file or to override default values from the MSBuild command line.</span></span> <span data-ttu-id="f93a5-220">Se você usar a abordagem de arquivo de projeto dividido descrita em [noções básicas sobre o arquivo de projeto](../web-deployment-in-the-enterprise/understanding-the-project-file.md), deverá dividir suas instruções e propriedades de compilação entre os dois arquivos de acordo:</span><span class="sxs-lookup"><span data-stu-id="f93a5-220">If you use the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), you should divide your build instructions and properties between the two files accordingly:</span></span>
- <span data-ttu-id="f93a5-221">As configurações específicas do ambiente, como o nome de arquivo de configuração de implantação, a cadeia de conexão de banco de dados e o nome do banco de dados de destino, devem ir para o arquivo de projeto específico do ambiente.</span><span class="sxs-lookup"><span data-stu-id="f93a5-221">Environment-specific settings, like the deployment configuration filename, the database connection string, and the target database name, should go in the environment-specific project file.</span></span>
- <span data-ttu-id="f93a5-222">O destino do MSBuild que executa o comando VSDBCMD, junto com todas as propriedades universais, como o local do executável VSDBCMD, deve ir para o arquivo de projeto universal.</span><span class="sxs-lookup"><span data-stu-id="f93a5-222">The MSBuild target that runs the VSDBCMD command, together with any universal properties like the location of the VSDBCMD executable, should go in the universal project file.</span></span>

<span data-ttu-id="f93a5-223">Você também deve certificar-se de criar o projeto de banco de dados antes de invocar VSDBCMD para que o arquivo. DeployManifest seja criado e pronto para uso.</span><span class="sxs-lookup"><span data-stu-id="f93a5-223">You should also ensure that you build the database project before you invoke VSDBCMD so that the .deploymanifest file is created and ready to use.</span></span> <span data-ttu-id="f93a5-224">Você pode ver um exemplo completo dessa abordagem no tópico [noções básicas sobre o processo de compilação](../web-deployment-in-the-enterprise/understanding-the-build-process.md), que orienta você pelos arquivos de projeto na [solução de exemplo Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md).</span><span class="sxs-lookup"><span data-stu-id="f93a5-224">You can see a full example of this approach in the topic [Understanding the Build Process](../web-deployment-in-the-enterprise/understanding-the-build-process.md), which walks you through the project files in the [Contact Manager sample solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md).</span></span>

## <a name="conclusion"></a><span data-ttu-id="f93a5-225">Conclusão</span><span class="sxs-lookup"><span data-stu-id="f93a5-225">Conclusion</span></span>

<span data-ttu-id="f93a5-226">Este tópico descreveu como você pode personalizar as propriedades do banco de dados para ambientes de destino diferentes ao implantar projetos de banco de dados usando o MSBuild e o VSDBCMD.</span><span class="sxs-lookup"><span data-stu-id="f93a5-226">This topic described how you can tailor database properties to different destination environments when you deploy database projects using MSBuild and VSDBCMD.</span></span> <span data-ttu-id="f93a5-227">Essa abordagem é útil quando você precisa implantar projetos de banco de dados como parte de soluções maiores e de escala empresarial.</span><span class="sxs-lookup"><span data-stu-id="f93a5-227">This approach is useful when you need to deploy database projects as part of larger, enterprise-scale solutions.</span></span> <span data-ttu-id="f93a5-228">Essas soluções geralmente são implantadas em vários destinos, como ambientes de desenvolvimento ou teste em área restrita, plataformas de preparo ou de integração e ambientes de produção ou ao vivo.</span><span class="sxs-lookup"><span data-stu-id="f93a5-228">These solutions are often deployed to multiple destinations, like sandboxed development or test environments, staging or integration platforms, and production or live environments.</span></span> <span data-ttu-id="f93a5-229">Cada um desses ambientes de destino geralmente requer um conjunto exclusivo de propriedades de implantação de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="f93a5-229">Each of these target environments typically requires a unique set of database deployment properties.</span></span>

## <a name="further-reading"></a><span data-ttu-id="f93a5-230">Leitura adicional</span><span class="sxs-lookup"><span data-stu-id="f93a5-230">Further Reading</span></span>

<span data-ttu-id="f93a5-231">Para obter mais informações sobre como implantar projetos de banco de dados usando o VSDBCMD. exe, consulte [Implantando projetos de banco de dados](../web-deployment-in-the-enterprise/deploying-database-projects.md).</span><span class="sxs-lookup"><span data-stu-id="f93a5-231">For more information on deploying database projects using VSDBCMD.exe, see [Deploying Database Projects](../web-deployment-in-the-enterprise/deploying-database-projects.md).</span></span> <span data-ttu-id="f93a5-232">Para obter mais informações sobre como usar arquivos de projeto do MSBuild personalizados para controlar o processo de implantação, consulte [noções básicas sobre o arquivo de projeto](../web-deployment-in-the-enterprise/understanding-the-project-file.md) e [noções básicas sobre o processo de compilação](../web-deployment-in-the-enterprise/understanding-the-build-process.md).</span><span class="sxs-lookup"><span data-stu-id="f93a5-232">For more information on using custom MSBuild project files to control the deployment process, see [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md) and [Understanding the Build Process](../web-deployment-in-the-enterprise/understanding-the-build-process.md).</span></span>

<span data-ttu-id="f93a5-233">Estes artigos sobre o MSDN fornecem diretrizes mais gerais sobre a implantação de banco de dados:</span><span class="sxs-lookup"><span data-stu-id="f93a5-233">These articles on MSDN provide more general guidance on database deployment:</span></span>

- <span data-ttu-id="f93a5-234">[Uma visão geral das configurações de projeto de banco de dados](https://msdn.microsoft.com/library/aa833291(v=VS.100).aspx)</span><span class="sxs-lookup"><span data-stu-id="f93a5-234">[An Overview of Database Project Settings](https://msdn.microsoft.com/library/aa833291(v=VS.100).aspx)</span></span>
- [<span data-ttu-id="f93a5-235">Como configurar propriedades para detalhes de implantação</span><span class="sxs-lookup"><span data-stu-id="f93a5-235">How to: Configure Properties for Deployment Details</span></span>](https://msdn.microsoft.com/library/dd172125.aspx)
- [<span data-ttu-id="f93a5-236">Crie e implante bancos de dados em um ambiente de desenvolvimento isolado</span><span class="sxs-lookup"><span data-stu-id="f93a5-236">Build and Deploy Databases to an Isolated Development Environment</span></span>](https://msdn.microsoft.com/library/dd193409.aspx)
- [<span data-ttu-id="f93a5-237">Criar e implantar bancos de dados em um ambiente de preparo ou de produção</span><span class="sxs-lookup"><span data-stu-id="f93a5-237">Build and Deploy Databases to a Staging or Production Environment</span></span>](https://msdn.microsoft.com/library/dd193413.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="f93a5-238">[Anterior](performing-a-what-if-deployment.md)
> [Próximo](deploying-database-role-memberships-to-test-environments.md)</span><span class="sxs-lookup"><span data-stu-id="f93a5-238">[Previous](performing-a-what-if-deployment.md)
[Next](deploying-database-role-memberships-to-test-environments.md)</span></span>
