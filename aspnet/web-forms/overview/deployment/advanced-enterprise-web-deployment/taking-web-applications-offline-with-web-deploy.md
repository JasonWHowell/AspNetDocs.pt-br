---
uid: web-forms/overview/deployment/advanced-enterprise-web-deployment/taking-web-applications-offline-with-web-deploy
title: Colocando aplicativos Web offline com o Implantação da Web | Microsoft Docs
author: jrjlee
description: Este tópico descreve como colocar um aplicativo Web offline pela duração de uma implantação automatizada usando o Serviços de Informações da Internet (IIS) Web alerta...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 3e9f6e7d-8967-4586-94d5-d3a122f12529
msc.legacyurl: /web-forms/overview/deployment/advanced-enterprise-web-deployment/taking-web-applications-offline-with-web-deploy
msc.type: authoredcontent
ms.openlocfilehash: ba60664a0c3daa0650cd7e7cfc4ab9da08df3440
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78526064"
---
# <a name="taking-web-applications-offline-with-web-deploy"></a><span data-ttu-id="2e6b3-103">Colocar aplicativos Web em offline com a Implantação da Web</span><span class="sxs-lookup"><span data-stu-id="2e6b3-103">Taking Web Applications Offline with Web Deploy</span></span>

<span data-ttu-id="2e6b3-104">por [Jason Lee](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="2e6b3-104">by [Jason Lee](https://github.com/jrjlee)</span></span>

[<span data-ttu-id="2e6b3-105">Baixar PDF</span><span class="sxs-lookup"><span data-stu-id="2e6b3-105">Download PDF</span></span>](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> <span data-ttu-id="2e6b3-106">Este tópico descreve como colocar um aplicativo Web offline pela duração de uma implantação automatizada usando a ferramenta de implantação da Web do Serviços de Informações da Internet (IIS) (Implantação da Web).</span><span class="sxs-lookup"><span data-stu-id="2e6b3-106">This topic describes how to take a web application offline for the duration of an automated deployment using the Internet Information Services (IIS) Web Deployment Tool (Web Deploy).</span></span> <span data-ttu-id="2e6b3-107">Os usuários que navegam para o aplicativo Web são redirecionados para um *aplicativo\_arquivo offline. htm* até que a implantação seja concluída.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-107">Users who browse to the web application are redirected to an *App\_offline.htm* file until the deployment is complete.</span></span>

<span data-ttu-id="2e6b3-108">Este tópico faz parte de uma série de tutoriais com base em relação aos requisitos de implantação empresarial de uma empresa fictícia chamada Fabrikam, Inc. Esta série de tutoriais usa uma solução&#x2014;de exemplo da&#x2014; [solução Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)para representar um aplicativo Web com um nível realista de complexidade, incluindo um aplicativo ASP.NET MVC 3, um serviço Windows Communication Foundation (WCF) e um projeto de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-108">This topic forms part of a series of tutorials based around the enterprise deployment requirements of a fictional company named Fabrikam, Inc. This tutorial series uses a sample solution&#x2014;the [Contact Manager solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;to represent a web application with a realistic level of complexity, including an ASP.NET MVC 3 application, a Windows Communication Foundation (WCF) service, and a database project.</span></span>

<span data-ttu-id="2e6b3-109">O método de implantação no coração desses tutoriais baseia-se na abordagem de arquivo de projeto dividido descrita em [noções básicas sobre o arquivo de projeto](../web-deployment-in-the-enterprise/understanding-the-project-file.md), no qual o processo de compilação é&#x2014;controlado por dois arquivos de projeto, um contendo instruções de Build que se aplicam a todos os ambientes de destino e um contendo configurações específicas de ambiente e de implantação.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-109">The deployment method at the heart of these tutorials is based on the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), in which the build process is controlled by two project files&#x2014;one containing build instructions that apply to every destination environment, and one containing environment-specific build and deployment settings.</span></span> <span data-ttu-id="2e6b3-110">No momento da compilação, o arquivo de projeto específico do ambiente é mesclado no arquivo de projeto independente do ambiente para formar um conjunto completo de instruções de compilação.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-110">At build time, the environment-specific project file is merged into the environment-agnostic project file to form a complete set of build instructions.</span></span>

## <a name="task-overview"></a><span data-ttu-id="2e6b3-111">Visão geral da tarefa</span><span class="sxs-lookup"><span data-stu-id="2e6b3-111">Task Overview</span></span>

<span data-ttu-id="2e6b3-112">Em muitos cenários, você desejará colocar um aplicativo Web offline enquanto fizer alterações em componentes relacionados, como bancos de dados ou serviços Web.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-112">In a lot of scenarios, you'll want to take a web application offline while you make changes to related components, like databases or web services.</span></span> <span data-ttu-id="2e6b3-113">Normalmente, no IIS e no ASP.NET, você realiza isso colocando um arquivo chamado *App\_offline. htm* na pasta raiz do site do IIS ou do aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-113">Typically, in IIS and ASP.NET, you accomplish this by placing a file named *App\_offline.htm* in the root folder of the IIS website or web application.</span></span> <span data-ttu-id="2e6b3-114">O *aplicativo\_offline. htm* é um arquivo HTML padrão e geralmente conterá uma mensagem simples avisando o usuário de que o site está temporariamente indisponível devido à manutenção.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-114">The *App\_offline.htm* file is a standard HTML file and will usually contain a simple message advising the user that the site is temporarily unavailable due to maintenance.</span></span> <span data-ttu-id="2e6b3-115">Embora o *aplicativo\_o arquivo offline. htm* exista na pasta raiz do site, o IIS redirecionará automaticamente todas as solicitações para o arquivo.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-115">While the *App\_offline.htm* file exists in the root folder of the website, IIS will automatically redirect any requests to the file.</span></span> <span data-ttu-id="2e6b3-116">Quando terminar de fazer atualizações, você removerá o arquivo *\_offline. htm do aplicativo* e o site continuará atendendo as solicitações como de costume.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-116">When you've finished making updates, you remove the *App\_offline.htm* file and the website resumes serving requests as usual.</span></span>

<span data-ttu-id="2e6b3-117">Ao usar o Implantação da Web para executar implantações automatizadas ou de uma única etapa em um ambiente de destino, convém incorporar a adição e remoção do arquivo *. htm do aplicativo\_offline* em seu processo de implantação.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-117">When you use Web Deploy to perform automated or single-step deployments to a target environment, you may want to incorporate adding and removing the *App\_offline.htm* file into your deployment process.</span></span> <span data-ttu-id="2e6b3-118">Para fazer isso, você precisará concluir estas tarefas de alto nível:</span><span class="sxs-lookup"><span data-stu-id="2e6b3-118">To do this, you'll need to complete these high-level tasks:</span></span>

- <span data-ttu-id="2e6b3-119">No arquivo de projeto do Microsoft Build Engine (MSBuild) que você usa para controlar o processo de implantação, crie um destino do MSBuild que copia um arquivo do *aplicativo\_offline. htm* para o servidor de destino antes de qualquer tarefa de implantação começar.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-119">In the Microsoft Build Engine (MSBuild) project file that you use to control the deployment process, create an MSBuild target that copies an *App\_offline.htm* file to the destination server before any deployment tasks begin.</span></span>
- <span data-ttu-id="2e6b3-120">Adicione outro destino do MSBuild que remova o arquivo *\_offline. htm do aplicativo* do servidor de destino quando todas as tarefas de implantação forem concluídas.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-120">Add another MSBuild target that removes the *App\_offline.htm* file from the destination server when all deployment tasks are complete.</span></span>
- <span data-ttu-id="2e6b3-121">No projeto de aplicativo Web, crie um arquivo *. WPP. targets* que garante que um *aplicativo\_arquivo offline. htm* seja adicionado ao pacote de implantação quando implantação da Web for invocado.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-121">In the web application project, create a *.wpp.targets* file that ensures that an *App\_offline.htm* file is added to the deployment package when Web Deploy is invoked.</span></span>

<span data-ttu-id="2e6b3-122">Este tópico mostrará como executar esses procedimentos.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-122">This topic will show you how to perform these procedures.</span></span> <span data-ttu-id="2e6b3-123">As tarefas e orientações neste tópico pressupõem que você já criou uma solução que contém pelo menos um projeto de aplicativo Web e que usa um arquivo de projeto personalizado para controlar o processo de implantação, conforme descrito em [implantação da Web na empresa](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md).</span><span class="sxs-lookup"><span data-stu-id="2e6b3-123">The tasks and walkthroughs in this topic assume that you've already created a solution that contains at least one web application project, and that you use a custom project file to control the deployment process as described in [Web Deployment in the Enterprise](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md).</span></span> <span data-ttu-id="2e6b3-124">Como alternativa, você pode usar a solução de exemplo [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) para seguir os exemplos no tópico.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-124">Alternatively, you can use the [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) sample solution to follow the examples in the topic.</span></span>

## <a name="adding-an-app_offline-file-to-a-web-application-project"></a><span data-ttu-id="2e6b3-125">Adicionando um aplicativo\_arquivo offline a um projeto de aplicativo Web</span><span class="sxs-lookup"><span data-stu-id="2e6b3-125">Adding an App\_Offline File to a Web Application Project</span></span>

<span data-ttu-id="2e6b3-126">A primeira tarefa que você precisa concluir é adicionar um *aplicativo\_arquivo offline* ao seu projeto de aplicativo Web:</span><span class="sxs-lookup"><span data-stu-id="2e6b3-126">The first task you need to complete is to add an *App\_offline* file to your web application project:</span></span>

- <span data-ttu-id="2e6b3-127">Para impedir que o arquivo interfira no processo de desenvolvimento (você não quer que seu aplicativo fique permanentemente offline), você deve chamá-lo de outra forma que não seja o *aplicativo\_offline. htm*.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-127">To prevent the file from interfering with the development process (you don't want your application to be permanently offline), you should call it something other than *App\_offline.htm*.</span></span> <span data-ttu-id="2e6b3-128">Por exemplo, você pode nomear o *aplicativo de arquivo\_offline-template. htm*.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-128">For example, you could name the file *App\_offline-template.htm*.</span></span>
- <span data-ttu-id="2e6b3-129">Para impedir que o arquivo seja implantado no estado em que se encontra, você deve definir a ação de Build como **None**.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-129">To prevent the file from being deployed as-is, you should set the build action to **None**.</span></span>

<span data-ttu-id="2e6b3-130">**Para adicionar um aplicativo\_arquivo offline a um projeto de aplicativo Web**</span><span class="sxs-lookup"><span data-stu-id="2e6b3-130">**To add an App\_offline file to a web application project**</span></span>

1. <span data-ttu-id="2e6b3-131">Abra sua solução no Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-131">Open your solution in Visual Studio 2010.</span></span>
2. <span data-ttu-id="2e6b3-132">Na janela **Gerenciador de soluções** , clique com o botão direito do mouse no projeto de aplicativo Web, aponte para **Adicionar**e clique em **novo item**.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-132">In the **Solution Explorer** window, right-click your web application project, point to **Add**, and then click **New Item**.</span></span>
3. <span data-ttu-id="2e6b3-133">Na caixa de diálogo **Adicionar novo item** , selecione **página HTML**.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-133">In the **Add New Item** dialog box, select **HTML Page**.</span></span>
4. <span data-ttu-id="2e6b3-134">Na caixa **nome** , digite **app\_offline-template. htm**e clique em **Adicionar**.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-134">In the **Name** box, type **App\_offline-template.htm**, and then click **Add**.</span></span>

    ![](taking-web-applications-offline-with-web-deploy/_static/image1.png)
5. <span data-ttu-id="2e6b3-135">Adicione um HTML simples para informar os usuários de que o aplicativo está indisponível e, em seguida, salve o arquivo.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-135">Add some simple HTML to inform users that the application is unavailable, and then save the file.</span></span> <span data-ttu-id="2e6b3-136">Não inclua marcas do lado do servidor (por exemplo, quaisquer marcas que tenham o prefixo "ASP:").</span><span class="sxs-lookup"><span data-stu-id="2e6b3-136">Do not include any server-side tags (for example, any tags that are prefixed with "asp:").</span></span> 

    ![](taking-web-applications-offline-with-web-deploy/_static/image2.png)
6. <span data-ttu-id="2e6b3-137">Na janela **Gerenciador de soluções** , clique com o botão direito do mouse no novo arquivo e clique em **Propriedades**.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-137">In the **Solution Explorer** window, right-click the new file, and then click **Properties**.</span></span>
7. <span data-ttu-id="2e6b3-138">Na janela **Propriedades** , na linha **ação de compilação** , selecione **nenhum**.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-138">In the **Properties** window, in the **Build Action** row, select **None**.</span></span>

    ![](taking-web-applications-offline-with-web-deploy/_static/image3.png)

## <a name="deploying-and-deleting-an-app_offline-file"></a><span data-ttu-id="2e6b3-139">Implantando e excluindo um aplicativo\_arquivo offline</span><span class="sxs-lookup"><span data-stu-id="2e6b3-139">Deploying and Deleting an App\_Offline File</span></span>

<span data-ttu-id="2e6b3-140">A próxima etapa é modificar a lógica de implantação para copiar o arquivo para o servidor de destino no início do processo de implantação e removê-lo no final.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-140">The next step is to modify your deployment logic to copy the file to the destination server at the start of the deployment process and remove it at the end.</span></span>

> [!NOTE]
> <span data-ttu-id="2e6b3-141">O próximo procedimento pressupõe que você esteja usando um arquivo de projeto MSBuild personalizado para controlar seu processo de implantação, conforme descrito em [noções básicas sobre o arquivo de projeto](../web-deployment-in-the-enterprise/understanding-the-project-file.md).</span><span class="sxs-lookup"><span data-stu-id="2e6b3-141">The next procedure assumes that you're using a custom MSBuild project file to control your deployment process, as described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md).</span></span> <span data-ttu-id="2e6b3-142">Se estiver implantando o diretamente do Visual Studio, você precisará usar uma abordagem diferente.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-142">If you're deploying direct from Visual Studio, you'll need to use a different approach.</span></span> <span data-ttu-id="2e6b3-143">Sayed Ibrahim Hashimi descreve uma abordagem desse tipo de [como colocar seu aplicativo Web offline durante a publicação](http://sedodream.com/2012/01/08/HowToTakeYourWebAppOfflineDuringPublishing.aspx).</span><span class="sxs-lookup"><span data-stu-id="2e6b3-143">Sayed Ibrahim Hashimi describes one such approach in [How to Take Your Web App Offline During Publishing](http://sedodream.com/2012/01/08/HowToTakeYourWebAppOfflineDuringPublishing.aspx).</span></span>

<span data-ttu-id="2e6b3-144">Para implantar um *aplicativo\_arquivo offline* em um site do IIS de destino, você precisa invocar o MSDeploy. exe usando o [provedor de implantação da Web **contentPath** ](https://technet.microsoft.com/library/dd569034(WS.10).aspx).</span><span class="sxs-lookup"><span data-stu-id="2e6b3-144">To deploy an *App\_offline* file to a destination IIS website, you need to invoke MSDeploy.exe using the [Web Deploy **contentPath** provider](https://technet.microsoft.com/library/dd569034(WS.10).aspx).</span></span> <span data-ttu-id="2e6b3-145">O provedor **contentPath** dá suporte a caminhos de diretórios físicos e a caminhos de aplicativos ou sites do IIS, o que o torna a opção ideal para sincronizar um arquivo entre uma pasta de projeto do Visual Studio e um aplicativo Web do IIS.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-145">The **contentPath** provider supports both physical directory paths and IIS website or application paths, which makes it the ideal choice for synchronizing a file between a Visual Studio project folder and an IIS web application.</span></span> <span data-ttu-id="2e6b3-146">Para implantar o arquivo, o comando MSDeploy deve ser semelhante ao seguinte:</span><span class="sxs-lookup"><span data-stu-id="2e6b3-146">To deploy the file, your MSDeploy command should resemble this:</span></span>

[!code-console[Main](taking-web-applications-offline-with-web-deploy/samples/sample1.cmd)]

<span data-ttu-id="2e6b3-147">Para remover o arquivo do site de destino no final do processo de implantação, o comando MSDeploy deve ser semelhante ao seguinte:</span><span class="sxs-lookup"><span data-stu-id="2e6b3-147">To remove the file from the destination site at the end of the deployment process, your MSDeploy command should resemble this:</span></span>

[!code-console[Main](taking-web-applications-offline-with-web-deploy/samples/sample2.cmd)]

<span data-ttu-id="2e6b3-148">Para automatizar esses comandos como parte de um processo de compilação e implantação, você precisa integrá-los em seu arquivo de projeto do MSBuild personalizado.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-148">To automate these commands as part of a build and deployment process, you need to integrate them into your custom MSBuild project file.</span></span> <span data-ttu-id="2e6b3-149">O procedimento a seguir descreve como fazer isso.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-149">The next procedure describes how to do this.</span></span>

<span data-ttu-id="2e6b3-150">**Para implantar e excluir um aplicativo\_arquivo offline**</span><span class="sxs-lookup"><span data-stu-id="2e6b3-150">**To deploy and delete an App\_offline file**</span></span>

1. <span data-ttu-id="2e6b3-151">No Visual Studio 2010, abra o arquivo de projeto do MSBuild que controla seu processo de implantação.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-151">In Visual Studio 2010, open the MSBuild project file that controls your deployment process.</span></span> <span data-ttu-id="2e6b3-152">Na solução de exemplo [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) , esse é o arquivo *Publish. proj* .</span><span class="sxs-lookup"><span data-stu-id="2e6b3-152">In the [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) sample solution, this is the *Publish.proj* file.</span></span>
2. <span data-ttu-id="2e6b3-153">No elemento do **projeto** raiz, crie um novo elemento **PropertyGroup** para armazenar variáveis para o *aplicativo\_implantação offline* :</span><span class="sxs-lookup"><span data-stu-id="2e6b3-153">In the root **Project** element, create a new **PropertyGroup** element to store variables for the *App\_offline* deployment:</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample3.xml)]
3. <span data-ttu-id="2e6b3-154">A propriedade **SourceRoot** é definida em outro lugar no arquivo *Publish. proj* .</span><span class="sxs-lookup"><span data-stu-id="2e6b3-154">The **SourceRoot** property is defined elsewhere in the *Publish.proj* file.</span></span> <span data-ttu-id="2e6b3-155">Indica o local da pasta raiz para o conteúdo de origem relativo ao caminho&#x2014;atual em outras palavras, em relação ao local do arquivo *Publish. proj* .</span><span class="sxs-lookup"><span data-stu-id="2e6b3-155">It indicates the location of the root folder for the source content relative to the current path&#x2014;in other words, relative to the location of the *Publish.proj* file.</span></span>
4. <span data-ttu-id="2e6b3-156">O provedor **contentPath** não aceitará caminhos de arquivo relativos, portanto, você precisa obter um caminho absoluto para o arquivo de origem antes de implantá-lo.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-156">The **contentPath** provider will not accept relative file paths, so you need to get an absolute path to your source file before you can deploy it.</span></span> <span data-ttu-id="2e6b3-157">Você pode usar a tarefa [ConvertToAbsolutePath](https://msdn.microsoft.com/library/bb882668.aspx) para fazer isso.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-157">You can use the [ConvertToAbsolutePath](https://msdn.microsoft.com/library/bb882668.aspx) task to do this.</span></span>
5. <span data-ttu-id="2e6b3-158">Adicione um novo elemento de **destino** chamado **GetAppOfflineAbsolutePath**.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-158">Add a new **Target** element named **GetAppOfflineAbsolutePath**.</span></span> <span data-ttu-id="2e6b3-159">Nesse destino, use a tarefa **ConvertToAbsolutePath** para obter um caminho absoluto para o *aplicativo\_arquivo de modelo offline* na pasta do projeto.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-159">Within this target, use the **ConvertToAbsolutePath** task to get an absolute path to the *App\_offline-template* file in your project folder.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample4.xml)]
6. <span data-ttu-id="2e6b3-160">Esse destino usa o caminho relativo para o *aplicativo\_arquivo de modelo offline* na pasta do projeto e salva-o em uma nova propriedade como um caminho de arquivo absoluto.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-160">This target takes the relative path to the *App\_offline-template* file in your project folder and saves it to a new property as an absolute file path.</span></span> <span data-ttu-id="2e6b3-161">O atributo **BeforeTargets** especifica que você deseja que esse destino seja executado antes do destino **DeployAppOffline** , que você criará na próxima etapa.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-161">The **BeforeTargets** attribute specifies that you want this target to execute before the **DeployAppOffline** target, which you'll create in the next step.</span></span>
7. <span data-ttu-id="2e6b3-162">Adicione um novo destino chamado **DeployAppOffline**.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-162">Add a new target named **DeployAppOffline**.</span></span> <span data-ttu-id="2e6b3-163">Dentro desse destino, invoque o comando MSDeploy. exe que implanta seu *aplicativo\_arquivo offline* no servidor Web de destino.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-163">Within this target, invoke the MSDeploy.exe command that deploys your *App\_offline* file to the destination web server.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample5.xml)]
8. <span data-ttu-id="2e6b3-164">Neste exemplo, a propriedade **ContactManagerIisPath** está definida em outro lugar no arquivo de projeto.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-164">In this example, the **ContactManagerIisPath** property is defined elsewhere in the project file.</span></span> <span data-ttu-id="2e6b3-165">Esse é simplesmente um caminho de aplicativo do IIS, no formato *[nome do site do IIS]/[nome do aplicativo]* .</span><span class="sxs-lookup"><span data-stu-id="2e6b3-165">This is simply an IIS application path, in the form *[IIS Website Name]/[Application Name]*.</span></span> <span data-ttu-id="2e6b3-166">A inclusão de uma condição no destino permite que os usuários alternem o *aplicativo\_implantação offline* seja ativada ou desativada alterando um valor de propriedade ou fornecendo um parâmetro de linha de comando.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-166">Including a condition in the target enables users to switch the *App\_offline* deployment on or off by changing a property value or providing a command-line parameter.</span></span>
9. <span data-ttu-id="2e6b3-167">Adicione um novo destino chamado **DeleteAppOffline**.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-167">Add a new target named **DeleteAppOffline**.</span></span> <span data-ttu-id="2e6b3-168">Dentro desse destino, invoque o comando MSDeploy. exe que remove seu *aplicativo\_arquivo offline* do servidor Web de destino.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-168">Within this target, invoke the MSDeploy.exe command that removes your *App\_offline* file from the destination web server.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample6.xml)]
10. <span data-ttu-id="2e6b3-169">A tarefa final é invocar esses novos destinos em pontos apropriados durante a execução do arquivo de projeto.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-169">The final task is to invoke these new targets at appropriate points during the execution of your project file.</span></span> <span data-ttu-id="2e6b3-170">Você pode fazer isso de várias maneiras.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-170">You can do this in various ways.</span></span> <span data-ttu-id="2e6b3-171">Por exemplo, no arquivo *Publish. proj* , a propriedade **FullPublishDependsOn** especifica uma lista de destinos que devem ser executados na ordem em que o destino padrão **FullPublish** é invocado.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-171">For example, in the *Publish.proj* file, the **FullPublishDependsOn** property specifies a list of targets that must be executed in order when the **FullPublish** default target is invoked.</span></span>
11. <span data-ttu-id="2e6b3-172">Modifique o arquivo de projeto do MSBuild para invocar os destinos **DeployAppOffline** e **DeleteAppOffline** em pontos apropriados no processo de publicação.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-172">Modify your MSBuild project file to invoke the **DeployAppOffline** and **DeleteAppOffline** targets at appropriate points in the publishing process.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample7.xml)]

<span data-ttu-id="2e6b3-173">Quando você executa o arquivo de projeto do MSBuild personalizado, o *aplicativo\_arquivo offline* será implantado no servidor imediatamente após uma compilação bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-173">When you run your custom MSBuild project file, the *App\_offline* file will be deployed to the server immediately after a successful build.</span></span> <span data-ttu-id="2e6b3-174">Ele será excluído do servidor depois que todas as tarefas de implantação forem concluídas.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-174">It will then be deleted from the server once all the deployment tasks are complete.</span></span>

## <a name="adding-an-app_offline-file-to-deployment-packages"></a><span data-ttu-id="2e6b3-175">Adicionando um aplicativo\_arquivo offline a pacotes de implantação</span><span class="sxs-lookup"><span data-stu-id="2e6b3-175">Adding an App\_Offline File to Deployment Packages</span></span>

<span data-ttu-id="2e6b3-176">Dependendo de como você configura sua implantação, qualquer conteúdo existente no aplicativo&#x2014;Web IIS de destino, como o *aplicativo\_offline. htm* ,&#x2014;poderá ser excluído automaticamente quando você implantar um pacote da Web no destino.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-176">Depending on how you configure your deployment, any existing content at the destination IIS web application&#x2014;like the *App\_offline.htm* file&#x2014;may be deleted automatically when you deploy a web package to the destination.</span></span> <span data-ttu-id="2e6b3-177">Para garantir que o *aplicativo\_o arquivo offline. htm* permaneça em vigor durante a implantação, você precisa incluir o arquivo no próprio pacote de implantação da Web, além de implantar o arquivo diretamente no início do processo de implantação.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-177">To ensure that the *App\_offline.htm* file remains in place for the duration of the deployment, you need to include the file within the web deployment package itself in addition to deploying the file directly at the start of the deployment process.</span></span>

- <span data-ttu-id="2e6b3-178">Se você seguiu as tarefas anteriores neste tópico, você terá adicionado o arquivo *\_offline. htm* ao seu projeto de aplicativo Web em um nome de arquivo diferente (usamos o *aplicativo\_offline-template. htm*) e você terá definido a ação de compilação como **nenhum**.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-178">If you've followed the previous tasks in this topic, you'll have added the *App\_offline.htm* file to your web application project under a different filename (we used *App\_offline-template.htm*) and you'll have set the build action to **None**.</span></span> <span data-ttu-id="2e6b3-179">Essas alterações são necessárias para impedir que o arquivo interfira no desenvolvimento e na depuração.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-179">These changes are necessary to prevent the file from interfering with development and debugging.</span></span> <span data-ttu-id="2e6b3-180">Como resultado, você precisa personalizar o processo de empacotamento para garantir que o *aplicativo\_arquivo offline. htm* seja incluído no pacote de implantação da Web.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-180">As a result, you need to customize the packaging process to ensure that the *App\_offline.htm* file is included in the web deployment package.</span></span>

<span data-ttu-id="2e6b3-181">O WPP (pipeline de publicação na Web) usa uma lista de itens chamada **FilesForPackagingFromProject** para criar uma lista de arquivos que devem ser incluídos no pacote de implantação da Web.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-181">The Web Publishing Pipeline (WPP) uses an item list named **FilesForPackagingFromProject** to build a list of files that should be included in the web deployment package.</span></span> <span data-ttu-id="2e6b3-182">Você pode personalizar o conteúdo de seus pacotes da Web adicionando seus próprios itens à lista.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-182">You can customize the contents of your web packages by adding your own items to this list.</span></span> <span data-ttu-id="2e6b3-183">Para fazer isso, você precisa concluir estas etapas de alto nível:</span><span class="sxs-lookup"><span data-stu-id="2e6b3-183">To do this, you need to complete these high-level steps:</span></span>

1. <span data-ttu-id="2e6b3-184">Crie um arquivo de projeto personalizado chamado *[Project Name]. WPP. targets* na mesma pasta que o seu arquivo de projeto.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-184">Create a custom project file named *[project name].wpp.targets* in the same folder as your project file.</span></span>

    > [!NOTE]
    > <span data-ttu-id="2e6b3-185">O arquivo *. WPP. targets* precisa ir para a mesma pasta do seu arquivo&#x2014;de projeto de aplicativo Web, por exemplo, *ContactManager. Mvc. csproj*&#x2014;, em vez de na mesma pasta que os arquivos de projeto personalizados que você usa para controlar o processo de compilação e implantação.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-185">The *.wpp.targets* file needs to go in the same folder as your web application project file&#x2014;for example, *ContactManager.Mvc.csproj*&#x2014;rather than in the same folder as any custom project files you use to control the build and deployment process.</span></span>
2. <span data-ttu-id="2e6b3-186">No arquivo *. WPP. targets* , crie um novo destino do MSBuild que seja executado *antes* do destino **CopyAllFilesToSingleFolderForPackage** .</span><span class="sxs-lookup"><span data-stu-id="2e6b3-186">In the *.wpp.targets* file, create a new MSBuild target that executes *before* the **CopyAllFilesToSingleFolderForPackage** target.</span></span> <span data-ttu-id="2e6b3-187">Esse é o destino do WPP que cria uma lista de itens a serem incluídos no pacote.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-187">This is the WPP target that builds a list of things to include in the package.</span></span>
3. <span data-ttu-id="2e6b3-188">No novo destino, crie um elemento do **rowgroup** .</span><span class="sxs-lookup"><span data-stu-id="2e6b3-188">In the new target, create an **ItemGroup** element.</span></span>
4. <span data-ttu-id="2e6b3-189">No elemento **rowgroup** , adicione um item **FilesForPackagingFromProject** e especifique o arquivo *\_offline. htm do aplicativo* .</span><span class="sxs-lookup"><span data-stu-id="2e6b3-189">In the **ItemGroup** element, add a **FilesForPackagingFromProject** item and specify the *App\_offline.htm* file.</span></span>

<span data-ttu-id="2e6b3-190">O arquivo *. WPP. targets* deve ser semelhante ao seguinte:</span><span class="sxs-lookup"><span data-stu-id="2e6b3-190">The *.wpp.targets* file should resemble this:</span></span>

[!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample8.xml)]

<span data-ttu-id="2e6b3-191">Estes são os principais pontos de observação neste exemplo:</span><span class="sxs-lookup"><span data-stu-id="2e6b3-191">These are the key points of note in this example:</span></span>

- <span data-ttu-id="2e6b3-192">O atributo **BeforeTargets** insere esse destino no WPP especificando que ele deve ser executado imediatamente antes do destino **CopyAllFilesToSingleFolderForPackage** .</span><span class="sxs-lookup"><span data-stu-id="2e6b3-192">The **BeforeTargets** attribute inserts this target into the WPP by specifying that it should be executed immediately before the **CopyAllFilesToSingleFolderForPackage** target.</span></span>
- <span data-ttu-id="2e6b3-193">O item **FilesForPackagingFromProject** usa o valor de metadados **DestinationRelativePath** para renomear o arquivo do *aplicativo\_offline-template. htm* para o *aplicativo\_offline. htm* , pois ele é adicionado à lista.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-193">The **FilesForPackagingFromProject** item uses the **DestinationRelativePath** metadata value to rename the file from *App\_offline-template.htm* to *App\_offline.htm* as it's added to the list.</span></span>

<span data-ttu-id="2e6b3-194">O procedimento a seguir mostra como adicionar esse arquivo *. WPP. targets* a um projeto de aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-194">The next procedure shows you how to add this *.wpp.targets* file to a web application project.</span></span>

<span data-ttu-id="2e6b3-195">**Para adicionar um arquivo. WPP. targets a um pacote de implantação da Web**</span><span class="sxs-lookup"><span data-stu-id="2e6b3-195">**To add a .wpp.targets file to a web deployment package**</span></span>

1. <span data-ttu-id="2e6b3-196">Abra sua solução no Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-196">Open your solution in Visual Studio 2010.</span></span>
2. <span data-ttu-id="2e6b3-197">Na janela **Gerenciador de soluções** , clique com o botão direito do mouse no nó do projeto de aplicativo Web (por exemplo, **ContactManager. Mvc**), aponte para **Adicionar**e clique em **novo item**.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-197">In the **Solution Explorer** window, right-click your web application project node (for example, **ContactManager.Mvc**), point to **Add**, and then click **New Item**.</span></span>
3. <span data-ttu-id="2e6b3-198">Na caixa de diálogo **Adicionar novo item** , selecione o modelo de **arquivo XML** .</span><span class="sxs-lookup"><span data-stu-id="2e6b3-198">In the **Add New Item** dialog box, select the **XML File** template.</span></span>
4. <span data-ttu-id="2e6b3-199">Na caixa **nome** , digite *[nome do projeto] \* \* *. WPP. targets** (por exemplo, **ContactManager. Mvc. WPP. targets**) e clique em **Adicionar**.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-199">In the **Name** box, type *[project name]\*\*\*.wpp.targets*\* (for example, **ContactManager.Mvc.wpp.targets**), and then click **Add**.</span></span>

    ![](taking-web-applications-offline-with-web-deploy/_static/image4.png)

    > [!NOTE]
    > <span data-ttu-id="2e6b3-200">Se você adicionar um novo item ao nó raiz de um projeto, o arquivo será criado na mesma pasta que o arquivo de projeto.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-200">If you add a new item to the root node of a project, the file is created in the same folder as the project file.</span></span> <span data-ttu-id="2e6b3-201">Você pode verificar isso abrindo a pasta no Windows Explorer.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-201">You can verify this by opening the folder in Windows Explorer.</span></span>
5. <span data-ttu-id="2e6b3-202">No arquivo, adicione a marcação MSBuild descrita anteriormente.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-202">In the file, add the MSBuild markup described previously.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample9.xml)]
6. <span data-ttu-id="2e6b3-203">Salve e feche o arquivo *[nome do projeto]. WPP. targets* .</span><span class="sxs-lookup"><span data-stu-id="2e6b3-203">Save and close the *[project name].wpp.targets* file.</span></span>

<span data-ttu-id="2e6b3-204">Na próxima vez que você criar e empacotar seu projeto de aplicativo Web, o WPP detectará automaticamente o arquivo *. WPP. targets* .</span><span class="sxs-lookup"><span data-stu-id="2e6b3-204">The next time you build and package your web application project, the WPP will automatically detect the *.wpp.targets* file.</span></span> <span data-ttu-id="2e6b3-205">O *aplicativo\_arquivo offline-template. htm* será incluído no pacote de implantação da Web resultante como o *aplicativo\_offline. htm*.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-205">The *App\_offline-template.htm* file will be included in the resulting web deployment package as *App\_offline.htm*.</span></span>

> [!NOTE]
> <span data-ttu-id="2e6b3-206">Se a sua implantação falhar, o *aplicativo\_o arquivo offline. htm* permanecerá em vigor e seu aplicativo permanecerá offline.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-206">If your deployment fails, the *App\_offline.htm* file will remain in place and your application will remain offline.</span></span> <span data-ttu-id="2e6b3-207">Normalmente, esse é o comportamento desejado.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-207">This is typically the desired behavior.</span></span> <span data-ttu-id="2e6b3-208">Para colocar seu aplicativo online novamente, você pode excluir o *aplicativo\_arquivo offline. htm* do seu servidor Web.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-208">To bring your application back online, you can delete the *App\_offline.htm* file from your web server.</span></span> <span data-ttu-id="2e6b3-209">Como alternativa, se você corrigir erros e executar uma implantação bem-sucedida, o arquivo *. htm do aplicativo\_offline* será removido.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-209">Alternatively, if you correct any errors and run a successful deployment, the *App\_offline.htm* file will be removed.</span></span>

## <a name="conclusion"></a><span data-ttu-id="2e6b3-210">Conclusão</span><span class="sxs-lookup"><span data-stu-id="2e6b3-210">Conclusion</span></span>

<span data-ttu-id="2e6b3-211">Este tópico descreveu como colocar um aplicativo Web offline durante a implantação, publicando um *aplicativo\_arquivo offline. htm* no servidor de destino no início do processo de implantação e removendo-o no final.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-211">This topic described how to take a web application offline for the duration of a deployment, by publishing an *App\_offline.htm* file to the destination server at the start of the deployment process and removing it at the end.</span></span> <span data-ttu-id="2e6b3-212">Ele também abordou como incluir um *aplicativo\_arquivo offline. htm* em um pacote de implantação da Web.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-212">It also covered how to include an *App\_offline.htm* file in a web deployment package.</span></span>

## <a name="further-reading"></a><span data-ttu-id="2e6b3-213">Leitura adicional</span><span class="sxs-lookup"><span data-stu-id="2e6b3-213">Further Reading</span></span>

<span data-ttu-id="2e6b3-214">Para obter mais informações sobre o processo de empacotamento e implantação, consulte [criando e empacotando projetos de aplicativos Web](../web-deployment-in-the-enterprise/building-and-packaging-web-application-projects.md), [configurando parâmetros para implantação de pacote da Web](../web-deployment-in-the-enterprise/configuring-parameters-for-web-package-deployment.md)e [implantando pacotes da Web](../web-deployment-in-the-enterprise/deploying-web-packages.md).</span><span class="sxs-lookup"><span data-stu-id="2e6b3-214">For more information on the packaging and deployment process, see [Building and Packaging Web Application Projects](../web-deployment-in-the-enterprise/building-and-packaging-web-application-projects.md), [Configuring Parameters for Web Package Deployment](../web-deployment-in-the-enterprise/configuring-parameters-for-web-package-deployment.md), and [Deploying Web Packages](../web-deployment-in-the-enterprise/deploying-web-packages.md).</span></span>

<span data-ttu-id="2e6b3-215">Se você publicar seus aplicativos Web diretamente do Visual Studio, em vez de usar a abordagem de arquivo de projeto do MSBuild personalizada descrita nestes tutoriais, você precisará usar uma abordagem um pouco diferente para colocar o aplicativo offline durante a publicação Process.</span><span class="sxs-lookup"><span data-stu-id="2e6b3-215">If you publish your web applications directly from Visual Studio, rather than using the custom MSBuild project file approach described in these tutorials, you'll need to use a slightly different approach to take your application offline during the publishing process.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="2e6b3-216">[Anterior](excluding-files-and-folders-from-deployment.md)
> [Próximo](running-windows-powershell-scripts-from-msbuild-project-files.md)</span><span class="sxs-lookup"><span data-stu-id="2e6b3-216">[Previous](excluding-files-and-folders-from-deployment.md)
[Next](running-windows-powershell-scripts-from-msbuild-project-files.md)</span></span>
