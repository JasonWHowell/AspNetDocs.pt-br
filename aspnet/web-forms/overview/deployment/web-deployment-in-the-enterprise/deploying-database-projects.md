---
uid: web-forms/overview/deployment/web-deployment-in-the-enterprise/deploying-database-projects
title: Implantando projetos de banco de dados | Microsoft Docs
author: jrjlee
description: 'Observação: em vários cenários de implantação empresarial, você precisa da capacidade de publicar atualizações incrementais em um banco de dados implantado. A alternativa é recriar...'
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 832f226a-1aa3-4093-8c29-ce4196793259
msc.legacyurl: /web-forms/overview/deployment/web-deployment-in-the-enterprise/deploying-database-projects
msc.type: authoredcontent
ms.openlocfilehash: 221808758492aedb8e8329364e511df28fd11105
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78634263"
---
# <a name="deploying-database-projects"></a><span data-ttu-id="a9a27-104">Implantação de projetos de banco de dados</span><span class="sxs-lookup"><span data-stu-id="a9a27-104">Deploying Database Projects</span></span>

<span data-ttu-id="a9a27-105">por [Jason Lee](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="a9a27-105">by [Jason Lee](https://github.com/jrjlee)</span></span>

[<span data-ttu-id="a9a27-106">Baixar PDF</span><span class="sxs-lookup"><span data-stu-id="a9a27-106">Download PDF</span></span>](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> [!NOTE]
> <span data-ttu-id="a9a27-107">Em vários cenários de implantação empresarial, você precisa da capacidade de publicar atualizações incrementais em um banco de dados implantado.</span><span class="sxs-lookup"><span data-stu-id="a9a27-107">In lots of enterprise deployment scenarios, you need the ability to publish incremental updates to a deployed database.</span></span> <span data-ttu-id="a9a27-108">A alternativa é recriar o banco de dados em todas as implantações, o que significa que você perde todos os dados existentes nele.</span><span class="sxs-lookup"><span data-stu-id="a9a27-108">The alternative is to recreate the database on every deployment, which means you lose any data in the existing database.</span></span> <span data-ttu-id="a9a27-109">Quando você trabalha com o Visual Studio 2010, o uso do VSDBCMD é a abordagem recomendada para a publicação incremental do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="a9a27-109">When you work with Visual Studio 2010, using VSDBCMD is the recommended approach to incremental database publishing.</span></span> <span data-ttu-id="a9a27-110">No entanto, a próxima versão do Visual Studio e do WPP (Web Publishing Pipeline) incluirão ferramentas que dão suporte à publicação incremental diretamente.</span><span class="sxs-lookup"><span data-stu-id="a9a27-110">However, the next version of Visual Studio and the Web Publishing Pipeline (WPP) will include tooling that supports incremental publishing directly.</span></span>

<span data-ttu-id="a9a27-111">Se você abrir a solução de exemplo Contact Manager no Visual Studio 2010, verá que o projeto de banco de dados inclui uma pasta Properties que contém quatro arquivos.</span><span class="sxs-lookup"><span data-stu-id="a9a27-111">If you open the Contact Manager sample solution in Visual Studio 2010, you'll see that the database project includes a Properties folder that contains four files.</span></span>

![](deploying-database-projects/_static/image1.png)

<span data-ttu-id="a9a27-112">Junto com o arquivo de projeto (*ContactManager. Database. dbproj* , nesse caso), esses arquivos controlam vários aspectos do processo de compilação e implantação:</span><span class="sxs-lookup"><span data-stu-id="a9a27-112">Together with the project file (*ContactManager.Database.dbproj* in this case), these files control various aspects of the build and deployment process:</span></span>

- <span data-ttu-id="a9a27-113">O arquivo *Database. sqlcmdvars* fornece valores para quaisquer variáveis do sqlcmd que você usar ao implantar o projeto.</span><span class="sxs-lookup"><span data-stu-id="a9a27-113">The *Database.sqlcmdvars* file provides values for any SQLCMD variables you use when you deploy the project.</span></span> <span data-ttu-id="a9a27-114">Cada configuração de solução (por exemplo, Debug e Release) pode especificar um arquivo. sqlcmdvars diferente.</span><span class="sxs-lookup"><span data-stu-id="a9a27-114">Each solution configuration (for example, debug and release) can specify a different .sqlcmdvars file.</span></span>
- <span data-ttu-id="a9a27-115">O arquivo *Database. sqldeployment* fornece configurações específicas de implantação, como usar o agrupamento definido em seu projeto ou o agrupamento do servidor de destino, se deseja recriar o banco de dados de destino toda vez ou simplesmente corrigir o banco de dados existente para atualizá-lo e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="a9a27-115">The *Database.sqldeployment* file provides deployment-specific settings, like whether to use the collation defined in your project or the collation of the destination server, whether to recreate the destination database every time or simply amend the existing database to bring it up to date, and so on.</span></span> <span data-ttu-id="a9a27-116">Cada configuração de solução pode especificar um arquivo. sqldeployment diferente.</span><span class="sxs-lookup"><span data-stu-id="a9a27-116">Each solution configuration can specify a different .sqldeployment file.</span></span>
- <span data-ttu-id="a9a27-117">O arquivo *Database. sqlpermissions* é um documento XML que você pode usar para definir as permissões que deseja adicionar ao banco de dados de destino.</span><span class="sxs-lookup"><span data-stu-id="a9a27-117">The *Database.sqlpermissions* file is an XML document that you can use to define any permissions you want to add to the target database.</span></span> <span data-ttu-id="a9a27-118">Todas as configurações de solução compartilham o mesmo arquivo. sqlpermissions.</span><span class="sxs-lookup"><span data-stu-id="a9a27-118">All solution configurations share the same .sqlpermissions file.</span></span>
- <span data-ttu-id="a9a27-119">O arquivo *Database. Configurations* especifica as propriedades no nível do banco de dados a serem usadas ao criar o banco de dados, como o agrupamento a ser usado, o comportamento dos operadores de comparação e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="a9a27-119">The *Database.sqlsettings* file specifies the database-level properties to use when creating the database, like the collation to use, the behavior of comparison operators, and so on.</span></span> <span data-ttu-id="a9a27-120">Todas as configurações de solução compartilham o mesmo arquivo. sqlsettings.</span><span class="sxs-lookup"><span data-stu-id="a9a27-120">All solution configurations share the same .sqlsettings file.</span></span>

<span data-ttu-id="a9a27-121">Vale a pena reservar um momento para abrir esses arquivos no Visual Studio e se familiarizar com o conteúdo.</span><span class="sxs-lookup"><span data-stu-id="a9a27-121">It's worth taking a moment to open these files in Visual Studio and familiarize yourself with the contents.</span></span>

<span data-ttu-id="a9a27-122">Quando você cria um projeto de banco de dados, o processo de compilação cria dois arquivos:</span><span class="sxs-lookup"><span data-stu-id="a9a27-122">When you build a database project, the build process creates two files:</span></span>

- <span data-ttu-id="a9a27-123">Um *esquema de banco de dados* (arquivo. dbschema).</span><span class="sxs-lookup"><span data-stu-id="a9a27-123">A *database schema* (.dbschema file).</span></span> <span data-ttu-id="a9a27-124">Isso descreve o esquema do banco de dados que você deseja criar no formato XML.</span><span class="sxs-lookup"><span data-stu-id="a9a27-124">This describes the schema of the database you want to create in XML format.</span></span>
- <span data-ttu-id="a9a27-125">Um *manifesto de implantação* (arquivo. DeployManifest).</span><span class="sxs-lookup"><span data-stu-id="a9a27-125">A *deployment manifest* (.deploymanifest file).</span></span> <span data-ttu-id="a9a27-126">Isso contém todas as informações necessárias para criar e implantar seu banco de dados.</span><span class="sxs-lookup"><span data-stu-id="a9a27-126">This contains all the information required to create and deploy your database.</span></span> <span data-ttu-id="a9a27-127">Ele faz referência ao arquivo. dbschema junto com outros recursos, como as instruções de implantação (o arquivo. sqldeployment) e quaisquer scripts SQL pré-implantação ou pós-implantação.</span><span class="sxs-lookup"><span data-stu-id="a9a27-127">It references the .dbschema file along with other resources, like the deployment instructions (the .sqldeployment file) and any pre-deployment or post-deployment SQL scripts.</span></span>

<span data-ttu-id="a9a27-128">Isso mostra a relação entre estes recursos:</span><span class="sxs-lookup"><span data-stu-id="a9a27-128">This shows the relationship between these resources:</span></span>

![](deploying-database-projects/_static/image2.png)

<span data-ttu-id="a9a27-129">Como você pode ver, o arquivo. Configurations e o arquivo. sqlpermissions são entradas para o processo de compilação.</span><span class="sxs-lookup"><span data-stu-id="a9a27-129">As you can see, the .sqlsettings file and the .sqlpermissions file are inputs to the build process.</span></span> <span data-ttu-id="a9a27-130">Junto com o arquivo de projeto de banco de dados, esses arquivos são usados para criar o arquivo de esquema de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="a9a27-130">Along with the database project file, these files are used to create the database schema file.</span></span> <span data-ttu-id="a9a27-131">O arquivo. sqldeployment e o arquivo. sqlcmdvars passam pelo processo de compilação inalterados.</span><span class="sxs-lookup"><span data-stu-id="a9a27-131">The .sqldeployment file and the .sqlcmdvars file pass through the build process unchanged.</span></span> <span data-ttu-id="a9a27-132">O manifesto de implantação indica o local do esquema de banco de dados, o arquivo. sqldeployment, o arquivo. sqlcmdvars e quaisquer scripts SQL pré-implantação ou pós-implantação.</span><span class="sxs-lookup"><span data-stu-id="a9a27-132">The deployment manifest indicates the location of the database schema, the .sqldeployment file, the .sqlcmdvars file, and any pre-deployment or post-deployment SQL scripts.</span></span>

## <a name="why-use-vsdbcmd-to-deploy-a-database-project"></a><span data-ttu-id="a9a27-133">Por que usar o VSDBCMD para implantar um projeto de banco de dados?</span><span class="sxs-lookup"><span data-stu-id="a9a27-133">Why Use VSDBCMD to Deploy a Database Project?</span></span>

<span data-ttu-id="a9a27-134">Há várias abordagens diferentes para implantar projetos de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="a9a27-134">There are various different approaches to deploying database projects.</span></span> <span data-ttu-id="a9a27-135">No entanto, nem todos eles são adequados para implantar um projeto de banco de dados em servidores remotos em um ambiente corporativo.</span><span class="sxs-lookup"><span data-stu-id="a9a27-135">However, not all of them are suitable for deploying a database project to remote servers in an enterprise environment.</span></span> <span data-ttu-id="a9a27-136">Considere o que você deseja em uma implantação de projeto de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="a9a27-136">Consider what you want from a database project deployment.</span></span> <span data-ttu-id="a9a27-137">Em cenários de implantação empresarial, você provavelmente vai querer:</span><span class="sxs-lookup"><span data-stu-id="a9a27-137">In enterprise deployment scenarios, you're likely to want:</span></span>

- <span data-ttu-id="a9a27-138">A capacidade de implantar o projeto de banco de dados de um local remoto.</span><span class="sxs-lookup"><span data-stu-id="a9a27-138">The ability to deploy the database project from a remote location.</span></span>
- <span data-ttu-id="a9a27-139">A capacidade de fazer atualizações incrementais em um banco de dados existente.</span><span class="sxs-lookup"><span data-stu-id="a9a27-139">The ability to make incremental updates to an existing database.</span></span>
- <span data-ttu-id="a9a27-140">A capacidade de incluir scripts de pré-implantação ou scripts pós-implantação.</span><span class="sxs-lookup"><span data-stu-id="a9a27-140">The ability to include pre-deployment scripts or post-deployment scripts.</span></span>
- <span data-ttu-id="a9a27-141">A capacidade de personalizar a implantação em vários ambientes de destino.</span><span class="sxs-lookup"><span data-stu-id="a9a27-141">The ability to tailor the deployment to multiple destination environments.</span></span>
- <span data-ttu-id="a9a27-142">A capacidade de implantar o projeto de banco de dados como parte de uma implantação de solução de uma única etapa, geralmente com script.</span><span class="sxs-lookup"><span data-stu-id="a9a27-142">The ability to deploy the database project as part of a larger, typically scripted, single-step solution deployment.</span></span>

<span data-ttu-id="a9a27-143">Há três abordagens principais que você pode usar para implantar um projeto de banco de dados:</span><span class="sxs-lookup"><span data-stu-id="a9a27-143">There are three main approaches you can use to deploy a database project:</span></span>

- <span data-ttu-id="a9a27-144">Você pode usar a funcionalidade de implantação com o tipo de projeto de banco de dados no Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="a9a27-144">You can use the deployment functionality with the database project type in Visual Studio 2010.</span></span> <span data-ttu-id="a9a27-145">Quando você cria e implanta um projeto de banco de dados no Visual Studio 2010, o processo de implantação usa o manifesto de implantação para gerar um arquivo de implantação baseado em SQL específico para a configuração de compilação.</span><span class="sxs-lookup"><span data-stu-id="a9a27-145">When you build and deploy a database project in Visual Studio 2010, the deployment process uses the deployment manifest to generate a SQL-based deployment file specific to the build configuration.</span></span> <span data-ttu-id="a9a27-146">Isso criará o banco de dados, caso ele ainda não exista ou faça as alterações necessárias no banco de dados, caso ele já exista.</span><span class="sxs-lookup"><span data-stu-id="a9a27-146">This will create the database if it doesn't already exist or make any necessary changes to the database if it does already exist.</span></span> <span data-ttu-id="a9a27-147">Você pode usar o SQLCMD. exe para executar esse arquivo no servidor de destino ou pode definir o Visual Studio para criar e executar o arquivo.</span><span class="sxs-lookup"><span data-stu-id="a9a27-147">You can use SQLCMD.exe to run this file on your destination server, or you can set Visual Studio to create and run the file.</span></span> <span data-ttu-id="a9a27-148">A desvantagem dessa abordagem é que você tem apenas controle limitado sobre as configurações de implantação.</span><span class="sxs-lookup"><span data-stu-id="a9a27-148">The disadvantage of this approach is that you have only limited control over the deployment settings.</span></span> <span data-ttu-id="a9a27-149">Geralmente, você também precisa modificar o arquivo de implantação do SQL para fornecer valores de variáveis específicos do ambiente.</span><span class="sxs-lookup"><span data-stu-id="a9a27-149">You may often also need to modify the SQL deployment file to provide environment-specific variable values.</span></span> <span data-ttu-id="a9a27-150">Você só pode usar essa abordagem de um computador com o Visual Studio 2010 instalado, e o desenvolvedor precisaria saber e fornecer cadeias de conexão e credenciais para todos os ambientes de destino.</span><span class="sxs-lookup"><span data-stu-id="a9a27-150">You can only use this approach from a computer with Visual Studio 2010 installed, and the developer would need to know and provide connection strings and credentials for all destination environments.</span></span>
- <span data-ttu-id="a9a27-151">Você pode usar a Implantação da Web (ferramenta de implantação da Web) do Serviços de Informações da Internet (IIS) para [implantar um banco de dados como parte de um projeto de aplicativo Web](https://msdn.microsoft.com/library/dd465343.aspx).</span><span class="sxs-lookup"><span data-stu-id="a9a27-151">You can use the Internet Information Services (IIS) Web Deployment Tool (Web Deploy) to [deploy a database as part of a web application project](https://msdn.microsoft.com/library/dd465343.aspx).</span></span> <span data-ttu-id="a9a27-152">No entanto, essa abordagem é muito mais complexa se você quiser implantar um projeto de banco de dados em vez de simplesmente replicar um banco de dados local existente em um servidor de destino.</span><span class="sxs-lookup"><span data-stu-id="a9a27-152">However, this approach is a lot more complex if you want to deploy a database project rather than simply replicate an existing local database on a destination server.</span></span> <span data-ttu-id="a9a27-153">Você pode configurar Implantação da Web para executar o script de implantação do SQL que o projeto de banco de dados gera, mas para fazer isso, você precisa criar um arquivo de destino de WPP personalizado para seu projeto de aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="a9a27-153">You can configure Web Deploy to run the SQL deployment script that the database project generates, but in order to do this, you need to create a custom WPP targets file for your web application project.</span></span> <span data-ttu-id="a9a27-154">Isso adiciona uma grande quantidade de complexidade ao processo de implantação.</span><span class="sxs-lookup"><span data-stu-id="a9a27-154">This adds a substantial amount of complexity to the deployment process.</span></span> <span data-ttu-id="a9a27-155">Além disso, Implantação da Web não dá suporte diretamente a atualizações incrementais para bancos de dados existentes.</span><span class="sxs-lookup"><span data-stu-id="a9a27-155">In addition, Web Deploy does not directly support incremental updates to existing databases.</span></span> <span data-ttu-id="a9a27-156">Para obter mais informações sobre essa abordagem, consulte [estendendo o pipeline de publicação da Web para projeto de banco de dados de pacote implantação de arquivo SQL](https://go.microsoft.com/?linkid=9805121).</span><span class="sxs-lookup"><span data-stu-id="a9a27-156">For more information on this approach, see [Extending the Web Publishing Pipeline to package database project deployed SQL file](https://go.microsoft.com/?linkid=9805121).</span></span>
- <span data-ttu-id="a9a27-157">Você pode usar o utilitário VSDBCMD para implantar o banco de dados, usando o esquema de banco de dados ou o manifesto de implantação.</span><span class="sxs-lookup"><span data-stu-id="a9a27-157">You can use the VSDBCMD utility to deploy the database, using either the database schema or the deployment manifest.</span></span> <span data-ttu-id="a9a27-158">Você pode chamar VSDBCMD. exe de um destino do MSBuild, que permite publicar bancos de dados como parte de um processo de implantação com script maior.</span><span class="sxs-lookup"><span data-stu-id="a9a27-158">You can call VSDBCMD.exe from an MSBuild target, which lets you publish databases as part of a larger, scripted deployment process.</span></span> <span data-ttu-id="a9a27-159">Você pode substituir as variáveis no arquivo. sqlcmdvars e muitas outras propriedades de banco de dados de um comando VSDBCMD, que permite que você personalize sua implantação para ambientes diferentes sem criar várias configurações de compilação.</span><span class="sxs-lookup"><span data-stu-id="a9a27-159">You can override the variables in your .sqlcmdvars file and lots of other database properties from a VSDBCMD command, which allows you to customize your deployment for different environments without creating multiple build configurations.</span></span> <span data-ttu-id="a9a27-160">O VSDBCMD fornece a funcionalidade de diferenciação, o que significa que ele fará apenas as alterações necessárias para alinhar um banco de dados de destino ao seu esquema de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="a9a27-160">VSDBCMD provides differentiation functionality, which means it will make only the necessary changes to align a destination database with your database schema.</span></span> <span data-ttu-id="a9a27-161">O VSDBCMD também oferece uma ampla variedade de opções de linha de comando, que oferecem um controle refinado sobre o processo de implantação.</span><span class="sxs-lookup"><span data-stu-id="a9a27-161">VSDBCMD also offers a wide range of command-line options, which give you fine-grained control over the deployment process.</span></span>

<span data-ttu-id="a9a27-162">Nesta visão geral, você pode ver que usar o VSDBCMD com o MSBuild é a abordagem mais adequada para um cenário de implantação empresarial típico:</span><span class="sxs-lookup"><span data-stu-id="a9a27-162">From this overview, you can see that using VSDBCMD with MSBuild is the approach best suited to a typical enterprise deployment scenario:</span></span>

|  | <span data-ttu-id="a9a27-163">Visual Studio 2010</span><span class="sxs-lookup"><span data-stu-id="a9a27-163">Visual Studio 2010</span></span> | <span data-ttu-id="a9a27-164">Web Deploy 2.0</span><span class="sxs-lookup"><span data-stu-id="a9a27-164">Web Deploy 2.0</span></span> | <span data-ttu-id="a9a27-165">VSDBCMD.exe</span><span class="sxs-lookup"><span data-stu-id="a9a27-165">VSDBCMD.exe</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="a9a27-166">Dá suporte à implantação remota?</span><span class="sxs-lookup"><span data-stu-id="a9a27-166">Supports remote deployment?</span></span> | <span data-ttu-id="a9a27-167">Sim</span><span class="sxs-lookup"><span data-stu-id="a9a27-167">Yes</span></span> | <span data-ttu-id="a9a27-168">Sim</span><span class="sxs-lookup"><span data-stu-id="a9a27-168">Yes</span></span> | <span data-ttu-id="a9a27-169">Sim</span><span class="sxs-lookup"><span data-stu-id="a9a27-169">Yes</span></span> |
| <span data-ttu-id="a9a27-170">Dá suporte a atualizações incrementais?</span><span class="sxs-lookup"><span data-stu-id="a9a27-170">Supports incremental updates?</span></span> | <span data-ttu-id="a9a27-171">Sim</span><span class="sxs-lookup"><span data-stu-id="a9a27-171">Yes</span></span> | <span data-ttu-id="a9a27-172">Não</span><span class="sxs-lookup"><span data-stu-id="a9a27-172">No</span></span> | <span data-ttu-id="a9a27-173">Sim</span><span class="sxs-lookup"><span data-stu-id="a9a27-173">Yes</span></span> |
| <span data-ttu-id="a9a27-174">Dá suporte a scripts pré/pós-implantação?</span><span class="sxs-lookup"><span data-stu-id="a9a27-174">Supports pre/post-deployment scripts?</span></span> | <span data-ttu-id="a9a27-175">Sim</span><span class="sxs-lookup"><span data-stu-id="a9a27-175">Yes</span></span> | <span data-ttu-id="a9a27-176">Sim</span><span class="sxs-lookup"><span data-stu-id="a9a27-176">Yes</span></span> | <span data-ttu-id="a9a27-177">Sim</span><span class="sxs-lookup"><span data-stu-id="a9a27-177">Yes</span></span> |
| <span data-ttu-id="a9a27-178">Dá suporte à implantação de vários ambientes?</span><span class="sxs-lookup"><span data-stu-id="a9a27-178">Supports multi-environment deployment?</span></span> | <span data-ttu-id="a9a27-179">Limitado</span><span class="sxs-lookup"><span data-stu-id="a9a27-179">Limited</span></span> | <span data-ttu-id="a9a27-180">Limitado</span><span class="sxs-lookup"><span data-stu-id="a9a27-180">Limited</span></span> | <span data-ttu-id="a9a27-181">Sim</span><span class="sxs-lookup"><span data-stu-id="a9a27-181">Yes</span></span> |
| <span data-ttu-id="a9a27-182">Dá suporte à implantação com script?</span><span class="sxs-lookup"><span data-stu-id="a9a27-182">Supports scripted deployment?</span></span> | <span data-ttu-id="a9a27-183">Limitado</span><span class="sxs-lookup"><span data-stu-id="a9a27-183">Limited</span></span> | <span data-ttu-id="a9a27-184">Sim</span><span class="sxs-lookup"><span data-stu-id="a9a27-184">Yes</span></span> | <span data-ttu-id="a9a27-185">Sim</span><span class="sxs-lookup"><span data-stu-id="a9a27-185">Yes</span></span> |

<span data-ttu-id="a9a27-186">O restante deste tópico descreve o uso do VSDBCMD com o MSBuild para implantar projetos de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="a9a27-186">The remainder of this topic describes the use of VSDBCMD with MSBuild to deploy database projects.</span></span>

## <a name="understanding-the-deployment-process"></a><span data-ttu-id="a9a27-187">Noções básicas sobre o processo de implantação</span><span class="sxs-lookup"><span data-stu-id="a9a27-187">Understanding the Deployment Process</span></span>

<span data-ttu-id="a9a27-188">O utilitário VSDBCMD permite que você implante um banco de dados usando o esquema de banco de dados (o arquivo. dbschema) ou o manifesto de implantação (o arquivo. DeployManifest).</span><span class="sxs-lookup"><span data-stu-id="a9a27-188">The VSDBCMD utility lets you deploy a database using either the database schema (the .dbschema file) or the deployment manifest (the .deploymanifest file).</span></span> <span data-ttu-id="a9a27-189">Na prática, você quase sempre usará o manifesto de implantação, pois o manifesto de implantação permite que você forneça valores padrão para várias propriedades de implantação e identifique quaisquer scripts SQL de pré-implantação ou pós-implantação que deseja executar.</span><span class="sxs-lookup"><span data-stu-id="a9a27-189">In practice, you'll almost always use the deployment manifest, as the deployment manifest lets you provide default values for various deployment properties and identify any pre-deployment or post-deployment SQL scripts you want to run.</span></span> <span data-ttu-id="a9a27-190">Por exemplo, esse comando VSDBCMD é usado para implantar o banco de dados **ContactManager** em um servidor de banco de dados em um ambiente de teste:</span><span class="sxs-lookup"><span data-stu-id="a9a27-190">For example, this VSDBCMD command is used to deploy the **ContactManager** database to a database server in a test environment:</span></span>

[!code-console[Main](deploying-database-projects/samples/sample1.cmd)]

<span data-ttu-id="a9a27-191">Nesse caso:</span><span class="sxs-lookup"><span data-stu-id="a9a27-191">In this case:</span></span>

- <span data-ttu-id="a9a27-192">A opção **/a** (ou **/Action**) especifica o que você deseja que o VSDBCMD faça.</span><span class="sxs-lookup"><span data-stu-id="a9a27-192">The **/a** (or **/Action**) switch specifies what you want VSDBCMD to do.</span></span> <span data-ttu-id="a9a27-193">Você pode definir isso para **importar** ou **implantar**.</span><span class="sxs-lookup"><span data-stu-id="a9a27-193">You can set this to **Import** or **Deploy**.</span></span> <span data-ttu-id="a9a27-194">A opção de **importação** é usada para gerar um arquivo. dbschema de um banco de dados existente e a opção **implantar** é usada para implantar um arquivo. dbschema em um banco de dados de destino.</span><span class="sxs-lookup"><span data-stu-id="a9a27-194">The **Import** option is used to generate a .dbschema file from an existing database, and the **Deploy** option is used to deploy a .dbschema file to a target database.</span></span>
- <span data-ttu-id="a9a27-195">A opção **/manifest** (ou **/MANIFESTFILE**) identifica o arquivo. DeployManifest que você deseja implantar.</span><span class="sxs-lookup"><span data-stu-id="a9a27-195">The **/manifest** (or **/ManifestFile**) switch identifies the .deploymanifest file you want to deploy.</span></span> <span data-ttu-id="a9a27-196">Se você quisesse usar o arquivo. dbschema, usaria a opção **/Model** (ou **/ModelFile**).</span><span class="sxs-lookup"><span data-stu-id="a9a27-196">If you wanted to use the .dbschema file instead, you'd use the **/model** (or **/ModelFile**) switch.</span></span>
- <span data-ttu-id="a9a27-197">A opção **/cs** (ou **/ConnectionString**) fornece a cadeia de conexão para o servidor de banco de dados de destino.</span><span class="sxs-lookup"><span data-stu-id="a9a27-197">The **/cs** (or **/ConnectionString**) switch provides the connection string for the target database server.</span></span> <span data-ttu-id="a9a27-198">Observe que isso não inclui o nome do banco de&#x2014;dados VSDBCMD precisa se conectar ao servidor para criar o banco de dados; Ele não precisa se conectar a um banco de dados individual.</span><span class="sxs-lookup"><span data-stu-id="a9a27-198">Note that this doesn't include the name of the database&#x2014;VSDBCMD needs to connect to the server to create the database; it doesn't need to connect to an individual database.</span></span> <span data-ttu-id="a9a27-199">Se o arquivo. DeployManifest incluir uma cadeia de conexão, você poderá omitir essa opção.</span><span class="sxs-lookup"><span data-stu-id="a9a27-199">If your .deploymanifest file includes a connection string, you can omit this switch.</span></span> <span data-ttu-id="a9a27-200">Se você usar a opção mesmo assim, o valor da opção substituirá o valor de. DeployManifest.</span><span class="sxs-lookup"><span data-stu-id="a9a27-200">If you use the switch anyway, the switch value will override the .deploymanifest value.</span></span>
- <span data-ttu-id="a9a27-201">A propriedade <strong>/p: TargetDatabase</strong> fornece o nome que você deseja atribuir ao banco de dados de destino na criação.</span><span class="sxs-lookup"><span data-stu-id="a9a27-201">The <strong>/p:TargetDatabase</strong> property provides the name you want to assign to the target database on creation.</span></span> <span data-ttu-id="a9a27-202">Isso substitui o valor da propriedade <strong>TargetDatabase</strong> no arquivo. DeployManifest.</span><span class="sxs-lookup"><span data-stu-id="a9a27-202">This overrides the value of the <strong>TargetDatabase</strong> property in the .deploymanifest file.</span></span> <span data-ttu-id="a9a27-203">Você pode usar a sintaxe <strong>/p:</strong> <em>[nome da propriedade]</em>para definir uma ampla variedade de propriedades de implantação e substituir quaisquer variáveis SQLCMD declaradas em seu arquivo. sqlcmdvars.</span><span class="sxs-lookup"><span data-stu-id="a9a27-203">You can use the <strong>/p:</strong> <em>[property name]</em>syntax to set a wide variety of deployment properties and to override any SQLCMD variables declared in your .sqlcmdvars file.</span></span>
- <span data-ttu-id="a9a27-204">A opção **/DD +** (ou **/DeployToDatabase +** ) indica que você deseja criar uma implantação e implantá-la no ambiente de destino.</span><span class="sxs-lookup"><span data-stu-id="a9a27-204">The **/dd+** (or **/DeployToDatabase+**) switch indicates that you want to create a deployment and deploy it to the target environment.</span></span> <span data-ttu-id="a9a27-205">Se você especificar **/DD-** ou omitir a opção, o VSDBCMD irá gerar um script de implantação, mas não o implantará no ambiente de destino.</span><span class="sxs-lookup"><span data-stu-id="a9a27-205">If you specify **/dd-**, or omit the switch, VSDBCMD will generate a deployment script but will not deploy it to the target environment.</span></span> <span data-ttu-id="a9a27-206">Essa opção é geralmente a fonte de confusão e é explicada com mais detalhes na próxima seção.</span><span class="sxs-lookup"><span data-stu-id="a9a27-206">This switch is often the source of confusion and is explained in more detail in the next section.</span></span>
- <span data-ttu-id="a9a27-207">A opção **/script** (ou **/DeploymentScriptFile**) especifica onde você deseja gerar o script de implantação.</span><span class="sxs-lookup"><span data-stu-id="a9a27-207">The **/script** (or **/DeploymentScriptFile**) switch specifies where you want to generate the deployment script.</span></span> <span data-ttu-id="a9a27-208">Esse valor não afeta o processo de implantação.</span><span class="sxs-lookup"><span data-stu-id="a9a27-208">This value does not affect the deployment process.</span></span>

<span data-ttu-id="a9a27-209">Para obter mais informações sobre VSDBCMD, consulte [referência de linha de comando para VSDBCMD. EXE (implantação e importação de esquema)](https://msdn.microsoft.com/library/dd193283.aspx) e [como preparar um banco de dados para implantação a partir de um prompt de comando usando o VSDBCMD. EXE](https://msdn.microsoft.com/library/dd193258.aspx).</span><span class="sxs-lookup"><span data-stu-id="a9a27-209">For more information on VSDBCMD, see [Command-Line Reference for VSDBCMD.EXE (Deployment and Schema Import)](https://msdn.microsoft.com/library/dd193283.aspx) and [How to: Prepare a Database for Deployment From a Command Prompt by Using VSDBCMD.EXE](https://msdn.microsoft.com/library/dd193258.aspx).</span></span>

<span data-ttu-id="a9a27-210">Para obter um exemplo de como você pode usar o VSDBCMD de um arquivo de projeto do MSBuild, consulte [noções básicas sobre o processo de compilação](understanding-the-build-process.md).</span><span class="sxs-lookup"><span data-stu-id="a9a27-210">For an example of how you can use VSDBCMD from an MSBuild project file, see [Understanding the Build Process](understanding-the-build-process.md).</span></span> <span data-ttu-id="a9a27-211">Para obter exemplos de como definir as configurações de implantação de banco de dados para vários ambientes, consulte [Personalizando implantações de banco de dados para vários ambientes](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span><span class="sxs-lookup"><span data-stu-id="a9a27-211">For examples of how to configure database deployment settings for multiple environments, see [Customizing Database Deployments for Multiple Environments](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span></span>

## <a name="understanding-the-deploytodatabase-switch"></a><span data-ttu-id="a9a27-212">Compreendendo a opção DeployToDatabase</span><span class="sxs-lookup"><span data-stu-id="a9a27-212">Understanding the DeployToDatabase Switch</span></span>

<span data-ttu-id="a9a27-213">O comportamento da opção **/DD** ou **/DeployToDatabase** depende se você está usando o VSDBCMD com um arquivo. dbschema ou um arquivo. DeployManifest.</span><span class="sxs-lookup"><span data-stu-id="a9a27-213">The behavior of the **/dd** or **/DeployToDatabase** switch depends on whether you're using VSDBCMD with a .dbschema file or a .deploymanifest file.</span></span> <span data-ttu-id="a9a27-214">Se você estiver usando um arquivo. dbschema, o comportamento será bem simples:</span><span class="sxs-lookup"><span data-stu-id="a9a27-214">If you're using a .dbschema file, the behavior is fairly straightforward:</span></span>

- <span data-ttu-id="a9a27-215">Se você especificar **/DD +** ou **/DD**, VSDBCMD irá gerar um script de implantação e implantar o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="a9a27-215">If you specify **/dd+** or **/dd**, VSDBCMD will generate a deployment script and deploy the database.</span></span>
- <span data-ttu-id="a9a27-216">Se você especificar **/DD-** ou omitir a opção, o VSDBCMD irá gerar apenas um script de implantação.</span><span class="sxs-lookup"><span data-stu-id="a9a27-216">If you specify **/dd-** or omit the switch, VSDBCMD will generate a deployment script only.</span></span>

<span data-ttu-id="a9a27-217">Se você estiver usando um arquivo. DeployManifest, o comportamento será muito mais complicado.</span><span class="sxs-lookup"><span data-stu-id="a9a27-217">If you're using a .deploymanifest file, the behavior is a lot more complicated.</span></span> <span data-ttu-id="a9a27-218">Isso ocorre porque o arquivo. DeployManifest contém um nome de propriedade **DeployToDatabase** que também determina se o banco de dados está implantado.</span><span class="sxs-lookup"><span data-stu-id="a9a27-218">This is because the .deploymanifest file contains a property name **DeployToDatabase** that also determines whether the database is deployed.</span></span>

[!code-xml[Main](deploying-database-projects/samples/sample2.xml)]

<span data-ttu-id="a9a27-219">O valor dessa propriedade é definido de acordo com as propriedades do projeto de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="a9a27-219">The value of this property is set according to the properties of the database project.</span></span> <span data-ttu-id="a9a27-220">Se você definir a **ação implantar** para **criar um script de implantação (. Sql)** , o valor será **false**.</span><span class="sxs-lookup"><span data-stu-id="a9a27-220">If you set the **Deploy action** to **Create a deployment script (.sql)**, the value will be **False**.</span></span> <span data-ttu-id="a9a27-221">Se você definir a **ação implantar** para **criar um script de implantação (. Sql) e implantar no banco de dados**, o valor será **true**.</span><span class="sxs-lookup"><span data-stu-id="a9a27-221">If you set the **Deploy action** to **Create a deployment script (.sql) and deploy to the database**, the value will be **True**.</span></span>

> [!NOTE]
> <span data-ttu-id="a9a27-222">Essas configurações estão associadas a uma plataforma e configuração de compilação específicas.</span><span class="sxs-lookup"><span data-stu-id="a9a27-222">These settings are associated with a specific build configuration and platform.</span></span> <span data-ttu-id="a9a27-223">Por exemplo, se você definir as configurações para a configuração de **depuração** e, em seguida, publicar usando a configuração de **versão** , suas configurações não serão usadas.</span><span class="sxs-lookup"><span data-stu-id="a9a27-223">For example, if you configure settings for the **Debug** configuration and then publish using the **Release** configuration, your settings will not be used.</span></span>

![](deploying-database-projects/_static/image3.png)

> [!NOTE]
> <span data-ttu-id="a9a27-224">Nesse cenário, a **ação implantar** sempre deve ser definida para **criar um script de implantação (. Sql)** , porque você não quer que o Visual Studio 2010 implante seu banco de dados.</span><span class="sxs-lookup"><span data-stu-id="a9a27-224">In this scenario, the **Deploy action** should always be set to **Create a deployment script (.sql)**, because you don't want Visual Studio 2010 to deploy your database.</span></span> <span data-ttu-id="a9a27-225">Em outras palavras, a propriedade **DeployToDatabase** sempre deve ser **falsa**.</span><span class="sxs-lookup"><span data-stu-id="a9a27-225">In other words, the **DeployToDatabase** property should always be **False**.</span></span>

<span data-ttu-id="a9a27-226">Quando uma propriedade **DeployToDatabase** é especificada, a opção **/DD** só substituirá a propriedade se o valor da propriedade for **false**:</span><span class="sxs-lookup"><span data-stu-id="a9a27-226">When a **DeployToDatabase** property is specified, the **/dd** switch will only override the property if the property value is **false**:</span></span>

- <span data-ttu-id="a9a27-227">Se a propriedade **DeployToDatabase** for **false**e você especificar **/DD +** ou **/DD**, VSDBCMD substituirá a propriedade **DeployToDatabase** e implantará o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="a9a27-227">If the **DeployToDatabase** property is **False**, and you specify **/dd+** or **/dd**, VSDBCMD will override the **DeployToDatabase** property and deploy the database.</span></span>
- <span data-ttu-id="a9a27-228">Se a propriedade **DeployToDatabase** for **false**e você especificar **/DD-** ou omitir a opção, VSDBCMD não implantará o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="a9a27-228">If the **DeployToDatabase** property is **False**, and you specify **/dd-** or omit the switch, VSDBCMD will not deploy the database.</span></span>
- <span data-ttu-id="a9a27-229">Se a propriedade **DeployToDatabase** for **true**, VSDBCMD ignorará a opção e implantará o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="a9a27-229">If the **DeployToDatabase** property is **True**, VSDBCMD will ignore the switch and deploy the database.</span></span>
- <span data-ttu-id="a9a27-230">Um script de implantação é gerado em cada caso, independentemente de você estar implantando o banco de dados também.</span><span class="sxs-lookup"><span data-stu-id="a9a27-230">A deployment script is generated in each case, regardless of whether you're deploying the database as well.</span></span>

## <a name="conclusion"></a><span data-ttu-id="a9a27-231">Conclusão</span><span class="sxs-lookup"><span data-stu-id="a9a27-231">Conclusion</span></span>

<span data-ttu-id="a9a27-232">Este tópico forneceu uma visão geral do processo de compilação e implantação para projetos de banco de dados no Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="a9a27-232">This topic provided an overview of the build and deployment process for database projects in Visual Studio 2010.</span></span> <span data-ttu-id="a9a27-233">Ele também descreveu como você pode usar o VSDBCMD. exe com o MSBuild para dar suporte à implantação de banco de dados de escala empresarial.</span><span class="sxs-lookup"><span data-stu-id="a9a27-233">It also described how you can use VSDBCMD.exe with MSBuild to support enterprise-scale database deployment.</span></span>

<span data-ttu-id="a9a27-234">Para obter mais informações sobre como isso funciona na prática, consulte [Personalizando implantações de banco de dados para vários ambientes](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span><span class="sxs-lookup"><span data-stu-id="a9a27-234">For more information on how this works in practice, see [Customizing Database Deployments for Multiple Environments](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span></span>

## <a name="further-reading"></a><span data-ttu-id="a9a27-235">Leitura adicional</span><span class="sxs-lookup"><span data-stu-id="a9a27-235">Further Reading</span></span>

<span data-ttu-id="a9a27-236">Para obter informações sobre como personalizar implantações de banco de dados criando um arquivo de configuração de implantação separado para cada ambiente, consulte [Personalizando implantações de banco de dados para vários ambientes](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span><span class="sxs-lookup"><span data-stu-id="a9a27-236">For information on how to customize database deployments by creating a separate deployment configuration file for each environment, see [Customizing Database Deployments for Multiple Environments](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span></span> <span data-ttu-id="a9a27-237">Para obter orientação sobre como configurar associações de função de banco de dados executando um script pós-implantação, consulte [implantando associações de função de banco de dados para ambientes de teste](../advanced-enterprise-web-deployment/deploying-database-role-memberships-to-test-environments.md).</span><span class="sxs-lookup"><span data-stu-id="a9a27-237">For guidance on how to configure database role memberships by running a post-deployment script, see [Deploying Database Role Memberships to Test Environments](../advanced-enterprise-web-deployment/deploying-database-role-memberships-to-test-environments.md).</span></span> <span data-ttu-id="a9a27-238">Para obter orientação sobre como gerenciar alguns dos desafios exclusivos que os bancos de dados de associação impõem, consulte [implantando bancos de dados de associação em ambientes corporativos](../advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments.md).</span><span class="sxs-lookup"><span data-stu-id="a9a27-238">For guidance on managing some of the unique challenges that membership databases impose, see [Deploying Membership Databases to Enterprise Environments](../advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments.md).</span></span>

<span data-ttu-id="a9a27-239">Estes tópicos sobre o MSDN fornecem diretrizes mais amplas e informações básicas sobre projetos de banco de dados do Visual Studio e o processo de implantação de banco de dados:</span><span class="sxs-lookup"><span data-stu-id="a9a27-239">These topics on MSDN provide broader guidance and background information on Visual Studio database projects and the database deployment process:</span></span>

- [<span data-ttu-id="a9a27-240">Projetos de banco de dados do Visual Studio 2010 SQL Server</span><span class="sxs-lookup"><span data-stu-id="a9a27-240">Visual Studio 2010 SQL Server Database Projects</span></span>](https://msdn.microsoft.com/library/ff678491.aspx)
- [<span data-ttu-id="a9a27-241">Gerenciando a alteração do banco de dados</span><span class="sxs-lookup"><span data-stu-id="a9a27-241">Managing Database Change</span></span>](https://msdn.microsoft.com/library/aa833404.aspx)
- [<span data-ttu-id="a9a27-242">Como preparar um banco de dados para implantação a partir de um prompt de comando usando VSDBCMD. EXE</span><span class="sxs-lookup"><span data-stu-id="a9a27-242">How to: Prepare a Database for Deployment From a Command Prompt by Using VSDBCMD.EXE</span></span>](https://msdn.microsoft.com/library/dd193258.aspx)
- [<span data-ttu-id="a9a27-243">Uma visão geral do Compilação e Implantação de banco de dados</span><span class="sxs-lookup"><span data-stu-id="a9a27-243">An Overview of Database Build and Deployment</span></span>](https://msdn.microsoft.com/library/aa833165.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="a9a27-244">[Anterior](deploying-web-packages.md)
> [Próximo](creating-and-running-a-deployment-command-file.md)</span><span class="sxs-lookup"><span data-stu-id="a9a27-244">[Previous](deploying-web-packages.md)
[Next](creating-and-running-a-deployment-command-file.md)</span></span>
