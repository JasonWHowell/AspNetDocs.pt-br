---
uid: web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/create_the_data_access_layer
title: Criar a camada de acesso a dados | Microsoft Docs
author: Erikre
description: Esta série de tutoriais ensinará as noções básicas da criação de um aplicativo ASP.NET Web Forms usando o ASP.NET 4,5 e o Microsoft Visual Studio Express 2013 para nós...
ms.author: riande
ms.date: 09/08/2014
ms.assetid: 0bbf7a6e-d7eb-4091-91e4-fff892777f32
msc.legacyurl: /web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/create_the_data_access_layer
msc.type: authoredcontent
ms.openlocfilehash: 0fcf050474a57be9ed53ec0783a6d6b7dde2bf4c
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78544922"
---
# <a name="create-the-data-access-layer"></a><span data-ttu-id="d3f1b-103">Criar a camada de acesso a dados</span><span class="sxs-lookup"><span data-stu-id="d3f1b-103">Create the Data Access Layer</span></span>

<span data-ttu-id="d3f1b-104">por [Erik Reitan](https://github.com/Erikre)</span><span class="sxs-lookup"><span data-stu-id="d3f1b-104">by [Erik Reitan](https://github.com/Erikre)</span></span>

<span data-ttu-id="d3f1b-105">[Baixar o projeto de exemplo WingtipC#Toys ()](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) ou [baixar o livro eletrônico (PDF)](https://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)</span><span class="sxs-lookup"><span data-stu-id="d3f1b-105">[Download Wingtip Toys Sample Project (C#)](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) or [Download E-book (PDF)](https://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)</span></span>

> <span data-ttu-id="d3f1b-106">Esta série de tutoriais ensinará as noções básicas da criação de um aplicativo ASP.NET Web Forms usando o ASP.NET 4,5 e o Microsoft Visual Studio Express 2013 para a Web.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-106">This tutorial series will teach you the basics of building an ASP.NET Web Forms application using ASP.NET 4.5 and Microsoft Visual Studio Express 2013 for Web.</span></span> <span data-ttu-id="d3f1b-107">Um [projeto Visual Studio 2013 com C# código-fonte](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) está disponível para acompanhar esta série de tutoriais.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-107">A Visual Studio 2013 [project with C# source code](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) is available to accompany this tutorial series.</span></span>

<span data-ttu-id="d3f1b-108">Este tutorial descreve como criar, acessar e examinar dados de um banco de dado usando o ASP.NET Web Forms e Entity Framework Code First.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-108">This tutorial describes how to create, access, and review data from a database using ASP.NET Web Forms and Entity Framework Code First.</span></span> <span data-ttu-id="d3f1b-109">Este tutorial se baseia no tutorial anterior "criar o projeto" e faz parte da série de tutoriais da loja Wingtip Toy.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-109">This tutorial builds on the previous tutorial "Create the Project" and is part of the Wingtip Toy Store tutorial series.</span></span> <span data-ttu-id="d3f1b-110">Após concluir este tutorial, você terá criado um grupo de classes de acesso a dados que estão na pasta *modelos* do projeto.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-110">When you've completed this tutorial, you will have built a group of data-access classes that are in the *Models* folder of the project.</span></span>

## <a name="what-youll-learn"></a><span data-ttu-id="d3f1b-111">O que você aprenderá:</span><span class="sxs-lookup"><span data-stu-id="d3f1b-111">What you'll learn:</span></span>

- <span data-ttu-id="d3f1b-112">Como criar modelos de dados.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-112">How to create the data models.</span></span>
- <span data-ttu-id="d3f1b-113">Como inicializar e propagar o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-113">How to initialize and seed the database.</span></span>
- <span data-ttu-id="d3f1b-114">Como atualizar e configurar o aplicativo para dar suporte ao banco de dados.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-114">How to update and configure the application to support the database.</span></span>

### <a name="these-are-the-features-introduced-in-the-tutorial"></a><span data-ttu-id="d3f1b-115">Estes são os recursos apresentados no tutorial:</span><span class="sxs-lookup"><span data-stu-id="d3f1b-115">These are the features introduced in the tutorial:</span></span>

- <span data-ttu-id="d3f1b-116">Entity Framework Code First</span><span class="sxs-lookup"><span data-stu-id="d3f1b-116">Entity Framework Code First</span></span>
- <span data-ttu-id="d3f1b-117">LocalDB</span><span class="sxs-lookup"><span data-stu-id="d3f1b-117">LocalDB</span></span>
- <span data-ttu-id="d3f1b-118">Anotações de dados</span><span class="sxs-lookup"><span data-stu-id="d3f1b-118">Data Annotations</span></span>

## <a name="creating-the-data-models"></a><span data-ttu-id="d3f1b-119">Criando os modelos de dados</span><span class="sxs-lookup"><span data-stu-id="d3f1b-119">Creating the Data Models</span></span>

<span data-ttu-id="d3f1b-120">[Entity Framework](https://msdn.microsoft.com/data/aa937723) é uma estrutura de ORM (mapeamento relacional de objeto).</span><span class="sxs-lookup"><span data-stu-id="d3f1b-120">[Entity Framework](https://msdn.microsoft.com/data/aa937723) is an object-relational mapping (ORM) framework.</span></span> <span data-ttu-id="d3f1b-121">Ele permite que você trabalhe com dados relacionais como objetos, eliminando a maior parte do código de acesso a dados que normalmente seria necessário escrever.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-121">It lets you work with relational data as objects, eliminating most of the data-access code that you'd usually need to write.</span></span> <span data-ttu-id="d3f1b-122">Usando Entity Framework, você pode emitir consultas usando [LINQ](https://msdn.microsoft.com/library/bb397926.aspx)e, em seguida, recuperar e manipular dados como objetos fortemente tipados.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-122">Using Entity Framework, you can issue queries using [LINQ](https://msdn.microsoft.com/library/bb397926.aspx), then retrieve and manipulate data as strongly typed objects.</span></span> <span data-ttu-id="d3f1b-123">O LINQ fornece padrões para consultar e atualizar dados.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-123">LINQ provides patterns for querying and updating data.</span></span> <span data-ttu-id="d3f1b-124">O uso de Entity Framework permite que você se concentre na criação do restante do seu aplicativo, em vez de concentrar-se nos conceitos básicos de acesso a dados.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-124">Using Entity Framework allows you to focus on creating the rest of your application, rather than focusing on the data access fundamentals.</span></span> <span data-ttu-id="d3f1b-125">Posteriormente nesta série de tutoriais, mostraremos como usar os dados para popular a navegação e as consultas de produtos.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-125">Later in this tutorial series, we'll show you how to use the data to populate navigation and product queries.</span></span>

<span data-ttu-id="d3f1b-126">O Entity Framework dá suporte a um paradigma de desenvolvimento chamado *Code First*.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-126">Entity Framework supports a development paradigm called *Code First*.</span></span> <span data-ttu-id="d3f1b-127">Code First permite que você defina seus modelos de dados usando classes.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-127">Code First lets you define your data models using classes.</span></span> <span data-ttu-id="d3f1b-128">Uma classe é uma construção que permite que você crie seus próprios tipos personalizados agrupando variáveis de outros tipos, métodos e eventos.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-128">A class is a construct that enables you to create your own custom types by grouping together variables of other types, methods and events.</span></span> <span data-ttu-id="d3f1b-129">Você pode mapear classes para um banco de dados existente ou usá-las para gerar um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-129">You can map classes to an existing database or use them to generate a database.</span></span> <span data-ttu-id="d3f1b-130">Neste tutorial, você criará os modelos de dados escrevendo classes de modelo de dados.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-130">In this tutorial, you'll create the data models by writing data model classes.</span></span> <span data-ttu-id="d3f1b-131">Em seguida, você permitirá Entity Framework criar o banco de dados instantaneamente a partir dessas novas classes.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-131">Then, you'll let Entity Framework create the database on the fly from these new classes.</span></span>

<span data-ttu-id="d3f1b-132">Você começará criando as classes de entidade que definem os modelos de dados para o aplicativo Web Forms.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-132">You will begin by creating the entity classes that define the data models for the Web Forms application.</span></span> <span data-ttu-id="d3f1b-133">Em seguida, você criará uma classe de contexto que gerencia as classes de entidade e fornece acesso a dados ao banco de dado.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-133">Then you will create a context class that manages the entity classes and provides data access to the database.</span></span> <span data-ttu-id="d3f1b-134">Você também criará uma classe de inicializador que será usada para popular o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-134">You will also create an initializer class that you will use to populate the database.</span></span>

### <a name="entity-framework-and-references"></a><span data-ttu-id="d3f1b-135">Entity Framework e referências</span><span class="sxs-lookup"><span data-stu-id="d3f1b-135">Entity Framework and References</span></span>

<span data-ttu-id="d3f1b-136">Por padrão, Entity Framework é incluído quando você cria um novo **aplicativo Web ASP.net** usando o modelo de **Web Forms** .</span><span class="sxs-lookup"><span data-stu-id="d3f1b-136">By default, Entity Framework is included when you create a new **ASP.NET Web Application** using the **Web Forms** template.</span></span> <span data-ttu-id="d3f1b-137">Entity Framework pode ser instalado, desinstalado e atualizado como um pacote NuGet.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-137">Entity Framework can be installed, uninstalled, and updated as a NuGet package.</span></span>

<span data-ttu-id="d3f1b-138">Este pacote NuGet inclui os seguintes assemblies de **tempo de execução** em seu projeto:</span><span class="sxs-lookup"><span data-stu-id="d3f1b-138">This NuGet package includes the following **runtime** assemblies within your project:</span></span>

- <span data-ttu-id="d3f1b-139">EntityFramework. dll – todo o código de tempo de execução comum usado pelo Entity Framework</span><span class="sxs-lookup"><span data-stu-id="d3f1b-139">EntityFramework.dll – All the common runtime code used by Entity Framework</span></span>
- <span data-ttu-id="d3f1b-140">EntityFramework. SqlServer. dll – o provedor de Microsoft SQL Server para Entity Framework</span><span class="sxs-lookup"><span data-stu-id="d3f1b-140">EntityFramework.SqlServer.dll – The Microsoft SQL Server provider for Entity Framework</span></span>

### <a name="entity-classes"></a><span data-ttu-id="d3f1b-141">Classes de entidade</span><span class="sxs-lookup"><span data-stu-id="d3f1b-141">Entity Classes</span></span>

<span data-ttu-id="d3f1b-142">As classes que você cria para definir o esquema dos dados são chamadas de classes de entidade.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-142">The classes you create to define the schema of the data are called entity classes.</span></span> <span data-ttu-id="d3f1b-143">Se você for novo no design de banco de dados, considere as classes de entidade como definições de tabela de um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-143">If you're new to database design, think of the entity classes as table definitions of a database.</span></span> <span data-ttu-id="d3f1b-144">Cada propriedade na classe especifica uma coluna na tabela do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-144">Each property in the class specifies a column in the table of the database.</span></span> <span data-ttu-id="d3f1b-145">Essas classes fornecem uma interface leve e relacional de objeto entre o código orientado a objeto e a estrutura de tabela relacional do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-145">These classes provide a lightweight, object-relational interface between object-oriented code and the relational table structure of the database.</span></span>

<span data-ttu-id="d3f1b-146">Neste tutorial, você começará adicionando classes de entidade simples representando os esquemas para produtos e categorias.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-146">In this tutorial, you'll start out by adding simple entity classes representing the schemas for products and categories.</span></span> <span data-ttu-id="d3f1b-147">A classe Products conterá definições para cada produto.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-147">The products class will contain definitions for each product.</span></span> <span data-ttu-id="d3f1b-148">O nome de cada um dos membros da classe Product será `ProductID`, `ProductName`, `Description`, `ImagePath`, `UnitPrice`, `CategoryID`e `Category`.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-148">The name of each of the members of the product class will be `ProductID`, `ProductName`, `Description`, `ImagePath`, `UnitPrice`, `CategoryID`, and `Category`.</span></span> <span data-ttu-id="d3f1b-149">A classe Category conterá definições para cada categoria à qual um produto pode pertencer, como carro, barco ou avião.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-149">The category class will contain definitions for each category that a product can belong to, such as Car, Boat, or Plane.</span></span> <span data-ttu-id="d3f1b-150">O nome de cada um dos membros da classe Category será `CategoryID`, `CategoryName`, `Description`e `Products`.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-150">The name of each of the members of the category class will be `CategoryID`, `CategoryName`, `Description`, and `Products`.</span></span> <span data-ttu-id="d3f1b-151">Cada produto pertencerá a uma das categorias.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-151">Each product will belong to one of the categories.</span></span> <span data-ttu-id="d3f1b-152">Essas classes de entidade serão adicionadas à pasta *modelos* existentes do projeto.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-152">These entity classes will be added to the project's existing *Models* folder.</span></span>

1. <span data-ttu-id="d3f1b-153">Em **Gerenciador de soluções**, clique com o botão direito do mouse na pasta *modelos* e, em seguida, selecione **Adicionar** -&gt; **novo item**.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-153">In **Solution Explorer**, right-click the *Models* folder and then select **Add** -&gt; **New Item**.</span></span> 

    ![Criar a camada de acesso a dados – menu novo item](create_the_data_access_layer/_static/image1.png)

   <span data-ttu-id="d3f1b-155">A caixa de diálogo **Adicionar novo item** é exibida.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-155">The **Add New Item** dialog box is displayed.</span></span>
2. <span data-ttu-id="d3f1b-156">Em **Visual C#**  no painel **instalado** à esquerda, selecione **código**.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-156">Under **Visual C#** from the **Installed** pane on the left, select **Code**.</span></span> 

    ![Criar a camada de acesso a dados – menu novo item](create_the_data_access_layer/_static/image2.png)
3. <span data-ttu-id="d3f1b-158">Selecione **classe** no painel central e nomeie essa nova classe *Product.cs*.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-158">Select **Class** from the middle pane and name this new class *Product.cs*.</span></span>
4. <span data-ttu-id="d3f1b-159">Clique em **Adicionar**.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-159">Click **Add**.</span></span>  
   <span data-ttu-id="d3f1b-160">O novo arquivo de classe é exibido no editor.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-160">The new class file is displayed in the editor.</span></span>
5. <span data-ttu-id="d3f1b-161">Substitua o código padrão pelo código a seguir:</span><span class="sxs-lookup"><span data-stu-id="d3f1b-161">Replace the default code with the following code:</span></span>   

    [!code-csharp[Main](create_the_data_access_layer/samples/sample1.cs)]
6. <span data-ttu-id="d3f1b-162">Crie outra classe repetindo as etapas 1 a 4, no entanto, nomeie a nova classe *Category.cs* e substitua o código padrão pelo código a seguir:</span><span class="sxs-lookup"><span data-stu-id="d3f1b-162">Create another class by repeating steps 1 through 4, however, name the new class *Category.cs* and replace the default code with the following code:</span></span>  

    [!code-csharp[Main](create_the_data_access_layer/samples/sample2.cs)]

<span data-ttu-id="d3f1b-163">Como mencionado anteriormente, a classe `Category` representa o tipo de produto que o aplicativo foi projetado para vender (como <a id="a"></a>&quot;carros&quot;, &quot;Boats&quot;, &quot;rockets&quot;e assim por diante) e a classe `Product` representa os produtos individuais (Toys) no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-163">As previously mentioned, the `Category` class represents the type of product that the application is designed to sell (such as <a id="a"></a>&quot;Cars&quot;, &quot;Boats&quot;, &quot;Rockets&quot;, and so on), and the `Product` class represents the individual products (toys) in the database.</span></span> <span data-ttu-id="d3f1b-164">Cada instância de um objeto de `Product` corresponderá a uma linha dentro de uma tabela de banco de dados relacional e cada propriedade da classe Product será mapeada para uma coluna na tabela de banco de dados relacional.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-164">Each instance of a `Product` object will correspond to a row within a relational database table, and each property of the Product class will map to a column in the relational database table.</span></span> <span data-ttu-id="d3f1b-165">Posteriormente neste tutorial, você examinará os dados do produto contidos no banco de dado.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-165">Later in this tutorial, you'll review the product data contained in the database.</span></span>

### <a name="data-annotations"></a><span data-ttu-id="d3f1b-166">Anotações de dados</span><span class="sxs-lookup"><span data-stu-id="d3f1b-166">Data Annotations</span></span>

<span data-ttu-id="d3f1b-167">Talvez você tenha notado que determinados membros das classes têm atributos especificando detalhes sobre o membro, como `[ScaffoldColumn(false)]`.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-167">You may have noticed that certain members of the classes have attributes specifying details about the member, such as `[ScaffoldColumn(false)]`.</span></span> <span data-ttu-id="d3f1b-168">Essas são *anotações de dados*.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-168">These are *data annotations*.</span></span> <span data-ttu-id="d3f1b-169">Os atributos de anotação de dados podem descrever como validar a entrada do usuário para esse membro, especificar a formatação para ele e especificar como ele é modelado quando o banco de dados é criado.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-169">The data annotation attributes can describe how to validate user input for that member, to specify formatting for it, and to specify how it is modeled when the database is created.</span></span>

### <a name="context-class"></a><span data-ttu-id="d3f1b-170">Classe Context</span><span class="sxs-lookup"><span data-stu-id="d3f1b-170">Context Class</span></span>

<span data-ttu-id="d3f1b-171">Para começar a usar as classes de acesso a dados, você deve definir uma classe de contexto.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-171">To start using the classes for data access, you must define a context class.</span></span> <span data-ttu-id="d3f1b-172">Conforme mencionado anteriormente, a classe de contexto gerencia as classes de entidade (como a classe `Product` e a classe `Category`) e fornece acesso a dados ao banco de dado.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-172">As mentioned previously, the context class manages the entity classes (such as the `Product` class and the `Category` class) and provides data access to the database.</span></span>

<span data-ttu-id="d3f1b-173">Este procedimento adiciona uma nova C# classe de contexto à pasta *modelos* .</span><span class="sxs-lookup"><span data-stu-id="d3f1b-173">This procedure adds a new C# context class to the *Models* folder.</span></span>

1. <span data-ttu-id="d3f1b-174">Clique com o botão direito do mouse na pasta *modelos* e selecione **Adicionar** -&gt; **novo item**.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-174">Right-click the *Models* folder and then select **Add** -&gt; **New Item**.</span></span>   
   <span data-ttu-id="d3f1b-175">A caixa de diálogo **Adicionar novo item** é exibida.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-175">The **Add New Item** dialog box is displayed.</span></span>
2. <span data-ttu-id="d3f1b-176">Selecione **classe** no painel central, nomeie-a *ProductContext.cs* e clique em **Adicionar**.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-176">Select **Class** from the middle pane, name it *ProductContext.cs* and click **Add**.</span></span>
3. <span data-ttu-id="d3f1b-177">Substitua o código padrão contido na classe pelo código a seguir:</span><span class="sxs-lookup"><span data-stu-id="d3f1b-177">Replace the default code contained in the class with the following code:</span></span>   

    [!code-csharp[Main](create_the_data_access_layer/samples/sample3.cs)]

<span data-ttu-id="d3f1b-178">Esse código adiciona o namespace `System.Data.Entity` para que você tenha acesso a toda a funcionalidade básica do Entity Framework, que inclui a capacidade de consultar, inserir, atualizar e excluir dados trabalhando com objetos fortemente tipados.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-178">This code adds the `System.Data.Entity` namespace so that you have access to all the core functionality of Entity Framework, which includes the capability to query, insert, update, and delete data by working with strongly typed objects.</span></span>

<span data-ttu-id="d3f1b-179">A classe `ProductContext` representa Entity Framework contexto de banco de dados do produto, que lida com a busca, o armazenamento e a atualização de `Product` instâncias de classe no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-179">The `ProductContext` class represents Entity Framework product database context, which handles fetching, storing, and updating `Product` class instances in the database.</span></span> <span data-ttu-id="d3f1b-180">A classe `ProductContext` deriva da classe base `DbContext` fornecida pelo Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-180">The `ProductContext` class derives from the `DbContext` base class provided by Entity Framework.</span></span>

### <a name="initializer-class"></a><span data-ttu-id="d3f1b-181">Classe do inicializador</span><span class="sxs-lookup"><span data-stu-id="d3f1b-181">Initializer Class</span></span>

<span data-ttu-id="d3f1b-182">Você precisará executar alguma lógica personalizada para inicializar o banco de dados na primeira vez em que o contexto for usado.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-182">You will need to run some custom logic to initialize the database the first time the context is used.</span></span> <span data-ttu-id="d3f1b-183">Isso permitirá que os dados de propagação sejam adicionados ao banco de dado para que você possa exibir imediatamente os produtos e as categorias.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-183">This will allow seed data to be added to the database so that you can immediately display products and categories.</span></span>

<span data-ttu-id="d3f1b-184">Este procedimento adiciona uma nova C# classe de inicializador à pasta *modelos* .</span><span class="sxs-lookup"><span data-stu-id="d3f1b-184">This procedure adds a new C# initializer class to the *Models* folder.</span></span>

1. <span data-ttu-id="d3f1b-185">Crie outro `Class` na pasta *modelos* e nomeie-o *ProductDatabaseInitializer.cs*.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-185">Create another `Class` in the *Models* folder and name it *ProductDatabaseInitializer.cs*.</span></span>
2. <span data-ttu-id="d3f1b-186">Substitua o código padrão contido na classe pelo código a seguir:</span><span class="sxs-lookup"><span data-stu-id="d3f1b-186">Replace the default code contained in the class with the following code:</span></span>   

    [!code-csharp[Main](create_the_data_access_layer/samples/sample4.cs)]

<span data-ttu-id="d3f1b-187">Como você pode ver no código acima, quando o banco de dados é criado e inicializado, a propriedade `Seed` é substituída e definida.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-187">As you can see from the above code, when the database is created and initialized, the `Seed` property is overridden and set.</span></span> <span data-ttu-id="d3f1b-188">Quando a propriedade `Seed` é definida, os valores das categorias e dos produtos são usados para popular o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-188">When the `Seed` property is set, the values from the categories and products are used to populate the database.</span></span> <span data-ttu-id="d3f1b-189">Se você tentar atualizar os dados de semente modificando o código acima depois que o banco de dado tiver sido criado, você não verá nenhuma atualização ao executar o aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-189">If you attempt to update the seed data by modifying the above code after the database has been created, you won't see any updates when you run the Web application.</span></span> <span data-ttu-id="d3f1b-190">O motivo é que o código acima usa uma implementação da classe `DropCreateDatabaseIfModelChanges` para reconhecer se o modelo (esquema) foi alterado antes de redefinir os dados semente.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-190">The reason is the above code uses an implementation of the `DropCreateDatabaseIfModelChanges` class to recognize if the model (schema) has changed before resetting the seed data.</span></span> <span data-ttu-id="d3f1b-191">Se nenhuma alteração for feita nas classes de entidade `Category` e `Product`, o banco de dados não será reinicializado com os dados de semente.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-191">If no changes are made to the `Category` and `Product` entity classes, the database will not be reinitialized with the seed data.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="d3f1b-192">Se você quisesse que o banco de dados fosse recriado toda vez que executou o aplicativo, você poderia usar a classe `DropCreateDatabaseAlways` em vez da classe `DropCreateDatabaseIfModelChanges`.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-192">If you wanted the database to be recreated every time you ran the application, you could use the `DropCreateDatabaseAlways` class instead of the `DropCreateDatabaseIfModelChanges` class.</span></span> <span data-ttu-id="d3f1b-193">No entanto, para esta série de tutoriais, use a classe `DropCreateDatabaseIfModelChanges`.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-193">However for this tutorial series, use the `DropCreateDatabaseIfModelChanges` class.</span></span>

<span data-ttu-id="d3f1b-194">Neste ponto deste tutorial, você terá uma pasta *modelos* com quatro novas classes e uma classe padrão:</span><span class="sxs-lookup"><span data-stu-id="d3f1b-194">At this point in this tutorial, you will have a *Models* folder with four new classes and one default class:</span></span>

![Criar a pasta camada de acesso a dados-modelos](create_the_data_access_layer/_static/image3.png)

### <a name="configuring-the-application-to-use-the-data-model"></a><span data-ttu-id="d3f1b-196">Configurando o aplicativo para usar o modelo de dados</span><span class="sxs-lookup"><span data-stu-id="d3f1b-196">Configuring the Application to Use the Data Model</span></span>

<span data-ttu-id="d3f1b-197">Agora que você criou as classes que representam os dados, deve configurar o aplicativo para usar as classes.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-197">Now that you've created the classes that represent the data, you must configure the application to use the classes.</span></span> <span data-ttu-id="d3f1b-198">No arquivo *global. asax* , você adiciona um código que inicializa o modelo.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-198">In the *Global.asax* file, you add code that initializes the model.</span></span> <span data-ttu-id="d3f1b-199">No arquivo *Web. config* , você adiciona informações que dizem ao aplicativo qual banco de dados você usará para armazenar o dado que é representado pelas novas classes de dados.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-199">In the *Web.config* file you add information that tells the application what database you'll use to store the data that's represented by the new data classes.</span></span> <span data-ttu-id="d3f1b-200">O arquivo *global. asax* pode ser usado para manipular eventos ou métodos de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-200">The *Global.asax* file can be used to handle application events or methods.</span></span> <span data-ttu-id="d3f1b-201">O arquivo *Web. config* permite que você controle a configuração do seu aplicativo Web ASP.net.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-201">The *Web.config* file allows you to control the configuration of your ASP.NET web application.</span></span>

#### <a name="updating-the-globalasax-file"></a><span data-ttu-id="d3f1b-202">Atualizando o arquivo global. asax</span><span class="sxs-lookup"><span data-stu-id="d3f1b-202">Updating the Global.asax file</span></span>

<span data-ttu-id="d3f1b-203">Para inicializar os modelos de dados quando o aplicativo for iniciado, você atualizará o manipulador de `Application_Start` no arquivo *global.asax.cs* .</span><span class="sxs-lookup"><span data-stu-id="d3f1b-203">To initialize the data models when the application starts, you will update the `Application_Start` handler in the *Global.asax.cs* file.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="d3f1b-204">No Gerenciador de Soluções, você pode selecionar o arquivo *global. asax* ou o arquivo *global.asax.cs* para editar o arquivo *global.asax.cs* .</span><span class="sxs-lookup"><span data-stu-id="d3f1b-204">In Solution Explorer, you can select either the *Global.asax* file or the *Global.asax.cs* file to edit the *Global.asax.cs* file.</span></span>

1. <span data-ttu-id="d3f1b-205">Adicione o código a seguir realçado em amarelo para o método `Application_Start` no arquivo *global.asax.cs* .</span><span class="sxs-lookup"><span data-stu-id="d3f1b-205">Add the following code highlighted in yellow to the `Application_Start` method in the *Global.asax.cs* file.</span></span>   

    [!code-csharp[Main](create_the_data_access_layer/samples/sample5.cs?highlight=9-10,22-23)]

> [!NOTE] 
> 
> <span data-ttu-id="d3f1b-206">Seu navegador deve dar suporte a HTML5 para exibir o código realçado em amarelo ao exibir esta série de tutoriais em um navegador.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-206">Your browser must support HTML5 to view the code highlighted in yellow when viewing this tutorial series in a browser.</span></span>

<span data-ttu-id="d3f1b-207">Conforme mostrado no código acima, quando o aplicativo é iniciado, o aplicativo especifica o inicializador que será executado durante a primeira vez que os dados são acessados.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-207">As shown in the above code, when the application starts, the application specifies the initializer that will run during the first time the data is accessed.</span></span> <span data-ttu-id="d3f1b-208">Os dois namespaces adicionais são necessários para acessar o objeto `Database` e o objeto `ProductDatabaseInitializer`.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-208">The two additional namespaces are required to access the `Database` object and the `ProductDatabaseInitializer` object.</span></span>

 <span data-ttu-id="d3f1b-209">Modificando o arquivo Web. config</span><span class="sxs-lookup"><span data-stu-id="d3f1b-209">Modifying the Web.Config File</span></span> 

<span data-ttu-id="d3f1b-210">Embora Entity Framework Code First gere um banco de dados para você em um local padrão quando o banco de dado é populado com data de propagação, adicionar suas próprias informações de conexão ao seu aplicativo lhe dá controle do local do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-210">Although Entity Framework Code First will generate a database for you in a default location when the database is populated with seed data, adding your own connection information to your application gives you control of the database location.</span></span> <span data-ttu-id="d3f1b-211">Você especifica essa conexão de banco de dados usando uma cadeia de conexão no arquivo *Web. config* do aplicativo na raiz do projeto.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-211">You specify this database connection using a connection string in the application's *Web.config* file at the root of the project.</span></span> <span data-ttu-id="d3f1b-212">Ao adicionar uma nova cadeia de conexão, você pode direcionar o local do banco de dados (*wingtiptoys. MDF*) para que ele seja compilado no diretório data do aplicativo (*dados de\_do aplicativo*), em vez de seu local padrão.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-212">By adding a new connection string, you can direct the location of the database (*wingtiptoys.mdf*) to be built in the application's data directory (*App\_Data*), rather than its default location.</span></span> <span data-ttu-id="d3f1b-213">Fazer essa alteração permitirá que você encontre e inspecione o arquivo de banco de dados mais adiante neste tutorial.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-213">Making this change will allow you to find and inspect the database file later in this tutorial.</span></span>

1. <span data-ttu-id="d3f1b-214">Em **Gerenciador de soluções**, localize e abra o arquivo *Web. config* .</span><span class="sxs-lookup"><span data-stu-id="d3f1b-214">In **Solution Explorer**, find and open the *Web.config* file.</span></span>
2. <span data-ttu-id="d3f1b-215">Adicione a cadeia de conexão realçada em amarelo à seção `<connectionStrings>` do arquivo *Web. config* da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="d3f1b-215">Add the connection string highlighted in yellow to the `<connectionStrings>` section of the *Web.config* file as follows:</span></span>  

    [!code-xml[Main](create_the_data_access_layer/samples/sample6.xml?highlight=4-7)]

<span data-ttu-id="d3f1b-216">Quando o aplicativo for executado pela primeira vez, ele criará o banco de dados no local especificado pela cadeia de conexão.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-216">When the application is run for the first time, it will build the database at the location specified by the connection string.</span></span> <span data-ttu-id="d3f1b-217">Mas antes de executar o aplicativo, vamos compilá-lo primeiro.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-217">But before running the application, let's build it first.</span></span>

## <a name="building-the-application"></a><span data-ttu-id="d3f1b-218">Compilando o aplicativo</span><span class="sxs-lookup"><span data-stu-id="d3f1b-218">Building the Application</span></span>

<span data-ttu-id="d3f1b-219">Para garantir que todas as classes e alterações em seu aplicativo Web funcionem, você deve compilar o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-219">To make sure that all the classes and changes to your Web application work, you should build the application.</span></span>

1. <span data-ttu-id="d3f1b-220">No menu **depurar** , selecione **criar WingtipToys**.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-220">From the **Debug** menu, select **Build WingtipToys**.</span></span>  
 <span data-ttu-id="d3f1b-221">A janela **saída** é exibida e, se tudo der certo, você verá uma mensagem bem- *sucedida* .</span><span class="sxs-lookup"><span data-stu-id="d3f1b-221">The **Output** window is displayed, and if all went well, you see a *succeeded* message.</span></span>  

    ![Criar a camada de acesso a dados-janelas de saída](create_the_data_access_layer/_static/image4.png)

<span data-ttu-id="d3f1b-223">Se você encontrar um erro, verifique novamente as etapas acima.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-223">If you run into an error, re-check the above steps.</span></span> <span data-ttu-id="d3f1b-224">As informações na janela de **saída** indicarão qual arquivo tem um problema e em que local o arquivo uma alteração é necessária.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-224">The information in the **Output** window will indicate which file has a problem and where in the file a change is required.</span></span> <span data-ttu-id="d3f1b-225">Essas informações permitirão que você determine qual parte das etapas acima precisa ser revisada e corrigida em seu projeto.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-225">This information will enable you to determine what part of the above steps need to be reviewed and fixed in your project.</span></span>

## <a name="summary"></a><span data-ttu-id="d3f1b-226">Resumo</span><span class="sxs-lookup"><span data-stu-id="d3f1b-226">Summary</span></span>

<span data-ttu-id="d3f1b-227">Neste tutorial da série, você criou o modelo de dados, bem como, adicionou o código que será usado para inicializar e propagar o banco de dado.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-227">In this tutorial of the series you have created the data model, as well as, added the code that will be used to initialize and seed the database.</span></span> <span data-ttu-id="d3f1b-228">Você também configurou o aplicativo para usar os modelos de dados quando o aplicativo é executado.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-228">You have also configured the application to use the data models when the application is run.</span></span>

<span data-ttu-id="d3f1b-229">No próximo tutorial, você atualizará a interface do usuário, adicionará a navegação e recuperará dados do banco.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-229">In the next tutorial, you'll update the UI, add navigation, and retrieve data from the database.</span></span> <span data-ttu-id="d3f1b-230">Isso fará com que o banco de dados seja criado automaticamente com base nas classes de entidade que você criou neste tutorial.</span><span class="sxs-lookup"><span data-stu-id="d3f1b-230">This will result in the database being automatically created based on the entity classes that you created in this tutorial.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="d3f1b-231">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="d3f1b-231">Additional Resources</span></span>

<span data-ttu-id="d3f1b-232">[Visão geral de Entity Framework](https://msdn.microsoft.com/library/bb399567.aspx) </span><span class="sxs-lookup"><span data-stu-id="d3f1b-232">[Entity Framework Overview](https://msdn.microsoft.com/library/bb399567.aspx) </span></span>  
<span data-ttu-id="d3f1b-233">[Guia para iniciantes do ADO.NET Entity Framework](https://msdn.microsoft.com/data/ee712907) </span><span class="sxs-lookup"><span data-stu-id="d3f1b-233">[Beginner's Guide to the ADO.NET Entity Framework](https://msdn.microsoft.com/data/ee712907) </span></span>  
<span data-ttu-id="d3f1b-234">[Desenvolvimento de Code First com Entity Framework](http://www.msteched.com/2010/Europe/DEV212) (vídeo)</span><span class="sxs-lookup"><span data-stu-id="d3f1b-234">[Code First Development with Entity Framework](http://www.msteched.com/2010/Europe/DEV212) (video)</span></span>   
<span data-ttu-id="d3f1b-235">[API fluente de relações de Code First](https://msdn.microsoft.com/data/hh134698) </span><span class="sxs-lookup"><span data-stu-id="d3f1b-235">[Code First Relationships Fluent API](https://msdn.microsoft.com/data/hh134698) </span></span>  
[<span data-ttu-id="d3f1b-236">Anotações de dados do primeiro código</span><span class="sxs-lookup"><span data-stu-id="d3f1b-236">Code First Data Annotations</span></span>](https://msdn.microsoft.com/data/gg193958)  
[<span data-ttu-id="d3f1b-237">Melhorias de produtividade para o Entity Framework</span><span class="sxs-lookup"><span data-stu-id="d3f1b-237">Productivity Improvements for the Entity Framework</span></span>](https://blogs.msdn.com/b/efdesign/archive/2010/06/21/productivity-improvements-for-the-entity-framework.aspx?wa=wsignin1.0)

> [!div class="step-by-step"]
> <span data-ttu-id="d3f1b-238">[Anterior](create-the-project.md)
> [Próximo](ui_and_navigation.md)</span><span class="sxs-lookup"><span data-stu-id="d3f1b-238">[Previous](create-the-project.md)
[Next](ui_and_navigation.md)</span></span>
