---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/configuring-a-website-that-uses-application-services-vb
title: Configurando um site que usa Serviços de Aplicativos (VB) | Microsoft Docs
author: rick-anderson
description: A versão 2,0 do ASP.NET introduziu uma série de serviços de aplicativos, que fazem parte do .NET Framework e servem como um conjunto de serviços de blocos de construção que yo...
ms.author: riande
ms.date: 04/23/2009
ms.assetid: 9c31a42f-d8bb-4c0f-9ccc-597d4f70ac42
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/configuring-a-website-that-uses-application-services-vb
msc.type: authoredcontent
ms.openlocfilehash: 19e7258b558372259c7554a36c6ad73ce572dfa8
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/28/2019
ms.locfileid: "74588739"
---
# <a name="configuring-a-website-that-uses-application-services-vb"></a><span data-ttu-id="e9f78-103">Configuração de um site que usa Serviços de Aplicativos (VB)</span><span class="sxs-lookup"><span data-stu-id="e9f78-103">Configuring a Website that Uses Application Services (VB)</span></span>

<span data-ttu-id="e9f78-104">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="e9f78-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="e9f78-105">[Baixar código](https://download.microsoft.com/download/E/6/F/E6FE3A1F-EE3A-4119-989A-33D1A9F6F6DD/ASPNET_Hosting_Tutorial_09_VB.zip) ou [baixar PDF](https://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial09_AppServicesConfig_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="e9f78-105">[Download Code](https://download.microsoft.com/download/E/6/F/E6FE3A1F-EE3A-4119-989A-33D1A9F6F6DD/ASPNET_Hosting_Tutorial_09_VB.zip) or [Download PDF](https://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial09_AppServicesConfig_vb.pdf)</span></span>

> <span data-ttu-id="e9f78-106">A versão 2,0 do ASP.NET introduziu uma série de serviços de aplicativos, que fazem parte do .NET Framework e servem como um conjunto de serviços de blocos de construção que você pode usar para adicionar funcionalidades avançadas ao seu aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="e9f78-106">ASP.NET version 2.0 introduced a series of application services, which are part of the .NET Framework and serve as a suite of building block services that you can use to add rich functionality to your web application.</span></span> <span data-ttu-id="e9f78-107">Este tutorial explora como configurar um site no ambiente de produção para usar os serviços de aplicativos e solucionar problemas comuns com o gerenciamento de contas de usuário e funções no ambiente de produção.</span><span class="sxs-lookup"><span data-stu-id="e9f78-107">This tutorial explores how to configure a website in the production environment to use application services and addresses common issues with managing user accounts and roles on the production environment.</span></span>

## <a name="introduction"></a><span data-ttu-id="e9f78-108">Introdução</span><span class="sxs-lookup"><span data-stu-id="e9f78-108">Introduction</span></span>

<span data-ttu-id="e9f78-109">A versão 2,0 do ASP.NET introduziu uma série de *serviços de aplicativos*, que fazem parte do .NET Framework e servem como um conjunto de serviços de blocos de construção que você pode usar para adicionar funcionalidades avançadas ao seu aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="e9f78-109">ASP.NET version 2.0 introduced a series of *application services*, which are part of the .NET Framework and serve as a suite of building block services that you can use to add rich functionality to your web application.</span></span> <span data-ttu-id="e9f78-110">Os serviços de aplicativo incluem:</span><span class="sxs-lookup"><span data-stu-id="e9f78-110">The application services include:</span></span>

- <span data-ttu-id="e9f78-111">**Associação** -uma API para criar e gerenciar contas de usuário.</span><span class="sxs-lookup"><span data-stu-id="e9f78-111">**Membership** - an API for creating and managing user accounts.</span></span>
- <span data-ttu-id="e9f78-112">**Funções** – uma API para categorizar usuários em grupos.</span><span class="sxs-lookup"><span data-stu-id="e9f78-112">**Roles** - an API for categorizing users into groups.</span></span>
- <span data-ttu-id="e9f78-113">**Perfil** -uma API para armazenar conteúdo personalizado específico do usuário.</span><span class="sxs-lookup"><span data-stu-id="e9f78-113">**Profile** - an API for storing custom, user-specific content.</span></span>
- <span data-ttu-id="e9f78-114">**Mapa do site** -uma API para definir uma estrutura lógica de um site na forma de uma hierarquia, que pode ser exibida por meio de controles de navegação, como menus e trilhas.</span><span class="sxs-lookup"><span data-stu-id="e9f78-114">**Site Map** - an API for defining a site s logical structure in the form of a hierarchy, which can then be displayed via navigation controls, such as menus and breadcrumbs.</span></span>
- <span data-ttu-id="e9f78-115">**Personalização** -uma API para manter as preferências de personalização, usadas com mais frequência com [*Web Parts*](https://msdn.microsoft.com/library/e0s9t4ck.aspx).</span><span class="sxs-lookup"><span data-stu-id="e9f78-115">**Personalization** - an API for maintaining customization preferences, most often used with [*WebParts*](https://msdn.microsoft.com/library/e0s9t4ck.aspx).</span></span>
- <span data-ttu-id="e9f78-116">**Monitoramento de integridade** -uma API para monitorar o desempenho, a segurança, os erros e outras métricas de integridade do sistema para um aplicativo Web em execução.</span><span class="sxs-lookup"><span data-stu-id="e9f78-116">**Health Monitoring** - an API for monitoring performance, security, errors, and other system health metrics for a running web application.</span></span>

<span data-ttu-id="e9f78-117">As APIs dos serviços de aplicativos não estão ligadas a uma implementação específica.</span><span class="sxs-lookup"><span data-stu-id="e9f78-117">The application services APIs are not tied to a specific implementation.</span></span> <span data-ttu-id="e9f78-118">Em vez disso, você instrui os serviços de aplicativo a usar um *provedor*específico e esse provedor implementa o serviço usando uma tecnologia específica.</span><span class="sxs-lookup"><span data-stu-id="e9f78-118">Instead, you instruct the application services to use a particular *provider*, and that provider implements the service using a particular technology.</span></span> <span data-ttu-id="e9f78-119">Os provedores usados com mais frequência para aplicativos Web baseados na Internet hospedados em uma empresa de hospedagem na Web são aqueles que usam uma implementação de banco de dados SQL Server.</span><span class="sxs-lookup"><span data-stu-id="e9f78-119">The most commonly used providers for Internet-based web applications hosted at a web hosting company are those providers that use a SQL Server database implementation.</span></span> <span data-ttu-id="e9f78-120">Por exemplo, o `SqlMembershipProvider` é um provedor para a API de associação que armazena informações de conta de usuário em um banco de dados Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="e9f78-120">For example, the `SqlMembershipProvider` is a provider for the Membership API that stores user account information in a Microsoft SQL Server database.</span></span>

<span data-ttu-id="e9f78-121">Usar os serviços de aplicativos e os provedores de SQL Server adiciona alguns desafios ao implantar o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e9f78-121">Using the application services and SQL Server providers adds some challenges when deploying the application.</span></span> <span data-ttu-id="e9f78-122">Para os iniciantes, os objetos de banco de dados dos serviços de aplicativos devem ser criados corretamente nos bancos de dados de desenvolvimento e de produção e inicializados adequadamente.</span><span class="sxs-lookup"><span data-stu-id="e9f78-122">For starters, the application services database objects must be properly created on both the development and production databases and appropriately initialized.</span></span> <span data-ttu-id="e9f78-123">Também há parâmetros de configuração importantes que precisam ser feitos.</span><span class="sxs-lookup"><span data-stu-id="e9f78-123">There are also important configuration settings that need to be made.</span></span>

> [!NOTE]
> <span data-ttu-id="e9f78-124">As APIs de serviços de aplicativos foram projetadas usando o [*modelo de provedor*](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx), um padrão de design que permite que os detalhes de implementação de uma API sejam fornecidos em tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="e9f78-124">The application services APIs were designed using the [*provider model*](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx), a design pattern that allows for an API s implementation details to be provided at runtime.</span></span> <span data-ttu-id="e9f78-125">O .NET Framework é fornecido com vários provedores de serviço de aplicativo que podem ser usados, como o `SqlMembershipProvider` e `SqlRoleProvider`, que são provedores para as APIs de associação e funções que usam uma implementação de banco de dados SQL Server.</span><span class="sxs-lookup"><span data-stu-id="e9f78-125">The .NET Framework ships with a number of application service providers that can be used, such as the `SqlMembershipProvider` and `SqlRoleProvider`, which are providers for the Membership and Roles APIs that use a SQL Server database implementation.</span></span> <span data-ttu-id="e9f78-126">Você também pode criar e conectar um provedor personalizado.</span><span class="sxs-lookup"><span data-stu-id="e9f78-126">You can also create and plug-in a custom provider.</span></span> <span data-ttu-id="e9f78-127">Na verdade, o livro Reviews Web já contém um provedor personalizado para a API do mapa do site (`ReviewSiteMapProvider`), que constrói o mapa do site a partir dos dados no `Genres` e `Books` tabelas no Database.</span><span class="sxs-lookup"><span data-stu-id="e9f78-127">In fact, the Book Reviews web application already contains a custom provider for the Site Map API (`ReviewSiteMapProvider`), which constructs the site map from the data in the `Genres` and `Books` tables in the database.</span></span>

<span data-ttu-id="e9f78-128">Este tutorial começa com uma análise de como estender o aplicativo Web de análises de livros para usar as APIs de associação e funções.</span><span class="sxs-lookup"><span data-stu-id="e9f78-128">This tutorial starts with a look at how I extended the Book Reviews web application to use the Membership and Roles APIs.</span></span> <span data-ttu-id="e9f78-129">Em seguida, ele percorre a implantação de um aplicativo Web que usa os serviços de aplicativos com uma implementação de banco de dados SQL Server e conclui resolvendo problemas comuns com o gerenciamento de contas de usuário e funções no ambiente de produção.</span><span class="sxs-lookup"><span data-stu-id="e9f78-129">It then walks through deploying a web application that uses application services with a SQL Server database implementation, and concludes by addressing common issues with managing user accounts and roles on the production environment.</span></span>

## <a name="updates-to-the-book-reviews-application"></a><span data-ttu-id="e9f78-130">Atualizações para o aplicativo de revisões de livros</span><span class="sxs-lookup"><span data-stu-id="e9f78-130">Updates to the Book Reviews Application</span></span>

<span data-ttu-id="e9f78-131">Nos últimos tutoriais, o livro revisa o aplicativo Web foi atualizado de um site estático para um aplicativo Web dinâmico, controlado por dados, completo com um conjunto de páginas de administração para gerenciar gêneros e revisões.</span><span class="sxs-lookup"><span data-stu-id="e9f78-131">Over the past couple tutorials the Book Reviews web application was updated from a static website to a dynamic, data-driven web application complete with a set of administration pages for managing genres and reviews.</span></span> <span data-ttu-id="e9f78-132">No entanto, essa seção de administração não está protegida no momento – qualquer usuário que conheça (ou adivinhe) a URL da página de administração pode Waltz e criar, editar ou excluir revisões em nosso site.</span><span class="sxs-lookup"><span data-stu-id="e9f78-132">However, this administration section is currently not protected - any user who knows (or guesses) the administration page URL can waltz in and create, edit, or delete reviews on our site.</span></span> <span data-ttu-id="e9f78-133">Uma maneira comum de proteger determinadas partes de um site é implementar contas de usuário e, em seguida, usar regras de autorização de URL para restringir o acesso a determinados usuários ou funções.</span><span class="sxs-lookup"><span data-stu-id="e9f78-133">A common way to protect certain portions of a website is to implement user accounts and then use URL authorization rules to restrict access to certain users or roles.</span></span> <span data-ttu-id="e9f78-134">O livro Reviews Web Application disponível para download com este tutorial dá suporte a contas de usuário e funções.</span><span class="sxs-lookup"><span data-stu-id="e9f78-134">The Book Reviews web application available for download with this tutorial supports user accounts and roles.</span></span> <span data-ttu-id="e9f78-135">Ele tem uma única função definida com o nome admin e somente os usuários nessa função podem acessar as páginas de administração.</span><span class="sxs-lookup"><span data-stu-id="e9f78-135">It has a single role defined named Admin and only users in this role can access the administration pages.</span></span>

> [!NOTE]
> <span data-ttu-id="e9f78-136">Eu criei três contas de usuário no livro Reviews Web Application: Scott, Jisun e Alice.</span><span class="sxs-lookup"><span data-stu-id="e9f78-136">I ve created three user accounts in the Book Reviews web application: Scott, Jisun, and Alice.</span></span> <span data-ttu-id="e9f78-137">Todos os três usuários têm a mesma senha: **senha!**</span><span class="sxs-lookup"><span data-stu-id="e9f78-137">All three users have the same password: **password!**</span></span> <span data-ttu-id="e9f78-138">Scott e Jisun estão na função de administrador, Alice não é.</span><span class="sxs-lookup"><span data-stu-id="e9f78-138">Scott and Jisun are in the Admin role, Alice is not.</span></span> <span data-ttu-id="e9f78-139">As páginas de não administração do site ainda são acessíveis a usuários anônimos.</span><span class="sxs-lookup"><span data-stu-id="e9f78-139">The site s non-administration pages are still accessible to anonymous users.</span></span> <span data-ttu-id="e9f78-140">Ou seja, você não precisa entrar para visitar o site, a menos que queira administrá-lo, caso em que você deve entrar como um usuário na função de administrador.</span><span class="sxs-lookup"><span data-stu-id="e9f78-140">That is, you do not need to sign in to visit the site, unless you want to administer it, in which case you must sign in as a user in the Admin role.</span></span>

<span data-ttu-id="e9f78-141">A página mestra de aplicativos de revisões de registros foi atualizada para incluir uma interface de usuário diferente para usuários autenticados e anônimos.</span><span class="sxs-lookup"><span data-stu-id="e9f78-141">The Book Reviews application s master page has been updated to include a different user interface for authenticated and anonymous users.</span></span> <span data-ttu-id="e9f78-142">Se um usuário anônimo visitar o site, ele verá um link de logon no canto superior direito.</span><span class="sxs-lookup"><span data-stu-id="e9f78-142">If an anonymous user visits the site she sees a Login link in the upper right corner.</span></span> <span data-ttu-id="e9f78-143">Um usuário autenticado vê a mensagem "bem-vindo de volta, *nome de usuário*!"</span><span class="sxs-lookup"><span data-stu-id="e9f78-143">An authenticated user sees the message, "Welcome back, *username*!"</span></span> <span data-ttu-id="e9f78-144">e um link para fazer logoff. Há também uma página de logon (`~/Login.aspx`), que contém um controle de logon na Web que fornece a interface do usuário e a lógica para autenticar um visitante.</span><span class="sxs-lookup"><span data-stu-id="e9f78-144">and a link to log out. There s also a login page (`~/Login.aspx`), which contains a Login Web control that provides the user interface and logic for authenticating a visitor.</span></span> <span data-ttu-id="e9f78-145">Somente os administradores podem criar novas contas.</span><span class="sxs-lookup"><span data-stu-id="e9f78-145">Only administrators can create new accounts.</span></span> <span data-ttu-id="e9f78-146">(Há páginas para criar e gerenciar contas de usuário na pasta `~/Admin`.)</span><span class="sxs-lookup"><span data-stu-id="e9f78-146">(There are pages for creating and managing user accounts in the `~/Admin` folder.)</span></span>

### <a name="configuring-the-membership-and-roles-apis"></a><span data-ttu-id="e9f78-147">Configurando as APIs de associação e funções</span><span class="sxs-lookup"><span data-stu-id="e9f78-147">Configuring the Membership and Roles APIs</span></span>

<span data-ttu-id="e9f78-148">O livro Reviews Web Application usa as APIs Membership e roles para dar suporte a contas de usuário e agrupar esses usuários em funções (ou seja, a função de administrador).</span><span class="sxs-lookup"><span data-stu-id="e9f78-148">The Book Reviews web application uses the Membership and Roles APIs to support user accounts and to group those users into roles (namely, the Admin role).</span></span> <span data-ttu-id="e9f78-149">As classes de provedor `SqlMembershipProvider` e `SqlRoleProvider` são usadas porque queremos armazenar informações de conta e função em um banco de dados SQL Server.</span><span class="sxs-lookup"><span data-stu-id="e9f78-149">The `SqlMembershipProvider` and `SqlRoleProvider` provider classes are used because we want to store account and role information in a SQL Server database.</span></span>

> [!NOTE]
> <span data-ttu-id="e9f78-150">Este tutorial não pretende ser um exame detalhado na configuração de um aplicativo Web para dar suporte às APIs de associação e funções.</span><span class="sxs-lookup"><span data-stu-id="e9f78-150">This tutorial is not intended to be a detailed examination at configuring a web application to support the Membership and Roles APIs.</span></span> <span data-ttu-id="e9f78-151">Para obter uma visão completa dessas APIs e as etapas que você precisa seguir para configurar um site para usá-las, leia meus [*tutoriais de segurança do site*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span><span class="sxs-lookup"><span data-stu-id="e9f78-151">For a thorough look at these APIs and the steps you need to take to configure a website to use them, please read my [*Website Security Tutorials*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span>

<span data-ttu-id="e9f78-152">Para usar os serviços de aplicativos com um banco de dados SQL Server, você deve primeiro adicionar os objetos de banco de dados usados por esses provedores ao banco de dados onde você deseja que as informações de conta e função de usuário sejam armazenadas.</span><span class="sxs-lookup"><span data-stu-id="e9f78-152">To use the application services with a SQL Server database you must first add the database objects used by these providers to the database where you want the user account and role information stored.</span></span> <span data-ttu-id="e9f78-153">Esses objetos de banco de dados de requisito incluem uma variedade de tabelas, exibições e procedimentos armazenados.</span><span class="sxs-lookup"><span data-stu-id="e9f78-153">These requisite database objects include a variety of tables, views, and stored procedures.</span></span> <span data-ttu-id="e9f78-154">A menos que especificado de outra forma, as classes de provedor `SqlMembershipProvider` e `SqlRoleProvider` usam um banco de dados SQL Server Express Edition chamado `ASPNETDB` localizado na pasta Application s `App_Data`; Se esse banco de dados não existir, ele será criado automaticamente com os objetos de banco de dados necessários por esses provedores em tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="e9f78-154">Unless specified otherwise, the `SqlMembershipProvider` and `SqlRoleProvider` provider classes use a SQL Server Express Edition database named `ASPNETDB` located in the application s `App_Data` folder; if such a database does not exist, it is automatically created with the necessary database objects by these providers at runtime.</span></span>

<span data-ttu-id="e9f78-155">É possível, e geralmente ideal, criar os objetos de banco de dados dos serviços de aplicativo no mesmo banco de dados em que os aplicativos específicos do aplicativo do site são armazenados.</span><span class="sxs-lookup"><span data-stu-id="e9f78-155">It is possible, and usually ideal, to create the application services database objects in the same database where the website s application-specific data is stored.</span></span> <span data-ttu-id="e9f78-156">O .NET Framework é fornecido com uma ferramenta chamada `aspnet_regsql.exe` que instala os objetos de banco de dados em um banco de dados especificado.</span><span class="sxs-lookup"><span data-stu-id="e9f78-156">The .NET Framework ships with a tool named `aspnet_regsql.exe` that installs the database objects on a specified database.</span></span> <span data-ttu-id="e9f78-157">Em frente, usei essa ferramenta para adicionar esses objetos ao banco de dados `Reviews.mdf` na pasta `App_Data` (o banco de dados de desenvolvimento).</span><span class="sxs-lookup"><span data-stu-id="e9f78-157">I have gone ahead and used this tool to add these objects to the `Reviews.mdf` database in the `App_Data` folder (the development database).</span></span> <span data-ttu-id="e9f78-158">Veremos como usar essa ferramenta posteriormente neste tutorial quando adicionamos esses objetos ao banco de dados de produção.</span><span class="sxs-lookup"><span data-stu-id="e9f78-158">We'll see how to use this tool later in this tutorial when we add these objects to the production database.</span></span>

<span data-ttu-id="e9f78-159">Se você adicionar objetos de banco de dados de serviços de aplicativos a um banco de dados que não seja `ASPNETDB`, precisará personalizar as configurações de classes de provedor de `SqlMembershipProvider` e `SqlRoleProvider` para que elas usem o banco de dados apropriado.</span><span class="sxs-lookup"><span data-stu-id="e9f78-159">If you add the application services database objects to a database other than `ASPNETDB` you will need to customize the `SqlMembershipProvider` and `SqlRoleProvider` provider classes configurations so that they use the appropriate database.</span></span> <span data-ttu-id="e9f78-160">Para personalizar o provedor de associação, adicione um [*elemento de&gt; de associação de&lt;* ](https://msdn.microsoft.com/library/1b9hw62f.aspx) na seção `<system.web>` no `Web.config`; Use o [*elemento&lt;rolemanager&gt;* ](https://msdn.microsoft.com/library/ms164660.aspx) para configurar o provedor de funções.</span><span class="sxs-lookup"><span data-stu-id="e9f78-160">To customize the Membership provider add a [*&lt;membership&gt; element*](https://msdn.microsoft.com/library/1b9hw62f.aspx) within the `<system.web>` section in `Web.config`; use the [*&lt;roleManager&gt; element*](https://msdn.microsoft.com/library/ms164660.aspx) to configure the Roles provider.</span></span> <span data-ttu-id="e9f78-161">O trecho a seguir é obtido do livro Reviews Application s `Web.config` e mostra as configurações de configuração para as APIs Membership e Roles.</span><span class="sxs-lookup"><span data-stu-id="e9f78-161">The following snippet is taken from the Book Reviews application s `Web.config` and shows the configure settings for the Membership and Roles APIs.</span></span> <span data-ttu-id="e9f78-162">Observe que ambos registram um novo provedor-`ReviewMembership` e `ReviewRole`-que usam os provedores `SqlMembershipProvider` e `SqlRoleProvider`, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="e9f78-162">Note that both register a new provider - `ReviewMembership` and `ReviewRole` - that use the `SqlMembershipProvider` and `SqlRoleProvider` providers, respectively.</span></span>

[!code-xml[Main](configuring-a-website-that-uses-application-services-vb/samples/sample1.xml)]

<span data-ttu-id="e9f78-163">O elemento `Web.config` `<authentication>` do arquivo também foi configurado para oferecer suporte à autenticação baseada em formulários.</span><span class="sxs-lookup"><span data-stu-id="e9f78-163">The `Web.config` file s `<authentication>` element has also been configured to support forms-based authentication.</span></span>

[!code-xml[Main](configuring-a-website-that-uses-application-services-vb/samples/sample2.xml)]

### <a name="limiting-access-to-the-administration-pages"></a><span data-ttu-id="e9f78-164">Limitando o acesso às páginas de administração</span><span class="sxs-lookup"><span data-stu-id="e9f78-164">Limiting Access to the Administration Pages</span></span>

<span data-ttu-id="e9f78-165">O ASP.NET facilita a concessão ou a negação de acesso a um determinado arquivo ou pasta pelo usuário ou por função por meio de seu recurso de *autorização de URL* .</span><span class="sxs-lookup"><span data-stu-id="e9f78-165">ASP.NET makes it easy to grant or deny access to a particular file or folder by user or by role via its *URL authorization* feature.</span></span> <span data-ttu-id="e9f78-166">(Discutimos brevemente a autorização de URL nas *principais diferenças entre o IIS e o tutorial de ASP.NET Development Server* e mostramos como o IIS e o ASP.NET Development Server aplicam regras de autorização de URL de forma diferente para conteúdo estático versus dinâmico.) Como queremos proibir o acesso à pasta `~/Admin`, exceto para os usuários na função admin, precisamos adicionar regras de autorização de URL a essa pasta.</span><span class="sxs-lookup"><span data-stu-id="e9f78-166">(We briefly discussed URL authorization in the *Core Differences Between IIS and the ASP.NET Development Server* tutorial and showed how IIS and the ASP.NET Development Server apply URL authorization rules differently for static versus dynamic content.) Because we want to prohibit access to the `~/Admin` folder except for those users in the Admin role, we need to add URL authorization rules to this folder.</span></span> <span data-ttu-id="e9f78-167">Especificamente, as regras de autorização de URL precisam permitir usuários na função de administrador e negar todos os outros usuários.</span><span class="sxs-lookup"><span data-stu-id="e9f78-167">Specifically, the URL authorization rules need to allow users in the Admin role and deny all other users.</span></span> <span data-ttu-id="e9f78-168">Isso é feito adicionando um arquivo de `Web.config` à pasta `~/Admin` com o seguinte conteúdo:</span><span class="sxs-lookup"><span data-stu-id="e9f78-168">This is accomplished by adding a `Web.config` file to the `~/Admin` folder with the following contents:</span></span>

[!code-xml[Main](configuring-a-website-that-uses-application-services-vb/samples/sample3.xml)]

<span data-ttu-id="e9f78-169">Para obter mais informações sobre o recurso de autorização de URL do ASP.NET e como usá-lo para soletrar as regras de autorização para usuários e funções, leia os tutoriais de autorização baseada em [*função*](../../older-versions-security/roles/role-based-authorization-vb.md) e [*autorização baseada em usuário*](../../older-versions-security/membership/user-based-authorization-vb.md) nos [*tutoriais de segurança*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)do meu site.</span><span class="sxs-lookup"><span data-stu-id="e9f78-169">For more information on ASP.NET s URL authorization feature and how to use it to spell out authorization rules for users and for roles, be sure to read the [*User-Based Authorization*](../../older-versions-security/membership/user-based-authorization-vb.md) and [*Role-Based Authorization*](../../older-versions-security/roles/role-based-authorization-vb.md) tutorials from my [*Website Security Tutorials*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span>

## <a name="deploying-a-web-application-that-uses-application-services"></a><span data-ttu-id="e9f78-170">Implantando um aplicativo Web que usa Serviços de Aplicativos</span><span class="sxs-lookup"><span data-stu-id="e9f78-170">Deploying a Web Application That Uses Application Services</span></span>

<span data-ttu-id="e9f78-171">Ao implantar um site que usa serviços de aplicativos e um provedor que armazena as informações de serviços de aplicativos em um banco de dados, é imperativo que os objetos de banco de dados necessários para os serviços de aplicativos sejam criados no banco de dados de produção.</span><span class="sxs-lookup"><span data-stu-id="e9f78-171">When deploying a website that uses application services and a provider that stores the application services information in a database, it is imperative that the database objects needed by the application services be created on the production database.</span></span> <span data-ttu-id="e9f78-172">Inicialmente, o banco de dados de produção não contém esses objetos, portanto, quando o aplicativo é implantado pela primeira vez (ou quando é implantado pela primeira vez depois que os serviços de aplicativo foram adicionados), você deve executar etapas adicionais para obter esses objetos de banco de dados necessários no banco de dados de produção.</span><span class="sxs-lookup"><span data-stu-id="e9f78-172">Initially the production database does not contain these objects, so when the application is first deployed (or when it is deployed for the first time after application services have been added), you must take extra steps to get these requisite database objects on the production database.</span></span>

<span data-ttu-id="e9f78-173">Outro desafio pode surgir ao implantar um site que usa serviços de aplicativos se você pretende replicar as contas de usuário criadas no ambiente de desenvolvimento para o ambiente de produção.</span><span class="sxs-lookup"><span data-stu-id="e9f78-173">Another challenge can arise when deploying a website that uses application services if you intend to replicate the user accounts created in the development environment to the production environment.</span></span> <span data-ttu-id="e9f78-174">Dependendo da configuração da associação e das funções, é possível que, mesmo que você copie com êxito as contas de usuário criadas no ambiente de desenvolvimento para o banco de dados de produção, esses usuários não poderão entrar no aplicativo Web em produção.</span><span class="sxs-lookup"><span data-stu-id="e9f78-174">Depending on the Membership and Roles configuration, it is possible that even if you successfully copy the user accounts that were created in the development environment to the production database, these users cannot sign into the web application in production.</span></span> <span data-ttu-id="e9f78-175">Vamos examinar a causa desse problema e discutir como evitar que ele aconteça.</span><span class="sxs-lookup"><span data-stu-id="e9f78-175">We'll look at the cause of this issue and discuss how to prevent it from happening.</span></span>

<span data-ttu-id="e9f78-176">O ASP.NET é fornecido com uma ótima [*ferramenta de administração de site (WSAT)* ](https://msdn.microsoft.com/library/yy40ytx0.aspx) que pode ser iniciada no Visual Studio e permite que a conta de usuário, as funções e as regras de autorização sejam gerenciadas por meio de uma interface baseada na Web.</span><span class="sxs-lookup"><span data-stu-id="e9f78-176">ASP.NET ships with a nice [*Web Site Administration Tool (WSAT)*](https://msdn.microsoft.com/library/yy40ytx0.aspx) that can be launched from Visual Studio and allows the user account, roles, and authorization rules to be managed through a web-based interface.</span></span> <span data-ttu-id="e9f78-177">Infelizmente, o WSAT só funciona para sites locais, o que significa que ele não pode ser usado para gerenciar remotamente contas de usuário, funções e regras de autorização para o aplicativo Web no ambiente de produção.</span><span class="sxs-lookup"><span data-stu-id="e9f78-177">Unfortunately, the WSAT only works for local websites, meaning that it cannot be used to remotely manage user accounts, roles, and authorization rules for the web application in the production environment.</span></span> <span data-ttu-id="e9f78-178">Veremos diferentes maneiras de implementar o comportamento do tipo WSAT do seu site de produção.</span><span class="sxs-lookup"><span data-stu-id="e9f78-178">We'll look at different ways to implement WSAT-like behavior from your production website.</span></span>

### <a name="adding-the-database-objects-using-aspnet_regsqlexe"></a><span data-ttu-id="e9f78-179">Adicionando os objetos de banco de dados usando ASPNET\_RegSql. exe</span><span class="sxs-lookup"><span data-stu-id="e9f78-179">Adding the Database Objects Using aspnet\_regsql.exe</span></span>

<span data-ttu-id="e9f78-180">O tutorial *implantando um banco* de dados mostrou como copiar as tabelas e os dados do banco de dado de desenvolvimento para o banco de dados de produção, e essas técnicas certamente podem ser usadas para copiar os objetos de banco de dados de serviços de aplicativo para o banco de dados de produção.</span><span class="sxs-lookup"><span data-stu-id="e9f78-180">The *Deploying a Database* tutorial showed how to copy the tables and data from the development database to the production database, and these techniques can certainly be used to copy the application services database objects to the production database.</span></span> <span data-ttu-id="e9f78-181">Outra opção é a ferramenta `aspnet_regsql.exe`, que adiciona ou remove os objetos de banco de dados dos serviços de aplicativo de um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="e9f78-181">Another option is the `aspnet_regsql.exe` tool, which adds or removes the application services database objects from a database.</span></span>

> [!NOTE]
> <span data-ttu-id="e9f78-182">A ferramenta de `aspnet_regsql.exe` cria os objetos de banco de dados em um banco de dados especificado.</span><span class="sxs-lookup"><span data-stu-id="e9f78-182">The `aspnet_regsql.exe` tool creates the database objects on a specified database.</span></span> <span data-ttu-id="e9f78-183">Ele não migra dados nesses objetos de banco de dado do banco de dados de desenvolvimento para o banco de dados de produção.</span><span class="sxs-lookup"><span data-stu-id="e9f78-183">It does not migrate data in those database objects from the development database to the production database.</span></span> <span data-ttu-id="e9f78-184">Se você quer copiar a conta de usuário e as informações de função no banco de dados de desenvolvimento para o banco de dados de produção, use as técnicas abordadas no tutorial *implantando um banco de dados* .</span><span class="sxs-lookup"><span data-stu-id="e9f78-184">If you mean to copy the user account and role information in the development database to the production database use the techniques covered in the *Deploying a Database* tutorial.</span></span>

<span data-ttu-id="e9f78-185">Vamos ver como adicionar os objetos de banco de dados ao banco de dados de produção usando a ferramenta `aspnet_regsql.exe`.</span><span class="sxs-lookup"><span data-stu-id="e9f78-185">Let s look at how to add the database objects to the production database using the `aspnet_regsql.exe` tool.</span></span> <span data-ttu-id="e9f78-186">Comece abrindo o Windows Explorer e navegando até o diretório .NET Framework versão 2,0 no seu computador,% WINDIR% \ Microsoft. NET\Framework\v2.0.50727.</span><span class="sxs-lookup"><span data-stu-id="e9f78-186">Start by opening Windows Explorer and navigating to the .NET Framework version 2.0 directory on your computer, %WINDIR%\ Microsoft.NET\Framework\v2.0.50727.</span></span> <span data-ttu-id="e9f78-187">Lá, você deve encontrar a ferramenta `aspnet_regsql.exe`.</span><span class="sxs-lookup"><span data-stu-id="e9f78-187">There you should find the `aspnet_regsql.exe` tool.</span></span> <span data-ttu-id="e9f78-188">Essa ferramenta pode ser usada na linha de comando, mas também inclui uma interface gráfica do usuário; Clique duas vezes no arquivo `aspnet_regsql.exe` para iniciar seu componente gráfico.</span><span class="sxs-lookup"><span data-stu-id="e9f78-188">This tool can be used from the command-line, but it also includes a graphical user interface; double-click the `aspnet_regsql.exe` file to launch its graphical component.</span></span>

<span data-ttu-id="e9f78-189">A ferramenta é iniciada exibindo uma tela inicial explicando sua finalidade.</span><span class="sxs-lookup"><span data-stu-id="e9f78-189">The tool starts by displaying a splash screen explaining its purpose.</span></span> <span data-ttu-id="e9f78-190">Clique em avançar para ir para a tela "selecionar uma opção de instalação", que é mostrada na Figura 1.</span><span class="sxs-lookup"><span data-stu-id="e9f78-190">Click Next to advance to the "Select a Setup Option" screen, which is shown in Figure 1.</span></span> <span data-ttu-id="e9f78-191">A partir daqui, você pode optar por adicionar os objetos de banco de dados dos serviços de aplicativo ou removê-los de um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="e9f78-191">From here you can choose to add the application services database objects or remove them from a database.</span></span> <span data-ttu-id="e9f78-192">Como queremos adicionar esses objetos ao banco de dados de produção, selecione a opção "configurar SQL Server para serviços de aplicativos" e clique em Avançar.</span><span class="sxs-lookup"><span data-stu-id="e9f78-192">Because we want to add these objects to the production database, select the "Configure SQL Server for application services" option and click Next.</span></span>

<span data-ttu-id="e9f78-193">[![optar por configurar SQL Server para Serviços de Aplicativos](configuring-a-website-that-uses-application-services-vb/_static/image2.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image1.jpg)</span><span class="sxs-lookup"><span data-stu-id="e9f78-193">[![Choose to Configure SQL Server for Application Services](configuring-a-website-that-uses-application-services-vb/_static/image2.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image1.jpg)</span></span>

<span data-ttu-id="e9f78-194">**Figura 1**: optar por configurar SQL Server para serviços de aplicativos ([clique para exibir a imagem em tamanho normal](configuring-a-website-that-uses-application-services-vb/_static/image3.jpg))</span><span class="sxs-lookup"><span data-stu-id="e9f78-194">**Figure 1**: Choose to Configure SQL Server for Application Services ([Click to view full-size image](configuring-a-website-that-uses-application-services-vb/_static/image3.jpg))</span></span>

<span data-ttu-id="e9f78-195">Na tela "selecionar o servidor e o banco de dados" solicita informações para se conectar ao banco de dados.</span><span class="sxs-lookup"><span data-stu-id="e9f78-195">In "Select the Server and Database" screen prompts for information to connect to the database.</span></span> <span data-ttu-id="e9f78-196">Insira o servidor de banco de dados, as credenciais de segurança e o nome do banco de dados fornecidos a você pela empresa de hospedagem Web e clique em Avançar.</span><span class="sxs-lookup"><span data-stu-id="e9f78-196">Enter the database server, the security credentials, and the database name supplied to you by your web hosting company and click Next.</span></span>

> [!NOTE]
> <span data-ttu-id="e9f78-197">Depois de inserir o servidor de banco de dados e as credenciais, você pode receber um erro ao expandir a lista suspensa banco de dados.</span><span class="sxs-lookup"><span data-stu-id="e9f78-197">After entering your database server and credentials you may get an error when expanding the database drop-down list.</span></span> <span data-ttu-id="e9f78-198">A ferramenta de `aspnet_regsql.exe` consulta a tabela do sistema `sysdatabases` para recuperar uma lista de bancos de dados no servidor, mas algumas empresas de hospedagem da Web bloqueiam seus servidores de banco de dados para que essas informações não estejam disponíveis publicamente.</span><span class="sxs-lookup"><span data-stu-id="e9f78-198">The `aspnet_regsql.exe` tool queries the `sysdatabases` system table to retrieve a list of databases on the server, but some web hosting companies lock down their database servers so that this information is not publicly available.</span></span> <span data-ttu-id="e9f78-199">Se você receber esse erro, poderá digitar o nome do banco de dados diretamente na lista suspensa.</span><span class="sxs-lookup"><span data-stu-id="e9f78-199">If you get this error you can type the database name directly into the drop-down list.</span></span>

<span data-ttu-id="e9f78-200">[![fornecer a ferramenta com as informações de conexão de seu banco de dados](configuring-a-website-that-uses-application-services-vb/_static/image5.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image4.jpg)</span><span class="sxs-lookup"><span data-stu-id="e9f78-200">[![Supply the Tool With Your Database s Connection Information](configuring-a-website-that-uses-application-services-vb/_static/image5.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image4.jpg)</span></span>

<span data-ttu-id="e9f78-201">**Figura 2**: fornecer a ferramenta com as informações de conexão do banco de dados ([clique para exibir a imagem em tamanho normal](configuring-a-website-that-uses-application-services-vb/_static/image6.jpg))</span><span class="sxs-lookup"><span data-stu-id="e9f78-201">**Figure 2**: Supply the Tool With Your Database s Connection Information ([Click to view full-size image](configuring-a-website-that-uses-application-services-vb/_static/image6.jpg))</span></span>

<span data-ttu-id="e9f78-202">A tela subsequente resume as ações que estão prestes a ocorrer, ou seja, os objetos de banco de dados dos serviços de aplicativo serão adicionados ao banco de dados especificado.</span><span class="sxs-lookup"><span data-stu-id="e9f78-202">The subsequent screen summarizes the actions that are about to take place, namely that the application services database objects are going to be added to the specified database.</span></span> <span data-ttu-id="e9f78-203">Clique em avançar para concluir esta ação.</span><span class="sxs-lookup"><span data-stu-id="e9f78-203">Click Next to complete this action.</span></span> <span data-ttu-id="e9f78-204">Após alguns instantes, a tela final será exibida, observando que os objetos de banco de dados foram adicionados (veja a Figura 3).</span><span class="sxs-lookup"><span data-stu-id="e9f78-204">After a few moments, the final screen is displayed, noting that the database objects have been added (see Figure 3).</span></span>

<span data-ttu-id="e9f78-205">[![êxito! Os objetos de banco de dados Serviços de Aplicativos foram adicionados ao banco de dados de produção](configuring-a-website-that-uses-application-services-vb/_static/image8.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image7.jpg)</span><span class="sxs-lookup"><span data-stu-id="e9f78-205">[![Success! The Application Services Database Objects Were Added to the Production Database](configuring-a-website-that-uses-application-services-vb/_static/image8.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image7.jpg)</span></span>

<span data-ttu-id="e9f78-206">**Figura 3**: sucesso!</span><span class="sxs-lookup"><span data-stu-id="e9f78-206">**Figure 3**: Success!</span></span> <span data-ttu-id="e9f78-207">Os objetos de banco de dados Serviços de Aplicativos foram adicionados ao banco de dados de produção ([clique para exibir a imagem em tamanho normal](configuring-a-website-that-uses-application-services-vb/_static/image9.jpg))</span><span class="sxs-lookup"><span data-stu-id="e9f78-207">The Application Services Database Objects Were Added to the Production Database ([Click to view full-size image](configuring-a-website-that-uses-application-services-vb/_static/image9.jpg))</span></span>

<span data-ttu-id="e9f78-208">Para verificar se os objetos de banco de dados dos serviços de aplicativo foram adicionados com êxito ao banco de dados de produção, abra SQL Server Management Studio e conecte-se ao banco de dados de produção.</span><span class="sxs-lookup"><span data-stu-id="e9f78-208">To verify that the application services database objects were successfully added to the production database, open SQL Server Management Studio and connect to your production database.</span></span> <span data-ttu-id="e9f78-209">Como mostra a Figura 4, agora você deve ver as tabelas de banco de dados de serviços de aplicativo em seu banco de dados, `aspnet_Applications`, `aspnet_Membership`, `aspnet_Users`e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="e9f78-209">As Figure 4 shows, you should now see the application services database tables in your database, `aspnet_Applications`, `aspnet_Membership`, `aspnet_Users`, and so forth.</span></span>

<span data-ttu-id="e9f78-210">[![confirmar que os objetos de banco de dados foram adicionados ao banco de dados de produção](configuring-a-website-that-uses-application-services-vb/_static/image11.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image10.jpg)</span><span class="sxs-lookup"><span data-stu-id="e9f78-210">[![Confirm That the Database Objects Were Added to the Production Database](configuring-a-website-that-uses-application-services-vb/_static/image11.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image10.jpg)</span></span>

<span data-ttu-id="e9f78-211">**Figura 4**: confirmar que os objetos de banco de dados foram adicionados ao banco de dados de produção ([clique para exibir a imagem em tamanho normal](configuring-a-website-that-uses-application-services-vb/_static/image12.jpg))</span><span class="sxs-lookup"><span data-stu-id="e9f78-211">**Figure 4**: Confirm That the Database Objects Were Added to the Production Database ([Click to view full-size image](configuring-a-website-that-uses-application-services-vb/_static/image12.jpg))</span></span>

<span data-ttu-id="e9f78-212">Você só precisará usar a ferramenta `aspnet_regsql.exe` ao implantar seu aplicativo Web pela primeira vez ou pela primeira vez depois de começar a usar os serviços de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e9f78-212">You will only need to use the `aspnet_regsql.exe` tool when deploying your web application for the first time or for the first time after you have started using the application services.</span></span> <span data-ttu-id="e9f78-213">Depois que esses objetos de banco de dados estiverem no banco de dados de produção, eles não precisarão ser adicionados novamente ou modificados.</span><span class="sxs-lookup"><span data-stu-id="e9f78-213">Once these database objects are on the production database they won't need to be re-added or modified.</span></span>

### <a name="copying-user-accounts-from-development-to-production"></a><span data-ttu-id="e9f78-214">Copiando contas de usuário de desenvolvimento para produção</span><span class="sxs-lookup"><span data-stu-id="e9f78-214">Copying User Accounts from Development to Production</span></span>

<span data-ttu-id="e9f78-215">Ao usar as classes de provedor `SqlMembershipProvider` e `SqlRoleProvider` para armazenar as informações de serviços de aplicativos em um banco de dados SQL Server, a conta de usuário e as informações de função são armazenadas em uma variedade de tabelas de banco de dados, incluindo `aspnet_Users`, `aspnet_Membership`, `aspnet_Roles`e `aspnet_UsersInRoles`, entre outras.</span><span class="sxs-lookup"><span data-stu-id="e9f78-215">When using the `SqlMembershipProvider` and `SqlRoleProvider` provider classes to store the application services information in a SQL Server database, the user account and role information is stored in a variety of database tables, including `aspnet_Users`, `aspnet_Membership`, `aspnet_Roles`, and `aspnet_UsersInRoles`, among others.</span></span> <span data-ttu-id="e9f78-216">Se durante o desenvolvimento você criar contas de usuário no ambiente de desenvolvimento, poderá replicar essas contas de usuário em produção copiando os registros correspondentes das tabelas de banco de dados aplicáveis.</span><span class="sxs-lookup"><span data-stu-id="e9f78-216">If during development you create user accounts in the development environment you can replicate those user accounts in production by copying the corresponding records from the applicable database tables.</span></span> <span data-ttu-id="e9f78-217">Se você usou o assistente de publicação de banco de dados para implantar os objetos de banco de dados dos serviços de aplicativos, você também pode ter optado por copiar os registros, o que resultaria em que as contas de usuário criadas no desenvolvimento também estejam em produção.</span><span class="sxs-lookup"><span data-stu-id="e9f78-217">If you used the Database Publishing Wizard to deploy the application services database objects you may have also elected to copy the records, which would result in the user accounts created in development to also be on production.</span></span> <span data-ttu-id="e9f78-218">Mas, dependendo de suas definições de configuração, você pode achar que os usuários cujas contas foram criadas no desenvolvimento e copiados para produção não podem fazer logon no site de produção.</span><span class="sxs-lookup"><span data-stu-id="e9f78-218">But, depending on your configuration settings, you may find that those users whose accounts were created in development and copied to production are unable to login from the production website.</span></span> <span data-ttu-id="e9f78-219">O que dá?</span><span class="sxs-lookup"><span data-stu-id="e9f78-219">What gives?</span></span>

<span data-ttu-id="e9f78-220">As classes de provedor `SqlMembershipProvider` e `SqlRoleProvider` foram projetadas de modo que um único banco de dados possa servir como um armazenamento de usuários para vários aplicativos, em que cada aplicativo poderia, teoricamente, ter usuários com sobreposição de nomes de usuário e funções com o mesmo nome.</span><span class="sxs-lookup"><span data-stu-id="e9f78-220">The `SqlMembershipProvider` and `SqlRoleProvider` provider classes were designed such that a single database could serve as a user store for multiple applications, where each application could, in theory, have users with overlapping usernames and roles with the same name.</span></span> <span data-ttu-id="e9f78-221">Para permitir essa flexibilidade, o banco de dados mantém uma lista de aplicativos na tabela `aspnet_Applications` e cada usuário é associado a um desses aplicativos.</span><span class="sxs-lookup"><span data-stu-id="e9f78-221">To allow for this flexibility, the database maintains a list of applications in the `aspnet_Applications` table, and each user is associated with one of these applications.</span></span> <span data-ttu-id="e9f78-222">Especificamente, a tabela `aspnet_Users` tem uma coluna `ApplicationId` que vincula cada usuário a um registro na tabela `aspnet_Applications`.</span><span class="sxs-lookup"><span data-stu-id="e9f78-222">Specifically, the `aspnet_Users` table has an `ApplicationId` column that ties each user to a record in the `aspnet_Applications` table.</span></span>

<span data-ttu-id="e9f78-223">Além da coluna `ApplicationId`, a tabela `aspnet_Applications` também inclui uma coluna `ApplicationName`, que fornece um nome mais amigável para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e9f78-223">In addition to the `ApplicationId` column, the `aspnet_Applications` table also includes an `ApplicationName` column, which provides a more human-friendly name for the application.</span></span> <span data-ttu-id="e9f78-224">Quando um site tenta trabalhar com uma conta de usuário, como validar credenciais de um usuário na página de logon, ele deve informar à classe de `SqlMembershipProvider` com qual aplicativo trabalhar.</span><span class="sxs-lookup"><span data-stu-id="e9f78-224">When a website attempts to work with a user account, such as validating a user s credentials from the login page, it must tell the `SqlMembershipProvider` class what application to work with.</span></span> <span data-ttu-id="e9f78-225">Ele geralmente faz isso fornecendo o nome do aplicativo, e esse valor é proveniente da configuração do provedor em `Web.config`, especificamente por meio do atributo `applicationName`.</span><span class="sxs-lookup"><span data-stu-id="e9f78-225">It usually does this by supplying the application name, and the this value comes from the provider s configuration in `Web.config` - specifically via the `applicationName` attribute.</span></span>

<span data-ttu-id="e9f78-226">Mas o que acontece se o atributo `applicationName` não for especificado em `Web.config`?</span><span class="sxs-lookup"><span data-stu-id="e9f78-226">But what happens if the `applicationName` attribute is not specified in `Web.config`?</span></span> <span data-ttu-id="e9f78-227">Nesse caso, o sistema de associação usa o caminho raiz do aplicativo como o valor `applicationName`.</span><span class="sxs-lookup"><span data-stu-id="e9f78-227">In such a case the Membership system uses the application root path as the `applicationName` value.</span></span> <span data-ttu-id="e9f78-228">Se o atributo `applicationName` não for definido explicitamente em `Web.config`, então haverá a possibilidade de que o ambiente de desenvolvimento e o ambiente de produção usem uma raiz de aplicativo diferente e, portanto, serão associados a nomes de aplicativos diferentes nos serviços de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="e9f78-228">If the `applicationName` attribute is not explicitly set in `Web.config`, then, there is the possibility that the development environment and production environment use a different application root and therefore will be associated with different application names in the application services.</span></span> <span data-ttu-id="e9f78-229">Se tal incompatibilidade ocorrer, esses usuários criados no ambiente de desenvolvimento terão um valor `ApplicationId` que não corresponde ao valor de `ApplicationId` para o ambiente de produção.</span><span class="sxs-lookup"><span data-stu-id="e9f78-229">If such a mismatch occurs then those users created in the development environment will have an `ApplicationId` value that does not match with the `ApplicationId` value for the production environment.</span></span> <span data-ttu-id="e9f78-230">O resultado líquido é que esses usuários não poderão fazer logon.</span><span class="sxs-lookup"><span data-stu-id="e9f78-230">The net result is that those users won't be able to login.</span></span>

> [!NOTE]
> <span data-ttu-id="e9f78-231">Se você se encontrar nessa situação – com as contas de usuário copiadas para produção com um valor de `ApplicationId` incompatível, você poderia escrever uma consulta para atualizar esses valores de `ApplicationId` incorretos para o `ApplicationId` usado na produção.</span><span class="sxs-lookup"><span data-stu-id="e9f78-231">If you find yourself in this situation - with user accounts copied to production with a mismatched `ApplicationId` value - you could write a query to update these incorrect `ApplicationId` values to the `ApplicationId` used on production.</span></span> <span data-ttu-id="e9f78-232">Após a atualização, os usuários cujas contas foram criadas no ambiente de desenvolvimento agora poderão entrar no aplicativo Web em produção.</span><span class="sxs-lookup"><span data-stu-id="e9f78-232">Once updated, the users whose accounts were created on the development environment would now be able to sign into the web application on production.</span></span>

<span data-ttu-id="e9f78-233">A boa notícia é que há uma etapa simples que você pode tomar para garantir que os dois ambientes usem o mesmo `ApplicationId`-defina explicitamente o atributo `applicationName` no `Web.config` para todos os seus provedores de serviços de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="e9f78-233">The good news is that there is a simple step you can take to ensure that the two environments use the same `ApplicationId` - explicitly set the `applicationName` attribute in `Web.config` for all of your application services providers.</span></span> <span data-ttu-id="e9f78-234">Defini explicitamente o atributo `applicationName` como "BookReviews" nos elementos `<membership>` e `<roleManager>`, pois esse trecho de `Web.config` mostra.</span><span class="sxs-lookup"><span data-stu-id="e9f78-234">I explicitly set the `applicationName` attribute to "BookReviews" in the `<membership>` and `<roleManager>` elements as this snippet from `Web.config` shows.</span></span>

[!code-xml[Main](configuring-a-website-that-uses-application-services-vb/samples/sample4.xml)]

<span data-ttu-id="e9f78-235">Para obter mais discussões sobre como definir o atributo `applicationName` e a lógica por trás dele, consulte a postagem de blog de [*Scott Guthrie*](https://weblogs.asp.net/scottgu/) s, [*sempre defina a propriedade ApplicationName ao configurar a associação de ASP.net e outros provedores*](https://weblogs.asp.net/scottgu/443634).</span><span class="sxs-lookup"><span data-stu-id="e9f78-235">For more discussion on setting the `applicationName` attribute and the rationale behind it, refer to [*Scott Guthrie*](https://weblogs.asp.net/scottgu/) s blog post, [*Always set the applicationName property when configuring ASP.NET Membership and other Providers*](https://weblogs.asp.net/scottgu/443634).</span></span>

### <a name="managing-user-accounts-in-the-production-environment"></a><span data-ttu-id="e9f78-236">Gerenciando contas de usuário no ambiente de produção</span><span class="sxs-lookup"><span data-stu-id="e9f78-236">Managing User Accounts in the Production Environment</span></span>

<span data-ttu-id="e9f78-237">A ferramenta de administração de site da ASP.NET (WSAT) facilita a criação e o gerenciamento de contas de usuário, a definição e a aplicação de funções e a ortografia de regras de autorização baseadas em usuário e função.</span><span class="sxs-lookup"><span data-stu-id="e9f78-237">The ASP.NET Web Site Administration Tool (WSAT) makes it easy to create and manage user accounts, define and apply roles, and spell out user- and role-based authorization rules.</span></span> <span data-ttu-id="e9f78-238">Você pode iniciar o WSAT do Visual Studio acessando o Gerenciador de Soluções e clicando no ícone de configuração do ASP.NET ou acessando o site ou os menus do projeto e selecionando o item de menu de configuração do ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="e9f78-238">You can launch the WSAT from Visual Studio by going to the Solution Explorer and clicking the ASP.NET Configuration icon or by going to the Website or Project menus and selecting the ASP.NET Configuration menu item.</span></span> <span data-ttu-id="e9f78-239">Infelizmente, o WSAT só pode funcionar com sites locais.</span><span class="sxs-lookup"><span data-stu-id="e9f78-239">Unfortunately, the WSAT can only work with local websites.</span></span> <span data-ttu-id="e9f78-240">Portanto, você não pode usar o WSAT de sua estação de trabalho para gerenciar o site no ambiente de produção.</span><span class="sxs-lookup"><span data-stu-id="e9f78-240">Therefore, you cannot use the WSAT from your workstation to manage the website in the production environment.</span></span>

<span data-ttu-id="e9f78-241">A boa notícia é que toda a funcionalidade exposta fornecida pelo WSAT está disponível programaticamente por meio das APIs de associação e de funções; Além disso, muitas das telas WSAT usam os controles padrão relacionados ao logon do ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="e9f78-241">The good news is that all of the functionality exposed provided by the WSAT is available programmatically through the Membership and Roles APIs; furthermore, many of the WSAT screens use the standard ASP.NET Login-related controls.</span></span> <span data-ttu-id="e9f78-242">Em suma, você pode adicionar páginas do ASP.NET ao seu site que oferecem os recursos de gerenciamento necessários.</span><span class="sxs-lookup"><span data-stu-id="e9f78-242">In short, you can add ASP.NET pages to your website that offer the necessary management capabilities.</span></span>

<span data-ttu-id="e9f78-243">Lembre-se de que um tutorial anterior atualizou o aplicativo Web de revisões de livros para incluir uma pasta `~/Admin`, e essa pasta foi configurada para permitir somente usuários na função Administrador.</span><span class="sxs-lookup"><span data-stu-id="e9f78-243">Recall that an earlier tutorial updated the Book Reviews web application to include an `~/Admin` folder, and this folder has been configured to only allow users in the Admin role.</span></span> <span data-ttu-id="e9f78-244">Adicionei uma página à pasta chamada `CreateAccount.aspx` da qual um administrador pode criar uma nova conta de usuário.</span><span class="sxs-lookup"><span data-stu-id="e9f78-244">I added a page to that folder named `CreateAccount.aspx` from which an administrator can create a new user account.</span></span> <span data-ttu-id="e9f78-245">Esta página usa o controle CreateUserWizard para exibir a interface do usuário e a lógica de back-end para criar uma nova conta de usuário.</span><span class="sxs-lookup"><span data-stu-id="e9f78-245">This page uses the CreateUserWizard control to display the user interface and backend logic for creating a new user account.</span></span> <span data-ttu-id="e9f78-246">O que mais, eu personalizei o controle para incluir uma caixa de seleção que solicita se o novo usuário também deve ser adicionado à função de administrador (consulte a Figura 5).</span><span class="sxs-lookup"><span data-stu-id="e9f78-246">What s more, I customized the control to include a CheckBox that prompts whether the new user should also be added to the Admin role (see Figure 5).</span></span> <span data-ttu-id="e9f78-247">Com um pouco de trabalho, você pode criar um conjunto personalizado de páginas que implementa as tarefas relacionadas ao gerenciamento de usuários e funções que, de outra forma, seriam fornecidas pelo WSAT.</span><span class="sxs-lookup"><span data-stu-id="e9f78-247">With a little bit of work you can build a custom set of pages that implements the user and role management-related tasks that would otherwise be provided by the WSAT.</span></span>

> [!NOTE]
> <span data-ttu-id="e9f78-248">Para obter mais informações sobre como usar as APIs de associação e de funções juntamente com os controles da Web ASP.NET relacionados ao logon, leia meus [*tutoriais de segurança do site*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span><span class="sxs-lookup"><span data-stu-id="e9f78-248">For more information on using the Membership and Roles APIs along with the Login-related ASP.NET Web controls, be sure to read my [*Website Security Tutorials*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span> <span data-ttu-id="e9f78-249">Para obter mais informações sobre como personalizar o controle CreateUserWizard, consulte o artigo [*criando contas de usuário*](../../older-versions-security/membership/creating-user-accounts-vb.md) e [*armazenando tutoriais adicionais de informações de usuário*](../../older-versions-security/membership/storing-additional-user-information-vb.md) , ou confira [*Erich Peterson*](http://www.erichpeterson.com/) s, [*Personalizando o controle CreateUserWizard*](http://aspnet.4guysfromrolla.com/articles/070506-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="e9f78-249">For more on customizing the CreateUserWizard control refer to the [*Creating User Accounts*](../../older-versions-security/membership/creating-user-accounts-vb.md) and [*Storing Additional User Information*](../../older-versions-security/membership/storing-additional-user-information-vb.md) tutorials, or check out [*Erich Peterson*](http://www.erichpeterson.com/) s article, [*Customizing the CreateUserWizard Control*](http://aspnet.4guysfromrolla.com/articles/070506-1.aspx).</span></span>

<span data-ttu-id="e9f78-250">[![administradores podem criar novas contas de usuário](configuring-a-website-that-uses-application-services-vb/_static/image14.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image13.jpg)</span><span class="sxs-lookup"><span data-stu-id="e9f78-250">[![Administrators Can Create New User Accounts](configuring-a-website-that-uses-application-services-vb/_static/image14.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image13.jpg)</span></span>

<span data-ttu-id="e9f78-251">**Figura 5**: os administradores podem criar novas contas de usuário ([clique para exibir a imagem em tamanho normal](configuring-a-website-that-uses-application-services-vb/_static/image15.jpg))</span><span class="sxs-lookup"><span data-stu-id="e9f78-251">**Figure 5**: Administrators Can Create New User Accounts ([Click to view full-size image](configuring-a-website-that-uses-application-services-vb/_static/image15.jpg))</span></span>

<span data-ttu-id="e9f78-252">Se você precisar da funcionalidade completa do WSAT, confira a [*distribuição da sua própria ferramenta de administração de site*](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx), na qual o autor Dan Clem percorre o processo de criação de uma ferramenta personalizada de WSAT.</span><span class="sxs-lookup"><span data-stu-id="e9f78-252">If you need the full functionality of the WSAT check out [*Rolling Your Own Web Site Administration Tool*](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx), in which author Dan Clem walks through the process of building a custom WSAT-like tool.</span></span> <span data-ttu-id="e9f78-253">Dan compartilha seu código-fonte do aplicativo ( C#em) e fornece instruções passo a passo para adicioná-lo ao seu site hospedado.</span><span class="sxs-lookup"><span data-stu-id="e9f78-253">Dan shares his application s source code (in C#) and provides step-by-step instructions for adding it to your hosted website.</span></span>

## <a name="summary"></a><span data-ttu-id="e9f78-254">Resumo</span><span class="sxs-lookup"><span data-stu-id="e9f78-254">Summary</span></span>

<span data-ttu-id="e9f78-255">Ao implantar um aplicativo Web que usa a implementação de banco de dados dos serviços de aplicativo, você deve primeiro garantir que o banco de dados de produção tenha os objetos de banco de dados necessários.</span><span class="sxs-lookup"><span data-stu-id="e9f78-255">When deploying a web application that uses the application services database implementation you must first ensure that the production database has the requisite database objects.</span></span> <span data-ttu-id="e9f78-256">Esses objetos podem ser adicionados usando as técnicas discutidas no tutorial *implantando um banco de dados* ; Como alternativa, você pode usar a ferramenta `aspnet_regsql.exe`, como vimos neste tutorial.</span><span class="sxs-lookup"><span data-stu-id="e9f78-256">These objects can be added using the techniques discussed in the *Deploying a Database* tutorial; alternatively, you can use the `aspnet_regsql.exe` tool, as we saw in this tutorial.</span></span> <span data-ttu-id="e9f78-257">Outros desafios que abordamos no centro em relação à sincronização do nome do aplicativo usado nos ambientes de desenvolvimento e produção (que é importante se você quiser que os usuários e funções criados no ambiente de desenvolvimento sejam válidos na produção) e técnicas para gerenciamento de usuários e funções no ambiente de produção.</span><span class="sxs-lookup"><span data-stu-id="e9f78-257">Other challenges we touched on center around synchronizing the application name used in the development and production environments (which is important if you want users and roles created in the development environment to be valid on production) and techniques for managing the users and roles in the production environment.</span></span>

<span data-ttu-id="e9f78-258">Boa programação!</span><span class="sxs-lookup"><span data-stu-id="e9f78-258">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="e9f78-259">Leitura adicional</span><span class="sxs-lookup"><span data-stu-id="e9f78-259">Further Reading</span></span>

<span data-ttu-id="e9f78-260">Para obter mais informações sobre os tópicos discutidos neste tutorial, consulte os seguintes recursos:</span><span class="sxs-lookup"><span data-stu-id="e9f78-260">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="e9f78-261">*Ferramenta de registro de SQL Server ASP.NET (aspnet_regsql. exe)* </span><span class="sxs-lookup"><span data-stu-id="e9f78-261">*ASP.NET SQL Server Registration Tool (aspnet_regsql.exe)*</span></span>](https://msdn.microsoft.com/library/ms229862.aspx)
- [<span data-ttu-id="e9f78-262">*Criando o banco de dados Serviços de Aplicativos para SQL Server*</span><span class="sxs-lookup"><span data-stu-id="e9f78-262">*Creating the Application Services Database for SQL Server*</span></span>](https://msdn.microsoft.com/library/x28wfk74.aspx)
- [<span data-ttu-id="e9f78-263">*Criando o esquema de associação no SQL Server*</span><span class="sxs-lookup"><span data-stu-id="e9f78-263">*Creating the Membership Schema in SQL Server*</span></span>](../../older-versions-security/membership/creating-the-membership-schema-in-sql-server-vb.md)
- [<span data-ttu-id="e9f78-264">*Examinando associação, funções e perfil do ASP.NET s*</span><span class="sxs-lookup"><span data-stu-id="e9f78-264">*Examining ASP.NET s Membership, Roles, and Profile*</span></span>](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx)
- [<span data-ttu-id="e9f78-265">*Distribuindo sua própria ferramenta de administração de site*</span><span class="sxs-lookup"><span data-stu-id="e9f78-265">*Rolling Your Own Web Site Administration Tool*</span></span>](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)
- [<span data-ttu-id="e9f78-266">*Tutoriais de segurança do site*</span><span class="sxs-lookup"><span data-stu-id="e9f78-266">*Website Security Tutorials*</span></span>](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)
- [<span data-ttu-id="e9f78-267">*Visão geral da ferramenta de administração de site*</span><span class="sxs-lookup"><span data-stu-id="e9f78-267">*Web Site Administration Tool Overview*</span></span>](https://msdn.microsoft.com/library/yy40ytx0.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="e9f78-268">[Anterior](configuring-the-production-web-application-to-use-the-production-database-vb.md)
> [Próximo](strategies-for-database-development-and-deployment-vb.md)</span><span class="sxs-lookup"><span data-stu-id="e9f78-268">[Previous](configuring-the-production-web-application-to-use-the-production-database-vb.md)
[Next](strategies-for-database-development-and-deployment-vb.md)</span></span>
