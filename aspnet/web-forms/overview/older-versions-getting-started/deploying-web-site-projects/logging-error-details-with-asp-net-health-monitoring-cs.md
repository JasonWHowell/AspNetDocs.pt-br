---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/logging-error-details-with-asp-net-health-monitoring-cs
title: Registrando detalhes do erro com o monitoramentoC#de integridade do ASP.net () | Microsoft Docs
author: rick-anderson
description: O sistema de monitoramento de integridade da Microsoft fornece uma maneira fácil e personalizável de registrar vários eventos da Web, incluindo exceções sem tratamento. Este tutorial percorre aos...
ms.author: riande
ms.date: 06/09/2009
ms.assetid: b1abb452-642a-4ff3-8504-37b85590ff79
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/logging-error-details-with-asp-net-health-monitoring-cs
msc.type: authoredcontent
ms.openlocfilehash: e52ed94f78d053701771690fce432d5a1d465b62
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/28/2019
ms.locfileid: "74637299"
---
# <a name="logging-error-details-with-aspnet-health-monitoring-c"></a><span data-ttu-id="eccd9-104">Registro em log de detalhes de erros com o monitoramento de integridade do ASP.NET (C#)</span><span class="sxs-lookup"><span data-stu-id="eccd9-104">Logging Error Details with ASP.NET Health Monitoring (C#)</span></span>

<span data-ttu-id="eccd9-105">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="eccd9-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="eccd9-106">[Baixar código](https://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_13_CS.zip) ou [baixar PDF](https://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial13_HealthMonitoring_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="eccd9-106">[Download Code](https://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_13_CS.zip) or [Download PDF](https://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial13_HealthMonitoring_cs.pdf)</span></span>

> <span data-ttu-id="eccd9-107">O sistema de monitoramento de integridade da Microsoft fornece uma maneira fácil e personalizável de registrar vários eventos da Web, incluindo exceções sem tratamento.</span><span class="sxs-lookup"><span data-stu-id="eccd9-107">Microsoft's health monitoring system provides an easy and customizable way to log various web events, including unhandled exceptions.</span></span> <span data-ttu-id="eccd9-108">Este tutorial orienta a configuração do sistema de monitoramento de integridade para registrar exceções sem tratamento em um banco de dados e notificar os desenvolvedores por meio de uma mensagem de email.</span><span class="sxs-lookup"><span data-stu-id="eccd9-108">This tutorial walks through setting up the health monitoring system to log unhandled exceptions to a database and to notify developers via an email message.</span></span>

## <a name="introduction"></a><span data-ttu-id="eccd9-109">Introdução</span><span class="sxs-lookup"><span data-stu-id="eccd9-109">Introduction</span></span>

<span data-ttu-id="eccd9-110">O registro em log é uma ferramenta útil para monitorar a integridade de um aplicativo implantado e para diagnosticar quaisquer problemas que possam surgir.</span><span class="sxs-lookup"><span data-stu-id="eccd9-110">Logging is a useful tool for monitoring the health of a deployed application and for diagnosing any problems that may arise.</span></span> <span data-ttu-id="eccd9-111">É especialmente importante registrar em log os erros que ocorrem em um aplicativo implantado para que eles possam ser remediados.</span><span class="sxs-lookup"><span data-stu-id="eccd9-111">It is especially important to log errors that occur in a deployed application so that they can be remedied.</span></span> <span data-ttu-id="eccd9-112">O evento `Error` é gerado sempre que uma exceção não tratada ocorre em um aplicativo ASP.NET; o [tutorial anterior](processing-unhandled-exceptions-cs.md) mostrou como notificar um desenvolvedor de um erro e registrar seus detalhes criando um manipulador de eventos para o evento `Error`.</span><span class="sxs-lookup"><span data-stu-id="eccd9-112">The `Error` event is raised whenever an unhandled exception occurs in an ASP.NET application; the [preceding tutorial](processing-unhandled-exceptions-cs.md) showed how to notify a developer of an error and log its details by creating an event handler for the `Error` event.</span></span> <span data-ttu-id="eccd9-113">No entanto, criar um manipulador de eventos `Error` para registrar em log os detalhes do erro e notificar um desenvolvedor é desnecessário, pois essa tarefa pode ser executada pelo ASP. Sistema de *monitoramento de integridade*da rede.</span><span class="sxs-lookup"><span data-stu-id="eccd9-113">However, creating an `Error` event handler to log the error's details and notify a developer is unnecessary, as this task can be performed by ASP.NET's *health monitoring system*.</span></span>

<span data-ttu-id="eccd9-114">O sistema de monitoramento de integridade foi introduzido no ASP.NET 2,0 e foi projetado para monitorar a integridade de um aplicativo ASP.NET implantado registrando eventos que ocorrem durante o tempo de vida do aplicativo ou da solicitação.</span><span class="sxs-lookup"><span data-stu-id="eccd9-114">The health monitoring system was introduced in ASP.NET 2.0 and is designed to monitor the health of a deployed ASP.NET application by logging events that occur during the application or request's lifetime.</span></span> <span data-ttu-id="eccd9-115">Os eventos registrados pelo sistema de monitoramento de integridade são chamados de *eventos de monitoramento de integridade* ou *eventos da Web*, e incluem:</span><span class="sxs-lookup"><span data-stu-id="eccd9-115">The events logged by the health monitoring system are referred to as *health monitoring events* or *Web events*, and include:</span></span>

- <span data-ttu-id="eccd9-116">Eventos de tempo de vida do aplicativo, como quando um aplicativo é iniciado ou interrompido</span><span class="sxs-lookup"><span data-stu-id="eccd9-116">Application lifetime events, such as when an application starts or stops</span></span>
- <span data-ttu-id="eccd9-117">Eventos de segurança, incluindo tentativas de logon com falha e solicitações de autorização de URL com falha</span><span class="sxs-lookup"><span data-stu-id="eccd9-117">Security events, including failed login attempts and failed URL authorization requests</span></span>
- <span data-ttu-id="eccd9-118">Erros de aplicativo, incluindo exceções sem tratamento, exceções de análise do estado de exibição, exceções de validação de solicitação e erros de compilação, entre outros tipos de erros.</span><span class="sxs-lookup"><span data-stu-id="eccd9-118">Application errors, including unhandled exceptions, view state parsing exceptions, request validation exceptions, and compilation errors, among other types of errors.</span></span>

<span data-ttu-id="eccd9-119">Quando um evento de monitoramento de integridade é gerado, ele pode ser registrado em qualquer número de *fontes de log*especificadas.</span><span class="sxs-lookup"><span data-stu-id="eccd9-119">When a health monitoring event is raised it can be logged to any number of specified *log sources*.</span></span> <span data-ttu-id="eccd9-120">O sistema de monitoramento de integridade é fornecido com fontes de log que registram eventos da Web em um banco de dados Microsoft SQL Server, no log de eventos do Windows ou por meio de uma mensagem de email, entre outros.</span><span class="sxs-lookup"><span data-stu-id="eccd9-120">The health monitoring system ships with log sources that log Web events to a Microsoft SQL Server database, to the Windows Event Log, or via an email message, among others.</span></span> <span data-ttu-id="eccd9-121">Você também pode criar suas próprias fontes de log.</span><span class="sxs-lookup"><span data-stu-id="eccd9-121">You can also create your own log sources.</span></span>

<span data-ttu-id="eccd9-122">Os eventos que o sistema de monitoramento de integridade registra, juntamente com as fontes de log usadas, são definidos em `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="eccd9-122">The events the health monitoring system logs, along with the log sources used, are defined in `Web.config`.</span></span> <span data-ttu-id="eccd9-123">Com algumas linhas de marcação de configuração, você pode usar o monitoramento de integridade para registrar em log todas as exceções sem tratamento em um banco de dados e notificá-lo da exceção por email.</span><span class="sxs-lookup"><span data-stu-id="eccd9-123">With a few lines of configuration markup you can use health monitoring to log all unhandled exceptions to a database and to notify you of the exception via email.</span></span>

## <a name="exploring-the-health-monitoring-systems-configuration"></a><span data-ttu-id="eccd9-124">Explorando a configuração do sistema de monitoramento de integridade</span><span class="sxs-lookup"><span data-stu-id="eccd9-124">Exploring the Health Monitoring System's Configuration</span></span>

<span data-ttu-id="eccd9-125">O comportamento do sistema de monitoramento de integridade é definido por suas informações de configuração, localizadas no [elemento`<healthMonitoring>`](https://msdn.microsoft.com/library/2fwh2ss9.aspx) no `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="eccd9-125">The health monitoring system's behavior is defined by its configuration information, which is located in the [`<healthMonitoring>` element](https://msdn.microsoft.com/library/2fwh2ss9.aspx) in `Web.config`.</span></span> <span data-ttu-id="eccd9-126">Esta seção de configuração define, entre outras coisas, as três informações importantes a seguir:</span><span class="sxs-lookup"><span data-stu-id="eccd9-126">This configuration section defines, among other things, the following three important pieces of information:</span></span>

1. <span data-ttu-id="eccd9-127">Os eventos de monitoramento de integridade que, quando gerados, devem ser registrados em log,</span><span class="sxs-lookup"><span data-stu-id="eccd9-127">The health monitoring events that, when raised, should be logged,</span></span>
2. <span data-ttu-id="eccd9-128">As fontes de log e</span><span class="sxs-lookup"><span data-stu-id="eccd9-128">The log sources, and</span></span>
3. <span data-ttu-id="eccd9-129">Como cada evento de monitoramento de integridade definido em (1) é mapeado para as fontes de log definidas em (2).</span><span class="sxs-lookup"><span data-stu-id="eccd9-129">How each health monitoring event defined in (1) is mapped to the log sources defined in (2).</span></span>

<span data-ttu-id="eccd9-130">Essas informações são especificadas por meio de três elementos de configuração filhos: [`<eventMappings>`](https://msdn.microsoft.com/library/yc5yk01w.aspx), [`<providers>`](https://msdn.microsoft.com/library/zaa41kz1.aspx)e [`<rules>`](https://msdn.microsoft.com/library/fe5wyxa0.aspx), respectivamente.</span><span class="sxs-lookup"><span data-stu-id="eccd9-130">This information is specified through three children configuration elements: [`<eventMappings>`](https://msdn.microsoft.com/library/yc5yk01w.aspx), [`<providers>`](https://msdn.microsoft.com/library/zaa41kz1.aspx), and [`<rules>`](https://msdn.microsoft.com/library/fe5wyxa0.aspx), respectively.</span></span>

<span data-ttu-id="eccd9-131">As informações de configuração do sistema de monitoramento de integridade padrão podem ser encontradas no arquivo `Web.config` na pasta `%WINDIR%\Microsoft.NET\Framework\version\CONFIG`.</span><span class="sxs-lookup"><span data-stu-id="eccd9-131">The default health monitoring system configuration information can be found in the `Web.config` file in `%WINDIR%\Microsoft.NET\Framework\version\CONFIG` folder.</span></span> <span data-ttu-id="eccd9-132">Essas informações de configuração padrão, com algumas marcações removidas para fins de brevidade, são mostradas abaixo:</span><span class="sxs-lookup"><span data-stu-id="eccd9-132">This default configuration information, with some markup removed for brevity, is shown below:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-cs/samples/sample1.xml)]

<span data-ttu-id="eccd9-133">Os eventos de monitoramento de integridade de interesse são definidos no elemento `<eventMappings>`, que fornece um nome amigável para uma classe de eventos de monitoramento de integridade.</span><span class="sxs-lookup"><span data-stu-id="eccd9-133">The health monitoring events of interest are defined in the `<eventMappings>` element, which gives a human-friendly name to a class of health monitoring events.</span></span> <span data-ttu-id="eccd9-134">Na marcação acima, o elemento `<eventMappings>` atribui o nome amigável humano "todos os erros" aos eventos de monitoramento de integridade do tipo `WebBaseErrorEvent` e o nome "auditorias de falha" para eventos de monitoramento de integridade do tipo `WebFailureAuditEvent`.</span><span class="sxs-lookup"><span data-stu-id="eccd9-134">In the markup above, the `<eventMappings>` element assigns the human-friendly name "All Errors" to the health monitoring events of type `WebBaseErrorEvent` and the name "Failure Audits" to health monitoring events of type `WebFailureAuditEvent`.</span></span>

<span data-ttu-id="eccd9-135">O elemento `<providers>` define as fontes de log, dando a elas um nome amigável e especificando qualquer informação de configuração específica de origem de log.</span><span class="sxs-lookup"><span data-stu-id="eccd9-135">The `<providers>` element defines the log sources, giving them a human-friendly name and specifying any log source-specific configuration information.</span></span> <span data-ttu-id="eccd9-136">O primeiro elemento `<add>` define o provedor "EventLogprovider", que registra os eventos de monitoramento de integridade especificados usando a classe `EventLogWebEventProvider`.</span><span class="sxs-lookup"><span data-stu-id="eccd9-136">The first `<add>` element defines the "EventLogProvider" provider, which logs the specified health monitoring events using the `EventLogWebEventProvider` class.</span></span> <span data-ttu-id="eccd9-137">A classe `EventLogWebEventProvider` registra o evento no log de eventos do Windows.</span><span class="sxs-lookup"><span data-stu-id="eccd9-137">The `EventLogWebEventProvider` class logs the event to the Windows Event Log.</span></span> <span data-ttu-id="eccd9-138">O segundo elemento `<add>` define o provedor "SqlWebEventProvider", que registra eventos em um banco de dados Microsoft SQL Server por meio da classe `SqlWebEventProvider`.</span><span class="sxs-lookup"><span data-stu-id="eccd9-138">The second `<add>` element defines the "SqlWebEventProvider" provider, which logs events to a Microsoft SQL Server database via the `SqlWebEventProvider` class.</span></span> <span data-ttu-id="eccd9-139">A configuração "SqlWebEventProvider" especifica a cadeia de conexão do banco de dados (`connectionStringName`) entre outras opções de configuração.</span><span class="sxs-lookup"><span data-stu-id="eccd9-139">The "SqlWebEventProvider" configuration specifies the database's connection string (`connectionStringName`) among other configuration options.</span></span>

<span data-ttu-id="eccd9-140">O elemento `<rules>` mapeia os eventos especificados no elemento `<eventMappings>` para as fontes de log no elemento `<providers>`.</span><span class="sxs-lookup"><span data-stu-id="eccd9-140">The `<rules>` element maps the events specified in the `<eventMappings>` element to log sources in the `<providers>` element.</span></span> <span data-ttu-id="eccd9-141">Por padrão, os aplicativos Web ASP.NET registram em log todas as exceções sem tratamento e falhas de auditoria no log de eventos do Windows.</span><span class="sxs-lookup"><span data-stu-id="eccd9-141">By default, ASP.NET web applications log all unhandled exceptions and audit failures to the Windows Event Log.</span></span>

## <a name="logging-events-to-a-database"></a><span data-ttu-id="eccd9-142">Registrando eventos em log em um banco de dados</span><span class="sxs-lookup"><span data-stu-id="eccd9-142">Logging Events to a Database</span></span>

<span data-ttu-id="eccd9-143">A configuração padrão do sistema de monitoramento de integridade pode ser personalizada em aplicativos Web por aplicativo Web, adicionando uma seção de `<healthMonitoring>` ao arquivo de `Web.config` do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="eccd9-143">The health monitoring system's default configuration can be customized on a web application-by-web application basis by adding a `<healthMonitoring>` section to the application's `Web.config` file.</span></span> <span data-ttu-id="eccd9-144">Você pode incluir elementos adicionais nas seções `<eventMappings>`, `<providers>`e `<rules>` usando o elemento `<add>`.</span><span class="sxs-lookup"><span data-stu-id="eccd9-144">You can include additional elements in the `<eventMappings>`, `<providers>`, and `<rules>` sections by using the `<add>` element.</span></span> <span data-ttu-id="eccd9-145">Para remover uma configuração da configuração padrão, use o elemento `<remove>` ou use `<clear />` para remover todos os valores padrão de uma dessas seções.</span><span class="sxs-lookup"><span data-stu-id="eccd9-145">To remove a setting from the default configuration use the `<remove>` element, or use `<clear />` to remove all default values from one of these sections.</span></span> <span data-ttu-id="eccd9-146">Vamos configurar o aplicativo Web de análises de livros para registrar em log todas as exceções sem tratamento em um banco de dados Microsoft SQL Server usando a classe `SqlWebEventProvider`.</span><span class="sxs-lookup"><span data-stu-id="eccd9-146">Let's configure the Book Reviews web application to log all unhandled exceptions to a Microsoft SQL Server database using the `SqlWebEventProvider` class.</span></span>

<span data-ttu-id="eccd9-147">A classe `SqlWebEventProvider` faz parte do sistema de monitoramento de integridade e registra um evento de monitoramento de integridade em um banco de dados SQL Server especificado.</span><span class="sxs-lookup"><span data-stu-id="eccd9-147">The `SqlWebEventProvider` class is part of the health monitoring system and logs a health monitoring event to a specified SQL Server database.</span></span> <span data-ttu-id="eccd9-148">A classe `SqlWebEventProvider` espera que o banco de dados especificado inclua um procedimento armazenado chamado `aspnet_WebEvent_LogEvent`.</span><span class="sxs-lookup"><span data-stu-id="eccd9-148">The `SqlWebEventProvider` class expects that the specified database includes a stored procedure named `aspnet_WebEvent_LogEvent`.</span></span> <span data-ttu-id="eccd9-149">Esse procedimento armazenado recebe os detalhes do evento e é tarefa com o armazenamento dos detalhes do evento.</span><span class="sxs-lookup"><span data-stu-id="eccd9-149">This stored procedure is passed the details of the event and is tasked with storing the event details.</span></span> <span data-ttu-id="eccd9-150">A boa notícia é que você não precisa criar esse procedimento armazenado nem a tabela para armazenar os detalhes do evento.</span><span class="sxs-lookup"><span data-stu-id="eccd9-150">The good news is that you do not need to create this stored procedure nor the table to store the event details.</span></span> <span data-ttu-id="eccd9-151">Você pode adicionar esses objetos ao seu banco de dados usando a ferramenta `aspnet_regsql.exe`.</span><span class="sxs-lookup"><span data-stu-id="eccd9-151">You can add these objects to your database using the `aspnet_regsql.exe` tool.</span></span>

> [!NOTE]
> <span data-ttu-id="eccd9-152">A ferramenta de `aspnet_regsql.exe` foi discutida de volta no [tutorial *Configurando um site que usa serviços de aplicativos* ](configuring-a-website-that-uses-application-services-cs.md) quando adicionamos suporte para ASP. Serviços de aplicativos da rede.</span><span class="sxs-lookup"><span data-stu-id="eccd9-152">The `aspnet_regsql.exe` tool was discussed back in the [*Configuring a Website That Uses Application Services* tutorial](configuring-a-website-that-uses-application-services-cs.md) when we added support for ASP.NET's application services.</span></span> <span data-ttu-id="eccd9-153">Consequentemente, o banco de dados do site do Reviews já contém o procedimento armazenado `aspnet_WebEvent_LogEvent`, que armazena as informações do evento em uma tabela chamada `aspnet_WebEvent_Events`.</span><span class="sxs-lookup"><span data-stu-id="eccd9-153">Consequently, the Book Reviews website's database already contains the `aspnet_WebEvent_LogEvent` stored procedure, which stores the event information into a table named `aspnet_WebEvent_Events`.</span></span>

<span data-ttu-id="eccd9-154">Depois que você tiver o procedimento armazenado e a tabela necessários adicionados ao seu banco de dados, tudo o que resta é instruir o monitoramento de integridade para registrar em log todas as exceções sem tratamento no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="eccd9-154">Once you have the necessary stored procedure and table added to your database, all that remains is to instruct health monitoring to log all unhandled exceptions to the database.</span></span> <span data-ttu-id="eccd9-155">Para fazer isso, adicione a seguinte marcação ao arquivo de `Web.config` do seu site:</span><span class="sxs-lookup"><span data-stu-id="eccd9-155">Accomplish this by adding the following markup to your website's `Web.config` file:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-cs/samples/sample2.xml)]

<span data-ttu-id="eccd9-156">A marcação de configuração de monitoramento de integridade acima usa `<clear />` elementos para apagar as informações de configuração de monitoramento de integridade predefinida das seções `<eventMappings>`, `<providers>`e `<rules>`.</span><span class="sxs-lookup"><span data-stu-id="eccd9-156">The health monitoring configuration markup above uses `<clear />` elements to wipe the pre-defined health monitoring configuration information from the `<eventMappings>`, `<providers>`, and `<rules>` sections.</span></span> <span data-ttu-id="eccd9-157">Em seguida, ele adiciona uma única entrada a cada uma dessas seções.</span><span class="sxs-lookup"><span data-stu-id="eccd9-157">It then adds a single entry to each of these sections.</span></span>

- <span data-ttu-id="eccd9-158">O elemento `<eventMappings>` define um único evento de monitoramento de integridade de interesse chamado "todos os erros", que é gerado sempre que ocorre uma exceção sem tratamento.</span><span class="sxs-lookup"><span data-stu-id="eccd9-158">The `<eventMappings>` element defines a single health monitoring event of interest named "All Errors", which is raised whenever an unhandled exception occurs.</span></span>
- <span data-ttu-id="eccd9-159">O elemento `<providers>` define uma única origem de log chamada "SqlWebEventProvider" que usa a classe `SqlWebEventProvider`.</span><span class="sxs-lookup"><span data-stu-id="eccd9-159">The `<providers>` element defines a single log source named "SqlWebEventProvider" that uses the `SqlWebEventProvider` class.</span></span> <span data-ttu-id="eccd9-160">O atributo `connectionStringName` foi definido como "ReviewsConnectionString", que é o nome da nossa cadeia de conexão definida na seção `<connectionStrings>`.</span><span class="sxs-lookup"><span data-stu-id="eccd9-160">The `connectionStringName` attribute has been set to "ReviewsConnectionString", which is the name of our connection string defined in the `<connectionStrings>` section.</span></span>
- <span data-ttu-id="eccd9-161">Por fim, o elemento regras de &lt;&gt; indica que quando um evento "todos os erros" ocorre, ele deve ser registrado usando o provedor "SqlWebEventProvider".</span><span class="sxs-lookup"><span data-stu-id="eccd9-161">Finally, the &lt;rules&gt; element indicates that when an "All Errors" event transpires that it should be logged using the "SqlWebEventProvider" provider.</span></span>

<span data-ttu-id="eccd9-162">Essa informação de configuração instrui o sistema de monitoramento de integridade a registrar em log todas as exceções sem tratamento no banco de dados de revisões de livros.</span><span class="sxs-lookup"><span data-stu-id="eccd9-162">This configuration information instructs the health monitoring system to log all unhandled exceptions to the Book Reviews database.</span></span>

> [!NOTE]
> <span data-ttu-id="eccd9-163">O evento `WebBaseErrorEvent` só é gerado para erros do servidor; Ele não é gerado para erros HTTP, como uma solicitação para um recurso ASP.NET que não é encontrado.</span><span class="sxs-lookup"><span data-stu-id="eccd9-163">The `WebBaseErrorEvent` event is only raised for server errors; it is not raised for HTTP errors, such as a request for an ASP.NET resource that is not found.</span></span> <span data-ttu-id="eccd9-164">Isso difere do comportamento do evento `Error` da classe `HttpApplication`, que é gerado para erros de servidor e HTTP.</span><span class="sxs-lookup"><span data-stu-id="eccd9-164">This differs from the behavior of the `HttpApplication` class's `Error` event, which is raised for both server and HTTP errors.</span></span>

<span data-ttu-id="eccd9-165">Para ver o sistema de monitoramento de integridade em ação, visite o site e gere um erro de tempo de execução visitando `Genre.aspx?ID=foo`.</span><span class="sxs-lookup"><span data-stu-id="eccd9-165">To see the health monitoring system in action, visit the website and generate a runtime error by visiting `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="eccd9-166">Você deve ver a página de erro apropriada – a exceção detalhes da tela amarela de morte (ao visitar localmente) ou a página de erro personalizada (ao visitar o site em produção).</span><span class="sxs-lookup"><span data-stu-id="eccd9-166">You should see the appropriate error page - either the Exception Details Yellow Screen of Death (when visiting locally) or the custom error page (when visiting the site in production).</span></span> <span data-ttu-id="eccd9-167">Nos bastidores, o sistema de monitoramento de integridade registrou as informações de erro no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="eccd9-167">Behind the scenes, the health monitoring system logged the error information to the database.</span></span> <span data-ttu-id="eccd9-168">Deve haver um registro na tabela de `aspnet_WebEvent_Events` (consulte a **Figura 1**); Esse registro contém informações sobre o erro de tempo de execução que acabou de ocorrer.</span><span class="sxs-lookup"><span data-stu-id="eccd9-168">There should be one record in the `aspnet_WebEvent_Events` table (see **Figure 1**); this record contains information about the runtime error that just occurred.</span></span>

[![](logging-error-details-with-asp-net-health-monitoring-cs/_static/image2.png)](logging-error-details-with-asp-net-health-monitoring-cs/_static/image1.png)

<span data-ttu-id="eccd9-169">**Figura 1**: os detalhes do erro foram registrados na tabela de `aspnet_WebEvent_Events`</span><span class="sxs-lookup"><span data-stu-id="eccd9-169">**Figure 1**: The Error Details Were Logged to the `aspnet_WebEvent_Events` Table</span></span>  
<span data-ttu-id="eccd9-170">([Clique para exibir a imagem em tamanho normal](logging-error-details-with-asp-net-health-monitoring-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="eccd9-170">([Click to view full-size image](logging-error-details-with-asp-net-health-monitoring-cs/_static/image3.png))</span></span>

### <a name="displaying-the-error-log-in-a-web-page"></a><span data-ttu-id="eccd9-171">Exibindo o log de erros em uma página da Web</span><span class="sxs-lookup"><span data-stu-id="eccd9-171">Displaying the Error Log In a Web Page</span></span>

<span data-ttu-id="eccd9-172">Com a configuração atual do site, o sistema de monitoramento de integridade registra em log todas as exceções sem tratamento no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="eccd9-172">With the website's current configuration, the health monitoring system logs all unhandled exceptions to the database.</span></span> <span data-ttu-id="eccd9-173">No entanto, o monitoramento de integridade não fornece nenhum mecanismo para exibir o log de erros por meio de uma página da Web.</span><span class="sxs-lookup"><span data-stu-id="eccd9-173">However, health monitoring does not provide any mechanism to view the error log through a web page.</span></span> <span data-ttu-id="eccd9-174">No entanto, você pode criar uma página ASP.NET que exibe essas informações do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="eccd9-174">However, you could build an ASP.NET page that displays this information from the database.</span></span> <span data-ttu-id="eccd9-175">(Como veremos momentaneamente, você pode optar por ter os detalhes do erro enviados a você em uma mensagem de email.)</span><span class="sxs-lookup"><span data-stu-id="eccd9-175">(As we'll see momentarily, you can opt to have the error details sent to you in an email message.)</span></span>

<span data-ttu-id="eccd9-176">Se você criar uma página desse tipo, certifique-se de tomar medidas para permitir que apenas usuários autorizados exibam os detalhes do erro.</span><span class="sxs-lookup"><span data-stu-id="eccd9-176">If you create such a page, make sure you take steps to allow only authorized users to view the error details.</span></span> <span data-ttu-id="eccd9-177">Se seu site já utiliza contas de usuário, você pode usar regras de autorização de URL para restringir o acesso à página a determinados usuários ou funções.</span><span class="sxs-lookup"><span data-stu-id="eccd9-177">If your site already employs user accounts then you can use URL authorization rules to restrict access to the page to certain users or roles.</span></span> <span data-ttu-id="eccd9-178">Para obter mais informações sobre como conceder ou restringir o acesso a páginas da Web com base no usuário conectado, consulte meus [tutoriais de segurança do site](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span><span class="sxs-lookup"><span data-stu-id="eccd9-178">For more information on how to grant or restrict access to web pages based on the logged in user, refer to my [Website Security Tutorials](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span>

> [!NOTE]
> <span data-ttu-id="eccd9-179">O tutorial subsequente explora um sistema de notificação e registro em log de erros alternativo chamado ELMAH.</span><span class="sxs-lookup"><span data-stu-id="eccd9-179">The subsequent tutorial explores an alternative error logging and notification system named ELMAH.</span></span> <span data-ttu-id="eccd9-180">O ELMAH inclui um mecanismo interno para exibir o log de erros de uma página da Web e como um RSS feed.</span><span class="sxs-lookup"><span data-stu-id="eccd9-180">ELMAH includes a built-in mechanism to view the error log from both a web page and as an RSS feed.</span></span>

## <a name="logging-events-to-email"></a><span data-ttu-id="eccd9-181">Registrando eventos em log para email</span><span class="sxs-lookup"><span data-stu-id="eccd9-181">Logging Events to Email</span></span>

<span data-ttu-id="eccd9-182">O sistema de monitoramento de integridade inclui um provedor de origem de log que "registra" um evento em uma mensagem de email.</span><span class="sxs-lookup"><span data-stu-id="eccd9-182">The health monitoring system includes a log source provider that "logs" an event to an email message.</span></span> <span data-ttu-id="eccd9-183">A origem do log inclui as mesmas informações que são registradas no banco de dados no corpo da mensagem de email.</span><span class="sxs-lookup"><span data-stu-id="eccd9-183">The log source includes the same information that is logged to the database in the email message body.</span></span> <span data-ttu-id="eccd9-184">Você pode usar essa fonte de log para notificar um desenvolvedor quando ocorrer um determinado evento de monitoramento de integridade.</span><span class="sxs-lookup"><span data-stu-id="eccd9-184">You can use this log source to notify a developer when a certain health monitoring event occurs.</span></span>

<span data-ttu-id="eccd9-185">Vamos atualizar o livro Reviews da configuração do site para que recebamos um email sempre que ocorrer uma exceção.</span><span class="sxs-lookup"><span data-stu-id="eccd9-185">Let's update the Book Reviews website's configuration so that we receive an email whenever an exception occurs.</span></span> <span data-ttu-id="eccd9-186">Para fazer isso, precisamos executar três tarefas:</span><span class="sxs-lookup"><span data-stu-id="eccd9-186">To accomplish this we need to perform three tasks:</span></span>

1. <span data-ttu-id="eccd9-187">Configure o aplicativo Web ASP.NET para enviar email.</span><span class="sxs-lookup"><span data-stu-id="eccd9-187">Configure the ASP.NET web application to send email.</span></span> <span data-ttu-id="eccd9-188">Isso é feito especificando como as mensagens de email são enviadas por meio do elemento de configuração `<system.net>`.</span><span class="sxs-lookup"><span data-stu-id="eccd9-188">This is accomplished by specifying how email messages are sent via the `<system.net>` configuration element.</span></span> <span data-ttu-id="eccd9-189">Para obter mais informações sobre como enviar mensagens de email em um aplicativo ASP.NET, consulte [Enviar email em ASP.net](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx) e as [perguntas frequentes sobre o System .net. mail](http://systemnetmail.com/).</span><span class="sxs-lookup"><span data-stu-id="eccd9-189">For more information on sending email messages in an ASP.NET application refer to [Sending Email in ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx) and the [System.Net.Mail FAQ](http://systemnetmail.com/).</span></span>
2. <span data-ttu-id="eccd9-190">Registre o provedor de origem de log de email no elemento `<providers>` e</span><span class="sxs-lookup"><span data-stu-id="eccd9-190">Register the email log source provider in the `<providers>` element, and</span></span>
3. <span data-ttu-id="eccd9-191">Adicione uma entrada ao elemento `<rules>` que mapeia o evento "todos os erros" para o provedor de origem de log adicionado na etapa (2).</span><span class="sxs-lookup"><span data-stu-id="eccd9-191">Add an entry to the `<rules>` element that maps the "All Errors" event to the log source provider added in step (2).</span></span>

<span data-ttu-id="eccd9-192">O sistema de monitoramento de integridade inclui duas classes de provedor de origem de log de email: `SimpleMailWebEventProvider` e `TemplatedMailWebEventProvider`.</span><span class="sxs-lookup"><span data-stu-id="eccd9-192">The health monitoring system includes two email log source provider classes: `SimpleMailWebEventProvider` and `TemplatedMailWebEventProvider`.</span></span> <span data-ttu-id="eccd9-193">A [classe`SimpleMailWebEventProvider`](https://msdn.microsoft.com/library/system.web.management.simplemailwebeventprovider.aspx) envia uma mensagem de email de texto sem formatação que inclui os detalhes do evento e fornece pouca personalização do corpo do email.</span><span class="sxs-lookup"><span data-stu-id="eccd9-193">The [`SimpleMailWebEventProvider` class](https://msdn.microsoft.com/library/system.web.management.simplemailwebeventprovider.aspx) sends a plain-text email message that includes the event details and provides little customization of the email body.</span></span> <span data-ttu-id="eccd9-194">Com a [classe`TemplatedMailWebEventProvider`](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx) , você especifica uma página ASP.net cuja marcação renderizada é usada como o corpo da mensagem de email.</span><span class="sxs-lookup"><span data-stu-id="eccd9-194">With the [`TemplatedMailWebEventProvider` class](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx) you specify an ASP.NET page whose rendered markup is used as the body for the email message.</span></span> <span data-ttu-id="eccd9-195">A [classe`TemplatedMailWebEventProvider`](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx) oferece um controle muito maior sobre o conteúdo e o formato da mensagem de email, mas requer um pouco mais de trabalho antecipado, pois você precisa criar a página ASP.NET que gera o corpo da mensagem de email.</span><span class="sxs-lookup"><span data-stu-id="eccd9-195">The [`TemplatedMailWebEventProvider` class](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx) gives you much greater control over the contents and format of the email message, but requires a bit more upfront work as you have to create the ASP.NET page that generates the email message's body.</span></span> <span data-ttu-id="eccd9-196">Este tutorial se concentra no uso da classe `SimpleMailWebEventProvider`.</span><span class="sxs-lookup"><span data-stu-id="eccd9-196">This tutorial focuses on using the `SimpleMailWebEventProvider` class.</span></span>

<span data-ttu-id="eccd9-197">Atualize o elemento `<providers>` do sistema de monitoramento de integridade no arquivo `Web.config` para incluir uma origem de log para a classe `SimpleMailWebEventProvider`:</span><span class="sxs-lookup"><span data-stu-id="eccd9-197">Update the health monitoring system's `<providers>` element in the `Web.config` file to include a log source for the `SimpleMailWebEventProvider` class:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-cs/samples/sample3.xml)]

<span data-ttu-id="eccd9-198">A marcação acima usa a classe `SimpleMailWebEventProvider` como o provedor de origem de log e atribui o nome amigável "EmailWebEventProvider".</span><span class="sxs-lookup"><span data-stu-id="eccd9-198">The above markup uses the `SimpleMailWebEventProvider` class as the log source provider, and assigns it the friendly name "EmailWebEventProvider".</span></span> <span data-ttu-id="eccd9-199">Além disso, o atributo `<add>` inclui opções de configuração adicionais, como os endereços de e para da mensagem de email.</span><span class="sxs-lookup"><span data-stu-id="eccd9-199">Moreover, the `<add>` attribute includes additional configuration options, such as the To and From addresses of the email message.</span></span>

<span data-ttu-id="eccd9-200">Com a origem do log de email definida, tudo o que resta é instruir o sistema de monitoramento de integridade a usar essa origem para "registrar" as exceções sem tratamento.</span><span class="sxs-lookup"><span data-stu-id="eccd9-200">With the email log source defined, all that remains is to instruct the health monitoring system to use this source to "log" unhandled exceptions.</span></span> <span data-ttu-id="eccd9-201">Isso é feito com a adição de uma nova regra na seção `<rules>`:</span><span class="sxs-lookup"><span data-stu-id="eccd9-201">This is accomplished by adding a new rule in the `<rules>` section:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-cs/samples/sample4.xml)]

<span data-ttu-id="eccd9-202">A seção `<rules>` agora inclui duas regras.</span><span class="sxs-lookup"><span data-stu-id="eccd9-202">The `<rules>` section now includes two rules.</span></span> <span data-ttu-id="eccd9-203">O primeiro, chamado "todos os erros de email", envia todas as exceções sem tratamento para a origem de log "EmailWebEventProvider".</span><span class="sxs-lookup"><span data-stu-id="eccd9-203">The first one, named "All Errors To Email", sends all unhandled exceptions to the "EmailWebEventProvider" log source.</span></span> <span data-ttu-id="eccd9-204">Essa regra tem o efeito de enviar detalhes sobre erros no site para o endereço de endereçamento especificado.</span><span class="sxs-lookup"><span data-stu-id="eccd9-204">This rule has the effect of sending details about errors on the website to the specified To address.</span></span> <span data-ttu-id="eccd9-205">A regra "todos os erros no banco de dados" registra os detalhes do erro no banco de dados do site.</span><span class="sxs-lookup"><span data-stu-id="eccd9-205">The "All Errors To Database" rule logs the error details to the site's database.</span></span> <span data-ttu-id="eccd9-206">Consequentemente, sempre que uma exceção não tratada ocorrer no site, seus detalhes serão registrados no banco de dados e enviados ao endereço de email especificado.</span><span class="sxs-lookup"><span data-stu-id="eccd9-206">Consequently, whenever an unhandled exception occurs on the site its details are both logged to the database and sent to specified email address.</span></span>

<span data-ttu-id="eccd9-207">A **Figura 2** mostra o email gerado pela classe `SimpleMailWebEventProvider` ao visitar `Genre.aspx?ID=foo`.</span><span class="sxs-lookup"><span data-stu-id="eccd9-207">**Figure 2** shows the email generated by the `SimpleMailWebEventProvider` class when visiting `Genre.aspx?ID=foo`.</span></span>

[![](logging-error-details-with-asp-net-health-monitoring-cs/_static/image5.png)](logging-error-details-with-asp-net-health-monitoring-cs/_static/image4.png)

<span data-ttu-id="eccd9-208">**Figura 2**: os detalhes do erro são enviados em uma mensagem de email</span><span class="sxs-lookup"><span data-stu-id="eccd9-208">**Figure 2**: The Error Details are Sent in an Email Message</span></span>  
<span data-ttu-id="eccd9-209">([Clique para exibir a imagem em tamanho normal](logging-error-details-with-asp-net-health-monitoring-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="eccd9-209">([Click to view full-size image](logging-error-details-with-asp-net-health-monitoring-cs/_static/image6.png))</span></span>

## <a name="summary"></a><span data-ttu-id="eccd9-210">Resumo</span><span class="sxs-lookup"><span data-stu-id="eccd9-210">Summary</span></span>

<span data-ttu-id="eccd9-211">O sistema de monitoramento de integridade do ASP.NET foi projetado para permitir que os administradores monitorem a integridade de um aplicativo Web implantado.</span><span class="sxs-lookup"><span data-stu-id="eccd9-211">The ASP.NET health monitoring system is designed to allow administrators to monitor the health of a deployed web application.</span></span> <span data-ttu-id="eccd9-212">Eventos de monitoramento de integridade são gerados quando determinadas ações ficam desdobradas, como quando o aplicativo é interrompido, quando um usuário faz logon com êxito no site ou quando ocorre uma exceção sem tratamento.</span><span class="sxs-lookup"><span data-stu-id="eccd9-212">Health monitoring events are raised when certain actions unfold, such as when the application stops, when a user successfully logs onto the site, or when an unhandled exception occurs.</span></span> <span data-ttu-id="eccd9-213">Esses eventos podem ser registrados em qualquer número de fontes de log.</span><span class="sxs-lookup"><span data-stu-id="eccd9-213">These events can be logged to any number of log sources.</span></span> <span data-ttu-id="eccd9-214">Este tutorial mostrou como registrar em log os detalhes de exceções sem tratamento em um banco de dados e por meio de uma mensagem de email.</span><span class="sxs-lookup"><span data-stu-id="eccd9-214">This tutorial showed how to log the details of unhandled exceptions to a database and through an email message.</span></span>

<span data-ttu-id="eccd9-215">Este tutorial se concentrou no uso do monitoramento de integridade para registrar exceções sem tratamento, mas tenha em mente que o monitoramento de integridade foi projetado para medir a integridade geral de um aplicativo ASP.NET implantado e inclui uma infinidade de eventos de monitoramento de integridade e origens de log não explorado aqui.</span><span class="sxs-lookup"><span data-stu-id="eccd9-215">This tutorial focused on using health monitoring to log unhandled exceptions, but keep in mind that health monitoring is designed to measure the overall health of a deployed ASP.NET application and includes a wealth of health monitoring events and log sources not explored here.</span></span> <span data-ttu-id="eccd9-216">Além do mais, você pode criar seus próprios eventos de monitoramento de integridade e origens de log, caso seja necessário.</span><span class="sxs-lookup"><span data-stu-id="eccd9-216">What's more, you can create your own health monitoring events and log sources, should the need arise.</span></span> <span data-ttu-id="eccd9-217">Se você estiver interessado em aprender mais sobre o monitoramento de integridade, uma boa primeira etapa é ler as [perguntas frequentes sobre monitoramento de integridade](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx)do [Erik Reitan](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx).</span><span class="sxs-lookup"><span data-stu-id="eccd9-217">If you are interested in learning more about health monitoring, a good first step is to read through [Erik Reitan](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx)'s [health monitoring FAQ](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx).</span></span> <span data-ttu-id="eccd9-218">Depois disso, consulte [como: usar o monitoramento de integridade no ASP.NET 2,0](https://msdn.microsoft.com/library/ms998306.aspx).</span><span class="sxs-lookup"><span data-stu-id="eccd9-218">Following that, consult [How To: Use Health Monitoring in ASP.NET 2.0](https://msdn.microsoft.com/library/ms998306.aspx).</span></span>

<span data-ttu-id="eccd9-219">Boa programação!</span><span class="sxs-lookup"><span data-stu-id="eccd9-219">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="eccd9-220">Leitura adicional</span><span class="sxs-lookup"><span data-stu-id="eccd9-220">Further Reading</span></span>

<span data-ttu-id="eccd9-221">Para obter mais informações sobre os tópicos discutidos neste tutorial, consulte os seguintes recursos:</span><span class="sxs-lookup"><span data-stu-id="eccd9-221">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="eccd9-222">Visão geral do monitoramento de integridade do ASP.NET</span><span class="sxs-lookup"><span data-stu-id="eccd9-222">ASP.NET Health Monitoring Overview</span></span>](https://msdn.microsoft.com/library/bb398933.aspx)
- [<span data-ttu-id="eccd9-223">Configurando e personalizando o sistema de monitoramento de integridade do ASP.NET</span><span class="sxs-lookup"><span data-stu-id="eccd9-223">Configuring and Customizing the Health Monitoring System of ASP.NET</span></span>](http://dotnetslackers.com/articles/aspnet/ConfiguringAndCustomizingTheHealthMonitoringSystemOfASPNET.aspx)
- [<span data-ttu-id="eccd9-224">Perguntas frequentes-monitoramento de integridade no ASP.NET 2,0</span><span class="sxs-lookup"><span data-stu-id="eccd9-224">FAQ - Health Monitoring in ASP.NET 2.0</span></span>](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx)
- [<span data-ttu-id="eccd9-225">Como: enviar email para notificações de monitoramento de integridade</span><span class="sxs-lookup"><span data-stu-id="eccd9-225">How To: Send E-Mail for Health Monitoring Notifications</span></span>](https://msdn.microsoft.com/library/ms227553.aspx)
- [<span data-ttu-id="eccd9-226">Como: usar o monitoramento de integridade no ASP.NET</span><span class="sxs-lookup"><span data-stu-id="eccd9-226">How To: Use Health Monitoring in ASP.NET</span></span>](https://msdn.microsoft.com/library/ms998306.aspx)
- [<span data-ttu-id="eccd9-227">Monitoramento de integridade no ASP.NET</span><span class="sxs-lookup"><span data-stu-id="eccd9-227">Health Monitoring in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/031407-1.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="eccd9-228">[Anterior](processing-unhandled-exceptions-cs.md)
> [Próximo](logging-error-details-with-elmah-cs.md)</span><span class="sxs-lookup"><span data-stu-id="eccd9-228">[Previous](processing-unhandled-exceptions-cs.md)
[Next](logging-error-details-with-elmah-cs.md)</span></span>
