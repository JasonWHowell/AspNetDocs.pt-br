---
uid: web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2
title: Introdução com Entity Framework 4,0 Database First e ASP.NET 4 Web Forms-parte 2 | Microsoft Docs
author: tdykstra
description: O aplicativo Web de exemplo Contoso University demonstra como criar ASP.NET Web Forms aplicativos usando o Entity Framework. O aplicativo de exemplo é...
ms.author: riande
ms.date: 12/03/2010
ms.assetid: fb63a326-a4ae-4b0c-a4f5-412327197216
msc.legacyurl: /web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2
msc.type: authoredcontent
ms.openlocfilehash: bd6a2e29e6f0df04e39be29160e2e08cc99c4706
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78566006"
---
# <a name="getting-started-with-entity-framework-40-database-first-and-aspnet-4-web-forms---part-2"></a><span data-ttu-id="5bfcc-104">Introdução com Entity Framework 4,0 Database First e ASP.NET 4 Web Forms-parte 2</span><span class="sxs-lookup"><span data-stu-id="5bfcc-104">Getting Started with Entity Framework 4.0 Database First and ASP.NET 4 Web Forms - Part 2</span></span>

<span data-ttu-id="5bfcc-105">por [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="5bfcc-106">O aplicativo Web de exemplo Contoso University demonstra como criar ASP.NET Web Forms aplicativos usando o Entity Framework 4,0 e o Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-106">The Contoso University sample web application demonstrates how to create ASP.NET Web Forms applications using the Entity Framework 4.0 and Visual Studio 2010.</span></span> <span data-ttu-id="5bfcc-107">Para obter informações sobre a série de tutoriais, consulte [o primeiro tutorial da série](the-entity-framework-and-aspnet-getting-started-part-1.md)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-107">For information about the tutorial series, see [the first tutorial in the series](the-entity-framework-and-aspnet-getting-started-part-1.md)</span></span>

## <a name="the-entitydatasource-control"></a><span data-ttu-id="5bfcc-108">O controle de EntityDataSource</span><span class="sxs-lookup"><span data-stu-id="5bfcc-108">The EntityDataSource Control</span></span>

<span data-ttu-id="5bfcc-109">No tutorial anterior, você criou um site da Web, um banco de dados e um modelo.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-109">In the previous tutorial you created a web site, a database, and a data model.</span></span> <span data-ttu-id="5bfcc-110">Neste tutorial, você trabalha com o controle de `EntityDataSource` que o ASP.NET fornece para facilitar o trabalho com um modelo de dados de Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-110">In this tutorial you work with the `EntityDataSource` control that ASP.NET provides in order to make it easy to work with an Entity Framework data model.</span></span> <span data-ttu-id="5bfcc-111">Você criará um controle de `GridView` para exibir e editar dados de alunos, um controle de `DetailsView` para adicionar novos alunos e um controle de `DropDownList` para selecionar um departamento (que você usará posteriormente para exibir os cursos associados).</span><span class="sxs-lookup"><span data-stu-id="5bfcc-111">You'll create a `GridView` control for displaying and editing student data, a `DetailsView` control for adding new students, and a `DropDownList` control for selecting a department (which you'll use later for displaying associated courses).</span></span>

<span data-ttu-id="5bfcc-112">[![Image20](the-entity-framework-and-aspnet-getting-started-part-2/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-112">[![Image20](the-entity-framework-and-aspnet-getting-started-part-2/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image1.png)</span></span>

<span data-ttu-id="5bfcc-113">[![Image09](the-entity-framework-and-aspnet-getting-started-part-2/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-113">[![Image09](the-entity-framework-and-aspnet-getting-started-part-2/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image3.png)</span></span>

<span data-ttu-id="5bfcc-114">[![Image18](the-entity-framework-and-aspnet-getting-started-part-2/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-114">[![Image18](the-entity-framework-and-aspnet-getting-started-part-2/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image5.png)</span></span>

<span data-ttu-id="5bfcc-115">Observe que, neste aplicativo, você não adicionará validação de entrada às páginas que atualizam o banco de dados, e algumas das manipulações de erro não serão tão robustas quanto seriam necessárias em um aplicativo de produção.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-115">Note that in this application you won't be adding input validation to pages that update the database, and some of the error handling will not be as robust as would be required in a production application.</span></span> <span data-ttu-id="5bfcc-116">Isso mantém o tutorial focalizado na Entity Framework e impede que ele fique muito longo.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-116">That keeps the tutorial focused on the Entity Framework and keeps it from getting too long.</span></span> <span data-ttu-id="5bfcc-117">Para obter detalhes sobre como adicionar esses recursos ao seu aplicativo, consulte [validando a entrada do usuário em páginas da Web do ASP.net](https://msdn.microsoft.com/library/7kh55542.aspx) e [tratamento de erros em páginas e aplicativos do ASP.net](https://msdn.microsoft.com/library/w16865z6.aspx).</span><span class="sxs-lookup"><span data-stu-id="5bfcc-117">For details about how to add these features to your application, see [Validating User Input in ASP.NET Web Pages](https://msdn.microsoft.com/library/7kh55542.aspx) and [Error Handling in ASP.NET Pages and Applications](https://msdn.microsoft.com/library/w16865z6.aspx).</span></span>

## <a name="adding-and-configuring-the-entitydatasource-control"></a><span data-ttu-id="5bfcc-118">Adicionando e Configurando o controle de EntityDataSource</span><span class="sxs-lookup"><span data-stu-id="5bfcc-118">Adding and Configuring the EntityDataSource Control</span></span>

<span data-ttu-id="5bfcc-119">Você começará Configurando um controle de `EntityDataSource` para ler `Person` entidades do conjunto de entidades `People`.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-119">You'll begin by configuring an `EntityDataSource` control to read `Person` entities from the `People` entity set.</span></span>

<span data-ttu-id="5bfcc-120">Verifique se você tem o Visual Studio aberto e se está trabalhando com o projeto que você criou na parte 1.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-120">Make sure you have Visual Studio open and that you're working with the project you created in part 1.</span></span> <span data-ttu-id="5bfcc-121">Se você não tiver criado o projeto desde que criou o modelo de dados ou desde a última alteração feita a ele, compile o projeto agora.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-121">If you haven't built the project since you created the data model or since the last change you made to it, build the project now.</span></span> <span data-ttu-id="5bfcc-122">As alterações no modelo de dados não são disponibilizadas para o designer até que o projeto seja compilado.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-122">Changes to the data model are not made available to the designer until the project is built.</span></span>

<span data-ttu-id="5bfcc-123">Crie uma nova página da Web usando o **formulário da Web usando** o modelo de página mestra e nomeie-a como *Student. aspx*.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-123">Create a new web page using the **Web Form using Master Page** template, and name it *Students.aspx*.</span></span>

<span data-ttu-id="5bfcc-124">[![Image23](the-entity-framework-and-aspnet-getting-started-part-2/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-124">[![Image23](the-entity-framework-and-aspnet-getting-started-part-2/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image7.png)</span></span>

<span data-ttu-id="5bfcc-125">Especifique *site. Master* como a página mestra.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-125">Specify *Site.Master* as the master page.</span></span> <span data-ttu-id="5bfcc-126">Todas as páginas que você criar para esses tutoriais usarão essa página mestra.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-126">All of the pages you create for these tutorials will use this master page.</span></span>

<span data-ttu-id="5bfcc-127">[![Image24](the-entity-framework-and-aspnet-getting-started-part-2/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-127">[![Image24](the-entity-framework-and-aspnet-getting-started-part-2/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image9.png)</span></span>

<span data-ttu-id="5bfcc-128">No modo de exibição de **origem** , adicione um cabeçalho de `h2` ao controle de `Content` chamado `Content2`, conforme mostrado no exemplo a seguir:</span><span class="sxs-lookup"><span data-stu-id="5bfcc-128">In **Source** view, add an `h2` heading to the `Content` control named `Content2`, as shown in the following example:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample1.aspx)]

<span data-ttu-id="5bfcc-129">Na guia **dados** da caixa de **ferramentas**, arraste um controle de `EntityDataSource` para a página, solte-o abaixo do título e altere a ID para `StudentsEntityDataSource`:</span><span class="sxs-lookup"><span data-stu-id="5bfcc-129">From the **Data** tab of the **Toolbox**, drag an `EntityDataSource` control to the page, drop it below the heading, and change the ID to `StudentsEntityDataSource`:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample2.aspx)]

<span data-ttu-id="5bfcc-130">Alterne para o modo de exibição de **design** , clique na marca inteligente do controle da fonte de dados e clique em **Configurar fonte de dados** para iniciar o assistente para **Configurar fonte de dados** .</span><span class="sxs-lookup"><span data-stu-id="5bfcc-130">Switch to **Design** view, click the data source control's smart tag, and then click **Configure Data Source** to launch the **Configure Data Source** wizard.</span></span>

<span data-ttu-id="5bfcc-131">[![Image01](the-entity-framework-and-aspnet-getting-started-part-2/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-131">[![Image01](the-entity-framework-and-aspnet-getting-started-part-2/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image11.png)</span></span>

<span data-ttu-id="5bfcc-132">Na etapa **Configurar** o assistente de ObjectContext, selecione **SchoolEntities** como o valor para **conexão nomeada**e selecione **SchoolEntities** como o valor **DefaultContainerName** .</span><span class="sxs-lookup"><span data-stu-id="5bfcc-132">In the **Configure ObjectContext** wizard step, select **SchoolEntities** as the value for **Named Connection**, and select **SchoolEntities** as the **DefaultContainerName** value.</span></span> <span data-ttu-id="5bfcc-133">Em seguida, clique em **Próximo**.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-133">Then click **Next**.</span></span>

<span data-ttu-id="5bfcc-134">[![Image02](the-entity-framework-and-aspnet-getting-started-part-2/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-134">[![Image02](the-entity-framework-and-aspnet-getting-started-part-2/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image13.png)</span></span>

<span data-ttu-id="5bfcc-135">Observação: se você receber a seguinte caixa de diálogo neste ponto, precisará compilar o projeto antes de continuar.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-135">Note: If you get the following dialog box at this point, you have to build the project before proceeding.</span></span>

<span data-ttu-id="5bfcc-136">[![Image25](the-entity-framework-and-aspnet-getting-started-part-2/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-136">[![Image25](the-entity-framework-and-aspnet-getting-started-part-2/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image15.png)</span></span>

<span data-ttu-id="5bfcc-137">Na etapa **Configurar seleção de dados** , selecione **pessoas** como o valor de **EntitySetName**.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-137">In the **Configure Data Selection** step, select **People** as the value for **EntitySetName**.</span></span> <span data-ttu-id="5bfcc-138">Em **selecionar**, verifique se a caixa de seleção **selecionar uma** ll está marcada.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-138">Under **Select**, make sure the **Select A** ll check box is selected.</span></span> <span data-ttu-id="5bfcc-139">Em seguida, selecione as opções para habilitar atualizar e excluir.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-139">Then select the options to enable update and delete.</span></span> <span data-ttu-id="5bfcc-140">Quando terminar, clique em **concluir**.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-140">When you're done, click **Finish**.</span></span>

<span data-ttu-id="5bfcc-141">[![Image03](the-entity-framework-and-aspnet-getting-started-part-2/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-141">[![Image03](the-entity-framework-and-aspnet-getting-started-part-2/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image17.png)</span></span>

## <a name="configuring-database-rules-to-allow-deletion"></a><span data-ttu-id="5bfcc-142">Configurando regras de banco de dados para permitir a exclusão</span><span class="sxs-lookup"><span data-stu-id="5bfcc-142">Configuring Database Rules to Allow Deletion</span></span>

<span data-ttu-id="5bfcc-143">Você criará uma página que permite aos usuários excluir alunos da tabela `Person`, que tem três relações com outras tabelas (`Course`, `StudentGrade`e `OfficeAssignment`).</span><span class="sxs-lookup"><span data-stu-id="5bfcc-143">You'll be creating a page that lets users delete students from the `Person` table, which has three relationships with other tables (`Course`, `StudentGrade`, and `OfficeAssignment`).</span></span> <span data-ttu-id="5bfcc-144">Por padrão, o banco de dados impedirá que você exclua uma linha em `Person` se houver linhas relacionadas em uma das outras tabelas.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-144">By default, the database will prevent you from deleting a row in `Person` if there are related rows in one of the other tables.</span></span> <span data-ttu-id="5bfcc-145">Você pode excluir manualmente as linhas relacionadas primeiro ou pode configurar o banco de dados para excluí-las automaticamente quando você exclui uma linha de `Person`.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-145">You can manually delete the related rows first, or you can configure the database to delete them automatically when you delete a `Person` row.</span></span> <span data-ttu-id="5bfcc-146">Para os registros de aluno deste tutorial, você configurará o banco de dados para excluir automaticamente os dados relacionados.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-146">For student records in this tutorial, you'll configure the database to delete the related data automatically.</span></span> <span data-ttu-id="5bfcc-147">Como os alunos podem ter linhas relacionadas apenas na tabela `StudentGrade`, você precisa configurar apenas uma das três relações.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-147">Because students can have related rows only in the `StudentGrade` table, you need to configure only one of the three relationships.</span></span>

<span data-ttu-id="5bfcc-148">Se você estiver usando o arquivo *School. MDF* que você baixou do projeto que acompanha este tutorial, poderá ignorar esta seção porque essas alterações de configuração já foram feitas.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-148">If you're using the *School.mdf* file that you downloaded from the project that goes with this tutorial, you can skip this section because these configuration changes have already been done.</span></span> <span data-ttu-id="5bfcc-149">Se você criou o banco de dados executando um script, configure o banco de dados executando os procedimentos a seguir.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-149">If you created the database by running a script, configure the database by performing the following procedures.</span></span>

<span data-ttu-id="5bfcc-150">No **Gerenciador de servidores**, abra o diagrama de banco de dados que você criou na parte 1.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-150">In **Server Explorer**, open the database diagram that you created in part 1.</span></span> <span data-ttu-id="5bfcc-151">Clique com o botão direito do mouse na relação entre `Person` e `StudentGrade` (a linha entre as tabelas) e selecione **Propriedades**.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-151">Right-click the relationship between `Person` and `StudentGrade` (the line between tables), and then select **Properties**.</span></span>

<span data-ttu-id="5bfcc-152">[![Image04](the-entity-framework-and-aspnet-getting-started-part-2/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-152">[![Image04](the-entity-framework-and-aspnet-getting-started-part-2/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image19.png)</span></span>

<span data-ttu-id="5bfcc-153">Na janela **Propriedades** , expanda **especificação INSERT e Update** e defina a propriedade **DeleteRule** como **Cascade**.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-153">In the **Properties** window, expand **INSERT and UPDATE Specification** and set the **DeleteRule** property to **Cascade**.</span></span>

<span data-ttu-id="5bfcc-154">[![Image05](the-entity-framework-and-aspnet-getting-started-part-2/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-154">[![Image05](the-entity-framework-and-aspnet-getting-started-part-2/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image21.png)</span></span>

<span data-ttu-id="5bfcc-155">Salve e feche o diagrama.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-155">Save and close the diagram.</span></span> <span data-ttu-id="5bfcc-156">Se você for perguntado se deseja atualizar o banco de dados, clique em **Sim**.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-156">If you're asked whether you want to update the database, click **Yes**.</span></span>

<span data-ttu-id="5bfcc-157">Para certificar-se de que o modelo Mantenha as entidades que estão na memória sincronizadas com o que o banco de dados está fazendo, você deve definir as regras correspondentes no modelo de dado.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-157">To make sure that the model keeps entities that are in memory in sync with what the database is doing, you must set corresponding rules in the data model.</span></span> <span data-ttu-id="5bfcc-158">Abra *SchoolModel. edmx*, clique com o botão direito do mouse na linha de associação entre `Person` e `StudentGrade`e, em seguida, selecione **Propriedades**.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-158">Open *SchoolModel.edmx*, right-click the association line between `Person` and `StudentGrade`, and then select **Properties**.</span></span>

<span data-ttu-id="5bfcc-159">[![Image21](the-entity-framework-and-aspnet-getting-started-part-2/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-159">[![Image21](the-entity-framework-and-aspnet-getting-started-part-2/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image23.png)</span></span>

<span data-ttu-id="5bfcc-160">Na janela **Propriedades** , defina **End1 OnDelete** para **Cascade**.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-160">In the **Properties** window, set **End1 OnDelete** to **Cascade**.</span></span>

<span data-ttu-id="5bfcc-161">[![Image22](the-entity-framework-and-aspnet-getting-started-part-2/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-161">[![Image22](the-entity-framework-and-aspnet-getting-started-part-2/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image25.png)</span></span>

<span data-ttu-id="5bfcc-162">Salve e feche o arquivo *SchoolModel. edmx* e recompile o projeto.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-162">Save and close the *SchoolModel.edmx* file, and then rebuild the project.</span></span>

<span data-ttu-id="5bfcc-163">Em geral, quando o banco de dados é alterado, você tem várias opções de como sincronizar o modelo:</span><span class="sxs-lookup"><span data-stu-id="5bfcc-163">In general, when the database changes, you have several choices for how to sync up the model:</span></span>

- <span data-ttu-id="5bfcc-164">Para determinados tipos de alterações (como adicionar ou atualizar tabelas, exibições ou procedimentos armazenados), clique com o botão direito do mouse no designer e selecione **atualizar modelo do banco de dados** para fazer com que o designer faça as alterações automaticamente.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-164">For certain kinds of changes (such as adding or refreshing tables, views, or stored procedures), right-click in the designer and select **Update Model from Database** to have the designer make the changes automatically.</span></span>
- <span data-ttu-id="5bfcc-165">Gere novamente o modelo de dados.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-165">Regenerate the data model.</span></span>
- <span data-ttu-id="5bfcc-166">Faça atualizações manuais como esta.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-166">Make manual updates like this one.</span></span>

<span data-ttu-id="5bfcc-167">Nesse caso, você poderia ter regenerado o modelo ou atualizado as tabelas afetadas pela alteração de relação, mas, em seguida, você precisaria fazer com que o nome do campo seja alterado novamente (de `FirstName` para `FirstMidName`).</span><span class="sxs-lookup"><span data-stu-id="5bfcc-167">In this case, you could have regenerated the model or refreshed the tables affected by the relationship change, but then you'd have to make the field-name change again (from `FirstName` to `FirstMidName`).</span></span>

## <a name="using-a-gridview-control-to-read-and-update-entities"></a><span data-ttu-id="5bfcc-168">Usando um controle GridView para ler e atualizar entidades</span><span class="sxs-lookup"><span data-stu-id="5bfcc-168">Using a GridView Control to Read and Update Entities</span></span>

<span data-ttu-id="5bfcc-169">Nesta seção, você usará um controle de `GridView` para exibir, atualizar ou excluir alunos.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-169">In this section you'll use a `GridView` control to display, update, or delete students.</span></span>

<span data-ttu-id="5bfcc-170">Abra ou alterne para *students. aspx* e alterne para o modo de exibição de **design** .</span><span class="sxs-lookup"><span data-stu-id="5bfcc-170">Open or switch to *Students.aspx* and switch to **Design** view.</span></span> <span data-ttu-id="5bfcc-171">Na guia **dados** da caixa de **ferramentas**, arraste um controle `GridView` à direita do controle `EntityDataSource`, nomeie-o `StudentsGridView`, clique na marca inteligente e, em seguida, selecione **StudentsEntityDataSource** como a fonte de dados.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-171">From the **Data** tab of the **Toolbox**, drag a `GridView` control to the right of the `EntityDataSource` control, name it `StudentsGridView`, click the smart tag, and then select **StudentsEntityDataSource** as the data source.</span></span>

<span data-ttu-id="5bfcc-172">[![Image06](the-entity-framework-and-aspnet-getting-started-part-2/_static/image28.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-172">[![Image06](the-entity-framework-and-aspnet-getting-started-part-2/_static/image28.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image27.png)</span></span>

<span data-ttu-id="5bfcc-173">Clique em **Atualizar esquema** (clique em **Sim** se for solicitado a confirmar), clique em **habilitar paginação**, **Habilitar classificação**, **Habilitar edição**e **Habilitar exclusão**.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-173">Click **Refresh Schema** (click **Yes** if you're prompted to confirm), then click **Enable Paging**, **Enable Sorting**, **Enable Editing**, and **Enable Deleting**.</span></span>

<span data-ttu-id="5bfcc-174">Clique em **Editar colunas**.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-174">Click **Edit Columns**.</span></span>

<span data-ttu-id="5bfcc-175">[![Image10](the-entity-framework-and-aspnet-getting-started-part-2/_static/image30.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-175">[![Image10](the-entity-framework-and-aspnet-getting-started-part-2/_static/image30.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image29.png)</span></span>

<span data-ttu-id="5bfcc-176">Na caixa **campos selecionados** , exclua **PersonID**, **LastName**e **HireDate**.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-176">In the **Selected fields** box, delete **PersonID**, **LastName**, and **HireDate**.</span></span> <span data-ttu-id="5bfcc-177">Normalmente, você não exibe uma chave de registro para os usuários, a data de contratação não é relevante para os alunos e você colocará as duas partes do nome em um campo, portanto, você precisa apenas de um dos campos de nome.)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-177">You typically don't display a record key to users, hire date is not relevant to students, and you'll put both parts of the name in one field, so you only need one of the name fields.)</span></span>

<span data-ttu-id="5bfcc-178">[![Image11](the-entity-framework-and-aspnet-getting-started-part-2/_static/image32.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-178">[![Image11](the-entity-framework-and-aspnet-getting-started-part-2/_static/image32.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image31.png)</span></span>

<span data-ttu-id="5bfcc-179">Selecione o campo **FirstMidName** e, em seguida, clique em **converter este campo em um TemplateField**.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-179">Select the **FirstMidName** field and then click **Convert this field into a TemplateField**.</span></span>

<span data-ttu-id="5bfcc-180">Faça o mesmo para **EnrollmentDate**.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-180">Do the same for **EnrollmentDate**.</span></span>

<span data-ttu-id="5bfcc-181">[![Image13](the-entity-framework-and-aspnet-getting-started-part-2/_static/image34.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-181">[![Image13](the-entity-framework-and-aspnet-getting-started-part-2/_static/image34.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image33.png)</span></span>

<span data-ttu-id="5bfcc-182">Clique em **OK** e alterne para o modo de exibição de **código-fonte** .</span><span class="sxs-lookup"><span data-stu-id="5bfcc-182">Click **OK** and then switch to **Source** view.</span></span> <span data-ttu-id="5bfcc-183">As alterações restantes serão mais fáceis de fazer diretamente na marcação.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-183">The remaining changes will be easier to do directly in markup.</span></span> <span data-ttu-id="5bfcc-184">A marcação de controle de `GridView` agora é semelhante ao exemplo a seguir.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-184">The `GridView` control markup now looks like the following example.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample3.aspx)]

<span data-ttu-id="5bfcc-185">A primeira coluna após o campo de comando é um campo de modelo que atualmente exibe o nome.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-185">The first column after the command field is a template field that currently displays the first name.</span></span> <span data-ttu-id="5bfcc-186">Altere a marcação para este campo de modelo para que se pareça com o exemplo a seguir:</span><span class="sxs-lookup"><span data-stu-id="5bfcc-186">Change the markup for this template field to look like the following example:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample4.aspx)]

<span data-ttu-id="5bfcc-187">No modo de exibição, dois controles de `Label` exibem o nome e o sobrenome.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-187">In display mode, two `Label` controls display the first and last name.</span></span> <span data-ttu-id="5bfcc-188">No modo de edição, são fornecidas duas caixas de texto para que você possa alterar o nome e o sobrenome.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-188">In edit mode, two text boxes are provided so you can change the first and last name.</span></span> <span data-ttu-id="5bfcc-189">Assim como com os controles de `Label` no modo de exibição, você usa `Bind` e `Eval` expressões exatamente como faria com controles de fonte de dados ASP.NET que se conectam diretamente aos bancos de dado.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-189">As with the `Label` controls in display mode, you use `Bind` and `Eval` expressions exactly as you would with ASP.NET data source controls that connect directly to databases.</span></span> <span data-ttu-id="5bfcc-190">A única diferença é que você está especificando propriedades de entidade em vez de colunas de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-190">The only difference is that you're specifying entity properties instead of database columns.</span></span>

<span data-ttu-id="5bfcc-191">A última coluna é um campo de modelo que exibe a data de registro.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-191">The last column is a template field that displays the enrollment date.</span></span> <span data-ttu-id="5bfcc-192">Altere a marcação para este campo para que fique semelhante ao exemplo a seguir:</span><span class="sxs-lookup"><span data-stu-id="5bfcc-192">Change the markup for this field to look like the following example:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample5.aspx)]

<span data-ttu-id="5bfcc-193">No modo de exibição e de edição, a cadeia de caracteres de formato "{0, d}" faz com que a data seja exibida no formato "data abreviada".</span><span class="sxs-lookup"><span data-stu-id="5bfcc-193">In both display and edit mode, the format string "{0,d}" causes the date to be displayed in the "short date" format.</span></span> <span data-ttu-id="5bfcc-194">(Seu computador pode estar configurado para exibir esse formato de forma diferente das imagens de tela mostradas neste tutorial.)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-194">(Your computer might be configured to display this format differently from the screen images shown in this tutorial.)</span></span>

<span data-ttu-id="5bfcc-195">Observe que em cada um desses campos de modelo, o designer usou uma expressão de `Bind` por padrão, mas você alterou isso para uma expressão de `Eval` nos elementos de `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-195">Notice that in each of these template fields, the designer used a `Bind` expression by default, but you've changed that to an `Eval` expression in the `ItemTemplate` elements.</span></span> <span data-ttu-id="5bfcc-196">A expressão `Bind` torna os dados disponíveis em Propriedades de controle de `GridView`, caso você precise acessar os dados no código.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-196">The `Bind` expression makes the data available in `GridView` control properties in case you need to access the data in code.</span></span> <span data-ttu-id="5bfcc-197">Nesta página, você não precisa acessar esses dados no código para poder usar `Eval`, o que é mais eficiente.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-197">In this page you don't need to access this data in code, so you can use `Eval`, which is more efficient.</span></span> <span data-ttu-id="5bfcc-198">Para obter mais informações, consulte [obtendo seus dados dos controles de dados](https://weblogs.asp.net/davidfowler/archive/2008/12/12/getting-your-data-out-of-the-data-controls.aspx).</span><span class="sxs-lookup"><span data-stu-id="5bfcc-198">For more information, see [Getting your data out of the data controls](https://weblogs.asp.net/davidfowler/archive/2008/12/12/getting-your-data-out-of-the-data-controls.aspx).</span></span>

## <a name="revising-entitydatasource-control-markup-to-improve-performance"></a><span data-ttu-id="5bfcc-199">Revisando marcação de controle de EntityDataSource para melhorar o desempenho</span><span class="sxs-lookup"><span data-stu-id="5bfcc-199">Revising EntityDataSource Control Markup to Improve Performance</span></span>

<span data-ttu-id="5bfcc-200">Na marcação para o controle de `EntityDataSource`, remova os atributos `ConnectionString` e `DefaultContainerName` e substitua-os por um atributo `ContextTypeName="ContosoUniversity.DAL.SchoolEntities"`.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-200">In the markup for the `EntityDataSource` control, remove the `ConnectionString` and `DefaultContainerName` attributes and replace them with a `ContextTypeName="ContosoUniversity.DAL.SchoolEntities"` attribute.</span></span> <span data-ttu-id="5bfcc-201">Essa é uma alteração que você deve fazer sempre que criar um controle de `EntityDataSource`, a menos que você precise usar uma conexão diferente da que é embutida em código na classe de contexto de objeto.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-201">This is a change you should make every time you create an `EntityDataSource` control, unless you need to use a connection that is different from the one that's hard-coded in the object context class.</span></span> <span data-ttu-id="5bfcc-202">O uso do atributo `ContextTypeName` fornece os seguintes benefícios:</span><span class="sxs-lookup"><span data-stu-id="5bfcc-202">Using the `ContextTypeName` attribute provides the following benefits:</span></span>

- <span data-ttu-id="5bfcc-203">Melhor desempenho.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-203">Better performance.</span></span> <span data-ttu-id="5bfcc-204">Quando o controle de `EntityDataSource` Inicializa o modelo de dados usando os atributos `ConnectionString` e `DefaultContainerName`, ele executa trabalho adicional para carregar metadados em cada solicitação.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-204">When the `EntityDataSource` control initializes the data model using the `ConnectionString` and `DefaultContainerName` attributes, it performs additional work to load metadata on every request.</span></span> <span data-ttu-id="5bfcc-205">Isso não será necessário se você especificar o atributo `ContextTypeName`.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-205">This isn't necessary if you specify the `ContextTypeName` attribute.</span></span>
- <span data-ttu-id="5bfcc-206">O carregamento lento é ativado por padrão nas classes de contexto de objeto gerado (como `SchoolEntities` neste tutorial) em Entity Framework 4,0.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-206">Lazy loading is turned on by default in generated object context classes (such as `SchoolEntities` in this tutorial) in Entity Framework 4.0.</span></span> <span data-ttu-id="5bfcc-207">Isso significa que as propriedades de navegação são carregadas com os dados relacionados automaticamente quando você precisar.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-207">This means that navigation properties are loaded with related data automatically right when you need it.</span></span> <span data-ttu-id="5bfcc-208">O carregamento lento é explicado em mais detalhes posteriormente neste tutorial.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-208">Lazy loading is explained in more detail later in this tutorial.</span></span>
- <span data-ttu-id="5bfcc-209">Todas as personalizações que você aplicou à classe de contexto de objeto (nesse caso, a classe `SchoolEntities`) estarão disponíveis para controles que usam o controle `EntityDataSource`.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-209">Any customizations that you've applied to the object context class (in this case, the `SchoolEntities` class) will be available to controls that use the `EntityDataSource` control.</span></span> <span data-ttu-id="5bfcc-210">A personalização da classe de contexto de objeto é um tópico avançado que não é abordado nesta série de tutoriais.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-210">Customizing the object context class is an advanced topic that is not covered in this tutorial series.</span></span> <span data-ttu-id="5bfcc-211">Para obter mais informações, consulte [Estendendo Entity Framework tipos gerados](https://msdn.microsoft.com/library/dd456844.aspx).</span><span class="sxs-lookup"><span data-stu-id="5bfcc-211">For more information, see [Extending Entity Framework Generated Types](https://msdn.microsoft.com/library/dd456844.aspx).</span></span>

<span data-ttu-id="5bfcc-212">A marcação agora será semelhante ao exemplo a seguir (a ordem das propriedades pode ser diferente):</span><span class="sxs-lookup"><span data-stu-id="5bfcc-212">The markup will now resemble the following example (the order of the properties might be different):</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample6.aspx)]

<span data-ttu-id="5bfcc-213">O atributo `EnableFlattening` refere-se a um recurso que era necessário em versões anteriores do Entity Framework porque as colunas de chave estrangeira não eram expostas como propriedades de entidade.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-213">The `EnableFlattening` attribute refers to a feature that was needed in earlier versions of the Entity Framework because foreign key columns were not exposed as entity properties.</span></span> <span data-ttu-id="5bfcc-214">A versão atual torna possível usar associações de *chave estrangeira*, o que significa que as propriedades de chave estrangeira são expostas para todas as associações, exceto muitos para muitos.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-214">The current version makes it possible to use *foreign key associations*, which means foreign key properties are exposed for all but many-to-many associations.</span></span> <span data-ttu-id="5bfcc-215">Se suas entidades tiverem Propriedades de chave estrangeira e nenhum [tipo complexo](https://msdn.microsoft.com/library/bb738472.aspx), você poderá deixar esse atributo definido como `False`.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-215">If your entities have foreign key properties and no [complex types](https://msdn.microsoft.com/library/bb738472.aspx), you can leave this attribute set to `False`.</span></span> <span data-ttu-id="5bfcc-216">Não remova o atributo da marcação, pois o valor padrão é `True`.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-216">Don't remove the attribute from the markup, because the default value is `True`.</span></span> <span data-ttu-id="5bfcc-217">Para obter mais informações, consulte [objetos de achatamento (EntityDataSource)](https://msdn.microsoft.com/library/ee404746.aspx).</span><span class="sxs-lookup"><span data-stu-id="5bfcc-217">For more information, see [Flattening Objects (EntityDataSource)](https://msdn.microsoft.com/library/ee404746.aspx).</span></span>

<span data-ttu-id="5bfcc-218">Execute a página e você verá uma lista de alunos e funcionários (você filtrará apenas para estudantes no próximo tutorial).</span><span class="sxs-lookup"><span data-stu-id="5bfcc-218">Run the page and you see a list of students and employees (you'll filter for just students in the next tutorial).</span></span> <span data-ttu-id="5bfcc-219">O nome e o sobrenome são exibidos juntos.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-219">The first name and last name are displayed together.</span></span>

<span data-ttu-id="5bfcc-220">[![Image07](the-entity-framework-and-aspnet-getting-started-part-2/_static/image36.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-220">[![Image07](the-entity-framework-and-aspnet-getting-started-part-2/_static/image36.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image35.png)</span></span>

<span data-ttu-id="5bfcc-221">Para classificar a exibição, clique em um nome de coluna.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-221">To sort the display, click a column name.</span></span>

<span data-ttu-id="5bfcc-222">Clique em **Editar** em qualquer linha.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-222">Click **Edit** in any row.</span></span> <span data-ttu-id="5bfcc-223">São exibidas caixas de texto onde você pode alterar o nome e o sobrenome.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-223">Text boxes are displayed where you can change the first and last name.</span></span>

<span data-ttu-id="5bfcc-224">[![Image08](the-entity-framework-and-aspnet-getting-started-part-2/_static/image38.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-224">[![Image08](the-entity-framework-and-aspnet-getting-started-part-2/_static/image38.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image37.png)</span></span>

<span data-ttu-id="5bfcc-225">O botão **excluir** também funciona.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-225">The **Delete** button also works.</span></span> <span data-ttu-id="5bfcc-226">Clique em Excluir para uma linha que tenha uma data de registro e a linha desaparece.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-226">Click delete for a row that has an enrollment date and the row disappears.</span></span> <span data-ttu-id="5bfcc-227">(As linhas sem uma data de registro representam instrutores e você pode obter um erro de integridade referencial.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-227">(Rows without an enrollment date represent instructors and you may get a referential integrity error.</span></span> <span data-ttu-id="5bfcc-228">No próximo tutorial, você filtrará essa lista para incluir apenas alunos.)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-228">In the next tutorial you'll filter this list to include just students.)</span></span>

## <a name="displaying-data-from-a-navigation-property"></a><span data-ttu-id="5bfcc-229">Exibindo dados de uma propriedade de navegação</span><span class="sxs-lookup"><span data-stu-id="5bfcc-229">Displaying Data from a Navigation Property</span></span>

<span data-ttu-id="5bfcc-230">Agora suponha que você deseja saber quantos cursos cada aluno está inscrito.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-230">Now suppose you want to know how many courses each student is enrolled in.</span></span> <span data-ttu-id="5bfcc-231">O Entity Framework fornece essas informações na propriedade de navegação `StudentGrades` da entidade `Person`.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-231">The Entity Framework provides that information in the `StudentGrades` navigation property of the `Person` entity.</span></span> <span data-ttu-id="5bfcc-232">Como o design do banco de dados não permite que um aluno seja registrado em um curso sem ter uma classificação atribuída, para este tutorial, você pode pressupor que ter uma linha na linha da tabela `StudentGrade` associada a um curso seja o mesmo que está sendo registrado no curso.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-232">Because the database design does not allow a student to be enrolled in a course without having a grade assigned, for this tutorial you can assume that having a row in the `StudentGrade` table row that is associated with a course is the same as being enrolled in the course.</span></span> <span data-ttu-id="5bfcc-233">(A propriedade de navegação `Courses` é apenas para instrutores.)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-233">(The `Courses` navigation property is only for instructors.)</span></span>

<span data-ttu-id="5bfcc-234">Quando você usa o atributo `ContextTypeName` do controle `EntityDataSource`, o Entity Framework recupera automaticamente as informações de uma propriedade de navegação quando você acessa essa propriedade.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-234">When you use the `ContextTypeName` attribute of the `EntityDataSource` control, the Entity Framework automatically retrieves information for a navigation property when you access that property.</span></span> <span data-ttu-id="5bfcc-235">Isso é chamado de *carregamento lento*.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-235">This is called *lazy loading*.</span></span> <span data-ttu-id="5bfcc-236">No entanto, isso pode ser ineficiente, pois resulta em uma chamada separada para o banco de dados toda vez que forem necessárias informações adicionais.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-236">However, this can be inefficient, because it results in a separate call to the database each time additional information is needed.</span></span> <span data-ttu-id="5bfcc-237">Se você precisar de dados da propriedade de navegação para cada entidade retornada pelo controle de `EntityDataSource`, será mais eficiente recuperar os dados relacionados junto com a própria entidade em uma única chamada para o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-237">If you need data from the navigation property for every entity returned by the `EntityDataSource` control, it's more efficient to retrieve the related data along with the entity itself in a single call to the database.</span></span> <span data-ttu-id="5bfcc-238">Isso é chamado de *carregamento adiantado*e você especifica o carregamento adiantado para uma propriedade de navegação definindo a propriedade `Include` do controle de `EntityDataSource`.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-238">This is called *eager loading*, and you specify eager loading for a navigation property by setting the `Include` property of the `EntityDataSource` control.</span></span>

<span data-ttu-id="5bfcc-239">Em *students. aspx*, você deseja mostrar o número de cursos para cada aluno, portanto, o carregamento adiantado é a melhor opção.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-239">In *Students.aspx*, you want to show the number of courses for every student, so eager loading is the best choice.</span></span> <span data-ttu-id="5bfcc-240">Se você estivesse exibindo todos os alunos, mas mostrando o número de cursos apenas para alguns deles (o que exigiria escrever algum código além da marcação), o carregamento lento pode ser uma opção melhor.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-240">If you were displaying all students but showing the number of courses only for a few of them (which would require writing some code in addition to the markup), lazy loading might be a better choice.</span></span>

<span data-ttu-id="5bfcc-241">Abra ou alterne para *students. aspx*, alterne para o modo **Design** , selecione `StudentsEntityDataSource`e, na janela **Propriedades** , defina a propriedade **include** como **StudentGrades**.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-241">Open or switch to *Students.aspx*, switch to **Design** view, select `StudentsEntityDataSource`, and in the **Properties** window set the **Include** property to **StudentGrades**.</span></span> <span data-ttu-id="5bfcc-242">(Se você quisesse obter várias propriedades de navegação, poderia especificar seus nomes separados por vírgulas — por exemplo, **StudentGrades, cursos**.)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-242">(If you wanted to get multiple navigation properties, you could specify their names separated by commas — for example, **StudentGrades, Courses**.)</span></span>

<span data-ttu-id="5bfcc-243">[![Image19](the-entity-framework-and-aspnet-getting-started-part-2/_static/image40.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image39.png)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-243">[![Image19](the-entity-framework-and-aspnet-getting-started-part-2/_static/image40.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image39.png)</span></span>

<span data-ttu-id="5bfcc-244">Alternar para o modo de exibição de **código-fonte** .</span><span class="sxs-lookup"><span data-stu-id="5bfcc-244">Switch to **Source** view.</span></span> <span data-ttu-id="5bfcc-245">No controle `StudentsGridView`, após o último elemento `asp:TemplateField`, adicione o novo campo de modelo a seguir:</span><span class="sxs-lookup"><span data-stu-id="5bfcc-245">In the `StudentsGridView` control, after the last `asp:TemplateField` element, add the following new template field:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample7.aspx)]

<span data-ttu-id="5bfcc-246">Na expressão `Eval`, você pode referenciar a propriedade de navegação `StudentGrades`.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-246">In the `Eval` expression, you can reference the navigation property `StudentGrades`.</span></span> <span data-ttu-id="5bfcc-247">Como essa propriedade contém uma coleção, ela tem uma propriedade `Count` que você pode usar para exibir o número de cursos nos quais o aluno está registrado.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-247">Because this property contains a collection, it has a `Count` property that you can use to display the number of courses in which the student is enrolled.</span></span> <span data-ttu-id="5bfcc-248">Em um tutorial posterior, você verá como exibir dados de propriedades de navegação que contêm entidades únicas em vez de coleções.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-248">In a later tutorial you'll see how to display data from navigation properties that contain single entities instead of collections.</span></span> <span data-ttu-id="5bfcc-249">(Observe que você não pode usar elementos de `BoundField` para exibir dados de propriedades de navegação.)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-249">(Note that you cannot use `BoundField` elements to display data from navigation properties.)</span></span>

<span data-ttu-id="5bfcc-250">Execute a página e agora você verá quantos cursos cada aluno está inscrito.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-250">Run the page and you now see how many courses each student is enrolled in.</span></span>

<span data-ttu-id="5bfcc-251">[![Image20](the-entity-framework-and-aspnet-getting-started-part-2/_static/image42.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image41.png)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-251">[![Image20](the-entity-framework-and-aspnet-getting-started-part-2/_static/image42.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image41.png)</span></span>

## <a name="using-a-detailsview-control-to-insert-entities"></a><span data-ttu-id="5bfcc-252">Usando um controle DetailsView para inserir entidades</span><span class="sxs-lookup"><span data-stu-id="5bfcc-252">Using a DetailsView Control to Insert Entities</span></span>

<span data-ttu-id="5bfcc-253">A próxima etapa é criar uma página que tenha um controle de `DetailsView` que permitirá que você adicione novos alunos.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-253">The next step is to create a page that has a `DetailsView` control that will let you add new students.</span></span> <span data-ttu-id="5bfcc-254">Feche o navegador e crie uma nova página da Web usando a página mestra *site. Master* .</span><span class="sxs-lookup"><span data-stu-id="5bfcc-254">Close the browser and then create a new web page using the *Site.Master* master page.</span></span> <span data-ttu-id="5bfcc-255">Nomeie a página *StudentsAdd. aspx*e, em seguida, alterne para o modo de exibição de **código-fonte** .</span><span class="sxs-lookup"><span data-stu-id="5bfcc-255">Name the page *StudentsAdd.aspx*, and then switch to **Source** view.</span></span>

<span data-ttu-id="5bfcc-256">Adicione a marcação a seguir para substituir a marcação existente para o controle de `Content` chamado `Content2`:</span><span class="sxs-lookup"><span data-stu-id="5bfcc-256">Add the following markup to replace the existing markup for the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample8.aspx)]

<span data-ttu-id="5bfcc-257">Essa marcação cria um controle de `EntityDataSource` semelhante ao que você criou no *students. aspx*, exceto pelo fato de que permite a inserção.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-257">This markup creates an `EntityDataSource` control that is similar to the one you created in *Students.aspx*, except it enables insertion.</span></span> <span data-ttu-id="5bfcc-258">Assim como com o controle de `GridView`, os campos associados do controle de `DetailsView` são codificados exatamente como seriam para um controle de dados que se conecta diretamente a um banco, exceto que eles fazem referência a propriedades de entidade.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-258">As with the `GridView` control, the bound fields of the `DetailsView` control are coded exactly as they would be for a data control that connects directly to a database, except that they reference entity properties.</span></span> <span data-ttu-id="5bfcc-259">Nesse caso, o controle de `DetailsView` é usado apenas para inserir linhas, de modo que você definiu o modo padrão como `Insert`.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-259">In this case, the `DetailsView` control is used only for inserting rows, so you have set the default mode to `Insert`.</span></span>

<span data-ttu-id="5bfcc-260">Execute a página e adicione um novo aluno.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-260">Run the page and add a new student.</span></span>

<span data-ttu-id="5bfcc-261">[![Image09](the-entity-framework-and-aspnet-getting-started-part-2/_static/image44.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-261">[![Image09](the-entity-framework-and-aspnet-getting-started-part-2/_static/image44.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image43.png)</span></span>

<span data-ttu-id="5bfcc-262">Nada acontecerá depois que você inserir um novo aluno, mas se você executar o Student *. aspx*, você verá as informações do novo aluno.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-262">Nothing will happen after you insert a new student, but if you now run *Students.aspx*, you'll see the new student information.</span></span>

## <a name="displaying-data-in-a-drop-down-list"></a><span data-ttu-id="5bfcc-263">Exibindo dados em uma lista suspensa</span><span class="sxs-lookup"><span data-stu-id="5bfcc-263">Displaying Data in a Drop-Down List</span></span>

<span data-ttu-id="5bfcc-264">Nas etapas a seguir, você associará um controle de `DropDownList` a um conjunto de entidades usando um controle de `EntityDataSource`.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-264">In the following steps you'll databind a `DropDownList` control to an entity set using an `EntityDataSource` control.</span></span> <span data-ttu-id="5bfcc-265">Nesta parte do tutorial, você não fará muito com essa lista.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-265">In this part of the tutorial, you won't do much with this list.</span></span> <span data-ttu-id="5bfcc-266">Em partes subsequentes, no entanto, você usará a lista para permitir que os usuários selecionem um departamento para exibir os cursos associados ao departamento.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-266">In subsequent parts, though, you'll use the list to let users select a department to display courses associated with the department.</span></span>

<span data-ttu-id="5bfcc-267">Crie uma nova página da Web chamada *courses. aspx*.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-267">Create a new web page named *Courses.aspx*.</span></span> <span data-ttu-id="5bfcc-268">No modo de exibição de **origem** , adicione um título ao controle de `Content` chamado `Content2`:</span><span class="sxs-lookup"><span data-stu-id="5bfcc-268">In **Source** view, add a heading to the `Content` control that's named `Content2`:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample9.aspx)]

<span data-ttu-id="5bfcc-269">No modo **design** , adicione um controle de `EntityDataSource` à página como fazia antes, exceto por esse tempo, com o nome `DepartmentsEntityDataSource`.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-269">In **Design** view, add an `EntityDataSource` control to the page as you did before, except this time name it `DepartmentsEntityDataSource`.</span></span> <span data-ttu-id="5bfcc-270">Selecione **departamentos** como o valor **EntitySetName** e selecione apenas as propriedades **DepartmentID** e **Name** .</span><span class="sxs-lookup"><span data-stu-id="5bfcc-270">Select **Departments** as the **EntitySetName** value, and select only the **DepartmentID** and **Name** properties.</span></span>

<span data-ttu-id="5bfcc-271">[![Image15](the-entity-framework-and-aspnet-getting-started-part-2/_static/image46.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image45.png)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-271">[![Image15](the-entity-framework-and-aspnet-getting-started-part-2/_static/image46.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image45.png)</span></span>

<span data-ttu-id="5bfcc-272">Na guia **padrão** da caixa de **ferramentas**, arraste um controle `DropDownList` para a página, nomeie-o `DepartmentsDropDownList`, clique na marca inteligente e selecione **escolher fonte de dados** para iniciar o **Assistente de configuração de DataSource**.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-272">From the **Standard** tab of the **Toolbox**, drag a `DropDownList` control to the page, name it `DepartmentsDropDownList`, click the smart tag, and select **Choose Data Source** to start the **DataSource Configuration Wizard**.</span></span>

<span data-ttu-id="5bfcc-273">[![Image16](the-entity-framework-and-aspnet-getting-started-part-2/_static/image48.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image47.png)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-273">[![Image16](the-entity-framework-and-aspnet-getting-started-part-2/_static/image48.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image47.png)</span></span>

<span data-ttu-id="5bfcc-274">Na etapa **escolher uma fonte de dados** , selecione **DepartmentsEntityDataSource** como a fonte de dados, clique em **Atualizar esquema**e, em seguida, selecione **nome** como o campo de dados a ser exibido e **DepartmentID** como o campo de dados de valor.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-274">In the **Choose a Data Source** step, select **DepartmentsEntityDataSource** as the data source, click **Refresh Schema**, and then select **Name** as the data field to display and **DepartmentID** as the value data field.</span></span> <span data-ttu-id="5bfcc-275">Clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-275">Click **OK**.</span></span>

<span data-ttu-id="5bfcc-276">[![Image17](the-entity-framework-and-aspnet-getting-started-part-2/_static/image50.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image49.png)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-276">[![Image17](the-entity-framework-and-aspnet-getting-started-part-2/_static/image50.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image49.png)</span></span>

<span data-ttu-id="5bfcc-277">O método usado para associar o controle usando o Entity Framework é o mesmo que com outros controles de fonte de dados ASP.NET, exceto que você está especificando entidades e propriedades de entidade.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-277">The method you use to databind the control using the Entity Framework is the same as with other ASP.NET data source controls except you're specifying entities and entity properties.</span></span>

<span data-ttu-id="5bfcc-278">Alterne para o modo de exibição de **origem** e adicione "selecionar um departamento:" imediatamente antes do controle de `DropDownList`.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-278">Switch to **Source** view and add "Select a department:" immediately before the `DropDownList` control.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample10.aspx)]

<span data-ttu-id="5bfcc-279">Como lembrete, altere a marcação para o controle de `EntityDataSource` neste ponto substituindo os atributos `ConnectionString` e `DefaultContainerName` por um atributo `ContextTypeName="ContosoUniversity.DAL.SchoolEntities"`.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-279">As a reminder, change the markup for the `EntityDataSource` control at this point by replacing the `ConnectionString` and `DefaultContainerName` attributes with a `ContextTypeName="ContosoUniversity.DAL.SchoolEntities"` attribute.</span></span> <span data-ttu-id="5bfcc-280">Geralmente, é melhor aguardar até que você tenha criado o controle de vinculação de dados que está vinculado ao controle da fonte de dados antes de alterar a marcação de controle de `EntityDataSource`, porque depois de fazer a alteração, o designer não fornecerá uma opção de **esquema de atualização** no controle de vinculação de dados.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-280">It's often best to wait until after you've created the data-bound control that is linked to the data source control before you change the `EntityDataSource` control markup, because after you make the change, the designer will not provide you with a **Refresh Schema** option in the data-bound control.</span></span>

<span data-ttu-id="5bfcc-281">Execute a página e você pode selecionar um departamento na lista suspensa.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-281">Run the page and you can select a department from the drop-down list.</span></span>

<span data-ttu-id="5bfcc-282">[![Image18](the-entity-framework-and-aspnet-getting-started-part-2/_static/image52.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image51.png)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-282">[![Image18](the-entity-framework-and-aspnet-getting-started-part-2/_static/image52.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image51.png)</span></span>

<span data-ttu-id="5bfcc-283">Isso conclui a introdução ao uso do controle de `EntityDataSource`.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-283">This completes the introduction to using the `EntityDataSource` control.</span></span> <span data-ttu-id="5bfcc-284">Trabalhar com esse controle geralmente não é diferente de trabalhar com outros controles de fonte de dados ASP.NET, exceto que você faz referência a entidades e propriedades em vez de tabelas e colunas.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-284">Working with this control is generally no different from working with other ASP.NET data source controls, except that you reference entities and properties instead of tables and columns.</span></span> <span data-ttu-id="5bfcc-285">A única exceção é quando você deseja acessar as propriedades de navegação.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-285">The only exception is when you want to access navigation properties.</span></span> <span data-ttu-id="5bfcc-286">No próximo tutorial, você verá que a sintaxe usada com `EntityDataSource` controle também pode ser diferente de outros controles de fonte de dados quando você filtrar, agrupar e ordenar dados.</span><span class="sxs-lookup"><span data-stu-id="5bfcc-286">In the next tutorial you'll see that the syntax you use with `EntityDataSource` control might also differ from other data source controls when you filter, group, and order data.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="5bfcc-287">[Anterior](the-entity-framework-and-aspnet-getting-started-part-1.md)
> [Próximo](the-entity-framework-and-aspnet-getting-started-part-3.md)</span><span class="sxs-lookup"><span data-stu-id="5bfcc-287">[Previous](the-entity-framework-and-aspnet-getting-started-part-1.md)
[Next](the-entity-framework-and-aspnet-getting-started-part-3.md)</span></span>
