---
uid: web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-4
title: Introdução com Entity Framework 4,0 Database First e ASP.NET 4 Web Forms-parte 4 | Microsoft Docs
author: tdykstra
description: O aplicativo Web de exemplo Contoso University demonstra como criar ASP.NET Web Forms aplicativos usando o Entity Framework. O aplicativo de exemplo é...
ms.author: riande
ms.date: 12/03/2010
ms.assetid: ceb9e60f-957c-4d25-9331-cc527de96a33
msc.legacyurl: /web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-4
msc.type: authoredcontent
ms.openlocfilehash: eb75a76038466bf30738387ed4739687de1df944
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78638162"
---
# <a name="getting-started-with-entity-framework-40-database-first-and-aspnet-4-web-forms---part-4"></a><span data-ttu-id="7ecf1-104">Introdução com Entity Framework 4,0 Database First e ASP.NET 4 Web Forms-parte 4</span><span class="sxs-lookup"><span data-stu-id="7ecf1-104">Getting Started with Entity Framework 4.0 Database First and ASP.NET 4 Web Forms - Part 4</span></span>

<span data-ttu-id="7ecf1-105">por [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="7ecf1-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="7ecf1-106">O aplicativo Web de exemplo Contoso University demonstra como criar ASP.NET Web Forms aplicativos usando o Entity Framework 4,0 e o Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-106">The Contoso University sample web application demonstrates how to create ASP.NET Web Forms applications using the Entity Framework 4.0 and Visual Studio 2010.</span></span> <span data-ttu-id="7ecf1-107">Para obter informações sobre a série de tutoriais, consulte [o primeiro tutorial da série](the-entity-framework-and-aspnet-getting-started-part-1.md)</span><span class="sxs-lookup"><span data-stu-id="7ecf1-107">For information about the tutorial series, see [the first tutorial in the series](the-entity-framework-and-aspnet-getting-started-part-1.md)</span></span>

## <a name="working-with-related-data"></a><span data-ttu-id="7ecf1-108">Trabalhando com dados relacionados</span><span class="sxs-lookup"><span data-stu-id="7ecf1-108">Working with Related Data</span></span>

<span data-ttu-id="7ecf1-109">No tutorial anterior, você usou o controle de `EntityDataSource` para filtrar, classificar e agrupar dados.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-109">In the previous tutorial you used the `EntityDataSource` control to filter, sort, and group data.</span></span> <span data-ttu-id="7ecf1-110">Neste tutorial, você exibirá e atualizará os dados relacionados.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-110">In this tutorial you'll display and update related data.</span></span>

<span data-ttu-id="7ecf1-111">Você criará a página instrutores que mostra uma lista de instrutores.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-111">You'll create the Instructors page that shows a list of instructors.</span></span> <span data-ttu-id="7ecf1-112">Ao selecionar um instrutor, você verá uma lista de cursos ensinados por esse instrutor.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-112">When you select an instructor, you see a list of courses taught by that instructor.</span></span> <span data-ttu-id="7ecf1-113">Ao selecionar um curso, você verá os detalhes do curso e uma lista de alunos registrados no curso.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-113">When you select a course, you see details for the course and a list of students enrolled in the course.</span></span> <span data-ttu-id="7ecf1-114">Você pode editar o nome do instrutor, a data de contratação e a atribuição do Office.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-114">You can edit the instructor name, hire date, and office assignment.</span></span> <span data-ttu-id="7ecf1-115">A atribuição do Office é um conjunto de entidades separado que você acessa por meio de uma propriedade de navegação.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-115">The office assignment is a separate entity set that you access through a navigation property.</span></span>

<span data-ttu-id="7ecf1-116">Você pode vincular dados mestres a dados detalhados na marcação ou no código.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-116">You can link master data to detail data in markup or in code.</span></span> <span data-ttu-id="7ecf1-117">Nesta parte do tutorial, você usará os dois métodos.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-117">In this part of the tutorial, you'll use both methods.</span></span>

<span data-ttu-id="7ecf1-118">[![Image01](the-entity-framework-and-aspnet-getting-started-part-4/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="7ecf1-118">[![Image01](the-entity-framework-and-aspnet-getting-started-part-4/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image1.png)</span></span>

## <a name="displaying-and-updating-related-entities-in-a-gridview-control"></a><span data-ttu-id="7ecf1-119">Exibindo e atualizando entidades relacionadas em um controle GridView</span><span class="sxs-lookup"><span data-stu-id="7ecf1-119">Displaying and Updating Related Entities in a GridView Control</span></span>

<span data-ttu-id="7ecf1-120">Crie uma nova página da Web chamada *instrutores. aspx* que usa a página mestra *site. Master* e adicione a marcação a seguir ao controle de `Content` chamado `Content2`:</span><span class="sxs-lookup"><span data-stu-id="7ecf1-120">Create a new web page named *Instructors.aspx* that uses the *Site.Master* master page, and add the following markup to the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample1.aspx)]

<span data-ttu-id="7ecf1-121">Essa marcação cria um controle de `EntityDataSource` que seleciona instrutores e habilita atualizações.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-121">This markup creates an `EntityDataSource` control that selects instructors and enables updates.</span></span> <span data-ttu-id="7ecf1-122">O elemento `div` configura a marcação a ser renderizada à esquerda para que você possa adicionar uma coluna à direita posteriormente.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-122">The `div` element configures markup to render on the left so that you can add a column on the right later.</span></span>

<span data-ttu-id="7ecf1-123">Entre a marcação de `EntityDataSource` e a marca de `</div>` de fechamento, adicione a seguinte marcação que cria um controle de `GridView` e um controle de `Label` que você usará para mensagens de erro:</span><span class="sxs-lookup"><span data-stu-id="7ecf1-123">Between the `EntityDataSource` markup and the closing `</div>` tag, add the following markup that creates a `GridView` control and a `Label` control that you'll use for error messages:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample2.aspx)]

<span data-ttu-id="7ecf1-124">Este controle de `GridView` habilita a seleção de linha, realça a linha selecionada com uma cor de fundo cinza-clara e especifica manipuladores (que você criará posteriormente) para os eventos `SelectedIndexChanged` e `Updating`.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-124">This `GridView` control enables row selection, highlights the selected row with a light gray background color, and specifies handlers (which you'll create later) for the `SelectedIndexChanged` and `Updating` events.</span></span> <span data-ttu-id="7ecf1-125">Ele também especifica `PersonID` para a propriedade `DataKeyNames`, para que o valor de chave da linha selecionada possa ser passado para outro controle que você adicionará posteriormente.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-125">It also specifies `PersonID` for the `DataKeyNames` property, so that the key value of the selected row can be passed to another control that you'll add later.</span></span>

<span data-ttu-id="7ecf1-126">A última coluna contém a atribuição de escritório do instrutor, que é armazenada em uma propriedade de navegação da entidade `Person` porque ela vem de uma entidade associada.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-126">The last column contains the instructor's office assignment, which is stored in a navigation property of the `Person` entity because it comes from an associated entity.</span></span> <span data-ttu-id="7ecf1-127">Observe que o elemento `EditItemTemplate` especifica `Eval` em vez de `Bind`, porque o controle de `GridView` não pode se associar diretamente a propriedades de navegação para atualizá-los.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-127">Notice that the `EditItemTemplate` element specifies `Eval` instead of `Bind`, because the `GridView` control cannot directly bind to navigation properties in order to update them.</span></span> <span data-ttu-id="7ecf1-128">Você atualizará a atribuição do Office no código.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-128">You'll update the office assignment in code.</span></span> <span data-ttu-id="7ecf1-129">Para fazer isso, você precisará de uma referência ao controle de `TextBox` e irá salvá-lo no evento de `Init` do controle de `TextBox`.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-129">To do that, you'll need a reference to the `TextBox` control, and you'll get and save that in the `TextBox` control's `Init` event.</span></span>

<span data-ttu-id="7ecf1-130">Seguir o controle de `GridView` é um controle de `Label` usado para mensagens de erro.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-130">Following the `GridView` control is a `Label` control that's used for error messages.</span></span> <span data-ttu-id="7ecf1-131">A propriedade `Visible` do controle é `false`e o estado de exibição é desativado, de modo que o rótulo será exibido somente quando o código torná-lo visível em resposta a um erro.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-131">The control's `Visible` property is `false`, and view state is turned off, so that the label will appear only when code makes it visible in response to an error.</span></span>

<span data-ttu-id="7ecf1-132">Abra o arquivo *Instructors.aspx.cs* e adicione a seguinte instrução de `using`:</span><span class="sxs-lookup"><span data-stu-id="7ecf1-132">Open the *Instructors.aspx.cs* file and add the following `using` statement:</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample3.cs)]

<span data-ttu-id="7ecf1-133">Adicione um campo de classe particular imediatamente após a declaração de nome de classe parcial para manter uma referência à caixa de texto de atribuição do Office.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-133">Add a private class field immediately after the partial-class name declaration to hold a reference to the office assignment text box.</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample4.cs)]

<span data-ttu-id="7ecf1-134">Adicione um stub para o manipulador de eventos `SelectedIndexChanged` para o qual você adicionará o código posteriormente.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-134">Add a stub for the `SelectedIndexChanged` event handler that you'll add code for later.</span></span> <span data-ttu-id="7ecf1-135">Além disso, adicione um manipulador para o evento de `Init` do controle de `TextBox` de atribuição do Office para que você possa armazenar uma referência ao controle de `TextBox`.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-135">Also add a handler for the office assignment `TextBox` control's `Init` event so that you can store a reference to the `TextBox` control.</span></span> <span data-ttu-id="7ecf1-136">Você usará essa referência para obter o valor inserido pelo usuário para atualizar a entidade associada à propriedade de navegação.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-136">You'll use this reference to get the value the user entered in order to update the entity associated with the navigation property.</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample5.cs)]

<span data-ttu-id="7ecf1-137">Você usará o evento `Updating` do controle de `GridView` para atualizar a propriedade `Location` da entidade `OfficeAssignment` associada.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-137">You'll use the `GridView` control's `Updating` event to update the `Location` property of the associated `OfficeAssignment` entity.</span></span> <span data-ttu-id="7ecf1-138">Adicione o seguinte manipulador para o evento de `Updating`:</span><span class="sxs-lookup"><span data-stu-id="7ecf1-138">Add the following handler for the `Updating` event:</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample6.cs)]

<span data-ttu-id="7ecf1-139">Esse código é executado quando o usuário clica em **Atualizar** em uma linha `GridView`.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-139">This code is run when the user clicks **Update** in a `GridView` row.</span></span> <span data-ttu-id="7ecf1-140">O código usa LINQ to Entities para recuperar a entidade de `OfficeAssignment` associada à entidade de `Person` atual, usando o `PersonID` da linha selecionada a partir do argumento de evento.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-140">The code uses LINQ to Entities to retrieve the `OfficeAssignment` entity that's associated with the current `Person` entity, using the `PersonID` of the selected row from the event argument.</span></span>

<span data-ttu-id="7ecf1-141">Em seguida, o código usa uma das seguintes ações dependendo do valor no controle de `InstructorOfficeTextBox`:</span><span class="sxs-lookup"><span data-stu-id="7ecf1-141">The code then takes one of the following actions depending on the value in the `InstructorOfficeTextBox` control:</span></span>

- <span data-ttu-id="7ecf1-142">Se a caixa de texto tiver um valor e não houver nenhuma entidade `OfficeAssignment` para atualizar, ele criará um.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-142">If the text box has a value and there's no `OfficeAssignment` entity to update, it creates one.</span></span>
- <span data-ttu-id="7ecf1-143">Se a caixa de texto tiver um valor e houver uma entidade `OfficeAssignment`, ela atualizará o valor da propriedade `Location`.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-143">If the text box has a value and there's an `OfficeAssignment` entity, it updates the `Location` property value.</span></span>
- <span data-ttu-id="7ecf1-144">Se a caixa de texto estiver vazia e existir uma `OfficeAssignment` entidade, ela excluirá a entidade.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-144">If the text box is empty and an `OfficeAssignment` entity exists, it deletes the entity.</span></span>

<span data-ttu-id="7ecf1-145">Depois disso, ele salva as alterações no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-145">After this, it saves the changes to the database.</span></span> <span data-ttu-id="7ecf1-146">Se ocorrer uma exceção, ele exibirá uma mensagem de erro.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-146">If an exception occurs, it displays an error message.</span></span>

<span data-ttu-id="7ecf1-147">Execute a página.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-147">Run the page.</span></span>

<span data-ttu-id="7ecf1-148">[![Image02](the-entity-framework-and-aspnet-getting-started-part-4/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="7ecf1-148">[![Image02](the-entity-framework-and-aspnet-getting-started-part-4/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image3.png)</span></span>

<span data-ttu-id="7ecf1-149">Clique em **Editar** e todos os campos são alterados para as caixas de texto.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-149">Click **Edit** and all fields change to text boxes.</span></span>

<span data-ttu-id="7ecf1-150">[![Image03](the-entity-framework-and-aspnet-getting-started-part-4/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="7ecf1-150">[![Image03](the-entity-framework-and-aspnet-getting-started-part-4/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image5.png)</span></span>

<span data-ttu-id="7ecf1-151">Altere qualquer um desses valores, incluindo a **atribuição do Office**.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-151">Change any of these values, including **Office Assignment**.</span></span> <span data-ttu-id="7ecf1-152">Clique em **Atualizar** e você verá as alterações refletidas na lista.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-152">Click **Update** and you'll see the changes reflected in the list.</span></span>

## <a name="displaying-related-entities-in-a-separate-control"></a><span data-ttu-id="7ecf1-153">Exibindo entidades relacionadas em um controle separado</span><span class="sxs-lookup"><span data-stu-id="7ecf1-153">Displaying Related Entities in a Separate Control</span></span>

<span data-ttu-id="7ecf1-154">Cada instrutor pode ensinar um ou mais cursos, portanto, você adicionará um controle de `EntityDataSource` e um controle de `GridView` para listar os cursos associados a qualquer instrutor selecionado no controle instrutores `GridView`.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-154">Each instructor can teach one or more courses, so you'll add an `EntityDataSource` control and a `GridView` control to list the courses associated with whichever instructor is selected in the instructors `GridView` control.</span></span> <span data-ttu-id="7ecf1-155">Para criar um título e o controle de `EntityDataSource` para entidades de cursos, adicione a seguinte marcação entre a mensagem de erro `Label` controle e a marca de `</div>` de fechamento:</span><span class="sxs-lookup"><span data-stu-id="7ecf1-155">To create a heading and the `EntityDataSource` control for courses entities, add the following markup between the error message `Label` control and the closing `</div>` tag:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample7.aspx)]

<span data-ttu-id="7ecf1-156">O parâmetro `Where` contém o valor da `PersonID` do instrutor cuja linha está selecionada no controle de `InstructorsGridView`.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-156">The `Where` parameter contains the value of the `PersonID` of the instructor whose row is selected in the `InstructorsGridView` control.</span></span> <span data-ttu-id="7ecf1-157">A propriedade `Where` contém um comando de subseleção que obtém todas as entidades de `Person` associadas da propriedade de navegação `People` de uma entidade `Course` e seleciona a entidade de `Course` somente se uma das entidades de `Person` associadas contiver o valor de `PersonID` selecionado.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-157">The `Where` property contains a subselect command that gets all associated `Person` entities from a `Course` entity's `People` navigation property and selects the `Course` entity only if one of the associated `Person` entities contains the selected `PersonID` value.</span></span>

<span data-ttu-id="7ecf1-158">Para criar o controle de `GridView`., adicione a seguinte marcação imediatamente após o controle de `CoursesEntityDataSource` (antes da marca de fechamento `</div>`):</span><span class="sxs-lookup"><span data-stu-id="7ecf1-158">To create the `GridView` control., add the following markup immediately following the `CoursesEntityDataSource` control (before the closing `</div>` tag):</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample8.aspx)]

<span data-ttu-id="7ecf1-159">Como nenhum curso será exibido se nenhum instrutor for selecionado, um elemento `EmptyDataTemplate` será incluído.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-159">Because no courses will be displayed if no instructor is selected, an `EmptyDataTemplate` element is included.</span></span>

<span data-ttu-id="7ecf1-160">Execute a página.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-160">Run the page.</span></span>

<span data-ttu-id="7ecf1-161">[![Image04](the-entity-framework-and-aspnet-getting-started-part-4/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="7ecf1-161">[![Image04](the-entity-framework-and-aspnet-getting-started-part-4/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image7.png)</span></span>

<span data-ttu-id="7ecf1-162">Selecione um instrutor que tenha um ou mais cursos atribuídos e o curso ou os cursos apareçam na lista.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-162">Select an instructor who has one or more courses assigned, and the course or courses appear in the list.</span></span> <span data-ttu-id="7ecf1-163">(Observação: apesar de o esquema de banco de dados permitir vários cursos, nos dados de teste fornecidos com o Database, nenhum instrutor tem mais de um curso.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-163">(Note: although the database schema allows multiple courses, in the test data supplied with the database no instructor actually has more than one course.</span></span> <span data-ttu-id="7ecf1-164">Você mesmo pode adicionar cursos ao banco de dados usando a janela **Gerenciador de servidores** ou a página *CoursesAdd. aspx* , que você adicionará em um tutorial posterior.)</span><span class="sxs-lookup"><span data-stu-id="7ecf1-164">You can add courses to the database yourself using the **Server Explorer** window or the *CoursesAdd.aspx* page, which you'll add in a later tutorial.)</span></span>

<span data-ttu-id="7ecf1-165">[![Image05](the-entity-framework-and-aspnet-getting-started-part-4/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="7ecf1-165">[![Image05](the-entity-framework-and-aspnet-getting-started-part-4/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image9.png)</span></span>

<span data-ttu-id="7ecf1-166">O controle de `CoursesGridView` mostra apenas alguns campos de curso.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-166">The `CoursesGridView` control shows only a few course fields.</span></span> <span data-ttu-id="7ecf1-167">Para exibir todos os detalhes de um curso, você usará um controle de `DetailsView` para o curso que o usuário seleciona.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-167">To display all the details for a course, you'll use a `DetailsView` control for the course that the user selects.</span></span> <span data-ttu-id="7ecf1-168">Em *instrutores. aspx*, adicione a marcação a seguir após a marcação de `</div>` de fechamento (certifique-se de colocar essa marcação **após** a marca DIV de fechamento, não antes dela):</span><span class="sxs-lookup"><span data-stu-id="7ecf1-168">In *Instructors.aspx*, add the following markup after the closing `</div>` tag (make sure you place this markup **after** the closing div tag, not before it):</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample9.aspx)]

<span data-ttu-id="7ecf1-169">Essa marcação cria um controle `EntityDataSource` associado ao conjunto de entidades `Courses`.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-169">This markup creates an `EntityDataSource` control that's bound to the `Courses` entity set.</span></span> <span data-ttu-id="7ecf1-170">A propriedade `Where` seleciona um curso usando o valor de `CourseID` da linha selecionada no controle cursos `GridView`.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-170">The `Where` property selects a course using the `CourseID` value of the selected row in the courses `GridView` control.</span></span> <span data-ttu-id="7ecf1-171">A marcação Especifica um manipulador para o evento `Selected`, que você usará posteriormente para exibir notas de alunos, que é outro nível inferior na hierarquia.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-171">The markup specifies a handler for the `Selected` event, which you'll use later for displaying student grades, which is another level lower in the hierarchy.</span></span>

<span data-ttu-id="7ecf1-172">No *Instructors.aspx.cs*, crie o seguinte stub para o método `CourseDetailsEntityDataSource_Selected`.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-172">In *Instructors.aspx.cs*, create the following stub for the `CourseDetailsEntityDataSource_Selected` method.</span></span> <span data-ttu-id="7ecf1-173">(Você preencherá esse stub posteriormente no tutorial; por enquanto, você precisará dele para que a página seja compilada e executada.)</span><span class="sxs-lookup"><span data-stu-id="7ecf1-173">(You'll fill this stub out later in the tutorial; for now, you need it so that the page will compile and run.)</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample10.cs)]

<span data-ttu-id="7ecf1-174">Execute a página.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-174">Run the page.</span></span>

<span data-ttu-id="7ecf1-175">[![Image06](the-entity-framework-and-aspnet-getting-started-part-4/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="7ecf1-175">[![Image06](the-entity-framework-and-aspnet-getting-started-part-4/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image11.png)</span></span>

<span data-ttu-id="7ecf1-176">Inicialmente, não há detalhes do curso porque nenhum curso está selecionado.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-176">Initially there are no course details because no course is selected.</span></span> <span data-ttu-id="7ecf1-177">Selecione um instrutor que tenha um curso atribuído e, em seguida, selecione um curso para ver os detalhes.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-177">Select an instructor who has a course assigned, and then select a course to see the details.</span></span>

<span data-ttu-id="7ecf1-178">[![Image07](the-entity-framework-and-aspnet-getting-started-part-4/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="7ecf1-178">[![Image07](the-entity-framework-and-aspnet-getting-started-part-4/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image13.png)</span></span>

## <a name="using-the-entitydatasource-selected-event-to-display-related-data"></a><span data-ttu-id="7ecf1-179">Usando o evento de EntityDataSource "selecionado" para exibir dados relacionados</span><span class="sxs-lookup"><span data-stu-id="7ecf1-179">Using the EntityDataSource "Selected" Event to Display Related Data</span></span>

<span data-ttu-id="7ecf1-180">Por fim, você deseja mostrar todos os alunos registrados e suas notas para o curso selecionado.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-180">Finally, you want to show all of the enrolled students and their grades for the selected course.</span></span> <span data-ttu-id="7ecf1-181">Para fazer isso, você usará o evento `Selected` do controle de `EntityDataSource` associado ao `DetailsView`do curso.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-181">To do this, you'll use the `Selected` event of the `EntityDataSource` control bound to the course `DetailsView`.</span></span>

<span data-ttu-id="7ecf1-182">Em *instrutores. aspx*, adicione a seguinte marcação após o controle de `DetailsView`:</span><span class="sxs-lookup"><span data-stu-id="7ecf1-182">In *Instructors.aspx*, add the following markup after the `DetailsView` control:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample11.aspx)]

<span data-ttu-id="7ecf1-183">Essa marcação cria um controle de `ListView` que exibe uma lista de alunos e suas notas para o curso selecionado.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-183">This markup creates a `ListView` control that displays a list of students and their grades for the selected course.</span></span> <span data-ttu-id="7ecf1-184">Nenhuma fonte de dados foi especificada porque você associará o controle no código.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-184">No data source is specified because you'll databind the control in code.</span></span> <span data-ttu-id="7ecf1-185">O elemento `EmptyDataTemplate` fornece uma mensagem a ser exibida quando nenhum curso é selecionado — nesse caso, não há alunos a serem exibidos.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-185">The `EmptyDataTemplate` element provides a message to display when no course is selected—in that case, there are no students to display.</span></span> <span data-ttu-id="7ecf1-186">O elemento `LayoutTemplate` cria uma tabela HTML para exibir a lista e o `ItemTemplate` especifica as colunas a serem exibidas.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-186">The `LayoutTemplate` element creates an HTML table to display the list, and the `ItemTemplate` specifies the columns to display.</span></span> <span data-ttu-id="7ecf1-187">A ID do estudante e a classificação do aluno são da entidade `StudentGrade`, e o nome do aluno é da entidade `Person` que o Entity Framework disponibiliza na propriedade de navegação `Person` da entidade `StudentGrade`.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-187">The student ID and the student grade are from the `StudentGrade` entity, and the student name is from the `Person` entity that the Entity Framework makes available in the `Person` navigation property of the `StudentGrade` entity.</span></span>

<span data-ttu-id="7ecf1-188">No *Instructors.aspx.cs*, substitua o método de `CourseDetailsEntityDataSource_Selected` fragmentado pelo código a seguir:</span><span class="sxs-lookup"><span data-stu-id="7ecf1-188">In *Instructors.aspx.cs*, replace the stubbed-out `CourseDetailsEntityDataSource_Selected` method with the following code:</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample12.cs)]

<span data-ttu-id="7ecf1-189">O argumento de evento para esse evento fornece os dados selecionados na forma de uma coleção, que terá zero itens se nada for selecionado ou um item se uma entidade `Course` for selecionada.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-189">The event argument for this event provides the selected data in the form of a collection, which will have zero items if nothing is selected or one item if a `Course` entity is selected.</span></span> <span data-ttu-id="7ecf1-190">Se uma entidade `Course` for selecionada, o código usará o método `First` para converter a coleção em um único objeto.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-190">If a `Course` entity is selected, the code uses the `First` method to convert the collection to a single object.</span></span> <span data-ttu-id="7ecf1-191">Em seguida, ele obtém `StudentGrade` entidades da propriedade de navegação, converte-as em uma coleção e associa o controle de `GradesListView` à coleção.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-191">It then gets `StudentGrade` entities from the navigation property, converts them to a collection, and binds the `GradesListView` control to the collection.</span></span>

<span data-ttu-id="7ecf1-192">Isso é suficiente para exibir notas, mas você deseja ter certeza de que a mensagem no modelo de dados vazio é exibida na primeira vez em que a página é exibida e sempre que um curso não é selecionado.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-192">This is sufficient to display grades, but you want to make sure that the message in the empty data template is displayed the first time the page is displayed and whenever a course is not selected.</span></span> <span data-ttu-id="7ecf1-193">Para fazer isso, crie o seguinte método, que você chamará de dois locais:</span><span class="sxs-lookup"><span data-stu-id="7ecf1-193">To do that, create the following method, which you'll call from two places:</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample13.cs)]

<span data-ttu-id="7ecf1-194">Chame esse novo método do método `Page_Load` para exibir o modelo de dados vazio na primeira vez em que a página for exibida.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-194">Call this new method from the `Page_Load` method to display the empty data template the first time the page is displayed.</span></span> <span data-ttu-id="7ecf1-195">E chamá-lo do método `InstructorsGridView_SelectedIndexChanged` porque esse evento é gerado quando um instrutor é selecionado, o que significa que novos cursos são carregados no controle de cursos `GridView` e nenhum está selecionado ainda.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-195">And call it from the `InstructorsGridView_SelectedIndexChanged` method because that event is raised when an instructor is selected, which means new courses are loaded into the courses `GridView` control and none is selected yet.</span></span> <span data-ttu-id="7ecf1-196">Aqui estão as duas chamadas:</span><span class="sxs-lookup"><span data-stu-id="7ecf1-196">Here are the two calls:</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample14.cs)]

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample15.cs)]

<span data-ttu-id="7ecf1-197">Execute a página.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-197">Run the page.</span></span>

<span data-ttu-id="7ecf1-198">[![Image08](the-entity-framework-and-aspnet-getting-started-part-4/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="7ecf1-198">[![Image08](the-entity-framework-and-aspnet-getting-started-part-4/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image15.png)</span></span>

<span data-ttu-id="7ecf1-199">Selecione um instrutor que tenha um curso atribuído e, em seguida, selecione o curso.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-199">Select an instructor that has a course assigned, and then select the course.</span></span>

<span data-ttu-id="7ecf1-200">[![Image09](the-entity-framework-and-aspnet-getting-started-part-4/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="7ecf1-200">[![Image09](the-entity-framework-and-aspnet-getting-started-part-4/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image17.png)</span></span>

<span data-ttu-id="7ecf1-201">Agora você viu algumas maneiras de trabalhar com dados relacionados.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-201">You have now seen a few ways to work with related data.</span></span> <span data-ttu-id="7ecf1-202">No tutorial a seguir, você aprenderá a adicionar relações entre entidades existentes, como remover relações e como adicionar uma nova entidade que tem uma relação com uma entidade existente.</span><span class="sxs-lookup"><span data-stu-id="7ecf1-202">In the following tutorial, you'll learn how to add relationships between existing entities, how to remove relationships, and how to add a new entity that has a relationship to an existing entity.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="7ecf1-203">[Anterior](the-entity-framework-and-aspnet-getting-started-part-3.md)
> [Próximo](the-entity-framework-and-aspnet-getting-started-part-5.md)</span><span class="sxs-lookup"><span data-stu-id="7ecf1-203">[Previous](the-entity-framework-and-aspnet-getting-started-part-3.md)
[Next](the-entity-framework-and-aspnet-getting-started-part-5.md)</span></span>
