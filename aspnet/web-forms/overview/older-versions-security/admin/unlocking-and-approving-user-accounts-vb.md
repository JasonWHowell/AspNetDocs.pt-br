---
uid: web-forms/overview/older-versions-security/admin/unlocking-and-approving-user-accounts-vb
title: Desbloqueando e aprovando contas de usuário (VB) | Microsoft Docs
author: rick-anderson
description: Este tutorial mostra como criar uma página da Web para os administradores gerenciarem os status bloqueados e aprovados dos usuários. Também veremos como aprovar novos usuários o...
ms.author: riande
ms.date: 04/01/2008
ms.assetid: 041854a5-ea8c-4de0-82f1-121ba6cb2893
msc.legacyurl: /web-forms/overview/older-versions-security/admin/unlocking-and-approving-user-accounts-vb
msc.type: authoredcontent
ms.openlocfilehash: 4a7474676b8f502c583e226678de2b275e0ea3c7
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/28/2019
ms.locfileid: "74590574"
---
# <a name="unlocking-and-approving-user-accounts-vb"></a><span data-ttu-id="3f40c-104">Desbloqueio e aprovação de contas de usuário (VB)</span><span class="sxs-lookup"><span data-stu-id="3f40c-104">Unlocking and Approving User Accounts (VB)</span></span>

<span data-ttu-id="3f40c-105">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="3f40c-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="3f40c-106">[Baixar código](https://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/VB.14.zip) ou [baixar PDF](https://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial14_UnlockAndApprove_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="3f40c-106">[Download Code](https://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/VB.14.zip) or [Download PDF](https://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial14_UnlockAndApprove_vb.pdf)</span></span>

> <span data-ttu-id="3f40c-107">Este tutorial mostra como criar uma página da Web para os administradores gerenciarem os status bloqueados e aprovados dos usuários.</span><span class="sxs-lookup"><span data-stu-id="3f40c-107">This tutorial shows how to build a web page for administrators to manage users' locked out and approved statuses.</span></span> <span data-ttu-id="3f40c-108">Também veremos como aprovar novos usuários somente depois de verificarem seu endereço de email.</span><span class="sxs-lookup"><span data-stu-id="3f40c-108">We will also see how to approve new users only after they have verified their email address.</span></span>

## <a name="introduction"></a><span data-ttu-id="3f40c-109">Introdução</span><span class="sxs-lookup"><span data-stu-id="3f40c-109">Introduction</span></span>

<span data-ttu-id="3f40c-110">Junto com um nome de usuário, senha e email, cada conta de usuário tem dois campos de status que determinam se o usuário pode fazer logon no site: bloqueado e aprovado.</span><span class="sxs-lookup"><span data-stu-id="3f40c-110">Along with a username, password, and email, each user account has two status fields that dictate whether the user can log into the site: locked out and approved.</span></span> <span data-ttu-id="3f40c-111">Um usuário será bloqueado automaticamente se fornecer credenciais inválidas um número especificado de vezes dentro de um determinado número de minutos (as configurações padrão bloqueiam o usuário após 5 tentativas de logon inválidas em 10 minutos).</span><span class="sxs-lookup"><span data-stu-id="3f40c-111">A user is automatically locked out if they provide invalid credentials a specified number of times within a specified number of minutes (the default settings lock a user out after 5 invalid login attempts within 10 minutes).</span></span> <span data-ttu-id="3f40c-112">O status aprovado é útil em cenários em que alguma ação deve ser transacionada antes que um novo usuário possa fazer logon no site.</span><span class="sxs-lookup"><span data-stu-id="3f40c-112">The approved status is useful in scenarios where some action must transpire before a new user is able to log on to the site.</span></span> <span data-ttu-id="3f40c-113">Por exemplo, um usuário pode precisar primeiro verificar seu endereço de email ou ser aprovado por um administrador antes de poder fazer logon.</span><span class="sxs-lookup"><span data-stu-id="3f40c-113">For example, a user might need to first verify their email address or be approved by an administrator before being able to login.</span></span>

<span data-ttu-id="3f40c-114">Como um usuário bloqueado ou não aprovado não pode fazer logon, é natural imaginar como esses status podem ser redefinidos.</span><span class="sxs-lookup"><span data-stu-id="3f40c-114">Because a locked out or unapproved user cannot login, it's only natural to wonder how these statuses can be reset.</span></span> <span data-ttu-id="3f40c-115">O ASP.NET não inclui nenhuma funcionalidade interna ou controles da Web para gerenciar status bloqueados e aprovados pelos usuários, em parte porque essas decisões precisam ser tratadas em uma base site a site.</span><span class="sxs-lookup"><span data-stu-id="3f40c-115">ASP.NET does not include any built-in functionality or Web controls for managing users' locked out and approved statuses, in part because these decisions need to be handled on a site-by-site basis.</span></span> <span data-ttu-id="3f40c-116">Alguns sites podem aprovar automaticamente todas as novas contas de usuário (o comportamento padrão).</span><span class="sxs-lookup"><span data-stu-id="3f40c-116">Some sites might automatically approve all new user accounts (the default behavior).</span></span> <span data-ttu-id="3f40c-117">Outras pessoas têm um administrador aprovam novas contas ou não aprovam os usuários até visitarem um link enviado para o endereço de email fornecido quando eles se inscreveram.</span><span class="sxs-lookup"><span data-stu-id="3f40c-117">Others have an administrator approve new accounts or do not approve users until they visit a link sent to the email address provided when they signed up.</span></span> <span data-ttu-id="3f40c-118">Da mesma forma, alguns sites podem bloquear usuários até que um administrador redefina seu status, enquanto outros sites enviam um email para o usuário bloqueado com uma URL que eles podem visitar para desbloquear sua conta.</span><span class="sxs-lookup"><span data-stu-id="3f40c-118">Likewise, some sites may lock out users until an administrator resets their status, while other sites send an email to the locked out user with a URL they can visit to unlock their account.</span></span>

<span data-ttu-id="3f40c-119">Este tutorial mostra como criar uma página da Web para os administradores gerenciarem os status bloqueados e aprovados dos usuários.</span><span class="sxs-lookup"><span data-stu-id="3f40c-119">This tutorial shows how to build a web page for administrators to manage users' locked out and approved statuses.</span></span> <span data-ttu-id="3f40c-120">Também veremos como aprovar novos usuários somente depois de verificarem seu endereço de email.</span><span class="sxs-lookup"><span data-stu-id="3f40c-120">We will also see how to approve new users only after they have verified their email address.</span></span>

## <a name="step-1-managing-users-locked-out-and-approved-statuses"></a><span data-ttu-id="3f40c-121">Etapa 1: Gerenciando status bloqueados e aprovados dos usuários</span><span class="sxs-lookup"><span data-stu-id="3f40c-121">Step 1: Managing Users' Locked Out and Approved Statuses</span></span>

<span data-ttu-id="3f40c-122"><a id="Tutorial12"> </a>Na página [*criando uma interface para selecionar uma conta de usuário a partir de muitos*](building-an-interface-to-select-one-user-account-from-many-vb.md) , criamos uma páginas que listou cada conta de usuário em um GridView filtrado, paginado.</span><span class="sxs-lookup"><span data-stu-id="3f40c-122">In the <a id="Tutorial12"></a>[*Building an Interface to Select One User Account from Many*](building-an-interface-to-select-one-user-account-from-many-vb.md) tutorial we constructed a page that listed each user account in a paged, filtered GridView.</span></span> <span data-ttu-id="3f40c-123">A grade lista o nome e o email de cada usuário, seus status aprovados e bloqueados, se eles estão online no momento e comentários sobre o usuário.</span><span class="sxs-lookup"><span data-stu-id="3f40c-123">The grid lists each user's name and email, their approved and locked out statuses, whether they're currently online, and any comments about the user.</span></span> <span data-ttu-id="3f40c-124">Para gerenciar os status aprovados e bloqueados dos usuários, poderíamos tornar essa grade editável.</span><span class="sxs-lookup"><span data-stu-id="3f40c-124">To manage users' approved and locked out statuses, we could make this grid editable.</span></span> <span data-ttu-id="3f40c-125">Para alterar o status aprovado de um usuário, o administrador primeiro localiza a conta de usuário e, em seguida, editou a linha GridView correspondente, marcando ou desmarcando a caixa de seleção aprovada.</span><span class="sxs-lookup"><span data-stu-id="3f40c-125">To change a user's approved status, the administrator would first locate the user account and then edit the corresponding GridView row, checking or unchecking the approved checkbox.</span></span> <span data-ttu-id="3f40c-126">Como alternativa, poderíamos gerenciar os status aprovado e bloqueado por meio de uma página ASP.NET separada.</span><span class="sxs-lookup"><span data-stu-id="3f40c-126">Alternatively, we could manage the approved and locked out statuses through a separate ASP.NET page.</span></span>

<span data-ttu-id="3f40c-127">Para este tutorial, vamos usar duas páginas ASP.NET: `ManageUsers.aspx` e `UserInformation.aspx`.</span><span class="sxs-lookup"><span data-stu-id="3f40c-127">For this tutorial let's use two ASP.NET pages: `ManageUsers.aspx` and `UserInformation.aspx`.</span></span> <span data-ttu-id="3f40c-128">A ideia aqui é que `ManageUsers.aspx` lista as contas de usuário no sistema, enquanto `UserInformation.aspx` permite que o administrador gerencie os status aprovados e bloqueados para um usuário específico.</span><span class="sxs-lookup"><span data-stu-id="3f40c-128">The idea here is that `ManageUsers.aspx` lists the user accounts in the system, while `UserInformation.aspx` enables the administrator to manage the approved and locked out statuses for a specific user.</span></span> <span data-ttu-id="3f40c-129">Nossa primeira ordem de negócios é aumentar o GridView no `ManageUsers.aspx` para incluir um HyperLinkField, que é renderizado como uma coluna de links.</span><span class="sxs-lookup"><span data-stu-id="3f40c-129">Our first order of business is to augment the GridView in `ManageUsers.aspx` to include a HyperLinkField, which renders as a column of links.</span></span> <span data-ttu-id="3f40c-130">Queremos que cada link aponte para `UserInformation.aspx?user=UserName`, em que *username* é o nome do usuário a ser editado.</span><span class="sxs-lookup"><span data-stu-id="3f40c-130">We want each link to point to `UserInformation.aspx?user=UserName`, where *UserName* is the name of the user to edit.</span></span>

> [!NOTE]
> <span data-ttu-id="3f40c-131">Se você baixou o código para <a id="Tutorial13"> </a>o tutorial de [*recuperação e alteração de senhas*](recovering-and-changing-passwords-vb.md) , talvez tenha notado que a página de `ManageUsers.aspx` já contém um conjunto de links de "gerenciar" e a página de `UserInformation.aspx` fornece uma interface para alterar a senha do usuário selecionado.</span><span class="sxs-lookup"><span data-stu-id="3f40c-131">If you downloaded the code for the <a id="Tutorial13"></a>[*Recovering and Changing Passwords*](recovering-and-changing-passwords-vb.md) tutorial you may have noticed that the `ManageUsers.aspx` page already contains a set of "Manage" links and the `UserInformation.aspx` page provides an interface for changing the selected user's password.</span></span> <span data-ttu-id="3f40c-132">Decidi não replicar essa funcionalidade no código associado a este tutorial porque ela funcionou ao burlar a API Membership e operar diretamente com o banco de dados SQL Server para alterar a senha de um usuário.</span><span class="sxs-lookup"><span data-stu-id="3f40c-132">I decided not to replicate that functionality in the code associated with this tutorial because it worked by circumventing the Membership API and operating directly with the SQL Server database to change a user's password.</span></span> <span data-ttu-id="3f40c-133">Este tutorial começa do zero com a página `UserInformation.aspx`.</span><span class="sxs-lookup"><span data-stu-id="3f40c-133">This tutorial starts from scratch with the `UserInformation.aspx` page.</span></span>

### <a name="adding-manage-links-to-theuseraccountsgridview"></a><span data-ttu-id="3f40c-134">Adicionando links "gerenciar" para o`UserAccounts`GridView</span><span class="sxs-lookup"><span data-stu-id="3f40c-134">Adding "Manage" Links to the`UserAccounts`GridView</span></span>

<span data-ttu-id="3f40c-135">Abra a página `ManageUsers.aspx` e adicione um HyperLinkField ao `UserAccounts` GridView.</span><span class="sxs-lookup"><span data-stu-id="3f40c-135">Open the `ManageUsers.aspx` page and add a HyperLinkField to the `UserAccounts` GridView.</span></span> <span data-ttu-id="3f40c-136">Defina a propriedade `Text` do HyperLinkField como "gerenciar" e suas propriedades `DataNavigateUrlFields` e `DataNavigateUrlFormatString` como `UserName` e "UserInformation. aspx? User ={0}", respectivamente.</span><span class="sxs-lookup"><span data-stu-id="3f40c-136">Set the HyperLinkField's `Text` property to "Manage" and its `DataNavigateUrlFields` and `DataNavigateUrlFormatString` properties to `UserName` and "UserInformation.aspx?user={0}", respectively.</span></span> <span data-ttu-id="3f40c-137">Essas configurações configuram o HyperLinkField de modo que todos os hiperlinks exibam o texto "gerenciar", mas cada link passa o valor de *nome de usuário* apropriado para a QueryString.</span><span class="sxs-lookup"><span data-stu-id="3f40c-137">These settings configure the HyperLinkField such that all of the hyperlinks display the text "Manage", but each link passes in the appropriate *UserName* value into the querystring.</span></span>

<span data-ttu-id="3f40c-138">Depois de adicionar o HyperLinkField ao GridView, Reserve um momento para exibir a página de `ManageUsers.aspx` por meio de um navegador.</span><span class="sxs-lookup"><span data-stu-id="3f40c-138">After adding the HyperLinkField to the GridView, take a moment to view the `ManageUsers.aspx` page through a browser.</span></span> <span data-ttu-id="3f40c-139">Como mostra a Figura 1, cada linha GridView agora inclui um link "Manage".</span><span class="sxs-lookup"><span data-stu-id="3f40c-139">As Figure 1 shows, each GridView row now includes a "Manage" link.</span></span> <span data-ttu-id="3f40c-140">O link "gerenciar" de Bruce aponta para `UserInformation.aspx?user=Bruce`, enquanto o link "gerenciar" para Dave aponta para `UserInformation.aspx?user=Dave`.</span><span class="sxs-lookup"><span data-stu-id="3f40c-140">The "Manage" link for Bruce points to `UserInformation.aspx?user=Bruce`, whereas the "Manage" link for Dave points to `UserInformation.aspx?user=Dave`.</span></span>

<span data-ttu-id="3f40c-141">[![o HyperLinkField adiciona um](unlocking-and-approving-user-accounts-vb/_static/image2.png)](unlocking-and-approving-user-accounts-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="3f40c-141">[![The HyperLinkField Adds a](unlocking-and-approving-user-accounts-vb/_static/image2.png)](unlocking-and-approving-user-accounts-vb/_static/image1.png)</span></span>

<span data-ttu-id="3f40c-142">**Figura 1**: o HyperLinkField adiciona um link "gerenciar" para cada conta de usuário ([clique para exibir a imagem em tamanho normal](unlocking-and-approving-user-accounts-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="3f40c-142">**Figure 1**: The HyperLinkField Adds a "Manage" Link for Each User Account  ([Click to view full-size image](unlocking-and-approving-user-accounts-vb/_static/image3.png))</span></span>

<span data-ttu-id="3f40c-143">Vamos criar a interface do usuário e o código para a página de `UserInformation.aspx` daqui a pouco, mas primeiro vamos falar sobre como alterar programaticamente os status bloqueados e aprovados de um usuário.</span><span class="sxs-lookup"><span data-stu-id="3f40c-143">We will create the user interface and code for the `UserInformation.aspx` page in a moment, but first let's talk about how to programmatically change a user's locked out and approved statuses.</span></span> <span data-ttu-id="3f40c-144">A [classe`MembershipUser`](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx) tem [`IsLockedOut`](https://msdn.microsoft.com/library/system.web.security.membershipuser.islockedout.aspx) e [`IsApproved` Propriedades](https://msdn.microsoft.com/library/system.web.security.membershipuser.isapproved.aspx).</span><span class="sxs-lookup"><span data-stu-id="3f40c-144">The [`MembershipUser` class](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx) has [`IsLockedOut`](https://msdn.microsoft.com/library/system.web.security.membershipuser.islockedout.aspx) and [`IsApproved` properties](https://msdn.microsoft.com/library/system.web.security.membershipuser.isapproved.aspx).</span></span> <span data-ttu-id="3f40c-145">A propriedade `IsLockedOut` é somente leitura.</span><span class="sxs-lookup"><span data-stu-id="3f40c-145">The `IsLockedOut` property is read-only.</span></span> <span data-ttu-id="3f40c-146">Não há nenhum mecanismo para bloquear programaticamente um usuário; para desbloquear um usuário, use o [método`UnlockUser`](https://msdn.microsoft.com/library/system.web.security.membershipuser.unlockuser.aspx)da classe `MembershipUser`.</span><span class="sxs-lookup"><span data-stu-id="3f40c-146">There is no mechanism to programmatically lock out a user; to unlock a user, use the `MembershipUser` class's [`UnlockUser` method](https://msdn.microsoft.com/library/system.web.security.membershipuser.unlockuser.aspx).</span></span> <span data-ttu-id="3f40c-147">A propriedade `IsApproved` é legível e gravável.</span><span class="sxs-lookup"><span data-stu-id="3f40c-147">The `IsApproved` property is readable and writeable.</span></span> <span data-ttu-id="3f40c-148">Para salvar as alterações feitas nessa propriedade, precisamos chamar o [método`UpdateUser`](https://msdn.microsoft.com/library/system.web.security.membership.updateuser.aspx)da classe `Membership`, passando o objeto `MembershipUser` modificado.</span><span class="sxs-lookup"><span data-stu-id="3f40c-148">To save any changes to this property, we need to call the `Membership` class's [`UpdateUser` method](https://msdn.microsoft.com/library/system.web.security.membership.updateuser.aspx), passing in the modified `MembershipUser` object.</span></span>

<span data-ttu-id="3f40c-149">Como a propriedade `IsApproved` é legível e gravável, um controle de caixa de seleção é provavelmente o melhor elemento de interface de usuário para configurar essa propriedade.</span><span class="sxs-lookup"><span data-stu-id="3f40c-149">Because the `IsApproved` property is readable and writeable, a CheckBox control is probably the best user interface element for configuring this property.</span></span> <span data-ttu-id="3f40c-150">No entanto, uma caixa de seleção não funcionará para a propriedade `IsLockedOut` porque um administrador não pode bloquear um usuário, ela pode apenas desbloquear um usuário.</span><span class="sxs-lookup"><span data-stu-id="3f40c-150">However, a CheckBox will not work for the `IsLockedOut` property because an administrator cannot lock out a user, she may only unlock a user.</span></span> <span data-ttu-id="3f40c-151">Uma interface de usuário adequada para a propriedade `IsLockedOut` é um botão que, quando clicado, desbloqueia a conta de usuário.</span><span class="sxs-lookup"><span data-stu-id="3f40c-151">A suitable user interface for the `IsLockedOut` property is a Button that, when clicked, unlocks the user account.</span></span> <span data-ttu-id="3f40c-152">Esse botão só deve ser habilitado se o usuário estiver bloqueado.</span><span class="sxs-lookup"><span data-stu-id="3f40c-152">This Button should only be enabled if the user is locked out.</span></span>

### <a name="creating-theuserinformationaspxpage"></a><span data-ttu-id="3f40c-153">Criando a página de`UserInformation.aspx`</span><span class="sxs-lookup"><span data-stu-id="3f40c-153">Creating the`UserInformation.aspx`Page</span></span>

<span data-ttu-id="3f40c-154">Agora estamos prontos para implementar a interface do usuário no `UserInformation.aspx`.</span><span class="sxs-lookup"><span data-stu-id="3f40c-154">We are now ready to implement the user interface in `UserInformation.aspx`.</span></span> <span data-ttu-id="3f40c-155">Abra esta página e adicione os seguintes controles da Web:</span><span class="sxs-lookup"><span data-stu-id="3f40c-155">Open this page and add the following Web controls:</span></span>

- <span data-ttu-id="3f40c-156">Um controle de hiperlink que, quando clicado, retorna o administrador para a página `ManageUsers.aspx`.</span><span class="sxs-lookup"><span data-stu-id="3f40c-156">A HyperLink control that, when clicked, returns the administrator to the `ManageUsers.aspx` page.</span></span>
- <span data-ttu-id="3f40c-157">Um controle de rótulo da Web para exibir o nome do usuário selecionado.</span><span class="sxs-lookup"><span data-stu-id="3f40c-157">A Label Web control for displaying the selected user's name.</span></span> <span data-ttu-id="3f40c-158">Defina o `ID` deste rótulo como `UserNameLabel` e desmarque sua propriedade de texto.</span><span class="sxs-lookup"><span data-stu-id="3f40c-158">Set this Label's `ID` to `UserNameLabel` and clear out its Text property.</span></span>
- <span data-ttu-id="3f40c-159">Um controle de caixa de seleção chamado `IsApproved`.</span><span class="sxs-lookup"><span data-stu-id="3f40c-159">A CheckBox control named `IsApproved`.</span></span> <span data-ttu-id="3f40c-160">Defina sua propriedade `AutoPostBack` como `True`.</span><span class="sxs-lookup"><span data-stu-id="3f40c-160">Set its `AutoPostBack` property to `True`.</span></span>
- <span data-ttu-id="3f40c-161">Um controle rótulo para exibir a data do último bloqueio do usuário.</span><span class="sxs-lookup"><span data-stu-id="3f40c-161">A Label control for displaying the user's last locked out date.</span></span> <span data-ttu-id="3f40c-162">Nomeie esse rótulo `LastLockedOutDateLabel` e desmarque sua propriedade `Text`.</span><span class="sxs-lookup"><span data-stu-id="3f40c-162">Name this Label `LastLockedOutDateLabel` and clear out its `Text` property.</span></span>
- <span data-ttu-id="3f40c-163">Um botão para desbloquear o usuário.</span><span class="sxs-lookup"><span data-stu-id="3f40c-163">A Button for unlocking the user.</span></span> <span data-ttu-id="3f40c-164">Nomeie esse botão `UnlockUserButton` e defina sua propriedade `Text` como "desbloquear usuário".</span><span class="sxs-lookup"><span data-stu-id="3f40c-164">Name this Button `UnlockUserButton` and set its `Text` property to "Unlock User".</span></span>
- <span data-ttu-id="3f40c-165">Um controle rótulo para exibir mensagens de status, como "o status aprovado do usuário foi atualizado".</span><span class="sxs-lookup"><span data-stu-id="3f40c-165">A Label control for displaying status messages, such as, "The user's approved status has been updated."</span></span> <span data-ttu-id="3f40c-166">Nomeie esse controle `StatusMessage`, desmarque sua propriedade `Text` e defina sua propriedade `CssClass` como `Important`.</span><span class="sxs-lookup"><span data-stu-id="3f40c-166">Name this control `StatusMessage`, clear out its `Text` property, and set its `CssClass` property to `Important`.</span></span> <span data-ttu-id="3f40c-167">(A classe CSS `Important` é definida no arquivo de folha de estilo `Styles.css`; ela exibe o texto correspondente em uma fonte grande e vermelha.)</span><span class="sxs-lookup"><span data-stu-id="3f40c-167">(The `Important` CSS class is defined in the `Styles.css` stylesheet file; it displays the corresponding text in a large, red font.)</span></span>

<span data-ttu-id="3f40c-168">Depois de adicionar esses controles, o modo de exibição de Design no Visual Studio deve ser semelhante à captura de tela na Figura 2.</span><span class="sxs-lookup"><span data-stu-id="3f40c-168">After adding these controls, the Design view in Visual Studio should look similar to the screen shot in Figure 2.</span></span>

<span data-ttu-id="3f40c-169">[![criar a interface do usuário para UserInformation. aspx](unlocking-and-approving-user-accounts-vb/_static/image5.png)](unlocking-and-approving-user-accounts-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="3f40c-169">[![Create the User Interface for UserInformation.aspx](unlocking-and-approving-user-accounts-vb/_static/image5.png)](unlocking-and-approving-user-accounts-vb/_static/image4.png)</span></span>

<span data-ttu-id="3f40c-170">**Figura 2**: criar a interface do usuário para `UserInformation.aspx` ([clique para exibir a imagem em tamanho normal](unlocking-and-approving-user-accounts-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="3f40c-170">**Figure 2**: Create the User Interface for `UserInformation.aspx` ([Click to view full-size image](unlocking-and-approving-user-accounts-vb/_static/image6.png))</span></span>

<span data-ttu-id="3f40c-171">Com a interface do usuário concluída, nossa próxima tarefa é definir a caixa de seleção `IsApproved` e outros controles com base nas informações do usuário selecionado.</span><span class="sxs-lookup"><span data-stu-id="3f40c-171">With the user interface complete, our next task is to set the `IsApproved` CheckBox and other controls based on the selected user's information.</span></span> <span data-ttu-id="3f40c-172">Crie um manipulador de eventos para o evento de `Load` da página e adicione o seguinte código:</span><span class="sxs-lookup"><span data-stu-id="3f40c-172">Create an event handler for the page's `Load` event and add the following code:</span></span>

[!code-vb[Main](unlocking-and-approving-user-accounts-vb/samples/sample1.vb)]

<span data-ttu-id="3f40c-173">O código acima começa garantindo que esta é a primeira visita à página e não um postback subsequente.</span><span class="sxs-lookup"><span data-stu-id="3f40c-173">The above code starts by ensuring that this is the first visit to the page and not a subsequent postback.</span></span> <span data-ttu-id="3f40c-174">Em seguida, ele lê o nome de usuário passado pelo campo `user` QueryString e recupera informações sobre essa conta de usuário por meio do método `Membership.GetUser(username)`.</span><span class="sxs-lookup"><span data-stu-id="3f40c-174">It then reads the username passed through the `user` querystring field and retrieves information about that user account via the `Membership.GetUser(username)` method.</span></span> <span data-ttu-id="3f40c-175">Se nenhum nome de usuário foi fornecido por meio da QueryString ou se o usuário especificado não foi encontrado, o administrador é enviado de volta para a página de `ManageUsers.aspx`.</span><span class="sxs-lookup"><span data-stu-id="3f40c-175">If no username was supplied through the querystring, or if the specified user could not be found, the administrator is sent back to the `ManageUsers.aspx` page.</span></span>

<span data-ttu-id="3f40c-176">O valor de `UserName` do objeto de `MembershipUser` é exibido no `UserNameLabel` e a caixa de seleção `IsApproved` é marcada com base no valor da propriedade `IsApproved`.</span><span class="sxs-lookup"><span data-stu-id="3f40c-176">The `MembershipUser` object's `UserName` value is then displayed in the `UserNameLabel` and the `IsApproved` CheckBox is checked based on the `IsApproved` property value.</span></span>

<span data-ttu-id="3f40c-177">A [propriedade`LastLockoutDate`](https://msdn.microsoft.com/library/system.web.security.membershipuser.lastlockoutdate.aspx) do objeto de `MembershipUser` retorna um valor `DateTime` indicando quando o usuário foi bloqueado pela última vez. Se o usuário nunca tiver sido bloqueado, o valor retornado dependerá do provedor de associação.</span><span class="sxs-lookup"><span data-stu-id="3f40c-177">The `MembershipUser` object's [`LastLockoutDate` property](https://msdn.microsoft.com/library/system.web.security.membershipuser.lastlockoutdate.aspx) returns a `DateTime` value indicating when the user was last locked out. If the user has never been locked out, the value returned depends on the Membership provider.</span></span> <span data-ttu-id="3f40c-178">Quando uma nova conta é criada, a `SqlMembershipProvider` define o campo de `LastLockoutDate` da tabela `aspnet_Membership` como `1754-01-01 12:00:00 AM`.</span><span class="sxs-lookup"><span data-stu-id="3f40c-178">When a new account is created, the `SqlMembershipProvider` sets the `aspnet_Membership` table's `LastLockoutDate` field to `1754-01-01 12:00:00 AM`.</span></span> <span data-ttu-id="3f40c-179">O código acima exibe uma cadeia de caracteres vazia no `LastLockoutDateLabel` se a propriedade `LastLockoutDate` ocorrer antes do ano 2000; caso contrário, a parte de data da propriedade `LastLockoutDate` será exibida no rótulo.</span><span class="sxs-lookup"><span data-stu-id="3f40c-179">The above code displays an empty string in the `LastLockoutDateLabel` if the `LastLockoutDate` property occurs before year 2000; otherwise, the date portion of the `LastLockoutDate` property is displayed in the Label.</span></span> <span data-ttu-id="3f40c-180">A propriedade `Enabled` do `UnlockUserButton`é definida como o status bloqueado do usuário, o que significa que esse botão só será habilitado se o usuário estiver bloqueado.</span><span class="sxs-lookup"><span data-stu-id="3f40c-180">The `UnlockUserButton`'s `Enabled` property is set to the user's locked out status, meaning that this Button will only be enabled if the user is locked out.</span></span>

<span data-ttu-id="3f40c-181">Reserve um tempo para testar a página de `UserInformation.aspx` por meio de um navegador.</span><span class="sxs-lookup"><span data-stu-id="3f40c-181">Take a moment to test the `UserInformation.aspx` page through a browser.</span></span> <span data-ttu-id="3f40c-182">Você certamente precisará iniciar em `ManageUsers.aspx` e selecionar uma conta de usuário para gerenciar.</span><span class="sxs-lookup"><span data-stu-id="3f40c-182">You will, of course, need to start at `ManageUsers.aspx` and select a user account to manage.</span></span> <span data-ttu-id="3f40c-183">Ao chegar em `UserInformation.aspx`, observe que a caixa de seleção `IsApproved` só será marcada se o usuário for aprovado.</span><span class="sxs-lookup"><span data-stu-id="3f40c-183">Upon arriving at `UserInformation.aspx`, note that the `IsApproved` CheckBox is only checked if the user is approved.</span></span> <span data-ttu-id="3f40c-184">Se o usuário já tiver sido bloqueado, sua última data de bloqueio será exibida.</span><span class="sxs-lookup"><span data-stu-id="3f40c-184">If the user has ever been locked out, their last locked out date is displayed.</span></span> <span data-ttu-id="3f40c-185">O botão desbloquear usuário será habilitado somente se o usuário estiver bloqueado no momento. Marcar ou desmarcar a caixa de seleção `IsApproved` ou clicar no botão desbloquear usuário causará um postback, mas nenhuma modificação será feita na conta de usuário, pois ainda criamos manipuladores de eventos para esses eventos.</span><span class="sxs-lookup"><span data-stu-id="3f40c-185">The Unlock User button is enabled only if the user is currently locked out. Checking or unchecking the `IsApproved` CheckBox or clicking the Unlock User button causes a postback, but no modifications are made to the user account because we've yet to create event handlers for these events.</span></span>

<span data-ttu-id="3f40c-186">Retorne ao Visual Studio e crie manipuladores de eventos para o evento de `CheckedChanged` da caixa de seleção de `IsApproved` e o evento `Click` do botão de `UnlockUser`.</span><span class="sxs-lookup"><span data-stu-id="3f40c-186">Return to Visual Studio and create event handlers for the `IsApproved` CheckBox's `CheckedChanged` event and the `UnlockUser` Button's `Click` event.</span></span> <span data-ttu-id="3f40c-187">No manipulador de eventos `CheckedChanged`, defina a propriedade `IsApproved` do usuário para a propriedade `Checked` da caixa de seleção e salve as alterações por meio de uma chamada para `Membership.UpdateUser`.</span><span class="sxs-lookup"><span data-stu-id="3f40c-187">In the `CheckedChanged` event handler, set the user's `IsApproved` property to the `Checked` property of the CheckBox and then save the changes via a call to `Membership.UpdateUser`.</span></span> <span data-ttu-id="3f40c-188">No manipulador de eventos `Click`, basta chamar o método de `UnlockUser` do objeto `MembershipUser`.</span><span class="sxs-lookup"><span data-stu-id="3f40c-188">In the `Click` event handler, simply call the `MembershipUser` object's `UnlockUser` method.</span></span> <span data-ttu-id="3f40c-189">Em ambos os manipuladores de eventos, exiba uma mensagem adequada no rótulo `StatusMessage`.</span><span class="sxs-lookup"><span data-stu-id="3f40c-189">In both event handlers, display a suitable message in the `StatusMessage` Label.</span></span>

[!code-vb[Main](unlocking-and-approving-user-accounts-vb/samples/sample2.vb)]

### <a name="testing-theuserinformationaspxpage"></a><span data-ttu-id="3f40c-190">Testando a página de`UserInformation.aspx`</span><span class="sxs-lookup"><span data-stu-id="3f40c-190">Testing the`UserInformation.aspx`Page</span></span>

<span data-ttu-id="3f40c-191">Com esses manipuladores de eventos em vigor, revisite a página e não aprovou um usuário.</span><span class="sxs-lookup"><span data-stu-id="3f40c-191">With these event handlers in place, revisit the page and unapproved a user.</span></span> <span data-ttu-id="3f40c-192">Como mostra a Figura 3, você verá uma breve mensagem na página indicando que a propriedade de `IsApproved` do usuário foi modificada com êxito.</span><span class="sxs-lookup"><span data-stu-id="3f40c-192">As Figure 3 shows, you should see a brief message on the page indicating that the user's `IsApproved` property was successfully modified.</span></span>

<span data-ttu-id="3f40c-193">[![Chris não foi aprovada](unlocking-and-approving-user-accounts-vb/_static/image8.png)](unlocking-and-approving-user-accounts-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="3f40c-193">[![Chris has been Unapproved](unlocking-and-approving-user-accounts-vb/_static/image8.png)](unlocking-and-approving-user-accounts-vb/_static/image7.png)</span></span>

<span data-ttu-id="3f40c-194">**Figura 3**: Chris não foi aprovada ([clique para exibir a imagem em tamanho normal](unlocking-and-approving-user-accounts-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="3f40c-194">**Figure 3**: Chris has been Unapproved  ([Click to view full-size image](unlocking-and-approving-user-accounts-vb/_static/image9.png))</span></span>

<span data-ttu-id="3f40c-195">Em seguida, faça logoff e tente fazer logon como o usuário cuja conta acabou de ser aprovada.</span><span class="sxs-lookup"><span data-stu-id="3f40c-195">Next, logout and try to login as the user whose account was just unapproved.</span></span> <span data-ttu-id="3f40c-196">Como o usuário não está aprovado, ele não pode fazer logon.</span><span class="sxs-lookup"><span data-stu-id="3f40c-196">Because the user is not approved, they cannot login.</span></span> <span data-ttu-id="3f40c-197">Por padrão, o controle de logon exibe a mesma mensagem se o usuário não puder fazer logon, independentemente do motivo.</span><span class="sxs-lookup"><span data-stu-id="3f40c-197">By default, the Login control displays the same message if the user cannot login, regardless of the reason.</span></span> <span data-ttu-id="3f40c-198">Mas no <a id="Tutorial6"> </a>tutorial [*Validando credenciais de usuário no repositório de usuários da Associação*](../membership/validating-user-credentials-against-the-membership-user-store-vb.md) , examinamos aprimorar o controle de logon para exibir uma mensagem mais apropriada.</span><span class="sxs-lookup"><span data-stu-id="3f40c-198">But in the <a id="Tutorial6"></a>[*Validating User Credentials Against the Membership User Store*](../membership/validating-user-credentials-against-the-membership-user-store-vb.md) tutorial we looked at enhancing the Login control to display a more appropriate message.</span></span> <span data-ttu-id="3f40c-199">Como mostra a Figura 4, Chris é mostrada uma mensagem explicando que ele não pode fazer logon porque sua conta ainda não foi aprovada.</span><span class="sxs-lookup"><span data-stu-id="3f40c-199">As Figure 4 shows, Chris is shown a message explaining that he cannot login because his account is not yet approved.</span></span>

<span data-ttu-id="3f40c-200">[![Chris não pode fazer logon porque sua conta não está aprovada](unlocking-and-approving-user-accounts-vb/_static/image11.png)](unlocking-and-approving-user-accounts-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="3f40c-200">[![Chris Cannot Login Because His Account is Unapproved](unlocking-and-approving-user-accounts-vb/_static/image11.png)](unlocking-and-approving-user-accounts-vb/_static/image10.png)</span></span>

<span data-ttu-id="3f40c-201">**Figura 4**: Chris não pode fazer logon porque sua conta não está aprovada ([clique para exibir a imagem em tamanho normal](unlocking-and-approving-user-accounts-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="3f40c-201">**Figure 4**: Chris Cannot Login Because His Account is Unapproved  ([Click to view full-size image](unlocking-and-approving-user-accounts-vb/_static/image12.png))</span></span>

<span data-ttu-id="3f40c-202">Para testar a funcionalidade bloqueada, tente fazer logon como um usuário aprovado, mas use uma senha incorreta.</span><span class="sxs-lookup"><span data-stu-id="3f40c-202">To test the locked out functionality, attempt to login as an approved user, but use an incorrect password.</span></span> <span data-ttu-id="3f40c-203">Repita esse processo o número necessário de vezes até que a conta do usuário tenha sido bloqueada. O controle de logon também foi atualizado para mostrar uma mensagem personalizada se estiver tentando fazer logon de uma conta bloqueada.</span><span class="sxs-lookup"><span data-stu-id="3f40c-203">Repeat this process the necessary number of times until the user's account has been locked out. The Login control was also updated to show a custom message if attempting to login from a locked out account.</span></span> <span data-ttu-id="3f40c-204">Você sabe que uma conta foi bloqueada depois de começar a ver a seguinte mensagem na página de logon: "sua conta foi bloqueada devido a muitas tentativas de logon inválidas.</span><span class="sxs-lookup"><span data-stu-id="3f40c-204">You know that an account has been locked out once you start seeing the following message at the login page: "Your account has been locked out because of too many invalid login attempts.</span></span> <span data-ttu-id="3f40c-205">Entre em contato com o administrador para que sua conta seja desbloqueada. "</span><span class="sxs-lookup"><span data-stu-id="3f40c-205">Please contact the administrator to have your account unlocked."</span></span>

<span data-ttu-id="3f40c-206">Volte para a página `ManageUsers.aspx` e clique no link Gerenciar para o usuário bloqueado.</span><span class="sxs-lookup"><span data-stu-id="3f40c-206">Return to the `ManageUsers.aspx` page and click the Manage link for the locked out user.</span></span> <span data-ttu-id="3f40c-207">Como mostra a Figura 5, você deve ver um valor no `LastLockedOutDateLabel` o botão desbloquear usuário deve ser habilitado.</span><span class="sxs-lookup"><span data-stu-id="3f40c-207">As Figure 5 shows, you should see a value in the `LastLockedOutDateLabel` the Unlock User button should be enabled.</span></span> <span data-ttu-id="3f40c-208">Clique no botão desbloquear usuário para desbloquear a conta de usuário.</span><span class="sxs-lookup"><span data-stu-id="3f40c-208">Click the Unlock User button to unlock the user account.</span></span> <span data-ttu-id="3f40c-209">Depois de desbloquear o usuário, ele poderá fazer logon novamente.</span><span class="sxs-lookup"><span data-stu-id="3f40c-209">Once you have unlocked the user, they will be able to login again.</span></span>

<span data-ttu-id="3f40c-210">[![Dave foi bloqueado do sistema](unlocking-and-approving-user-accounts-vb/_static/image14.png)](unlocking-and-approving-user-accounts-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="3f40c-210">[![Dave Has Been Locked Out of the System](unlocking-and-approving-user-accounts-vb/_static/image14.png)](unlocking-and-approving-user-accounts-vb/_static/image13.png)</span></span>

<span data-ttu-id="3f40c-211">**Figura 5**: Dave foi bloqueado do sistema ([clique para exibir a imagem em tamanho normal](unlocking-and-approving-user-accounts-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="3f40c-211">**Figure 5**: Dave Has Been Locked Out of the System  ([Click to view full-size image](unlocking-and-approving-user-accounts-vb/_static/image15.png))</span></span>

## <a name="step-2-specifying-new-users-approved-status"></a><span data-ttu-id="3f40c-212">Etapa 2: especificando o status aprovado de novos usuários</span><span class="sxs-lookup"><span data-stu-id="3f40c-212">Step 2: Specifying New Users' Approved Status</span></span>

<span data-ttu-id="3f40c-213">O status aprovado é útil em cenários em que você deseja que alguma ação seja executada antes que um novo usuário possa fazer logon e acessar os recursos específicos do usuário do site.</span><span class="sxs-lookup"><span data-stu-id="3f40c-213">The approved status is useful in scenarios where you want some action to be performed before a new user is able to login and access the user-specific features of the site.</span></span> <span data-ttu-id="3f40c-214">Por exemplo, você pode estar executando um site privado em que todas as páginas, exceto as páginas de logon e de inscrição, são acessíveis somente para usuários autenticados.</span><span class="sxs-lookup"><span data-stu-id="3f40c-214">For example, you may be running a private website where all pages, except for the login and signup pages, are accessible only to authenticated users.</span></span> <span data-ttu-id="3f40c-215">Mas o que acontece se um estranho atingir seu site, encontrar a página de inscrição e criar uma conta?</span><span class="sxs-lookup"><span data-stu-id="3f40c-215">But what happens if a stranger reaches your website, finds the signup page, and creates an account?</span></span> <span data-ttu-id="3f40c-216">Para evitar que isso aconteça, você pode mover a página de inscrição para uma `Administration` pasta e exigir que um administrador crie manualmente cada conta.</span><span class="sxs-lookup"><span data-stu-id="3f40c-216">To prevent this from happening you could move the signup page to an `Administration` folder, and require that an administrator manually create each account.</span></span> <span data-ttu-id="3f40c-217">Como alternativa, você pode permitir que qualquer pessoa se inscriçõesse, mas proíba o acesso ao site até que um administrador aprove a conta de usuário.</span><span class="sxs-lookup"><span data-stu-id="3f40c-217">Alternatively, you could allow anyone to signup, but prohibit site access until an administrator approves the user account.</span></span>

<span data-ttu-id="3f40c-218">Por padrão, o controle CreateUserWizard aprova novas contas.</span><span class="sxs-lookup"><span data-stu-id="3f40c-218">By default, the CreateUserWizard control approves new accounts.</span></span> <span data-ttu-id="3f40c-219">Você pode configurar esse comportamento usando a propriedade de [`DisableCreatedUser`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.disablecreateduser.aspx)do controle.</span><span class="sxs-lookup"><span data-stu-id="3f40c-219">You can configure this behavior using the control's [`DisableCreatedUser` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.disablecreateduser.aspx).</span></span> <span data-ttu-id="3f40c-220">Defina essa propriedade como `True` para não aprovar novas contas de usuário.</span><span class="sxs-lookup"><span data-stu-id="3f40c-220">Set this property to `True` to not approve new user accounts.</span></span>

> [!NOTE]
> <span data-ttu-id="3f40c-221">Por padrão, o controle CreateUserWizard faz logon automaticamente na nova conta de usuário.</span><span class="sxs-lookup"><span data-stu-id="3f40c-221">By default the CreateUserWizard control automatically logs on the new user account.</span></span> <span data-ttu-id="3f40c-222">Esse comportamento é determinado pela [propriedade de`LoginCreatedUser`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.logincreateduser.aspx)do controle.</span><span class="sxs-lookup"><span data-stu-id="3f40c-222">This behavior is dictated by the control's [`LoginCreatedUser` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.logincreateduser.aspx).</span></span> <span data-ttu-id="3f40c-223">Como os usuários não aprovados não podem fazer logon no site, quando `DisableCreatedUser` está `True` a nova conta de usuário não está conectada ao site, independentemente do valor da propriedade `LoginCreatedUser`.</span><span class="sxs-lookup"><span data-stu-id="3f40c-223">Because unapproved users cannot login to the site, when `DisableCreatedUser` is `True` the new user account is not logged into the site, regardless of the value of the `LoginCreatedUser` property.</span></span>

<span data-ttu-id="3f40c-224">Se você estiver criando programaticamente novas contas de usuário por meio do método `Membership.CreateUser`, para criar uma conta de usuário não aprovada, use uma das sobrecargas que aceitam o valor da propriedade `IsApproved` do novo usuário como um parâmetro de entrada.</span><span class="sxs-lookup"><span data-stu-id="3f40c-224">If you are programmatically creating new user accounts via the `Membership.CreateUser` method, to create an unapproved user account use one of the overloads that accept the new user's `IsApproved` property value as an input parameter.</span></span>

## <a name="step-3-approving-users-by-verifying-their-email-address"></a><span data-ttu-id="3f40c-225">Etapa 3: aprovar os usuários verificando seu endereço de email</span><span class="sxs-lookup"><span data-stu-id="3f40c-225">Step 3: Approving Users By Verifying their Email Address</span></span>

<span data-ttu-id="3f40c-226">Muitos sites que dão suporte a contas de usuário não aprovam novos usuários até que eles verifiquem o endereço de email fornecido durante o registro.</span><span class="sxs-lookup"><span data-stu-id="3f40c-226">Many websites that support user accounts do not approve new users until they verify the email address they supplied when registering.</span></span> <span data-ttu-id="3f40c-227">Esse processo de verificação é comumente usado para frustrar bots, spammers e outros ne'er-do-caixas, pois requer um endereço de email verificado exclusivo e adiciona uma etapa extra no processo de inscrição.</span><span class="sxs-lookup"><span data-stu-id="3f40c-227">This verification process is commonly used to thwart bots, spammers, and other ne'er-do-wells as it requires a unique, verified email address and adds an extra step in the signup process.</span></span> <span data-ttu-id="3f40c-228">Com esse modelo, quando um novo usuário se inscreve, ele recebe uma mensagem de email que inclui um link para uma página de verificação.</span><span class="sxs-lookup"><span data-stu-id="3f40c-228">With this model, when a new user signs up they are sent an email message that includes a link to a verification page.</span></span> <span data-ttu-id="3f40c-229">Visitando o link que o usuário comprovou que recebeu o email e, portanto, que o endereço de email fornecido é válido.</span><span class="sxs-lookup"><span data-stu-id="3f40c-229">By visiting the link the user has proven that they received the email and, therefore, that the email address provided is valid.</span></span> <span data-ttu-id="3f40c-230">A página de verificação é responsável por aprovar o usuário.</span><span class="sxs-lookup"><span data-stu-id="3f40c-230">The verification page is responsible for approving the user.</span></span> <span data-ttu-id="3f40c-231">Isso pode acontecer automaticamente, aprovando, assim, qualquer usuário que chegue a essa página, ou somente depois que o usuário fornecer algumas informações adicionais, como um [captcha](http://en.wikipedia.org/wiki/Captcha).</span><span class="sxs-lookup"><span data-stu-id="3f40c-231">This may happen automatically, thereby approving any user who reaches this page, or only after the user provides some additional information, such as a [CAPTCHA](http://en.wikipedia.org/wiki/Captcha).</span></span>

<span data-ttu-id="3f40c-232">Para acomodar esse fluxo de trabalho, precisamos primeiro atualizar a página de criação da conta para que novos usuários não sejam aprovados.</span><span class="sxs-lookup"><span data-stu-id="3f40c-232">To accommodate this workflow, we need to first update the account creation page so that new users are unapproved.</span></span> <span data-ttu-id="3f40c-233">Abra a página `EnhancedCreateUserWizard.aspx` na pasta `Membership` e defina a propriedade `DisableCreatedUser` do controle CreateUserWizard como `True`.</span><span class="sxs-lookup"><span data-stu-id="3f40c-233">Open the `EnhancedCreateUserWizard.aspx` page in the `Membership` folder and set the CreateUserWizard control's `DisableCreatedUser` property to `True`.</span></span>

<span data-ttu-id="3f40c-234">Em seguida, precisamos configurar o controle CreateUserWizard para enviar um email para o novo usuário com instruções sobre como verificar sua conta.</span><span class="sxs-lookup"><span data-stu-id="3f40c-234">Next, we need to configure the CreateUserWizard control to send an email to the new user with instructions on how to verify their account.</span></span> <span data-ttu-id="3f40c-235">Em particular, incluiremos um link no email para a página de `Verification.aspx` (que ainda criamos), passando o `UserId` do novo usuário por meio da QueryString.</span><span class="sxs-lookup"><span data-stu-id="3f40c-235">In particular, we will include a link in the email to the `Verification.aspx` page (which we've yet to create), passing in the new user's `UserId` through the querystring.</span></span> <span data-ttu-id="3f40c-236">A página `Verification.aspx` pesquisará o usuário especificado e os marcará como aprovado.</span><span class="sxs-lookup"><span data-stu-id="3f40c-236">The `Verification.aspx` page will lookup the specified user and mark them approved.</span></span>

### <a name="sending-a-verification-email-to-new-users"></a><span data-ttu-id="3f40c-237">Enviando um email de verificação para novos usuários</span><span class="sxs-lookup"><span data-stu-id="3f40c-237">Sending a Verification Email to New Users</span></span>

<span data-ttu-id="3f40c-238">Para enviar um email do controle CreateUserWizard, configure sua propriedade `MailDefinition` adequadamente.</span><span class="sxs-lookup"><span data-stu-id="3f40c-238">To send an email from the CreateUserWizard control, configure its `MailDefinition` property appropriately.</span></span> <span data-ttu-id="3f40c-239">Conforme discutido no <a id="Tutorial13"> </a> [tutorial anterior](recovering-and-changing-passwords-vb.md), os controles ChangePassword e PasswordRecovery incluem uma [Propriedade`MailDefinition`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.maildefinition.aspx) que funciona da mesma maneira que o controle CreateUserWizard.</span><span class="sxs-lookup"><span data-stu-id="3f40c-239">As discussed in the <a id="Tutorial13"></a>[previous tutorial](recovering-and-changing-passwords-vb.md), the ChangePassword and PasswordRecovery controls include a [`MailDefinition` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.maildefinition.aspx) that works in the same manner as the CreateUserWizard control's.</span></span>

> [!NOTE]
> <span data-ttu-id="3f40c-240">Para usar a propriedade `MailDefinition`, você precisa especificar opções de entrega de email no `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="3f40c-240">To use the `MailDefinition` property you need to specify mail delivery options in `Web.config`.</span></span> <span data-ttu-id="3f40c-241">Para obter mais informações, consulte [enviando email em ASP.net](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="3f40c-241">For more information, refer to [Sending Email in ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx).</span></span>

<span data-ttu-id="3f40c-242">Comece criando um novo modelo de email chamado `CreateUserWizard.txt` na pasta `EmailTemplates`.</span><span class="sxs-lookup"><span data-stu-id="3f40c-242">Start by creating a new email template named `CreateUserWizard.txt` in the `EmailTemplates` folder.</span></span> <span data-ttu-id="3f40c-243">Use o seguinte texto para o modelo:</span><span class="sxs-lookup"><span data-stu-id="3f40c-243">Use the following text for the template:</span></span>

[!code-aspx[Main](unlocking-and-approving-user-accounts-vb/samples/sample3.aspx)]

<span data-ttu-id="3f40c-244">Defina a propriedade `BodyFileName` do `MailDefinition`como "~/EmailTemplates/CreateUserWizard.txt" e sua propriedade `Subject` como "bem-vindo ao meu site!</span><span class="sxs-lookup"><span data-stu-id="3f40c-244">Set the `MailDefinition`'s `BodyFileName` property to "~/EmailTemplates/CreateUserWizard.txt" and its `Subject` property to "Welcome to My Website!</span></span> <span data-ttu-id="3f40c-245">Ative sua conta. "</span><span class="sxs-lookup"><span data-stu-id="3f40c-245">Please activate your account."</span></span>

<span data-ttu-id="3f40c-246">Observe que o modelo de email `CreateUserWizard.txt` inclui um espaço reservado `<%VerificationUrl%>`.</span><span class="sxs-lookup"><span data-stu-id="3f40c-246">Note that the `CreateUserWizard.txt` email template includes a `<%VerificationUrl%>` placeholder.</span></span> <span data-ttu-id="3f40c-247">É aqui que a URL para a página de `Verification.aspx` será colocada.</span><span class="sxs-lookup"><span data-stu-id="3f40c-247">This is where the URL for the `Verification.aspx` page will be placed.</span></span> <span data-ttu-id="3f40c-248">O CreateUserWizard substitui automaticamente os espaços reservados `<%UserName%>` e `<%Password%>` com o nome de usuário e a senha da nova conta, mas não há espaço reservado `<%VerificationUrl%>` interno.</span><span class="sxs-lookup"><span data-stu-id="3f40c-248">The CreateUserWizard automatically replaces the `<%UserName%>` and `<%Password%>` placeholders with the new account's username and password, but there is no built-in `<%VerificationUrl%>` placeholder.</span></span> <span data-ttu-id="3f40c-249">Precisamos substituí-lo manualmente pela URL de verificação apropriada.</span><span class="sxs-lookup"><span data-stu-id="3f40c-249">We need to manually replace it with the appropriate verification URL.</span></span>

<span data-ttu-id="3f40c-250">Para fazer isso, crie um manipulador de eventos para o [evento de`SendingMail`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.sendingmail.aspx) do CreateUserWizard e adicione o seguinte código:</span><span class="sxs-lookup"><span data-stu-id="3f40c-250">To accomplish this, create an event handler for the CreateUserWizard's [`SendingMail` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.sendingmail.aspx) and add the following code:</span></span>

[!code-vb[Main](unlocking-and-approving-user-accounts-vb/samples/sample4.vb)]

<span data-ttu-id="3f40c-251">O evento `SendingMail` é acionado após o evento `CreatedUser`, o que significa que, na hora em que o manipulador de eventos acima é executado, a nova conta de usuário já foi criada.</span><span class="sxs-lookup"><span data-stu-id="3f40c-251">The `SendingMail` event fires after the `CreatedUser` event, meaning that by the time the above event handler executes the new user account has already been created.</span></span> <span data-ttu-id="3f40c-252">Podemos acessar o novo valor de `UserId` do usuário chamando o método `Membership.GetUser`, passando o `UserName` inserido no controle CreateUserWizard.</span><span class="sxs-lookup"><span data-stu-id="3f40c-252">We can access the new user's `UserId` value by calling the `Membership.GetUser` method, passing in the `UserName` entered into the CreateUserWizard control.</span></span> <span data-ttu-id="3f40c-253">Em seguida, a URL de verificação é formada.</span><span class="sxs-lookup"><span data-stu-id="3f40c-253">Next, the verification URL is formed.</span></span> <span data-ttu-id="3f40c-254">A instrução `Request.Url.GetLeftPart(UriPartial.Authority)` retorna a parte `http://yourserver.com` da URL; `Request.ApplicationPath` retorna o caminho em que o aplicativo tem raiz.</span><span class="sxs-lookup"><span data-stu-id="3f40c-254">The statement `Request.Url.GetLeftPart(UriPartial.Authority)` returns the `http://yourserver.com` portion of the URL; `Request.ApplicationPath` returns path where the application is rooted.</span></span> <span data-ttu-id="3f40c-255">A URL de verificação é definida como `Verification.aspx?ID=userId`.</span><span class="sxs-lookup"><span data-stu-id="3f40c-255">The verification URL is then defined as `Verification.aspx?ID=userId`.</span></span> <span data-ttu-id="3f40c-256">Essas duas cadeias de caracteres são concatenadas para formar a URL completa.</span><span class="sxs-lookup"><span data-stu-id="3f40c-256">These two strings are then concatenated to form the complete URL.</span></span> <span data-ttu-id="3f40c-257">Por fim, o corpo da mensagem de email (`e.Message.Body`) tem todas as ocorrências de `<%VerificationUrl%>` substituído pela URL completa.</span><span class="sxs-lookup"><span data-stu-id="3f40c-257">Finally, the email message body (`e.Message.Body`) has all occurrences of `<%VerificationUrl%>` replaced with the full URL.</span></span>

<span data-ttu-id="3f40c-258">O efeito líquido é que novos usuários não são aprovados, o que significa que eles não podem fazer logon no site.</span><span class="sxs-lookup"><span data-stu-id="3f40c-258">The net effect is that new users are unapproved, meaning that they cannot log into the site.</span></span> <span data-ttu-id="3f40c-259">Além disso, eles receberão automaticamente um email com um link para a URL de verificação (veja a Figura 6).</span><span class="sxs-lookup"><span data-stu-id="3f40c-259">Furthermore, they are automatically sent an email with a link to the verification URL (see Figure 6).</span></span>

<span data-ttu-id="3f40c-260">[![o novo usuário recebe um email com um link para a URL de verificação](unlocking-and-approving-user-accounts-vb/_static/image17.png)](unlocking-and-approving-user-accounts-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="3f40c-260">[![The New User Receives an Email with a Link to the Verification URL](unlocking-and-approving-user-accounts-vb/_static/image17.png)](unlocking-and-approving-user-accounts-vb/_static/image16.png)</span></span>

<span data-ttu-id="3f40c-261">**Figura 6**: o novo usuário recebe um email com um link para a URL de verificação ([clique para exibir a imagem em tamanho normal](unlocking-and-approving-user-accounts-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="3f40c-261">**Figure 6**: The New User Receives an Email with a Link to the Verification URL  ([Click to view full-size image](unlocking-and-approving-user-accounts-vb/_static/image18.png))</span></span>

> [!NOTE]
> <span data-ttu-id="3f40c-262">A etapa CreateUserWizard padrão do controle CreateUserWizard exibe uma mensagem informando ao usuário que sua conta foi criada e exibe um botão continuar.</span><span class="sxs-lookup"><span data-stu-id="3f40c-262">The CreateUserWizard control's default CreateUserWizard step displays a message informing the user their account has been created and displays a Continue button.</span></span> <span data-ttu-id="3f40c-263">Clicar em isso leva o usuário para a URL especificada pela propriedade de `ContinueDestinationPageUrl` do controle.</span><span class="sxs-lookup"><span data-stu-id="3f40c-263">Clicking this takes the user to the URL specified by the control's `ContinueDestinationPageUrl` property.</span></span> <span data-ttu-id="3f40c-264">O CreateUserWizard no `EnhancedCreateUserWizard.aspx` está configurado para enviar novos usuários para o `~/Membership/AdditionalUserInfo.aspx`, que solicita ao usuário sua cidade natal, URL da Home Page e assinatura.</span><span class="sxs-lookup"><span data-stu-id="3f40c-264">The CreateUserWizard in `EnhancedCreateUserWizard.aspx` is configured to send new users to the `~/Membership/AdditionalUserInfo.aspx`, which prompts the user for their hometown, homepage URL, and signature.</span></span> <span data-ttu-id="3f40c-265">Como essas informações só podem ser adicionadas por usuários conectados, faz sentido atualizar essa propriedade para enviar usuários de volta para a home page do site (`~/Default.aspx`).</span><span class="sxs-lookup"><span data-stu-id="3f40c-265">Because this information can only be added by logged on users, it makes sense to update this property to send users back to the site's homepage (`~/Default.aspx`).</span></span> <span data-ttu-id="3f40c-266">Além disso, a página `EnhancedCreateUserWizard.aspx` ou a etapa CreateUserWizard deve ser aumentada para informar ao usuário que um email de verificação foi enviado e sua conta não será ativada até que siga as instruções neste email.</span><span class="sxs-lookup"><span data-stu-id="3f40c-266">Moreover, the `EnhancedCreateUserWizard.aspx` page or the CreateUserWizard step should be augmented to inform the user that they have been sent a verification email and their account won't be activated until they follow the instructions in this email.</span></span> <span data-ttu-id="3f40c-267">Eu deixe essas modificações como um exercício para o leitor.</span><span class="sxs-lookup"><span data-stu-id="3f40c-267">I leave these modifications as an exercise for the reader.</span></span>

### <a name="creating-the-verification-page"></a><span data-ttu-id="3f40c-268">Criando a página de verificação</span><span class="sxs-lookup"><span data-stu-id="3f40c-268">Creating the Verification Page</span></span>

<span data-ttu-id="3f40c-269">Nossa tarefa final é criar a página de `Verification.aspx`.</span><span class="sxs-lookup"><span data-stu-id="3f40c-269">Our final task is to create the `Verification.aspx` page.</span></span> <span data-ttu-id="3f40c-270">Adicione essa página à pasta raiz, associando-a à página mestra de `Site.master`.</span><span class="sxs-lookup"><span data-stu-id="3f40c-270">Add this page to the root folder, associating it with the `Site.master` master page.</span></span> <span data-ttu-id="3f40c-271">Como fizemos com a maioria das páginas de conteúdo anteriores adicionadas ao site, remova o controle de conteúdo que faz referência ao `LoginContent` ContentPlaceHolder para que a página de conteúdo use o conteúdo padrão da página mestra.</span><span class="sxs-lookup"><span data-stu-id="3f40c-271">As we've done with most of the previous content pages added to the site, remove the Content control that references the `LoginContent` ContentPlaceHolder so that the content page uses the master page's default content.</span></span>

<span data-ttu-id="3f40c-272">Adicione um controle rótulo da Web à página `Verification.aspx`, defina seu `ID` como `StatusMessage` e desmarque sua propriedade Text.</span><span class="sxs-lookup"><span data-stu-id="3f40c-272">Add a Label Web control to the `Verification.aspx` page, set its `ID` to `StatusMessage` and clear out its text property.</span></span> <span data-ttu-id="3f40c-273">Em seguida, crie o manipulador de eventos `Page_Load` e adicione o seguinte código:</span><span class="sxs-lookup"><span data-stu-id="3f40c-273">Next, create the `Page_Load` event handler and add the following code:</span></span>

[!code-vb[Main](unlocking-and-approving-user-accounts-vb/samples/sample5.vb)]

<span data-ttu-id="3f40c-274">A massa do código acima verifica se a UserId fornecida por meio da QueryString existe, se é um valor de `Guid` válido e se faz referência a uma conta de usuário existente.</span><span class="sxs-lookup"><span data-stu-id="3f40c-274">The bulk of the above code verifies that the UserId supplied through the querystring exists, that it is a valid `Guid` value, and that it references an existing user account.</span></span> <span data-ttu-id="3f40c-275">Se todas essas verificações passarem, a conta de usuário será aprovada; caso contrário, uma mensagem de status adequada será exibida.</span><span class="sxs-lookup"><span data-stu-id="3f40c-275">If all of these checks pass, the user account is approved; otherwise, a suitable status message is displayed.</span></span>

<span data-ttu-id="3f40c-276">A Figura 7 mostra a página `Verification.aspx` quando visitada por meio de um navegador.</span><span class="sxs-lookup"><span data-stu-id="3f40c-276">Figure 7 shows the `Verification.aspx` page when visited through a browser.</span></span>

<span data-ttu-id="3f40c-277">[![a nova conta do usuário agora está aprovada](unlocking-and-approving-user-accounts-vb/_static/image20.png)](unlocking-and-approving-user-accounts-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="3f40c-277">[![The New User's Account is Now Approved](unlocking-and-approving-user-accounts-vb/_static/image20.png)](unlocking-and-approving-user-accounts-vb/_static/image19.png)</span></span>

<span data-ttu-id="3f40c-278">**Figura 7**: a nova conta do usuário agora é aprovada ([clique para exibir a imagem em tamanho normal](unlocking-and-approving-user-accounts-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="3f40c-278">**Figure 7**: The New User's Account is Now Approved  ([Click to view full-size image](unlocking-and-approving-user-accounts-vb/_static/image21.png))</span></span>

## <a name="summary"></a><span data-ttu-id="3f40c-279">Resumo</span><span class="sxs-lookup"><span data-stu-id="3f40c-279">Summary</span></span>

<span data-ttu-id="3f40c-280">Todas as contas de usuário de associação têm dois status que determinam se o usuário pode fazer logon no site: `IsLockedOut` e `IsApproved`.</span><span class="sxs-lookup"><span data-stu-id="3f40c-280">All Membership user accounts have two statuses that determine whether the user can log into the site: `IsLockedOut` and `IsApproved`.</span></span> <span data-ttu-id="3f40c-281">Ambas as propriedades devem ser `True` para que o usuário faça logon.</span><span class="sxs-lookup"><span data-stu-id="3f40c-281">Both of these properties must be `True` for the user to login.</span></span>

<span data-ttu-id="3f40c-282">O status bloqueado do usuário é usado como medida de segurança para reduzir a probabilidade de um hacker invadir um site por meio de métodos de força bruta.</span><span class="sxs-lookup"><span data-stu-id="3f40c-282">The user's locked out status is used as a security measure to reduce the likelihood of a hacker breaking into a site through brute force methods.</span></span> <span data-ttu-id="3f40c-283">Especificamente, um usuário será bloqueado se houver um determinado número de tentativas de logon inválidas dentro de uma determinada janela de tempo.</span><span class="sxs-lookup"><span data-stu-id="3f40c-283">Specifically, a user is locked out if there are a certain number of invalid login attempts within a certain window of time.</span></span> <span data-ttu-id="3f40c-284">Esses limites são configuráveis por meio das configurações do provedor de associação no `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="3f40c-284">These bounds are configurable through the Membership provider settings in `Web.config`.</span></span>

<span data-ttu-id="3f40c-285">O status aprovado é comumente usado como um meio de proibir novos usuários de fazer logon até que alguma ação tenha sido transacionada.</span><span class="sxs-lookup"><span data-stu-id="3f40c-285">The approved status is commonly used as a means to prohibit new users from logging in until some action has transpired.</span></span> <span data-ttu-id="3f40c-286">Talvez o site exija que novas contas sejam aprovadas pela primeira vez pelo administrador ou, como vimos na etapa 3, verificando seu endereço de email.</span><span class="sxs-lookup"><span data-stu-id="3f40c-286">Perhaps the site requires that new accounts first be approved by the administrator or, as we saw in Step 3, by verifying their email address.</span></span>

<span data-ttu-id="3f40c-287">Boa programação!</span><span class="sxs-lookup"><span data-stu-id="3f40c-287">Happy Programming!</span></span>

### <a name="about-the-author"></a><span data-ttu-id="3f40c-288">Sobre o autor</span><span class="sxs-lookup"><span data-stu-id="3f40c-288">About the Author</span></span>

<span data-ttu-id="3f40c-289">Scott Mitchell, autor de vários livros sobre ASP/ASP. NET e fundador da 4GuysFromRolla.com, tem trabalhado com tecnologias Web da Microsoft desde 1998.</span><span class="sxs-lookup"><span data-stu-id="3f40c-289">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="3f40c-290">Scott trabalha como consultor, instrutor e escritor independentes.</span><span class="sxs-lookup"><span data-stu-id="3f40c-290">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="3f40c-291">Seu livro mais recente é que a *[Sams ensina a ASP.NET 2,0 em 24 horas](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)* .</span><span class="sxs-lookup"><span data-stu-id="3f40c-291">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="3f40c-292">Scott pode ser contatado em [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) ou por meio de seu blog em [http://ScottOnWriting.NET](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="3f40c-292">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="3f40c-293">Agradecimentos especiais a...</span><span class="sxs-lookup"><span data-stu-id="3f40c-293">Special Thanks To…</span></span>

<span data-ttu-id="3f40c-294">Esta série de tutoriais foi revisada por muitos revisores úteis.</span><span class="sxs-lookup"><span data-stu-id="3f40c-294">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="3f40c-295">Está interessado em revisar meus artigos futuros do MSDN?</span><span class="sxs-lookup"><span data-stu-id="3f40c-295">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="3f40c-296">Em caso afirmativo, solte-me uma linha em [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="3f40c-296">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="3f40c-297">Anterior</span><span class="sxs-lookup"><span data-stu-id="3f40c-297">Previous</span></span>](recovering-and-changing-passwords-vb.md)
