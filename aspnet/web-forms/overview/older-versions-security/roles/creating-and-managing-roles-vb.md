---
uid: web-forms/overview/older-versions-security/roles/creating-and-managing-roles-vb
title: Criando e gerenciando funções (VB) | Microsoft Docs
author: rick-anderson
description: Este tutorial examina as etapas necessárias para configurar a estrutura de funções. Depois disso, criaremos páginas da Web para criar e excluir funções.
ms.author: riande
ms.date: 03/24/2008
ms.assetid: 83af9f5f-9a00-4f83-8afc-e98bdd49014e
msc.legacyurl: /web-forms/overview/older-versions-security/roles/creating-and-managing-roles-vb
msc.type: authoredcontent
ms.openlocfilehash: 825e2afb750925637d308b7ceb35e1b02b708c1d
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78565383"
---
# <a name="creating-and-managing-roles-vb"></a><span data-ttu-id="e1af5-104">Criar e gerenciar funções (VB)</span><span class="sxs-lookup"><span data-stu-id="e1af5-104">Creating and Managing Roles (VB)</span></span>

<span data-ttu-id="e1af5-105">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="e1af5-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="e1af5-106">[Baixar código](https://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/VB.09.zip) ou [baixar PDF](https://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/aspnet_tutorial09_CreatingRoles_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="e1af5-106">[Download Code](https://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/VB.09.zip) or [Download PDF](https://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/aspnet_tutorial09_CreatingRoles_vb.pdf)</span></span>

> <span data-ttu-id="e1af5-107">Este tutorial examina as etapas necessárias para configurar a estrutura de funções.</span><span class="sxs-lookup"><span data-stu-id="e1af5-107">This tutorial examines the steps necessary for configuring the Roles framework.</span></span> <span data-ttu-id="e1af5-108">Depois disso, criaremos páginas da Web para criar e excluir funções.</span><span class="sxs-lookup"><span data-stu-id="e1af5-108">Following that, we will build web pages to create and delete roles.</span></span>

## <a name="introduction"></a><span data-ttu-id="e1af5-109">Introdução</span><span class="sxs-lookup"><span data-stu-id="e1af5-109">Introduction</span></span>

<span data-ttu-id="e1af5-110">No tutorial <a id="_msoanchor_1"> </a>de [*autorização baseada no usuário*](../membership/user-based-authorization-vb.md) , examinamos o uso da autorização de URL para restringir determinados usuários de um conjunto de páginas e exploramos técnicas declarativas e Programáticas para ajustar a funcionalidade de uma página ASP.NET com base no usuário visitante.</span><span class="sxs-lookup"><span data-stu-id="e1af5-110">In the <a id="_msoanchor_1"></a>[*User-Based Authorization*](../membership/user-based-authorization-vb.md) tutorial we looked at using URL authorization to restrict certain users from a set of pages and explored declarative and programmatic techniques for adjusting an ASP.NET page's functionality based on the visiting user.</span></span> <span data-ttu-id="e1af5-111">No entanto, conceder permissão para acesso à página ou funcionalidade por usuário pode se tornar um pesadelo de manutenção em cenários em que há muitas contas de usuário ou quando os privilégios dos usuários são alterados com frequência.</span><span class="sxs-lookup"><span data-stu-id="e1af5-111">Granting permission for page access or functionality on a user-by-user basis, however, can become a maintenance nightmare in scenarios where there are many user accounts or when users' privileges change often.</span></span> <span data-ttu-id="e1af5-112">Sempre que um usuário Obtém ou perde autorização para executar uma tarefa específica, o administrador precisa atualizar as regras de autorização de URL apropriadas, a marcação declarativa e o código.</span><span class="sxs-lookup"><span data-stu-id="e1af5-112">Any time a user gains or loses authorization to perform a particular task, the administrator needs to update the appropriate URL authorization rules, declarative markup, and code.</span></span>

<span data-ttu-id="e1af5-113">Geralmente, ele ajuda a classificar os usuários em grupos ou *funções* e, em seguida, aplicar permissões a uma base função por função.</span><span class="sxs-lookup"><span data-stu-id="e1af5-113">It usually helps to classify users into groups or *roles* and then to apply permissions on a role-by-role basis.</span></span> <span data-ttu-id="e1af5-114">Por exemplo, a maioria dos aplicativos Web tem um determinado conjunto de páginas ou tarefas que são reservadas somente para usuários administrativos.</span><span class="sxs-lookup"><span data-stu-id="e1af5-114">For example, most web applications have a certain set of pages or tasks that are reserved only for administrative users.</span></span> <span data-ttu-id="e1af5-115">Usando as técnicas aprendidas no tutorial de *autorização baseada no usuário* , adicionaremos as regras de autorização de URL apropriadas, a marcação declarativa e o código para permitir que as contas de usuário especificadas executem tarefas administrativas.</span><span class="sxs-lookup"><span data-stu-id="e1af5-115">Using the techniques learned in the *User-Based Authorization* tutorial, we would add the appropriate URL authorization rules, declarative markup, and code to allow the specified user accounts to perform administrative tasks.</span></span> <span data-ttu-id="e1af5-116">Mas se um novo administrador tiver sido adicionado ou se um administrador existente precisar ter seus direitos de administração revogados, precisaremos retornar e atualizar os arquivos de configuração e as páginas da Web.</span><span class="sxs-lookup"><span data-stu-id="e1af5-116">But if a new administrator was added or if an existing administrator needed to have her administration rights revoked, we would have to return and update the configuration files and web pages.</span></span> <span data-ttu-id="e1af5-117">Com as funções, no entanto, poderíamos criar uma função chamada Administrators e atribuir esses usuários confiáveis à função Administrators.</span><span class="sxs-lookup"><span data-stu-id="e1af5-117">With roles, however, we could create a role called Administrators and assign those trusted users to the Administrators role.</span></span> <span data-ttu-id="e1af5-118">Em seguida, adicionaremos as regras de autorização de URL apropriadas, marcação declarativa e código para permitir que a função Administradores execute as várias tarefas administrativas.</span><span class="sxs-lookup"><span data-stu-id="e1af5-118">Next, we would add the appropriate URL authorization rules, declarative markup, and code to allow the Administrators role to perform the various administrative tasks.</span></span> <span data-ttu-id="e1af5-119">Com essa infraestrutura em vigor, adicionar novos administradores ao site ou remover os existentes é tão simples quanto incluir ou remover o usuário da função Administradores.</span><span class="sxs-lookup"><span data-stu-id="e1af5-119">With this infrastructure in place, adding new administrators to the site or removing existing ones is as simple as including or removing the user from the Administrators role.</span></span> <span data-ttu-id="e1af5-120">Nenhuma configuração, marcação declarativa ou alteração de código é necessária.</span><span class="sxs-lookup"><span data-stu-id="e1af5-120">No configuration, declarative markup, or code changes are necessary.</span></span>

<span data-ttu-id="e1af5-121">O ASP.NET oferece uma estrutura de funções para definir funções e associá-las a contas de usuário.</span><span class="sxs-lookup"><span data-stu-id="e1af5-121">ASP.NET offers a Roles framework for defining roles and associating them with user accounts.</span></span> <span data-ttu-id="e1af5-122">Com a estrutura de funções, podemos criar e excluir funções, adicionar usuários ou remover usuários de uma função, determinar o conjunto de usuários que pertencem a uma função específica e informar se um usuário pertence a uma função específica.</span><span class="sxs-lookup"><span data-stu-id="e1af5-122">With the Roles framework we can create and delete roles, add users to or remove users from a role, determine the set of users that belong to a particular role, and tell whether a user belongs to a particular role.</span></span> <span data-ttu-id="e1af5-123">Depois que a estrutura de funções tiver sido configurada, podemos limitar o acesso a páginas por função por meio de regras de autorização de URL e mostrar ou ocultar informações ou funcionalidades adicionais em uma página com base nas funções do usuário conectado no momento.</span><span class="sxs-lookup"><span data-stu-id="e1af5-123">Once the Roles framework has been configured, we can limit access to pages on a role-by-role basis through URL authorization rules and show or hide additional information or functionality on a page based on the currently logged on user's roles.</span></span>

<span data-ttu-id="e1af5-124">Este tutorial examina as etapas necessárias para configurar a estrutura de funções.</span><span class="sxs-lookup"><span data-stu-id="e1af5-124">This tutorial examines the steps necessary for configuring the Roles framework.</span></span> <span data-ttu-id="e1af5-125">Depois disso, criaremos páginas da Web para criar e excluir funções.</span><span class="sxs-lookup"><span data-stu-id="e1af5-125">Following that, we will build web pages to create and delete roles.</span></span> <span data-ttu-id="e1af5-126"><a id="_msoanchor_2"> </a>No tutorial [*atribuindo funções a usuários*](assigning-roles-to-users-vb.md) , veremos como adicionar e remover usuários de funções.</span><span class="sxs-lookup"><span data-stu-id="e1af5-126">In the <a id="_msoanchor_2"></a>[*Assigning Roles to Users*](assigning-roles-to-users-vb.md) tutorial we will look at how to add and remove users from roles.</span></span> <span data-ttu-id="e1af5-127">E, no <a id="_msoanchor_3"> </a>tutorial de [*autorização baseada em função*](role-based-authorization-vb.md) , veremos como limitar o acesso a páginas por função, juntamente com como ajustar a funcionalidade da página dependendo da função do usuário de visita.</span><span class="sxs-lookup"><span data-stu-id="e1af5-127">And in the <a id="_msoanchor_3"></a>[*Role-Based Authorization*](role-based-authorization-vb.md) tutorial we will see how to limit access to pages on a role-by-role basis along with how to adjust page functionality depending on the visiting user's role.</span></span> <span data-ttu-id="e1af5-128">Vamos começar!</span><span class="sxs-lookup"><span data-stu-id="e1af5-128">Let's get started!</span></span>

## <a name="step-1-adding-new-aspnet-pages"></a><span data-ttu-id="e1af5-129">Etapa 1: adicionando novas páginas do ASP.NET</span><span class="sxs-lookup"><span data-stu-id="e1af5-129">Step 1: Adding New ASP.NET Pages</span></span>

<span data-ttu-id="e1af5-130">Neste tutorial e nos próximos dois, examinaremos várias funções e recursos relacionados a funções.</span><span class="sxs-lookup"><span data-stu-id="e1af5-130">In this tutorial and the next two we will be examining various roles-related functions and capabilities.</span></span> <span data-ttu-id="e1af5-131">Precisaremos de uma série de páginas do ASP.NET para implementar os tópicos examinados em todos esses tutoriais.</span><span class="sxs-lookup"><span data-stu-id="e1af5-131">We will need a series of ASP.NET pages to implement the topics examined throughout these tutorials.</span></span> <span data-ttu-id="e1af5-132">Vamos criar essas páginas e atualizar o mapa do site.</span><span class="sxs-lookup"><span data-stu-id="e1af5-132">Let's create these pages and update the site map.</span></span>

<span data-ttu-id="e1af5-133">Comece criando uma nova pasta no projeto chamada `Roles`.</span><span class="sxs-lookup"><span data-stu-id="e1af5-133">Start by creating a new folder in the project named `Roles`.</span></span> <span data-ttu-id="e1af5-134">Em seguida, adicione quatro novas páginas ASP.NET à pasta `Roles`, vinculando cada página com a `Site.master` página mestra.</span><span class="sxs-lookup"><span data-stu-id="e1af5-134">Next, add four new ASP.NET pages to the `Roles` folder, linking each page with the `Site.master` master page.</span></span> <span data-ttu-id="e1af5-135">Nomeie as páginas:</span><span class="sxs-lookup"><span data-stu-id="e1af5-135">Name the pages:</span></span>

- `ManageRoles.aspx`
- `UsersAndRoles.aspx`
- `CreateUserWizardWithRoles.aspx`
- `RoleBasedAuthorization.aspx`

<span data-ttu-id="e1af5-136">Neste ponto, o Gerenciador de Soluções do seu projeto deve ser semelhante à captura de tela mostrada na Figura 1.</span><span class="sxs-lookup"><span data-stu-id="e1af5-136">At this point your project's Solution Explorer should look similar to the screen shot shown in Figure 1.</span></span>

<span data-ttu-id="e1af5-137">[![quatro novas páginas foram adicionadas à pasta funções](creating-and-managing-roles-vb/_static/image2.png)](creating-and-managing-roles-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="e1af5-137">[![Four New Pages Have Been Added to the Roles Folder](creating-and-managing-roles-vb/_static/image2.png)](creating-and-managing-roles-vb/_static/image1.png)</span></span>

<span data-ttu-id="e1af5-138">**Figura 1**: quatro novas páginas foram adicionadas à pasta `Roles` ([clique para exibir a imagem em tamanho normal](creating-and-managing-roles-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="e1af5-138">**Figure 1**: Four New Pages Have Been Added to the `Roles` Folder  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image3.png))</span></span>

<span data-ttu-id="e1af5-139">Cada página deve, neste ponto, ter os dois controles de conteúdo, um para cada um dos ContentPlaceHolders da página mestra: `MainContent` e `LoginContent`.</span><span class="sxs-lookup"><span data-stu-id="e1af5-139">Each page should, at this point, have the two Content controls, one for each of the master page's ContentPlaceHolders: `MainContent` and `LoginContent`.</span></span>

[!code-aspx[Main](creating-and-managing-roles-vb/samples/sample1.aspx)]

<span data-ttu-id="e1af5-140">Lembre-se de que a marcação padrão do `LoginContent` ContentPlaceHolder exibe um link para fazer logon ou logoff do site, dependendo se o usuário está autenticado.</span><span class="sxs-lookup"><span data-stu-id="e1af5-140">Recall that the `LoginContent` ContentPlaceHolder's default markup displays a link to log on or log off the site, depending on whether the user is authenticated.</span></span> <span data-ttu-id="e1af5-141">No entanto, a presença do controle de conteúdo de `Content2` na página ASP.NET substitui a marcação padrão da página mestra.</span><span class="sxs-lookup"><span data-stu-id="e1af5-141">The presence of the `Content2` Content control in the ASP.NET page, however, overrides the master page's default markup.</span></span> <span data-ttu-id="e1af5-142">Como discutimos em <a id="_msoanchor_4"> </a> [*uma visão geral do tutorial de autenticação de formulários*](../introduction/an-overview-of-forms-authentication-vb.md) , a substituição da marcação padrão é útil em páginas nas quais não queremos exibir opções relacionadas ao logon na coluna à esquerda.</span><span class="sxs-lookup"><span data-stu-id="e1af5-142">As we discussed in <a id="_msoanchor_4"></a>[*An Overview of Forms Authentication*](../introduction/an-overview-of-forms-authentication-vb.md) tutorial, overriding the default markup is useful in pages where we do not want to display login-related options in the left column.</span></span>

<span data-ttu-id="e1af5-143">Para essas quatro páginas, no entanto, queremos mostrar a marcação padrão da página mestra para o `LoginContent` ContentPlaceHolder.</span><span class="sxs-lookup"><span data-stu-id="e1af5-143">For these four pages, however, we want to show the master page's default markup for the `LoginContent` ContentPlaceHolder.</span></span> <span data-ttu-id="e1af5-144">Portanto, remova a marcação declarativa para o controle de conteúdo `Content2`.</span><span class="sxs-lookup"><span data-stu-id="e1af5-144">Therefore, remove the declarative markup for the `Content2` Content control.</span></span> <span data-ttu-id="e1af5-145">Depois de fazer isso, cada uma das quatro marcas da página deve conter apenas um controle de conteúdo.</span><span class="sxs-lookup"><span data-stu-id="e1af5-145">After doing so, each of the four page's markup should contain just one Content control.</span></span>

<span data-ttu-id="e1af5-146">Por fim, vamos atualizar o mapa do site (`Web.sitemap`) para incluir essas novas páginas da Web.</span><span class="sxs-lookup"><span data-stu-id="e1af5-146">Finally, let's update the site map (`Web.sitemap`) to include these new web pages.</span></span> <span data-ttu-id="e1af5-147">Adicione o seguinte XML após o `<siteMapNode>` que adicionamos para os tutoriais de associação.</span><span class="sxs-lookup"><span data-stu-id="e1af5-147">Add the following XML after the `<siteMapNode>` we added for the Membership tutorials.</span></span>

[!code-xml[Main](creating-and-managing-roles-vb/samples/sample2.xml)]

<span data-ttu-id="e1af5-148">Com o mapa do site atualizado, visite o site por meio de um navegador.</span><span class="sxs-lookup"><span data-stu-id="e1af5-148">With the site map updated, visit the site through a browser.</span></span> <span data-ttu-id="e1af5-149">Como mostra a Figura 2, a navegação à esquerda agora inclui itens para os tutoriais de funções.</span><span class="sxs-lookup"><span data-stu-id="e1af5-149">As Figure 2 shows, the navigation on the left now includes items for the Roles tutorials.</span></span>

<span data-ttu-id="e1af5-150">[![quatro novas páginas foram adicionadas à pasta funções](creating-and-managing-roles-vb/_static/image5.png)](creating-and-managing-roles-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="e1af5-150">[![Four New Pages Have Been Added to the Roles Folder](creating-and-managing-roles-vb/_static/image5.png)](creating-and-managing-roles-vb/_static/image4.png)</span></span>

<span data-ttu-id="e1af5-151">**Figura 2**: quatro novas páginas foram adicionadas à pasta `Roles` ([clique para exibir a imagem em tamanho normal](creating-and-managing-roles-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="e1af5-151">**Figure 2**: Four New Pages Have Been Added to the `Roles` Folder  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image6.png))</span></span>

## <a name="step-2-specifying-and-configuring-the-roles-framework-provider"></a><span data-ttu-id="e1af5-152">Etapa 2: especificando e Configurando o provedor de funções de estrutura</span><span class="sxs-lookup"><span data-stu-id="e1af5-152">Step 2: Specifying and Configuring the Roles Framework Provider</span></span>

<span data-ttu-id="e1af5-153">Como a estrutura de associação, a estrutura de funções é criada acima do modelo de provedor.</span><span class="sxs-lookup"><span data-stu-id="e1af5-153">Like the Membership framework, the Roles framework is built atop the provider model.</span></span> <span data-ttu-id="e1af5-154">Conforme discutido no tutorial <a id="_msoanchor_5">de </a> [*suporte básico de segurança e ASP.net*](../introduction/security-basics-and-asp-net-support-vb.md) , o .NET Framework é fornecido com três provedores de funções internas: [`AuthorizationStoreRoleProvider`](https://msdn.microsoft.com/library/system.web.security.authorizationstoreroleprovider.aspx), [`WindowsTokenRoleProvider`](https://msdn.microsoft.com/library/system.web.security.windowstokenroleprovider.aspx)e [`SqlRoleProvider`](https://msdn.microsoft.com/library/system.web.security.sqlroleprovider.aspx).</span><span class="sxs-lookup"><span data-stu-id="e1af5-154">As discussed in the <a id="_msoanchor_5"></a>[*Security Basics and ASP.NET Support*](../introduction/security-basics-and-asp-net-support-vb.md) tutorial, the .NET Framework ships with three built-in Roles providers: [`AuthorizationStoreRoleProvider`](https://msdn.microsoft.com/library/system.web.security.authorizationstoreroleprovider.aspx), [`WindowsTokenRoleProvider`](https://msdn.microsoft.com/library/system.web.security.windowstokenroleprovider.aspx), and [`SqlRoleProvider`](https://msdn.microsoft.com/library/system.web.security.sqlroleprovider.aspx).</span></span> <span data-ttu-id="e1af5-155">Esta série de tutoriais se concentra na `SqlRoleProvider`, que usa um banco de dados Microsoft SQL Server como o armazenamento de função.</span><span class="sxs-lookup"><span data-stu-id="e1af5-155">This tutorial series focuses on the `SqlRoleProvider`, which uses a Microsoft SQL Server database as the role store.</span></span>

<span data-ttu-id="e1af5-156">Embaixo do, a estrutura de funções e `SqlRoleProvider` funcionam da mesma forma que a estrutura de associação e `SqlMembershipProvider`.</span><span class="sxs-lookup"><span data-stu-id="e1af5-156">Underneath the covers the Roles framework and `SqlRoleProvider` work just like the Membership framework and `SqlMembershipProvider`.</span></span> <span data-ttu-id="e1af5-157">O .NET Framework contém uma classe `Roles` que serve como a API para a estrutura de funções.</span><span class="sxs-lookup"><span data-stu-id="e1af5-157">The .NET Framework contains a `Roles` class that serves as the API to the Roles framework.</span></span> <span data-ttu-id="e1af5-158">A classe `Roles` tem métodos compartilhados como `CreateRole`, `DeleteRole`, `GetAllRoles`, `AddUserToRole`, `IsUserInRole`e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="e1af5-158">The `Roles` class has shared methods like `CreateRole`, `DeleteRole`, `GetAllRoles`, `AddUserToRole`, `IsUserInRole`, and so forth.</span></span> <span data-ttu-id="e1af5-159">Quando um desses métodos é invocado, a classe `Roles` delega a chamada para o provedor configurado.</span><span class="sxs-lookup"><span data-stu-id="e1af5-159">When one of these methods is invoked, the `Roles` class delegates the call to the configured provider.</span></span> <span data-ttu-id="e1af5-160">O `SqlRoleProvider` funciona com as tabelas específicas de função (`aspnet_Roles` e `aspnet_UsersInRoles`) em resposta.</span><span class="sxs-lookup"><span data-stu-id="e1af5-160">The `SqlRoleProvider` works with the role-specific tables (`aspnet_Roles` and `aspnet_UsersInRoles`) in response.</span></span>

<span data-ttu-id="e1af5-161">Para usar o provedor de `SqlRoleProvider` em nosso aplicativo, precisamos especificar qual banco de dados usar como repositório.</span><span class="sxs-lookup"><span data-stu-id="e1af5-161">In order to use the `SqlRoleProvider` provider in our application, we need to specify what database to use as the store.</span></span> <span data-ttu-id="e1af5-162">O `SqlRoleProvider` espera que o repositório de função especificado tenha determinadas tabelas de banco de dados, exibições e procedimentos armazenados.</span><span class="sxs-lookup"><span data-stu-id="e1af5-162">The `SqlRoleProvider` expects the specified role store to have certain database tables, views, and stored procedures.</span></span> <span data-ttu-id="e1af5-163">Esses objetos de banco de dados de requisito podem ser adicionados usando a [ferramenta de`aspnet_regsql.exe`](https://msdn.microsoft.com/library/ms229862.aspx).</span><span class="sxs-lookup"><span data-stu-id="e1af5-163">These requisite database objects can be added using the [`aspnet_regsql.exe` tool](https://msdn.microsoft.com/library/ms229862.aspx).</span></span> <span data-ttu-id="e1af5-164">Neste ponto, já temos um banco de dados com o esquema necessário para o `SqlRoleProvider`.</span><span class="sxs-lookup"><span data-stu-id="e1af5-164">At this point we already have a database with the schema necessary for the `SqlRoleProvider`.</span></span> <span data-ttu-id="e1af5-165">De volta ao <a id="_msoanchor_6"> </a>tutorial [*criando o esquema de associação no SQL Server*](../membership/creating-the-membership-schema-in-sql-server-vb.md) , criamos um banco de dados chamado `SecurityTutorials.mdf` e usamos `aspnet_regsql.exe` para adicionar os serviços de aplicativo, que incluíam os objetos de banco de dados exigidos pelo `SqlRoleProvider`.</span><span class="sxs-lookup"><span data-stu-id="e1af5-165">Back in the <a id="_msoanchor_6"></a>[*Creating the Membership Schema in SQL Server*](../membership/creating-the-membership-schema-in-sql-server-vb.md) tutorial we created a database named `SecurityTutorials.mdf` and used `aspnet_regsql.exe` to add the application services, which included the database objects required by the `SqlRoleProvider`.</span></span> <span data-ttu-id="e1af5-166">Portanto, precisamos apenas dizer à estrutura de funções para habilitar o suporte de função e usar o `SqlRoleProvider` com o banco de dados `SecurityTutorials.mdf` como o armazenamento de função.</span><span class="sxs-lookup"><span data-stu-id="e1af5-166">Therefore we just need to tell the Roles framework to enable role support and to use the `SqlRoleProvider` with the `SecurityTutorials.mdf` database as the role store.</span></span>

<span data-ttu-id="e1af5-167">A estrutura de funções é configurada por meio do elemento `<roleManager>` no arquivo de `Web.config` do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e1af5-167">The Roles framework is configured via the `<roleManager>` element in the application's `Web.config` file.</span></span> <span data-ttu-id="e1af5-168">Por padrão, o suporte à função está desabilitado.</span><span class="sxs-lookup"><span data-stu-id="e1af5-168">By default, role support is disabled.</span></span> <span data-ttu-id="e1af5-169">Para habilitá-lo, você deve definir o atributo `enabled` do elemento de [`<roleManager>`](https://msdn.microsoft.com/library/ms164660.aspx) como `true` desta forma:</span><span class="sxs-lookup"><span data-stu-id="e1af5-169">To enable it, you must set the [`<roleManager>`](https://msdn.microsoft.com/library/ms164660.aspx) element's `enabled` attribute to `true` like so:</span></span>

[!code-xml[Main](creating-and-managing-roles-vb/samples/sample3.xml)]

<span data-ttu-id="e1af5-170">Por padrão, todos os aplicativos Web têm um provedor de funções chamado `AspNetSqlRoleProvider` do tipo `SqlRoleProvider`.</span><span class="sxs-lookup"><span data-stu-id="e1af5-170">By default, all web applications have a Roles provider named `AspNetSqlRoleProvider` of type `SqlRoleProvider`.</span></span> <span data-ttu-id="e1af5-171">Esse provedor padrão é registrado no `machine.config` (localizado em `%WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG`):</span><span class="sxs-lookup"><span data-stu-id="e1af5-171">This default provider is registered in `machine.config` (located at `%WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG`):</span></span>

[!code-xml[Main](creating-and-managing-roles-vb/samples/sample4.xml)]

<span data-ttu-id="e1af5-172">O atributo `connectionStringName` do provedor especifica o repositório de função que é usado.</span><span class="sxs-lookup"><span data-stu-id="e1af5-172">The provider's `connectionStringName` attribute specifies the role store that is used.</span></span> <span data-ttu-id="e1af5-173">O provedor de `AspNetSqlRoleProvider` define esse atributo como `LocalSqlServer`, que também é definido em `machine.config` e pontos, por padrão, para um banco de dados SQL Server 2005 Express Edition na pasta `App_Data` chamada `aspnet.mdf`.</span><span class="sxs-lookup"><span data-stu-id="e1af5-173">The `AspNetSqlRoleProvider` provider sets this attribute to `LocalSqlServer`, which is also defined in `machine.config` and points, by default, to a SQL Server 2005 Express Edition database in the `App_Data` folder named `aspnet.mdf`.</span></span>

<span data-ttu-id="e1af5-174">Consequentemente, se simplesmente habilitarmos a estrutura de funções sem especificar nenhuma informação de provedor no arquivo de `Web.config` do nosso aplicativo, o aplicativo usará o provedor de funções registradas padrão, `AspNetSqlRoleProvider`.</span><span class="sxs-lookup"><span data-stu-id="e1af5-174">Consequently, if we simply enable the Roles framework without specifying any provider information in our application's `Web.config` file, the application uses the default registered Roles provider, `AspNetSqlRoleProvider`.</span></span> <span data-ttu-id="e1af5-175">Se o banco de dados `~/App_Data/aspnet.mdf` não existir, o tempo de execução do ASP.NET o criará automaticamente e adicionará o esquema de serviços de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e1af5-175">If the `~/App_Data/aspnet.mdf` database does not exist, the ASP.NET runtime will automatically create it and add the application services schema.</span></span> <span data-ttu-id="e1af5-176">No entanto, não queremos usar o banco de dados `aspnet.mdf`; em vez disso, queremos usar o banco de dados `SecurityTutorials.mdf` que já criamos e adicionamos o esquema de serviços de aplicativo ao.</span><span class="sxs-lookup"><span data-stu-id="e1af5-176">However, we don't want to use the `aspnet.mdf` database; rather, we want to use the `SecurityTutorials.mdf` database that we have already created and added the application services schema to.</span></span> <span data-ttu-id="e1af5-177">Essa modificação pode ser realizada de duas maneiras:</span><span class="sxs-lookup"><span data-stu-id="e1af5-177">This modification can be accomplished in one of two ways:</span></span>

- <span data-ttu-id="e1af5-178"><strong>Especifique um valor para o nome da</strong> cadeia de conexão<strong>`LocalSqlServer`</strong> <strong>em</strong> <strong>`Web.config`</strong> <strong>.</strong></span><span class="sxs-lookup"><span data-stu-id="e1af5-178"><strong>Specify a value for the</strong><strong>`LocalSqlServer`</strong><strong>connection string name in</strong><strong>`Web.config`</strong><strong>.</strong></span></span> <span data-ttu-id="e1af5-179">Ao substituir o valor do nome da cadeia de conexão `LocalSqlServer` no `Web.config`, podemos usar o provedor de funções registradas padrão (`AspNetSqlRoleProvider`) e fazê-lo funcionar corretamente com o banco de dados `SecurityTutorials.mdf`.</span><span class="sxs-lookup"><span data-stu-id="e1af5-179">By overwriting the `LocalSqlServer` connection string name value in `Web.config`, we can use the default registered Roles provider (`AspNetSqlRoleProvider`) and have it correctly work with the `SecurityTutorials.mdf` database.</span></span> <span data-ttu-id="e1af5-180">Para obter mais informações sobre essa técnica, consulte a postagem de blog de [Scott Guthrie](https://weblogs.asp.net/scottgu/), [configurando ASP.NET 2,0 Serviços de Aplicativos para usar SQL Server 2000 ou SQL Server 2005](https://weblogs.asp.net/scottgu/archive/2005/08/25/423703.aspx).</span><span class="sxs-lookup"><span data-stu-id="e1af5-180">For more information on this technique, see [Scott Guthrie](https://weblogs.asp.net/scottgu/)'s blog post, [Configuring ASP.NET 2.0 Application Services to Use SQL Server 2000 or SQL Server 2005](https://weblogs.asp.net/scottgu/archive/2005/08/25/423703.aspx).</span></span>
- <span data-ttu-id="e1af5-181"><strong>Adicione um novo provedor registrado do tipo</strong> <strong>`SqlRoleProvider`</strong> <strong>e defina sua</strong> configuração de<strong>`connectionStringName`</strong> <strong>para apontar para o banco de</strong> dados<strong>`SecurityTutorials.mdf`</strong> <strong>.</strong></span><span class="sxs-lookup"><span data-stu-id="e1af5-181"><strong>Add a new registered provider of type</strong><strong>`SqlRoleProvider`</strong><strong>and configure its</strong><strong>`connectionStringName`</strong><strong>setting to point to the</strong><strong>`SecurityTutorials.mdf`</strong><strong>database.</strong></span></span> <span data-ttu-id="e1af5-182">Essa é a abordagem recomendada e usada no <a id="_msoanchor_7"> </a>tutorial [*criando o esquema de associação no SQL Server*](../membership/creating-the-membership-schema-in-sql-server-vb.md) , e é a abordagem que usarei neste tutorial também.</span><span class="sxs-lookup"><span data-stu-id="e1af5-182">This is the approach I recommended and used in the <a id="_msoanchor_7"></a>[*Creating the Membership Schema in SQL Server*](../membership/creating-the-membership-schema-in-sql-server-vb.md) tutorial, and it is the approach I will use in this tutorial as well.</span></span>

<span data-ttu-id="e1af5-183">Adicione a seguinte marcação de configuração de funções ao arquivo de `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="e1af5-183">Add the following Roles configuration markup to the `Web.config` file.</span></span> <span data-ttu-id="e1af5-184">Essa marcação registra um novo provedor chamado `SecurityTutorialsSqlRoleProvider.`</span><span class="sxs-lookup"><span data-stu-id="e1af5-184">This markup registers a new provider named `SecurityTutorialsSqlRoleProvider.`</span></span>

[!code-xml[Main](creating-and-managing-roles-vb/samples/sample5.xml)]

<span data-ttu-id="e1af5-185">A marcação acima define o `SecurityTutorialsSqlRoleProvider` como o provedor padrão (por meio do atributo `defaultProvider` no elemento `<roleManager>`).</span><span class="sxs-lookup"><span data-stu-id="e1af5-185">The above markup defines the `SecurityTutorialsSqlRoleProvider` as the default provider (via the `defaultProvider` attribute in the `<roleManager>` element).</span></span> <span data-ttu-id="e1af5-186">Ele também define a configuração de `applicationName` do `SecurityTutorialsSqlRoleProvider`como `SecurityTutorials`, que é a mesma `applicationName` configuração usada pelo provedor de associação (`SecurityTutorialsSqlMembershipProvider`).</span><span class="sxs-lookup"><span data-stu-id="e1af5-186">It also sets the `SecurityTutorialsSqlRoleProvider`'s `applicationName` setting to `SecurityTutorials`, which is the same `applicationName` setting used by the Membership provider (`SecurityTutorialsSqlMembershipProvider`).</span></span> <span data-ttu-id="e1af5-187">Embora não seja mostrado aqui, o [elemento`<add>`](https://msdn.microsoft.com/library/ms164662.aspx) para a `SqlRoleProvider` também pode conter um atributo `commandTimeout` para especificar a duração do tempo limite do banco de dados, em segundos.</span><span class="sxs-lookup"><span data-stu-id="e1af5-187">While not shown here, the [`<add>` element](https://msdn.microsoft.com/library/ms164662.aspx) for the `SqlRoleProvider` may also contain a `commandTimeout` attribute to specify the database timeout duration, in seconds.</span></span> <span data-ttu-id="e1af5-188">O valor padrão é 30.</span><span class="sxs-lookup"><span data-stu-id="e1af5-188">The default value is 30.</span></span>

<span data-ttu-id="e1af5-189">Com essa marcação de configuração in-loco, estamos prontos para começar a usar a funcionalidade de função em nosso aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e1af5-189">With this configuration markup in place, we are ready to start using role functionality within our application.</span></span>

> [!NOTE]
> <span data-ttu-id="e1af5-190">A marcação de configuração acima ilustra o uso dos atributos `enabled` e `defaultProvider` do elemento `<roleManager>`.</span><span class="sxs-lookup"><span data-stu-id="e1af5-190">The above configuration markup illustrates using the `<roleManager>` element's `enabled` and `defaultProvider` attributes.</span></span> <span data-ttu-id="e1af5-191">Há vários outros atributos que afetam o modo como a estrutura de funções associa as informações de função de cada usuário.</span><span class="sxs-lookup"><span data-stu-id="e1af5-191">There are a number of other attributes that affect how the Roles framework associates role information on a user-by-user basis.</span></span> <span data-ttu-id="e1af5-192">Examinaremos essas configurações no <a id="_msoanchor_8"> </a>tutorial de [*autorização baseada em funções*](role-based-authorization-vb.md) .</span><span class="sxs-lookup"><span data-stu-id="e1af5-192">We will examine these settings in the <a id="_msoanchor_8"></a>[*Role-Based Authorization*](role-based-authorization-vb.md) tutorial.</span></span>

## <a name="step-3-examining-the-roles-api"></a><span data-ttu-id="e1af5-193">Etapa 3: examinando a API de funções</span><span class="sxs-lookup"><span data-stu-id="e1af5-193">Step 3: Examining the Roles API</span></span>

<span data-ttu-id="e1af5-194">A funcionalidade da estrutura de funções é exposta por meio da [classe`Roles`](https://msdn.microsoft.com/library/system.web.security.roles.aspx), que contém treze métodos compartilhados para executar operações baseadas em funções.</span><span class="sxs-lookup"><span data-stu-id="e1af5-194">The Roles framework's functionality is exposed via the [`Roles` class](https://msdn.microsoft.com/library/system.web.security.roles.aspx), which contains thirteen shared methods for performing role-based operations.</span></span> <span data-ttu-id="e1af5-195">Quando examinamos a criação e a exclusão de funções nas etapas 4 e 6, usaremos os métodos [`CreateRole`](https://msdn.microsoft.com/library/system.web.security.roles.createrole.aspx) e [`DeleteRole`](https://msdn.microsoft.com/library/system.web.security.roles.deleterole.aspx) , que adicionam ou removem uma função do sistema.</span><span class="sxs-lookup"><span data-stu-id="e1af5-195">When we look at creating and deleting roles in Steps 4 and 6 we will use the [`CreateRole`](https://msdn.microsoft.com/library/system.web.security.roles.createrole.aspx) and [`DeleteRole`](https://msdn.microsoft.com/library/system.web.security.roles.deleterole.aspx) methods, which add or remove a role from the system.</span></span>

<span data-ttu-id="e1af5-196">Para obter uma lista de todas as funções no sistema, use o [método`GetAllRoles`](https://msdn.microsoft.com/library/system.web.security.roles.getallroles.aspx) (consulte a etapa 5).</span><span class="sxs-lookup"><span data-stu-id="e1af5-196">To get a list of all of the roles in the system, use the [`GetAllRoles` method](https://msdn.microsoft.com/library/system.web.security.roles.getallroles.aspx) (see Step 5).</span></span> <span data-ttu-id="e1af5-197">O [método`RoleExists`](https://msdn.microsoft.com/library/system.web.security.roles.roleexists.aspx) retorna um valor booliano que indica se existe uma função especificada.</span><span class="sxs-lookup"><span data-stu-id="e1af5-197">The [`RoleExists` method](https://msdn.microsoft.com/library/system.web.security.roles.roleexists.aspx) returns a Boolean value indicating whether a specified role exists.</span></span>

<span data-ttu-id="e1af5-198">No próximo tutorial, examinaremos como associar usuários a funções.</span><span class="sxs-lookup"><span data-stu-id="e1af5-198">In the next tutorial we will examine how to associate users with roles.</span></span> <span data-ttu-id="e1af5-199">Os métodos [`AddUserToRole`](https://msdn.microsoft.com/library/system.web.security.roles.addusertorole.aspx), [`AddUserToRoles`](https://msdn.microsoft.com/library/system.web.security.roles.addusertoroles.aspx), [`AddUsersToRole`](https://msdn.microsoft.com/library/system.web.security.roles.adduserstorole.aspx)e [`AddUsersToRoles`](https://msdn.microsoft.com/library/system.web.security.roles.adduserstoroles.aspx) da classe `Roles` adicionam um ou mais usuários a uma ou mais funções.</span><span class="sxs-lookup"><span data-stu-id="e1af5-199">The `Roles` class's [`AddUserToRole`](https://msdn.microsoft.com/library/system.web.security.roles.addusertorole.aspx), [`AddUserToRoles`](https://msdn.microsoft.com/library/system.web.security.roles.addusertoroles.aspx), [`AddUsersToRole`](https://msdn.microsoft.com/library/system.web.security.roles.adduserstorole.aspx), and [`AddUsersToRoles`](https://msdn.microsoft.com/library/system.web.security.roles.adduserstoroles.aspx) methods add one or more users to one or more roles.</span></span> <span data-ttu-id="e1af5-200">Para remover usuários de funções, use os métodos [`RemoveUserFromRole`](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromrole.aspx), [`RemoveUserFromRoles`](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromroles.aspx), [`RemoveUsersFromRole`](https://msdn.microsoft.com/library/system.web.security.roles.removeusersfromrole.aspx)ou [`RemoveUsersFromRoles`](https://msdn.microsoft.com/library/system.web.security.roles.removeusersfromroles.aspx) .</span><span class="sxs-lookup"><span data-stu-id="e1af5-200">To remove users from roles, use the [`RemoveUserFromRole`](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromrole.aspx), [`RemoveUserFromRoles`](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromroles.aspx), [`RemoveUsersFromRole`](https://msdn.microsoft.com/library/system.web.security.roles.removeusersfromrole.aspx), or [`RemoveUsersFromRoles`](https://msdn.microsoft.com/library/system.web.security.roles.removeusersfromroles.aspx) methods.</span></span>

<span data-ttu-id="e1af5-201"><a id="_msoanchor_9"> </a>No tutorial de [*autorização baseada em funções*](role-based-authorization-vb.md) , veremos maneiras de mostrar ou ocultar programaticamente a funcionalidade com base na função do usuário conectado no momento.</span><span class="sxs-lookup"><span data-stu-id="e1af5-201">In the <a id="_msoanchor_9"></a>[*Role-Based Authorization*](role-based-authorization-vb.md) tutorial we will look at ways to programmatically show or hide functionality based on the currently logged in user's role.</span></span> <span data-ttu-id="e1af5-202">Para isso, podemos usar os métodos [`FindUsersInRole`](https://msdn.microsoft.com/library/system.web.security.roles.findusersinrole.aspx), [`GetRolesForUser`](https://msdn.microsoft.com/library/system.web.security.roles.getrolesforuser.aspx), [`GetUsersInRole`](https://msdn.microsoft.com/library/system.web.security.roles.getusersinrole.aspx)ou [`IsUserInRole`](https://msdn.microsoft.com/library/system.web.security.roles.isuserinrole.aspx) da classe de função.</span><span class="sxs-lookup"><span data-stu-id="e1af5-202">To accomplish this, we can use the Role class's [`FindUsersInRole`](https://msdn.microsoft.com/library/system.web.security.roles.findusersinrole.aspx), [`GetRolesForUser`](https://msdn.microsoft.com/library/system.web.security.roles.getrolesforuser.aspx), [`GetUsersInRole`](https://msdn.microsoft.com/library/system.web.security.roles.getusersinrole.aspx), or [`IsUserInRole`](https://msdn.microsoft.com/library/system.web.security.roles.isuserinrole.aspx) methods.</span></span>

> [!NOTE]
> <span data-ttu-id="e1af5-203">Tenha em mente que, sempre que um desses métodos for invocado, a classe `Roles` delegará a chamada para o provedor configurado.</span><span class="sxs-lookup"><span data-stu-id="e1af5-203">Keep in mind that any time one of these methods is invoked, the `Roles` class delegates the call to the configured provider.</span></span> <span data-ttu-id="e1af5-204">Em nosso caso, isso significa que a chamada está sendo enviada para o `SqlRoleProvider`.</span><span class="sxs-lookup"><span data-stu-id="e1af5-204">In our case, this means that the call is being sent to the `SqlRoleProvider`.</span></span> <span data-ttu-id="e1af5-205">Em seguida, a `SqlRoleProvider` executa a operação de banco de dados apropriada com base no método invocado.</span><span class="sxs-lookup"><span data-stu-id="e1af5-205">The `SqlRoleProvider` then performs the appropriate database operation based on the invoked method.</span></span> <span data-ttu-id="e1af5-206">Por exemplo, o código `Roles.CreateRole("Administrators")` resulta na `SqlRoleProvider` execução do procedimento armazenado `aspnet_Roles_CreateRole`, que insere um novo registro na tabela `aspnet_Roles` chamada Administrators.</span><span class="sxs-lookup"><span data-stu-id="e1af5-206">For example, the code `Roles.CreateRole("Administrators")` results in the `SqlRoleProvider` executing the `aspnet_Roles_CreateRole` stored procedure, which inserts a new record into the `aspnet_Roles` table named Administrators .</span></span>

<span data-ttu-id="e1af5-207">O restante deste tutorial analisa o uso dos métodos `CreateRole`, `GetAllRoles`e `DeleteRole` da classe `Roles` para gerenciar as funções no sistema.</span><span class="sxs-lookup"><span data-stu-id="e1af5-207">The remainder of this tutorial looks at using the `Roles` class's `CreateRole`, `GetAllRoles`, and `DeleteRole` methods to manage the roles in the system.</span></span>

## <a name="step-4-creating-new-roles"></a><span data-ttu-id="e1af5-208">Etapa 4: criando novas funções</span><span class="sxs-lookup"><span data-stu-id="e1af5-208">Step 4: Creating New Roles</span></span>

<span data-ttu-id="e1af5-209">As funções oferecem uma maneira de agrupar arbitrariamente os usuários e, mais comumente, esse agrupamento é usado para uma maneira mais conveniente de aplicar regras de autorização.</span><span class="sxs-lookup"><span data-stu-id="e1af5-209">Roles offer a way to arbitrarily group users, and most commonly this grouping is used for a more convenient way to apply authorization rules.</span></span> <span data-ttu-id="e1af5-210">Mas, para usar funções como um mecanismo de autorização, primeiro precisamos definir quais funções existem no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e1af5-210">But in order to use roles as an authorization mechanism we first need to define what roles exist in the application.</span></span> <span data-ttu-id="e1af5-211">Infelizmente, o ASP.NET não inclui um controle CreateRoleWizard.</span><span class="sxs-lookup"><span data-stu-id="e1af5-211">Unfortunately, ASP.NET does not include a CreateRoleWizard control.</span></span> <span data-ttu-id="e1af5-212">Para adicionar novas funções, precisamos criar uma interface do usuário adequada e invocar a API de funções sozinhos.</span><span class="sxs-lookup"><span data-stu-id="e1af5-212">In order to add new roles we need to create a suitable user interface and invoke the Roles API ourselves.</span></span> <span data-ttu-id="e1af5-213">A boa notícia é que isso é muito fácil de realizar.</span><span class="sxs-lookup"><span data-stu-id="e1af5-213">The good news is that this is very easy to accomplish.</span></span>

> [!NOTE]
> <span data-ttu-id="e1af5-214">Embora não haja nenhum controle da Web CreateRoleWizard, há a [ferramenta de administração de site da ASP.net](https://msdn.microsoft.com/library/ms228053.aspx), que é um aplicativo ASP.net local projetado para ajudar a exibir e gerenciar a configuração de seu aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="e1af5-214">While there is no CreateRoleWizard Web control, there is the [ASP.NET Web Site Administration Tool](https://msdn.microsoft.com/library/ms228053.aspx), which is a local ASP.NET application designed to assist with viewing and managing your web application's configuration.</span></span> <span data-ttu-id="e1af5-215">No entanto, não sou um grande fã da ferramenta de administração de site ASP.NET por dois motivos.</span><span class="sxs-lookup"><span data-stu-id="e1af5-215">However, I am not a big fan of the ASP.NET Web Site Administration Tool for two reasons.</span></span> <span data-ttu-id="e1af5-216">Primeiro, trata-se de um pouco de bugs e a experiência do usuário deixa muito a desejar.</span><span class="sxs-lookup"><span data-stu-id="e1af5-216">First, it is a bit buggy and the user experience leaves a lot to be desired.</span></span> <span data-ttu-id="e1af5-217">Segundo, a ferramenta de administração de site ASP.NET foi projetada para funcionar localmente, o que significa que você terá que criar suas próprias páginas da Web de gerenciamento de funções se precisar gerenciar funções em um site ativo remotamente.</span><span class="sxs-lookup"><span data-stu-id="e1af5-217">Second, the ASP.NET Web Site Administration Tool is designed to only work locally, meaning that you will have to build your own role management web pages if you need to manage roles on a live site remotely.</span></span> <span data-ttu-id="e1af5-218">Por esses dois motivos, este tutorial e o próximo se concentrarão na criação das ferramentas de gerenciamento de função necessárias em uma página da Web, em vez de depender da ferramenta de administração de site ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="e1af5-218">For these two reasons, this tutorial and the next will focus on building the necessary role management tools in a web page rather than relying on the ASP.NET Web Site Administration Tool.</span></span>

<span data-ttu-id="e1af5-219">Abra a página `ManageRoles.aspx` na pasta `Roles` e adicione uma caixa de texto e um controle botão da Web para a página.</span><span class="sxs-lookup"><span data-stu-id="e1af5-219">Open the `ManageRoles.aspx` page in the `Roles` folder and add a TextBox and a Button Web control to the page.</span></span> <span data-ttu-id="e1af5-220">Defina a propriedade `ID` do controle TextBox como `RoleName` e as propriedades `ID` e `Text` do botão como `CreateRoleButton` e crie a função, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="e1af5-220">Set the TextBox control's `ID` property to `RoleName` and the Button's `ID` and `Text` properties to `CreateRoleButton` and Create Role, respectively.</span></span> <span data-ttu-id="e1af5-221">Neste ponto, a marcação declarativa de sua página deve ser semelhante ao seguinte:</span><span class="sxs-lookup"><span data-stu-id="e1af5-221">At this point, your page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](creating-and-managing-roles-vb/samples/sample6.aspx)]

<span data-ttu-id="e1af5-222">Em seguida, clique duas vezes no controle botão de `CreateRoleButton` no designer para criar um manipulador de eventos `Click` e, em seguida, adicione o seguinte código:</span><span class="sxs-lookup"><span data-stu-id="e1af5-222">Next, double-click the `CreateRoleButton` Button control in the Designer to create a `Click` event handler and then add the following code:</span></span>

[!code-vb[Main](creating-and-managing-roles-vb/samples/sample7.vb)]

<span data-ttu-id="e1af5-223">O código acima começa atribuindo o nome da função cortada inserida na caixa de texto `RoleName` à variável `newRoleName`.</span><span class="sxs-lookup"><span data-stu-id="e1af5-223">The above code starts by assigning the trimmed role name entered in the `RoleName` TextBox to the `newRoleName` variable.</span></span> <span data-ttu-id="e1af5-224">Em seguida, o método `RoleExists` da classe `Roles` é chamado para determinar se a função `newRoleName` já existe no sistema.</span><span class="sxs-lookup"><span data-stu-id="e1af5-224">Next, the `Roles` class's `RoleExists` method is called to determine if the role `newRoleName` already exists in the system.</span></span> <span data-ttu-id="e1af5-225">Se a função não existir, ela será criada por meio de uma chamada para o método `CreateRole`.</span><span class="sxs-lookup"><span data-stu-id="e1af5-225">If the role does not exist, it is created via a call to the `CreateRole` method.</span></span> <span data-ttu-id="e1af5-226">Se o método de `CreateRole` for passado um nome de função que já existe no sistema, uma exceção de `ProviderException` será lançada.</span><span class="sxs-lookup"><span data-stu-id="e1af5-226">If the `CreateRole` method is passed a role name that already exists in the system, a `ProviderException` exception is thrown.</span></span> <span data-ttu-id="e1af5-227">É por isso que o código verifica primeiro se a função ainda não existe no sistema antes de chamar `CreateRole`.</span><span class="sxs-lookup"><span data-stu-id="e1af5-227">This is why the code first checks to ensure that the role does not already exist in the system before calling `CreateRole`.</span></span> <span data-ttu-id="e1af5-228">O manipulador de eventos `Click` é concluído desmarcando a propriedade `Text` da `RoleName` caixa de texto.</span><span class="sxs-lookup"><span data-stu-id="e1af5-228">The `Click` event handler concludes by clearing out the `RoleName` TextBox's `Text` property.</span></span>

> [!NOTE]
> <span data-ttu-id="e1af5-229">Você deve estar se perguntando o que acontecerá se o usuário não inserir nenhum valor na caixa de texto `RoleName`.</span><span class="sxs-lookup"><span data-stu-id="e1af5-229">You may be wondering what will happen if the user doesn't enter any value into the `RoleName` TextBox.</span></span> <span data-ttu-id="e1af5-230">Se o valor passado para o método `CreateRole` for `Nothing` ou uma cadeia de caracteres vazia, uma exceção será gerada.</span><span class="sxs-lookup"><span data-stu-id="e1af5-230">If the value passed into the `CreateRole` method is `Nothing` or an empty string, an exception is raised.</span></span> <span data-ttu-id="e1af5-231">Da mesma forma, se o nome da função contiver uma vírgula, uma exceção será gerada.</span><span class="sxs-lookup"><span data-stu-id="e1af5-231">Likewise, if the role name contains a comma an exception is raised.</span></span> <span data-ttu-id="e1af5-232">Consequentemente, a página deve conter controles de validação para garantir que o usuário insira uma função e que não contenha vírgulas.</span><span class="sxs-lookup"><span data-stu-id="e1af5-232">Consequently, the page should contain validation controls to ensure that the user enters a role and that it does not contain any commas.</span></span> <span data-ttu-id="e1af5-233">Eu deixe como um exercício para o leitor.</span><span class="sxs-lookup"><span data-stu-id="e1af5-233">I leave as an exercise for the reader.</span></span>

<span data-ttu-id="e1af5-234">Vamos criar uma função chamada Administrators.</span><span class="sxs-lookup"><span data-stu-id="e1af5-234">Let's create a role named Administrators.</span></span> <span data-ttu-id="e1af5-235">Visite a página `ManageRoles.aspx` por meio de um navegador, digite administradores na caixa de texto (veja a Figura 3) e, em seguida, clique no botão criar função.</span><span class="sxs-lookup"><span data-stu-id="e1af5-235">Visit the `ManageRoles.aspx` page through a browser, type in Administrators into the textbox (see Figure 3), and then click the Create Role button.</span></span>

<span data-ttu-id="e1af5-236">[![criar uma função de administradores](creating-and-managing-roles-vb/_static/image8.png)](creating-and-managing-roles-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="e1af5-236">[![Create an Administrators Role](creating-and-managing-roles-vb/_static/image8.png)](creating-and-managing-roles-vb/_static/image7.png)</span></span>

<span data-ttu-id="e1af5-237">**Figura 3**: criar uma função de administradores ([clique para exibir a imagem em tamanho normal](creating-and-managing-roles-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="e1af5-237">**Figure 3**: Create an Administrators Role  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image9.png))</span></span>

<span data-ttu-id="e1af5-238">O que acontece?</span><span class="sxs-lookup"><span data-stu-id="e1af5-238">What happens?</span></span> <span data-ttu-id="e1af5-239">Ocorre um postback, mas não há nenhuma indicação visual de que a função foi realmente adicionada ao sistema.</span><span class="sxs-lookup"><span data-stu-id="e1af5-239">A postback occurs, but there's no visual cue that the role has actually been added to the system.</span></span> <span data-ttu-id="e1af5-240">Atualizaremos esta página na etapa 5 para incluir comentários visuais.</span><span class="sxs-lookup"><span data-stu-id="e1af5-240">We will update this page in Step 5 to include visual feedback.</span></span> <span data-ttu-id="e1af5-241">Por enquanto, no entanto, você pode verificar se a função foi criada acessando o banco de dados `SecurityTutorials.mdf` e exibindo-os na tabela `aspnet_Roles`.</span><span class="sxs-lookup"><span data-stu-id="e1af5-241">For now, however, you can verify that the role was created by going to the `SecurityTutorials.mdf` database and displaying the data from the `aspnet_Roles` table.</span></span> <span data-ttu-id="e1af5-242">Como mostra a Figura 4, a tabela `aspnet_Roles` contém um registro para as funções de administradores recém-adicionadas.</span><span class="sxs-lookup"><span data-stu-id="e1af5-242">As Figure 4 shows, the `aspnet_Roles` table contains a record for the just-added Administrators roles.</span></span>

<span data-ttu-id="e1af5-243">[![a tabela aspnet_Roles tem uma linha para os administradores](creating-and-managing-roles-vb/_static/image11.png)](creating-and-managing-roles-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="e1af5-243">[![The aspnet_Roles Table has a Row for the Administrators](creating-and-managing-roles-vb/_static/image11.png)](creating-and-managing-roles-vb/_static/image10.png)</span></span>

<span data-ttu-id="e1af5-244">**Figura 4**: a tabela `aspnet_Roles` tem uma linha para os administradores ([clique para exibir a imagem em tamanho normal](creating-and-managing-roles-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="e1af5-244">**Figure 4**: The `aspnet_Roles` Table has a Row for the Administrators  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image12.png))</span></span>

## <a name="step-5-displaying-the-roles-in-the-system"></a><span data-ttu-id="e1af5-245">Etapa 5: exibindo as funções no sistema</span><span class="sxs-lookup"><span data-stu-id="e1af5-245">Step 5: Displaying the Roles in the System</span></span>

<span data-ttu-id="e1af5-246">Vamos aumentar a `ManageRoles.aspx` página para incluir uma lista das funções atuais no sistema.</span><span class="sxs-lookup"><span data-stu-id="e1af5-246">Let's augment the `ManageRoles.aspx` page to include a list of the current roles in the system.</span></span> <span data-ttu-id="e1af5-247">Para fazer isso, adicione um controle GridView à página e defina sua propriedade `ID` como `RoleList`.</span><span class="sxs-lookup"><span data-stu-id="e1af5-247">To accomplish this, add a GridView control to the page and set its `ID` property to `RoleList`.</span></span> <span data-ttu-id="e1af5-248">Em seguida, adicione um método à classe code-behind da página chamada `DisplayRolesInGrid` usando o seguinte código:</span><span class="sxs-lookup"><span data-stu-id="e1af5-248">Next, add a method to the page's code-behind class named `DisplayRolesInGrid` using the following code:</span></span>

[!code-vb[Main](creating-and-managing-roles-vb/samples/sample8.vb)]

<span data-ttu-id="e1af5-249">O método `GetAllRoles` da classe `Roles` retorna todas as funções no sistema como uma matriz de cadeias de caracteres.</span><span class="sxs-lookup"><span data-stu-id="e1af5-249">The `Roles` class's `GetAllRoles` method returns all of the roles in the system as an array of strings.</span></span> <span data-ttu-id="e1af5-250">Em seguida, essa matriz de cadeia de caracteres é associada ao GridView.</span><span class="sxs-lookup"><span data-stu-id="e1af5-250">This string array is then bound to the GridView.</span></span> <span data-ttu-id="e1af5-251">Para associar a lista de funções ao GridView quando a página é carregada pela primeira vez, precisamos chamar o método `DisplayRolesInGrid` do manipulador de eventos `Page_Load` da página.</span><span class="sxs-lookup"><span data-stu-id="e1af5-251">In order to bind the list of roles to the GridView when the page is first loaded, we need to call the `DisplayRolesInGrid` method from the page's `Page_Load` event handler.</span></span> <span data-ttu-id="e1af5-252">O código a seguir chama esse método quando a página é visitada pela primeira vez, mas não em postbacks subsequentes.</span><span class="sxs-lookup"><span data-stu-id="e1af5-252">The following code calls this method when the page is first visited, but not on subsequent postbacks.</span></span>

[!code-vb[Main](creating-and-managing-roles-vb/samples/sample9.vb)]

<span data-ttu-id="e1af5-253">Com esse código em vigor, visite a página por meio de um navegador.</span><span class="sxs-lookup"><span data-stu-id="e1af5-253">With this code in place, visit the page through a browser.</span></span> <span data-ttu-id="e1af5-254">Como mostra a Figura 5, você deve ver uma grade com uma única coluna rotulada item.</span><span class="sxs-lookup"><span data-stu-id="e1af5-254">As Figure 5 shows, you should see a grid with a single column labeled Item.</span></span> <span data-ttu-id="e1af5-255">A grade inclui uma linha para a função administradores que adicionamos na etapa 4.</span><span class="sxs-lookup"><span data-stu-id="e1af5-255">The grid includes a row for the Administrators role we added in Step 4.</span></span>

<span data-ttu-id="e1af5-256">[![o GridView exibe as funções em uma única coluna](creating-and-managing-roles-vb/_static/image14.png)](creating-and-managing-roles-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="e1af5-256">[![The GridView Displays the Roles in a Single Column](creating-and-managing-roles-vb/_static/image14.png)](creating-and-managing-roles-vb/_static/image13.png)</span></span>

<span data-ttu-id="e1af5-257">**Figura 5**: o GridView exibe as funções em uma única coluna ([clique para exibir a imagem em tamanho normal](creating-and-managing-roles-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="e1af5-257">**Figure 5**: The GridView Displays the Roles in a Single Column  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image15.png))</span></span>

<span data-ttu-id="e1af5-258">O GridView exibe uma coluna solitário rotulada como item porque a propriedade `AutoGenerateColumns` do GridView está definida como true (o padrão), o que faz com que o GridView crie automaticamente uma coluna para cada propriedade em seu `DataSource`.</span><span class="sxs-lookup"><span data-stu-id="e1af5-258">The GridView displays a lone column labeled Item because the GridView's `AutoGenerateColumns` property is set to True (the default), which causes the GridView to automatically create a column for each property in its `DataSource`.</span></span> <span data-ttu-id="e1af5-259">Uma matriz tem uma única propriedade que representa os elementos na matriz, portanto, a única coluna no GridView.</span><span class="sxs-lookup"><span data-stu-id="e1af5-259">An array has a single property that represents the elements in the array, hence the single column in the GridView.</span></span>

<span data-ttu-id="e1af5-260">Ao exibir dados com um GridView, prefiro definir explicitamente minhas colunas em vez de tê-las implicitamente geradas pelo GridView.</span><span class="sxs-lookup"><span data-stu-id="e1af5-260">When displaying data with a GridView, I prefer to explicitly define my columns rather than have them implicitly generated by the GridView.</span></span> <span data-ttu-id="e1af5-261">Ao definir explicitamente as colunas, é muito mais fácil formatar os dados, reorganizá-las e executar outras tarefas comuns.</span><span class="sxs-lookup"><span data-stu-id="e1af5-261">By explicitly defining the columns it is much easier to format the data, rearrange the columns, and perform other common tasks.</span></span> <span data-ttu-id="e1af5-262">Portanto, vamos atualizar a marcação declarativa do GridView para que suas colunas sejam definidas explicitamente.</span><span class="sxs-lookup"><span data-stu-id="e1af5-262">Therefore, let's update the GridView's declarative markup so that its columns are explicitly defined.</span></span>

<span data-ttu-id="e1af5-263">Comece definindo a propriedade `AutoGenerateColumns` do GridView como false.</span><span class="sxs-lookup"><span data-stu-id="e1af5-263">Start by setting the GridView's `AutoGenerateColumns` property to False.</span></span> <span data-ttu-id="e1af5-264">Em seguida, adicione um TemplateField à grade, defina sua propriedade `HeaderText` como funções e configure seu `ItemTemplate` para que ele exiba o conteúdo da matriz.</span><span class="sxs-lookup"><span data-stu-id="e1af5-264">Next, add a TemplateField to the grid, set its `HeaderText` property to Roles, and configure its `ItemTemplate` so that it displays the contents of the array.</span></span> <span data-ttu-id="e1af5-265">Para fazer isso, adicione um controle da Web de rótulo chamado `RoleNameLabel` ao `ItemTemplate` e associe sua propriedade `Text` a `Container.DataItem.`</span><span class="sxs-lookup"><span data-stu-id="e1af5-265">To accomplish this, add a Label Web control named `RoleNameLabel` to the `ItemTemplate` and bind its `Text` property to `Container.DataItem.`</span></span>

<span data-ttu-id="e1af5-266">Essas propriedades e o conteúdo do `ItemTemplate`podem ser definidos declarativamente ou por meio da caixa de diálogo campos do GridView e da interface de edição de modelos.</span><span class="sxs-lookup"><span data-stu-id="e1af5-266">These properties and the `ItemTemplate`'s contents can be set declaratively or through the GridView's Fields dialog box and Edit Templates interface.</span></span> <span data-ttu-id="e1af5-267">Para acessar a caixa de diálogo campos, clique no link Editar colunas na marca inteligente do GridView.</span><span class="sxs-lookup"><span data-stu-id="e1af5-267">To reach the Fields dialog box, click the Edit Columns link in the GridView's Smart Tag.</span></span> <span data-ttu-id="e1af5-268">Em seguida, desmarque a caixa de seleção Gerar campos automaticamente para definir a propriedade `AutoGenerateColumns` como false e adicione um TemplateField ao GridView, definindo sua propriedade `HeaderText` como Role.</span><span class="sxs-lookup"><span data-stu-id="e1af5-268">Next, uncheck the Auto-generate fields checkbox to set the `AutoGenerateColumns` property to False, and add a TemplateField to the GridView, setting its `HeaderText` property to Role.</span></span> <span data-ttu-id="e1af5-269">Para definir o conteúdo do `ItemTemplate`, escolha a opção Editar modelos na marca inteligente do GridView.</span><span class="sxs-lookup"><span data-stu-id="e1af5-269">To define the `ItemTemplate`'s contents, choose the Edit Templates option from the GridView's Smart Tag.</span></span> <span data-ttu-id="e1af5-270">Arraste um controle de rótulo da Web para a `ItemTemplate`, defina sua propriedade `ID` como `RoleNameLabel`e defina suas configurações de associação de dados para que sua propriedade `Text` esteja associada a `Container.DataItem`.</span><span class="sxs-lookup"><span data-stu-id="e1af5-270">Drag a Label Web control onto the `ItemTemplate`, set its `ID` property to `RoleNameLabel`, and configure its databinding settings so that its `Text` property is bound to `Container.DataItem`.</span></span>

<span data-ttu-id="e1af5-271">Independentemente da abordagem que você usar, a marcação declarativa resultante do GridView deve ser semelhante ao seguinte quando você terminar.</span><span class="sxs-lookup"><span data-stu-id="e1af5-271">Regardless of what approach you use, the GridView's resulting declarative markup should look similar to the following when you are done.</span></span>

[!code-aspx[Main](creating-and-managing-roles-vb/samples/sample10.aspx)]

> [!NOTE]
> <span data-ttu-id="e1af5-272">O conteúdo da matriz é exibido usando a sintaxe de vinculação de dados `<%# Container.DataItem %>`.</span><span class="sxs-lookup"><span data-stu-id="e1af5-272">The array's contents are displayed using the databinding syntax `<%# Container.DataItem %>`.</span></span> <span data-ttu-id="e1af5-273">Uma descrição completa do motivo pelo qual essa sintaxe é usada ao exibir o conteúdo de uma matriz associada ao GridView está além do escopo deste tutorial.</span><span class="sxs-lookup"><span data-stu-id="e1af5-273">A thorough description of why this syntax is used when displaying the contents of an array bound to the GridView is beyond the scope of this tutorial.</span></span> <span data-ttu-id="e1af5-274">Para obter mais informações sobre esse assunto, consulte [associando uma matriz escalar a um controle da Web de dados](http://aspnet.4guysfromrolla.com/articles/082504-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="e1af5-274">For more information on this matter, refer to [Binding a Scalar Array to a Data Web Control](http://aspnet.4guysfromrolla.com/articles/082504-1.aspx).</span></span>

<span data-ttu-id="e1af5-275">Atualmente, o `RoleList` GridView só é associado à lista de funções quando a página é visitada pela primeira vez.</span><span class="sxs-lookup"><span data-stu-id="e1af5-275">Currently, the `RoleList` GridView is only bound to the list of roles when the page is first visited.</span></span> <span data-ttu-id="e1af5-276">Precisamos atualizar a grade sempre que uma nova função for adicionada.</span><span class="sxs-lookup"><span data-stu-id="e1af5-276">We need to refresh the grid whenever a new role is added.</span></span> <span data-ttu-id="e1af5-277">Para fazer isso, atualize o manipulador de eventos `Click` do botão `CreateRoleButton` para que ele chame o método `DisplayRolesInGrid` se uma nova função for criada.</span><span class="sxs-lookup"><span data-stu-id="e1af5-277">To accomplish this, update the `CreateRoleButton` Button's `Click` event handler so that it calls the `DisplayRolesInGrid` method if a new role is created.</span></span>

[!code-vb[Main](creating-and-managing-roles-vb/samples/sample11.vb)]

<span data-ttu-id="e1af5-278">Agora, quando o usuário adiciona uma nova função, o `RoleList` GridView mostra a função recém-adicionada no postback, fornecendo comentários visuais de que a função foi criada com êxito.</span><span class="sxs-lookup"><span data-stu-id="e1af5-278">Now when the user adds a new role the `RoleList` GridView shows the just-added role on postback, providing visual feedback that the role was successfully created.</span></span> <span data-ttu-id="e1af5-279">Para ilustrar isso, visite a página `ManageRoles.aspx` por meio de um navegador e adicione uma função denominada supervisores.</span><span class="sxs-lookup"><span data-stu-id="e1af5-279">To illustrate this, visit the `ManageRoles.aspx` page through a browser and add a role named Supervisors.</span></span> <span data-ttu-id="e1af5-280">Ao clicar no botão criar função, um postback será acontecerdo e a grade será atualizada para incluir administradores, bem como a nova função, supervisores.</span><span class="sxs-lookup"><span data-stu-id="e1af5-280">Upon clicking the Create Role button, a postback will ensue and the grid will update to include Administrators as well as the new role, Supervisors.</span></span>

<span data-ttu-id="e1af5-281">[![a função de supervisores foi adicionada](creating-and-managing-roles-vb/_static/image17.png)](creating-and-managing-roles-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="e1af5-281">[![The Supervisors Role has Been Added](creating-and-managing-roles-vb/_static/image17.png)](creating-and-managing-roles-vb/_static/image16.png)</span></span>

<span data-ttu-id="e1af5-282">**Figura 6**: a função de supervisores foi adicionada ([clique para exibir a imagem em tamanho normal](creating-and-managing-roles-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="e1af5-282">**Figure 6**: The Supervisors Role has Been Added  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image18.png))</span></span>

## <a name="step-6-deleting-roles"></a><span data-ttu-id="e1af5-283">Etapa 6: excluindo funções</span><span class="sxs-lookup"><span data-stu-id="e1af5-283">Step 6: Deleting Roles</span></span>

<span data-ttu-id="e1af5-284">Neste ponto, um usuário pode criar uma nova função e exibir todas as funções existentes na página `ManageRoles.aspx`.</span><span class="sxs-lookup"><span data-stu-id="e1af5-284">At this point a user can create a new role and view all existing roles from the `ManageRoles.aspx` page.</span></span> <span data-ttu-id="e1af5-285">Vamos permitir que os usuários também excluam funções.</span><span class="sxs-lookup"><span data-stu-id="e1af5-285">Let's allow users to also delete roles.</span></span> <span data-ttu-id="e1af5-286">O método `Roles.DeleteRole` tem duas sobrecargas:</span><span class="sxs-lookup"><span data-stu-id="e1af5-286">The `Roles.DeleteRole` method has two overloads:</span></span>

- <span data-ttu-id="e1af5-287">[`DeleteRole(roleName)`](https://msdn.microsoft.com/library/ek4sywc0.aspx) -exclui a função *roleName*.</span><span class="sxs-lookup"><span data-stu-id="e1af5-287">[`DeleteRole(roleName)`](https://msdn.microsoft.com/library/ek4sywc0.aspx) - deletes the role *roleName*.</span></span> <span data-ttu-id="e1af5-288">Uma exceção será gerada se a função contiver um ou mais membros.</span><span class="sxs-lookup"><span data-stu-id="e1af5-288">An exception is thrown if the role contains one or more members.</span></span>
- <span data-ttu-id="e1af5-289">[`DeleteRole(roleName, throwOnPopulatedRole)`](https://msdn.microsoft.com/library/38h6wf59.aspx) -exclui a função *roleName*.</span><span class="sxs-lookup"><span data-stu-id="e1af5-289">[`DeleteRole(roleName, throwOnPopulatedRole)`](https://msdn.microsoft.com/library/38h6wf59.aspx) - deletes the role *roleName*.</span></span> <span data-ttu-id="e1af5-290">Se *throwOnPopulateRole* for `True`, uma exceção será gerada se a função contiver um ou mais membros.</span><span class="sxs-lookup"><span data-stu-id="e1af5-290">If *throwOnPopulateRole* is `True`, then an exception is thrown if the role contains one or more members.</span></span> <span data-ttu-id="e1af5-291">Se *throwOnPopulateRole* for `False`, a função será excluída se ela contiver Membros ou não.</span><span class="sxs-lookup"><span data-stu-id="e1af5-291">If *throwOnPopulateRole* is `False`, then the role is deleted whether it contains any members or not.</span></span> <span data-ttu-id="e1af5-292">Internamente, o método `DeleteRole(roleName)` chama `DeleteRole(roleName, True)`.</span><span class="sxs-lookup"><span data-stu-id="e1af5-292">Internally, the `DeleteRole(roleName)` method calls `DeleteRole(roleName, True)`.</span></span>

<span data-ttu-id="e1af5-293">O método `DeleteRole` também gerará uma exceção se *roleName* for `Nothing` ou uma cadeia de caracteres vazia ou se *roleName* contiver uma vírgula.</span><span class="sxs-lookup"><span data-stu-id="e1af5-293">The `DeleteRole` method will also throw an exception if *roleName* is `Nothing` or an empty string or if *roleName* contains a comma.</span></span> <span data-ttu-id="e1af5-294">Se *roleName* não existir no sistema, `DeleteRole` falha silenciosamente, sem gerar uma exceção.</span><span class="sxs-lookup"><span data-stu-id="e1af5-294">If *roleName* does not exist in the system, `DeleteRole` fails silently, without raising an exception.</span></span>

<span data-ttu-id="e1af5-295">Vamos aumentar o GridView em `ManageRoles.aspx` para incluir um botão de exclusão que, quando clicado, exclui a função selecionada.</span><span class="sxs-lookup"><span data-stu-id="e1af5-295">Let's augment the GridView in `ManageRoles.aspx` to include a Delete button that, when clicked, deletes the selected role.</span></span> <span data-ttu-id="e1af5-296">Comece adicionando um botão excluir ao GridView acessando a caixa de diálogo campos e adicionando um botão excluir, que está localizado na opção CommandField.</span><span class="sxs-lookup"><span data-stu-id="e1af5-296">Start by adding a Delete button to the GridView by going to the Fields dialog box and adding a Delete button, which is located under the CommandField option.</span></span> <span data-ttu-id="e1af5-297">Faça com que o botão de exclusão seja a coluna à esquerda e defina sua propriedade `DeleteText` para excluir a função.</span><span class="sxs-lookup"><span data-stu-id="e1af5-297">Make the Delete button the far left column and set its `DeleteText` property to Delete Role .</span></span>

<span data-ttu-id="e1af5-298">[![adicionar um botão excluir à Rolelist GridView](creating-and-managing-roles-vb/_static/image20.png)](creating-and-managing-roles-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="e1af5-298">[![Add a Delete Button to the RoleList GridView](creating-and-managing-roles-vb/_static/image20.png)](creating-and-managing-roles-vb/_static/image19.png)</span></span>

<span data-ttu-id="e1af5-299">**Figura 7**: adicionar um botão excluir ao `RoleList` GridView ([clique para exibir a imagem em tamanho normal](creating-and-managing-roles-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="e1af5-299">**Figure 7**: Add a Delete Button to the `RoleList` GridView  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image21.png))</span></span>

<span data-ttu-id="e1af5-300">Depois de adicionar o botão excluir, a marcação declarativa de GridView deve ser semelhante ao seguinte:</span><span class="sxs-lookup"><span data-stu-id="e1af5-300">After adding the Delete button, your GridView's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](creating-and-managing-roles-vb/samples/sample12.aspx)]

<span data-ttu-id="e1af5-301">Em seguida, crie um manipulador de eventos para o evento `RowDeleting` do GridView.</span><span class="sxs-lookup"><span data-stu-id="e1af5-301">Next, create an event handler for the GridView's `RowDeleting` event.</span></span> <span data-ttu-id="e1af5-302">Esse é o evento que é gerado no postback quando o botão excluir função é clicado.</span><span class="sxs-lookup"><span data-stu-id="e1af5-302">This is the event that is raised on postback when the Delete Role button is clicked.</span></span> <span data-ttu-id="e1af5-303">Adicione o seguinte código ao manipulador de eventos.</span><span class="sxs-lookup"><span data-stu-id="e1af5-303">Add the following code to the event handler.</span></span>

[!code-vb[Main](creating-and-managing-roles-vb/samples/sample13.vb)]

<span data-ttu-id="e1af5-304">O código começa por meio de programação fazendo referência ao controle da Web `RoleNameLabel` na linha cujo botão excluir função foi clicado.</span><span class="sxs-lookup"><span data-stu-id="e1af5-304">The code starts by programmatically referencing the `RoleNameLabel` Web control in the row whose Delete Role button was clicked.</span></span> <span data-ttu-id="e1af5-305">O método `Roles.DeleteRole` é invocado, passando o `Text` do `RoleNameLabel` e `False`, excluindo, assim, a função, independentemente de haver algum usuário associado à função.</span><span class="sxs-lookup"><span data-stu-id="e1af5-305">The `Roles.DeleteRole` method is then invoked, passing in the `Text` of the `RoleNameLabel` and `False`, thereby deleting the role regardless of whether there are any users associated with the role.</span></span> <span data-ttu-id="e1af5-306">Por fim, o `RoleList` GridView é atualizado para que a função recém-excluída não apareça mais na grade.</span><span class="sxs-lookup"><span data-stu-id="e1af5-306">Finally, the `RoleList` GridView is refreshed so that the just-deleted role no longer appears in the grid.</span></span>

> [!NOTE]
> <span data-ttu-id="e1af5-307">O botão excluir função não requer nenhum tipo de confirmação do usuário antes de excluir a função.</span><span class="sxs-lookup"><span data-stu-id="e1af5-307">The Delete Role button does not require any sort of confirmation from the user before deleting the role.</span></span> <span data-ttu-id="e1af5-308">Uma das maneiras mais fáceis de confirmar uma ação é por meio de uma caixa de diálogo de confirmação do lado do cliente.</span><span class="sxs-lookup"><span data-stu-id="e1af5-308">One of the easiest ways to confirm an action is through a client-side confirm dialog box.</span></span> <span data-ttu-id="e1af5-309">Para obter mais informações sobre essa técnica, consulte [adicionando confirmação do lado do cliente ao excluir](https://asp.net/learn/data-access/tutorial-42-vb.aspx).</span><span class="sxs-lookup"><span data-stu-id="e1af5-309">For more information on this technique, see [Adding Client-Side Confirmation When Deleting](https://asp.net/learn/data-access/tutorial-42-vb.aspx).</span></span>

## <a name="summary"></a><span data-ttu-id="e1af5-310">Resumo</span><span class="sxs-lookup"><span data-stu-id="e1af5-310">Summary</span></span>

<span data-ttu-id="e1af5-311">Muitos aplicativos Web têm determinadas regras de autorização ou funcionalidade de nível de página que só está disponível para determinadas classes de usuários.</span><span class="sxs-lookup"><span data-stu-id="e1af5-311">Many web applications have certain authorization rules or page-level functionality that is only available to certain classes of users.</span></span> <span data-ttu-id="e1af5-312">Por exemplo, pode haver um conjunto de páginas da Web que somente administradores podem acessar.</span><span class="sxs-lookup"><span data-stu-id="e1af5-312">For example, there may be a set of web pages that only administrators can access.</span></span> <span data-ttu-id="e1af5-313">Em vez de definir essas regras de autorização de usuário por usuário, muitas vezes é mais útil definir as regras com base em uma função.</span><span class="sxs-lookup"><span data-stu-id="e1af5-313">Rather than defining these authorization rules on a user-by-user basis, oftentimes it is more useful to define the rules based on a role.</span></span> <span data-ttu-id="e1af5-314">Ou seja, em vez de permitir explicitamente que os usuários Scott e Jisun acessem as páginas da Web administrativas, uma abordagem mais passível de manutenção é permitir que os membros da função administradores acessem essas páginas e, em seguida, denotarmos Scott e Jisun como usuários pertencentes ao Função de administradores.</span><span class="sxs-lookup"><span data-stu-id="e1af5-314">That is, rather than explicitly allowing users Scott and Jisun to access the administrative web pages, a more maintainable approach is to permit members of the Administrators role to access these pages, and then to denote Scott and Jisun as users belonging to the Administrators role.</span></span>

<span data-ttu-id="e1af5-315">A estrutura de funções facilita a criação e o gerenciamento de funções.</span><span class="sxs-lookup"><span data-stu-id="e1af5-315">The Roles framework makes it easy to create and manage roles.</span></span> <span data-ttu-id="e1af5-316">Neste tutorial, examinamos como configurar a estrutura de funções para usar o `SqlRoleProvider`, que usa um banco de dados Microsoft SQL Server como o armazenamento de função.</span><span class="sxs-lookup"><span data-stu-id="e1af5-316">In this tutorial we examined how to configure the Roles framework to use the `SqlRoleProvider`, which uses a Microsoft SQL Server database as the role store.</span></span> <span data-ttu-id="e1af5-317">Também criamos uma página da Web que lista as funções existentes no sistema e permite que novas funções sejam criadas e as existentes sejam excluídas.</span><span class="sxs-lookup"><span data-stu-id="e1af5-317">We also created a web page that lists the existing roles in the system and allows for new roles to be created and existing ones to be deleted.</span></span> <span data-ttu-id="e1af5-318">Nos tutoriais subsequentes, veremos como atribuir usuários a funções e como aplicar a autorização baseada em funções.</span><span class="sxs-lookup"><span data-stu-id="e1af5-318">In subsequent tutorials we will see how to assign users to roles and how to apply role-based authorization.</span></span>

<span data-ttu-id="e1af5-319">Boa programação!</span><span class="sxs-lookup"><span data-stu-id="e1af5-319">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="e1af5-320">Leitura adicional</span><span class="sxs-lookup"><span data-stu-id="e1af5-320">Further Reading</span></span>

<span data-ttu-id="e1af5-321">Para obter mais informações sobre os tópicos discutidos neste tutorial, consulte os seguintes recursos:</span><span class="sxs-lookup"><span data-stu-id="e1af5-321">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="e1af5-322">Examinando a associação, as funções e o perfil do ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="e1af5-322">Examining ASP.NET 2.0's Membership, Roles, and Profile</span></span>](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx)
- [<span data-ttu-id="e1af5-323">Como: usar o Gerenciador de funções no ASP.NET 2,0</span><span class="sxs-lookup"><span data-stu-id="e1af5-323">How To: Use Role Manager in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/ms998314.aspx)
- [<span data-ttu-id="e1af5-324">Provedores de função</span><span class="sxs-lookup"><span data-stu-id="e1af5-324">Role Providers</span></span>](https://msdn.microsoft.com/library/aa478950.aspx)
- [<span data-ttu-id="e1af5-325">Distribuindo sua própria ferramenta de administração de sites</span><span class="sxs-lookup"><span data-stu-id="e1af5-325">Rolling Your Own Website Administration Tool</span></span>](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)
- [<span data-ttu-id="e1af5-326">Documentação técnica para o elemento `<roleManager>`</span><span class="sxs-lookup"><span data-stu-id="e1af5-326">Technical documentation for the `<roleManager>` Element</span></span>](https://msdn.microsoft.com/library/ms164660.aspx)
- [<span data-ttu-id="e1af5-327">Usando as APIs de associação e Gerenciador de funções</span><span class="sxs-lookup"><span data-stu-id="e1af5-327">Using the Membership and Role Manager APIs</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/security/membership.aspx)

### <a name="about-the-author"></a><span data-ttu-id="e1af5-328">Sobre o autor</span><span class="sxs-lookup"><span data-stu-id="e1af5-328">About the Author</span></span>

<span data-ttu-id="e1af5-329">Scott Mitchell, autor de vários livros sobre ASP/ASP. NET e fundador da 4GuysFromRolla.com, tem trabalhado com tecnologias Web da Microsoft desde 1998.</span><span class="sxs-lookup"><span data-stu-id="e1af5-329">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="e1af5-330">Scott trabalha como consultor, instrutor e escritor independentes.</span><span class="sxs-lookup"><span data-stu-id="e1af5-330">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="e1af5-331">Seu livro mais recente é que a *[Sams ensina a ASP.NET 2,0 em 24 horas](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)* .</span><span class="sxs-lookup"><span data-stu-id="e1af5-331">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="e1af5-332">Scott pode ser contatado em [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) ou por meio de seu blog em [http://ScottOnWriting.NET](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="e1af5-332">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="e1af5-333">Agradecimentos especiais a</span><span class="sxs-lookup"><span data-stu-id="e1af5-333">Special Thanks To</span></span>

<span data-ttu-id="e1af5-334">Esta série de tutoriais foi revisada por muitos revisores úteis.</span><span class="sxs-lookup"><span data-stu-id="e1af5-334">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="e1af5-335">Os revisores potenciais para este tutorial incluem Alicja Maziarz, como Banerjee e Teresa Murphy.</span><span class="sxs-lookup"><span data-stu-id="e1af5-335">Lead reviewers for this tutorial include Alicja Maziarz, Suchi Banerjee, and Teresa Murphy.</span></span> <span data-ttu-id="e1af5-336">Está interessado em revisar meus artigos futuros do MSDN?</span><span class="sxs-lookup"><span data-stu-id="e1af5-336">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="e1af5-337">Em caso afirmativo, solte-me uma linha em [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="e1af5-337">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="e1af5-338">[Anterior](role-based-authorization-cs.md)
> [Próximo](assigning-roles-to-users-vb.md)</span><span class="sxs-lookup"><span data-stu-id="e1af5-338">[Previous](role-based-authorization-cs.md)
[Next](assigning-roles-to-users-vb.md)</span></span>
