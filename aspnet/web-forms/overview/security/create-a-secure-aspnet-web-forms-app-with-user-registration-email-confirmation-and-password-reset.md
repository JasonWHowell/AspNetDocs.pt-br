---
uid: web-forms/overview/security/create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset
title: Criar um aplicativo de Web Forms seguro do ASP.NET com registro de usuário, confirmação de emailC#e redefinição de senha () | Microsoft Docs
author: Erikre
description: Este tutorial mostra como criar um aplicativo ASP.NET Web Forms com registro de usuário, confirmação de email e redefinição de senha usando o membro ASP.NET Identity...
ms.author: riande
ms.date: 10/02/2014
ms.assetid: 0a8d6044-5fab-4213-82d6-5618d5601358
msc.legacyurl: /web-forms/overview/security/create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset
msc.type: authoredcontent
ms.openlocfilehash: af3653bc164810126bc3bf8f1b1794d75642d807
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78625149"
---
# <a name="create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset-c"></a><span data-ttu-id="f2df5-103">Criar um aplicativo de Web Forms do ASP.NET seguro com registro de usuário, confirmação por email e redefinição de senha (C#)</span><span class="sxs-lookup"><span data-stu-id="f2df5-103">Create a secure ASP.NET Web Forms app with user registration, email confirmation and password reset (C#)</span></span>

<span data-ttu-id="f2df5-104">por [Erik Reitan](https://github.com/Erikre)</span><span class="sxs-lookup"><span data-stu-id="f2df5-104">by [Erik Reitan](https://github.com/Erikre)</span></span>

> <span data-ttu-id="f2df5-105">Este tutorial mostra como criar um aplicativo de Web Forms de ASP.NET com registro de usuário, confirmação de email e redefinição de senha usando o sistema de associação de ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="f2df5-105">This tutorial shows you how to build an ASP.NET Web Forms app with user registration, email confirmation and password reset using the ASP.NET Identity membership system.</span></span> <span data-ttu-id="f2df5-106">Este tutorial foi baseado no [tutorial do MVC](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md)de Rick Anderson.</span><span class="sxs-lookup"><span data-stu-id="f2df5-106">This tutorial was based on Rick Anderson's [MVC tutorial](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).</span></span>

## <a name="introduction"></a><span data-ttu-id="f2df5-107">Introdução</span><span class="sxs-lookup"><span data-stu-id="f2df5-107">Introduction</span></span>

<span data-ttu-id="f2df5-108">Este tutorial orienta você pelas etapas necessárias para criar um aplicativo de Web Forms ASP.NET usando o Visual Studio e o ASP.NET 4,5 para criar um aplicativo de Web Forms seguro com registro de usuário, confirmação de email e redefinição de senha.</span><span class="sxs-lookup"><span data-stu-id="f2df5-108">This tutorial guides you through the steps required to create an ASP.NET Web Forms application using Visual Studio and ASP.NET 4.5 to create a secure Web Forms app with user registration, email confirmation and password reset.</span></span>

### <a name="tutorial-tasks-and-information"></a><span data-ttu-id="f2df5-109">Informações e tarefas do tutorial:</span><span class="sxs-lookup"><span data-stu-id="f2df5-109">Tutorial Tasks and Information:</span></span>

- [<span data-ttu-id="f2df5-110">Criar um aplicativo de Web Forms ASP.NET</span><span class="sxs-lookup"><span data-stu-id="f2df5-110">Create an ASP.NET Web Forms app</span></span>](#createWebForms)
- [<span data-ttu-id="f2df5-111">Conectar SendGrid</span><span class="sxs-lookup"><span data-stu-id="f2df5-111">Hook Up SendGrid</span></span>](#SG)
- [<span data-ttu-id="f2df5-112">Exigir confirmação de email antes de fazer logon</span><span class="sxs-lookup"><span data-stu-id="f2df5-112">Require Email Confirmation Before Log In</span></span>](#require)
- [<span data-ttu-id="f2df5-113">Recuperação e redefinição de senha</span><span class="sxs-lookup"><span data-stu-id="f2df5-113">Password Recovery and Reset</span></span>](#reset)
- [<span data-ttu-id="f2df5-114">Link reenviar confirmação de email</span><span class="sxs-lookup"><span data-stu-id="f2df5-114">Resend Email Confirmation Link</span></span>](#rsend)
- [<span data-ttu-id="f2df5-115">Solucionando problemas do aplicativo</span><span class="sxs-lookup"><span data-stu-id="f2df5-115">Troubleshooting the App</span></span>](#dbg)
- [<span data-ttu-id="f2df5-116">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="f2df5-116">Additional Resources</span></span>](#addRes)

<a id="createWebForms"></a>
## <a name="create-an-aspnet-web-forms-app"></a><span data-ttu-id="f2df5-117">Criar um aplicativo de Web Forms ASP.NET</span><span class="sxs-lookup"><span data-stu-id="f2df5-117">Create an ASP.NET Web Forms App</span></span>

<span data-ttu-id="f2df5-118">Comece Instalando e executando o [Visual Studio Express 2013 para Web](https://go.microsoft.com/fwlink/?LinkId=299058) ou [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span><span class="sxs-lookup"><span data-stu-id="f2df5-118">Start by installing and running [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) or [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span></span> <span data-ttu-id="f2df5-119">Instale [Visual Studio 2013 atualização 3](https://go.microsoft.com/fwlink/?LinkId=390465) ou superior também.</span><span class="sxs-lookup"><span data-stu-id="f2df5-119">Install [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) or higher as well.</span></span>

> [!NOTE]
> <span data-ttu-id="f2df5-120">Aviso: você deve instalar [Visual Studio 2013 atualização 3](https://go.microsoft.com/fwlink/?LinkId=390465) ou superior para concluir este tutorial.</span><span class="sxs-lookup"><span data-stu-id="f2df5-120">Warning: You must install [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) or higher to complete this tutorial.</span></span>

1. <span data-ttu-id="f2df5-121">Crie um novo projeto (**arquivo** -&gt; **novo projeto**) e selecione o modelo de **aplicativo Web ASP.net** e a versão mais recente do .NET Framework na caixa de diálogo **novo projeto** .</span><span class="sxs-lookup"><span data-stu-id="f2df5-121">Create a new project (**File** -&gt; **New Project**) and select the **ASP.NET Web Application** template and the latest .NET Framework version from the **New Project** dialog box.</span></span>
2. <span data-ttu-id="f2df5-122">Na caixa de diálogo **novo projeto ASP.net** , selecione o modelo de **Web Forms** .</span><span class="sxs-lookup"><span data-stu-id="f2df5-122">From the **New ASP.NET Project** dialog box, select the **Web Forms** template.</span></span> <span data-ttu-id="f2df5-123">Deixe a autenticação padrão como **contas de usuário individuais**.</span><span class="sxs-lookup"><span data-stu-id="f2df5-123">Leave the default authentication as **Individual User Accounts**.</span></span> <span data-ttu-id="f2df5-124">Se você quiser hospedar o aplicativo no Azure, deixe a caixa de seleção **host na nuvem** marcada.</span><span class="sxs-lookup"><span data-stu-id="f2df5-124">If you'd like to host the app in Azure, leave the **Host in the cloud** check box checked.</span></span>   
 <span data-ttu-id="f2df5-125">Em seguida, clique em **OK** para criar o novo projeto.</span><span class="sxs-lookup"><span data-stu-id="f2df5-125">Then, click **OK** to create the new project.</span></span>  
    <span data-ttu-id="f2df5-126">![Caixa de diálogo Novo Projeto ASP .NET](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="f2df5-126">![New ASP.NET Project dialog box](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image1.png)</span></span>
3. <span data-ttu-id="f2df5-127">Habilite o protocolo SSL (SSL) para o projeto.</span><span class="sxs-lookup"><span data-stu-id="f2df5-127">Enable Secure Sockets Layer (SSL) for the project.</span></span> <span data-ttu-id="f2df5-128">Siga as etapas disponíveis na seção **habilitar SSL para o projeto** do [introdução com Web Forms série de tutoriais](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#SSLWebForms).</span><span class="sxs-lookup"><span data-stu-id="f2df5-128">Follow the steps available in the **Enable SSL for the Project** section of the [Getting Started with Web Forms tutorial series](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#SSLWebForms).</span></span>
4. <span data-ttu-id="f2df5-129">Execute o aplicativo, clique no link **registrar** e registre um novo usuário.</span><span class="sxs-lookup"><span data-stu-id="f2df5-129">Run the app, click the **Register** link and register a new user.</span></span> <span data-ttu-id="f2df5-130">Neste ponto, a única validação no email é baseada no atributo [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) para garantir que o endereço de email esteja bem formado.</span><span class="sxs-lookup"><span data-stu-id="f2df5-130">At this point, the only validation on the email is based on the [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) attribute to ensure the email address is well-formed.</span></span> <span data-ttu-id="f2df5-131">Você modificará o código para adicionar confirmação de email.</span><span class="sxs-lookup"><span data-stu-id="f2df5-131">You will modify the code to add email confirmation.</span></span> <span data-ttu-id="f2df5-132">Feche a janela do navegador.</span><span class="sxs-lookup"><span data-stu-id="f2df5-132">Close the browser window.</span></span>
5. <span data-ttu-id="f2df5-133">Em **Gerenciador de servidores** do Visual Studio (**View** -&gt; **Gerenciador de servidores**), navegue até **Data Connections\DefaultConnection\Tables\AspNetUsers**, clique com o botão direito do mouse e selecione **Abrir definição de tabela**.</span><span class="sxs-lookup"><span data-stu-id="f2df5-133">In **Server Explorer** of Visual Studio (**View** -&gt; **Server Explorer**), navigate to **Data Connections\DefaultConnection\Tables\AspNetUsers**, right click and select **Open table definition**.</span></span> 

    <span data-ttu-id="f2df5-134">A imagem a seguir mostra o esquema de tabela `AspNetUsers`:</span><span class="sxs-lookup"><span data-stu-id="f2df5-134">The following image shows the `AspNetUsers` table schema:</span></span>

    ![Esquema de tabela AspNetUsers](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image2.png)
6. <span data-ttu-id="f2df5-136">Em **Gerenciador de servidores**, clique com o botão direito do mouse na tabela **AspNetUsers** e selecione **Mostrar dados da tabela**.</span><span class="sxs-lookup"><span data-stu-id="f2df5-136">In **Server Explorer**, right-click on the **AspNetUsers** table and select **Show Table Data**.</span></span>  
  
    ![Dados da tabela AspNetUsers](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image3.png)  
 <span data-ttu-id="f2df5-138">Neste ponto, o email para o usuário registrado não foi confirmado.</span><span class="sxs-lookup"><span data-stu-id="f2df5-138">At this point the email for the registered user has not been confirmed.</span></span>
7. <span data-ttu-id="f2df5-139">Clique na linha e selecione Excluir para excluir o usuário.</span><span class="sxs-lookup"><span data-stu-id="f2df5-139">Click on the row and select delete to delete the user.</span></span> <span data-ttu-id="f2df5-140">Você adicionará esse email novamente na próxima etapa e enviará uma mensagem de confirmação para o endereço de email.</span><span class="sxs-lookup"><span data-stu-id="f2df5-140">You'll add this email again in the next step and send a confirmation message to the email address.</span></span>

## <a name="email-confirmation"></a><span data-ttu-id="f2df5-141">Confirmação de email</span><span class="sxs-lookup"><span data-stu-id="f2df5-141">Email Confirmation</span></span>

<span data-ttu-id="f2df5-142">É uma prática recomendada confirmar o email durante o registro de um novo usuário para verificar se eles não estão representando outra pessoa (ou seja, se eles não foram registrados com o email de outra pessoa).</span><span class="sxs-lookup"><span data-stu-id="f2df5-142">It's a best practice to confirm the email during the registration of a new user to verify they are not impersonating someone else (that is, they haven't registered with someone else's email).</span></span> <span data-ttu-id="f2df5-143">Suponha que você tenha um fórum de discussão, você desejaria impedir que `"bob@cpandl.com"` se registrem como `"joe@contoso.com"`.</span><span class="sxs-lookup"><span data-stu-id="f2df5-143">Suppose you had a discussion forum, you would want to prevent `"bob@cpandl.com"` from registering as `"joe@contoso.com"`.</span></span> <span data-ttu-id="f2df5-144">Sem confirmação por email, `"joe@contoso.com"` pode obter email indesejado de seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f2df5-144">Without email confirmation, `"joe@contoso.com"` could get unwanted email from your app.</span></span> <span data-ttu-id="f2df5-145">Suponha que Bob seja acidentalmente registrado como `"bib@cpandl.com"` e não tenha notado, ele não seria capaz de usar a recuperação de senha porque o aplicativo não tem seu email correto.</span><span class="sxs-lookup"><span data-stu-id="f2df5-145">Suppose Bob accidentally registered as `"bib@cpandl.com"` and hadn't noticed it, he wouldn't be able to use password recovery because the app doesn't have his correct email.</span></span> <span data-ttu-id="f2df5-146">A confirmação por email fornece apenas proteção limitada de bots e não fornece proteção contra remetentes de spam determinados.</span><span class="sxs-lookup"><span data-stu-id="f2df5-146">Email confirmation provides only limited protection from bots and doesn't provide protection from determined spammers.</span></span>

<span data-ttu-id="f2df5-147">Em geral, você desejará impedir que novos usuários postem dados em seu site antes de serem confirmados por email, uma mensagem de texto SMS ou outro mecanismo.</span><span class="sxs-lookup"><span data-stu-id="f2df5-147">You generally want to prevent new users from posting any data to your website before they have been confirmed by either email, an SMS text message or another mechanism.</span></span> <span data-ttu-id="f2df5-148">Nas seções a seguir, Habilitaremos a confirmação de email e modificaremos o código para impedir que usuários registrados recentemente façam logon até que seu email seja confirmado.</span><span class="sxs-lookup"><span data-stu-id="f2df5-148">In the sections below, we will enable email confirmation and modify the code to prevent newly registered users from logging in until their email has been confirmed.</span></span> <span data-ttu-id="f2df5-149">Você usará o serviço de email SendGrid neste tutorial.</span><span class="sxs-lookup"><span data-stu-id="f2df5-149">You'll use the email service SendGrid in this tutorial.</span></span>

<a id="SG"></a>
## <a name="hook-up-sendgrid"></a><span data-ttu-id="f2df5-150">Conectar SendGrid</span><span class="sxs-lookup"><span data-stu-id="f2df5-150">Hook up SendGrid</span></span>

<span data-ttu-id="f2df5-151">SendGrid alterou a API desde que este tutorial foi escrito.</span><span class="sxs-lookup"><span data-stu-id="f2df5-151">SendGrid has changed it's API since this tutorial was written.</span></span> <span data-ttu-id="f2df5-152">Para obter as instruções de SendGrid atuais, consulte [SendGrid](http://sendgrid.com/) ou [habilitar confirmação de conta e recuperação de senha](xref:security/authentication/accconfirm#enable-account-confirmation-and-password-recovery).</span><span class="sxs-lookup"><span data-stu-id="f2df5-152">For current SendGrid instructions, see [SendGrid](http://sendgrid.com/) or [Enable account confirmation and password recovery](xref:security/authentication/accconfirm#enable-account-confirmation-and-password-recovery).</span></span>

<span data-ttu-id="f2df5-153">Embora este tutorial mostre apenas como adicionar notificação por email por meio do [SendGrid](http://sendgrid.com/), você pode enviar emails usando SMTP e outros mecanismos (consulte [recursos adicionais](#addRes)).</span><span class="sxs-lookup"><span data-stu-id="f2df5-153">Although this tutorial only shows how to add email notification through [SendGrid](http://sendgrid.com/), you can send email using SMTP and other mechanisms (see [additional resources](#addRes)).</span></span>

1. <span data-ttu-id="f2df5-154">No Visual Studio, abra o **console do Gerenciador de pacotes** (**ferramentas** -&gt; o gerenciador de **pacotes NuGet** -&gt; **console do Gerenciador de pacotes**) e digite o seguinte comando:</span><span class="sxs-lookup"><span data-stu-id="f2df5-154">In Visual Studio, open the **Package Manager Console** (**Tools** -&gt; **NuGet Package Manger** -&gt; **Package Manager Console**), and enter the following command:</span></span>  
    `Install-Package SendGrid`
2. <span data-ttu-id="f2df5-155">Vá para a [página de inscrição do SendGrid do Azure](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) e registre-se para obter uma conta gratuita do SendGrid.</span><span class="sxs-lookup"><span data-stu-id="f2df5-155">Go to the [Azure SendGrid sign-up page](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) and register for free SendGrid account.</span></span> <span data-ttu-id="f2df5-156">Você também pode se inscrever para uma conta gratuita do SendGrid diretamente no [site do SendGrid](http://www.sendgrid.com).</span><span class="sxs-lookup"><span data-stu-id="f2df5-156">You can also sign-up for a free SendGrid account directly on [SendGrid's site](http://www.sendgrid.com).</span></span>
3. <span data-ttu-id="f2df5-157">Em **Gerenciador de soluções** Abra o arquivo *IdentityConfig.cs* na pasta *\_iniciar do aplicativo* e adicione o seguinte código realçado em amarelo à classe `EmailService` para configurar o **SendGrid**:</span><span class="sxs-lookup"><span data-stu-id="f2df5-157">From **Solution Explorer** open the *IdentityConfig.cs* file in the *App\_Start* folder and add the following code highlighted in yellow to the `EmailService` class to configure **SendGrid**:</span></span>

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample1.cs?highlight=3,5,8-37)]
4. <span data-ttu-id="f2df5-158">Além disso, adicione as seguintes instruções `using` ao início do arquivo *IdentityConfig.cs* :</span><span class="sxs-lookup"><span data-stu-id="f2df5-158">Also, add the following `using` statements to the beginning of the *IdentityConfig.cs* file:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample2.cs?highlight=1-4)]
5. <span data-ttu-id="f2df5-159">Para manter esse exemplo simples, você armazenará os valores da conta de serviço de email na seção `appSettings` do arquivo *Web. config* .</span><span class="sxs-lookup"><span data-stu-id="f2df5-159">To keep this sample simple, you'll store the email service account values in the `appSettings` section of the *web.config* file.</span></span> <span data-ttu-id="f2df5-160">Adicione o seguinte XML realçado em amarelo ao arquivo *Web. config* na raiz do seu projeto:</span><span class="sxs-lookup"><span data-stu-id="f2df5-160">Add the following XML highlighted in yellow to the *web.config* file at the root of your project:</span></span>

    [!code-xml[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample3.xml?highlight=2-5)]

    > [!WARNING]
    > <span data-ttu-id="f2df5-161">Segurança-nunca armazene dados confidenciais em seu código-fonte.</span><span class="sxs-lookup"><span data-stu-id="f2df5-161">Security - Never store sensitive data in your source code.</span></span> <span data-ttu-id="f2df5-162">Neste exemplo, a conta e as credenciais são armazenadas na seção **appSetting** do arquivo *Web. config* .</span><span class="sxs-lookup"><span data-stu-id="f2df5-162">In this example, the account and credentials are stored in the **appSetting** section of the *Web.config* file.</span></span> <span data-ttu-id="f2df5-163">No Azure, você pode armazenar esses valores com segurança na guia **[Configurar](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** na portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="f2df5-163">On Azure, you can securely store these values on the **[Configure](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** tab in the Azure portal.</span></span> <span data-ttu-id="f2df5-164">Para obter informações relacionadas, consulte o tópico de Rick Anderson intitulado [práticas recomendadas para implantar senhas e outros dados confidenciais no ASP.net e no Azure](https://go.microsoft.com/fwlink/?LinkId=513141).</span><span class="sxs-lookup"><span data-stu-id="f2df5-164">For related information see Rick Anderson's topic titled [Best practices for deploying passwords and other sensitive data to ASP.NET and Azure](https://go.microsoft.com/fwlink/?LinkId=513141).</span></span>
6. <span data-ttu-id="f2df5-165">Adicione os valores do serviço de email para refletir seus valores de autenticação do SendGrid (nome de usuário e senha) para que você possa enviar emails com êxito do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f2df5-165">Add the email service values to reflect your SendGrid authentication values (User Name and Password) so that you can successful send email from your app.</span></span> <span data-ttu-id="f2df5-166">Certifique-se de usar seu nome de conta do SendGrid em vez do endereço de email que você forneceu SendGrid.</span><span class="sxs-lookup"><span data-stu-id="f2df5-166">Be sure to use your SendGrid account name rather than the email address you provided SendGrid.</span></span>

### <a name="enable-email-confirmation"></a><span data-ttu-id="f2df5-167">Habilitar confirmação de email</span><span class="sxs-lookup"><span data-stu-id="f2df5-167">Enable Email Confirmation</span></span>

 <span data-ttu-id="f2df5-168">Para habilitar a confirmação de email, você modificará o código de registro usando as etapas a seguir.</span><span class="sxs-lookup"><span data-stu-id="f2df5-168">To enable email confirmation, you'll modify the registration code using the following steps.</span></span>  

1. <span data-ttu-id="f2df5-169">Na pasta *conta* , abra o code-behind *Register.aspx.cs* e atualize o método `CreateUser_Click` para habilitar as seguintes alterações realçadas:</span><span class="sxs-lookup"><span data-stu-id="f2df5-169">In the *Account* folder, open the *Register.aspx.cs* code-behind and update the `CreateUser_Click` method to enable the following highlighted changes:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample4.cs?highlight=9-11)]
2. <span data-ttu-id="f2df5-170">Em **Gerenciador de soluções**, clique com o botão direito do mouse em *Default. aspx* e selecione **definir como página inicial**.</span><span class="sxs-lookup"><span data-stu-id="f2df5-170">In **Solution Explorer**, right-click *Default.aspx* and select **Set As Start Page**.</span></span>
3. <span data-ttu-id="f2df5-171">Execute o aplicativo pressionando **F5.**</span><span class="sxs-lookup"><span data-stu-id="f2df5-171">Run the app by pressing **F5.**</span></span> <span data-ttu-id="f2df5-172">Depois que a página for exibida, clique no link **registrar** para exibir a página de registro.</span><span class="sxs-lookup"><span data-stu-id="f2df5-172">After the page is displayed, click the **Register** link to display the Register page.</span></span>
4. <span data-ttu-id="f2df5-173">Insira seu email e senha e, em seguida, clique no botão **registrar** para enviar uma mensagem de email por meio de SendGrid.</span><span class="sxs-lookup"><span data-stu-id="f2df5-173">Enter your email and password, then click the **Register** button to send an email message via SendGrid.</span></span>  
   <span data-ttu-id="f2df5-174">O estado atual do seu projeto e do código permitirá que o usuário faça logon depois de concluir o formulário de registro, mesmo que ele não tenha confirmado sua conta.</span><span class="sxs-lookup"><span data-stu-id="f2df5-174">The current state of your project and code will allow the user to log in once they complete the registration form, even though they haven't confirmed their account.</span></span>
5. <span data-ttu-id="f2df5-175">Verifique sua conta de email e clique no link para confirmar seu email.</span><span class="sxs-lookup"><span data-stu-id="f2df5-175">Check your email account and click on the link to confirm your email.</span></span>  
   <span data-ttu-id="f2df5-176">Depois de enviar o formulário de registro, você será conectado.</span><span class="sxs-lookup"><span data-stu-id="f2df5-176">Once you submit the registration form, you will be logged in.</span></span>  
    ![Exemplo de logon no site](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image4.png)

<a id="require"></a>
## <a name="require-email-confirmation-before-log-in"></a><span data-ttu-id="f2df5-178">Exigir confirmação de email antes de fazer logon</span><span class="sxs-lookup"><span data-stu-id="f2df5-178">Require Email Confirmation Before Log In</span></span>

<span data-ttu-id="f2df5-179">Embora você tenha confirmado a conta de email, neste ponto, não precisaria clicar no link contido no email de verificação para estar totalmente conectado.</span><span class="sxs-lookup"><span data-stu-id="f2df5-179">Although you have confirmed the email account, at this point you would not need to click on the link contained in the verification email to be fully signed-in.</span></span> <span data-ttu-id="f2df5-180">Na seção a seguir, você modificará o código que exige que novos usuários tenham um email confirmado antes de serem conectados (autenticado).</span><span class="sxs-lookup"><span data-stu-id="f2df5-180">In the following section, you will modify the code requiring new users to have a confirmed email before they are logged in (authenticated).</span></span>

1. <span data-ttu-id="f2df5-181">Em **Gerenciador de soluções** do Visual Studio, atualize o evento `CreateUser_Click` no code-behind *Register.aspx.cs* contido na pasta *contas* com as seguintes alterações realçadas:</span><span class="sxs-lookup"><span data-stu-id="f2df5-181">In **Solution Explorer** of Visual Studio, update the `CreateUser_Click` event in the *Register.aspx.cs* code-behind contained in the *Accounts* folder with the following highlighted changes:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample5.cs?highlight=13-14,17-21)]
2. <span data-ttu-id="f2df5-182">Atualize o método `LogIn` no code-behind *login.aspx.cs* com as seguintes alterações realçadas:</span><span class="sxs-lookup"><span data-stu-id="f2df5-182">Update the `LogIn` method in the *Login.aspx.cs* code-behind with the following highlighted changes:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample6.cs?highlight=9-19,45-46)]

### <a name="run-the-application"></a><span data-ttu-id="f2df5-183">Executar o aplicativo</span><span class="sxs-lookup"><span data-stu-id="f2df5-183">Run the Application</span></span>

 <span data-ttu-id="f2df5-184">Agora que você implementou o código para verificar se o endereço de email de um usuário foi confirmado, você pode verificar a funcionalidade nas páginas de **registro** e de **logon** .</span><span class="sxs-lookup"><span data-stu-id="f2df5-184">Now that you have implemented the code to check whether a user's email address has been confirmed, you can check the functionality on both the **Register** and **Login** pages.</span></span> 

1. <span data-ttu-id="f2df5-185">Exclua todas as contas na tabela **AspNetUsers** que contêm o alias de email que você deseja testar.</span><span class="sxs-lookup"><span data-stu-id="f2df5-185">Delete any accounts in the **AspNetUsers** table that contain the email alias you wish to test.</span></span>
2. <span data-ttu-id="f2df5-186">Execute o aplicativo (**F5**) e verifique se você não pode se registrar como um usuário até confirmar seu endereço de email.</span><span class="sxs-lookup"><span data-stu-id="f2df5-186">Run the app (**F5**) and verify you cannot register as a user until you have confirmed your email address.</span></span>
3. <span data-ttu-id="f2df5-187">Antes de confirmar sua nova conta por email que acabou de ser enviado, tente fazer logon com a nova conta.</span><span class="sxs-lookup"><span data-stu-id="f2df5-187">Before confirming your new account via the email that was just sent, attempt to log in with the new account.</span></span>  
 <span data-ttu-id="f2df5-188">Você verá que não é possível fazer logon e que você deve ter uma conta de email confirmada.</span><span class="sxs-lookup"><span data-stu-id="f2df5-188">You'll see that you are unable to log in and that you must have a confirmed email account.</span></span>
4. <span data-ttu-id="f2df5-189">Depois de confirmar seu endereço de email, faça logon no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f2df5-189">Once you confirm your email address, log in to the app.</span></span>

<a id="reset"></a>
## <a name="password-recovery-and-reset"></a><span data-ttu-id="f2df5-190">Recuperação e redefinição de senha</span><span class="sxs-lookup"><span data-stu-id="f2df5-190">Password Recovery and Reset</span></span>

1. <span data-ttu-id="f2df5-191">No Visual Studio, remova os caracteres de comentário do método `Forgot` no code-behind *forgot.aspx.cs* contido na pasta *Account* , para que o método seja exibido da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="f2df5-191">In Visual Studio, remove the comment characters from the `Forgot` method in the *Forgot.aspx.cs* code-behind contained in the *Account* folder, so that the method appears as follows:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample7.cs?highlight=16-18)]
2. <span data-ttu-id="f2df5-192">Abra a página *login. aspx* .</span><span class="sxs-lookup"><span data-stu-id="f2df5-192">Open the *Login.aspx* page.</span></span> <span data-ttu-id="f2df5-193">Substitua a marcação próximo ao final da seção **loginForm** , conforme destacado abaixo:</span><span class="sxs-lookup"><span data-stu-id="f2df5-193">Replace the markup near the end of the **loginForm** section as highlighted below:</span></span> 

    [!code-aspx[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample8.aspx?highlight=52-53)]
3. <span data-ttu-id="f2df5-194">Abra o code-behind *login.aspx.cs* e remova a marca de comentário da linha de código a seguir realçada em amarelo no manipulador de eventos `Page_Load`:</span><span class="sxs-lookup"><span data-stu-id="f2df5-194">Open the *Login.aspx.cs* code-behind and uncomment the following line of code highlighted in yellow from the `Page_Load` event handler:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample9.cs?highlight=5)]
4. <span data-ttu-id="f2df5-195">Execute o aplicativo pressionando **F5.**</span><span class="sxs-lookup"><span data-stu-id="f2df5-195">Run the app by pressing **F5.**</span></span> <span data-ttu-id="f2df5-196">Depois que a página for exibida, clique no link **fazer logon** .</span><span class="sxs-lookup"><span data-stu-id="f2df5-196">After the page is displayed, click the **Log in** link.</span></span>
5. <span data-ttu-id="f2df5-197">Clique no link **esqueceu sua senha?** para exibir a página **esqueceu a senha** .</span><span class="sxs-lookup"><span data-stu-id="f2df5-197">Click the **Forgot your password?** link to display the **Forgot Password** page.</span></span>
6. <span data-ttu-id="f2df5-198">Insira seu endereço de email e clique no botão **Enviar** para enviar um email para seu endereço, o que permitirá que você Redefina sua senha.</span><span class="sxs-lookup"><span data-stu-id="f2df5-198">Enter your email address and click the **Submit** button to send an email to your address which will allow you to reset your password.</span></span>   
   <span data-ttu-id="f2df5-199">Verifique sua conta de email e clique no link para exibir a página **Redefinir senha** .</span><span class="sxs-lookup"><span data-stu-id="f2df5-199">Check your email account and click on the link to display the **Reset Password** page.</span></span>
7. <span data-ttu-id="f2df5-200">Na página **Redefinir senha** , insira seu email, senha e senha confirmada.</span><span class="sxs-lookup"><span data-stu-id="f2df5-200">On the **Reset Password** page, enter your email, password, and confirmed password.</span></span> <span data-ttu-id="f2df5-201">Em seguida, pressione o botão **Redefinir** .</span><span class="sxs-lookup"><span data-stu-id="f2df5-201">Then, press the **Reset** button.</span></span>  
   <span data-ttu-id="f2df5-202">Quando você redefinir sua senha com êxito, a página **senha alterada** será exibida.</span><span class="sxs-lookup"><span data-stu-id="f2df5-202">When you successfully reset your password, the **Password Changed** page will be displayed.</span></span> <span data-ttu-id="f2df5-203">Agora você pode fazer logon com sua nova senha.</span><span class="sxs-lookup"><span data-stu-id="f2df5-203">Now you can log in with your new password.</span></span>

<a id="rsend"></a>
## <a name="resend-email-confirmation-link"></a><span data-ttu-id="f2df5-204">Link reenviar confirmação de email</span><span class="sxs-lookup"><span data-stu-id="f2df5-204">Resend Email Confirmation Link</span></span>

<span data-ttu-id="f2df5-205">Quando um usuário cria uma nova conta local, ele envia por email um link de confirmação que eles precisam usar antes que possam fazer logon.</span><span class="sxs-lookup"><span data-stu-id="f2df5-205">Once a user creates a new local account, they are emailed a confirmation link they are required to use before they can log on.</span></span> <span data-ttu-id="f2df5-206">Se o usuário excluir acidentalmente o email de confirmação ou se o email nunca chegar, ele precisará do link de confirmação enviado novamente.</span><span class="sxs-lookup"><span data-stu-id="f2df5-206">If the user accidentally deletes the confirmation email, or the email never arrives, they will need the confirmation link sent again.</span></span> <span data-ttu-id="f2df5-207">As alterações de código a seguir mostram como habilitar isso.</span><span class="sxs-lookup"><span data-stu-id="f2df5-207">The following code changes show how to enable this.</span></span>

1. <span data-ttu-id="f2df5-208">No Visual Studio, abra o code-behind **login.aspx.cs** e adicione o seguinte manipulador de eventos após o manipulador de eventos `LogIn`:</span><span class="sxs-lookup"><span data-stu-id="f2df5-208">In Visual Studio, open the **Login.aspx.cs** code-behind and add the following event handler after the `LogIn` event handler:</span></span>   

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample10.cs)]
2. <span data-ttu-id="f2df5-209">Modifique o manipulador de eventos `LogIn` no code-behind *login.aspx.cs* alterando o código realçado em amarelo da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="f2df5-209">Modify the `LogIn` event handler in the *Login.aspx.cs* code-behind by changing the code highlighted in yellow as follows:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample11.cs?highlight=15-17)]
3. <span data-ttu-id="f2df5-210">Atualize a página *login. aspx* adicionando o código realçado em amarelo da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="f2df5-210">Update the *Login.aspx* page by adding the code highlighted in yellow as follows:</span></span> 

    [!code-aspx[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample12.aspx?highlight=45-46)]
4. <span data-ttu-id="f2df5-211">Exclua todas as contas na tabela **AspNetUsers** que contêm o alias de email que você deseja testar.</span><span class="sxs-lookup"><span data-stu-id="f2df5-211">Delete any accounts in the **AspNetUsers** table that contain the email alias you wish to test.</span></span>
5. <span data-ttu-id="f2df5-212">Execute o aplicativo (**F5**) e Registre seu endereço de email.</span><span class="sxs-lookup"><span data-stu-id="f2df5-212">Run the app (**F5**) and register your email address.</span></span>
6. <span data-ttu-id="f2df5-213">Antes de confirmar sua nova conta por email que acabou de ser enviado, tente fazer logon com a nova conta.</span><span class="sxs-lookup"><span data-stu-id="f2df5-213">Before confirming your new account via the email that was just sent, attempt to log in with the new account.</span></span>  
   <span data-ttu-id="f2df5-214">Você verá que não é possível fazer logon e que você deve ter uma conta de email confirmada.</span><span class="sxs-lookup"><span data-stu-id="f2df5-214">You'll see that you are unable to log in and that you must have a confirmed email account.</span></span> <span data-ttu-id="f2df5-215">Além disso, agora você pode reenviar uma mensagem de confirmação para sua conta de email.</span><span class="sxs-lookup"><span data-stu-id="f2df5-215">In addition, you can now resend a confirmation message to your email account.</span></span>
7. <span data-ttu-id="f2df5-216">Insira seu endereço de email e senha e pressione o botão de **confirmação reenviar** .</span><span class="sxs-lookup"><span data-stu-id="f2df5-216">Enter your email address and password, then press the **Resend confirmation** button.</span></span>
8. <span data-ttu-id="f2df5-217">Depois de confirmar seu endereço de email com base na mensagem de email enviada recentemente, faça logon no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f2df5-217">Once you confirm your email address based on the newly sent email message, log in to the app.</span></span>

<a id="dbg"></a>
## <a name="troubleshooting-the-app"></a><span data-ttu-id="f2df5-218">Solucionando problemas do aplicativo</span><span class="sxs-lookup"><span data-stu-id="f2df5-218">Troubleshooting the App</span></span>

<span data-ttu-id="f2df5-219">Se você não receber um email contendo o link para verificar suas credenciais:</span><span class="sxs-lookup"><span data-stu-id="f2df5-219">If you don't receive an email containing the link to verify your credentials:</span></span>

- <span data-ttu-id="f2df5-220">Verifique sua pasta de lixo eletrônico ou spam.</span><span class="sxs-lookup"><span data-stu-id="f2df5-220">Check your junk or spam folder.</span></span>
- <span data-ttu-id="f2df5-221">Faça logon em sua conta do SendGrid e clique no [link atividade de email](https://sendgrid.com/logs/index).</span><span class="sxs-lookup"><span data-stu-id="f2df5-221">Log into your SendGrid account and click on the [Email Activity link](https://sendgrid.com/logs/index).</span></span>
- <span data-ttu-id="f2df5-222">Certifique-se de que você usou o nome da conta de usuário do SendGrid como um valor *Web. config* em vez de seu endereço de email da conta do SendGrid.</span><span class="sxs-lookup"><span data-stu-id="f2df5-222">Be certain you used your SendGrid user account name as a *Web.config* value rather than your SendGrid account email address.</span></span>

<a id="addRes"></a>
## <a name="additional-resources"></a><span data-ttu-id="f2df5-223">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="f2df5-223">Additional Resources</span></span>

- [<span data-ttu-id="f2df5-224">Links para ASP.NET Identity recursos recomendados</span><span class="sxs-lookup"><span data-stu-id="f2df5-224">Links to ASP.NET Identity Recommended Resources</span></span>](../../../identity/overview/getting-started/aspnet-identity-recommended-resources.md)
- [<span data-ttu-id="f2df5-225">Confirmação de conta e recuperação de senha com ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="f2df5-225">Account Confirmation and Password Recovery with ASP.NET Identity</span></span>](../../../identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity.md)
- [<span data-ttu-id="f2df5-226">Série de tutoriais do ASP.NET Web Forms – adicionar um provedor OAuth 2,0</span><span class="sxs-lookup"><span data-stu-id="f2df5-226">ASP.NET Web Forms tutorial series - Add an OAuth 2.0 Provider</span></span>](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#OAuthWebForms)
- [<span data-ttu-id="f2df5-227">Implantar um aplicativo ASP.NET Web Forms seguro com associação, OAuth e banco de dados SQL no serviço Azure App</span><span class="sxs-lookup"><span data-stu-id="f2df5-227">Deploy a Secure ASP.NET Web Forms App with Membership, OAuth, and SQL Database to Azure App Service</span></span>](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/)
- [<span data-ttu-id="f2df5-228">Série de tutoriais do ASP.NET Web Forms – habilitar o SSL para o projeto</span><span class="sxs-lookup"><span data-stu-id="f2df5-228">ASP.NET Web Forms tutorial series - Enable SSL for the Project</span></span>](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#SSLWebForms)
