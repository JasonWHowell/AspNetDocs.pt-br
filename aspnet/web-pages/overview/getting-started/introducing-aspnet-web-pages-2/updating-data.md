---
uid: web-pages/overview/getting-started/introducing-aspnet-web-pages-2/updating-data
title: Introdução ao Páginas da Web do ASP.NET-atualizando dados do banco de dados | Microsoft Docs
author: Rick-Anderson
description: Este tutorial mostra como atualizar (alterar) uma entrada de banco de dados existente quando você usa Páginas da Web do ASP.NET (Razor). Ele pressupõe que você concluiu a série th...
ms.author: riande
ms.date: 01/02/2018
ms.assetid: ac86ec9c-6b69-485b-b9e0-8b9127b13e6b
msc.legacyurl: /web-pages/overview/getting-started/introducing-aspnet-web-pages-2/updating-data
msc.type: authoredcontent
ms.openlocfilehash: 8f8bcfb7d9d2416a2699776cadbdaae8e12415ba
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78574224"
---
# <a name="introducing-aspnet-web-pages---updating-database-data"></a><span data-ttu-id="62cc3-104">Introdução ao Páginas da Web do ASP.NET-atualizando dados do banco</span><span class="sxs-lookup"><span data-stu-id="62cc3-104">Introducing ASP.NET Web Pages - Updating Database Data</span></span>

<span data-ttu-id="62cc3-105">por [Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="62cc3-105">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="62cc3-106">Este tutorial mostra como atualizar (alterar) uma entrada de banco de dados existente quando você usa Páginas da Web do ASP.NET (Razor).</span><span class="sxs-lookup"><span data-stu-id="62cc3-106">This tutorial shows you how to update (change) an existing database entry when you use ASP.NET Web Pages (Razor).</span></span> <span data-ttu-id="62cc3-107">Ele pressupõe que você concluiu a série por meio da [inserção de dados usando formulários usando páginas da Web do ASP.net](entering-data.md).</span><span class="sxs-lookup"><span data-stu-id="62cc3-107">It assumes you have completed the series through [Entering Data by Using Forms Using ASP.NET Web Pages](entering-data.md).</span></span>
> 
> <span data-ttu-id="62cc3-108">O que você aprenderá:</span><span class="sxs-lookup"><span data-stu-id="62cc3-108">What you'll learn:</span></span>
> 
> - <span data-ttu-id="62cc3-109">Como selecionar um registro individual no auxiliar de `WebGrid`.</span><span class="sxs-lookup"><span data-stu-id="62cc3-109">How to select an individual record in the `WebGrid` helper.</span></span>
> - <span data-ttu-id="62cc3-110">Como ler um único registro de um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="62cc3-110">How to read a single record from a database.</span></span>
> - <span data-ttu-id="62cc3-111">Como pré-carregar um formulário com valores do registro do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="62cc3-111">How to preload a form with values from the database record.</span></span>
> - <span data-ttu-id="62cc3-112">Como atualizar um registro existente em um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="62cc3-112">How to update an existing record in a database.</span></span>
> - <span data-ttu-id="62cc3-113">Como armazenar informações na página sem exibi-las.</span><span class="sxs-lookup"><span data-stu-id="62cc3-113">How to store information in the page without displaying it.</span></span>
> - <span data-ttu-id="62cc3-114">Como usar um campo oculto para armazenar informações.</span><span class="sxs-lookup"><span data-stu-id="62cc3-114">How to use a hidden field to store information.</span></span>
>   
> 
> <span data-ttu-id="62cc3-115">Recursos/tecnologias abordados:</span><span class="sxs-lookup"><span data-stu-id="62cc3-115">Features/technologies discussed:</span></span>
> 
> - <span data-ttu-id="62cc3-116">O auxiliar de `WebGrid`.</span><span class="sxs-lookup"><span data-stu-id="62cc3-116">The `WebGrid` helper.</span></span>
> - <span data-ttu-id="62cc3-117">O comando SQL `Update`.</span><span class="sxs-lookup"><span data-stu-id="62cc3-117">The SQL `Update` command.</span></span>
> - <span data-ttu-id="62cc3-118">O método `Database.Execute`.</span><span class="sxs-lookup"><span data-stu-id="62cc3-118">The `Database.Execute` method.</span></span>
> - <span data-ttu-id="62cc3-119">Campos ocultos (`<input type="hidden">`).</span><span class="sxs-lookup"><span data-stu-id="62cc3-119">Hidden fields (`<input type="hidden">`).</span></span>

## <a name="what-youll-build"></a><span data-ttu-id="62cc3-120">O que você vai construir</span><span class="sxs-lookup"><span data-stu-id="62cc3-120">What You'll Build</span></span>

<span data-ttu-id="62cc3-121">No tutorial anterior, você aprendeu a adicionar um registro a um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="62cc3-121">In the previous tutorial, you learned how to add a record to a database.</span></span> <span data-ttu-id="62cc3-122">Aqui, você aprenderá a exibir um registro para edição.</span><span class="sxs-lookup"><span data-stu-id="62cc3-122">Here, you'll learn how to display a record for editing.</span></span> <span data-ttu-id="62cc3-123">Na página *filmes* , você atualizará o `WebGrid` auxiliar para que ele exiba um link de **edição** ao lado de cada filme:</span><span class="sxs-lookup"><span data-stu-id="62cc3-123">In the *Movies* page, you'll update the `WebGrid` helper so that it displays an **Edit** link next to each movie:</span></span>

![Exibição do WebGrid, incluindo um link de ' Editar ' para cada filme](updating-data/_static/image1.png)

<span data-ttu-id="62cc3-125">Quando você clica no link **Editar** , ele leva para uma página diferente, onde as informações do filme já estão em um formato:</span><span class="sxs-lookup"><span data-stu-id="62cc3-125">When you click the **Edit** link, it takes you to a different page, where the movie information is already in a form:</span></span>

![Editar página de filme mostrando o filme a ser editado](updating-data/_static/image2.png)

<span data-ttu-id="62cc3-127">Você pode alterar qualquer um dos valores.</span><span class="sxs-lookup"><span data-stu-id="62cc3-127">You can change any of the values.</span></span> <span data-ttu-id="62cc3-128">Quando você envia as alterações, o código na página atualiza o banco de dados e o leva de volta à listagem de filmes.</span><span class="sxs-lookup"><span data-stu-id="62cc3-128">When you submit the changes, the code in the page updates the database and takes you back to the movie listing.</span></span>

<span data-ttu-id="62cc3-129">Essa parte do processo funciona quase exatamente como a página *addmovie. cshtml* criada no tutorial anterior, portanto, grande parte deste tutorial será familiar.</span><span class="sxs-lookup"><span data-stu-id="62cc3-129">This part of the process works almost exactly like the *AddMovie.cshtml* page you created in the previous tutorial, so much of this tutorial will be familiar.</span></span>

<span data-ttu-id="62cc3-130">Há várias maneiras de implementar um modo de edição de um filme individual.</span><span class="sxs-lookup"><span data-stu-id="62cc3-130">There are several ways you could implement a way to edit an individual movie.</span></span> <span data-ttu-id="62cc3-131">A abordagem mostrada foi escolhida porque é fácil de ser implementada e fácil de entender.</span><span class="sxs-lookup"><span data-stu-id="62cc3-131">The approach shown was chosen because it's easy to implement and easy to understand.</span></span>

## <a name="adding-an-edit-link-to-the-movie-listing"></a><span data-ttu-id="62cc3-132">Adicionando um link de edição à listagem de filmes</span><span class="sxs-lookup"><span data-stu-id="62cc3-132">Adding an Edit Link to the Movie Listing</span></span>

<span data-ttu-id="62cc3-133">Para começar, você atualizará a página de *filmes* para que cada listagem de filmes também contenha um link de **edição** .</span><span class="sxs-lookup"><span data-stu-id="62cc3-133">To begin, you'll update the *Movies* page so that each movie listing also contains an **Edit** link.</span></span>

<span data-ttu-id="62cc3-134">Abra o arquivo *Movies. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="62cc3-134">Open the *Movies.cshtml* file.</span></span>

<span data-ttu-id="62cc3-135">No corpo da página, altere a marcação de `WebGrid` adicionando uma coluna.</span><span class="sxs-lookup"><span data-stu-id="62cc3-135">In the body of the page, change the `WebGrid` markup by adding a column.</span></span> <span data-ttu-id="62cc3-136">Aqui está a marcação modificada:</span><span class="sxs-lookup"><span data-stu-id="62cc3-136">Here's the modified markup:</span></span>

[!code-html[Main](updating-data/samples/sample1.html?highlight=6)]

<span data-ttu-id="62cc3-137">A nova coluna é esta:</span><span class="sxs-lookup"><span data-stu-id="62cc3-137">The new column is this one:</span></span>

[!code-html[Main](updating-data/samples/sample2.html)]

<span data-ttu-id="62cc3-138">O ponto desta coluna é mostrar um link (`<a>` elemento) cujo texto diz "Editar".</span><span class="sxs-lookup"><span data-stu-id="62cc3-138">The point of this column is to show a link (`<a>` element) whose text says "Edit".</span></span> <span data-ttu-id="62cc3-139">O que estamos procurando é criar um link semelhante ao seguinte quando a página é executada, com o valor `id` diferente para cada filme:</span><span class="sxs-lookup"><span data-stu-id="62cc3-139">What we're after is to create a link that looks like the following when the page runs, with the `id` value different for each movie:</span></span>

[!code-css[Main](updating-data/samples/sample3.css)]

<span data-ttu-id="62cc3-140">Esse link invocará uma página chamada *EditMovie*e passará a cadeia de caracteres de consulta `?id=7` para essa página.</span><span class="sxs-lookup"><span data-stu-id="62cc3-140">This link will invoke a page named *EditMovie*, and it will pass the query string `?id=7` to that page.</span></span>

<span data-ttu-id="62cc3-141">A sintaxe da nova coluna pode parecer um pouco complexa, mas isso só ocorre porque ele reúne vários elementos.</span><span class="sxs-lookup"><span data-stu-id="62cc3-141">The syntax for the new column might look a bit complex, but that's only because it puts together several elements.</span></span> <span data-ttu-id="62cc3-142">Cada elemento individual é simples.</span><span class="sxs-lookup"><span data-stu-id="62cc3-142">Each individual element is straightforward.</span></span> <span data-ttu-id="62cc3-143">Se você se concentrar apenas no elemento `<a>`, verá esta marcação:</span><span class="sxs-lookup"><span data-stu-id="62cc3-143">If you concentrate on just the `<a>` element, you see this markup:</span></span>

[!code-html[Main](updating-data/samples/sample4.html)]

<span data-ttu-id="62cc3-144">Alguns planos de fundo sobre como a grade funciona: a grade exibe linhas, uma para cada registro de banco de dados e exibe colunas para cada campo no registro do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="62cc3-144">Some background about how the grid works: the grid displays rows, one for each database record, and it displays columns for each field in the database record.</span></span> <span data-ttu-id="62cc3-145">Enquanto cada linha de grade está sendo construída, o objeto `item` contém o registro de banco de dados (item) para essa linha.</span><span class="sxs-lookup"><span data-stu-id="62cc3-145">While each grid row is being constructed, the `item` object contains the database record (item) for that row.</span></span> <span data-ttu-id="62cc3-146">Esse arranjo fornece uma maneira no código para obter os dados dessa linha.</span><span class="sxs-lookup"><span data-stu-id="62cc3-146">This arrangement gives you a way in code to get at the data for that row.</span></span> <span data-ttu-id="62cc3-147">É isso o que você vê aqui: a expressão `item.ID` está obtendo o valor de ID do item de banco de dados atual.</span><span class="sxs-lookup"><span data-stu-id="62cc3-147">That's what you see here: the expression `item.ID` is getting the ID value of the current database item.</span></span> <span data-ttu-id="62cc3-148">Você pode obter qualquer um dos valores do banco de dados (título, gênero ou ano) da mesma maneira usando `item.Title`, `item.Genre`ou `item.Year`.</span><span class="sxs-lookup"><span data-stu-id="62cc3-148">You could get any of the database values (title, genre, or year) the same way by using `item.Title`, `item.Genre`, or `item.Year`.</span></span>

<span data-ttu-id="62cc3-149">A expressão `"~/EditMovie?id=@item.ID` combina a parte embutida em código da URL de destino (`~/EditMovie?id=`) com essa ID derivada dinamicamente.</span><span class="sxs-lookup"><span data-stu-id="62cc3-149">The expression `"~/EditMovie?id=@item.ID` combines the hard-coded part of the target URL (`~/EditMovie?id=`) with this dynamically derived ID.</span></span> <span data-ttu-id="62cc3-150">(Você viu o operador de `~` no tutorial anterior; é um operador ASP.NET que representa a raiz do site atual.)</span><span class="sxs-lookup"><span data-stu-id="62cc3-150">(You saw the `~` operator in the previous tutorial; it's an ASP.NET operator that represents the current website root.)</span></span>

<span data-ttu-id="62cc3-151">O resultado é que essa parte da marcação na coluna simplesmente produz algo semelhante à marcação a seguir em tempo de execução:</span><span class="sxs-lookup"><span data-stu-id="62cc3-151">The result is that this part of the markup in the column simply produces something like the following markup at run time:</span></span>

[!code-xml[Main](updating-data/samples/sample5.xml)]

<span data-ttu-id="62cc3-152">Naturalmente, o valor real de `id` será diferente para cada linha.</span><span class="sxs-lookup"><span data-stu-id="62cc3-152">Naturally, the actual value of `id` will be different for each row.</span></span>

## <a name="creating-a-custom-display-for-a-grid-column"></a><span data-ttu-id="62cc3-153">Criando uma exibição personalizada para uma coluna de grade</span><span class="sxs-lookup"><span data-stu-id="62cc3-153">Creating a Custom Display for a Grid Column</span></span>

<span data-ttu-id="62cc3-154">Agora, volte para a coluna de grade.</span><span class="sxs-lookup"><span data-stu-id="62cc3-154">Now back to the grid column.</span></span> <span data-ttu-id="62cc3-155">As três colunas que você tinha originalmente na grade exibiram apenas valores de dados (título, gênero e ano).</span><span class="sxs-lookup"><span data-stu-id="62cc3-155">The three columns you originally had in the grid displayed only data values (title, genre, and year).</span></span> <span data-ttu-id="62cc3-156">Você especificou essa exibição passando o nome da coluna de banco de dados &mdash; por exemplo, `grid.Column("Title")`.</span><span class="sxs-lookup"><span data-stu-id="62cc3-156">You specified this display by passing the name of the database column &mdash; for example, `grid.Column("Title")`.</span></span>

<span data-ttu-id="62cc3-157">Essa nova coluna de link de **edição** é diferente.</span><span class="sxs-lookup"><span data-stu-id="62cc3-157">This new **Edit** link column is different.</span></span> <span data-ttu-id="62cc3-158">Em vez de especificar um nome de coluna, você está passando um parâmetro de `format`.</span><span class="sxs-lookup"><span data-stu-id="62cc3-158">Instead of specifying a column name, you're passing a `format` parameter.</span></span> <span data-ttu-id="62cc3-159">Esse parâmetro permite que você defina a marcação que o auxiliar de `WebGrid` processará junto com o valor de `item` para exibir os dados da coluna como negrito ou verde ou em qualquer formato desejado.</span><span class="sxs-lookup"><span data-stu-id="62cc3-159">This parameter lets you define markup that the `WebGrid` helper will render along with the `item` value to display the column data as bold or green or in whatever format that you want.</span></span> <span data-ttu-id="62cc3-160">Por exemplo, se você quisesse que o título aparecesse em negrito, você poderia criar uma coluna como este exemplo:</span><span class="sxs-lookup"><span data-stu-id="62cc3-160">For example, if you wanted the title to appear bold, you could create a column like this example:</span></span>

[!code-html[Main](updating-data/samples/sample6.html)]

<span data-ttu-id="62cc3-161">(Os vários `@` caracteres que você vê na propriedade `format` marcam a transição entre marcação e um valor de código.)</span><span class="sxs-lookup"><span data-stu-id="62cc3-161">(The various `@` characters you see in the `format` property mark the transition between markup and a code value.)</span></span>

<span data-ttu-id="62cc3-162">Depois de conhecer a propriedade `format`, é mais fácil entender como a nova coluna de link de **edição** é agrupada:</span><span class="sxs-lookup"><span data-stu-id="62cc3-162">Once you know about the `format` property, it's easier to understand how the new **Edit** link column is put together:</span></span>

[!code-html[Main](updating-data/samples/sample7.html)]

<span data-ttu-id="62cc3-163">A coluna consiste *apenas* na marcação que renderiza o link, além de algumas informações (a ID) que são extraídas do registro de banco de dados para a linha.</span><span class="sxs-lookup"><span data-stu-id="62cc3-163">The column consists *only* of the markup that renders the link, plus some information (the ID) that's extracted from the database record for the row.</span></span>

> [!TIP]
> 
> <span data-ttu-id="62cc3-164">**Parâmetros nomeados e parâmetros posicionais para um método**</span><span class="sxs-lookup"><span data-stu-id="62cc3-164">**Named Parameters and Positional Parameters for a Method**</span></span>
> 
> <span data-ttu-id="62cc3-165">Muitas vezes, quando você chamou um método e passou parâmetros para ele, você simplesmente listou os valores de parâmetro separados por vírgulas.</span><span class="sxs-lookup"><span data-stu-id="62cc3-165">Many times when you've called a method and passed parameters to it, you've simply listed the parameter values separated by commas.</span></span> <span data-ttu-id="62cc3-166">Aqui estão alguns exemplos:</span><span class="sxs-lookup"><span data-stu-id="62cc3-166">Here are a couple of examples:</span></span>
> 
> `db.Execute(insertCommand, title, genre, year)`
> 
> `Validation.RequireField("title", "You must enter a title")`
> 
> <span data-ttu-id="62cc3-167">Não mencionamos o problema quando você viu o código pela primeira vez, mas, em cada caso, você está passando parâmetros para os métodos em uma ordem específica &mdash; ou seja, a ordem na qual os parâmetros são definidos nesse método.</span><span class="sxs-lookup"><span data-stu-id="62cc3-167">We didn't mention the issue when you first saw this code, but in each case, you're passing parameters to the methods in a specific order &mdash; namely, the order in which the parameters are defined in that method.</span></span> <span data-ttu-id="62cc3-168">Para `db.Execute` e `Validation.RequireFields`, se você misturou a ordem dos valores que passa, receberá uma mensagem de erro quando a página for executada ou, pelo menos, alguns resultados estranhos.</span><span class="sxs-lookup"><span data-stu-id="62cc3-168">For `db.Execute` and `Validation.RequireFields`, if you mixed up the order of the values you pass, you'd get an error message when the page runs, or at least some strange results.</span></span> <span data-ttu-id="62cc3-169">Claramente, você precisa saber o pedido para passar os parâmetros.</span><span class="sxs-lookup"><span data-stu-id="62cc3-169">Clearly, you have to know the order to pass the parameters in.</span></span> <span data-ttu-id="62cc3-170">(No WebMatrix, o IntelliSense pode ajudá-lo a aprender a descobrir o nome, o tipo e a ordem dos parâmetros.)</span><span class="sxs-lookup"><span data-stu-id="62cc3-170">(In WebMatrix, IntelliSense can help you learn figure out the name, type, and order of the parameters.)</span></span>
> 
> <span data-ttu-id="62cc3-171">Como uma alternativa para passar valores na ordem, você pode usar *parâmetros nomeados*.</span><span class="sxs-lookup"><span data-stu-id="62cc3-171">As an alternative to passing values in order, you can use *named parameters*.</span></span> <span data-ttu-id="62cc3-172">(Passar parâmetros na ordem é conhecido como usar *parâmetros posicionais*.) Para parâmetros nomeados, você inclui explicitamente o nome do parâmetro ao passar seu valor.</span><span class="sxs-lookup"><span data-stu-id="62cc3-172">(Passing parameters in order is known as using *positional parameters*.) For named parameters, you explicitly include the name of the parameter when passing its value.</span></span> <span data-ttu-id="62cc3-173">Você usou parâmetros nomeados já várias vezes nesses tutoriais.</span><span class="sxs-lookup"><span data-stu-id="62cc3-173">You've used named parameters already a number of times in these tutorials.</span></span> <span data-ttu-id="62cc3-174">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="62cc3-174">For example:</span></span>
> 
> [!code-csharp[Main](updating-data/samples/sample8.cs)]
> 
> <span data-ttu-id="62cc3-175">e</span><span class="sxs-lookup"><span data-stu-id="62cc3-175">and</span></span>
> 
> [!code-css[Main](updating-data/samples/sample9.css)]
> 
> <span data-ttu-id="62cc3-176">Os parâmetros nomeados são úteis para algumas situações, especialmente quando um método usa muitos parâmetros.</span><span class="sxs-lookup"><span data-stu-id="62cc3-176">Named parameters are handy for a couple of situations, especially when a method takes many parameters.</span></span> <span data-ttu-id="62cc3-177">Uma é quando você deseja passar apenas um ou dois parâmetros, mas os valores que você deseja passar não estão entre as primeiras posições na lista de parâmetros.</span><span class="sxs-lookup"><span data-stu-id="62cc3-177">One is when you want to pass only one or two parameters, but the values you want to pass are not among the first positions in the parameter list.</span></span> <span data-ttu-id="62cc3-178">Outra situação é quando você deseja tornar seu código mais legível passando os parâmetros na ordem que faz mais sentido para você.</span><span class="sxs-lookup"><span data-stu-id="62cc3-178">Another situation is when you want to make your code more readable by passing the parameters in the order that makes the most sense to you.</span></span>
> 
> <span data-ttu-id="62cc3-179">Obviamente, para usar parâmetros nomeados, você precisa saber os nomes dos parâmetros.</span><span class="sxs-lookup"><span data-stu-id="62cc3-179">Obviously, to use named parameters, you have to know the names of the parameters.</span></span> <span data-ttu-id="62cc3-180">O WebMatrix IntelliSense pode *Mostrar* os nomes, mas ele não pode preenchê-los no momento para você.</span><span class="sxs-lookup"><span data-stu-id="62cc3-180">WebMatrix IntelliSense can *show* you the names, but it cannot currently fill them in for you.</span></span>

## <a name="creating-the-edit-page"></a><span data-ttu-id="62cc3-181">Criando a página de edição</span><span class="sxs-lookup"><span data-stu-id="62cc3-181">Creating the Edit Page</span></span>

<span data-ttu-id="62cc3-182">Agora você pode criar a página *EditMovie* .</span><span class="sxs-lookup"><span data-stu-id="62cc3-182">Now you can create the *EditMovie* page.</span></span> <span data-ttu-id="62cc3-183">Quando os usuários clicarem no link **Editar** , eles terminarão nesta página.</span><span class="sxs-lookup"><span data-stu-id="62cc3-183">When users click the **Edit** link, they'll end up on this page.</span></span>

<span data-ttu-id="62cc3-184">Crie uma página chamada *EditMovie. cshtml* e substitua o que está no arquivo pela seguinte marcação:</span><span class="sxs-lookup"><span data-stu-id="62cc3-184">Create a page named *EditMovie.cshtml* and replace what's in the file with the following markup:</span></span>

[!code-cshtml[Main](updating-data/samples/sample10.cshtml)]

<span data-ttu-id="62cc3-185">Essa marcação e código é semelhante ao que você tem na página *addmovie* .</span><span class="sxs-lookup"><span data-stu-id="62cc3-185">This markup and code is similar to what you have in the *AddMovie* page.</span></span> <span data-ttu-id="62cc3-186">Há uma pequena diferença no texto do botão enviar.</span><span class="sxs-lookup"><span data-stu-id="62cc3-186">There's a small difference in the text for the submit button.</span></span> <span data-ttu-id="62cc3-187">Assim como acontece com a página *addmovie* , há uma chamada `Html.ValidationSummary` que exibirá erros de validação, se houver algum.</span><span class="sxs-lookup"><span data-stu-id="62cc3-187">As with the *AddMovie* page, there's an `Html.ValidationSummary` call that will display validation errors if there are any.</span></span> <span data-ttu-id="62cc3-188">Desta vez, vamos sair de chamadas para `Validation.Message`, pois os erros serão exibidos no Resumo de validação.</span><span class="sxs-lookup"><span data-stu-id="62cc3-188">This time we're leaving out calls to `Validation.Message`, since errors will be displayed in the validation summary.</span></span> <span data-ttu-id="62cc3-189">Conforme observado no tutorial anterior, você pode usar o resumo de validação e as mensagens de erro individuais em várias combinações.</span><span class="sxs-lookup"><span data-stu-id="62cc3-189">As noted in the previous tutorial, you can use the validation summary and the individual error messages in various combinations.</span></span>

<span data-ttu-id="62cc3-190">Observe novamente que o atributo `method` do elemento `<form>` está definido como `post`.</span><span class="sxs-lookup"><span data-stu-id="62cc3-190">Notice again that the `method` attribute of the `<form>` element is set to `post`.</span></span> <span data-ttu-id="62cc3-191">Assim como acontece com a página *addmovie. cshtml* , essa página faz alterações no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="62cc3-191">As with the *AddMovie.cshtml* page, this page makes changes to the database.</span></span> <span data-ttu-id="62cc3-192">Portanto, esse formulário deve executar uma operação `POST`.</span><span class="sxs-lookup"><span data-stu-id="62cc3-192">Therefore, this form should perform a `POST` operation.</span></span> <span data-ttu-id="62cc3-193">(Para obter mais informações sobre a diferença entre as operações de `GET` e `POST`, consulte a barra lateral de [segurança de verbo GET, post e http](form-basics.md#GET,_POST,_and_HTTP_Verb_Safety) no tutorial em formulários HTML.)</span><span class="sxs-lookup"><span data-stu-id="62cc3-193">(For more about the difference between `GET` and `POST` operations, see the [GET, POST, and HTTP Verb Safety](form-basics.md#GET,_POST,_and_HTTP_Verb_Safety) sidebar in the tutorial on HTML forms.)</span></span>

<span data-ttu-id="62cc3-194">Como vimos em um tutorial anterior, os `value` atributos das caixas de texto estão sendo definidos com o código do Razor para pré-carregar-los.</span><span class="sxs-lookup"><span data-stu-id="62cc3-194">As you saw in an earlier tutorial, the `value` attributes of the text boxes are being set with Razor code in order to preload them.</span></span> <span data-ttu-id="62cc3-195">Desta vez, no entanto, você está usando variáveis como `title` e `genre` para essa tarefa em vez de `Request.Form["title"]`:</span><span class="sxs-lookup"><span data-stu-id="62cc3-195">This time, though, you're using variables like `title` and `genre` for that task instead of `Request.Form["title"]`:</span></span>

`<input type="text" name="title" value="@title" />`

<span data-ttu-id="62cc3-196">Como antes, essa marcação descarregará os valores da caixa de texto com os valores do filme.</span><span class="sxs-lookup"><span data-stu-id="62cc3-196">As before, this markup will preload the text box values with the movie values.</span></span> <span data-ttu-id="62cc3-197">Você verá em um momento por que é útil usar variáveis desta vez em vez de usar o objeto `Request`.</span><span class="sxs-lookup"><span data-stu-id="62cc3-197">You'll see in a moment why it's handy to use variables this time instead of using the `Request` object.</span></span>

<span data-ttu-id="62cc3-198">Também há um elemento `<input type="hidden">` nesta página.</span><span class="sxs-lookup"><span data-stu-id="62cc3-198">There's also a `<input type="hidden">` element on this page.</span></span> <span data-ttu-id="62cc3-199">Esse elemento armazena a ID do filme sem torná-la visível na página.</span><span class="sxs-lookup"><span data-stu-id="62cc3-199">This element stores the movie ID without making it visible on the page.</span></span> <span data-ttu-id="62cc3-200">A ID é passada inicialmente para a página usando um valor de cadeia de caracteres de consulta (`?id=7` ou semelhante na URL).</span><span class="sxs-lookup"><span data-stu-id="62cc3-200">The ID is initially passed to the page by using a query string value (`?id=7` or similar in the URL).</span></span> <span data-ttu-id="62cc3-201">Ao colocar o valor de ID em um campo oculto, você pode verificar se ele está disponível quando o formulário é enviado, mesmo que você não tenha mais acesso à URL original com a qual a página foi chamada.</span><span class="sxs-lookup"><span data-stu-id="62cc3-201">By putting the ID value into a hidden field, you can make sure that it's available when the form is submitted, even if you no longer have access to the original URL that the page was invoked with.</span></span>

<span data-ttu-id="62cc3-202">Ao contrário da página *addmovie* , o código da página *EditMovie* tem duas funções distintas.</span><span class="sxs-lookup"><span data-stu-id="62cc3-202">Unlike the *AddMovie* page, the code for the *EditMovie* page has two distinct functions.</span></span> <span data-ttu-id="62cc3-203">A primeira função é que, quando a página é exibida pela primeira vez (e *apenas* depois), o código obtém a ID do filme da cadeia de caracteres de consulta.</span><span class="sxs-lookup"><span data-stu-id="62cc3-203">The first function is that when the page is displayed for the first time (and *only* then), the code gets the movie ID from the query string.</span></span> <span data-ttu-id="62cc3-204">Em seguida, o código usa a ID para ler o filme correspondente do banco de dados e exibir (pré-carregar) nele nas caixas de texto.</span><span class="sxs-lookup"><span data-stu-id="62cc3-204">The code then uses the ID to read the corresponding movie out of the database and display (preload) it in the text boxes.</span></span>

<span data-ttu-id="62cc3-205">A segunda função é que, quando o usuário clica no botão **enviar alterações** , o código precisa ler os valores das caixas de texto e validá-los.</span><span class="sxs-lookup"><span data-stu-id="62cc3-205">The second function is that when the user clicks the **Submit Changes** button, the code has to read the values of the text boxes and validate them.</span></span> <span data-ttu-id="62cc3-206">O código também precisa atualizar o item do banco de dados com os novos valores.</span><span class="sxs-lookup"><span data-stu-id="62cc3-206">The code also has to update the database item with the new values.</span></span> <span data-ttu-id="62cc3-207">Essa técnica é semelhante à adição de um registro, como vimos em *addmovie*.</span><span class="sxs-lookup"><span data-stu-id="62cc3-207">This technique is similar to adding a record, as you saw in *AddMovie*.</span></span>

## <a name="adding-code-to-read-a-single-movie"></a><span data-ttu-id="62cc3-208">Adicionando código para ler um único filme</span><span class="sxs-lookup"><span data-stu-id="62cc3-208">Adding Code to Read a Single Movie</span></span>

<span data-ttu-id="62cc3-209">Para executar a primeira função, adicione este código à parte superior da página:</span><span class="sxs-lookup"><span data-stu-id="62cc3-209">To perform the first function, add this code to the top of the page:</span></span>

[!code-cshtml[Main](updating-data/samples/sample11.cshtml)]

<span data-ttu-id="62cc3-210">A maior parte desse código está dentro de um bloco que inicia `if(!IsPost)`.</span><span class="sxs-lookup"><span data-stu-id="62cc3-210">Most of this code is inside a block that starts `if(!IsPost)`.</span></span> <span data-ttu-id="62cc3-211">O operador de `!` significa "Not", portanto, a expressão significa que *se essa solicitação não for um envio de postagem*, que é uma maneira indireta de dizer *se essa solicitação é a primeira vez que essa página foi executada*.</span><span class="sxs-lookup"><span data-stu-id="62cc3-211">The `!` operator means "not," so the expression means *if this request is not a post submission*, which is an indirect way of saying *if this request is the first time that this page has been run*.</span></span> <span data-ttu-id="62cc3-212">Conforme observado anteriormente, esse código deve ser executado *apenas* na primeira vez em que a página é executada.</span><span class="sxs-lookup"><span data-stu-id="62cc3-212">As noted earlier, this code should run *only* the first time the page runs.</span></span> <span data-ttu-id="62cc3-213">Se você não tiver colocado o código em `if(!IsPost)`, ele seria executado toda vez que a página for invocada, seja na primeira vez ou em resposta a um clique de botão.</span><span class="sxs-lookup"><span data-stu-id="62cc3-213">If you didn't enclose the code in `if(!IsPost)`, it would run every time the page is invoked, whether the first time or in response to a button click.</span></span>

<span data-ttu-id="62cc3-214">Observe que o código inclui um `else` bloco desta vez.</span><span class="sxs-lookup"><span data-stu-id="62cc3-214">Notice that the code includes an `else` block this time.</span></span> <span data-ttu-id="62cc3-215">Como dissemos Quando introduzimos `if` blocos, às vezes você deseja executar um código alternativo se a condição que você está testando não for verdadeira.</span><span class="sxs-lookup"><span data-stu-id="62cc3-215">As we said when we introduced `if` blocks, sometimes you want to run alternative code if the condition you're testing isn't true.</span></span> <span data-ttu-id="62cc3-216">Esse é o caso aqui.</span><span class="sxs-lookup"><span data-stu-id="62cc3-216">That's the case here.</span></span> <span data-ttu-id="62cc3-217">Se a condição for aprovada (ou seja, se a ID passada para a página estiver ok), você lerá uma linha do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="62cc3-217">If the condition passes (that is, if the ID passed to the page is ok), you read a row from the database.</span></span> <span data-ttu-id="62cc3-218">No entanto, se a condição não passar, o bloco de `else` será executado e o código definirá uma mensagem de erro.</span><span class="sxs-lookup"><span data-stu-id="62cc3-218">However, if the condition doesn't pass, the `else` block runs and the code sets an error message.</span></span>

## <a name="validating-a-value-passed-to-the-page"></a><span data-ttu-id="62cc3-219">Validando um valor passado para a página</span><span class="sxs-lookup"><span data-stu-id="62cc3-219">Validating a Value Passed to the Page</span></span>

<span data-ttu-id="62cc3-220">O código usa `Request.QueryString["id"]` para obter a ID que é passada para a página.</span><span class="sxs-lookup"><span data-stu-id="62cc3-220">The code uses `Request.QueryString["id"]` to get the ID that's passed to the page.</span></span> <span data-ttu-id="62cc3-221">O código garante que um valor foi realmente passado para a ID.</span><span class="sxs-lookup"><span data-stu-id="62cc3-221">The code makes sure that a value was actually passed for the ID.</span></span> <span data-ttu-id="62cc3-222">Se nenhum valor foi passado, o código definirá um erro de validação.</span><span class="sxs-lookup"><span data-stu-id="62cc3-222">If no value was passed, the code sets a validation error.</span></span>

<span data-ttu-id="62cc3-223">Esse código mostra uma maneira diferente de validar informações.</span><span class="sxs-lookup"><span data-stu-id="62cc3-223">This code shows a different way to validate information.</span></span> <span data-ttu-id="62cc3-224">No tutorial anterior, você trabalhou com o auxiliar de `Validation`.</span><span class="sxs-lookup"><span data-stu-id="62cc3-224">In the previous tutorial, you worked with the `Validation` helper.</span></span> <span data-ttu-id="62cc3-225">Você registrou os campos para validar e ASP.NET automaticamente os erros de validação e exibição usando `Html.ValidationMessage` e `Html.ValidationSummary`.</span><span class="sxs-lookup"><span data-stu-id="62cc3-225">You registered fields to validate, and ASP.NET automatically did the validation and displayed errors by using `Html.ValidationMessage` and `Html.ValidationSummary`.</span></span> <span data-ttu-id="62cc3-226">Nesse caso, no entanto, você não está realmente validando a entrada do usuário.</span><span class="sxs-lookup"><span data-stu-id="62cc3-226">In this case, however, you're not really validating user input.</span></span> <span data-ttu-id="62cc3-227">Em vez disso, você está validando um valor que foi passado para a página de outro lugar.</span><span class="sxs-lookup"><span data-stu-id="62cc3-227">Instead, you're validating a value that was passed to the page from elsewhere.</span></span> <span data-ttu-id="62cc3-228">O auxiliar de `Validation` não faz isso para você.</span><span class="sxs-lookup"><span data-stu-id="62cc3-228">The `Validation` helper doesn't do that for you.</span></span>

<span data-ttu-id="62cc3-229">Portanto, você verifica o valor por conta própria, testando-o com `if(!Request.QueryString["ID"].IsEmpty()`).</span><span class="sxs-lookup"><span data-stu-id="62cc3-229">Therefore, you check the value yourself, by testing it with `if(!Request.QueryString["ID"].IsEmpty()`).</span></span> <span data-ttu-id="62cc3-230">Se houver um problema, você poderá exibir o erro usando `Html.ValidationSummary`, como fez com o auxiliar de `Validation`.</span><span class="sxs-lookup"><span data-stu-id="62cc3-230">If there's a problem, you can display the error by using `Html.ValidationSummary`, as you did with the `Validation` helper.</span></span> <span data-ttu-id="62cc3-231">Para fazer isso, você chama `Validation.AddFormError` e passa a ela uma mensagem a ser exibida.</span><span class="sxs-lookup"><span data-stu-id="62cc3-231">To do that, you call `Validation.AddFormError` and pass it a message to display.</span></span> <span data-ttu-id="62cc3-232">`Validation.AddFormError` é um método interno que permite definir mensagens personalizadas que se unem com o sistema de validação com o qual você já está familiarizado.</span><span class="sxs-lookup"><span data-stu-id="62cc3-232">`Validation.AddFormError` is a built-in method that lets you define custom messages that tie in with the validation system you're already familiar with.</span></span> <span data-ttu-id="62cc3-233">(Mais adiante neste tutorial, falaremos sobre como tornar esse processo de validação um pouco mais robusto.)</span><span class="sxs-lookup"><span data-stu-id="62cc3-233">(Later in this tutorial we'll talk about how to make this validation process a little more robust.)</span></span>

<span data-ttu-id="62cc3-234">Depois de verificar se há uma ID para o filme, o código lê o banco de dados, procurando apenas um único item de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="62cc3-234">After making sure that there's an ID for the movie, the code reads the database, looking for only a single database item.</span></span> <span data-ttu-id="62cc3-235">(Você provavelmente observou o padrão geral para operações de banco de dados: Abra o banco de dados, defina uma instrução SQL e execute a instrução.) Desta vez, a instrução SQL `Select` inclui `WHERE ID = @0`.</span><span class="sxs-lookup"><span data-stu-id="62cc3-235">(You probably have noticed the general pattern for database operations: open the database, define a SQL statement, and run the statement.) This time, the SQL `Select` statement includes `WHERE ID = @0`.</span></span> <span data-ttu-id="62cc3-236">Como a ID é exclusiva, somente um registro pode ser retornado.</span><span class="sxs-lookup"><span data-stu-id="62cc3-236">Because the ID is unique, only one record can be returned.</span></span>

<span data-ttu-id="62cc3-237">A consulta é executada usando `db.QuerySingle` (não `db.Query`, como você usou para a listagem de filmes) e o código coloca o resultado na variável `row`.</span><span class="sxs-lookup"><span data-stu-id="62cc3-237">The query is performed by using `db.QuerySingle` (not `db.Query`, as you used for the movie listing), and the code puts the result into the `row` variable.</span></span> <span data-ttu-id="62cc3-238">O nome `row` é arbitrário; Você pode nomear as variáveis como desejar.</span><span class="sxs-lookup"><span data-stu-id="62cc3-238">The name `row` is arbitrary; you can name the variables anything you like.</span></span> <span data-ttu-id="62cc3-239">As variáveis inicializadas na parte superior são então preenchidas com os detalhes do filme para que esses valores possam ser exibidos nas caixas de texto.</span><span class="sxs-lookup"><span data-stu-id="62cc3-239">The variables initialized at the top are then filled with the movie details so that these values can be displayed in the text boxes.</span></span>

## <a name="testing-the-edit-page-so-far"></a><span data-ttu-id="62cc3-240">Testando a página de edição (até agora)</span><span class="sxs-lookup"><span data-stu-id="62cc3-240">Testing the Edit Page (So Far)</span></span>

<span data-ttu-id="62cc3-241">Se você quiser testar sua página, execute a página *filmes* agora e clique em um link de **edição** ao lado de qualquer filme.</span><span class="sxs-lookup"><span data-stu-id="62cc3-241">If you'd like to test your page, run the *Movies* page now and click an **Edit** link next to any movie.</span></span> <span data-ttu-id="62cc3-242">Você verá a página *EditMovie* com os detalhes preenchidos para o filme selecionado:</span><span class="sxs-lookup"><span data-stu-id="62cc3-242">You'll see the *EditMovie* page with the details filled in for the movie you selected:</span></span>

![Editar página de filme mostrando o filme a ser editado](updating-data/_static/image3.png)

<span data-ttu-id="62cc3-244">Observe que a URL da página inclui algo como `?id=10` (ou algum outro número).</span><span class="sxs-lookup"><span data-stu-id="62cc3-244">Notice that the URL of the page includes something like `?id=10` (or some other number).</span></span> <span data-ttu-id="62cc3-245">Até agora, você testou que os links de **edição** na página do *filme* funcionam, que sua página está lendo a ID da cadeia de caracteres de consulta e que a consulta do banco de dados para obter um único registro de filme está funcionando.</span><span class="sxs-lookup"><span data-stu-id="62cc3-245">So far you've tested that **Edit** links in the *Movie* page work, that your page is reading the ID from the query string, and that the database query to get a single movie record is working.</span></span>

<span data-ttu-id="62cc3-246">Você pode alterar as informações do filme, mas nada acontece quando você clica em **enviar alterações**.</span><span class="sxs-lookup"><span data-stu-id="62cc3-246">You can change the movie information, but nothing happens when you click **Submit Changes**.</span></span>

## <a name="adding-code-to-update-the-movie-with-the-users-changes"></a><span data-ttu-id="62cc3-247">Adicionando código para atualizar o filme com as alterações do usuário</span><span class="sxs-lookup"><span data-stu-id="62cc3-247">Adding Code to Update the Movie with the User's Changes</span></span>

<span data-ttu-id="62cc3-248">No arquivo *EditMovie. cshtml* , para implementar a segunda função (salvar alterações), adicione o código a seguir apenas dentro da chave de fechamento do bloco de `@`.</span><span class="sxs-lookup"><span data-stu-id="62cc3-248">In the *EditMovie.cshtml* file, to implement the second function (saving changes), add the following code just inside the closing brace of the `@` block.</span></span> <span data-ttu-id="62cc3-249">(Se você não tiver certeza de onde colocar o código, poderá examinar a [listagem de código completa da página Editar filme](#Complete_Page_Listing_for_EditMovie) que aparece no final deste tutorial.)</span><span class="sxs-lookup"><span data-stu-id="62cc3-249">(If you're not sure exactly where to put the code, you can look at the [complete code listing for the Edit Movie page](#Complete_Page_Listing_for_EditMovie) that appears at the end of this tutorial.)</span></span>

[!code-csharp[Main](updating-data/samples/sample12.cs)]

<span data-ttu-id="62cc3-250">Novamente, essa marcação e código é semelhante ao código em *addmovie*.</span><span class="sxs-lookup"><span data-stu-id="62cc3-250">Again, this markup and code is similar to the code in *AddMovie*.</span></span> <span data-ttu-id="62cc3-251">O código está em um bloco de `if(IsPost)`, porque esse código é executado somente quando o usuário clica no botão **enviar alterações** &mdash; ou seja, quando (e somente quando) o formulário foi Postado.</span><span class="sxs-lookup"><span data-stu-id="62cc3-251">The code is in an `if(IsPost)` block, because this code runs only when the user clicks the **Submit Changes** button &mdash; that is, when (and only when) the form has been posted.</span></span> <span data-ttu-id="62cc3-252">Nesse caso, você não está usando um teste como `if(IsPost && Validation.IsValid())`— ou seja, você não está combinando ambos os testes usando e.</span><span class="sxs-lookup"><span data-stu-id="62cc3-252">In this case, you're not using a test like `if(IsPost && Validation.IsValid())`— that is, you're not combining both tests by using AND.</span></span> <span data-ttu-id="62cc3-253">Nesta página, primeiro você determina se há um envio de formulário (`if(IsPost)`) e, em seguida, registra apenas os campos para validação.</span><span class="sxs-lookup"><span data-stu-id="62cc3-253">In this page, you first determine whether there's a form submission (`if(IsPost)`), and only then register the fields for validation.</span></span> <span data-ttu-id="62cc3-254">Em seguida, você pode testar os resultados da validação (`if(Validation.IsValid()`).</span><span class="sxs-lookup"><span data-stu-id="62cc3-254">Then you can test the validation results (`if(Validation.IsValid()`).</span></span> <span data-ttu-id="62cc3-255">O fluxo é ligeiramente diferente da página *addmovie. cshtml* , mas o efeito é o mesmo.</span><span class="sxs-lookup"><span data-stu-id="62cc3-255">The flow is slightly different than in the *AddMovie.cshtml* page, but the effect is the same.</span></span>

<span data-ttu-id="62cc3-256">Você Obtém os valores das caixas de texto usando `Request.Form["title"]` e código semelhante para os outros elementos de `<input>`.</span><span class="sxs-lookup"><span data-stu-id="62cc3-256">You get the values of the text boxes by using `Request.Form["title"]` and similar code for the other `<input>` elements.</span></span> <span data-ttu-id="62cc3-257">Observe que, desta vez, o código obtém a ID do filme do campo oculto (`<input type="hidden">`).</span><span class="sxs-lookup"><span data-stu-id="62cc3-257">Notice that this time, the code gets the movie ID out of the hidden field (`<input type="hidden">`).</span></span> <span data-ttu-id="62cc3-258">Quando a página foi executada pela primeira vez, o código obteve a ID da cadeia de caracteres de consulta.</span><span class="sxs-lookup"><span data-stu-id="62cc3-258">When the page ran the first time, the code got the ID out of the query string.</span></span> <span data-ttu-id="62cc3-259">Você Obtém o valor do campo oculto para certificar-se de que está obtendo a ID do filme que foi originalmente exibido, caso a cadeia de caracteres de consulta tenha sido alterada de alguma forma, desde então.</span><span class="sxs-lookup"><span data-stu-id="62cc3-259">You get the value from the hidden field to make sure that you're getting the ID of the movie that was originally displayed, in case the query string was somehow altered since then.</span></span>

<span data-ttu-id="62cc3-260">A diferença realmente importante entre o código *addmovie* e esse código é que, nesse código, você usa a instrução SQL `Update` em vez da instrução `Insert Into`.</span><span class="sxs-lookup"><span data-stu-id="62cc3-260">The really important difference between the *AddMovie* code and this code is that in this code you use the SQL `Update` statement instead of the `Insert Into` statement.</span></span> <span data-ttu-id="62cc3-261">O exemplo a seguir mostra a sintaxe da instrução SQL `Update`:</span><span class="sxs-lookup"><span data-stu-id="62cc3-261">The following example shows the syntax of the SQL `Update` statement:</span></span>

`UPDATE table SET col1="value", col2="value", col3="value" ... WHERE ID = value`

<span data-ttu-id="62cc3-262">Você pode especificar quaisquer colunas em qualquer ordem, e não precisa necessariamente atualizar todas as colunas durante uma operação de `Update`.</span><span class="sxs-lookup"><span data-stu-id="62cc3-262">You can specify any columns in any order, and you don't necessarily have to update every column during an `Update` operation.</span></span> <span data-ttu-id="62cc3-263">(Você não pode atualizar a própria ID, pois isso teria efeito salvar o registro como um novo registro, e isso não é permitido para uma operação de `Update`.)</span><span class="sxs-lookup"><span data-stu-id="62cc3-263">(You cannot update the ID itself, because that would in effect save the record as a new record, and that's not allowed for an `Update` operation.)</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="62cc3-264">**Importante** A cláusula `Where` com a ID é muito importante, pois é assim que o banco de dados sabe qual registro de banco de dados você deseja atualizar.</span><span class="sxs-lookup"><span data-stu-id="62cc3-264">**Important** The `Where` clause with the ID is very important, because that's how the database knows which database record you want to update.</span></span> <span data-ttu-id="62cc3-265">Se você deixou a cláusula `Where`, o banco de dados atualizaria *todos* os registros no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="62cc3-265">If you left off the `Where` clause, the database would update *every* record in the database.</span></span> <span data-ttu-id="62cc3-266">Na maioria dos casos, isso seria um desastre.</span><span class="sxs-lookup"><span data-stu-id="62cc3-266">In most cases, that would be a disaster.</span></span>

<span data-ttu-id="62cc3-267">No código, os valores a serem atualizados são passados para a instrução SQL usando espaços reservados.</span><span class="sxs-lookup"><span data-stu-id="62cc3-267">In the code, the values to update are passed to the SQL statement by using placeholders.</span></span> <span data-ttu-id="62cc3-268">Para repetir o que dissemos antes: por motivos de segurança, use *somente* espaços reservados para passar valores para uma instrução SQL.</span><span class="sxs-lookup"><span data-stu-id="62cc3-268">To repeat what we've said before: for security reasons, *only* use placeholders to pass values to a SQL statement.</span></span>

<span data-ttu-id="62cc3-269">Depois que o código usa `db.Execute` para executar a instrução `Update`, ele redireciona de volta para a página de listagem, onde você pode ver as alterações.</span><span class="sxs-lookup"><span data-stu-id="62cc3-269">After the code uses `db.Execute` to run the `Update` statement, it redirects back to the listing page, where you can see the changes.</span></span>

> [!TIP] 
> 
> <span data-ttu-id="62cc3-270">**Diferentes instruções SQL, métodos diferentes**</span><span class="sxs-lookup"><span data-stu-id="62cc3-270">**Different SQL Statements, Different Methods**</span></span>
> 
> <span data-ttu-id="62cc3-271">Você pode ter notado que usa métodos ligeiramente diferentes para executar instruções SQL diferentes.</span><span class="sxs-lookup"><span data-stu-id="62cc3-271">You might have noticed that you use slightly different methods to run different SQL statements.</span></span> <span data-ttu-id="62cc3-272">Para executar uma consulta `Select` que potencialmente retorna vários registros, use o método `Query`.</span><span class="sxs-lookup"><span data-stu-id="62cc3-272">To run a `Select` query that potentially returns multiple records, you use the `Query` method.</span></span> <span data-ttu-id="62cc3-273">Para executar uma consulta `Select` que você sabe que retornará apenas um item de banco de dados, use o método `QuerySingle`.</span><span class="sxs-lookup"><span data-stu-id="62cc3-273">To run a `Select` query that you know will return only one database item, you use the `QuerySingle` method.</span></span> <span data-ttu-id="62cc3-274">Para executar comandos que fazem alterações, mas que não retornam itens de banco de dados, você usa o método `Execute`.</span><span class="sxs-lookup"><span data-stu-id="62cc3-274">To run commands that make changes but that don't return database items, you use the `Execute` method.</span></span>
> 
> <span data-ttu-id="62cc3-275">Você precisa ter métodos diferentes porque cada um deles retorna resultados diferentes, como você já viu na diferença entre `Query` e `QuerySingle`.</span><span class="sxs-lookup"><span data-stu-id="62cc3-275">You have to have different methods because each of them returns different results, as you saw already in the difference between `Query` and `QuerySingle`.</span></span> <span data-ttu-id="62cc3-276">(O método `Execute`, na verdade, retorna um valor, também &mdash; ou seja, o número de linhas de banco de dados que foram afetadas pelo comando &mdash;, mas que você ignorou até agora.)</span><span class="sxs-lookup"><span data-stu-id="62cc3-276">(The `Execute` method actually returns a value also &mdash; namely, the number of database rows that were affected by the command &mdash; but you've been ignoring that so far.)</span></span>
> 
> <span data-ttu-id="62cc3-277">É claro que o método `Query` pode retornar apenas uma linha de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="62cc3-277">Of course, the `Query` method might return only one database row.</span></span> <span data-ttu-id="62cc3-278">No entanto, ASP.NET sempre trata os resultados do método `Query` como uma coleção.</span><span class="sxs-lookup"><span data-stu-id="62cc3-278">However, ASP.NET always treats the results of the `Query` method as a collection.</span></span> <span data-ttu-id="62cc3-279">Mesmo que o método retorne apenas uma linha, você precisa extrair essa única linha da coleção.</span><span class="sxs-lookup"><span data-stu-id="62cc3-279">Even if the method returns just one row, you have to extract that single row from the collection.</span></span> <span data-ttu-id="62cc3-280">Portanto, em situações em que você *sabe* que obterá apenas uma linha, é um pouco mais conveniente usar `QuerySingle`.</span><span class="sxs-lookup"><span data-stu-id="62cc3-280">Therefore, in situations where you *know* you'll get back only one row, it's a bit more convenient to use `QuerySingle`.</span></span>
> 
> <span data-ttu-id="62cc3-281">Há alguns outros métodos que executam tipos específicos de operações de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="62cc3-281">There are a few other methods that perform specific types of database operations.</span></span> <span data-ttu-id="62cc3-282">Você pode encontrar uma lista de métodos de banco de dados na [referência rápida da API de páginas da Web do ASP.net](../../api-reference/asp-net-web-pages-api-reference.md#Data).</span><span class="sxs-lookup"><span data-stu-id="62cc3-282">You can find a listing of database methods in the [ASP.NET Web Pages API Quick Reference](../../api-reference/asp-net-web-pages-api-reference.md#Data).</span></span>

## <a name="making-validation-for-the-id-more-robust"></a><span data-ttu-id="62cc3-283">Tornando a validação para a ID mais robusta</span><span class="sxs-lookup"><span data-stu-id="62cc3-283">Making Validation for the ID More Robust</span></span>

<span data-ttu-id="62cc3-284">Na primeira vez em que a página é executada, você obtém a ID do filme da cadeia de caracteres de consulta para que possa obter o filme do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="62cc3-284">The first time that the page runs, you get the movie ID from the query string so that you can go get that movie from the database.</span></span> <span data-ttu-id="62cc3-285">Você se certifica de que realmente houvesse um valor para procurar, o que fazia usando este código:</span><span class="sxs-lookup"><span data-stu-id="62cc3-285">You made sure that there actually was a value to go look for, which you did by using this code:</span></span>

[!code-csharp[Main](updating-data/samples/sample13.cs)]

<span data-ttu-id="62cc3-286">Você usou esse código para garantir que, se um usuário chegar à página *EditMovies* sem primeiro selecionar um filme na página *filmes* , a página exibirá uma mensagem de erro amigável.</span><span class="sxs-lookup"><span data-stu-id="62cc3-286">You used this code to make sure that if a user gets to the *EditMovies* page without first selecting a movie in the *Movies* page, the page would display a user-friendly error message.</span></span> <span data-ttu-id="62cc3-287">(Caso contrário, os usuários veriam um erro que provavelmente apenas os confundem.)</span><span class="sxs-lookup"><span data-stu-id="62cc3-287">(Otherwise, users would see an error that would probably just confuse them.)</span></span>

<span data-ttu-id="62cc3-288">No entanto, essa validação não é muito robusta.</span><span class="sxs-lookup"><span data-stu-id="62cc3-288">However, this validation isn't very robust.</span></span> <span data-ttu-id="62cc3-289">A página também pode ser chamada com estes erros:</span><span class="sxs-lookup"><span data-stu-id="62cc3-289">The page might also be invoked with these errors:</span></span>

- <span data-ttu-id="62cc3-290">A ID não é um número.</span><span class="sxs-lookup"><span data-stu-id="62cc3-290">The ID isn't a number.</span></span> <span data-ttu-id="62cc3-291">Por exemplo, a página pode ser chamada com uma URL como `http://localhost:nnnnn/EditMovie?id=abc`.</span><span class="sxs-lookup"><span data-stu-id="62cc3-291">For example, the page could be invoked with a URL like `http://localhost:nnnnn/EditMovie?id=abc`.</span></span>
- <span data-ttu-id="62cc3-292">A ID é um número, mas faz referência a um filme que não existe (por exemplo, `http://localhost:nnnnn/EditMovie?id=100934`).</span><span class="sxs-lookup"><span data-stu-id="62cc3-292">The ID is a number, but it references a movie that doesn't exist (for example, `http://localhost:nnnnn/EditMovie?id=100934`).</span></span>

<span data-ttu-id="62cc3-293">Se você estiver curioso para ver os erros que resultam dessas URLs, execute a página *filmes* .</span><span class="sxs-lookup"><span data-stu-id="62cc3-293">If you're curious to see the errors that result from these URLs, run the *Movies* page.</span></span> <span data-ttu-id="62cc3-294">Selecione um filme para editar e, em seguida, altere a URL da página *EditMovie* para uma URL que contenha uma ID alfabética ou a ID de um filme não existente.</span><span class="sxs-lookup"><span data-stu-id="62cc3-294">Select a movie to edit, and then change the URL of the *EditMovie* page to a URL that contains an alphabetic ID or the ID of a non-existent movie.</span></span>

<span data-ttu-id="62cc3-295">Então, o que você deve fazer?</span><span class="sxs-lookup"><span data-stu-id="62cc3-295">So what should you do?</span></span> <span data-ttu-id="62cc3-296">A primeira correção é garantir que não apenas uma ID seja passada para a página, mas que a ID seja um número inteiro.</span><span class="sxs-lookup"><span data-stu-id="62cc3-296">The first fix is to make sure that not only is an ID passed to the page, but that the ID is an integer.</span></span> <span data-ttu-id="62cc3-297">Altere o código para o teste de `!IsPost` para que se pareça com este exemplo:</span><span class="sxs-lookup"><span data-stu-id="62cc3-297">Change the code for the `!IsPost` test to look like this example:</span></span>

[!code-csharp[Main](updating-data/samples/sample14.cs)]

<span data-ttu-id="62cc3-298">Você adicionou uma segunda condição ao teste de `IsEmpty`, vinculado com `&&` (AND lógico):</span><span class="sxs-lookup"><span data-stu-id="62cc3-298">You've added a second condition to the `IsEmpty` test, linked with `&&` (logical AND):</span></span>

[!code-csharp[Main](updating-data/samples/sample15.cs)]

<span data-ttu-id="62cc3-299">Você pode se lembrar do tutorial [introdução ao páginas da Web do ASP.net de programação](../introducing-razor-syntax-c.md) que métodos como `AsBool` um `AsInt` converter uma cadeia de caracteres em algum outro tipo de dados.</span><span class="sxs-lookup"><span data-stu-id="62cc3-299">You might remember from the [Introduction to ASP.NET Web Pages Programming](../introducing-razor-syntax-c.md) tutorial that methods like `AsBool` an `AsInt` convert a character string to some other data type.</span></span> <span data-ttu-id="62cc3-300">O método `IsInt` (e outros, como `IsBool` e `IsDateTime`) são semelhantes.</span><span class="sxs-lookup"><span data-stu-id="62cc3-300">The `IsInt` method (and others, like `IsBool` and `IsDateTime`) are similar.</span></span> <span data-ttu-id="62cc3-301">No entanto, eles são testados apenas se você *pode* converter a cadeia de caracteres, sem realmente executar a conversão.</span><span class="sxs-lookup"><span data-stu-id="62cc3-301">However, they test only whether you *can* convert the string, without actually performing the conversion.</span></span> <span data-ttu-id="62cc3-302">Aqui, você está basicamente dizendo *se o valor da cadeia de caracteres de consulta pode ser convertido em um inteiro...* .</span><span class="sxs-lookup"><span data-stu-id="62cc3-302">So here you're essentially saying *If the query string value can be converted to an integer ...*.</span></span>

<span data-ttu-id="62cc3-303">O outro problema potencial é a procura por um filme que não existe.</span><span class="sxs-lookup"><span data-stu-id="62cc3-303">The other potential problem is looking for a movie that doesn't exist.</span></span> <span data-ttu-id="62cc3-304">O código para obter um filme é semelhante a este código:</span><span class="sxs-lookup"><span data-stu-id="62cc3-304">The code to get a movie looks like this code:</span></span>

[!code-csharp[Main](updating-data/samples/sample16.cs)]

<span data-ttu-id="62cc3-305">Se você passar um valor de `movieId` para o método `QuerySingle` que não corresponde a um filme real, nada será retornado e as instruções a seguir (por exemplo, `title=row.Title`) resultarão em erros.</span><span class="sxs-lookup"><span data-stu-id="62cc3-305">If you pass a `movieId` value to the `QuerySingle` method that doesn't correspond to an actual movie, nothing is returned and the statements that follow (for example, `title=row.Title`) result in errors.</span></span>

<span data-ttu-id="62cc3-306">Mais uma vez, há uma correção fácil.</span><span class="sxs-lookup"><span data-stu-id="62cc3-306">Again there's an easy fix.</span></span> <span data-ttu-id="62cc3-307">Se o método `db.QuerySingle` não retornar nenhum resultado, a variável `row` será nula.</span><span class="sxs-lookup"><span data-stu-id="62cc3-307">If the `db.QuerySingle` method returns no results, the `row` variable will be null.</span></span> <span data-ttu-id="62cc3-308">Portanto, você pode verificar se a variável de `row` é nula antes de tentar obter valores dela.</span><span class="sxs-lookup"><span data-stu-id="62cc3-308">So you can check whether the `row` variable is null before you try to get values from it.</span></span> <span data-ttu-id="62cc3-309">O código a seguir adiciona um bloco de `if` em volta das instruções que obtêm os valores do objeto `row`:</span><span class="sxs-lookup"><span data-stu-id="62cc3-309">The following code adds an `if` block around the statements that get the values out of the `row` object:</span></span>

[!code-csharp[Main](updating-data/samples/sample17.cs)]

<span data-ttu-id="62cc3-310">Com esses dois testes de validação adicionais, a página se torna mais à prova de marcadores.</span><span class="sxs-lookup"><span data-stu-id="62cc3-310">With these two additional validation tests, the page becomes more bullet-proof.</span></span> <span data-ttu-id="62cc3-311">O código completo para a ramificação `!IsPost` agora se parece com este exemplo:</span><span class="sxs-lookup"><span data-stu-id="62cc3-311">The complete code for the `!IsPost` branch now looks like this example:</span></span>

[!code-csharp[Main](updating-data/samples/sample18.cs)]

<span data-ttu-id="62cc3-312">Notaremos mais uma vez mais que essa tarefa é um bom uso para um bloco de `else`.</span><span class="sxs-lookup"><span data-stu-id="62cc3-312">We'll note once more that this task is a good use for an `else` block.</span></span> <span data-ttu-id="62cc3-313">Se os testes não passarem, os blocos de `else` definirão mensagens de erro.</span><span class="sxs-lookup"><span data-stu-id="62cc3-313">If the tests don't pass, the `else` blocks set error messages.</span></span>

## <a name="adding-a-link-to-return-to-the-movies-page"></a><span data-ttu-id="62cc3-314">Adicionando um link para retornar à página de filmes</span><span class="sxs-lookup"><span data-stu-id="62cc3-314">Adding a Link to Return to the Movies Page</span></span>

<span data-ttu-id="62cc3-315">Um detalhe final e útil é adicionar um link de volta à página de *filmes* .</span><span class="sxs-lookup"><span data-stu-id="62cc3-315">A final and helpful detail is to add a link back to the *Movies* page.</span></span> <span data-ttu-id="62cc3-316">No fluxo de eventos comum, os usuários começarão na página *filmes* e clicarão em um link de **edição** .</span><span class="sxs-lookup"><span data-stu-id="62cc3-316">In the ordinary flow of events, users will start at the *Movies* page and click an **Edit** link.</span></span> <span data-ttu-id="62cc3-317">Isso os leva para a página *EditMovie* , na qual eles podem editar o filme e clicar no botão.</span><span class="sxs-lookup"><span data-stu-id="62cc3-317">That brings them to the *EditMovie* page, where they can edit the movie and click the button.</span></span> <span data-ttu-id="62cc3-318">Depois que o código processa a alteração, ele redireciona de volta para a página de *filmes* .</span><span class="sxs-lookup"><span data-stu-id="62cc3-318">After the code processes the change, it redirects back to the *Movies* page.</span></span>

<span data-ttu-id="62cc3-319">Porém:</span><span class="sxs-lookup"><span data-stu-id="62cc3-319">However:</span></span>

- <span data-ttu-id="62cc3-320">O usuário pode decidir não alterar nada.</span><span class="sxs-lookup"><span data-stu-id="62cc3-320">The user might decide not to change anything.</span></span>
- <span data-ttu-id="62cc3-321">O usuário pode ter chegado a esta página sem primeiro clicar em um link de **edição** na página *filmes* .</span><span class="sxs-lookup"><span data-stu-id="62cc3-321">The user might have gotten to this page without first clicking an **Edit** link in the *Movies* page.</span></span>

<span data-ttu-id="62cc3-322">De qualquer forma, você deseja facilitar para que eles retornem à listagem principal.</span><span class="sxs-lookup"><span data-stu-id="62cc3-322">Either way, you want to make it easy for them to return to the main listing.</span></span> <span data-ttu-id="62cc3-323">É uma correção fácil &mdash; adicionar a marcação a seguir logo após a marcação de `</form>` de fechamento na marcação:</span><span class="sxs-lookup"><span data-stu-id="62cc3-323">It's an easy fix &mdash; add the following markup just after the closing `</form>` tag in the markup:</span></span>

[!code-html[Main](updating-data/samples/sample19.html)]

<span data-ttu-id="62cc3-324">Essa marcação usa a mesma sintaxe para um elemento `<a>` que você viu em outro lugar.</span><span class="sxs-lookup"><span data-stu-id="62cc3-324">This markup uses the same syntax for an `<a>` element that you've seen elsewhere.</span></span> <span data-ttu-id="62cc3-325">A URL inclui `~` para significar "raiz do site".</span><span class="sxs-lookup"><span data-stu-id="62cc3-325">The URL includes `~` to mean "root of the website."</span></span>

## <a name="testing-the-movie-update-process"></a><span data-ttu-id="62cc3-326">Testando o processo de atualização do filme</span><span class="sxs-lookup"><span data-stu-id="62cc3-326">Testing the Movie Update Process</span></span>

<span data-ttu-id="62cc3-327">Agora você pode testar.</span><span class="sxs-lookup"><span data-stu-id="62cc3-327">Now you can test.</span></span> <span data-ttu-id="62cc3-328">Execute a página *filmes* e clique em **Editar** ao lado de um filme.</span><span class="sxs-lookup"><span data-stu-id="62cc3-328">Run the *Movies* page, and click **Edit** next to a movie.</span></span> <span data-ttu-id="62cc3-329">Quando a página *EditMovie* for exibida, faça alterações no filme e clique em **enviar alterações**.</span><span class="sxs-lookup"><span data-stu-id="62cc3-329">When the *EditMovie* page appears, make changes to the movie and click **Submit Changes**.</span></span> <span data-ttu-id="62cc3-330">Quando a listagem de filmes for exibida, verifique se as alterações são mostradas.</span><span class="sxs-lookup"><span data-stu-id="62cc3-330">When the movie listing appears, make sure that your changes are shown.</span></span>

<span data-ttu-id="62cc3-331">Para verificar se a validação está funcionando, clique em **Editar** para outro filme.</span><span class="sxs-lookup"><span data-stu-id="62cc3-331">To make sure that validation is working, click **Edit** for another movie.</span></span> <span data-ttu-id="62cc3-332">Quando chegar à página *EditMovie* , desmarque o campo **gênero** (ou o campo **year** ou ambos) e tente enviar suas alterações.</span><span class="sxs-lookup"><span data-stu-id="62cc3-332">When you get to the *EditMovie* page, clear the **Genre** field (or **Year** field, or both) and try to submit your changes.</span></span> <span data-ttu-id="62cc3-333">Você verá um erro, como você esperaria:</span><span class="sxs-lookup"><span data-stu-id="62cc3-333">You'll see an error, as you'd expect:</span></span>

![Editar página de filme mostrando erros de validação](updating-data/_static/image4.png)

<span data-ttu-id="62cc3-335">Clique no link **retornar ao filme de listagem** para abandonar as alterações e retornar à página *filmes* .</span><span class="sxs-lookup"><span data-stu-id="62cc3-335">Click the **Return to movie listing** link to abandon your changes and return to the *Movies* page.</span></span>

## <a name="coming-up-next"></a><span data-ttu-id="62cc3-336">Chegando em seguida</span><span class="sxs-lookup"><span data-stu-id="62cc3-336">Coming Up Next</span></span>

<span data-ttu-id="62cc3-337">No próximo tutorial, você verá como excluir um registro de filme.</span><span class="sxs-lookup"><span data-stu-id="62cc3-337">In the next tutorial, you'll see how to delete a movie record.</span></span>

## <a name="complete-listing-for-movie-page-updated-with-edit-links"></a><span data-ttu-id="62cc3-338">Listagem completa da página de filme (atualizada com links de edição)</span><span class="sxs-lookup"><span data-stu-id="62cc3-338">Complete Listing for Movie Page (Updated with Edit Links)</span></span>

[!code-cshtml[Main](updating-data/samples/sample20.cshtml)]

<a id="Complete_Page_Listing_for_EditMovie"></a>
## <a name="complete-page-listing-for-edit-movie-page"></a><span data-ttu-id="62cc3-339">Lista completa de páginas para editar filme</span><span class="sxs-lookup"><span data-stu-id="62cc3-339">Complete Page Listing for Edit Movie Page</span></span>

[!code-cshtml[Main](updating-data/samples/sample21.cshtml)]

## <a name="additional-resources"></a><span data-ttu-id="62cc3-340">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="62cc3-340">Additional Resources</span></span>

- [<span data-ttu-id="62cc3-341">Introdução à programação da Web do ASP.NET usando a sintaxe do Razor</span><span class="sxs-lookup"><span data-stu-id="62cc3-341">Introduction to ASP.NET Web Programming by Using the Razor Syntax</span></span>](../../getting-started/introducing-razor-syntax-c.md)
- <span data-ttu-id="62cc3-342">[Instrução SQL update](http://www.w3schools.com/sql/sql_update.asp) no site W3Schools</span><span class="sxs-lookup"><span data-stu-id="62cc3-342">[SQL UPDATE Statement](http://www.w3schools.com/sql/sql_update.asp) on the W3Schools site</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="62cc3-343">[Anterior](entering-data.md)
> [Próximo](deleting-data.md)</span><span class="sxs-lookup"><span data-stu-id="62cc3-343">[Previous](entering-data.md)
[Next](deleting-data.md)</span></span>
