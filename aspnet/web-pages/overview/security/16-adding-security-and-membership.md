---
uid: web-pages/overview/security/16-adding-security-and-membership
title: Adicionando segurança e associação a um site Páginas da Web do ASP.NET (Razor) | Microsoft Docs
author: Rick-Anderson
description: Este capítulo mostra como proteger seu site para que algumas das páginas estejam disponíveis apenas para as pessoas que fazem logon. (Você também verá como criar páginas tha...
ms.author: riande
ms.date: 02/24/2014
ms.assetid: 7a77c2c0-deea-4290-a9c3-97958891758e
msc.legacyurl: /web-pages/overview/security/16-adding-security-and-membership
msc.type: authoredcontent
ms.openlocfilehash: 0be3e767a42939a3c343f6d4a730eb1d9a6b367c
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78628383"
---
# <a name="adding-security-and-membership-to-an-aspnet-web-pages-razor-site"></a><span data-ttu-id="fbe0a-104">Adicionando segurança e associação a um site Páginas da Web do ASP.NET (Razor)</span><span class="sxs-lookup"><span data-stu-id="fbe0a-104">Adding Security and Membership to an ASP.NET Web Pages (Razor) Site</span></span>

<span data-ttu-id="fbe0a-105">por [Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="fbe0a-105">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="fbe0a-106">Este artigo explica como proteger um site Páginas da Web do ASP.NET (Razor) para que algumas das páginas estejam disponíveis apenas para as pessoas que fazem logon.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-106">This article explains how to secure an ASP.NET Web Pages (Razor) website so that some of the pages are available only to people who log in.</span></span> <span data-ttu-id="fbe0a-107">(Você também verá como criar páginas que qualquer pessoa pode acessar.)</span><span class="sxs-lookup"><span data-stu-id="fbe0a-107">(You'll also see how to create pages that anyone can access.)</span></span>
> 
> <span data-ttu-id="fbe0a-108">**O que você aprenderá:**</span><span class="sxs-lookup"><span data-stu-id="fbe0a-108">**What you'll learn:**</span></span> 
> 
> - <span data-ttu-id="fbe0a-109">Como criar um site que tenha uma página de registro e uma página de logon para que, para algumas páginas, você possa limitar o acesso somente a membros.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-109">How to create a website that has a registration page and a login page so that for some pages you can limit access to only members.</span></span>
> - <span data-ttu-id="fbe0a-110">Como criar páginas públicas e somente para membros.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-110">How to create public and member-only pages.</span></span>
> - <span data-ttu-id="fbe0a-111">Como definir funções, que são grupos que têm permissões de segurança diferentes em seu site e como atribuir usuários a uma função.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-111">How to define roles, which are groups that have different security permissions on your site, and how to assign users to a role.</span></span>
> - <span data-ttu-id="fbe0a-112">Como usar o CAPTCHA para impedir que os bots (programas automatizados) criem contas de membros.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-112">How to use CAPTCHA to prevent automated programs (bots) from creating member accounts.</span></span>
>   
> 
> <span data-ttu-id="fbe0a-113">Estes são os recursos do ASP.NET apresentados no artigo:</span><span class="sxs-lookup"><span data-stu-id="fbe0a-113">These are the ASP.NET features introduced in the article:</span></span>
> 
> - <span data-ttu-id="fbe0a-114">O modelo de **site inicial** do WebMatrix.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-114">The WebMatrix **Starter Site** template.</span></span>
> - <span data-ttu-id="fbe0a-115">O auxiliar de `WebSecurity` e a classe `Roles`.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-115">The `WebSecurity` helper and `Roles` class.</span></span>
> - <span data-ttu-id="fbe0a-116">O auxiliar de `ReCaptcha`.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-116">The `ReCaptcha` helper.</span></span>
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a><span data-ttu-id="fbe0a-117">Versões de software usadas no tutorial</span><span class="sxs-lookup"><span data-stu-id="fbe0a-117">Software versions used in the tutorial</span></span>
> 
> 
> - <span data-ttu-id="fbe0a-118">Páginas da Web do ASP.NET (Razor) 2</span><span class="sxs-lookup"><span data-stu-id="fbe0a-118">ASP.NET Web Pages (Razor) 2</span></span>
> - <span data-ttu-id="fbe0a-119">WebMatrix 3</span><span class="sxs-lookup"><span data-stu-id="fbe0a-119">WebMatrix 3</span></span>
> - <span data-ttu-id="fbe0a-120">Biblioteca de auxiliares Web do ASP.NET</span><span class="sxs-lookup"><span data-stu-id="fbe0a-120">ASP.NET Web Helpers Library</span></span>

<span data-ttu-id="fbe0a-121">Você pode configurar seu site para que os usuários possam fazer logon nele &#8212; , para que o site ofereça suporte à *Associação*.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-121">You can set up your website so that users can log into it &#8212; that is, so that the site supports *membership*.</span></span> <span data-ttu-id="fbe0a-122">Isso pode ser útil por vários motivos.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-122">This can be useful for many reasons.</span></span> <span data-ttu-id="fbe0a-123">Por exemplo, seu site pode ter páginas que devem estar disponíveis somente para membros.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-123">For example, your site might have pages that should be available only to members.</span></span> <span data-ttu-id="fbe0a-124">Em alguns casos, você pode exigir que os usuários façam logon para enviar comentários ou deixar um comentário.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-124">In some cases, you might require users to log in in order to send you feedback or leave a comment.</span></span>

<span data-ttu-id="fbe0a-125">Mesmo que seu site dê suporte à associação, os usuários não precisam fazer logon antes de usarem algumas das páginas no site.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-125">Even if your website supports membership, users aren't necessarily required to log in before they use some of the pages on the site.</span></span> <span data-ttu-id="fbe0a-126">Os usuários que não estão conectados são conhecidos como *usuários anônimos*.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-126">Users who aren't logged in are known as *anonymous users*.</span></span>

<span data-ttu-id="fbe0a-127">Um usuário pode se registrar em seu site e, em seguida, pode fazer logon no site.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-127">A user can register on your website and can then log in to the site.</span></span> <span data-ttu-id="fbe0a-128">O site requer um nome de usuário (um endereço de email) e uma senha para confirmar se os usuários são aqueles que afirmam ser.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-128">The website requires a user name (an email address) and a password to confirm that users are who they claim to be.</span></span> <span data-ttu-id="fbe0a-129">Esse processo de fazer logon e confirmar a identidade de um usuário é conhecido como *autenticação*.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-129">This process of logging in and confirming a user's identity is known as *authentication*.</span></span>

<span data-ttu-id="fbe0a-130">Você pode configurar a segurança e a associação de maneiras diferentes:</span><span class="sxs-lookup"><span data-stu-id="fbe0a-130">You can set up security and membership in different ways:</span></span>

- <span data-ttu-id="fbe0a-131">Se você estiver usando o WebMatrix, uma maneira fácil é criar como um novo site com base no modelo de **site inicial** .</span><span class="sxs-lookup"><span data-stu-id="fbe0a-131">If you're using WebMatrix, an easy way is to create as new site based on the **Starter Site** template.</span></span> <span data-ttu-id="fbe0a-132">Este modelo já está configurado para segurança e associação e já tem uma página de registro, uma página de logon e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-132">This template is already configured for security and membership and already has a registration page, a login page, and so on.</span></span>

    <span data-ttu-id="fbe0a-133">O site criado pelo modelo também tem uma opção para permitir que os usuários façam logon usando um site externo, como Facebook, Google ou Twitter.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-133">The site created by the template also has an option to let users log in using an external site like Facebook, Google, or Twitter.</span></span>
- <span data-ttu-id="fbe0a-134">Se você quiser adicionar segurança a um site existente ou se não quiser usar o modelo de **site inicial** , poderá criar sua própria página de registro, página de logon e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-134">If you want to add security to an existing site, or if you don't want to use the **Starter Site** template, you can create your own registration page, login page, and so on.</span></span>

<span data-ttu-id="fbe0a-135">Este artigo se concentra na primeira opção &mdash; como adicionar segurança usando o modelo de **site inicial** .</span><span class="sxs-lookup"><span data-stu-id="fbe0a-135">This article focuses on the first option &mdash; how to add security by using the **Starter Site** template.</span></span> <span data-ttu-id="fbe0a-136">Ele também fornece algumas informações básicas sobre como implementar sua própria segurança e fornece links para mais informações sobre como fazer isso.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-136">It also provides some basic information about how to implement your own security and then provides links to more information about how to do that.</span></span> <span data-ttu-id="fbe0a-137">Também há informações sobre como habilitar logons externos, que são descritos com mais detalhes em um artigo separado.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-137">There is also information about how to enable external logins, which is described in more detail in a separate article.</span></span>

## <a name="creating-website-security-using-the-starter-site-template"></a><span data-ttu-id="fbe0a-138">Criando a segurança do site usando o modelo de site inicial</span><span class="sxs-lookup"><span data-stu-id="fbe0a-138">Creating Website Security Using the Starter Site Template</span></span>

<span data-ttu-id="fbe0a-139">No WebMatrix, você pode usar o modelo de **site inicial** para criar um site que contenha o seguinte:</span><span class="sxs-lookup"><span data-stu-id="fbe0a-139">In WebMatrix, you can use the **Starter Site** template to create a website that contains the following:</span></span>

- <span data-ttu-id="fbe0a-140">Um banco de dados que é usado para armazenar nomes de usuário e senhas para seus membros.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-140">A database that's used to store user names and passwords for your members.</span></span>
- <span data-ttu-id="fbe0a-141">Uma página de registro onde os usuários anônimos (novos) podem se registrar.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-141">A registration page where anonymous (new) users can register.</span></span>
- <span data-ttu-id="fbe0a-142">Uma página de logon e logout.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-142">A login and logout page.</span></span>
- <span data-ttu-id="fbe0a-143">Uma página de recuperação e redefinição de senha.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-143">A password recovery and reset page.</span></span>

<span data-ttu-id="fbe0a-144">O procedimento a seguir descreve como criar o site e configurá-lo.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-144">The following procedure describes how to create the site and configure it.</span></span>

1. <span data-ttu-id="fbe0a-145">Inicie o WebMatrix e, na página **início rápido** , selecione **site do modelo**.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-145">Start WebMatrix and in the **Quick Start** page, select **Site From Template**.</span></span>
2. <span data-ttu-id="fbe0a-146">Selecione o modelo de **site inicial** e clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-146">Select the **Starter Site** template and then click **OK**.</span></span> <span data-ttu-id="fbe0a-147">O WebMatrix cria um novo site.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-147">WebMatrix creates a new site.</span></span>
3. <span data-ttu-id="fbe0a-148">No painel esquerdo, clique no seletor de espaço de trabalho **arquivos** .</span><span class="sxs-lookup"><span data-stu-id="fbe0a-148">In the left pane, click the **Files** workspace selector.</span></span>
4. <span data-ttu-id="fbe0a-149">Na pasta raiz do seu site, abra o arquivo *\_AppStart. cshtml* , que é um arquivo especial que é usado para conter configurações globais.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-149">In the root folder of your website, open the *\_AppStart.cshtml* file, which is a special file that's used to contain global settings.</span></span> <span data-ttu-id="fbe0a-150">Ele contém algumas instruções que são comentadas usando os caracteres `//`:</span><span class="sxs-lookup"><span data-stu-id="fbe0a-150">It contains some statements that are commented out using the `//` characters:</span></span>

    [!code-csharp[Main](16-adding-security-and-membership/samples/sample1.cs)]

    <span data-ttu-id="fbe0a-151">Essas instruções configuram o auxiliar de `WebMail`, que pode ser usado para enviar email.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-151">These statements configure the `WebMail` helper, which can be used to send email.</span></span> <span data-ttu-id="fbe0a-152">O sistema de associação pode usar o email para enviar mensagens de confirmação quando os usuários se registram ou quando desejam alterar suas senhas.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-152">The membership system can use email to send confirmation messages when users register or when they want to change their passwords.</span></span> <span data-ttu-id="fbe0a-153">(Por exemplo, depois que os usuários se registram, eles recebem um email que inclui um link no qual eles podem clicar para concluir o processo de registro.)</span><span class="sxs-lookup"><span data-stu-id="fbe0a-153">(For example, after users register, they get an email that includes a link that they can click in order to finish the registration process.)</span></span>

    <span data-ttu-id="fbe0a-154">O envio de email requer acesso a um servidor SMTP, conforme descrito em [adicionando email a um Site páginas da Web do ASP.net](https://go.microsoft.com/fwlink/?LinkId=202899).</span><span class="sxs-lookup"><span data-stu-id="fbe0a-154">Sending email requires access to an SMTP server, as described in [Adding Email to an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=202899).</span></span> <span data-ttu-id="fbe0a-155">Você armazenará as configurações de email nessa central *\_arquivo AppStart. cshtml* para que você não precise codifique-los repetidamente em cada página que possa enviar emails.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-155">You'll store the email settings in this central *\_AppStart.cshtml* file so that you don't have to code them repeatedly into each page that can send email.</span></span> <span data-ttu-id="fbe0a-156">(Você não precisa definir as configurações de SMTP para configurar um banco de dados de registro; você só precisará de configurações de SMTP se quiser validar os usuários de seu alias de email e permitir que os usuários redefinam uma senha esquecida.)</span><span class="sxs-lookup"><span data-stu-id="fbe0a-156">(You don't need to configure SMTP settings to set up a registration database; you only need SMTP settings if you want to validate users from their email alias and let users reset a forgotten password.)</span></span>
5. <span data-ttu-id="fbe0a-157">Remova os comentários das instruções removendo `//` de na frente de cada uma delas.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-157">Uncomment the statements by removing `//` from in front of each one.</span></span>

    <span data-ttu-id="fbe0a-158">Se você não quiser configurar a confirmação de email, poderá ignorar esta etapa e a próxima etapa.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-158">If you do not want to set up email confirmation, you can skip this step and the next step.</span></span> <span data-ttu-id="fbe0a-159">Se os valores SMTP não estiverem definidos, a nova conta estará imediatamente disponível sem um email de confirmação.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-159">If the SMTP values are not set, the new account is immediately available without a confirmation email.</span></span>
6. <span data-ttu-id="fbe0a-160">Modifique as seguintes configurações relacionadas a email no código:</span><span class="sxs-lookup"><span data-stu-id="fbe0a-160">Modify the following email-related settings in the code:</span></span>

   - <span data-ttu-id="fbe0a-161">Defina `WebMail.SmtpServer` como o nome do servidor SMTP ao qual você tem acesso.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-161">Set `WebMail.SmtpServer` to the name of the SMTP server that you have access to.</span></span>
   - <span data-ttu-id="fbe0a-162">Deixe `WebMail.EnableSsl` definido como `true`.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-162">Leave `WebMail.EnableSsl` set to `true`.</span></span> <span data-ttu-id="fbe0a-163">Essa configuração protege as credenciais que são enviadas ao servidor SMTP criptografando-as.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-163">This setting secures the credentials that are sent to the SMTP server by encrypting them.</span></span>
   - <span data-ttu-id="fbe0a-164">Defina `WebMail.UserName` como o nome de usuário da sua conta do servidor SMTP.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-164">Set `WebMail.UserName` to the user name for your SMTP server account.</span></span>
   - <span data-ttu-id="fbe0a-165">Defina `WebMail.Password` para a senha da sua conta do servidor SMTP.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-165">Set `WebMail.Password` to the password for your SMTP server account.</span></span>
   - <span data-ttu-id="fbe0a-166">Defina `WebMail.From` para seu próprio endereço de email.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-166">Set `WebMail.From` to your own email address.</span></span> <span data-ttu-id="fbe0a-167">Esse é o endereço de email do qual a mensagem é enviada.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-167">This is the email address that the message is sent from.</span></span>

     > [!NOTE] 
     > 
     > <span data-ttu-id="fbe0a-168">**Dica** Para obter informações adicionais sobre os valores para essas propriedades, consulte [definindo configurações de email](https://go.microsoft.com/fwlink/?LinkID=202906#configuring_email_settings) em [Personalizando o comportamento de todo o site para páginas da Web do ASP.net](https://go.microsoft.com/fwlink/?LinkID=202906).</span><span class="sxs-lookup"><span data-stu-id="fbe0a-168">**Tip** For additional information about the values for these properties, see [Configuring Email Settings](https://go.microsoft.com/fwlink/?LinkID=202906#configuring_email_settings) in [Customizing Site-Wide Behavior for ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkID=202906).</span></span>
7. <span data-ttu-id="fbe0a-169">Salve e feche *\_AppStart. cshtml*.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-169">Save and close *\_AppStart.cshtml*.</span></span>
8. <span data-ttu-id="fbe0a-170">Execute a página *Default. cshtml* em um navegador.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-170">Run the *Default.cshtml* page in a browser.</span></span>

    ![segurança-Associação-2](16-adding-security-and-membership/_static/image1.png)

   > [!NOTE]
   > <span data-ttu-id="fbe0a-172">Se você vir um erro que informa que uma propriedade deve ser uma instância de `ExtendedMembershipProvider`, o site pode não estar configurado para usar o sistema de associação de Páginas da Web do ASP.NET (SimpleMembership).</span><span class="sxs-lookup"><span data-stu-id="fbe0a-172">If you see an error that tells you that a property must be an instance of `ExtendedMembershipProvider`, the site might not be configured to use the ASP.NET Web Pages membership system (SimpleMembership).</span></span> <span data-ttu-id="fbe0a-173">Às vezes, isso pode ocorrer se o servidor de um provedor de hospedagem estiver configurado de forma diferente do servidor local.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-173">This can sometimes occur if a hosting provider's server is configured differently than your local server.</span></span> <span data-ttu-id="fbe0a-174">Para corrigir isso, adicione o seguinte elemento ao arquivo *Web. config* do site:</span><span class="sxs-lookup"><span data-stu-id="fbe0a-174">To fix this, add the following element to the site's *Web.config* file:</span></span>
   > 
   > [!code-xml[Main](16-adding-security-and-membership/samples/sample2.xml)]
   > 
   > <span data-ttu-id="fbe0a-175">Adicione esse elemento como um filho do elemento `<configuration>` e como um par do elemento `<system.web>`.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-175">Add this element as a child of the `<configuration>` element and as a peer of the `<system.web>` element.</span></span>
9. <span data-ttu-id="fbe0a-176">No canto superior direito da página, clique no link **registrar** .</span><span class="sxs-lookup"><span data-stu-id="fbe0a-176">In the upper-right corner of the page, click the **Register** link.</span></span> <span data-ttu-id="fbe0a-177">A página *Register. cshtml* é exibida.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-177">The *Register.cshtml* page is displayed.</span></span>
10. <span data-ttu-id="fbe0a-178">Insira um nome de usuário e uma senha e, em seguida, clique em **registrar**.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-178">Enter a user name and password and then click **Register**.</span></span>

    ![segurança-Associação-3](16-adding-security-and-membership/_static/image2.png)

    <span data-ttu-id="fbe0a-180">Quando você criou o site do modelo de **site inicial** , um banco de dados chamado *StarterSite. sdf* foi criado na pasta de *dados do aplicativo\_* do site.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-180">When you created the website from the **Starter Site** template, a database named *StarterSite.sdf* was created in the site's *App\_Data* folder.</span></span> <span data-ttu-id="fbe0a-181">Durante o registro, as informações do usuário são adicionadas ao banco de dados.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-181">During registration, your user information is added to the database.</span></span> <span data-ttu-id="fbe0a-182">Se você definir os valores SMTP, uma mensagem será enviada para o endereço de email usado para que você possa concluir o registro.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-182">If you set the SMTP values, a message is sent to the email address you used so you can finish registering.</span></span>

    ![segurança-Associação-4](16-adding-security-and-membership/_static/image3.png)
11. <span data-ttu-id="fbe0a-184">Acesse seu programa de email e localize a mensagem, que terá seu código de confirmação e um hiperlink para o site.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-184">Go to your email program and find the message, which will have your confirmation code and a hyperlink to the site.</span></span>
12. <span data-ttu-id="fbe0a-185">Clique no hiperlink para ativar sua conta.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-185">Click the hyperlink to activate your account.</span></span> <span data-ttu-id="fbe0a-186">O hiperlink de confirmação abre uma página de confirmação de registro.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-186">The confirmation hyperlink opens a registration confirmation page.</span></span>

    ![segurança-Associação-5](16-adding-security-and-membership/_static/image4.png)
13. <span data-ttu-id="fbe0a-188">Clique no link **logon** e faça logon usando a conta que você registrou.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-188">Click the **Login** link, and then log in using the account that you registered.</span></span>

      <span data-ttu-id="fbe0a-189">Depois de fazer logon, os links de **logon** e de **registro** são substituídos por um link de **logoff** .</span><span class="sxs-lookup"><span data-stu-id="fbe0a-189">After you log in, the **Login** and **Register** links are replaced by a **Logout** link.</span></span> <span data-ttu-id="fbe0a-190">Seu nome de logon é exibido como um link.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-190">Your login name is displayed as a link.</span></span> <span data-ttu-id="fbe0a-191">(O link permite que você vá para uma página onde você pode alterar sua senha.)</span><span class="sxs-lookup"><span data-stu-id="fbe0a-191">(The link lets you go to a page where you can change your password.)</span></span>

      ![segurança-Associação-6](16-adding-security-and-membership/_static/image5.png)

      > [!NOTE]
      > <span data-ttu-id="fbe0a-193">Por padrão, as páginas da Web do ASP.NET enviam credenciais para o servidor em texto não criptografado (como texto legível).</span><span class="sxs-lookup"><span data-stu-id="fbe0a-193">By default, ASP.NET web pages send credentials to the server in clear text (as human-readable text).</span></span> <span data-ttu-id="fbe0a-194">Um site de produção deve usar HTTP seguro (https://, também conhecido como *SSL)* para criptografar informações confidenciais que são trocadas com o servidor.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-194">A production site should use secure HTTP (https://, also known as the *secure sockets layer* or SSL) to encrypt sensitive information that's exchanged with the server.</span></span> <span data-ttu-id="fbe0a-195">Você pode exigir que as mensagens de email sejam enviadas usando SSL, definindo `WebMail.EnableSsl=true` como no exemplo anterior.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-195">You can required email messages to be sent using SSL by setting `WebMail.EnableSsl=true` as in the previous example.</span></span> <span data-ttu-id="fbe0a-196">Para obter mais informações sobre SSL, consulte [Securing Web Communications: Certificates, SSL e https://](https://go.microsoft.com/fwlink/?LinkId=208660).</span><span class="sxs-lookup"><span data-stu-id="fbe0a-196">For more information about SSL, see [Securing Web Communications: Certificates, SSL, and https://](https://go.microsoft.com/fwlink/?LinkId=208660).</span></span>

## <a name="additional-membership-functionality-in-the-site"></a><span data-ttu-id="fbe0a-197">Funcionalidade de associação adicional no site</span><span class="sxs-lookup"><span data-stu-id="fbe0a-197">Additional Membership Functionality in the Site</span></span>

<span data-ttu-id="fbe0a-198">Seu site contém outras funcionalidades que permitem que os usuários gerenciem suas contas.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-198">Your site contains other functionality that lets users manage their accounts.</span></span> <span data-ttu-id="fbe0a-199">Os usuários podem fazer o seguinte:</span><span class="sxs-lookup"><span data-stu-id="fbe0a-199">Users can do the following:</span></span>

- <span data-ttu-id="fbe0a-200">Altere suas senhas.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-200">Change their passwords.</span></span> <span data-ttu-id="fbe0a-201">Depois de fazer logon, eles podem clicar no nome de usuário (que é um link).</span><span class="sxs-lookup"><span data-stu-id="fbe0a-201">After logging in, they can click the user name (which is a link).</span></span> <span data-ttu-id="fbe0a-202">Isso leva para uma página em que é possível criar uma nova senha (*Account/ChangePassword. cshtml*).</span><span class="sxs-lookup"><span data-stu-id="fbe0a-202">This takes them to a page where they can create a new password (*Account/ChangePassword.cshtml*).</span></span>
- <span data-ttu-id="fbe0a-203">Recuperar uma senha esquecida.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-203">Recover a forgotten password.</span></span> <span data-ttu-id="fbe0a-204">Na página de logon, há um link (**você esqueceu sua senha?** ) que leva os usuários para uma página (*Account/ForgotPassword. cshtml*), em que eles podem inserir um endereço de email.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-204">On the login page, there's a link (**Did you forget your password?**) that takes users to a page (*Account/ForgotPassword.cshtml*) where they can enter an email address.</span></span> <span data-ttu-id="fbe0a-205">O site envia a eles uma mensagem de email com um link no qual eles podem clicar para definir uma nova senha (*Account/PasswordReset. cshtml*).</span><span class="sxs-lookup"><span data-stu-id="fbe0a-205">The site sends them an email message that has a link that they can click in order to set a new password (*Account/PasswordReset.cshtml*).</span></span>

<span data-ttu-id="fbe0a-206">Você também pode permitir que os usuários também possam fazer logon usando um site externo, conforme explicado posteriormente.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-206">You can also let users can also log in using an external site, as explained later.</span></span>

<a id="Creating_a_Members-Only_Page"></a>
## <a name="creating-a-members-only-page"></a><span data-ttu-id="fbe0a-207">Criando uma página somente de membros</span><span class="sxs-lookup"><span data-stu-id="fbe0a-207">Creating a Members-Only Page</span></span>

<span data-ttu-id="fbe0a-208">Por enquanto, qualquer pessoa pode navegar para qualquer página no seu site.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-208">For the time being, anyone can browse to any page in your website.</span></span> <span data-ttu-id="fbe0a-209">Mas talvez você queira ter páginas que estão disponíveis apenas para pessoas que fizeram logon (ou seja, membros).</span><span class="sxs-lookup"><span data-stu-id="fbe0a-209">But you might want to have pages that are available only to people who have logged in (that is, to members).</span></span> <span data-ttu-id="fbe0a-210">O ASP.NET permite que você crie páginas que podem ser acessadas somente por membros conectados.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-210">ASP.NET lets you create pages that can be accessed only by logged-in members.</span></span> <span data-ttu-id="fbe0a-211">Normalmente, se os usuários anônimos tentarem acessar uma página somente de membros, você os redirecionará para a página de logon.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-211">Typically, if anonymous users try to access a members-only page, you redirect them to the login page.</span></span>

<span data-ttu-id="fbe0a-212">Neste procedimento, você criará uma pasta que conterá páginas que estão disponíveis somente para usuários conectados.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-212">In this procedure, you'll create a folder that will contain pages that are available only to logged-in users.</span></span>

1. <span data-ttu-id="fbe0a-213">Na raiz do site, crie uma nova pasta.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-213">At the root of the site, create a new folder.</span></span> <span data-ttu-id="fbe0a-214">(Na faixa de faixas, clique na seta abaixo de **novo** e escolha **nova pasta**.)</span><span class="sxs-lookup"><span data-stu-id="fbe0a-214">(In the ribbon, click the arrow underneath **New** and then choose **New Folder**.)</span></span>
2. <span data-ttu-id="fbe0a-215">Nomeie os novos *Membros*da pasta.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-215">Name the new folder *Members*.</span></span>
3. <span data-ttu-id="fbe0a-216">Dentro da pasta *Membros* , crie uma nova página e a denominada *MembersInformation. cshtml*.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-216">Inside the *Members* folder, create a new page and named it *MembersInformation.cshtml*.</span></span>
4. <span data-ttu-id="fbe0a-217">Substitua o conteúdo existente pelo seguinte código e marcação:</span><span class="sxs-lookup"><span data-stu-id="fbe0a-217">Replace the existing content with the following code and markup:</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample3.cshtml)]

    <span data-ttu-id="fbe0a-218">Esse código testa a propriedade `IsAuthenticated` do objeto `WebSecurity`, que retorna `true` se o usuário fez logon.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-218">This code tests the `IsAuthenticated` property of the `WebSecurity` object, which returns `true` if the user has logged in.</span></span> <span data-ttu-id="fbe0a-219">Se o usuário não estiver conectado, o código chamará `Response.Redirect` para enviar o usuário para a página *login. cshtml* na pasta *Account* .</span><span class="sxs-lookup"><span data-stu-id="fbe0a-219">If the user is not logged in, the code calls `Response.Redirect` to send the user to the *Login.cshtml* page in the *Account* folder.</span></span>

    <span data-ttu-id="fbe0a-220">A URL do redirecionamento inclui um `returnUrl` valor de cadeia de caracteres de consulta que usa `Request.Url.LocalPath` para definir o caminho da página atual.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-220">The URL of the redirection includes a `returnUrl` query string value that uses `Request.Url.LocalPath` to set the path of the current page.</span></span> <span data-ttu-id="fbe0a-221">Se você definir o valor de `returnUrl` na cadeia de caracteres de consulta como esta (e se a URL de retorno for um caminho local), a página de logon retornará os usuários para esta página depois que fizerem logon.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-221">If you set the `returnUrl` value in the query string like this (and if the return URL is a local path), the login page will return users to this page after they log in.</span></span>

    <span data-ttu-id="fbe0a-222">O código também define *\_página SiteLayout. cshtml* como sua página de layout.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-222">The code also sets *\_SiteLayout.cshtml* page as its layout page.</span></span> <span data-ttu-id="fbe0a-223">(Para obter mais informações sobre páginas de layout, consulte [criando um layout consistente em Sites páginas da Web do ASP.net](https://go.microsoft.com/fwlink/?LinkId=202891).)</span><span class="sxs-lookup"><span data-stu-id="fbe0a-223">(For more about layout pages, see [Creating a Consistent Layout in ASP.NET Web Pages Sites](https://go.microsoft.com/fwlink/?LinkId=202891).)</span></span>
5. <span data-ttu-id="fbe0a-224">Execute o site.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-224">Run the site.</span></span> <span data-ttu-id="fbe0a-225">Se você ainda estiver conectado, clique no botão **logout** na parte superior da página.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-225">If you're still logged in, click the **Logout** button at the top of the page.</span></span>
6. <span data-ttu-id="fbe0a-226">No navegador, solicite a página */Members/MembersInformation*.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-226">In the browser, request the page */Members/MembersInformation*.</span></span> <span data-ttu-id="fbe0a-227">Por exemplo, a URL pode ter a seguinte aparência:</span><span class="sxs-lookup"><span data-stu-id="fbe0a-227">For example, the URL might look like this:</span></span>

    `http://localhost:38366/Members/MembersInformation`

    <span data-ttu-id="fbe0a-228">(O número da porta (38366) provavelmente será diferente em sua URL.)</span><span class="sxs-lookup"><span data-stu-id="fbe0a-228">(The port number (38366) will probably be different in your URL.)</span></span>

    <span data-ttu-id="fbe0a-229">Você será redirecionado para a página *login. cshtml* , porque não está conectado.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-229">You're redirected to the *Login.cshtml* page, because you aren't logged in.</span></span>
7. <span data-ttu-id="fbe0a-230">Faça logon usando a conta que você criou anteriormente.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-230">Log in using the account you created earlier.</span></span> <span data-ttu-id="fbe0a-231">Você será Redirecionado de volta para a página *MembersInformation* .</span><span class="sxs-lookup"><span data-stu-id="fbe0a-231">You're redirected back to the *MembersInformation* page.</span></span> <span data-ttu-id="fbe0a-232">Como você está conectado, desta vez você verá o conteúdo da página.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-232">Because you're logged in, this time you see the page contents.</span></span>

<span data-ttu-id="fbe0a-233">Para proteger o acesso a várias páginas, você pode fazer isso:</span><span class="sxs-lookup"><span data-stu-id="fbe0a-233">To secure access to multiple pages, you can do this:</span></span>

- <span data-ttu-id="fbe0a-234">Adicione a verificação de segurança a cada página.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-234">Add the security check to each page.</span></span>
- <span data-ttu-id="fbe0a-235">Crie uma página *\_PageStart. cshtml* na pasta onde você mantém as páginas protegidas e adicione a verificação de segurança lá.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-235">Create a *\_PageStart.cshtml* page in the folder where you keep protected pages, and add the security check there.</span></span> <span data-ttu-id="fbe0a-236">A página *\_PageStart. cshtml* atua como um tipo de página global para todas as páginas na pasta.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-236">The *\_PageStart.cshtml* page acts as a kind of global page for all the pages in the folder.</span></span> <span data-ttu-id="fbe0a-237">Essa técnica é explicada em mais detalhes na [personalização do comportamento de todo o site para páginas da Web do ASP.net](https://go.microsoft.com/fwlink/?LinkId=202906#Using__PageStart.cshtml_to_Restrict_Folder_Access).</span><span class="sxs-lookup"><span data-stu-id="fbe0a-237">This technique is explained in more detail in [Customizing Site-Wide Behavior for ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkId=202906#Using__PageStart.cshtml_to_Restrict_Folder_Access).</span></span>

## <a name="creating-security-for-groups-of-users-roles"></a><span data-ttu-id="fbe0a-238">Criando segurança para grupos de usuários (funções)</span><span class="sxs-lookup"><span data-stu-id="fbe0a-238">Creating Security for Groups of Users (Roles)</span></span>

<span data-ttu-id="fbe0a-239">Se seu site tiver muitos membros, não será eficiente verificar a permissão para cada usuário individualmente antes de deixá-los ver uma página.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-239">If your site has a lot of members, it's not efficient to check permission for each user individually before you let them see a page.</span></span> <span data-ttu-id="fbe0a-240">O que você pode fazer em vez disso é criar grupos ou *funções*aos quais os membros individuais pertencem.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-240">What you can do instead is to create groups, or *roles*, that individual members belong to.</span></span> <span data-ttu-id="fbe0a-241">Em seguida, você pode verificar as permissões com base na função.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-241">You can then check permissions based on role.</span></span> <span data-ttu-id="fbe0a-242">Nesta seção, você criará uma função de&quot; &quot;admin e, em seguida, criará uma página acessível aos usuários que estão no (que pertencem a) essa função.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-242">In this section, you'll create an &quot;admin&quot; role and then create a page that's accessible to users who are in (who belong to) that role.</span></span>

<span data-ttu-id="fbe0a-243">O sistema de associação do ASP.NET é configurado para dar suporte a funções.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-243">The ASP.NET membership system is set up to support roles.</span></span> <span data-ttu-id="fbe0a-244">No entanto, ao contrário do registro de associação e do logon, o modelo de **site inicial** não contém páginas que ajudam a gerenciar funções.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-244">However, unlike membership registration and login, the **Starter Site** template does not contain pages that help you manage roles.</span></span> <span data-ttu-id="fbe0a-245">(O gerenciamento de funções é uma tarefa administrativa em vez de uma tarefa de usuário.) No entanto, você pode adicionar grupos diretamente no banco de dados de associação no WebMatrix.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-245">(Managing roles is an administrative task rather than a user task.) However, you can add groups directly in the membership database in WebMatrix.</span></span>

1. <span data-ttu-id="fbe0a-246">No WebMatrix, clique no seletor espaço de trabalho **bancos de dados** .</span><span class="sxs-lookup"><span data-stu-id="fbe0a-246">In WebMatrix, click the **Databases** workspace selector.</span></span>
2. <span data-ttu-id="fbe0a-247">No painel esquerdo, abra o nó *StarterSite. sdf* , abra o nó **tabelas** e clique duas vezes na tabela de *funções\_de páginas da Web* .</span><span class="sxs-lookup"><span data-stu-id="fbe0a-247">In the left pane, open the *StarterSite.sdf* node, open the **Tables** node, and then double-click the *webpages\_Roles* table.</span></span>

    ![segurança-Associação-7](16-adding-security-and-membership/_static/image6.png)
3. <span data-ttu-id="fbe0a-249">Adicione uma função chamada&quot;do &quot;admin.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-249">Add a role named &quot;admin&quot;.</span></span> <span data-ttu-id="fbe0a-250">O campo *RoleID* é preenchido automaticamente.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-250">The *RoleId* field is filled in automatically.</span></span> <span data-ttu-id="fbe0a-251">(É a chave primária e foi definido para ser um campo de identificação, conforme explicado em [introdução ao trabalho com um banco de dados em Sites páginas da Web do ASP.net](https://go.microsoft.com/fwlink/?LinkId=202893).)</span><span class="sxs-lookup"><span data-stu-id="fbe0a-251">(It's the primary key and has been set to be an identify field, as explained in [Introduction to Working with a Database in ASP.NET Web Pages Sites](https://go.microsoft.com/fwlink/?LinkId=202893).)</span></span>
4. <span data-ttu-id="fbe0a-252">Anote o que é o valor para o campo *RoleID* .</span><span class="sxs-lookup"><span data-stu-id="fbe0a-252">Take note of what the value is for the *RoleId* field.</span></span> <span data-ttu-id="fbe0a-253">(Se esta for a primeira função que você está definindo, será 1.)</span><span class="sxs-lookup"><span data-stu-id="fbe0a-253">(If this is the first role you're defining, it will be 1.)</span></span>

    ![segurança-Associação-8](16-adding-security-and-membership/_static/image7.png)
5. <span data-ttu-id="fbe0a-255">Feche a tabela de *funções de\_de páginas da Web* .</span><span class="sxs-lookup"><span data-stu-id="fbe0a-255">Close the *webpages\_Roles* table.</span></span>
6. <span data-ttu-id="fbe0a-256">Abra a tabela *USERPROFILE* .</span><span class="sxs-lookup"><span data-stu-id="fbe0a-256">Open the *UserProfile* table.</span></span>
7. <span data-ttu-id="fbe0a-257">Anote o valor de *userid* de um ou mais dos usuários na tabela e, em seguida, feche a tabela.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-257">Make a note of the *UserId* value of one or more of the users in the table and then close the table.</span></span>
8. <span data-ttu-id="fbe0a-258">Abra as *páginas da web\_tabela UserInRoles* e insira um *userid* e um valor *RoleID* na tabela.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-258">Open the *webpages\_UserInRoles* table and enter a *UserID* and a *RoleID* value into the table.</span></span> <span data-ttu-id="fbe0a-259">Por exemplo, para colocar o usuário 2 na função de&quot; &quot;admin, você deve inserir esses valores:</span><span class="sxs-lookup"><span data-stu-id="fbe0a-259">For example, to put user 2 into the &quot;admin&quot; role, you'd enter these values:</span></span>

    ![segurança-Associação-9](16-adding-security-and-membership/_static/image8.png)
9. <span data-ttu-id="fbe0a-261">Feche as *páginas da web\_tabela UsersInRoles* .</span><span class="sxs-lookup"><span data-stu-id="fbe0a-261">Close the *webpages\_UsersInRoles* table.</span></span>

    <span data-ttu-id="fbe0a-262">Agora que você tem funções definidas, é possível configurar uma página que seja acessível aos usuários que estão nessa função.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-262">Now that you have roles defined, you can configure a page that's accessible to users who are in that role.</span></span>
10. <span data-ttu-id="fbe0a-263">Na pasta raiz do site, crie uma nova página chamada *AdminError. cshtml* e substitua o conteúdo existente pelo código a seguir.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-263">In the website root folder, create a new page named *AdminError.cshtml* and replace the existing content with the following code.</span></span> <span data-ttu-id="fbe0a-264">Essa será a página para a qual os usuários serão redirecionados se não tiverem permissão de acesso a uma página.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-264">This will be the page that users are redirected to if they aren't allowed access to a page.</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample4.cshtml)]
11. <span data-ttu-id="fbe0a-265">Na pasta raiz do site, crie uma nova página chamada *AdminOnly. cshtml* e substitua o código existente pelo código a seguir:</span><span class="sxs-lookup"><span data-stu-id="fbe0a-265">In the website root folder, create a new page named *AdminOnly.cshtml* and replace the existing code with the following code:</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample5.cshtml)]

    <span data-ttu-id="fbe0a-266">O método `Roles.IsUserInRole` retorna `true` se o usuário atual for membro da função especificada (nesse caso, a função "admin").</span><span class="sxs-lookup"><span data-stu-id="fbe0a-266">The `Roles.IsUserInRole` method returns `true` if the current user is a member of the specified role (in this case, the "admin" role).</span></span>
12. <span data-ttu-id="fbe0a-267">Execute *Default. cshtml* em um navegador, mas não faça logon.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-267">Run *Default.cshtml* in a browser, but don't log in.</span></span> <span data-ttu-id="fbe0a-268">(Se você já estiver conectado, faça logoff.)</span><span class="sxs-lookup"><span data-stu-id="fbe0a-268">(If you're already logged in, log out.)</span></span>
13. <span data-ttu-id="fbe0a-269">Na barra de endereços do navegador, adicione *AdminOnly* na URL.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-269">In the browser's address bar, add *AdminOnly* in the URL.</span></span> <span data-ttu-id="fbe0a-270">(Em outras palavras, solicite o arquivo *AdminOnly. cshtml* .) Você será redirecionado para a página *AdminError. cshtml* , porque você não está conectado atualmente como um usuário na função de&quot; administrador do &quot;.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-270">(In other words, request the *AdminOnly.cshtml* file.) You're redirected to the *AdminError.cshtml* page, because you aren't currently logged in as a user in the &quot;admin&quot; role.</span></span>
14. <span data-ttu-id="fbe0a-271">Retorne para *Default. cshtml* e faça logon como o usuário que você adicionou à função de&quot; admin do &quot;.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-271">Return to *Default.cshtml* and log in as the user you added to the &quot;admin&quot; role.</span></span>
15. <span data-ttu-id="fbe0a-272">Navegue até a página *AdminOnly. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="fbe0a-272">Browse to *AdminOnly.cshtml* page.</span></span> <span data-ttu-id="fbe0a-273">Desta vez, você verá a página.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-273">This time you see the page.</span></span>

## <a name="preventing-automated-programs-from-joining-your-website"></a><span data-ttu-id="fbe0a-274">Impedir que programas automatizados ingressem no seu site</span><span class="sxs-lookup"><span data-stu-id="fbe0a-274">Preventing Automated Programs from Joining Your Website</span></span>

<span data-ttu-id="fbe0a-275">A página de logon não irá parar os programas automatizados (às vezes chamados de *robôs da Web* ou *bots*) de se registrarem no site.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-275">The login page will not stop automated programs (sometimes referred to as *web robots* or *bots*) from registering with your website.</span></span> <span data-ttu-id="fbe0a-276">Este procedimento descreve como habilitar um teste do ReCaptcha para a página de registro.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-276">This procedure describes how to enable a ReCaptcha test for the registration page.</span></span>

![/media/38777/ch16securitymembership-18.jpg](16-adding-security-and-membership/_static/image1.jpg)

1. <span data-ttu-id="fbe0a-278">Registre seu site em ReCaptcha.Net ([http://recaptcha.net](http://recaptcha.net)).</span><span class="sxs-lookup"><span data-stu-id="fbe0a-278">Register your website at ReCaptcha.Net ([http://recaptcha.net](http://recaptcha.net)).</span></span> <span data-ttu-id="fbe0a-279">Quando você concluir o registro, obterá uma chave pública e uma chave privada.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-279">When you've completed registration, you'll get a public key and a private key.</span></span>
2. <span data-ttu-id="fbe0a-280">Adicione a biblioteca de auxiliares Web do ASP.NET ao seu site, conforme descrito em [instalando auxiliares em um páginas da Web do ASP.net site](https://go.microsoft.com/fwlink/?LinkId=252372), se ainda não tiver feito isso.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-280">Add the ASP.NET Web Helpers Library to your website as described in [Installing Helpers in an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=252372), if you haven't already.</span></span>
3. <span data-ttu-id="fbe0a-281">Na pasta *conta* , abra o arquivo chamado *Register. cshtml*.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-281">In the *Account* folder, open the file named *Register.cshtml*.</span></span>
4. <span data-ttu-id="fbe0a-282">No código na parte superior da página, localize as linhas a seguir e remova os comentários removendo o `//` caracteres de comentário:</span><span class="sxs-lookup"><span data-stu-id="fbe0a-282">In the code at the top of the page, find the following lines and uncomment them by removing the `//` comment characters:</span></span>

    [!code-csharp[Main](16-adding-security-and-membership/samples/sample6.cs)]
5. <span data-ttu-id="fbe0a-283">Substitua `PRIVATE_KEY` pela sua própria chave privada ReCaptcha.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-283">Replace `PRIVATE_KEY` with your own ReCaptcha private key.</span></span>
6. <span data-ttu-id="fbe0a-284">Na marcação da página, remova as `@*` e `*@` comentários de comentário das linhas a seguir na marcação de página:</span><span class="sxs-lookup"><span data-stu-id="fbe0a-284">In the markup of the page, remove the `@*` and `*@` commenting characters from around the following lines in the page markup:</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample7.cshtml)]
7. <span data-ttu-id="fbe0a-285">Substitua `PUBLIC_KEY` pela sua chave.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-285">Replace `PUBLIC_KEY` with your key.</span></span>
8. <span data-ttu-id="fbe0a-286">Se você ainda não o tiver removido, remova o elemento `<div>` que contém o texto que começa com "para habilitar a verificação de CAPTCHA...".</span><span class="sxs-lookup"><span data-stu-id="fbe0a-286">If you haven't removed it already, remove the `<div>` element that contains text that starts with "To enable CAPTCHA verification ...".</span></span> <span data-ttu-id="fbe0a-287">(Remova todo o elemento `<div>` e seu conteúdo.)</span><span class="sxs-lookup"><span data-stu-id="fbe0a-287">(Remove the entire `<div>` element and its contents.)</span></span>

9. <span data-ttu-id="fbe0a-288">Execute *Default. cshtml* em um navegador.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-288">Run *Default.cshtml* in a browser.</span></span> <span data-ttu-id="fbe0a-289">Se você estiver conectado ao site, clique no link **logout** .</span><span class="sxs-lookup"><span data-stu-id="fbe0a-289">If you're logged into the site, click the **Logout** link.</span></span>
10. <span data-ttu-id="fbe0a-290">Clique no link **registrar** e teste o registro usando o teste captcha.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-290">Click the **Register** link and test the registration using the CAPTCHA test.</span></span>

     ![segurança-Associação-10](16-adding-security-and-membership/_static/image9.png)

<span data-ttu-id="fbe0a-292">Para obter mais informações sobre o auxiliar de `ReCaptcha`, consulte [usando um CATPCHA para impedir que os bots (programas automatizados) usem seu site do ASP.net](https://go.microsoft.com/fwlink/?LinkId=251967).</span><span class="sxs-lookup"><span data-stu-id="fbe0a-292">For more information about the `ReCaptcha` helper, see [Using a CATPCHA to Prevent Automated Programs (Bots) from Using Your ASP.NET Web Site](https://go.microsoft.com/fwlink/?LinkId=251967).</span></span>

<a id="Additional_Resources"></a>
## <a name="letting-users-log-in-using-an-external-site"></a><span data-ttu-id="fbe0a-293">Permitindo que os usuários façam logon usando um site externo</span><span class="sxs-lookup"><span data-stu-id="fbe0a-293">Letting Users Log In Using an External Site</span></span>

<span data-ttu-id="fbe0a-294">O modelo de **site inicial** inclui código e marcação que permite que os usuários façam logon usando o Facebook, o Windows Live, o Twitter, o Google ou o Yahoo.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-294">The **Starter Site** template includes code and markup that lets users log in using Facebook, Windows Live, Twitter, Google, or Yahoo.</span></span> <span data-ttu-id="fbe0a-295">Por padrão, essa funcionalidade não está habilitada.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-295">By default, this functionality is not enabled.</span></span> <span data-ttu-id="fbe0a-296">O procedimento geral para usar permitir que os usuários façam logon usando esses provedores externos é o seguinte:</span><span class="sxs-lookup"><span data-stu-id="fbe0a-296">The general procedure for using letting users log in using these external providers is this:</span></span>

- <span data-ttu-id="fbe0a-297">Decida quais sites externos você deseja dar suporte.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-297">Decide which of the external sites you want to support.</span></span>
- <span data-ttu-id="fbe0a-298">Se necessário, vá para esse site e configure um aplicativo de logon.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-298">If required, go to that site and set up a login app.</span></span> <span data-ttu-id="fbe0a-299">(Por exemplo, você precisa fazer isso para permitir logons do Facebook.)</span><span class="sxs-lookup"><span data-stu-id="fbe0a-299">(For example, you have to do this in order to allow Facebook logins.)</span></span>
- <span data-ttu-id="fbe0a-300">Em seu site, configure o provedor.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-300">In your site, configure the provider.</span></span> <span data-ttu-id="fbe0a-301">Na maioria dos casos, basta remover o comentário de um código no arquivo *\_AppStart. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="fbe0a-301">In most cases, you just have to uncomment some code in the *\_AppStart.cshtml* file.</span></span>
- <span data-ttu-id="fbe0a-302">Adicione marcação à página de registro que permite que as pessoas vinculem o site externo para fazer logon.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-302">Add markup to the registration page that lets people link to the external site for logging in.</span></span> <span data-ttu-id="fbe0a-303">Normalmente, você pode copiar a marcação de que precisa e alterar o texto um pouco.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-303">You can usually copy the markup you need and change the text slightly.</span></span>

<span data-ttu-id="fbe0a-304">Você pode encontrar instruções passo a passo no tópico [habilitando o logon de sites externos em um páginas da Web do ASP.net site](https://go.microsoft.com/fwlink/?LinkId=251969).</span><span class="sxs-lookup"><span data-stu-id="fbe0a-304">You can find step-by-step instructions in the topic [Enabling Login from External Sites in an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=251969).</span></span>

<span data-ttu-id="fbe0a-305">Depois que um usuário faz logon de outro site, o usuário retorna ao seu site e *associa* esse logon ao seu site.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-305">After a user logs in from another site, the user returns to your site and *associates* that login with your site.</span></span> <span data-ttu-id="fbe0a-306">Em vigor, isso cria uma entrada de associação em seu site para o logon externo do usuário.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-306">In effect, this creates a membership entry in your site for the user's external login.</span></span> <span data-ttu-id="fbe0a-307">Isso permite que você use os recursos normais de associação (como funções) com o logon externo.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-307">This lets you use the normal facilities of membership (such as roles) with the external login.</span></span>

## <a name="adding-security-to-an-existing-website"></a><span data-ttu-id="fbe0a-308">Adicionando segurança a um site da Web existente</span><span class="sxs-lookup"><span data-stu-id="fbe0a-308">Adding Security to an Existing Website</span></span>

<span data-ttu-id="fbe0a-309">O procedimento anterior neste artigo depende do uso do modelo de **site inicial** como base para a segurança do site.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-309">The procedure earlier in this article relies on using the **Starter Site** template as the basis for website security.</span></span> <span data-ttu-id="fbe0a-310">Se não for prático iniciar a partir do modelo de **site inicial** ou copiar as páginas relevantes de um site com base nesse modelo, você poderá implementar o mesmo tipo de segurança em seu próprio site codificando-o por conta própria.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-310">If it isn't practical for you to start from the **Starter Site** template or to copy the relevant pages from a site based on that template, you can implement the same type of security in your own site by coding it yourself.</span></span> <span data-ttu-id="fbe0a-311">Você cria os mesmos tipos de páginas – registro, logon e assim por diante — e, em seguida, usa auxiliares e classes para configurar a associação.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-311">You create the same types of pages — registration, login, and so on — and then use helpers and classes to set up membership.</span></span>

<span data-ttu-id="fbe0a-312">O processo básico é descrito na postagem [do blog a maneira mais básica de implementar a segurança do ASP.net Razor](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240).</span><span class="sxs-lookup"><span data-stu-id="fbe0a-312">The basic process is described in the blog post [THE most basic way to implement ASP.NET Razor security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240).</span></span> <span data-ttu-id="fbe0a-313">A maior parte do trabalho é feita usando os seguintes métodos e propriedades do auxiliar de `WebSecurity`:</span><span class="sxs-lookup"><span data-stu-id="fbe0a-313">Most of the work is done using the following methods and properties of the `WebSecurity` helper:</span></span>

- <span data-ttu-id="fbe0a-314">[WebSecurty. Userexistent](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.userexists(v=vs.99).aspx), [websecurity. CreateUserAndAccount](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.createuserandaccount(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="fbe0a-314">[WebSecurty.UserExists](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.userexists(v=vs.99).aspx), [WebSecurity.CreateUserAndAccount](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.createuserandaccount(v=vs.99).aspx).</span></span> <span data-ttu-id="fbe0a-315">Esses métodos permitem determinar se alguém já está registrado e registrá-los.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-315">These methods let you determine whether someone is already registered and to register them.</span></span>
- <span data-ttu-id="fbe0a-316">[WebSecurty. IsAuthenticated](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.isauthenticated(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="fbe0a-316">[WebSecurty.IsAuthenticated](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.isauthenticated(v=vs.99).aspx).</span></span> <span data-ttu-id="fbe0a-317">Essa propriedade permite determinar se o usuário atual está conectado.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-317">This property lets you determine whether the current user is logged in.</span></span> <span data-ttu-id="fbe0a-318">Isso será útil para redirecionar os usuários para uma página de logon se eles ainda não tiverem feito logon.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-318">This is useful to redirect users to a login page if they have not already logged in.</span></span>
- <span data-ttu-id="fbe0a-319">[Websecurity. logon](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.login(v=vs.99).aspx), [websecurity. logout](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.logout(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="fbe0a-319">[WebSecurity.Login](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.login(v=vs.99).aspx), [WebSecurity.Logout](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.logout(v=vs.99).aspx).</span></span> <span data-ttu-id="fbe0a-320">Esses métodos fazem logon ou saída de um usuário.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-320">These methods log a user in or out.</span></span>
- <span data-ttu-id="fbe0a-321">[Websecurity. currentusername](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.currentusername(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="fbe0a-321">[WebSecurity.CurrentUserName](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.currentusername(v=vs.99).aspx).</span></span> <span data-ttu-id="fbe0a-322">Essa propriedade é útil para exibir o nome de logon do usuário atual (se o usuário estiver conectado).</span><span class="sxs-lookup"><span data-stu-id="fbe0a-322">This property is useful for displaying the current user's logged-in name (if the user is logged in).</span></span>
- <span data-ttu-id="fbe0a-323">[Websecurity. ConfirmAccount](https://msdn.microsoft.com/library/gg569286(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="fbe0a-323">[WebSecurity.ConfirmAccount](https://msdn.microsoft.com/library/gg569286(v=vs.99).aspx).</span></span> <span data-ttu-id="fbe0a-324">Esse método será útil se você configurar a confirmação de email para o registro.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-324">This method is useful if you set up email confirmation for registration.</span></span> <span data-ttu-id="fbe0a-325">(Os detalhes são descritos na postagem do blog [usando o recurso de confirmação para páginas da Web do ASP.net segurança](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267).)</span><span class="sxs-lookup"><span data-stu-id="fbe0a-325">(Details are described in the blog post [Using the confirmation feature for ASP.NET Web Pages security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267).)</span></span>

<span data-ttu-id="fbe0a-326">Para gerenciar funções, você pode usar as [funções](https://msdn.microsoft.com/library/gg538398(v=vs.99).aspx) e as classes de [Associação](https://msdn.microsoft.com/library/gg569035(v=vs.99).aspx) , conforme descrito na entrada do blog.</span><span class="sxs-lookup"><span data-stu-id="fbe0a-326">To manage roles, you can use the [Roles](https://msdn.microsoft.com/library/gg538398(v=vs.99).aspx) and [Membership](https://msdn.microsoft.com/library/gg569035(v=vs.99).aspx) classes, as described in the blog entry.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="fbe0a-327">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="fbe0a-327">Additional Resources</span></span>

- [<span data-ttu-id="fbe0a-328">Personalizar o comportamento de todo o site</span><span class="sxs-lookup"><span data-stu-id="fbe0a-328">Customizing Site-Wide Behavior</span></span>](https://go.microsoft.com/fwlink/?LinkId=202906)
- [<span data-ttu-id="fbe0a-329">Protegendo as comunicações da Web: certificados, SSL e https://</span><span class="sxs-lookup"><span data-stu-id="fbe0a-329">Securing Web Communications: Certificates, SSL, and https://</span></span>](https://go.microsoft.com/fwlink/?LinkId=208660)
- <span data-ttu-id="fbe0a-330">[A maneira mais básica de implementar a segurança do ASP.net Razor](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240) e [usar o recurso de confirmação para páginas da Web do ASP.net segurança](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267).</span><span class="sxs-lookup"><span data-stu-id="fbe0a-330">[THE most basic way to implement ASP.NET Razor security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240) and [Using the confirmation feature for ASP.NET Web Pages security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267).</span></span> <span data-ttu-id="fbe0a-331">Essas Postagens de blog descrevem como implementar recursos de associação do ASP.NET sem usar o modelo de **site inicial** .</span><span class="sxs-lookup"><span data-stu-id="fbe0a-331">These are blog posts that describe how to implement ASP.NET membership features without using the **Starter Site** template.</span></span>
- [<span data-ttu-id="fbe0a-332">Habilitar logon de sites externos em um site de Páginas da Web do ASP.NET</span><span class="sxs-lookup"><span data-stu-id="fbe0a-332">Enabling Login from External Sites in an ASP.NET Web Pages Site</span></span>](https://go.microsoft.com/fwlink/?LinkId=251969)
- <span data-ttu-id="fbe0a-333">[Referência de API de classe websecurity](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity(v=vs.99)) (MSDN)</span><span class="sxs-lookup"><span data-stu-id="fbe0a-333">[WebSecurity Class API reference](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity(v=vs.99)) (MSDN)</span></span>
- <span data-ttu-id="fbe0a-334">[Referência de API de classe SimpleRoleProvider](https://msdn.microsoft.com/library/webmatrix.webdata.simpleroleprovider(v=vs.99)) (MSDN)</span><span class="sxs-lookup"><span data-stu-id="fbe0a-334">[SimpleRoleProvider Class API reference](https://msdn.microsoft.com/library/webmatrix.webdata.simpleroleprovider(v=vs.99)) (MSDN)</span></span>
- <span data-ttu-id="fbe0a-335">[Referência de API de classe SimpleMembershipProvider](https://msdn.microsoft.com/library/webmatrix.webdata.simplemembershipprovider(v=vs.99)) (MSDN)</span><span class="sxs-lookup"><span data-stu-id="fbe0a-335">[SimpleMembershipProvider Class API reference](https://msdn.microsoft.com/library/webmatrix.webdata.simplemembershipprovider(v=vs.99)) (MSDN)</span></span>
