---
uid: whitepapers/add-mobile-pages-to-your-aspnet-web-forms-mvc-application
title: 'Como: adicionar páginas móveis ao seu aplicativo ASP.NET Web Forms/MVC | Microsoft Docs'
author: rick-anderson
description: Este "como" descreve várias maneiras de servir páginas otimizadas para dispositivos móveis do seu aplicativo ASP.NET Web Forms/MVC e sugere arquitetura e...
ms.author: riande
ms.date: 01/20/2011
ms.assetid: 3124f28e-cc32-418a-afe3-519fa56f4c36
msc.legacyurl: /whitepapers/add-mobile-pages-to-your-aspnet-web-forms-mvc-application
msc.type: content
ms.openlocfilehash: 63c555358d06a9506bb5c8c993800c3307108192
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78572733"
---
# <a name="how-to-add-mobile-pages-to-your-aspnet-web-forms--mvc-application"></a><span data-ttu-id="e9c70-103">Como: adicionar páginas móveis ao seu aplicativo ASP.NET Web Forms/MVC</span><span class="sxs-lookup"><span data-stu-id="e9c70-103">How To: Add Mobile Pages to Your ASP.NET Web Forms / MVC Application</span></span>

> <span data-ttu-id="e9c70-104">**Aplica-se a**</span><span class="sxs-lookup"><span data-stu-id="e9c70-104">**Applies To**</span></span>
> 
> - <span data-ttu-id="e9c70-105">ASP.NET Web Forms versão 4,0</span><span class="sxs-lookup"><span data-stu-id="e9c70-105">ASP.NET Web Forms version 4.0</span></span>
> - <span data-ttu-id="e9c70-106">ASP.NET MVC versão 3,0</span><span class="sxs-lookup"><span data-stu-id="e9c70-106">ASP.NET MVC version 3.0</span></span>
> 
> <span data-ttu-id="e9c70-107">**Resumo**</span><span class="sxs-lookup"><span data-stu-id="e9c70-107">**Summary**</span></span>
> 
> <span data-ttu-id="e9c70-108">Esse manual descreve várias maneiras para servir páginas otimizadas para dispositivos móveis do seu Web Forms do ASP.NET / aplicativo MVC e sugere problemas de design e arquitetônicos a serem considerados ao direcionar uma ampla gama de dispositivos.</span><span class="sxs-lookup"><span data-stu-id="e9c70-108">This How To describes various ways to serve pages optimized for mobile devices from your ASP.NET Web Forms / MVC application, and suggests architectural and design issues to consider when targeting a broad range of devices.</span></span> <span data-ttu-id="e9c70-109">Este documento também explica por que os controles móveis ASP.NET do ASP.NET 2,0 para 3,5 agora são obsoletos e discute algumas alternativas modernas.</span><span class="sxs-lookup"><span data-stu-id="e9c70-109">This document also explains why the ASP.NET Mobile Controls from ASP.NET 2.0 to 3.5 are now obsolete, and discusses some modern alternatives.</span></span>

## <a name="contents"></a><span data-ttu-id="e9c70-110">Conteúdo</span><span class="sxs-lookup"><span data-stu-id="e9c70-110">Contents</span></span>

- <span data-ttu-id="e9c70-111">Visão geral</span><span class="sxs-lookup"><span data-stu-id="e9c70-111">Overview</span></span>
- <span data-ttu-id="e9c70-112">Opções de arquitetura</span><span class="sxs-lookup"><span data-stu-id="e9c70-112">Architectural options</span></span>
- <span data-ttu-id="e9c70-113">Detecção de navegador e dispositivo</span><span class="sxs-lookup"><span data-stu-id="e9c70-113">Browser and device detection</span></span>
- <span data-ttu-id="e9c70-114">Como os aplicativos ASP.NET Web Forms podem apresentar páginas específicas para dispositivos móveis</span><span class="sxs-lookup"><span data-stu-id="e9c70-114">How ASP.NET Web Forms applications can present mobile-specific pages</span></span>
- <span data-ttu-id="e9c70-115">Como os aplicativos MVC ASP.NET podem apresentar páginas específicas para dispositivos móveis</span><span class="sxs-lookup"><span data-stu-id="e9c70-115">How ASP.NET MVC applications can present mobile-specific pages</span></span>
- <span data-ttu-id="e9c70-116">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="e9c70-116">Additional resources</span></span>

<span data-ttu-id="e9c70-117">Para obter exemplos de código para download que demonstram as técnicas deste white paper para ASP.NET Web Forms e MVC, consulte [aplicativos móveis & sites com o ASP.net](https://docs.microsoft.com/aspnet/mobile/overview).</span><span class="sxs-lookup"><span data-stu-id="e9c70-117">For downloadable code samples demonstrating this white paper's techniques for both ASP.NET Web Forms and MVC, see [Mobile Apps & Sites with ASP.NET](https://docs.microsoft.com/aspnet/mobile/overview).</span></span>

## <a name="overview"></a><span data-ttu-id="e9c70-118">Visão geral</span><span class="sxs-lookup"><span data-stu-id="e9c70-118">Overview</span></span>

<span data-ttu-id="e9c70-119">Dispositivos móveis – smartphones, telefones de recursos e tablets – continuam crescendo em popularidade como um meio de acessar a Web.</span><span class="sxs-lookup"><span data-stu-id="e9c70-119">Mobile devices – smartphones, feature phones, and tablets – continue to grow in popularity as a means to access the Web.</span></span> <span data-ttu-id="e9c70-120">Para muitos desenvolvedores da Web e empresas orientadas na Web, isso significa que é cada vez mais importante fornecer uma ótima experiência de navegação para os visitantes que usam esses dispositivos.</span><span class="sxs-lookup"><span data-stu-id="e9c70-120">For many web developers and web-oriented businesses, this means it's increasingly important to provide a great browsing experience for visitors using those devices.</span></span>

### <a name="how-earlier-versions-of-aspnet-supported-mobile-browsers"></a><span data-ttu-id="e9c70-121">Como as versões anteriores do ASP.NET oferecem suporte a navegadores móveis</span><span class="sxs-lookup"><span data-stu-id="e9c70-121">How earlier versions of ASP.NET supported mobile browsers</span></span>

<span data-ttu-id="e9c70-122">ASP.NET versões 2,0 a 3,5 *ASP.NET controles móveis*incluídos: um conjunto de controles de servidor para dispositivos móveis no assembly *System. Web. Mobile. dll* e no namespace *System. Web. UI. MobileControls* .</span><span class="sxs-lookup"><span data-stu-id="e9c70-122">ASP.NET versions 2.0 to 3.5 included *ASP.NET Mobile Controls*: a set of server controls for mobile devices in the *System.Web.Mobile.dll* assembly and the *System.Web.UI.MobileControls* namespace.</span></span> <span data-ttu-id="e9c70-123">O assembly ainda está incluído no ASP.NET 4, mas ele foi preterido.</span><span class="sxs-lookup"><span data-stu-id="e9c70-123">The assembly is still included in ASP.NET 4, but it is deprecated.</span></span> <span data-ttu-id="e9c70-124">Os desenvolvedores são aconselhados a migrar para abordagens mais modernas, como as descritas neste documento.</span><span class="sxs-lookup"><span data-stu-id="e9c70-124">Developers are advised to migrate to more modern approaches, such as those described in this paper.</span></span>

<span data-ttu-id="e9c70-125">O motivo pelo qual os controles móveis do ASP.NET foram marcados como obsoletos é que seu design é orientado em relação aos telefones celulares que eram comuns em relação ao 2005 e anterior.</span><span class="sxs-lookup"><span data-stu-id="e9c70-125">The reason why ASP.NET Mobile Controls have been marked as obsolete is that their design is oriented around the mobile phones that were common around 2005 and earlier.</span></span> <span data-ttu-id="e9c70-126">Os controles são projetados principalmente para processar a marcação WML ou cHTML (em vez de HTML normal) para os navegadores WAP dessa era.</span><span class="sxs-lookup"><span data-stu-id="e9c70-126">The controls are mainly designed to render WML or cHTML markup (instead of regular HTML) for the WAP browsers of that era.</span></span> <span data-ttu-id="e9c70-127">Mas WAP, WML e cHTML não são mais relevantes para a maioria dos projetos, porque o HTML agora se tornou a linguagem de marcação onipresente para navegadores móveis e de desktops.</span><span class="sxs-lookup"><span data-stu-id="e9c70-127">But WAP, WML, and cHTML are no longer relevant for most projects, because HTML has now become the ubiquitous markup language for mobile and desktop browsers alike.</span></span>

### <a name="the-challenges-of-supporting-mobile-devices-today"></a><span data-ttu-id="e9c70-128">Os desafios de dar suporte a dispositivos móveis hoje</span><span class="sxs-lookup"><span data-stu-id="e9c70-128">The challenges of supporting mobile devices today</span></span>

<span data-ttu-id="e9c70-129">Embora os navegadores móveis agora ofereçam suporte a HTML quase universalmente, você ainda enfrentará muitos desafios ao visar criar excelentes experiências de navegação móvel:</span><span class="sxs-lookup"><span data-stu-id="e9c70-129">Even though mobile browsers now almost universally support HTML, you will still face many challenges when aiming to create great mobile browsing experiences:</span></span>

- <span data-ttu-id="e9c70-130">***Tamanho da tela*** -os dispositivos móveis variam drasticamente no formulário e suas telas geralmente são muito menores do que os monitores da área de trabalho.</span><span class="sxs-lookup"><span data-stu-id="e9c70-130">***Screen size*** - Mobile devices vary dramatically in form, and their screens are often much smaller than desktop monitors.</span></span> <span data-ttu-id="e9c70-131">Portanto, talvez seja necessário criar layouts de página completamente diferentes para eles.</span><span class="sxs-lookup"><span data-stu-id="e9c70-131">So, you may need to design completely different page layouts for them.</span></span>
- <span data-ttu-id="e9c70-132">***Métodos de entrada*** – alguns dispositivos têm teclados, alguns têm styluses, outros usam toque.</span><span class="sxs-lookup"><span data-stu-id="e9c70-132">***Input methods*** – Some devices have keypads, some have styluses, others use touch.</span></span> <span data-ttu-id="e9c70-133">Talvez seja necessário considerar vários mecanismos de navegação e métodos de entrada de dados.</span><span class="sxs-lookup"><span data-stu-id="e9c70-133">You may need to consider multiple navigation mechanisms and data input methods.</span></span>
- <span data-ttu-id="e9c70-134">***Conformidade*** com os padrões – muitos navegadores móveis não dão suporte aos padrões mais recentes de HTML, CSS ou JavaScript.</span><span class="sxs-lookup"><span data-stu-id="e9c70-134">***Standards compliance*** – Many mobile browsers do not support the latest HTML, CSS, or JavaScript standards.</span></span>
- <span data-ttu-id="e9c70-135">***Largura de banda*** – o desempenho da rede de dados de celular varia e alguns usuários finais estão em tarifas que cobram por megabyte.</span><span class="sxs-lookup"><span data-stu-id="e9c70-135">***Bandwidth*** – Cellular data network performance varies wildly, and some end users are on tariffs that charge by the megabyte.</span></span>

<span data-ttu-id="e9c70-136">Não há nenhuma solução de tamanho único; seu aplicativo precisará parecer e se comportar de forma diferente, de acordo com o dispositivo que o acessa.</span><span class="sxs-lookup"><span data-stu-id="e9c70-136">There's no one-size-fits-all solution; your application will have to look and behave differently according to the device accessing it.</span></span> <span data-ttu-id="e9c70-137">Dependendo do nível de suporte móvel que você deseja, isso pode ser um desafio maior para desenvolvedores da Web do que a área de trabalho "conflitos de navegadores" já foi.</span><span class="sxs-lookup"><span data-stu-id="e9c70-137">Depending on what level of mobile support you want, this can be a bigger challenge for web developers than the desktop "browser wars" ever was.</span></span>

<span data-ttu-id="e9c70-138">Os desenvolvedores que estão se aproximando do suporte ao navegador móvel pela primeira vez costumam inicialmente considerar que é apenas importante dar suporte aos smartphones mais recentes e mais sofisticados (por exemplo, Windows Phone 7, iPhone ou Android), talvez porque os desenvolvedores geralmente pertencem a eles pseudodispositivos.</span><span class="sxs-lookup"><span data-stu-id="e9c70-138">Developers approaching mobile browser support for the first time often initially think it's only important to support the latest and most sophisticated smartphones (e.g., Windows Phone 7, iPhone, or Android), perhaps because developers often personally own such devices.</span></span> <span data-ttu-id="e9c70-139">No entanto, os telefones mais baratos ainda são extremamente populares e seus proprietários os usam para navegar na Web – especialmente em países em que os celulares são mais fáceis de obter do que uma conexão de banda larga.</span><span class="sxs-lookup"><span data-stu-id="e9c70-139">However, cheaper phones are still extremely popular, and their owners do use them to browse the web – especially in countries where mobile phones are easier to get than a broadband connection.</span></span> <span data-ttu-id="e9c70-140">Sua empresa precisará decidir qual intervalo de dispositivos oferecer suporte Considerando seus clientes prováveis.</span><span class="sxs-lookup"><span data-stu-id="e9c70-140">Your business will need to decide what range of devices to support by considering its likely customers.</span></span> <span data-ttu-id="e9c70-141">Se você estiver criando um folheto online para um spa de saúde de luxo, poderá tomar uma decisão de negócios apenas para smartphones avançados, enquanto se estiver criando um sistema de reservas de ingressos para um cinema, provavelmente precisará considerar os visitantes com recursos menos poderosos telefones.</span><span class="sxs-lookup"><span data-stu-id="e9c70-141">If you're building an online brochure for a luxury health spa, you might make a business decision only to target advanced smartphones, whereas if you're creating a ticket booking system for a cinema, you probably need to account for visitors with less powerful feature phones.</span></span>

## <a name="architectural-options"></a><span data-ttu-id="e9c70-142">Opções de arquitetura</span><span class="sxs-lookup"><span data-stu-id="e9c70-142">Architectural options</span></span>

<span data-ttu-id="e9c70-143">Antes de chegarmos aos detalhes técnicos específicos do ASP.NET Web Forms ou MVC, observe que os desenvolvedores da Web em geral têm três opções principais possíveis para dar suporte a navegadores móveis:</span><span class="sxs-lookup"><span data-stu-id="e9c70-143">Before we get to the specific technical details of ASP.NET Web Forms or MVC, note that web developers in general have three main possible options for supporting mobile browsers:</span></span>

1. <span data-ttu-id="e9c70-144">***Não fazer nada –*** Você pode simplesmente criar um aplicativo Web padrão e orientado para desktop e contar com navegadores móveis para renderizá-los de forma aceitável.</span><span class="sxs-lookup"><span data-stu-id="e9c70-144">***Do nothing –*** You can simply create a standard, desktop-oriented web application, and rely on mobile browsers to render it acceptably.</span></span> 

    - <span data-ttu-id="e9c70-145">**Vantagem**: é a opção mais barata para implementar e manter – sem trabalho extra</span><span class="sxs-lookup"><span data-stu-id="e9c70-145">**Advantage**: It's the cheapest option to implement and maintain – no extra work</span></span>
    - <span data-ttu-id="e9c70-146">**Desvantagem**: oferece a pior experiência do usuário final:</span><span class="sxs-lookup"><span data-stu-id="e9c70-146">**Disadvantage**: Gives the worst end-user experience:</span></span> 

        - <span data-ttu-id="e9c70-147">Os smartphones mais recentes podem renderizar seu HTML tão bem quanto um navegador de desktop, mas os usuários ainda serão forçados a ampliar e rolar horizontalmente e verticalmente para consumir o conteúdo em uma tela pequena.</span><span class="sxs-lookup"><span data-stu-id="e9c70-147">The latest smartphones may render your HTML just as well as a desktop browser, but users will still be forced to zoom and scroll horizontally and vertically to consume your content on a small screen.</span></span> <span data-ttu-id="e9c70-148">Isso está longe de ser o ideal.</span><span class="sxs-lookup"><span data-stu-id="e9c70-148">This is far from optimal.</span></span>
        - <span data-ttu-id="e9c70-149">Dispositivos mais antigos e telefones de recursos podem falhar ao renderizar sua marcação de maneira satisfatória.</span><span class="sxs-lookup"><span data-stu-id="e9c70-149">Older devices and feature phones may fail to render your markup in a satisfactory way.</span></span>
        - <span data-ttu-id="e9c70-150">Mesmo nos dispositivos Tablet mais recentes (cujas telas podem ser tão grandes quanto as telas de laptop), diferentes regras de interação se aplicam.</span><span class="sxs-lookup"><span data-stu-id="e9c70-150">Even on the latest tablet devices (whose screens can be as big as laptop screens), different interaction rules apply.</span></span> <span data-ttu-id="e9c70-151">A entrada baseada em toque funciona melhor com botões e links maiores, e não há como focalizar um cursor do mouse sobre um menu suspenso.</span><span class="sxs-lookup"><span data-stu-id="e9c70-151">Touch-based input works best with larger buttons and links spread further apart, and there's no way to hover a mouse cursor over a fly-out menu.</span></span>
2. <span data-ttu-id="e9c70-152">***Resolva o problema no cliente* –** com uso cuidadoso de CSS e [aprimoramento progressivo](http://en.wikipedia.org/wiki/Progressive_enhancement) , você pode criar marcação, estilos e scripts que se adaptem a qualquer navegador que esteja executando-os.</span><span class="sxs-lookup"><span data-stu-id="e9c70-152">***Solve the problem on the client* –** With careful use of CSS and [progressive enhancement](http://en.wikipedia.org/wiki/Progressive_enhancement) you can create markup, styles, and scripts that adapt to whatever browser is running them.</span></span> <span data-ttu-id="e9c70-153">Por exemplo, com [consultas de mídia do CSS 3](http://www.w3.org/TR/2010/CR-css3-mediaqueries-20100727/), você pode criar um layout de várias colunas que se transforma em um único layout de coluna em dispositivos cujas telas são mais estreitas do que um limite escolhido.</span><span class="sxs-lookup"><span data-stu-id="e9c70-153">For example, with [CSS 3 media queries](http://www.w3.org/TR/2010/CR-css3-mediaqueries-20100727/), you could create a multi-column layout that turns into a single column layout on devices whose screens are narrower than a chosen threshold.</span></span> 

    - <span data-ttu-id="e9c70-154">**Vantagem**: otimiza a renderização para o dispositivo específico em uso, mesmo para dispositivos futuros desconhecidos de acordo com qualquer tela e características de entrada que eles têm</span><span class="sxs-lookup"><span data-stu-id="e9c70-154">**Advantage**: Optimizes rendering for the specific device in use, even for unknown future devices according to whatever screen and input characteristics they have</span></span>
    - <span data-ttu-id="e9c70-155">**Vantagem**: permite que você compartilhe a lógica do lado do servidor em todos os tipos de dispositivo – a duplicação mínima de código ou esforço</span><span class="sxs-lookup"><span data-stu-id="e9c70-155">**Advantage**: Easily lets you share server-side logic across all device types – minimal duplication of code or effort</span></span>
    - <span data-ttu-id="e9c70-156">**Desvantagem**: os dispositivos móveis são tão diferentes dos dispositivos de área de trabalho que você pode querer que suas páginas móveis sejam completamente diferentes das páginas da área de trabalho, mostrando informações diferentes.</span><span class="sxs-lookup"><span data-stu-id="e9c70-156">**Disadvantage**: Mobile devices are so different from desktop devices that you may really want your mobile pages to be completely different from your desktop pages, showing different information.</span></span> <span data-ttu-id="e9c70-157">Essas variações podem ser ineficientes ou impossíveis de serem obtidas de forma robusta por meio de CSS, especialmente considerando como dispositivos inconsistentes interpretam as regras de CSS.</span><span class="sxs-lookup"><span data-stu-id="e9c70-157">Such variations can be inefficient or impossible to achieve robustly through CSS alone, especially considering how inconsistently older devices interpret CSS rules.</span></span> <span data-ttu-id="e9c70-158">Isso é particularmente verdadeiro para atributos CSS 3.</span><span class="sxs-lookup"><span data-stu-id="e9c70-158">This is particularly true of CSS 3 attributes.</span></span>
    - <span data-ttu-id="e9c70-159">**Desvantagem**: o não oferece suporte a diferentes lógicas e fluxos de trabalho do lado do servidor para diversos dispositivos.</span><span class="sxs-lookup"><span data-stu-id="e9c70-159">**Disadvantage**: Provides no support for varying server-side logic and workflows for different devices.</span></span> <span data-ttu-id="e9c70-160">Você não pode, por exemplo, implementar um fluxo de trabalho de retirada do carrinho de compras simplificado para usuários móveis por meio do CSS sozinho.</span><span class="sxs-lookup"><span data-stu-id="e9c70-160">You can't, for example, implement a simplified shopping cart checkout workflow for mobile users by means of CSS alone.</span></span>
    - <span data-ttu-id="e9c70-161">**Desvantagem**: uso ineficiente da largura de banda.</span><span class="sxs-lookup"><span data-stu-id="e9c70-161">**Disadvantage**: Inefficient bandwidth use.</span></span> <span data-ttu-id="e9c70-162">O servidor pode precisar transmitir a marcação e os estilos que se aplicam a todos os dispositivos possíveis, mesmo que o dispositivo de destino use apenas um subconjunto dessas informações.</span><span class="sxs-lookup"><span data-stu-id="e9c70-162">You server may have to transmit the markup and styles that apply to all possible devices, even though the target device will only use a subset of that information.</span></span>
3. <span data-ttu-id="e9c70-163">***Resolver o problema no servidor* –** Se o seu servidor sabe qual dispositivo está acessando-o – ou pelo menos as características desse dispositivo, como o tamanho da tela e o método de entrada, e se é um dispositivo móvel, ele pode executar uma lógica diferente e gerar uma marcação HTML diferente.</span><span class="sxs-lookup"><span data-stu-id="e9c70-163">***Solve the problem on the server* –** If your server knows what device is accessing it – or at least the characteristics of that device, such as its screen size and input method, and whether it's a mobile device – it can run different logic and output different HTML markup.</span></span> 

    - <span data-ttu-id="e9c70-164">**Vantagem:** Flexibilidade máxima.</span><span class="sxs-lookup"><span data-stu-id="e9c70-164">**Advantage:** Maximum flexibility.</span></span> <span data-ttu-id="e9c70-165">Não há limite para o quanto você pode variar a lógica do lado do servidor para dispositivos móveis ou otimizar sua marcação para o layout específico do dispositivo desejado.</span><span class="sxs-lookup"><span data-stu-id="e9c70-165">There's no limit to how much you can vary your server-side logic for mobiles or optimize your markup for the desired, device-specific layout.</span></span>
    - <span data-ttu-id="e9c70-166">**Vantagem:** Uso eficiente da largura de banda.</span><span class="sxs-lookup"><span data-stu-id="e9c70-166">**Advantage:** Efficient bandwidth use.</span></span> <span data-ttu-id="e9c70-167">Você só precisa transmitir as informações de marcação e estilo que o dispositivo de destino vai usar.</span><span class="sxs-lookup"><span data-stu-id="e9c70-167">You only need to transmit the markup and styling information that the target device is going to use.</span></span>
    - <span data-ttu-id="e9c70-168">**Desvantagem:** Às vezes, força a repetição de esforço ou código (por exemplo, fazer com que você crie cópias semelhantes, mas ligeiramente diferentes, de suas páginas de Web Forms ou exibições do MVC).</span><span class="sxs-lookup"><span data-stu-id="e9c70-168">**Disadvantage:** Sometimes forces repetition of effort or code (e.g., making you create similar but slightly different copies of your Web Forms pages or MVC views).</span></span> <span data-ttu-id="e9c70-169">Sempre que possível, você criará uma lógica comum em uma camada ou serviço subjacente, mas ainda assim, algumas partes do código da interface do usuário ou da marcação talvez precisem ser duplicadas e mantidas em paralelo.</span><span class="sxs-lookup"><span data-stu-id="e9c70-169">Where possible you will factor out common logic into an underlying layer or service, but still, some parts of your UI code or markup may have to be duplicated and then maintained in parallel.</span></span>
    - <span data-ttu-id="e9c70-170">**Desvantagem:** A detecção de dispositivo não é trivial.</span><span class="sxs-lookup"><span data-stu-id="e9c70-170">**Disadvantage:** Device detection is not trivial.</span></span> <span data-ttu-id="e9c70-171">Ele requer uma lista ou banco de dados de tipos de dispositivos conhecidos e suas características (que talvez nem sempre estejam perfeitamente atualizadas) e não é garantido que correspondam com precisão a cada solicitação de entrada.</span><span class="sxs-lookup"><span data-stu-id="e9c70-171">It requires a list or database of known device types and their characteristics (which may not always be perfectly up-to-date) and isn't guaranteed to accurately match every incoming request.</span></span> <span data-ttu-id="e9c70-172">Este documento descreve algumas opções e suas armadilhas mais tarde.</span><span class="sxs-lookup"><span data-stu-id="e9c70-172">This document describes some options and their pitfalls later.</span></span>

<span data-ttu-id="e9c70-173">Para obter os melhores resultados, a maioria dos desenvolvedores descobre que eles precisam combinar opções (2) e (3).</span><span class="sxs-lookup"><span data-stu-id="e9c70-173">To get the best results, most developers find they need to combine options (2) and (3).</span></span> <span data-ttu-id="e9c70-174">Pequenas diferenças estilísticos são mais bem acomodadas no cliente usando CSS ou até mesmo JavaScript, enquanto as principais diferenças nos dados, no fluxo de trabalho ou na marcação são implementadas com mais eficiência no código do servidor.</span><span class="sxs-lookup"><span data-stu-id="e9c70-174">Minor stylistic differences are best accommodated on the client using CSS or even JavaScript, whereas major differences in data, workflow, or markup are most effectively implemented in server-side code.</span></span>

### <a name="this-paper-focuses-on-server-side-techniques"></a><span data-ttu-id="e9c70-175">Este documento se concentra nas técnicas do lado do servidor</span><span class="sxs-lookup"><span data-stu-id="e9c70-175">This paper focuses on server-side techniques</span></span>

<span data-ttu-id="e9c70-176">Como o ASP.NET Web Forms e o MVC são essencialmente tecnologias do lado do servidor, esse white paper se concentrará em técnicas do lado do servidor que permitem produzir diferentes marcações e lógica para navegadores móveis.</span><span class="sxs-lookup"><span data-stu-id="e9c70-176">Since ASP.NET Web Forms and MVC are both primarily server-side technologies, this white paper will focus on server-side techniques that let you produce different markup and logic for mobile browsers.</span></span> <span data-ttu-id="e9c70-177">É claro que você também pode combinar isso com qualquer técnica do lado do cliente (por exemplo, consultas de mídia do CSS 3, JavaScript de aprimoramento progressivo), mas essa é uma questão de design da Web do que o desenvolvimento de ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="e9c70-177">Of course, you can also combine this with any client-side technique (e.g., CSS 3 media queries, progressive-enhancement JavaScript), but that's more a matter of web design than ASP.NET development.</span></span>

## <a name="browser-and-device-detection"></a><span data-ttu-id="e9c70-178">Detecção de navegador e dispositivo</span><span class="sxs-lookup"><span data-stu-id="e9c70-178">Browser and device detection</span></span>

<span data-ttu-id="e9c70-179">O principal pré-requisito para todas as técnicas do lado do servidor para dar suporte a dispositivos móveis é saber qual dispositivo seu visitante está usando.</span><span class="sxs-lookup"><span data-stu-id="e9c70-179">The key prerequisite for all server-side techniques for supporting mobile devices is to know what device your visitor is using.</span></span> <span data-ttu-id="e9c70-180">Na verdade, ainda melhor do que saber o fabricante e o número do modelo desse dispositivo é conhecer as *características* do dispositivo.</span><span class="sxs-lookup"><span data-stu-id="e9c70-180">In fact, even better than knowing the manufacturer and model number of that device is knowing the *characteristics* of the device.</span></span> <span data-ttu-id="e9c70-181">As características podem incluir:</span><span class="sxs-lookup"><span data-stu-id="e9c70-181">Characteristics may include:</span></span>

- <span data-ttu-id="e9c70-182">É um dispositivo móvel?</span><span class="sxs-lookup"><span data-stu-id="e9c70-182">Is it a mobile device?</span></span>
- <span data-ttu-id="e9c70-183">Método de entrada (mouse/teclado, toque, teclado, joystick,...)</span><span class="sxs-lookup"><span data-stu-id="e9c70-183">Input method (mouse/keyboard, touch, keypad, joystick, …)</span></span>
- <span data-ttu-id="e9c70-184">Tamanho da tela (fisicamente e em pixels)</span><span class="sxs-lookup"><span data-stu-id="e9c70-184">Screen size (physically and in pixels)</span></span>
- <span data-ttu-id="e9c70-185">Formatos de dados e mídia com suporte</span><span class="sxs-lookup"><span data-stu-id="e9c70-185">Supported media and data formats</span></span>
- <span data-ttu-id="e9c70-186">Etc.</span><span class="sxs-lookup"><span data-stu-id="e9c70-186">Etc.</span></span>

<span data-ttu-id="e9c70-187">É melhor tomar decisões com base em características do que o número do modelo, pois você estará mais bem equipado para lidar com futuros dispositivos.</span><span class="sxs-lookup"><span data-stu-id="e9c70-187">It's better to make decisions based on characteristics than model number, because then you'll be better equipped to handle future devices.</span></span>

### <a name="using-aspnets-built-in-browser-detection-support"></a><span data-ttu-id="e9c70-188">Usando ASP. Suporte de detecção de navegador interno da rede</span><span class="sxs-lookup"><span data-stu-id="e9c70-188">Using ASP.NET's built-in browser detection support</span></span>

<span data-ttu-id="e9c70-189">Os desenvolvedores do ASP.NET Web Forms e MVC podem descobrir imediatamente características importantes de um navegador da visita inspecionando as propriedades do objeto *Request. browser* .</span><span class="sxs-lookup"><span data-stu-id="e9c70-189">ASP.NET Web Forms and MVC developers can immediately discover important characteristics of a visiting browser by inspecting properties of the *Request.Browser* object.</span></span> <span data-ttu-id="e9c70-190">Por exemplo, consulte</span><span class="sxs-lookup"><span data-stu-id="e9c70-190">For example, see</span></span>

- <span data-ttu-id="e9c70-191">Request.Browser.IsMobileDevice</span><span class="sxs-lookup"><span data-stu-id="e9c70-191">Request.Browser.IsMobileDevice</span></span>
- <span data-ttu-id="e9c70-192">Request.Browser.MobileDeviceManufacturer, Request.Browser.MobileDeviceModel</span><span class="sxs-lookup"><span data-stu-id="e9c70-192">Request.Browser.MobileDeviceManufacturer, Request.Browser.MobileDeviceModel</span></span>
- <span data-ttu-id="e9c70-193">Request.Browser.ScreenPixelsWidth</span><span class="sxs-lookup"><span data-stu-id="e9c70-193">Request.Browser.ScreenPixelsWidth</span></span>
- <span data-ttu-id="e9c70-194">Request.Browser.SupportsXmlHttp</span><span class="sxs-lookup"><span data-stu-id="e9c70-194">Request.Browser.SupportsXmlHttp</span></span>
- <span data-ttu-id="e9c70-195">... e muitos outros</span><span class="sxs-lookup"><span data-stu-id="e9c70-195">…and many others</span></span>

<span data-ttu-id="e9c70-196">Nos bastidores, a plataforma ASP.NET corresponde ao cabeçalho HTTP de UA ( *agente de usuário* ) de entrada em relação a expressões regulares em um conjunto de arquivos XML de definição de navegador.</span><span class="sxs-lookup"><span data-stu-id="e9c70-196">Behind the scenes, the ASP.NET platform matches the incoming *User-Agent* (UA) HTTP header against regular expressions in a set of Browser Definition XML files.</span></span> <span data-ttu-id="e9c70-197">Por padrão, a plataforma inclui definições para muitos dispositivos móveis comuns, e você pode adicionar arquivos de definição de navegador personalizados para outras pessoas que você deseja reconhecer.</span><span class="sxs-lookup"><span data-stu-id="e9c70-197">By default the platform includes definitions for many common mobile devices, and you can add custom Browser Definition files for others you wish to recognize.</span></span> <span data-ttu-id="e9c70-198">Para obter mais detalhes, consulte a página do MSDN [ASP.NET controles de servidor Web e recursos do navegador](https://msdn.microsoft.com/library/x3k2ssx2.aspx).</span><span class="sxs-lookup"><span data-stu-id="e9c70-198">For more details, see the MSDN page [ASP.NET Web Server Controls and Browser Capabilities](https://msdn.microsoft.com/library/x3k2ssx2.aspx).</span></span>

### <a name="using-the-wurfl-device-database-via-51degreesmobi-foundation"></a><span data-ttu-id="e9c70-199">Usando o banco de dados do dispositivo WURFL por meio do 51Degrees.mobi Foundation</span><span class="sxs-lookup"><span data-stu-id="e9c70-199">Using the WURFL device database via 51Degrees.mobi Foundation</span></span>

<span data-ttu-id="e9c70-200">Enquanto o ASP. O suporte interno à detecção de navegadores da rede será suficiente para muitos aplicativos, há dois casos principais em que ele pode não ser suficiente:</span><span class="sxs-lookup"><span data-stu-id="e9c70-200">While ASP.NET's built-in browser detection support will be sufficient for many applications, there are two main cases when it might not be enough:</span></span>

- <span data-ttu-id="e9c70-201">***Você deseja reconhecer os dispositivos mais recentes***(sem criar manualmente os arquivos de definição do navegador para eles).</span><span class="sxs-lookup"><span data-stu-id="e9c70-201">***You want to recognize the latest devices***(without manually creating Browser Definition files for them).</span></span> <span data-ttu-id="e9c70-202">Observe que os arquivos de definição de navegador do .NET 4 não são recentes o suficiente para reconhecer Windows Phone 7, telefones Android, navegadores móveis operativos ou iPads da Apple.</span><span class="sxs-lookup"><span data-stu-id="e9c70-202">Note that .NET 4's Browser Definition files are not recent enough to recognize Windows Phone 7, Android phones, Opera Mobile browsers, or Apple iPads.</span></span>
- <span data-ttu-id="e9c70-203">***Você precisa de informações mais detalhadas sobre os recursos do dispositivo***.</span><span class="sxs-lookup"><span data-stu-id="e9c70-203">***You need more detailed information about device capabilities***.</span></span> <span data-ttu-id="e9c70-204">Talvez você precise saber sobre o método de entrada de um dispositivo (por exemplo, Touch vs teclado) ou quais formatos de áudio o navegador dá suporte.</span><span class="sxs-lookup"><span data-stu-id="e9c70-204">You may need to know about a device's input method (e.g., touch vs keypad), or what audio formats the browser supports.</span></span> <span data-ttu-id="e9c70-205">Essas informações não estão disponíveis nos arquivos de definição padrão do navegador.</span><span class="sxs-lookup"><span data-stu-id="e9c70-205">This information isn't available in the standard Browser Definition files.</span></span>

<span data-ttu-id="e9c70-206">O [projeto WURFL ( *Wireless Universal Resource File* )](http://wurfl.sourceforge.net/) mantém informações mais atualizadas e detalhadas sobre os dispositivos móveis em uso hoje.</span><span class="sxs-lookup"><span data-stu-id="e9c70-206">The [*Wireless Universal Resource File* (WURFL) project](http://wurfl.sourceforge.net/) maintains much more up-to-date and detailed information about mobile devices in use today.</span></span>

<span data-ttu-id="e9c70-207">A ótima notícia para os desenvolvedores de .NET é que o ASP. O recurso de detecção de navegador da rede é extensível, portanto, é possível aprimorá-lo para superar esses problemas.</span><span class="sxs-lookup"><span data-stu-id="e9c70-207">The great news for .NET developers is that ASP.NET's browser detection feature is extensible, so it's possible to enhance it to overcome these problems.</span></span> <span data-ttu-id="e9c70-208">Por exemplo, você pode adicionar a biblioteca do Open Source [*51Degrees.mobi Foundation*](https://github.com/51Degrees/dotNET-Device-Detection) ao seu projeto.</span><span class="sxs-lookup"><span data-stu-id="e9c70-208">For example, you can add the open source [*51Degrees.mobi Foundation*](https://github.com/51Degrees/dotNET-Device-Detection) library to your project.</span></span> <span data-ttu-id="e9c70-209">É um ASP.NET IHttpModule ou provedor de recursos de navegador (utilizável em aplicativos Web Forms e MVC), que lê diretamente os dados WURFL e os conecta ao ASP. Mecanismo de detecção de navegador interno da rede.</span><span class="sxs-lookup"><span data-stu-id="e9c70-209">It's an ASP.NET IHttpModule or Browser Capabilities Provider (usable on both Web Forms and MVC applications), that directly reads WURFL data and hooks it into ASP.NET's built-in browser detection mechanism.</span></span> <span data-ttu-id="e9c70-210">Depois de instalar o módulo, a *solicitação. browser* terá, de repente, uma informação mais precisa e detalhada: Ele reconhecerá corretamente muitos dos dispositivos mencionados anteriormente e listaria seus recursos (incluindo recursos adicionais, como o método de entrada).</span><span class="sxs-lookup"><span data-stu-id="e9c70-210">Once you've installed the module, *Request.Browser* will suddenly contain a lot more accurate and detailed information: it will correctly recognize many of the devices previously mentioned and list their capabilities (including additional capabilities such as input method).</span></span> <span data-ttu-id="e9c70-211">Consulte a documentação do projeto para obter mais detalhes.</span><span class="sxs-lookup"><span data-stu-id="e9c70-211">See the project's documentation for more details.</span></span>

## <a name="how-web-forms-applications-can-present-mobile-specific-pages"></a><span data-ttu-id="e9c70-212">Como Web Forms aplicativos podem apresentar páginas específicas para dispositivos móveis</span><span class="sxs-lookup"><span data-stu-id="e9c70-212">How Web Forms applications can present mobile-specific pages</span></span>

<span data-ttu-id="e9c70-213">Por padrão, veja como uma nova Web Forms aplicativo é exibida em dispositivos móveis comuns:</span><span class="sxs-lookup"><span data-stu-id="e9c70-213">By default, here's how a brand new Web Forms application displays on common mobile devices:</span></span>

![](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/_static/image1.png)

<span data-ttu-id="e9c70-214">Claramente, nenhum layout parece muito móvel – esta página foi projetada para um monitor grande, orientado a paisagem, não para uma pequena tela orientada a retrato.</span><span class="sxs-lookup"><span data-stu-id="e9c70-214">Clearly, neither layout looks very mobile-friendly – this page was designed for a large, landscape-oriented monitor, not for a small portrait-oriented screen.</span></span> <span data-ttu-id="e9c70-215">Então, o que você pode fazer a respeito?</span><span class="sxs-lookup"><span data-stu-id="e9c70-215">So what can you do about it?</span></span>

<span data-ttu-id="e9c70-216">Como discutido anteriormente neste documento, há várias maneiras de personalizar suas páginas para dispositivos móveis.</span><span class="sxs-lookup"><span data-stu-id="e9c70-216">As discussed earlier in this paper, there are many ways to tailor your pages for mobile devices.</span></span> <span data-ttu-id="e9c70-217">Algumas técnicas são baseadas em servidor, outras executadas no cliente.</span><span class="sxs-lookup"><span data-stu-id="e9c70-217">Some techniques are server-based, others run on the client.</span></span>

### <a name="creating-a-mobile-specific-master-page"></a><span data-ttu-id="e9c70-218">Criando uma página mestra específica para dispositivos móveis</span><span class="sxs-lookup"><span data-stu-id="e9c70-218">Creating a mobile-specific master page</span></span>

<span data-ttu-id="e9c70-219">Dependendo dos seus requisitos, você poderá usar o mesmo Web Forms para todos os visitantes, mas ter duas páginas mestras separadas: uma para os visitantes da área de trabalho, outra para os visitantes móveis.</span><span class="sxs-lookup"><span data-stu-id="e9c70-219">Depending on your requirements, you may be able to use the same Web Forms for all visitors, but have two separate master pages: one for desktop visitors, another for mobile visitors.</span></span> <span data-ttu-id="e9c70-220">Isso proporciona a flexibilidade de alterar a folha de estilos CSS ou sua marcação HTML de nível superior para atender a dispositivos móveis, sem forçá-lo a duplicar qualquer lógica de página.</span><span class="sxs-lookup"><span data-stu-id="e9c70-220">This gives you the flexibility of changing the CSS stylesheet or your top-level HTML markup to suit mobile devices, without forcing you to duplicate any page logic.</span></span>

<span data-ttu-id="e9c70-221">Isso é fácil de fazer.</span><span class="sxs-lookup"><span data-stu-id="e9c70-221">This is easy to do.</span></span> <span data-ttu-id="e9c70-222">Por exemplo, você pode adicionar um manipulador PreInit como o seguinte a um formulário da Web:</span><span class="sxs-lookup"><span data-stu-id="e9c70-222">For example, you can add a PreInit handler such as the following to a Web Form:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample1.cs)]

<span data-ttu-id="e9c70-223">Agora, crie uma página mestra chamada Mobile. Master na pasta de nível superior do seu aplicativo e ela será usada quando um dispositivo móvel for detectado.</span><span class="sxs-lookup"><span data-stu-id="e9c70-223">Now, create a master page called Mobile.Master in the top-level folder of your application, and it will be used when a mobile device is detected.</span></span> <span data-ttu-id="e9c70-224">Sua página mestra móvel pode fazer referência a uma folha de estilos CSS específica para dispositivos móveis, se necessário.</span><span class="sxs-lookup"><span data-stu-id="e9c70-224">Your mobile master page can reference a mobile-specific CSS stylesheet if necessary.</span></span> <span data-ttu-id="e9c70-225">Os visitantes da área de trabalho ainda verão sua página mestra padrão, não a móvel.</span><span class="sxs-lookup"><span data-stu-id="e9c70-225">Desktop visitors will still see your default master page, not the mobile one.</span></span>

### <a name="creating-independent-mobile-specific-web-forms"></a><span data-ttu-id="e9c70-226">Criando Web Forms específicas para dispositivos móveis independentes</span><span class="sxs-lookup"><span data-stu-id="e9c70-226">Creating independent mobile-specific Web Forms</span></span>

<span data-ttu-id="e9c70-227">Para obter a máxima flexibilidade, você pode ir muito além do que apenas ter páginas mestras separadas para diferentes tipos de dispositivo.</span><span class="sxs-lookup"><span data-stu-id="e9c70-227">For maximum flexibility, you can go much further than just having separate master pages for different device types.</span></span> <span data-ttu-id="e9c70-228">Você pode implementar dois *conjuntos totalmente separados de páginas Web Forms* – um conjunto para navegadores da área de trabalho, outro conjunto para dispositivos móveis.</span><span class="sxs-lookup"><span data-stu-id="e9c70-228">You can implement two *totally separate sets of Web Forms pages* – one set for desktop browsers, another set for mobiles.</span></span> <span data-ttu-id="e9c70-229">Isso funciona melhor se você quiser apresentar informações ou fluxos de trabalho muito diferentes para visitantes móveis.</span><span class="sxs-lookup"><span data-stu-id="e9c70-229">This works best if you want to present very different information or workflows to mobile visitors.</span></span> <span data-ttu-id="e9c70-230">O restante desta seção descreve detalhadamente essa abordagem.</span><span class="sxs-lookup"><span data-stu-id="e9c70-230">The rest of this section describes this approach in detail.</span></span>

<span data-ttu-id="e9c70-231">Supondo que você já tenha um aplicativo Web Forms projetado para navegadores de desktop, a maneira mais fácil de continuar é criar uma subpasta chamada "Mobile" em seu projeto e criar suas páginas móveis.</span><span class="sxs-lookup"><span data-stu-id="e9c70-231">Assuming you already have a Web Forms application designed for desktop browsers, the easiest way to proceed is to create a subfolder called "Mobile" within your project, and build your mobile pages there.</span></span> <span data-ttu-id="e9c70-232">Você pode construir um subsite inteiro, com suas próprias páginas mestras, folhas de estilo e páginas, usando todas as mesmas técnicas que usaria para qualquer outro aplicativo Web Forms.</span><span class="sxs-lookup"><span data-stu-id="e9c70-232">You can construct an entire sub-site, with its own master pages, style sheets, and pages, using all the same techniques that you'd use for any other Web Forms application.</span></span> <span data-ttu-id="e9c70-233">Você não precisa necessariamente produzir um equivalente móvel para *cada* página no seu site de área de trabalho; Você pode escolher qual subconjunto de funcionalidade faz sentido para os visitantes do celular.</span><span class="sxs-lookup"><span data-stu-id="e9c70-233">You don't necessarily need to produce a mobile equivalent for *every* page in your desktop site; you can choose what subset of functionality makes sense for mobile visitors.</span></span>

<span data-ttu-id="e9c70-234">Suas páginas móveis podem compartilhar recursos estáticos comuns (como imagens, JavaScript ou arquivos CSS) com suas páginas normais, se desejar.</span><span class="sxs-lookup"><span data-stu-id="e9c70-234">Your mobile pages can share common static resources (such as images, JavaScript, or CSS files) with your regular pages if you wish.</span></span> <span data-ttu-id="e9c70-235">Como sua pasta "móvel" *não* será marcada como um aplicativo separado quando hospedada no IIS (é apenas uma subpasta simples de Web Forms páginas), ela também compartilhará a mesma configuração, os dados da sessão e outras infraestruturas como suas páginas da área de trabalho.</span><span class="sxs-lookup"><span data-stu-id="e9c70-235">Since your "Mobile" folder will *not* be marked as a separate application when hosted in IIS (it's just a simple subfolder of Web Forms pages), it will also share all the same configuration, Session data, and other infrastructure as your desktop pages.</span></span>

> [!NOTE]
> <span data-ttu-id="e9c70-236">Como essa abordagem geralmente envolve uma duplicação de código (as páginas móveis provavelmente compartilharão algumas semelhanças com as páginas da área de trabalho), é importante considerar qualquer lógica comercial comum ou código de acesso a dados em uma camada subjacente compartilhada ou serviço.</span><span class="sxs-lookup"><span data-stu-id="e9c70-236">Since this approach usually involves some duplication of code (mobile pages are likely to share some similarities with desktop pages), it's important to factor out any common business logic or data access code into a shared underlying layer or service.</span></span> <span data-ttu-id="e9c70-237">Caso contrário, você dobrará o esforço de criar e manter seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e9c70-237">Otherwise, you'll double the effort of creating and maintaining your application.</span></span>

#### <a name="redirecting-mobile-visitors-to-your-mobile-pages"></a><span data-ttu-id="e9c70-238">Redirecionando visitantes móveis para suas páginas móveis</span><span class="sxs-lookup"><span data-stu-id="e9c70-238">Redirecting mobile visitors to your mobile pages</span></span>

<span data-ttu-id="e9c70-239">Muitas vezes é conveniente redirecionar os visitantes móveis para as páginas móveis somente na *primeira* solicitação em sua sessão de navegação (e não em cada solicitação em sua sessão), porque:</span><span class="sxs-lookup"><span data-stu-id="e9c70-239">It's often convenient to redirect mobile visitors to the mobile pages only on the *first* request in their browsing session (and not on every request in their session), because:</span></span>

- <span data-ttu-id="e9c70-240">Você pode facilmente permitir que os visitantes móveis acessem suas páginas da área de trabalho se desejarem – basta colocar um link na página mestra que vai para "versão da área de trabalho".</span><span class="sxs-lookup"><span data-stu-id="e9c70-240">You can then easily allow mobile visitors to access your desktop pages if they wish – just put a link on your master page that goes to "Desktop version".</span></span> <span data-ttu-id="e9c70-241">O visitante não será Redirecionado de volta para uma página móvel porque não é mais a primeira solicitação em sua sessão.</span><span class="sxs-lookup"><span data-stu-id="e9c70-241">The visitor won't be redirected back to a mobile page, because it's no longer the first request in their session.</span></span>
- <span data-ttu-id="e9c70-242">Ele evita o risco de interferir com as solicitações de todos os recursos dinâmicos compartilhados entre a área de trabalho e as partes móveis do seu site (por exemplo, se você tiver um formulário da Web comum que as partes desktop e móvel do seu site sejam exibidas em um IFRAME ou em determinados manipuladores Ajax)</span><span class="sxs-lookup"><span data-stu-id="e9c70-242">It avoids the risk of interfering with requests for any dynamic resources shared between desktop and mobile parts of your site (e.g., if you have a common Web Form that both desktop and mobile parts of your site display in an IFRAME, or certain Ajax handlers)</span></span>

<span data-ttu-id="e9c70-243">Para fazer isso, você pode posicionar a lógica de redirecionamento em uma **sessão\_método iniciar** .</span><span class="sxs-lookup"><span data-stu-id="e9c70-243">To do this, you can place your redirection logic in a **Session\_Start** method.</span></span> <span data-ttu-id="e9c70-244">Por exemplo, adicione o seguinte método ao seu arquivo Global.asax.cs:</span><span class="sxs-lookup"><span data-stu-id="e9c70-244">For example, add the following method to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample2.cs)]

#### <a name="configuring-forms-authentication-to-respect-your-mobile-pages"></a><span data-ttu-id="e9c70-245">Configurando a autenticação de formulários para respeitar suas páginas móveis</span><span class="sxs-lookup"><span data-stu-id="e9c70-245">Configuring Forms Authentication to respect your mobile pages</span></span>

<span data-ttu-id="e9c70-246">Observe que a autenticação de formulários faz determinadas suposições sobre onde ele pode redirecionar os visitantes durante e após o processo de autenticação:</span><span class="sxs-lookup"><span data-stu-id="e9c70-246">Note that Forms Authentication makes certain assumptions about where it can redirect visitors during and after the authentication process:</span></span>

- <span data-ttu-id="e9c70-247">Quando um usuário precisar ser autenticado, a autenticação de formulários os redirecionará para a página de logon da área de trabalho, independentemente de ser um usuário de desktop ou móvel (porque ele tem apenas um conceito de *uma* URL de logon).</span><span class="sxs-lookup"><span data-stu-id="e9c70-247">When a user needs to be authenticated, Forms Authentication will redirect them to your desktop login page, regardless of whether they're a desktop or mobile user (because it only has a concept of *one* login URL).</span></span> <span data-ttu-id="e9c70-248">Supondo que você queira estilizar sua página de logon móvel de forma diferente, você precisa aprimorar sua página de logon de área de trabalho para que ela redirecione usuários móveis para uma página de logon móvel separada.</span><span class="sxs-lookup"><span data-stu-id="e9c70-248">Assuming you want to style your mobile login page differently, you need to enhance your desktop login page so that it redirects mobile users to a separate mobile login page.</span></span> <span data-ttu-id="e9c70-249">Por exemplo, adicione o seguinte código à sua página de logon de **área de trabalho** code-behind:</span><span class="sxs-lookup"><span data-stu-id="e9c70-249">For example, add the following code to your **desktop** login page code-behind:</span></span> 

    [!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample3.cs)]
- <span data-ttu-id="e9c70-250">Depois que um usuário faz logon com êxito, a autenticação de formulários, por padrão, redirecionará-os para seu home page de área de trabalho (porque ele tem apenas um conceito de *uma* página padrão).</span><span class="sxs-lookup"><span data-stu-id="e9c70-250">After a user successfully logs in, Forms Authentication will by default redirect them to your desktop home page (because it only has a concept of *one* default page).</span></span> <span data-ttu-id="e9c70-251">Você precisa aprimorar sua página de logon móvel para que ela Redirecione para o home page móvel após um logon bem-sucedido.</span><span class="sxs-lookup"><span data-stu-id="e9c70-251">You need to enhance your mobile login page so that it redirects to the mobile home page after a successful log-in.</span></span> <span data-ttu-id="e9c70-252">Por exemplo, adicione o seguinte código à sua página de logon **móvel** code-behind:</span><span class="sxs-lookup"><span data-stu-id="e9c70-252">For example, add the following code to your **mobile** login page code-behind:</span></span> 

    [!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample4.cs)]
  
  <span data-ttu-id="e9c70-253">Esse código pressupõe que sua página tenha um controle de servidor de logon chamado LoginUser, como no modelo de projeto padrão.</span><span class="sxs-lookup"><span data-stu-id="e9c70-253">This code assumes your page has a Login server control called LoginUser, as in the default project template.</span></span>

### <a name="working-with-output-caching"></a><span data-ttu-id="e9c70-254">Trabalhando com cache de saída</span><span class="sxs-lookup"><span data-stu-id="e9c70-254">Working with Output Caching</span></span>

<span data-ttu-id="e9c70-255">Se você estiver usando o cache de saída, lembre-se de que, por padrão, é possível que um usuário de desktop visite uma determinada URL (fazendo com que sua saída seja armazenada em cache), seguida por um usuário móvel que recebe a saída de área de trabalho armazenada em cache.</span><span class="sxs-lookup"><span data-stu-id="e9c70-255">If you're using output caching, beware that by default it's possible for a desktop user to visit a certain URL (causing its output to be cached), followed by a mobile user who then receives the cached desktop output.</span></span> <span data-ttu-id="e9c70-256">Esse aviso se aplica se você estiver apenas variando sua página mestra por tipo de dispositivo ou implementando Web Forms totalmente separados por tipo de dispositivo.</span><span class="sxs-lookup"><span data-stu-id="e9c70-256">This warning applies whether you're just varying your master page by device type, or implementing totally separate Web Forms per device type.</span></span>

<span data-ttu-id="e9c70-257">Para evitar o problema, você pode instruir o ASP.NET a variar a entrada de cache de acordo com o fato de o visitante estar usando um dispositivo móvel.</span><span class="sxs-lookup"><span data-stu-id="e9c70-257">To avoid the problem, you can instruct ASP.NET to vary the cache entry according to whether the visitor is using a mobile device.</span></span> <span data-ttu-id="e9c70-258">Adicione um parâmetro VaryByCustom à declaração OutputCache da sua página da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="e9c70-258">Add a VaryByCustom parameter to your page's OutputCache declaration as follows:</span></span>

[!code-aspx[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample5.aspx)]

<span data-ttu-id="e9c70-259">Em seguida, defina *IsMobileDevice* como um parâmetro de cache personalizado adicionando a seguinte substituição de método ao seu arquivo global.asax.cs:</span><span class="sxs-lookup"><span data-stu-id="e9c70-259">Next, define *isMobileDevice* as a custom cache parameter by adding the following method override to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample6.cs)]

<span data-ttu-id="e9c70-260">Isso garantirá que os visitantes móveis da página não recebam a saída colocada anteriormente no cache por um visitante da área de trabalho.</span><span class="sxs-lookup"><span data-stu-id="e9c70-260">This will ensure that mobile visitors to the page don't receive output previously put into the cache by a desktop visitor.</span></span>

### <a name="a-working-example"></a><span data-ttu-id="e9c70-261">Um exemplo de trabalho</span><span class="sxs-lookup"><span data-stu-id="e9c70-261">A working example</span></span>

<span data-ttu-id="e9c70-262">Para ver essas técnicas em ação, baixe os [exemplos de código deste White Paper](https://docs.microsoft.com/aspnet/mobile/overview).</span><span class="sxs-lookup"><span data-stu-id="e9c70-262">To see these techniques in action, download [this white paper's code samples](https://docs.microsoft.com/aspnet/mobile/overview).</span></span> <span data-ttu-id="e9c70-263">O aplicativo de exemplo Web Forms redireciona automaticamente os usuários móveis para um conjunto de páginas específicas para dispositivos móveis em uma subpasta chamada móvel.</span><span class="sxs-lookup"><span data-stu-id="e9c70-263">The Web Forms sample application automatically redirects mobile users to a set of mobile-specific pages in a subfolder called Mobile.</span></span> <span data-ttu-id="e9c70-264">A marcação e o estilo dessas páginas são mais otimizados para navegadores móveis, como você pode ver nas capturas de tela a seguir:</span><span class="sxs-lookup"><span data-stu-id="e9c70-264">The markup and styling of those pages is better optimized for mobile browsers, as you can see from the following screenshots:</span></span>

![](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/_static/image2.png)

<span data-ttu-id="e9c70-265">Para obter mais dicas sobre como otimizar sua marcação e CSS para navegadores móveis, consulte a seção "estilizando páginas móveis para navegadores móveis", mais adiante neste documento.</span><span class="sxs-lookup"><span data-stu-id="e9c70-265">For more tips about optimizing your markup and CSS for mobile browsers, see the section "Styling mobile pages for mobile browsers" later in this document.</span></span>

## <a name="how-aspnet-mvc-applications-can-present-mobile-specific-pages"></a><span data-ttu-id="e9c70-266">Como os aplicativos MVC ASP.NET podem apresentar páginas específicas para dispositivos móveis</span><span class="sxs-lookup"><span data-stu-id="e9c70-266">How ASP.NET MVC applications can present mobile-specific pages</span></span>

<span data-ttu-id="e9c70-267">Como o padrão Model-View-Controller separa a lógica do aplicativo (em controladores) da lógica de apresentação (em exibições), você pode escolher entre qualquer uma das seguintes abordagens para lidar com o suporte móvel no código do lado do servidor:</span><span class="sxs-lookup"><span data-stu-id="e9c70-267">Since the Model-View-Controller pattern decouples application logic (in controllers) from presentation logic (in views), you can choose from any of the following approaches to handling mobile support in server-side code:</span></span>

1. <span data-ttu-id="e9c70-268">\*\**usar os mesmos controladores e exibições para navegadores de área de trabalho e móveis, mas renderizar as exibições com diferentes layouts do Razor dependendo do tipo de dispositivo *.**</span><span class="sxs-lookup"><span data-stu-id="e9c70-268">\***Use the same controllers and views for both desktop and mobile browsers, but render the views with different Razor layouts depending on the device type\*.**</span></span> <span data-ttu-id="e9c70-269">Essa opção funcionará melhor se você estiver exibindo dados idênticos em todos os dispositivos, mas simplesmente deseja fornecer folhas de estilo CSS diferentes ou alterar alguns elementos HTML de nível superior para dispositivos móveis.</span><span class="sxs-lookup"><span data-stu-id="e9c70-269">This option works best if you're displaying identical data on all devices, but simply want to supply different CSS stylesheets or change a few top-level HTML elements for mobiles.</span></span>
2. <span data-ttu-id="e9c70-270">***Use os mesmos controladores para navegadores de área de trabalho e móveis, mas processe exibições diferentes dependendo do tipo de dispositivo***.</span><span class="sxs-lookup"><span data-stu-id="e9c70-270">***Use the same controllers for both desktop and mobile browsers, but render different views depending on the device type***.</span></span> <span data-ttu-id="e9c70-271">Essa opção funcionará melhor se você estiver exibindo aproximadamente os mesmos dados e fornecendo os mesmos fluxos de trabalho para os usuários finais, mas deseja renderizar uma marcação HTML muito diferente para se adequar ao dispositivo que está sendo usado.</span><span class="sxs-lookup"><span data-stu-id="e9c70-271">This option works best if you're displaying roughly the same data and providing the same workflows for end users, but want to render very different HTML markup to suit the device being used.</span></span>
3. <span data-ttu-id="e9c70-272">\*\**criar áreas separadas para desktops e navegadores móveis, implementando controladores independentes e exibições para cada *.**</span><span class="sxs-lookup"><span data-stu-id="e9c70-272">\***Create separate areas for desktop and mobile browsers, implementing independent controllers and views for each\*.**</span></span> <span data-ttu-id="e9c70-273">Essa opção funcionará melhor se você estiver exibindo telas muito diferentes, contendo informações diferentes e levando o usuário por meio de fluxos de trabalho diferentes, otimizados para o tipo de dispositivo.</span><span class="sxs-lookup"><span data-stu-id="e9c70-273">This option works best if you're displaying very different screens, containing different information and leading the user through different workflows optimized for their device type.</span></span> <span data-ttu-id="e9c70-274">Isso pode significar uma repetição de código, mas você pode minimizar isso ao fatorar a lógica comum em uma camada ou serviço subjacente.</span><span class="sxs-lookup"><span data-stu-id="e9c70-274">It may mean some repetition of code, but you can minimize that by factoring out common logic into an underlying layer or service.</span></span>

<span data-ttu-id="e9c70-275">Se você quiser usar a **primeira** opção e variar apenas o layout do Razor por tipo de dispositivo, será muito fácil.</span><span class="sxs-lookup"><span data-stu-id="e9c70-275">If you want to take the **first** option and vary only the Razor layout per device type, it's very easy.</span></span> <span data-ttu-id="e9c70-276">Basta modificar o arquivo \_ViewStart. cshtml da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="e9c70-276">Just modify your \_ViewStart.cshtml file as follows:</span></span>

[!code-cshtml[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample7.cshtml)]

<span data-ttu-id="e9c70-277">Agora você pode criar um layout específico ao celular chamado \_LayoutMobile. cshtml com uma estrutura de página e as regras de CSS otimizadas para dispositivos móveis.</span><span class="sxs-lookup"><span data-stu-id="e9c70-277">Now you can create a mobile-specific layout called \_LayoutMobile.cshtml with a page structure and CSS rules optimized for mobile devices.</span></span>

<span data-ttu-id="e9c70-278">Se você quiser usar a **segunda** opção para renderizar exibições totalmente diferentes de acordo com o tipo de dispositivo do visitante, consulte a [postagem do blog de Scott Hanselman](http://www.hanselman.com/blog/ABetterASPNETMVCMobileDeviceCapabilitiesViewEngine.aspx).</span><span class="sxs-lookup"><span data-stu-id="e9c70-278">If you want to take the **second** option render totally different views according to the visitor's device type, see [Scott Hanselman's blog post](http://www.hanselman.com/blog/ABetterASPNETMVCMobileDeviceCapabilitiesViewEngine.aspx).</span></span>

<span data-ttu-id="e9c70-279">O restante deste documento se concentra na **terceira** opção – criando controladores *e* exibições separados para dispositivos móveis, para que você possa controlar exatamente qual subconjunto de funcionalidade é oferecido para os visitantes móveis.</span><span class="sxs-lookup"><span data-stu-id="e9c70-279">The rest of this paper focuses on the **third** option – creating separate controllers *and* views for mobile devices – so you can control exactly what subset of functionality is offered for mobile visitors.</span></span>

### <a name="setting-up-a-mobile-area-within-your-aspnet-mvc-application"></a><span data-ttu-id="e9c70-280">Configurando uma área móvel em seu aplicativo MVC ASP.NET</span><span class="sxs-lookup"><span data-stu-id="e9c70-280">Setting up a Mobile area within your ASP.NET MVC application</span></span>

<span data-ttu-id="e9c70-281">Você pode adicionar uma área chamada "móvel" a um aplicativo MVC ASP.NET existente da maneira normal: clique com o botão direito do mouse no nome do projeto em Gerenciador de Soluções e escolha Adicionar à área.</span><span class="sxs-lookup"><span data-stu-id="e9c70-281">You can add an area called "Mobile" to an existing ASP.NET MVC application in the normal way: right-click on your project name in Solution Explorer, then choose Add à Area.</span></span> <span data-ttu-id="e9c70-282">Em seguida, você pode adicionar controladores e exibições como faria em qualquer outra área dentro de um aplicativo MVC ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="e9c70-282">You can then add controllers and views as you would for any other area within an ASP.NET MVC application.</span></span> <span data-ttu-id="e9c70-283">Por exemplo, adicione à sua área móvel um novo controlador chamado HomeController para atuar como uma home page para visitantes móveis.</span><span class="sxs-lookup"><span data-stu-id="e9c70-283">For example, add to your Mobile area a new controller called HomeController to act as a homepage for mobile visitors.</span></span>

### <a name="ensuring-the-url-mobile-reaches-the-mobile-homepage"></a><span data-ttu-id="e9c70-284">Garantindo que a URL/chegue à Home page móvel</span><span class="sxs-lookup"><span data-stu-id="e9c70-284">Ensuring the URL /Mobile reaches the mobile homepage</span></span>

<span data-ttu-id="e9c70-285">Se você quiser que a URL/alcance a ação de índice no HomeController dentro de sua área móvel, será necessário fazer duas pequenas alterações na sua configuração de roteamento.</span><span class="sxs-lookup"><span data-stu-id="e9c70-285">If you want the URL /Mobile to reach the Index action on HomeController inside your Mobile area, you will need to make two small changes to your routing configuration.</span></span> <span data-ttu-id="e9c70-286">Primeiro, atualize sua classe MobileAreaRegistration para que HomeController seja o controlador padrão em sua área móvel, conforme mostrado no código a seguir:</span><span class="sxs-lookup"><span data-stu-id="e9c70-286">First, update your MobileAreaRegistration class so that HomeController is the default controller in your Mobile area, as shown in the following code:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample8.cs)]

<span data-ttu-id="e9c70-287">Isso significa que a home page móvel agora estará localizada em/, em vez de/Mobile/Home, porque "Home" agora é o nome do controlador implicitamente padrão para páginas móveis.</span><span class="sxs-lookup"><span data-stu-id="e9c70-287">This means the mobile homepage will now be located at /Mobile, rather than /Mobile/Home, because "Home" is now the implicitly default controller name for mobile pages.</span></span>

<span data-ttu-id="e9c70-288">Em seguida, observe que, ao adicionar um segundo HomeController ao seu aplicativo (ou seja, o dispositivo móvel, além da área de trabalho existente), você terá quebrado a Home Page da área de trabalho normal.</span><span class="sxs-lookup"><span data-stu-id="e9c70-288">Next, note that by adding a second HomeController to your application (i.e., the mobile one, in addition to the existing desktop one), you'll have broken your regular desktop homepage.</span></span> <span data-ttu-id="e9c70-289">Ele falhará com o erro "*foram encontrados vários tipos que correspondem ao controlador chamado ' Home '* ".</span><span class="sxs-lookup"><span data-stu-id="e9c70-289">It will fail with the error "*Multiple types were found that match the controller named 'Home'*".</span></span> <span data-ttu-id="e9c70-290">Para resolver isso, atualize sua configuração de roteamento de nível superior (em Global.asax.cs) para especificar que a sua área de trabalho HomeController deve ter prioridade quando houver ambiguidade:</span><span class="sxs-lookup"><span data-stu-id="e9c70-290">To resolve this, update your top-level routing configuration (in Global.asax.cs) to specify that your desktop HomeController should take priority when there's ambiguity:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample9.cs)]

<span data-ttu-id="e9c70-291">Agora, o erro será desaparecedo e a URL http:\/\/*seusite*/chegará à Home Page da área de trabalho e http:\/\/*seusite*/Mobile/chegará à Home page móvel.</span><span class="sxs-lookup"><span data-stu-id="e9c70-291">Now the error will go away, and the URL http:\/\/*yoursite*/ will reach the desktop homepage, and http:\/\/*yoursite*/mobile/ will reach the mobile homepage.</span></span>

### <a name="redirecting-mobile-visitors-to-your-mobile-area"></a><span data-ttu-id="e9c70-292">Redirecionando visitantes móveis para sua área móvel</span><span class="sxs-lookup"><span data-stu-id="e9c70-292">Redirecting mobile visitors to your mobile area</span></span>

<span data-ttu-id="e9c70-293">Há muitos pontos de extensibilidade diferentes no ASP.NET MVC, portanto, há muitas maneiras possíveis de injetar a lógica de redirecionamento.</span><span class="sxs-lookup"><span data-stu-id="e9c70-293">There are many different extensibility points in ASP.NET MVC, so there are many possible ways to inject redirection logic.</span></span> <span data-ttu-id="e9c70-294">Uma opção mais clara é criar um atributo de filtro, [RedirectMobileDevicesToMobileArea], que executa um redirecionamento se as seguintes condições forem atendidas:</span><span class="sxs-lookup"><span data-stu-id="e9c70-294">One neat option is to create a filter attribute, [RedirectMobileDevicesToMobileArea], that performs a redirection if the following conditions are met:</span></span>

1. <span data-ttu-id="e9c70-295">É a primeira solicitação na sessão do usuário (ou seja, Session. IsNewSession é igual a true)</span><span class="sxs-lookup"><span data-stu-id="e9c70-295">It's the first request in the user's session (i.e., Session.IsNewSession equals true)</span></span>
2. <span data-ttu-id="e9c70-296">A solicitação vem de um navegador móvel (ou seja, Request. browser. IsMobileDevice é igual a true)</span><span class="sxs-lookup"><span data-stu-id="e9c70-296">The request comes from a mobile browser (i.e., Request.Browser.IsMobileDevice equals true)</span></span>
3. <span data-ttu-id="e9c70-297">O usuário ainda não está solicitando um recurso na área móvel (ou seja, a parte do *caminho* da URL não começa com/)</span><span class="sxs-lookup"><span data-stu-id="e9c70-297">The user is not already requesting a resource in the mobile area (i.e., the *path* part of the URL does not begin with /Mobile)</span></span>

<span data-ttu-id="e9c70-298">O exemplo baixável incluído com este white paper inclui uma implementação dessa lógica.</span><span class="sxs-lookup"><span data-stu-id="e9c70-298">The downloadable sample included with this white paper includes an implementation of this logic.</span></span> <span data-ttu-id="e9c70-299">Ele é implementado como um filtro de autorização, derivado de Authorattribute, o que significa que ele pode funcionar corretamente mesmo se você estiver usando o cache de saída (caso contrário, se um visitante do desktop primeiro acessar uma determinada URL, a saída da área de trabalho poderá ser armazenada em cache e, em seguida, servida para visitantes móveis subsequentes).</span><span class="sxs-lookup"><span data-stu-id="e9c70-299">It's implemented as an authorization filter, derived from AuthorizeAttribute, which means it can work correctly even if you are using output caching (otherwise, if a desktop visitor first accesses a certain URL, the desktop output might be cached and then served to subsequent mobile visitors).</span></span>

<span data-ttu-id="e9c70-300">Como é um filtro, você pode optar por aplicá-lo a controladores e ações específicos, por exemplo,</span><span class="sxs-lookup"><span data-stu-id="e9c70-300">As it's a filter, you can choose either to apply it to specific controllers and actions, e.g.,</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample10.cs)]

<span data-ttu-id="e9c70-301">…</span><span class="sxs-lookup"><span data-stu-id="e9c70-301">…</span></span> <span data-ttu-id="e9c70-302">ou você pode aplicá-lo a todos os controladores e ações como um *filtro global* MVC 3 em seu arquivo global.asax.cs:</span><span class="sxs-lookup"><span data-stu-id="e9c70-302">or you can apply it to all controllers and actions as an MVC 3 *global filter* in your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample11.cs)]

<span data-ttu-id="e9c70-303">O exemplo para download também demonstra como você pode criar subclasses desse atributo que redirecionem para locais específicos dentro de sua área móvel.</span><span class="sxs-lookup"><span data-stu-id="e9c70-303">The downloadable sample also demonstrates how you can create subclasses of this attribute that redirect to specific locations within your mobile area.</span></span> <span data-ttu-id="e9c70-304">Isso significa, por exemplo, que você pode:</span><span class="sxs-lookup"><span data-stu-id="e9c70-304">This means, for example, you can:</span></span>

- <span data-ttu-id="e9c70-305">Registre um filtro global, conforme mostrado acima, que envia os visitantes móveis para a home page móvel por padrão.</span><span class="sxs-lookup"><span data-stu-id="e9c70-305">Register a global filter as shown above that sends mobile visitors to the mobile homepage by default.</span></span>
- <span data-ttu-id="e9c70-306">Também aplique um filtro especial [RedirectMobileDevicesToMobileProductPage] a uma ação de "Exibir produto" que leva os visitantes móveis à versão móvel de qualquer página de produto solicitada.</span><span class="sxs-lookup"><span data-stu-id="e9c70-306">Also apply a special [RedirectMobileDevicesToMobileProductPage] filter to a "view product" action that takes mobile visitors to the mobile version of whatever product page they had requested.</span></span>
- <span data-ttu-id="e9c70-307">Também aplique outras subclasses especiais do filtro a ações específicas, redirecionando os visitantes móveis para a página móvel equivalente</span><span class="sxs-lookup"><span data-stu-id="e9c70-307">Also apply other special subclasses of the filter to specific actions, redirecting mobile visitors to the equivalent mobile page</span></span>

### <a name="configuring-forms-authentication-to-respect-your-mobile-pages"></a><span data-ttu-id="e9c70-308">Configurando a autenticação de formulários para respeitar suas páginas móveis</span><span class="sxs-lookup"><span data-stu-id="e9c70-308">Configuring Forms Authentication to respect your mobile pages</span></span>

<span data-ttu-id="e9c70-309">Se você estiver usando a autenticação de formulários, deverá observar que, quando um usuário precisar fazer logon, ele redireciona automaticamente o usuário para uma única URL específica de "logon", que por padrão é **/Account/logon**.</span><span class="sxs-lookup"><span data-stu-id="e9c70-309">If you're using Forms Authentication, you should note that when a user needs to log in, it automatically redirects the user to a single specific "log on" URL, which by default is **/Account/LogOn**.</span></span> <span data-ttu-id="e9c70-310">Isso significa que os usuários móveis podem ser redirecionados para a ação de "logon" da área de trabalho.</span><span class="sxs-lookup"><span data-stu-id="e9c70-310">This means that mobile users may be redirected to your desktop "log on" action.</span></span>

<span data-ttu-id="e9c70-311">Para evitar esse problema, adicione lógica à ação de "logon" da área de trabalho para que ela Redirecione os usuários móveis novamente para uma ação de "logon" móvel.</span><span class="sxs-lookup"><span data-stu-id="e9c70-311">To avoid this problem, add logic to your desktop "log on" action so that it redirects mobile users again to a mobile "log on" action.</span></span> <span data-ttu-id="e9c70-312">Se você estiver usando o modelo de aplicativo padrão do ASP.NET MVC, atualize a ação de LogOn do AccountController da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="e9c70-312">If you're using the default ASP.NET MVC application template, update AccountController's LogOn action as follows:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample12.cs)]

<span data-ttu-id="e9c70-313">…</span><span class="sxs-lookup"><span data-stu-id="e9c70-313">…</span></span> <span data-ttu-id="e9c70-314">e, em seguida, implementar uma ação adequada de "logon" para dispositivos móveis em um controlador chamado AccountController em sua área móvel.</span><span class="sxs-lookup"><span data-stu-id="e9c70-314">and then implement a suitable mobile-specific "log on" action on a controller called AccountController in your Mobile area.</span></span>

### <a name="working-with-output-caching"></a><span data-ttu-id="e9c70-315">Trabalhando com cache de saída</span><span class="sxs-lookup"><span data-stu-id="e9c70-315">Working with Output Caching</span></span>

<span data-ttu-id="e9c70-316">Se você estiver usando o filtro [OutputCache], deverá forçar a entrada de cache a variar por tipo de dispositivo.</span><span class="sxs-lookup"><span data-stu-id="e9c70-316">If you're using the [OutputCache] filter, you must force the cache entry to vary by device type.</span></span> <span data-ttu-id="e9c70-317">Por exemplo, escreva:</span><span class="sxs-lookup"><span data-stu-id="e9c70-317">For example, write:</span></span>

[!code-javascript[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample13.js)]

<span data-ttu-id="e9c70-318">Em seguida, adicione o seguinte método ao seu arquivo Global.asax.cs:</span><span class="sxs-lookup"><span data-stu-id="e9c70-318">Then, add the following method to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample14.cs)]

<span data-ttu-id="e9c70-319">Isso garantirá que os visitantes móveis da página não recebam a saída colocada anteriormente no cache por um visitante da área de trabalho.</span><span class="sxs-lookup"><span data-stu-id="e9c70-319">This will ensure that mobile visitors to the page don't receive output previously put into the cache by a desktop visitor.</span></span>

### <a name="a-working-example"></a><span data-ttu-id="e9c70-320">Um exemplo de trabalho</span><span class="sxs-lookup"><span data-stu-id="e9c70-320">A working example</span></span>

<span data-ttu-id="e9c70-321">Para ver essas técnicas em ação, baixe os [exemplos associados ao código do White Paper](https://docs.microsoft.com/aspnet/mobile/overview).</span><span class="sxs-lookup"><span data-stu-id="e9c70-321">To see these techniques in action, download [this white paper's code associated samples](https://docs.microsoft.com/aspnet/mobile/overview).</span></span> <span data-ttu-id="e9c70-322">O exemplo inclui um aplicativo ASP.NET MVC 3 (versão Release Candidate) aprimorado para dar suporte a dispositivos móveis usando os métodos descritos acima.</span><span class="sxs-lookup"><span data-stu-id="e9c70-322">The sample includes an ASP.NET MVC 3 (Release Candidate) application enhanced to support mobile devices using the methods described above.</span></span>

## <a name="further-guidance-and-suggestions"></a><span data-ttu-id="e9c70-323">Mais orientações e sugestões</span><span class="sxs-lookup"><span data-stu-id="e9c70-323">Further guidance and suggestions</span></span>

<span data-ttu-id="e9c70-324">A discussão a seguir se aplica aos desenvolvedores Web Forms e MVC que estão usando as técnicas abordadas neste documento.</span><span class="sxs-lookup"><span data-stu-id="e9c70-324">The following discussion applies both to Web Forms and MVC developers who are using the techniques covered in this document.</span></span>

### <a name="enhancing-your-redirection-logic-using-51degreesmobi-foundation"></a><span data-ttu-id="e9c70-325">Aprimorando a lógica de redirecionamento usando o 51Degrees.mobi Foundation</span><span class="sxs-lookup"><span data-stu-id="e9c70-325">Enhancing your redirection logic using 51Degrees.mobi Foundation</span></span>

<span data-ttu-id="e9c70-326">A lógica de redirecionamento mostrada neste documento pode ser perfeitamente suficiente para seu aplicativo, mas não funcionará se você precisar desabilitar sessões ou com navegadores móveis que rejeitem cookies (não podem ter sessões), porque não saberá se uma determinada solicitação é o primeiro daquele visitante.</span><span class="sxs-lookup"><span data-stu-id="e9c70-326">The redirection logic shown in this document may be perfectly sufficient for your application, but it won't work if you need to disable sessions, or with mobile browsers that reject cookies (these can't have sessions), because it won't know whether a given request is the first one from that visitor.</span></span>

<span data-ttu-id="e9c70-327">Você já aprendeu como o Open Source 51Degrees.mobi Foundation pode melhorar a precisão do ASP. Detecção de navegador da rede.</span><span class="sxs-lookup"><span data-stu-id="e9c70-327">You already learned how the open source 51Degrees.mobi Foundation can improve the accuracy of ASP.NET's browser detection.</span></span> <span data-ttu-id="e9c70-328">Ele também tem uma capacidade interna de redirecionar visitantes móveis para locais específicos configurados em Web. config. Ele é capaz de trabalhar sem depender de sessões de ASP.NET (e, portanto, cookies) armazenando um log temporário de hashes de cabeçalhos HTTP dos visitantes e endereços IP, para que ele saiba se cada solicitação é ou não a primeira de um determinado solicitante.</span><span class="sxs-lookup"><span data-stu-id="e9c70-328">It also has a built-in ability to redirect mobile visitors to specific locations configured in Web.config. It's able to work without depending on ASP.NET Sessions (and hence cookies) by storing a temporary log of hashes of visitors' HTTP headers and IP addresses, so it knows whether or not each request is the first one from a given vistor.</span></span>

<span data-ttu-id="e9c70-329">O elemento a seguir adicionado à seção fiftyOne do arquivo Web. config redirecionará a primeira solicitação de um dispositivo móvel detectado para a página ~/Mobile/Default.aspx.</span><span class="sxs-lookup"><span data-stu-id="e9c70-329">The following element added to the fiftyOne section of the web.config file will redirect the first request from a detected mobile device to the page ~/Mobile/Default.aspx.</span></span> <span data-ttu-id="e9c70-330">Qualquer solicitação para páginas sob a pasta móvel *não* será redirecionada, independentemente do tipo de dispositivo.</span><span class="sxs-lookup"><span data-stu-id="e9c70-330">Any requests to pages under the Mobile folder will *not* be redirected, regardless of device type.</span></span> <span data-ttu-id="e9c70-331">Se o dispositivo móvel ficar inativo por um período de 20 minutos ou se o dispositivo for esquecido e as solicitações subsequentes serão tratadas como novas para fins de redirecionamento.</span><span class="sxs-lookup"><span data-stu-id="e9c70-331">If the mobile device has been inactive for a period of 20 minutes or more the device will be forgotten and subsequent requests will be treated as new ones for the purposes of redirection.</span></span>

[!code-xml[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample15.xml)]

<span data-ttu-id="e9c70-332">Para obter mais detalhes, consulte a [documentação do 51Degrees.mobi Foundation](https://github.com/51Degrees/dotNET-Device-Detection).</span><span class="sxs-lookup"><span data-stu-id="e9c70-332">For more details, see [51degrees.mobi Foundation documentation](https://github.com/51Degrees/dotNET-Device-Detection).</span></span>

> [!NOTE]
> <span data-ttu-id="e9c70-333">Você *pode* usar o recurso de redirecionamento do 51Degrees.mobi Foundation em aplicativos ASP.NET MVC, mas será necessário definir sua configuração de redirecionamento em termos de URLs simples, não em termos de parâmetros de roteamento ou colocando filtros MVC em ações.</span><span class="sxs-lookup"><span data-stu-id="e9c70-333">You *can* use 51Degrees.mobi Foundation's redirection feature on ASP.NET MVC applications, but you will need to define your redirection configuration in terms of plain URLs, not in terms of routing parameters or by putting MVC filters on actions.</span></span> <span data-ttu-id="e9c70-334">Isso ocorre porque (no momento da escrita) o 51Degrees.mobi Foundation não reconhece filtros ou roteamento.</span><span class="sxs-lookup"><span data-stu-id="e9c70-334">This is because (at the time of writing) 51Degrees.mobi Foundation does not recognize filters or routing.</span></span>

### <a name="disabling-transcoders-and-proxy-servers"></a><span data-ttu-id="e9c70-335">Desabilitando transcodificadores e servidores proxy</span><span class="sxs-lookup"><span data-stu-id="e9c70-335">Disabling Transcoders and Proxy Servers</span></span>

<span data-ttu-id="e9c70-336">Os operadores de rede móvel têm dois objetivos amplos em sua abordagem para a Internet móvel:</span><span class="sxs-lookup"><span data-stu-id="e9c70-336">Mobile network operators have two broad objectives in their approach to the mobile internet:</span></span>

1. <span data-ttu-id="e9c70-337">Fornecer o máximo possível de conteúdo relevante</span><span class="sxs-lookup"><span data-stu-id="e9c70-337">Provide as much relevant content as possible</span></span>
2. <span data-ttu-id="e9c70-338">Maximize o número de clientes que podem compartilhar a largura de banda limitada da rede de rádio</span><span class="sxs-lookup"><span data-stu-id="e9c70-338">Maximize the number of customers who can share the limited radio network bandwidth</span></span>

<span data-ttu-id="e9c70-339">Como a maioria das páginas da Web foi projetada para grandes telas de tamanho de área de trabalho e conexões rápidas de banda larga fixa, muitos operadores usam *transcodificadores* ou *servidores proxy* que alteram dinamicamente o conteúdo da Web.</span><span class="sxs-lookup"><span data-stu-id="e9c70-339">Since most web pages were designed for large desktop-sized screens and fast fixed-line broadband connections, many operators use *transcoders* or *proxy servers* that dynamically alter web content.</span></span> <span data-ttu-id="e9c70-340">Eles podem modificar sua marcação HTML ou CSS para atender a telas menores (especialmente para "telefones de recursos" que não têm a capacidade de processamento para lidar com layouts complexos) e podem recompactar suas imagens (reduzindo significativamente sua qualidade) para melhorar as velocidades de entrega de página.</span><span class="sxs-lookup"><span data-stu-id="e9c70-340">They may modify your HTML markup or CSS to suit smaller screens (especially for "feature phones" that lack the processing power to handle complex layouts), and they may recompress your images (significantly reducing their quality) to improve page delivery speeds.</span></span>

<span data-ttu-id="e9c70-341">Mas, se você tomou o esforço de produzir uma versão otimizada para dispositivos móveis do seu site, provavelmente não quer que o operador de rede interfira mais.</span><span class="sxs-lookup"><span data-stu-id="e9c70-341">But if you've taken the effort to produce a mobile-optimized version of your site, you probably don't want the network operator to interfere with it any further.</span></span> <span data-ttu-id="e9c70-342">Você pode adicionar a seguinte linha à página\_evento de carregamento em qualquer formulário da Web do ASP.NET:</span><span class="sxs-lookup"><span data-stu-id="e9c70-342">You can add the following line to the Page\_Load event in any ASP.NET Web Form:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample16.cs)]

<span data-ttu-id="e9c70-343">Ou, para um controlador MVC ASP.NET, você pode adicionar a substituição do método a seguir para que ele se aplique a todas as ações nesse controlador:</span><span class="sxs-lookup"><span data-stu-id="e9c70-343">Or, for an ASP.NET MVC controller, you could add the following method override so that it applies to all actions on that controller:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample17.cs)]

<span data-ttu-id="e9c70-344">A mensagem HTTP resultante informa transcodificadores e proxies compatíveis com o W3C para não alterar o conteúdo.</span><span class="sxs-lookup"><span data-stu-id="e9c70-344">The resulting HTTP message informs W3C compliant transcoders and proxies not to alter content.</span></span> <span data-ttu-id="e9c70-345">É claro que não há nenhuma garantia de que os operadores de rede móvel respeitarão essa mensagem.</span><span class="sxs-lookup"><span data-stu-id="e9c70-345">Of course, there is no guarantee that mobile network operators will respect this message.</span></span>

### <a name="styling-mobile-pages-for-mobile-browsers"></a><span data-ttu-id="e9c70-346">Estilizando páginas móveis para navegadores móveis</span><span class="sxs-lookup"><span data-stu-id="e9c70-346">Styling mobile pages for mobile browsers</span></span>

<span data-ttu-id="e9c70-347">Está além do escopo deste documento descrever detalhadamente quais tipos de marcação HTML funcionam corretamente ou quais técnicas de design da Web maximizam a usabilidade em determinados dispositivos.</span><span class="sxs-lookup"><span data-stu-id="e9c70-347">It's beyond the scope of this document to describe in great detail what kinds of HTML markup work correctly or which web design techniques maximize usability on particular devices.</span></span> <span data-ttu-id="e9c70-348">Cabe a você encontrar um layout suficientemente simples, otimizado para uma tela de tamanho móvel, sem usar truques de posicionamento HTML ou CSS não confiáveis.</span><span class="sxs-lookup"><span data-stu-id="e9c70-348">It's up to you to find a sufficiently simple layout, optimized for a mobile-sized screen, without using unreliable HTML or CSS positioning tricks.</span></span> <span data-ttu-id="e9c70-349">No entanto, uma técnica importante que vale a pena mencionar é a *marca meta viewport*.</span><span class="sxs-lookup"><span data-stu-id="e9c70-349">One important technique worth mentioning, however, is the *viewport meta tag*.</span></span>

<span data-ttu-id="e9c70-350">Alguns navegadores móveis modernos, em um esforço de exibição de páginas da Web, destinados a monitores de área de trabalho, renderizam a página em uma tela virtual, também chamada de "visor" (por exemplo, o visor virtual tem 980 pixels de largura no iPhone e 850 pixels de largura no Opera Mobile por padrão) e, em seguida, dimensione o resultado para cima para caber nos pixels físicos da tela.</span><span class="sxs-lookup"><span data-stu-id="e9c70-350">Certain modern mobile browsers, in an effort display web pages meant for desktop monitors, render the page on a virtual canvas, also called "viewport" (e.g., the virtual viewport is 980 pixels wide on iPhone, and 850 pixels wide on Opera Mobile by default) and then scale the result down to fit onto the screen's physical pixels.</span></span> <span data-ttu-id="e9c70-351">O usuário pode ampliar e deslocar esse visor.</span><span class="sxs-lookup"><span data-stu-id="e9c70-351">The user can then zoom in and pan around that viewport.</span></span> <span data-ttu-id="e9c70-352">Isso tem a vantagem de permitir que o navegador exiba a página em seu layout pretendido, mas também tem a desvantagem de que ele força o zoom e o movimento panorâmico, o que é inconveniente para o usuário.</span><span class="sxs-lookup"><span data-stu-id="e9c70-352">This has the advantage that it lets the browser display the page in its intended layout, but it's also has the disadvantage that it forces zooming and panning, which is inconvenient for the user.</span></span> <span data-ttu-id="e9c70-353">Se você estiver projetando para dispositivos móveis, é melhor criar uma tela estreita para que não seja necessária nenhuma rolagem horizontal ou de zoom.</span><span class="sxs-lookup"><span data-stu-id="e9c70-353">If you're designing for mobile, it's better to design for a narrow screen so that no zooming or horizontal scrolling is necessary.</span></span>

<span data-ttu-id="e9c70-354">Uma maneira de dizer ao navegador móvel a largura do visor deve ser por meio da marca meta *viewport* não padrão.</span><span class="sxs-lookup"><span data-stu-id="e9c70-354">A way to tell the mobile browser how wide the viewport should be is through the nonstandard *viewport* meta tag.</span></span> <span data-ttu-id="e9c70-355">Por exemplo, se você adicionar o seguinte à seção de cabeçalho da página,</span><span class="sxs-lookup"><span data-stu-id="e9c70-355">For example, if you add the following to your page's HEAD section,</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample18.html)]

<span data-ttu-id="e9c70-356">…</span><span class="sxs-lookup"><span data-stu-id="e9c70-356">…</span></span> <span data-ttu-id="e9c70-357">em seguida, o suporte a navegadores do smartphone fará o layout da página em uma tela virtual de 480 pixels de largura.</span><span class="sxs-lookup"><span data-stu-id="e9c70-357">then supporting smartphone browsers will lay out the page on a 480-pixel wide virtual canvas.</span></span> <span data-ttu-id="e9c70-358">Isso significa que, se os elementos HTML definirem suas larguras em termos percentuais, os percentuais serão interpretados em relação a essa largura de 480 pixels, não à largura padrão do visor.</span><span class="sxs-lookup"><span data-stu-id="e9c70-358">This means that if your HTML elements define their widths in percentage terms, the percentages will be interpreted with respect to this 480-pixel width, not the default viewport width.</span></span> <span data-ttu-id="e9c70-359">Como resultado, é menos provável que o usuário tenha que aplicar zoom e panorâmica horizontalmente, aprimorando consideravelmente a experiência de navegação móvel.</span><span class="sxs-lookup"><span data-stu-id="e9c70-359">As a result, the user is less likely to have to zoom and pan horizontally – considerably improving the mobile browsing experience.</span></span>

<span data-ttu-id="e9c70-360">Se desejar que a largura do visor corresponda aos pixels físicos do dispositivo, você poderá especificar o seguinte:</span><span class="sxs-lookup"><span data-stu-id="e9c70-360">If you want the viewport width to match the device's physical pixels, you can specify the following:</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample19.html)]

<span data-ttu-id="e9c70-361">Para que isso funcione corretamente, você não deve forçar explicitamente que os elementos excedam essa largura (por exemplo, usando um atributo de *largura* ou propriedade CSS), caso contrário, o navegador será forçado a usar um visor maior, independentemente.</span><span class="sxs-lookup"><span data-stu-id="e9c70-361">For this to work correctly, you must not explicitly force elements to exceed that width (e.g., using a *width* attribute or CSS property), otherwise the browser will be forced to use a larger viewport regardless.</span></span> <span data-ttu-id="e9c70-362">Consulte também: [mais detalhes sobre a marca viewport não padrão](https://developer.apple.com/library/safari/#documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html).</span><span class="sxs-lookup"><span data-stu-id="e9c70-362">See also: [more details about the nonstandard viewport tag](https://developer.apple.com/library/safari/#documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html).</span></span>

<span data-ttu-id="e9c70-363">A maioria dos smartphones modernos dá suporte à *orientação dupla*: eles podem ser mantidos no modo retrato ou paisagem.</span><span class="sxs-lookup"><span data-stu-id="e9c70-363">Most modern smartphones support *dual orientation*: they can be held in either portrait or landscape mode.</span></span> <span data-ttu-id="e9c70-364">Portanto, é importante não fazer suposições sobre a largura da tela em pixels.</span><span class="sxs-lookup"><span data-stu-id="e9c70-364">So, it's important not to make assumptions about the screen width in pixels.</span></span> <span data-ttu-id="e9c70-365">Nem mesmo suponha que a largura da tela seja corrigida, pois o usuário pode reorientar seu dispositivo enquanto eles estão em sua página.</span><span class="sxs-lookup"><span data-stu-id="e9c70-365">Don't even assume that the screen width is fixed, because the user can re-orient their device while they are on your page.</span></span>

<span data-ttu-id="e9c70-366">Dispositivos Windows Mobile e Blackberry mais antigos também podem aceitar as seguintes marcas meta no cabeçalho da página para informar que o conteúdo foi otimizado para dispositivos móveis e, portanto, não deve ser transformado.</span><span class="sxs-lookup"><span data-stu-id="e9c70-366">Older Windows Mobile and Blackberry devices may also accept the following meta tags in the page header to inform them content has been optimized for mobile and therefore should not be transformed.</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample20.html)]

## <a name="additional-resources"></a><span data-ttu-id="e9c70-367">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="e9c70-367">Additional Resources</span></span>

<span data-ttu-id="e9c70-368">Para obter uma lista de emuladores de dispositivo móvel e simuladores que você pode usar para testar seu aplicativo Web ASP.NET móvel, consulte a página [simular dispositivos móveis populares para teste](../mobile/device-simulators.md).</span><span class="sxs-lookup"><span data-stu-id="e9c70-368">For a list of mobile device emulators and simulators you can use to test your mobile ASP.NET web application, see the page [Simulate popular mobile devices for testing](../mobile/device-simulators.md).</span></span>

## <a name="credits"></a><span data-ttu-id="e9c70-369">Credits</span><span class="sxs-lookup"><span data-stu-id="e9c70-369">Credits</span></span>

- <span data-ttu-id="e9c70-370">Autor principal: Steven Sanderson</span><span class="sxs-lookup"><span data-stu-id="e9c70-370">Primary author: Steven Sanderson</span></span>
- <span data-ttu-id="e9c70-371">Revisores/gravadores de conteúdo adicionais: James Rosewell, Mikael Söderström, Scott Hanselman, Scott Hunter</span><span class="sxs-lookup"><span data-stu-id="e9c70-371">Reviewers / additional content writers: James Rosewell, Mikael Söderström, Scott Hanselman, Scott Hunter</span></span>
